"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5871],{97558:function(e,t,r){r.d(t,{$c:function(){return h},Hg:function(){return c},jW:function(){return d},uD:function(){return y}});var n=r(94761),i=r(50973),o=r(56529);let s=new Set(["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"]);function a(e){return e instanceof n.Z}function l(e){return e instanceof i.Z?Object.keys(e.items):a(e)?(0,o.vw)(e).keys():e?Object.keys(e):[]}function p(e,t){return e instanceof i.Z?e.items[t]:e[t]}function u(e){return e?e.declaredClass:null}function d(e,t){return y(e,t)}function y(e,t){if(null==e)return!1;let r=t.split("."),n=e;for(let e of r){if("complete"===n.type)break;if("partial"!==n.type)return!1;{let t=n.diff[e];if(!t)return!1;n=t}}return!0}function h(e,t){if(!e)return!1;if("partial"===e.type){let r=Object.keys(e.diff);return 1===r.length&&r[0]===t}return!1}function c(e,t){if("function"!=typeof e&&"function"!=typeof t&&(null!=e||null!=t))return null==e||null==t||"object"==typeof e&&"object"==typeof t&&u(e)!==u(t)?{type:"complete",oldValue:e,newValue:t}:function e(t,r){let n;let i=t.diff;if(i&&"function"==typeof i)return i(t,r);let o=l(t),d=l(r);if(0===o.length&&0===d.length)return;if(!o.length||!d.length||!(!Array.isArray(t)||!Array.isArray(r))&&t.length!==r.length)return{type:"complete",oldValue:t,newValue:r};let y=d.filter(e=>!o.includes(e)),h=o.filter(e=>!d.includes(e)),c=o.filter(e=>d.includes(e)&&p(t,e)!==p(r,e)).concat(y,h).sort(),f=u(t);if(f&&s.has(f)&&c.length)return{type:"complete",oldValue:t,newValue:r};let m=a(t)&&a(r);for(let o of c){let s;let a=p(t,o),l=p(r,o);if((m||"function"!=typeof a&&"function"!=typeof l)&&a!==l&&(null!=a||null!=l)){if(i&&i[o]&&"function"==typeof i[o])s=i[o]?.(a,l);else if(a instanceof Date&&l instanceof Date){if(a.getTime()===l.getTime())continue;s={type:"complete",oldValue:a,newValue:l}}else s="object"==typeof a&&"object"==typeof l&&u(a)===u(l)?e(a,l):{type:"complete",oldValue:a,newValue:l};null!=s&&(null!=n?n.diff[o]=s:n={type:"partial",diff:{[o]:s}})}}return n}(e,t)}},43859:function(e,t,r){r.d(t,{Dm:function(){return u},Hq:function(){return y},MS:function(){return h},bU:function(){return a}});var n=r(37180),i=r(61764),o=r(51733),s=r(8739);function a(e){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===e||"esriGeometryMultipoint"===e?s.I4:"esriGeometryPolyline"===e?s.ET:s.lF}}}let l=/^[_$a-zA-Z][_$a-zA-Z0-9]*$/,p=1;function u(e,t){if((0,n.Z)("esri-csp-restrictions"))return()=>({[t]:null,...e});try{let r=`this${d(t)} = null;`;for(let t in e)r+=`this${d(t)} = ${JSON.stringify(e[t])};`;let n=Function(`
      return class AttributesClass$${p++} {
        constructor() {
          ${r};
        }
      }
    `)();return()=>new n}catch(r){return()=>({[t]:null,...e})}}function d(e){return l.test(e)?`.${e}`:`["${e}"]`}function y(e={}){return[{name:"New Feature",description:"",prototype:{attributes:(0,i.d9)(e)}}]}function h(e,t){return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:e},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:t,supportsDelete:t,supportsEditing:t,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:t,supportsExceedsLimitStatistics:!0,supportsAsyncConvert3D:!1},query:o.g,queryRelated:{supportsCount:!0,supportsOrderBy:!0,supportsPagination:!0,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},editing:{supportsGeometryUpdate:t,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsAsyncApplyEdits:!1,zDefault:void 0}}}},74084:function(e,t,r){r.d(t,{Qc:function(){return S},Fd:function(){return D},TD:function(){return E},Cn:function(){return N},zS:function(){return I},WZ:function(){return C}});var n=r(86641);r(55066);var i=r(94761),o=r(94605),s=r(65223),a=r(59528),l=r(15963),p=r(89312);r(37180),r(3457);var u=r(64186),d=r(54001),y=r(20928),h=r(62329),c=r(83339),f=r(53787),m=r(5005);class g{constructor(){this._featureLookup=new Map}static getInstance(){return g.instance||(g.instance=new g),g.instance}static resetInstance(){g.instance&&(g.instance=null)}deleteFromStore(e){e.forEach(e=>{this._featureLookup.delete(e)})}readFromStoreByList(e){let t=[];return e.forEach(e=>{let r=this.readFromStoreById(e);r&&t.push(r)}),t}readFromStoreById(e){return this._featureLookup.get(e)??null}writeToStore(e,t,r){let n=[];return e.forEach(e=>{if(!e?.id)return;e.properties||(e.properties=[]);let i,o=null;if(r&&e.properties[r]&&(o=(0,c.GH)(e.properties[r])),"originId"in e&&"destinationId"in e&&(e.properties.ESRI__ORIGIN_ID=e.originId,e.properties.ESRI__DESTINATION_ID=e.destinationId),e.properties[t]=e.id,e.id&&this._featureLookup.has(e.id)&&this._featureLookup.get(e.id).attributes){let n=this._featureLookup.get(e.id),s=JSON.parse(JSON.stringify(Object.assign(n.attributes,e.properties)));r&&e.properties[r]&&(s[r]=(0,m.im)(e.properties[r])),i=new f.u_(o?JSON.parse(JSON.stringify(o)):n?.geometry?JSON.parse(JSON.stringify(n.geometry)):null,s,null,e.properties[t])}else i=new f.u_(o?JSON.parse(JSON.stringify(o)):null,e.properties,null,e.properties[t]);this._featureLookup.set(e.id,i),n.push(i)}),n}}var b=r(62327),w=r(26822),T=r(17904),_=r(68468),v=r(9377);let I="ESRI__ID",C="ESRI__ORIGIN_ID",E="ESRI__DESTINATION_ID",N="ESRI__LAYOUT_GEOMETRY",D="ESRI__AGGREGATION_COUNT",S=class extends i.Z{constructor(e){super(e),this._processingCacheUpdatesLookup=new Map,this.knowledgeGraph=null,this.inclusionModeDefinition={generateAllSublayers:!0,namedTypeDefinitions:new Map},this.entityTypeNames=new Set,this.relationshipTypeNames=new Set,this.geographicLookup=new Map,this.sublayerCaches=new Map,this.nodeConnectionsLookup=new Map,this.relationshipConnectionsLookup=new Map,this.memberIdTypeLookup=new Map;let t=new Map;e.knowledgeGraph.dataModel.entityTypes?.forEach(r=>{r.name&&(t.set(r.name,"entity"),this._processingCacheUpdatesLookup.set(r.name,[]),e.inclusionModeDefinition&&!e.inclusionModeDefinition?.generateAllSublayers||this.entityTypeNames.add(r.name),r.properties?.forEach(e=>{e.geometryType&&"esriGeometryNull"!==e.geometryType&&this.geographicLookup.set(r.name,{name:e.name??"",geometryType:e.geometryType})}))}),e.knowledgeGraph.dataModel.relationshipTypes?.forEach(r=>{r.name&&(t.set(r.name,"relationship"),this._processingCacheUpdatesLookup.set(r.name,[]),e.inclusionModeDefinition&&!e.inclusionModeDefinition?.generateAllSublayers||this.relationshipTypeNames.add(r.name),r.properties?.forEach(e=>{e.geometryType&&"esriGeometryNull"!==e.geometryType&&this.geographicLookup.set(r.name,{name:e.name??"",geometryType:e.geometryType})}))}),e.inclusionModeDefinition?.namedTypeDefinitions.forEach((r,n)=>{if("entity"===t.get(n))this.entityTypeNames.add(n);else{if("relationship"!==t.get(n))return s.Z.getLogger(this).warn(`A named type, ${n}, was in the inclusion list that wasn't in the data model and will be removed`),void e.inclusionModeDefinition?.namedTypeDefinitions.delete(n);this.relationshipTypeNames.add(n)}let i=new Map;r.members?.forEach(e=>{a.s1(this.memberIdTypeLookup,e.id,()=>new Set).add(n);let t=this.getById(e.id);t&&i.set(e.id,t)}),this.sublayerCaches.set(n,i)})}addToLayer(e){e.forEach(({typeName:e,id:t})=>{if(!this.inclusionModeDefinition)throw new o.Z("knowledge-graph:layer-data-manager","You cannot add to a layer's exclusion list if it was not created with an exclusion list originally");if(this.inclusionModeDefinition.namedTypeDefinitions.has(e)){if(this.inclusionModeDefinition.namedTypeDefinitions.has(e)){let r=this.inclusionModeDefinition.namedTypeDefinitions.get(e);r.members||(r.members=new Map),r.members.set(t,{id:t}),(0,a.s1)(this.memberIdTypeLookup,t,()=>new Set).add(e)}}else{let r=new Map;r.set(t,{id:t}),this.inclusionModeDefinition.namedTypeDefinitions.set(e,{useAllData:!1,members:r}),(0,a.s1)(this.memberIdTypeLookup,t,()=>new Set).add(e)}})}getById(e){return g.getInstance().readFromStoreById(e)}async getData(e,t,r){let n;if(t.objectType.name&&this.inclusionModeDefinition?.namedTypeDefinitions&&this.inclusionModeDefinition.namedTypeDefinitions.size>0&&!this.inclusionModeDefinition.namedTypeDefinitions.has(t.objectType.name))return[];if(n=e||new _.Z({where:"1=1",outFields:["*"]}),"link-chart"===t.parentCompositeLayer.type){let e=t.parentCompositeLayer,r=this._processingCacheUpdatesLookup.get(t.objectType.name??""),i=n.outFields;i&&1===i.length&&i[0]===I&&"1=1"===n.where||await Promise.all(r??[]);let o=this.sublayerCaches.has(t.objectType.name??"")?Array.from(this.sublayerCaches.get(t.objectType.name)?.values()):[],s=[];return o.forEach(r=>{this.relationshipTypeNames.has(t.objectType.name)?r.geometry=e.relationshipLinkChartDiagramLookup.get(r.attributes[t.objectIdField]):r.geometry=e.entityLinkChartDiagramLookup.get(r.attributes[t.objectIdField]),r.attributes[N]=r.geometry,s.push(r)}),s}return this.retrieveDataFromService(n,t,r)}async getConnectedRecordIds(e,t){let r=[],n="",i=[],o=new Map;if(e.forEach(e=>{if(this.memberIdTypeLookup.has(e))for(let t of this.memberIdTypeLookup.get(e)){if(!this.entityTypeNames.has(t))return;o.has(t)?o.get(t)?.push(e):o.set(t,[e])}}),t&&0!==t?.length){for(let e of t)n=n+e+"|";n=n.slice(0,-1)}return o.forEach((e,o)=>{let a;a=t&&0!==t?.length?`MATCH (n:${o})-[r:${n}]-(m) WHERE id(n) IN $ids RETURN id(r), type(r), id(m), labels(m)[0]`:`MATCH (n:${o})-[r]-(m) WHERE id(n) IN $ids RETURN id(r), type(r), id(m), labels(m)[0]`;let l=new Promise(t=>{(async()=>{let t=(await (0,w.executeQueryStreaming)(this.knowledgeGraph,new T.Z({openCypherQuery:a,bindParameters:{ids:e}}))).resultRowsStream.getReader();try{for(;;){let{done:e,value:n}=await t.read();if(e)break;for(let e=0;e<n.length;e++){let t=n[e];r.push({id:t[0],typeName:t[1]}),r.push({id:t[2],typeName:t[3]})}}}catch(e){if("AbortError"!==e.name)throw e;s.Z.getLogger(this).info("Request aborted as expected")}})().then(()=>{t()})});i.push(l)}),this.refreshCacheContent(),await Promise.all(i),r}async getAttachedRelationships(e,t){let r=[],n=(await (0,w.executeQueryStreaming)(this.knowledgeGraph,new T.Z({openCypherQuery:"MATCH (n)-[r]->(m) WHERE id(n) IN $nodeIds AND id(m) in $nodeIds AND NOT id(r) IN $relationshipExclusionIds return id(r), type(r)",bindParameters:{nodeIds:e,relationshipExclusionIds:t}}))).resultRowsStream.getReader();try{for(;;){let{done:e,value:t}=await n.read();if(e)break;for(let e=0;e<t.length;e++){let n=t[e];r.push({id:n[0],typeName:n[1]})}}}catch(e){if("AbortError"!==e.name)throw e;s.Z.getLogger(this).info("Request aborted as expected")}return r}async refreshCacheContent(e,t,r,n=!0){let i=g.getInstance(),s=[],l=new Map,p=new Map;for(let[u,d]of(this.knowledgeGraph.dataModel.entityTypes?.forEach(e=>{e.name&&p.set(e.name,e)}),this.knowledgeGraph.dataModel.relationshipTypes?.forEach(e=>{e.name&&p.set(e.name,e)}),e||this.inclusionModeDefinition?e?e.forEach(e=>{if(this.memberIdTypeLookup.has(e))for(let t of this.memberIdTypeLookup.get(e))l.has(t)?l.get(t)?.push(e):l.set(t,[e])}):this.inclusionModeDefinition?.namedTypeDefinitions?.forEach((e,t)=>{e.useAllData?l.set(t,null):e.members&&e.members.forEach(e=>{l.has(t)&&null!==l.get(t)?l.get(t)?.push(e.id):l.set(t,[e.id])})}):(this.knowledgeGraph.dataModel.entityTypes?.forEach(e=>{e.name&&l.set(e.name,null)}),this.knowledgeGraph.dataModel.entityTypes?.forEach(e=>{e.name&&l.set(e.name,null)})),l)){let e=new Promise(e=>{(async()=>{let e=new Set,s=[],l,y="",h=!1;if(t||p.get(u)?.properties?.forEach(t=>{t.name&&e.add(t.name)}),r&&this.geographicLookup.has(u)){let t=this.geographicLookup.get(u)?.name;t&&e.add(t)}if(this.entityTypeNames.has(u))y=`MATCH (n:${u}) ${d?"WHERE id(n) IN $ids ":""}return ID(n)`,e.forEach(e=>{y+=`, n.${e}`,s.push(e)});else{if(!this.relationshipTypeNames.has(u))throw new o.Z("knowledge-graph:layer-data-manager",`The graph type of ${u} could not be determined. Was this type set in the KG data model and inclusion definition?`);h=!0,y=`MATCH ()-[n:${u}]->() ${d?"WHERE id(n) IN $ids ":""}return ID(n), id(startNode(n)), id(endNode(n))`,e.forEach(e=>{y+=`, n.${e}`,s.push(e)})}l=new T.Z(d?{openCypherQuery:y,bindParameters:{ids:d}}:{openCypherQuery:y});let c=(await (0,w.executeQueryStreaming)(this.knowledgeGraph,l)).resultRowsStream.getReader();for(;;){let{done:e,value:t}=await c.read();if(e)break;let r=[];for(let e=0;e<t.length;e++){let n=t[e],i=0,o=0,l={properties:{}};for(l.id=n[i],i++,o++,h&&(l.originId=n[i],i++,o++,l.destinationId=n[i],i++,o++,(0,a.s1)(this.nodeConnectionsLookup,l.originId,()=>new Set).add(l.id),(0,a.s1)(this.nodeConnectionsLookup,l.destinationId,()=>new Set).add(l.id),(0,a.s1)(this.relationshipConnectionsLookup,l.id,()=>[l.originId,l.destinationId]));i<n.length;i++)l.properties[s[i-o]]=n[i];r.push(l)}let o=i.writeToStore(r,I,this.geographicLookup.get(u)?.name);this.sublayerCaches.has(u)||this.sublayerCaches.set(u,new Map),n&&!this.inclusionModeDefinition?.namedTypeDefinitions.has(u)&&this.inclusionModeDefinition?.namedTypeDefinitions.set(u,{useAllData:!1,members:new Map}),n&&!this.inclusionModeDefinition?.namedTypeDefinitions.get(u).members&&(this.inclusionModeDefinition.namedTypeDefinitions.get(u).members=new Map);let l=this.sublayerCaches.get(u);o.forEach(e=>{l?.set(e.attributes[I],e),n&&!this.inclusionModeDefinition?.namedTypeDefinitions.get(u).members.has(e.attributes[I])&&(this.inclusionModeDefinition?.namedTypeDefinitions.get(u).members.set(e.attributes[I],{id:e.attributes[I]}),(0,a.s1)(this.memberIdTypeLookup,e.attributes[I],()=>new Set).add(u))})}})().then(()=>{e(null)})});s.push(e),this._processingCacheUpdatesLookup.get(u)?.push(e)}await Promise.all(s)}removeFromLayer(e){let t=new Set,r=new Set(e.map(e=>e.id));for(let r of e)t.add(r.typeName),1===this.memberIdTypeLookup.get(r.id)?.size?this.memberIdTypeLookup.delete(r.id):this.memberIdTypeLookup.get(r.id)?.delete(r.typeName),this.inclusionModeDefinition?.namedTypeDefinitions.forEach((e,t)=>{t===r.typeName&&e.members?.has(r.id)&&e.members.delete(r.id)});t.forEach(e=>{this.sublayerCaches.get(e)?.forEach((t,n)=>{r.has(n)&&this.sublayerCaches.get(e)?.delete(n)})})}async retrieveDataFromService(e,t,r){let n=g.getInstance(),i=new Set,s=[],a,p="",u=[],c="relationship"===t.graphType,f=this.inclusionModeDefinition?.namedTypeDefinitions?.get(t.objectType.name)?.useAllData,m=t.parentCompositeLayer.sublayerIdsCache.get(t.objectType.name),_=!f&&m?Array.from(m).sort():null;if(this.inclusionModeDefinition?.namedTypeDefinitions?.get(t.objectType.name)?.useAllData)this.inclusionModeDefinition?.namedTypeDefinitions?.get(t.objectType.name)?.useAllData&&null!=e.objectIds&&(_=e.objectIds);else if(null!=e.objectIds&&_&&_.length>0){let t=e.objectIds;e.objectIds=_.filter(e=>t.includes(e))}else if(null!=e.objectIds)_=e.objectIds;else{if(this.inclusionModeDefinition?.namedTypeDefinitions.has(t.objectType.name)&&(!this.inclusionModeDefinition.namedTypeDefinitions.get(t.objectType.name)?.members||this.inclusionModeDefinition.namedTypeDefinitions.get(t.objectType.name)?.members?.size<1))return e.objectIds=[],[];e.objectIds=_}if(null!=e.outFields){let r=e.outFields;r.includes("*")?t.fields.forEach(e=>{i.add(e.name)}):r.forEach(e=>{e!==I&&e!==t.geometryFieldName&&i.add(e)})}if(null!=e.geometry){let r;let n=e.geometry,u=t.parentCompositeLayer.dataManager.knowledgeGraph.serviceDefinition,f=u?.spatialReference,m=u?.serviceCapabilities?.geometryCapabilities,g=m?.geometryMaxBoundingRectangleSizeX,w=m?.geometryMaxBoundingRectangleSizeY;if(n?.extent?.spatialReference&&!n.spatialReference?.isWGS84?(await (0,y.initializeProjection)(n.extent.spatialReference,h.YU),r=(0,y.project)(n.extent,h.YU)):r=n.extent,g&&w&&f){if(4326!==f.wkid){let e=new v.Z({spatialReference:f,xmax:g,ymax:w}),t=(0,y.project)(e,h.YU);g=t.xmax,w=t.ymax}if(r.xmax-r.xmin>g)throw new o.Z("knowledge-graph:layer-data-manager",`Extent x bounds should be within ${g}\xb0 latitude, limit exceeded`);if(r.ymax-r.ymin>w)throw new o.Z("knowledge-graph:layer-data-manager",`Extent y bounds should be within ${w}\xb0 longitude, limit exceeded`)}if(null!=e.where&&"1=1"!==e.where){let r=await (0,l.E)(e.where.toUpperCase(),t.fieldsIndex);t.fields.forEach(e=>{r.fieldNames.includes(e.name)&&i.add(e.name)})}p=c?`Match ()-[n:${t.objectType.name}]->() WHERE esri.graph.ST_Intersects($param_filter_geom, n.${t.geometryFieldName}) return ID(n), id(startNode(r)), id(endNode(r))`:`Match (n:${t.objectType.name}) WHERE esri.graph.ST_Intersects($param_filter_geom, n.${t.geometryFieldName}) return ID(n)`,t.geometryFieldName&&i.add(t.geometryFieldName),i.forEach(e=>{p+=`, n.${e}`,s.push(e)}),a=new T.Z({openCypherQuery:p,bindParameters:{param_filter_geom:new d.Z({rings:(0,b.MM)(r)})}})}else{let r="";if(null!=e.where&&"1=1"!==e.where){let n=await (0,l.E)(e.where,t.fieldsIndex);t.fields.forEach(e=>{n.fieldNames.includes(e.name)&&i.add(e.name)});let o=new Set(["column-reference","string","number","binary-expression"]),s=new Set(["=","<","<=","<>",">",">=","AND","OR","LIKE"]),a=!1,p=e=>{if("column-reference"===e.type)return`n.${e.column}`;if("string"===e.type)return`'${e.value}'`;if("number"===e.type)return`${e.value}`;if("binary-expression"===e.type&&o.has(e.left.type)&&o.has(e.right.type)&&s.has(e.operator))return`${p(e.left)} ${e.operator} ${p(e.right)}`;if("binary-expression"===e.type&&"LIKE"===e.operator){let t="";if("function"===e.left.type&&"column-reference"===e.left.args.value[0].type)t+=`lower(n.${e.left.args.value[0].column})`;else{if("column-reference"!==e.left.type)return a=!0,"";t+=`lower(n.${e.left.column})`}if(t+=" CONTAINS (","string"!==e.right.type)return a=!0,"";{let r=e.right.value;"%"===r.charAt(0)&&(r=r.slice(1)),"%"===r.charAt(r.length-1)&&(r=r.slice(0,-1)),t+=`'${r.toLowerCase()}')`}return t}return a=!0,""};r=p(n.parseTree),a&&(r="")}let n="";n=c?`Match ()-[n:${t.objectType.name}]->()`:`Match (n:${t.objectType.name})`;let o=!1;_&&(o=!0,n+=" WHERE ID(n) IN $ids"),r&&(n+=(o?" AND":" WHERE")+` ${r}`),n+=" return ID(n)",c&&(n+=", id(startNode(n)), id(endNode(n))"),e.returnGeometry&&t.geometryFieldName&&i.add(t.geometryFieldName),i.forEach(e=>{n+=`, n.${e}`,s.push(e)}),a=new T.Z(_?{openCypherQuery:n,bindParameters:{ids:_}}:{openCypherQuery:n})}let C=(await (0,w.executeQueryStreaming)(t.parentCompositeLayer.dataManager.knowledgeGraph,a,r)).resultRowsStream.getReader();for(;;){let{done:e,value:r}=await C.read();if(e)break;let i=[];for(let e=0;e<r.length;e++){let t=r[e],n=0,o=0,a={properties:{}};for(a.id=t[n],n++,o++,c&&(a.originId=t[n],n++,o++,a.destinationId=t[n],n++,o++);n<t.length;n++)a.properties[s[n-o]]=t[n];i.push(a)}u=u.concat(n.writeToStore(i,I,t.parentCompositeLayer.dataManager.geographicLookup.get(t.objectType.name)?.name))}return u}};(0,n._)([(0,p.Cb)()],S.prototype,"knowledgeGraph",void 0),(0,n._)([(0,p.Cb)()],S.prototype,"inclusionModeDefinition",void 0),(0,n._)([(0,p.Cb)()],S.prototype,"entityTypeNames",void 0),(0,n._)([(0,p.Cb)()],S.prototype,"relationshipTypeNames",void 0),(0,n._)([(0,p.Cb)()],S.prototype,"geographicLookup",void 0),(0,n._)([(0,p.Cb)()],S.prototype,"sublayerCaches",void 0),(0,n._)([(0,p.Cb)()],S.prototype,"nodeConnectionsLookup",void 0),(0,n._)([(0,p.Cb)()],S.prototype,"relationshipConnectionsLookup",void 0),(0,n._)([(0,p.Cb)()],S.prototype,"memberIdTypeLookup",void 0),S=(0,n._)([(0,u.j)("esri.layers.knowledgeGraph.KnowledgeGraphLayerDataManager")],S)},71488:function(e,t,r){r.d(t,{Z:function(){return Y}});var n=r(86641);r(55066);var i=r(23504);r(97278),r(79073),r(92494),r(57489),r(54844),r(21153),r(1406),r(94267);var o=r(90071),s=r(13676),a=r(61764),l=r(28541);r(28707);var p=r(89312);r(37180),r(65223);var u=r(64186),d=r(50713),y=r(39553),h=r(20928),c=r(36502),f=r(62329),m=r(37109),g=r(33362),b=r(71416),w=r(43859),T=r(74084);r(3457);let _=(0,r(70286).v)(),v=e=>{let t=class extends e{constructor(){super(...arguments),this.fields=[],this.fieldsIndex=null}};return(0,n._)([(0,p.Cb)(_.fields)],t.prototype,"fields",void 0),(0,n._)([(0,p.Cb)(_.fieldsIndex)],t.prototype,"fieldsIndex",void 0),t=(0,n._)([(0,u.j)("esri.layers.knowledgeGraph.KnowledgeGraphSublayerBase")],t)};var I=r(14066),C=r(18891),E=r(43825),N=r(20561),D=r(3482),S=r(89973),M=r(81124),R=r(78298),j=r(85959),x=r(40041),L=r(67009),k=r(32901),O=r(8951),A=r(9158),q=r(68468),G=r(43488),Z=r(70192),F=r(9377),Q=r(54001),P=r(58144),$=r(67828);function U(e){let t;if(!e.json)return e;e.json.write=J(e.json.write);let r=e.json.origins;if(!r)return e;for(t in r){let e=r[t];e&&(e.write=J(e.write))}return e}function J(e){return"object"==typeof e&&e?(!1!==e.enabled&&(e.overridePolicy=function(e){let{target:t,writer:r,overridePolicy:n,...i}=e;return function(e,t){let r=z.call(this,e,t);return r.enabled?{...i,...r}:r}}(e)),e):!0===e?B():e}function B(){return{overridePolicy:z}}function z(e,t){let r=!!this.geometryType,n={enabled:r};return r&&(n={...n,...V.call(this,e,t)}),n}function V(e,t){return{ignoreOrigin:this.originIdOf(t)>y.s3.DEFAULTS}}let H=class extends v((0,E.M)((0,C.b)((0,I.h7)((0,N.c)((0,M.n)((0,S.M)((0,D.Q)((0,l.R)(m.Z))))))))){constructor(e){super(e),this.blendMode="normal",this.capabilities=(0,w.MS)(!1,!1),this.charts=null,this.definitionExpression=null,this.displayField="",this.effect=null,this.elevationInfo=null,this.featureEffect=null,this.graphType=null,this.labelsVisible=!0,this.labelingInfo=null,this.layerType=null,this.legendEnabled=!0,this.maxScale=0,this.minScale=0,this.objectIdField=T.zS,this.objectType=null,this.opacity=1,this.orderBy=null,this.parentCompositeLayer=null,this.persistenceEnabled=!0,this.popupEnabled=!0,this.popupTemplate=null,this.refreshInterval=0,this.source={openPorts:()=>this.load().then(()=>{let e=new MessageChannel;return new Z.Z(e.port1,{channel:e,client:{queryFeatures:(e,t={})=>{let r=q.Z.fromJSON(e);return this.queryFeaturesJSON(r,t)}}}),[e.port2]})},this.title=null,this.type="knowledge-graph-sublayer",this.useViewTime=!0,this.visible=!0}get defaultPopupTemplate(){return this.createPopupTemplate()}set featureReduction(e){let t=this._normalizeFeatureReduction(e);this._set("featureReduction",t)}get fields(){let e=[];return this.objectType?.properties?.forEach(t=>{let r="esriFieldTypeOID"===t.fieldType?"esriFieldTypeInteger":t.fieldType;e.push(x.Z.fromJSON({name:t.name,type:r,alias:t.alias,defaultValue:t.defaultValue,editable:t.editable,nullable:t.nullable}))}),e.push(x.Z.fromJSON({name:this.objectIdField,type:"esriFieldTypeString",alias:this.objectIdField,editable:!1}),x.Z.fromJSON({name:T.Fd,type:"esriFieldTypeInteger",alias:T.Fd,editable:!1})),e}get geometryType(){if("link-chart"===this.parentCompositeLayer?.type)return"relationship"===this.graphType?"polyline":"point";let e=this.parentCompositeLayer?.dataManager.geographicLookup.get(this.objectType?.name),t=e?.geometryType;return t&&"esriGeometryNull"!==t?$.M.fromJSON(t):null}get geometryFieldName(){if("link-chart"===this.parentCompositeLayer?.type)return T.Cn;let e=this.parentCompositeLayer?.dataManager.geographicLookup.get(this.objectType?.name);return e?.name??null}get graphTypeName(){return this.objectType?.name}get hasM(){let e=this.parentCompositeLayer?.dataManager.geographicLookup.get(this.objectType?.name),t=e?.name,r=t?this.objectType?.properties?.[t]:null;return r?.hasM??!1}get hasZ(){let e=this.parentCompositeLayer?.dataManager.geographicLookup.get(this.objectType?.name),t=e?.name,r=t?this.objectType?.properties?.[t]:null;return r?.hasZ??!1}set renderer(e){(0,L.YN)(e,this.fieldsIndex),this._set("renderer",e)}get renderer(){return this._isOverridden("renderer")?this._get("renderer"):"link-chart"===this.parentCompositeLayer?.type?"relationship"===this.graphType?(0,o.i)((0,w.bU)($.M.toJSON("polyline")).renderer):(0,o.i)((0,w.bU)($.M.toJSON("point")).renderer):(0,o.i)((0,w.bU)($.M.toJSON(this.geometryType)).renderer)}get spatialReference(){return this.parentCompositeLayer?.dataManager?.knowledgeGraph?.dataModel?.spatialReference??c.Z.WGS84}writeTitle(e,t){t.title=e??"Layer"}createPopupTemplate(e){return(0,G.eZ)(this,e)}createQuery(){return new q.Z({where:"1=1",outFields:["*"]})}getField(e){for(let t=0;t<this.fields.length;t++)if(this.fields[t].name===e)return this.fields[t];return null}getFieldDomain(e,t){return null}async queryFeatures(e,t){let{resolvedQuery:r,queryEngine:n}=await this._setupQueryObjects(e),i=A.Z.fromJSON(await n.executeQuery(r.toJSON(),t?.signal));return i.features.forEach(e=>{e.sourceLayer=this}),i}async queryFeaturesJSON(e,t){let{resolvedQuery:r,queryEngine:n}=await this._setupQueryObjects(e);return await n.executeQuery(r.toJSON(),t?.signal)}async queryFeatureCount(e,t){let{resolvedQuery:r,queryEngine:n}=await this._setupQueryObjects(e);return n.executeQueryForCount(r.toJSON(),t?.signal)}async queryExtent(e={},t){let r;let n={...e,returnGeometry:!0},{resolvedQuery:i,queryEngine:o}=await this._setupQueryObjects(n),s=await o.executeQueryForExtent(i.toJSON(),t?.signal);return r=null!=s.extent?.xmin&&null!=s.extent?.xmax&&null!=s.extent?.ymin&&null!=s.extent?.ymax?new F.Z(s.extent):new F.Z,{count:s.count,extent:r}}async queryObjectIds(e,t){let r;let n=q.Z.from(e);if("link-chart"===this.parentCompositeLayer.type&&this._cachedQueryEngine)r=this._cachedQueryEngine;else{let e=await this.parentCompositeLayer.dataManager.getData(n,this,t);r=this.loadQueryEngine(e)}return r.executeQueryForIds(n.toJSON(),t?.signal)}loadQueryEngine(e){let t=new g.Z({geometryType:$.M.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ}),r=new b.q({fieldsIndex:this.fieldsIndex.toJSON(),geometryType:$.M.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ,objectIdField:this.objectIdField,spatialReference:this.spatialReference.toJSON(),timeInfo:null,featureStore:t});return r.featureStore.addMany(e),r}async refreshCachedQueryEngine(){let e=await this.parentCompositeLayer.dataManager.getData(new q.Z({where:"1=1",outFields:[T.zS]}),this);this._cachedQueryEngine=this.loadQueryEngine(e)}async _setupQueryObjects(e,t){let r;let n=q.Z.from(e),i=n.geometry;if(i&&!i.spatialReference?.isWGS84&&(await (0,h.initializeProjection)(i.spatialReference,f.YU),n.geometry=(0,h.project)(i instanceof Q.Z||i instanceof P.Z?i:i.extent,f.YU)),"link-chart"===this.parentCompositeLayer.type&&this._cachedQueryEngine)r=this._cachedQueryEngine;else{let e=await this.parentCompositeLayer.dataManager.getData(n,this,t);r=this.loadQueryEngine(e)}return{resolvedQuery:n,queryEngine:r}}};(0,n._)([(0,p.Cb)(U((0,a.d9)(I.nE)))],H.prototype,"blendMode",void 0),(0,n._)([(0,p.Cb)()],H.prototype,"capabilities",void 0),(0,n._)([(0,p.Cb)({json:{origins:{"web-scene":{write:!1}},write:B()}})],H.prototype,"charts",void 0),(0,n._)([(0,p.Cb)({readOnly:!0})],H.prototype,"defaultPopupTemplate",null),(0,n._)([(0,p.Cb)({type:String,json:{origins:{service:{read:!1}},name:"layerDefinition.definitionExpression",write:{ignoreOrigin:!0}}})],H.prototype,"definitionExpression",void 0),(0,n._)([(0,p.Cb)()],H.prototype,"displayField",void 0),(0,n._)([(0,p.Cb)(U((0,a.d9)(I.qu)))],H.prototype,"effect",void 0),(0,n._)([(0,p.Cb)()],H.prototype,"elevationInfo",void 0),(0,n._)([(0,p.Cb)(U((0,a.d9)(C.d)))],H.prototype,"featureEffect",void 0),(0,n._)([(0,p.Cb)(U((0,a.d9)(j.d)))],H.prototype,"featureReduction",null),(0,n._)([(0,p.Cb)()],H.prototype,"fields",null),(0,n._)([(0,p.Cb)()],H.prototype,"geometryType",null),(0,n._)([(0,p.Cb)()],H.prototype,"geometryFieldName",null),(0,n._)([(0,p.Cb)({type:["entity","relationship"],nonNullable:!0,json:{write:{isRequired:!0,ignoreOrigin:!0}}})],H.prototype,"graphType",void 0),(0,n._)([(0,p.Cb)({type:String,nonNullable:!0,json:{write:{isRequired:!0,ignoreOrigin:!0}}})],H.prototype,"graphTypeName",null),(0,n._)([(0,p.Cb)()],H.prototype,"hasM",null),(0,n._)([(0,p.Cb)()],H.prototype,"hasZ",null),(0,n._)([(0,p.Cb)({type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}},write:{ignoreOrigin:!0}}})],H.prototype,"id",void 0),(0,n._)([(0,p.Cb)(U((0,a.d9)(R.iR)))],H.prototype,"labelsVisible",void 0),(0,n._)([(0,p.Cb)({type:[k.Z],json:{name:"layerDefinition.drawingInfo.labelingInfo",read:O.r,write:B()}})],H.prototype,"labelingInfo",void 0),(0,n._)([(0,p.Cb)({readOnly:!0,json:{read:!1,write:{writer(e,t){t.layerType=this.geometryType?"KnowledgeGraphSubLayer":"KnowledgeGraphSubTable"},isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}}})],H.prototype,"layerType",void 0),(0,n._)([(0,p.Cb)(U((0,a.d9)(R.rn)))],H.prototype,"legendEnabled",void 0),(0,n._)([(0,p.Cb)(U((0,a.d9)(R.u1)))],H.prototype,"maxScale",void 0),(0,n._)([(0,p.Cb)(U((0,a.d9)(R.rO)))],H.prototype,"minScale",void 0),(0,n._)([(0,p.Cb)()],H.prototype,"objectIdField",void 0),(0,n._)([(0,p.Cb)()],H.prototype,"objectType",void 0),(0,n._)([(0,p.Cb)(U((0,a.d9)(R.Oh)))],H.prototype,"opacity",void 0),(0,n._)([(0,p.Cb)(U((0,a.d9)(N.l)))],H.prototype,"orderBy",void 0),(0,n._)([(0,p.Cb)()],H.prototype,"parentCompositeLayer",void 0),(0,n._)([(0,p.Cb)(U((0,a.d9)(R.C_)))],H.prototype,"popupEnabled",void 0),(0,n._)([(0,p.Cb)({type:i.Z,json:{name:"popupInfo",write:{ignoreOrigin:!0}}})],H.prototype,"popupTemplate",void 0),(0,n._)([(0,p.Cb)({type:Number,json:{write:{overridePolicy:V}}})],H.prototype,"refreshInterval",void 0),(0,n._)([(0,p.Cb)({types:s.A,json:{name:"layerDefinition.drawingInfo.renderer",write:B()}})],H.prototype,"renderer",null),(0,n._)([(0,p.Cb)()],H.prototype,"source",void 0),(0,n._)([(0,p.Cb)()],H.prototype,"spatialReference",null),(0,n._)([(0,p.Cb)({type:String,json:{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}}})],H.prototype,"title",void 0),(0,n._)([(0,d.c)("title")],H.prototype,"writeTitle",null),(0,n._)([(0,p.Cb)({json:{read:!1}})],H.prototype,"type",void 0),(0,n._)([(0,p.Cb)(U((0,a.d9)(M.I)))],H.prototype,"useViewTime",void 0),(0,n._)([(0,p.Cb)({type:Boolean,json:{name:"visibility",write:B()}})],H.prototype,"visible",void 0);let Y=H=(0,n._)([(0,u.j)("esri.layers.knowledgeGraph.KnowledgeGraphSublayer")],H)},62327:function(e,t,r){r.d(t,{MM:function(){return I},Ag:function(){return E},bv:function(){return C},jR:function(){return N}});var n,i,o,s,a,l,p,u,d,y,h,c,f,m,g=r(54748),b=r(94605),w=r(59528);r(83339);var T=r(26822),_=r(17904);r(55066),r(36502),(n=u||(u={})).ELEMENTUID="ELEMENTUID",n.TYPENAME="TYPENAME",u.ELEMENTUID,u.TYPENAME,(i=d||(d={}))[i.ELEMENTUID=0]="ELEMENTUID",i[i.TYPENAME=1]="TYPENAME",(o=y||(y={}))[o.ELEMENTUID=0]="ELEMENTUID",o[o.TYPENAME=1]="TYPENAME",o[o.FROMUID=2]="FROMUID",o[o.TOUID=3]="TOUID";var v=r(54274);function I(e){if(!e.spatialReference.isWGS84)throw new b.Z("knowledge-graph:layer-support-utils","The extentToInBoundsRings function only supports WGS84 spatial references.");return e.clone().normalize().map(e=>[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]])}async function C(e,t){let r=[],n=new Map,i=[];if(t.dataModel?.relationshipTypes)for(let e of t.dataModel.relationshipTypes)e.name&&n.set(e.name,[]);for(let t of e)n.has(t.typeName)&&n.get(t.typeName)?.push(t.id);for(let[e,o]of n){if(o.length<1)continue;let n=new _.Z({openCypherQuery:`MATCH (n)-[r:${e}]->(m) WHERE id(r) in $ids RETURN id(n), labels(n)[0], id(m), labels(m)[0]`,bindParameters:{ids:o}});i.push((0,T.executeQueryStreaming)(t,n).then(async e=>{let t=e.resultRowsStream.getReader();for(;;){let{done:e,value:n}=await t.read();if(e)break;for(let e of n)r.push({id:e[0],typeName:e[1]}),r.push({id:e[2],typeName:e[3]})}}))}return await Promise.all(i),r}async function E(e,t){let r={generateAllSublayers:t??=!1,namedTypeDefinitions:new Map};return await D(e).then(e=>{(function(e,t){for(let[r,n]of e){let e=(0,w.s1)(t.namedTypeDefinitions,r,()=>({useAllData:!1,members:new Map}));for(let t of n)e.members.has(t)||e.members.set(t,{id:t})}})(e,r)}),r}async function N(e){let t=await (0,v.$G)(),r=new t.MapOfObjectIdentifierSets;!function(e,t,r){for(let[n,i]of r.namedTypeDefinitions){if(!i.members||i.useAllData)continue;let r=i.members.keys(),o=new t.GlobalIdArray,s=new t.ObjectIdentifierSet;for(let e of r)o.add_globalid(e);s.set_globalid_array(o),o.delete(),e.put_identifier_set(n,s),s.delete()}}(r,t,e);let n=new t.MapOfObjectIdentifierSetsEncoder;try{n.set_map_of_identifier_sets(r),n.encode();let e=n.get_encoding_result();if(0!==e.error.error_code)throw new b.Z("knowledge-graph:layer-support-utils",e.error.error_message);let t=structuredClone(e.get_byte_buffer());return n.delete(),t}finally{r.delete()}}async function D(e){let t=await (0,g.Z)(e,{responseType:"array-buffer"});return S(new Uint8Array(await t.data))}async function S(e){let t=new(await (0,v.$G)()).MapOfObjectIdentifierSetsDecoder,r=t.decode(new Uint8Array(e)),n=new Map;if(0!==r.error_code)throw new b.Z("knowledge-graph:layer-support-utils",r.error_message);let i=t.get_map_of_identifier_sets(),o=i.keys,s=o.size();for(let e=0;e<s;e++){let t=o.get(e),r=i.query_identifier_set(t),s=[];if(r.id_array_type.value===m.GLOBALID_ARRAY){let e=r.get_globalid_array(),t=e.count();for(let r=0;r<t;r++)s.push(e.get_globalid_at(r))}else{if(r.id_array_type.value!==m.IDENTIFIER_ARRAY)throw new b.Z("knowledge-graph:layer-support-utils","Tried to encode an unexpected ID Array type.");{let e=r.get_identifier_array(),t=e.count();for(let r=0;r<t;r++)s.push(e.get_identifier_at(r).toString())}}n.set(t,s)}return t.delete(),n}r(37333),(s=h||(h={}))[s.featureResult=0]="featureResult",s[s.countResult=1]="countResult",s[s.idsResult=2]="idsResult",(a=c||(c={}))[a.upperLeft=0]="upperLeft",a[a.lowerLeft=1]="lowerLeft",(l=f||(f={}))[l.sqlTypeBigInt=0]="sqlTypeBigInt",l[l.sqlTypeBinary=1]="sqlTypeBinary",l[l.sqlTypeBit=2]="sqlTypeBit",l[l.sqlTypeChar=3]="sqlTypeChar",l[l.sqlTypeDate=4]="sqlTypeDate",l[l.sqlTypeDecimal=5]="sqlTypeDecimal",l[l.sqlTypeDouble=6]="sqlTypeDouble",l[l.sqlTypeFloat=7]="sqlTypeFloat",l[l.sqlTypeGeometry=8]="sqlTypeGeometry",l[l.sqlTypeGUID=9]="sqlTypeGUID",l[l.sqlTypeInteger=10]="sqlTypeInteger",l[l.sqlTypeLongNVarchar=11]="sqlTypeLongNVarchar",l[l.sqlTypeLongVarbinary=12]="sqlTypeLongVarbinary",l[l.sqlTypeLongVarchar=13]="sqlTypeLongVarchar",l[l.sqlTypeNChar=14]="sqlTypeNChar",l[l.sqlTypeNVarChar=15]="sqlTypeNVarChar",l[l.sqlTypeOther=16]="sqlTypeOther",l[l.sqlTypeReal=17]="sqlTypeReal",l[l.sqlTypeSmallInt=18]="sqlTypeSmallInt",l[l.sqlTypeSqlXml=19]="sqlTypeSqlXml",l[l.sqlTypeTime=20]="sqlTypeTime",l[l.sqlTypeTimestamp=21]="sqlTypeTimestamp",l[l.sqlTypeTimestamp2=22]="sqlTypeTimestamp2",l[l.sqlTypeTinyInt=23]="sqlTypeTinyInt",l[l.sqlTypeVarbinary=24]="sqlTypeVarbinary",l[l.sqlTypeVarchar=25]="sqlTypeVarchar",(p=m||(m={}))[p.OID_ARRAY=0]="OID_ARRAY",p[p.GLOBALID_ARRAY=1]="GLOBALID_ARRAY",p[p.STRING_ARRAY=2]="STRING_ARRAY",p[p.IDENTIFIER_ARRAY=3]="IDENTIFIER_ARRAY"},20561:function(e,t,r){r.d(t,{c:function(){return p},l:function(){return l}});var n=r(86641),i=r(49119),o=r(89312);r(37180),r(65223),r(3457);var s=r(64186),a=r(41007);let l={type:[a.Z],json:{origins:{"web-scene":{write:!1,read:!1}},name:"layerDefinition.orderBy",read:{reader:function(e,t,r){if(!e)return null;let n=e.find(e=>!!e.field);if(!n)return null;let i=new a.Z;return i.read(n,r),[i]}},write:{writer:function(e,t,r,n){let o=e.find(e=>!!e.field);o&&(0,i.RB)(r,[o.toJSON()],t)}}}},p=e=>{let t=class extends e{constructor(){super(...arguments),this.orderBy=null}};return(0,n._)([(0,o.Cb)(l)],t.prototype,"orderBy",void 0),t=(0,n._)([(0,s.j)("esri.layers.mixins.OrderedLayer")],t)}},3482:function(e,t,r){r.d(t,{Q:function(){return g}});var n=r(86641);r(37180);var i=r(65223),o=r(31124),s=r(89312),a=r(1275);r(3457);var l=r(64186),p=r(57111),u=r(50973);r(27817),r(94605),r(22926);var d=r(19164);let y=new u.Z,h=new WeakMap,c=0,f=0;function m(){let e=Date.now(),t=!1;for(let r of y){let n=r.deref();n?n.refreshInterval&&e-(h.get(n)??0)+5>=6e4*n.refreshInterval&&(h.set(n,e),n.refresh(e)):t=!0}if(t)for(let e=y.length-1;e>=0;e--)y.at(e).deref()||y.removeAt(e)}(0,d.EH)(()=>{let e=Date.now(),t=0;for(let r of y){let n=r.deref();n&&(t=function e(t,r){return Number.isFinite(t)&&Number.isFinite(r)?r<=0?t:e(r,t%r):0}(Math.round(6e4*n.refreshInterval),t),n.refreshInterval?h.get(n)||h.set(n,e):h.delete(n))}if(t!==f){if(f=t,clearInterval(c),0===f)return void(c=0);c=setInterval(m,f)}});let g=e=>{let t=class extends e{constructor(...e){super(...e),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=(0,o.Ds)(()=>this.hasDataChanged()),this.when().then(()=>{this.destroyed||null!=this&&"object"==typeof this&&"refreshInterval"in this&&"refresh"in this&&y.push(new WeakRef(this))},()=>{})}destroy(){!function(e){let t=y.find(t=>t.deref()===e);t&&y.remove(t)}(this)}castRefreshInterval(e){return e>=.1?e:e<=0?0:.1}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(e=Date.now()){(0,o.R8)(this._debounceHasDataChanged()).then(t=>{t&&this._set("refreshTimestamp",e),this.emit("refresh",{dataChanged:t})},e=>{i.Z.getLogger(this).error(e),this.emit("refresh",{dataChanged:!1,error:e})})}async hasDataChanged(){return!0}get test(){}};return(0,n._)([(0,s.Cb)({type:Number,json:{write:!0,origins:{"web-scene":{write:{enabled:!0,layerContainerTypes:p.C}}}}})],t.prototype,"refreshInterval",void 0),(0,n._)([(0,a.p)("refreshInterval")],t.prototype,"castRefreshInterval",null),(0,n._)([(0,s.Cb)({readOnly:!0})],t.prototype,"refreshTimestamp",void 0),(0,n._)([(0,s.Cb)({readOnly:!0})],t.prototype,"refreshParameters",null),t=(0,n._)([(0,l.j)("esri.layers.mixins.RefreshableLayer")],t)}},41007:function(e,t,r){r.d(t,{Z:function(){return d}});var n,i=r(86641),o=r(740),s=r(689),a=r(89312);r(37180),r(65223),r(3457);var l=r(64186);let p=new o.X({asc:"ascending",desc:"descending"}),u=n=class extends s.wq{constructor(e){super(e),this.field=null,this.valueExpression=null,this.order="ascending"}clone(){return new n({field:this.field,valueExpression:this.valueExpression,order:this.order})}};(0,i._)([(0,a.Cb)({type:String,json:{write:!0}})],u.prototype,"field",void 0),(0,i._)([(0,a.Cb)({type:String,json:{write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],u.prototype,"valueExpression",void 0),(0,i._)([(0,a.Cb)({type:p.apiValues,json:{type:p.jsonValues,read:p.read,write:p.write}})],u.prototype,"order",void 0);let d=u=n=(0,i._)([(0,l.j)("esri.layers.support.OrderByInfo")],u)},18240:function(e,t,r){r.d(t,{Z:function(){return p}});var n=r(86641);r(55066);var i=r(89312);r(37180),r(65223),r(3457);var o=r(64186),s=r(52019),a=r(33876);let l=class extends s.Z{constructor(e){super(e),this.layoutGeometry=null}};(0,n._)([(0,i.Cb)({type:a.Z,json:{write:!0}})],l.prototype,"layoutGeometry",void 0);let p=l=(0,n._)([(0,o.j)("esri.rest.knowledgeGraph.Entity")],l)},52019:function(e,t,r){r.d(t,{Z:function(){return l}});var n=r(86641),i=r(89312);r(37180),r(65223),r(3457);var o=r(64186),s=r(19847);let a=class extends s.Z{constructor(e){super(e),this.typeName=null,this.id=null}};(0,n._)([(0,i.Cb)({type:String,json:{write:!0}})],a.prototype,"typeName",void 0),(0,n._)([(0,i.Cb)({type:String,json:{write:!0}})],a.prototype,"id",void 0);let l=a=(0,n._)([(0,o.j)("esri.rest.knowledgeGraph.GraphNamedObject")],a)},19847:function(e,t,r){r.d(t,{Z:function(){return l}});var n=r(86641),i=r(689),o=r(89312);r(37180),r(65223),r(3457);var s=r(64186);let a=class extends i.wq{constructor(e){super(e),this.properties=null}};(0,n._)([(0,o.Cb)({json:{write:!0}})],a.prototype,"properties",void 0);let l=a=(0,n._)([(0,s.j)("esri.rest.knowledgeGraph.GraphObject")],a)},17904:function(e,t,r){r.d(t,{Z:function(){return u}});var n=r(86641),i=r(89312);r(37180),r(65223),r(3457);var o=r(64186),s=r(94761);let a=class extends s.Z{constructor(e){super(e),this.openCypherQuery=""}};(0,n._)([(0,i.Cb)()],a.prototype,"openCypherQuery",void 0);let l=a=(0,n._)([(0,o.j)("esri.rest.knowledgeGraph.GraphQuery")],a),p=class extends l{constructor(e){super(e),this.bindParameters=null,this.bindGeometryQuantizationParameters=null,this.outputQuantizationParameters=null,this.outputSpatialReference=null,this.provenanceBehavior=null}};(0,n._)([(0,i.Cb)()],p.prototype,"bindParameters",void 0),(0,n._)([(0,i.Cb)()],p.prototype,"bindGeometryQuantizationParameters",void 0),(0,n._)([(0,i.Cb)()],p.prototype,"outputQuantizationParameters",void 0),(0,n._)([(0,i.Cb)()],p.prototype,"outputSpatialReference",void 0),(0,n._)([(0,i.Cb)()],p.prototype,"provenanceBehavior",void 0);let u=p=(0,n._)([(0,o.j)("esri.rest.knowledgeGraph.GraphQueryStreaming")],p)},34083:function(e,t,r){r.d(t,{Z:function(){return a}});var n=r(86641);r(65223),r(37180),r(3457),r(94605);var i=r(64186),o=r(19847);let s=class extends o.Z{constructor(e){super(e)}},a=s=(0,n._)([(0,i.j)("esri.rest.knowledgeGraph.ObjectValue")],s)},40480:function(e,t,r){r.d(t,{Z:function(){return p}});var n=r(86641),i=r(689),o=r(89312);r(37180),r(65223),r(3457);var s=r(64186),a=r(19847);let l=class extends i.wq{constructor(e){super(e),this.path=null}};(0,n._)([(0,o.Cb)({type:[a.Z],json:{write:!0}})],l.prototype,"path",void 0);let p=l=(0,n._)([(0,s.j)("esri.rest.knowledgeGraph.Path")],l)},69038:function(e,t,r){r.d(t,{Z:function(){return p}});var n=r(86641);r(55066);var i=r(89312);r(37180),r(65223),r(3457);var o=r(64186),s=r(52019),a=r(58144);let l=class extends s.Z{constructor(e){super(e),this.originId=null,this.destinationId=null,this.layoutGeometry=null}};(0,n._)([(0,i.Cb)({type:String,json:{write:!0}})],l.prototype,"originId",void 0),(0,n._)([(0,i.Cb)({type:String,json:{write:!0}})],l.prototype,"destinationId",void 0),(0,n._)([(0,i.Cb)({type:a.Z,json:{write:!0}})],l.prototype,"layoutGeometry",void 0);let p=l=(0,n._)([(0,o.j)("esri.rest.knowledgeGraph.Relationship")],l)},9158:function(e,t,r){r.d(t,{Z:function(){return w}});var n,i=r(86641),o=r(55066),s=r(19637),a=r(740),l=r(689),p=r(61764),u=r(89312);r(37180),r(65223);var d=r(37647),y=r(64186),h=r(50713),c=r(36502),f=r(5005),m=r(40041);let g=new a.X({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null}),b=n=class extends l.wq{constructor(e){super(e),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(e,t){let r=c.Z.fromJSON(t.spatialReference),n=[];for(let t=0;t<e.length;t++){let i=e[t],o=s.Z.fromJSON(i),a=i.geometry?.spatialReference;null==o.geometry||a||(o.geometry.spatialReference=r);let l=i.aggregateGeometries,p=o.aggregateGeometries;if(l&&null!=p)for(let e in p){let t=p[e],n=l[e],i=n?.spatialReference;null==t||i||(t.spatialReference=r)}n.push(o)}return n}writeGeometryType(e,t,r,n){if(e)return void g.write(e,t,r,n);let{features:i}=this;if(i){for(let e of i)if(null!=e?.geometry)return void g.write(e.geometry.type,t,r,n)}}readQueryGeometry(e,t){if(!e)return null;let r=!!e.spatialReference,n=(0,f.im)(e);return n&&!r&&t.spatialReference&&(n.spatialReference=c.Z.fromJSON(t.spatialReference)),n}writeSpatialReference(e,t){if(e)return void(t.spatialReference=e.toJSON());let{features:r}=this;if(r){for(let e of r)if(e&&null!=e.geometry&&e.geometry.spatialReference)return void(t.spatialReference=e.geometry.spatialReference.toJSON())}}clone(){return new n(this.cloneProperties())}cloneProperties(){return(0,p.d9)({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}toJSON(e){let t=this.write();if(t.features&&Array.isArray(e)&&e.length>0)for(let r=0;r<t.features.length;r++){let n=t.features[r];if(n.geometry){let t=e?.[r];n.geometry=t?.toJSON()||n.geometry}}return t}quantize(e){let{scale:[t,r],translate:[n,i]}=e,o=this.features,s=this._getQuantizationFunction(this.geometryType,e=>Math.round((e-n)/t),e=>Math.round((i-e)/r));for(let e=0,t=o.length;e<t;e++)s?.(o[e].geometry)||(o.splice(e,1),e--,t--);return this.transform=e,this}unquantize(){let{geometryType:e,features:t,transform:r}=this;if(!r)return this;let{translate:[n,i],scale:[o,s]}=r,a=null,l=null;if(this.hasZ&&null!=r?.scale?.[2]){let{translate:[,,e],scale:[,,t]}=r;a=r=>r*t+e}if(this.hasM&&null!=r?.scale?.[3]){let{translate:[,,,e],scale:[,,,t]}=r;l=r=>null==r?r:r*t+e}let p=this._getHydrationFunction(e,e=>e*o+n,e=>i-e*s,a,l);for(let{geometry:e}of t)null!=e&&p&&p(e);return this.transform=null,this}_quantizePoints(e,t,r){let n,i;let o=[];for(let s=0,a=e.length;s<a;s++){let a=e[s];if(s>0){let e=t(a[0]),s=r(a[1]);e===n&&s===i||(o.push([e-n,s-i]),n=e,i=s)}else n=t(a[0]),i=r(a[1]),o.push([n,i])}return o.length>0?o:null}_getQuantizationFunction(e,t,r){return"point"===e?e=>(e.x=t(e.x),e.y=r(e.y),e):"polyline"===e||"polygon"===e?e=>{let n=(0,f.oU)(e)?e.rings:e.paths,i=[];for(let e=0,o=n.length;e<o;e++){let o=n[e],s=this._quantizePoints(o,t,r);s&&i.push(s)}return i.length>0?((0,f.oU)(e)?e.rings=i:e.paths=i,e):null}:"multipoint"===e?e=>{let n=this._quantizePoints(e.points,t,r);return n&&n.length>0?(e.points=n,e):null}:"extent"===e?e=>e:null}_getHydrationFunction(e,t,r,n,i){return"point"===e?e=>{e.x=t(e.x),e.y=r(e.y),n&&(e.z=n(e.z))}:"polyline"===e||"polygon"===e?e=>{let o,s;let a=(0,f.oU)(e)?e.rings:e.paths;for(let e=0,n=a.length;e<n;e++){let n=a[e];for(let e=0,i=n.length;e<i;e++){let i=n[e];e>0?(o+=i[0],s+=i[1]):(o=i[0],s=i[1]),i[0]=t(o),i[1]=r(s)}}if(n&&i)for(let e=0,t=a.length;e<t;e++){let t=a[e];for(let e=0,r=t.length;e<r;e++){let r=t[e];r[2]=n(r[2]),r[3]=i(r[3])}}else if(n)for(let e=0,t=a.length;e<t;e++){let t=a[e];for(let e=0,r=t.length;e<r;e++){let r=t[e];r[2]=n(r[2])}}else if(i)for(let e=0,t=a.length;e<t;e++){let t=a[e];for(let e=0,r=t.length;e<r;e++){let r=t[e];r[2]=i(r[2])}}}:"extent"===e?e=>{e.xmin=t(e.xmin),e.ymin=r(e.ymin),e.xmax=t(e.xmax),e.ymax=r(e.ymax),n&&null!=e.zmax&&null!=e.zmin&&(e.zmax=n(e.zmax),e.zmin=n(e.zmin)),i&&null!=e.mmax&&null!=e.mmin&&(e.mmax=i(e.mmax),e.mmin=i(e.mmin))}:"multipoint"===e?e=>{let o,s;let a=e.points;for(let e=0,n=a.length;e<n;e++){let n=a[e];e>0?(o+=n[0],s+=n[1]):(o=n[0],s=n[1]),n[0]=t(o),n[1]=r(s)}if(n&&i)for(let e=0,t=a.length;e<t;e++){let t=a[e];t[2]=n(t[2]),t[3]=i(t[3])}else if(n)for(let e=0,t=a.length;e<t;e++){let t=a[e];t[2]=n(t[2])}else if(i)for(let e=0,t=a.length;e<t;e++){let t=a[e];t[2]=i(t[2])}}:null}};(0,i._)([(0,u.Cb)({type:String,json:{write:!0}})],b.prototype,"displayFieldName",void 0),(0,i._)([(0,u.Cb)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],b.prototype,"exceededTransferLimit",void 0),(0,i._)([(0,u.Cb)({type:[s.Z],json:{write:!0}})],b.prototype,"features",void 0),(0,i._)([(0,d.r)("features")],b.prototype,"readFeatures",null),(0,i._)([(0,u.Cb)({type:[m.Z],json:{write:!0}})],b.prototype,"fields",void 0),(0,i._)([(0,u.Cb)({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:g.read}}})],b.prototype,"geometryType",void 0),(0,i._)([(0,h.c)("geometryType")],b.prototype,"writeGeometryType",null),(0,i._)([(0,u.Cb)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],b.prototype,"hasM",void 0),(0,i._)([(0,u.Cb)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],b.prototype,"hasZ",void 0),(0,i._)([(0,u.Cb)({types:o.qM,json:{write:!0}})],b.prototype,"queryGeometry",void 0),(0,i._)([(0,d.r)("queryGeometry")],b.prototype,"readQueryGeometry",null),(0,i._)([(0,u.Cb)({type:c.Z,json:{write:!0}})],b.prototype,"spatialReference",void 0),(0,i._)([(0,h.c)("spatialReference")],b.prototype,"writeSpatialReference",null),(0,i._)([(0,u.Cb)({json:{write:!0}})],b.prototype,"transform",void 0),(b=n=(0,i._)([(0,y.j)("esri.rest.support.FeatureSet")],b)).prototype.toJSON.isDefaultToJSON=!0;let w=b}}]);