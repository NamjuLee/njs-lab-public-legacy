(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[91941],{15510:function(t){function e(t){return Promise.resolve().then(function(){var e=Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e})}e.keys=function(){return[]},e.resolve=e,e.id=15510,t.exports=e},75410:function(){},48628:function(){},31601:function(){},67792:function(){},34977:function(){},75042:function(){},47757:function(t,e,a){"use strict";a.r(e),a.d(e,{NFaceCam:function(){return d}});var i=a(88405),n=a(14962),l=a(71755),s=a(45169),o=a(30647);let h=0,c=[];class d{async init(t,e,a,i){await m(t,e,a,i,this.mobile,this.VIDEO_SIZE,this.imgSmaile,this.imgHairband,this.imgSunglass,this.renderMode)}initUI(){let t=document.createElement("input");t.type="range",t.min="0",t.max="467",t.step="1",t.value="0",t.style.width="300px",t.oninput=()=>{h=+t.value,a.textContent=t.value},this.host.append(t);let e=document.createElement("input");e.type="range",e.min="0",e.max="5",e.step="1",e.value="0",e.style.width="300px",e.oninput=()=>{p=+e.value},this.host.append(e);let a=document.createElement("div");a.textContent="0",this.host.append(a);let i=document.createElement("div");i.style.width="50px",i.style.height="50px",i.style.background="#000000",this.host.append(i),c.push(i),(i=document.createElement("div")).style.width="50px",i.style.height="50px",i.style.background="#000000",this.host.append(i),c.push(i),(i=document.createElement("div")).style.width="50px",i.style.height="50px",i.style.background="#000000",this.host.append(i),c.push(i)}constructor(t){this.mobile=!1,this.VIDEO_SIZE=400,this.renderMode=0,this.mobile=(0,o.isMobile)(),this.host=document.getElementById(t);let e=document.createElement("div");e.style.display="flex",this.host.append(e);let a=document.createElement("video");e.append(a),a.id="video";let i=document.createElement("canvas");e.append(i),i.width=this.VIDEO_SIZE,i.height=this.VIDEO_SIZE,i.id="canvas-out";let n=i.getContext("2d"),l=document.createElement("div");l.style.display="flex",this.host.append(l);let h=document.createElement("canvas");l.append(h);let c=h.getContext("2d"),d=document.createElement("div");d.style.width=this.VIDEO_SIZE+"px",d.style.height=this.VIDEO_SIZE+"px",l.append(d),(0,s.getImgFromURL)("https://raw.githubusercontent.com/NamjuLee/data/master/img/smile.png").then(t=>{t&&(this.imgSmaile=t,(0,s.getImgFromURL)("https://raw.githubusercontent.com/NamjuLee/data/master/img/hair%20band.png").then(t=>{t&&(this.imgHairband=t,(0,s.getImgFromURL)("https://raw.githubusercontent.com/NamjuLee/data/master/img/sunglass.png").then(t=>{t&&(this.imgSunglass=t,this.init(d,c,n,a))}))}))}),this.initUI()}}let r=!1,g=[[0,0],[0,0],[0,0]],m=async function(t,e,a,s,h,c,d,r,g){let m,p=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;console.log(i.setBackend),await i.setBackend("webgl"),m=new l.cq(t,{rotateOnStart:!1,selectEnabled:!1}),console.log(),await (0,o.setupCamera)(s,h,c),s.play(),s.width=s.videoWidth,s.height=s.videoHeight,e.canvas.width=s.videoWidth,e.canvas.height=s.videoHeight,e.canvas.style.width=s.videoWidth+"px",e.canvas.style.height=s.videoHeight+"px",e.fillStyle="#32EEDB",e.strokeStyle="rgba(0, 200, 200, 0.35)",e.lineWidth=.5;let f=await n.z({maxFaces:200});console.log(f),u(f,e,a,s,m,d,r,g,p)},p=0,u=async function(t,e,a,i,n,s,d,m){let v=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,I=await t.estimateFaces(i);if(I[0]&&(e.drawImage(i,0,0,i.videoWidth,i.videoHeight,0,0,e.canvas.width,e.canvas.height),a.drawImage(i,0,0,i.videoWidth,i.videoHeight,0,0,e.canvas.width,e.canvas.height),I.length>0&&(I.forEach(t=>{let i=t.scaledMesh,n=[50,280,8];for(let t=0;t<n.length;++t){let a=i[n[t]][0],l=i[n[t]][1],s=e.getImageData(a,l,1,1);c[t].style.background="rgba(".concat(s.data[0],", ").concat(s.data[1],", ").concat(s.data[2],", ").concat(s.data[3],")")}e.getImageData(0,0,1,1),e.beginPath(),e.arc(0,0,30,0,6.28),e.stroke();{for(let t=0;t<i.length;t++){let a=i[t][0],n=i[t][1];e.beginPath(),e.arc(a,n,1,0,2*Math.PI),e.fill(),e.strokeStyle="#000000",e.font="12px Arial",e.strokeText("".concat(t),a-10,n-2)}let t=[50,280,8];e.fillStyle="#ff0000";for(let a=0;a<t.length;++a){let n=i[t[a]][0],l=i[t[a]][1];e.beginPath(),e.arc(n,l,4,0,2*Math.PI),e.fill(),g[a][0]=n,g[a][1]=l}let a=i[h][0],n=i[h][1];e.beginPath(),e.arc(a,n,4,0,2*Math.PI),e.fill(),e.fillStyle="#32EEDB"}a.fillStyle="#ff0000";let l=i[159][0],r=i[145][1]+(i[159][1]-i[145][1])*.5;0===p&&(a.beginPath(),a.arc(l,r,10,0,2*Math.PI),a.fill());let u=i[386][0],v=i[374][1]+(i[386][1]-i[374][1])*.5;0===p&&(a.beginPath(),a.arc(u,v,10,0,2*Math.PI),a.fill());let I=i[13][0],y=i[13][1]+(i[14][1]-i[13][1])*.5;0===p&&(a.beginPath(),a.arc(I,y,10,0,2*Math.PI),a.fill());let E=f(l,r,u,v);a.save(),a.translate(I,y-(y-v)*.6),a.rotate(-E-.5*Math.PI),a.scale((u-l)/130,(r-y)/130),void 0!==s&&(1===p?a.drawImage(s,-150,-150):2===p?a.drawImage(d,-(.5*d.width),-250):3===p?a.drawImage(m,-(.5*m.width),-263):4===p&&(a.globalCompositeOperation="xor",a.filter="blur(".concat(10,"px)"),a.ellipse(0,0,150,150,0,0,2*Math.PI),a.fillStyle="#fff",a.fill(),a.filter="none",a.globalCompositeOperation="source-over")),a.lineWidth=2,a.strokeStyle="#0f0",a.beginPath(),a.rect(-150,-150,300,300),a.closePath(),0===p&&a.stroke(),a.beginPath(),a.arc(0,0,100,0,2*Math.PI),0===p&&a.stroke(),a.restore();for(let t=0;t<o.TRIANGULATION.length/3;t++){[o.TRIANGULATION[3*t],o.TRIANGULATION[3*t+1],o.TRIANGULATION[3*t+2]].map(t=>i[t]);let n=[50,280,8];e.fillStyle="#ff0000";for(let t=0;t<n.length;++t){let e=i[n[t]][0],l=i[n[t]][1];a.beginPath(),a.arc(e,l,4,0,2*Math.PI)}}}),void 0!==n))){let t=I.map(t=>t.scaledMesh.map(t=>[-t[0],-t[1],-t[2]])),e=[];for(let a=0;a<t.length;a++)e=e.concat(t[a]);let a=new l.cq.Dataset(e);r?n.updateDataset(a):n.render(a),r=!0}requestAnimationFrame(()=>u(t,e,a,i,n,s,d,m,v))},f=(t,e,a,i)=>Math.atan2(a-t,i-e)}}]);