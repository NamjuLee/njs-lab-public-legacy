(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[24390],{15510:function(t){function e(t){return Promise.resolve().then(function(){var e=Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e})}e.keys=function(){return[]},e.resolve=e,e.id=15510,t.exports=e},75410:function(){},48628:function(){},31601:function(){},67792:function(){},34977:function(){},75042:function(){},21322:function(t,e,i){"use strict";i.d(e,{P:function(){return o}});var s=i(88405);class o{predict1d(t){return t.mul(this.weights[0]).add(this.bias)}predict2d(t){return t.square().mul(this.weights[1]).add(t.mul(this.weights[0])).add(this.bias)}predict3d(t){return t.pow(s.scalar(3)).mul(this.weights[2]).add(t.square().mul(this.weights[1])).add(t.mul(this.weights[0])).add(this.bias)}predict4d(t){return t.pow(s.scalar(4)).mul(this.weights[3]).add(t.pow(s.scalar(3)).mul(this.weights[2])).add(t.square().mul(this.weights[1])).add(t.mul(this.weights[0])).add(this.bias)}predict5d(t){return t.pow(s.scalar(5)).mul(this.weights[4]).add(t.pow(s.scalar(4)).mul(this.weights[3])).add(t.pow(s.scalar(3)).mul(this.weights[2])).add(t.square().mul(this.weights[1])).add(t.mul(this.weights[0])).add(this.bias)}predict(t){return 5===this.dim?this.predict5d(t):4===this.dim?this.predict4d(t):3===this.dim?this.predict3d(t):2===this.dim?this.predict2d(t):(this.dim,this.predict1d(t))}loss(t,e){return t.sub(e).square().mean()}train(t,e){s.tidy(()=>{let i=s.tensor1d(t),o=s.tensor1d(e);this.optimizer.minimize(()=>this.loss(this.predict(i),o))})}constructor(t=0){this.weights=[],this.dim=3,this.leraningRate=.2,this.dim=t;for(let t=0;t<5;++t){let t=s.variable(s.scalar(2*Math.random()-1));t.print(),this.weights.push(t)}this.bias=s.variable(s.scalar(2*Math.random()-1)),this.optimizer=s.train.adam(this.leraningRate)}}},88876:function(t,e,i){"use strict";i.d(e,{NJSCORE:function(){return r},PolynomialRegression:function(){return n.P},RendererThree:function(){return s.T}});var s=i(14540),o=i(45169);i.o(o,"AStart")&&i.d(e,{AStart:function(){return o.AStart}}),i.o(o,"COLOR_BLENDING")&&i.d(e,{COLOR_BLENDING:function(){return o.COLOR_BLENDING}}),i.o(o,"Graph")&&i.d(e,{Graph:function(){return o.Graph}}),i.o(o,"KNN")&&i.d(e,{KNN:function(){return o.KNN}}),i.o(o,"LinearRegression")&&i.d(e,{LinearRegression:function(){return o.LinearRegression}}),i.o(o,"LinearRegressionGradientDescent")&&i.d(e,{LinearRegressionGradientDescent:function(){return o.LinearRegressionGradientDescent}}),i.o(o,"MercatorProjection")&&i.d(e,{MercatorProjection:function(){return o.MercatorProjection}}),i.o(o,"PolynomialRegression")&&i.d(e,{PolynomialRegression:function(){return o.PolynomialRegression}}),i.o(o,"RGBtoGray")&&i.d(e,{RGBtoGray:function(){return o.RGBtoGray}}),i.o(o,"RendererCanvas")&&i.d(e,{RendererCanvas:function(){return o.RendererCanvas}}),i.o(o,"RendererJSAPI")&&i.d(e,{RendererJSAPI:function(){return o.RendererJSAPI}}),i.o(o,"TypeDithering")&&i.d(e,{TypeDithering:function(){return o.TypeDithering}}),i.o(o,"Vector3")&&i.d(e,{Vector3:function(){return o.Vector3}}),i.o(o,"buildNetwork")&&i.d(e,{buildNetwork:function(){return o.buildNetwork}}),i.o(o,"crossProduct")&&i.d(e,{crossProduct:function(){return o.crossProduct}}),i.o(o,"deepCopy")&&i.d(e,{deepCopy:function(){return o.deepCopy}}),i.o(o,"distanceEuclidean")&&i.d(e,{distanceEuclidean:function(){return o.distanceEuclidean}}),i.o(o,"distanceTo")&&i.d(e,{distanceTo:function(){return o.distanceTo}}),i.o(o,"dithering4_4")&&i.d(e,{dithering4_4:function(){return o.dithering4_4}}),i.o(o,"ditheringFloydSteinberg")&&i.d(e,{ditheringFloydSteinberg:function(){return o.ditheringFloydSteinberg}}),i.o(o,"getArrayBinaryImgFromCtx")&&i.d(e,{getArrayBinaryImgFromCtx:function(){return o.getArrayBinaryImgFromCtx}}),i.o(o,"getCSVFromURL")&&i.d(e,{getCSVFromURL:function(){return o.getCSVFromURL}}),i.o(o,"getCheckBox")&&i.d(e,{getCheckBox:function(){return o.getCheckBox}}),i.o(o,"getImgFromURL")&&i.d(e,{getImgFromURL:function(){return o.getImgFromURL}}),i.o(o,"getJSONFromURL")&&i.d(e,{getJSONFromURL:function(){return o.getJSONFromURL}}),i.o(o,"getLineSeg")&&i.d(e,{getLineSeg:function(){return o.getLineSeg}}),i.o(o,"getRandomHex")&&i.d(e,{getRandomHex:function(){return o.getRandomHex}}),i.o(o,"getSlider")&&i.d(e,{getSlider:function(){return o.getSlider}}),i.o(o,"getUUID")&&i.d(e,{getUUID:function(){return o.getUUID}}),i.o(o,"hex2RGBA")&&i.d(e,{hex2RGBA:function(){return o.hex2RGBA}}),i.o(o,"isInsideOfVecs")&&i.d(e,{isInsideOfVecs:function(){return o.isInsideOfVecs}}),i.o(o,"normalize")&&i.d(e,{normalize:function(){return o.normalize}}),i.o(o,"reflect")&&i.d(e,{reflect:function(){return o.reflect}}),i.o(o,"remap")&&i.d(e,{remap:function(){return o.remap}}),i.o(o,"shuffleArray")&&i.d(e,{shuffleArray:function(){return o.shuffleArray}});var n=i(21322),r=i(8483)},14540:function(t,e,i){"use strict";i.d(e,{T:function(){return n}});var s=i(97776),o=i(78252);class n{initCanvas(){this.scene=new s.xsS,this.scene.background=new s.Ilk(0),this.scene.castShadow=!0,this.renderer=new s.CP7({antialias:!0,alpha:!0}),this.renderer.setPixelRatio(this.hostDiv.clientWidth/this.hostDiv.clientHeight),this.renderer.domElement.id="Three",this.renderer.domElement.style.position="absolute",this.renderer.shadowMap.enabled=!0,this.renderer.setSize(this.hostDiv.clientWidth,this.hostDiv.clientHeight),this.hostDiv.appendChild(this.renderer.domElement),this.camera=new s.cPb(30,this.hostDiv.clientWidth/this.hostDiv.clientHeight,1,5e3),this.controls=new o.OrbitControls(this.camera,this.renderer.domElement),this.camera.position.set(0,0,5),this.controls.update(),this.canvas=this.renderer.domElement,this.init()}init(){this.eventBind()}eventBind(){this.renderer.domElement.onmousedown=t=>this.mouseDown(t),this.renderer.domElement.onmouseup=t=>this.mouseUp(t),this.renderer.domElement.onmousemove=t=>this.mouseMove(t),this.renderer.domElement.addEventListener("click",t=>this.mouseClick(t)),window.addEventListener("resize",()=>this.onWindowResize())}onWindowResize(){this.camera.aspect=this.hostDiv.clientWidth/this.hostDiv.clientHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.hostDiv.clientWidth,this.hostDiv.clientHeight)}start(){this.loop()}mouseDown(t){}mouseUp(t){}mouseClick(t){}mouseDClick(t){}mouseMove(t){}mouseDrag(t){}update(t){}destroy(){for(window.removeEventListener("resize",()=>this.onWindowResize()),cancelAnimationFrame(this.requestFrame),this.requestFrame=void 0;this.hostDiv.lastChild;)this.hostDiv.removeChild(this.hostDiv.lastChild)}constructor(t){this.t=0,this.requestFrame=void 0,this.loop=()=>{this.requestFrame=requestAnimationFrame(this.loop),this.controls.update(),this.update(this.scene),this.renderer.render(this.scene,this.camera),this.t+=.01},this.hostDiv=document.getElementById(t),this.initCanvas()}}},98797:function(t,e,i){"use strict";i.d(e,{B:function(){return o}});var s=i(8483);class o{InitShader(){let t=s.Ui.CreateShader(this.gl,this.gl.VERTEX_SHADER,this.v),e=s.Ui.CreateShader(this.gl,this.gl.FRAGMENT_SHADER,this.f);if(t&&e){this.vShader=t,this.fShader=e;let i=s.Ui.CreateProgram(this.gl,t,e);i&&(this.program=i)}}Render(t){this.vertexs=new Float32Array([-1,-1,1,1,1,1,-1,1,.1,0,0,1,1,-1,.1,0,0,1,-1,1,1,1,1,1,1,-1,.1,0,0,1,1,1,.1,0,0,1]),this.posBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.posBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(this.vertexs),t.STATIC_DRAW),this.posLocAtt=this.gl.getAttribLocation(this.program,"a_position");let e=t.FLOAT,i=6*Float32Array.BYTES_PER_ELEMENT,s=0;t.vertexAttribPointer(this.posLocAtt,2,e,!1,i,s),t.enableVertexAttribArray(this.posLocAtt),t.useProgram(this.program);let o=t.TRIANGLES;s=0,t.drawArrays(o,s,6)}constructor(t,e=100,i=100,s=0,o=1,n=1,r=1){this.v="\n    attribute vec2 a_position;\n    attribute vec4 a_color;\n    \n    varying vec4 f_color;\n\n    void main() {\n\n        vec2 mouse_distance = vec2(0,0) - (a_position.xy /vec2(2,2));\n        float red = 1.0 - length(mouse_distance);\n        f_color = vec4(a_position, 0, 1.0);\n    \n        // float dis = distance(vec2(a_position.xy), vec2(0,0));\n\n        // f_color = vec4(dis * 0.6, 0,0,1);\n        gl_Position = vec4( a_position, 0, 1);\n    }\n    ",this.f="\n    precision highp float;\n\n    varying vec4 f_color;\n    \n    void main() {\n        vec2 mouse_distance = vec2(0,0) - (f_color.xy /vec2(5,5));\n\n        float col =  length(mouse_distance*5.);\n        float val = 1.0 - length(mouse_distance*8.);\n        \n        gl_FragColor = vec4(0.19,0.19,0.19, col);\n\n    }\n    ",this.gl=t,this.color=[Math.random(),Math.random(),Math.random(),1],this.InitShader()}}},29776:function(t,e,i){"use strict";i.r(e),i.d(e,{MercatorProjection:function(){return g},Solution:function(){return m}});var s=i(97776),o=i(88876),n=i(98797),r=i(45169);let a=void 0;class h{updateYear(t){if(this.selectedYear=t+1,void 0!==this.yearForPolygonMesh)for(let t=2010;t<2016;++t)this.yearForPolygonMesh[t].forEach(e=>{t<this.selectedYear?e.visible=!0:e.visible=!1})}updateColor(t){let e=(0,r.hexToRGBANormalized)(t);if(void 0!==this.meshMainStreet&&this.solution.ui.isActiveMainStreet){let t=this.meshMainStreet.material;t.color.r=e[0],t.color.g=e[1],t.color.b=e[2]}if(void 0!==this.meshStreetOSM&&this.solution.ui.isActive_streetOSM){let t=this.meshStreetOSM.material;t.color.r=e[0],t.color.g=e[1],t.color.b=e[2]}if(void 0!==this.meshTreated&&this.solution.ui.isActive_treated_st){let t=this.meshTreated.material;t.color.r=e[0],t.color.g=e[1],t.color.b=e[2]}if(void 0!==this.meshControl&&this.solution.ui.isActive_control_st){let t=this.meshControl.material;t.color.r=e[0],t.color.g=e[1],t.color.b=e[2]}void 0!==this.meshZones30&&this.solution.ui.isActive_zones_30&&this.meshZones30.forEach(t=>{let i=t.material;i.color.r=e[0],i.color.g=e[1],i.color.b=e[2]}),void 0!==this.solution.dataTwitter&&this.solution.ui.isActive_twitter&&this.solution.dataTwitter.updateColor(e[0],e[1],e[2])}update(){void 0!==this.meshMainStreet&&(this.solution.ui.isActiveMainStreet?this.meshMainStreet.visible=!0:this.meshMainStreet.visible=!1),void 0!==this.meshStreetOSM&&(this.solution.ui.isActive_streetOSM?this.meshStreetOSM.visible=!0:this.meshStreetOSM.visible=!1),void 0!==this.meshTreated&&(this.solution.ui.isActive_treated_st?this.meshTreated.visible=!0:this.meshTreated.visible=!1),void 0!==this.meshControl&&(this.solution.ui.isActive_control_st?this.meshControl.visible=!0:this.meshControl.visible=!1),void 0!==this.meshZones30&&(this.solution.ui.isActive_zones_30?this.meshZones30.forEach(t=>{t.visible=!0}):this.meshZones30.forEach(t=>{t.visible=!1})),void 0!==this.solution.dataTwitter.mesh&&(this.solution.ui.isActive_twitter?this.solution.dataTwitter.mesh.visible=!0:this.solution.dataTwitter.mesh.visible=!1)}renderCustomPolygon(t,e){let i={};for(let[e,s]of Object.entries(t.yr))s in i?i[s].push(+e):i[s]=[+e];let o={};this.polygonRingID=i;let n=0;for(let[i,a]of Object.entries(this.polygonRingID)){let h=[];for(let i=0;i<a.length;++i){let o=a[i];t.value_mn_rescale[o];let l=[];for(let e=0;e<t.outer_ring[o].length;++e){let[i,s]=this.solution.projectionToMercator(t.outer_ring[o][e][0],t.outer_ring[o][e][1]);l.push(new r.Vector3(i,s))}let c=new s.bnF(l);for(let e=0;e<t.inner_rings[o].length;++e){let i=new s.y$t,[n,r]=this.solution.projectionToMercator(t.inner_rings[o][e][0][0],t.inner_rings[o][e][0][1]);i.moveTo(n,r);for(let s=1;s<t.inner_rings[o][e].length;++s){let[n,r]=this.solution.projectionToMercator(t.inner_rings[o][e][s][0],t.inner_rings[o][e][s][1]);i.lineTo(n,r)}c.holes.push(i)}let d=new s.oa8(c),u=new s.Ilk(16777215);u.setRGB(e[0],e[1],e[2]);let m=new s.vBJ({side:s.ehD,color:u,transparent:!0,opacity:.85}),g=new s.Kj0(d,m);g.translateY(1e-4*n++),g.visible=!0,this.solution.scene.add(g),g.rotateOnAxis(new s.Pa4(1,0,0),.5*Math.PI),h.push(g)}o[i]=h}this.yearForPolygonMesh=o}LineSeg(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=new s.u9r,n=new s.nls;n.color.r=e[0],n.color.g=e[1],n.color.b=e[2];let r=[],a=[],h=[];for(let s=0;s<t.length;++s){let o=t[s];for(let t=0;t<o.length;++t)for(let s=0;s<o[t].length;++s){let[n,l]=this.solution.projectionToMercator(o[t][s][0],o[t][s][1]);r.push(n,i,l),a.push(e[0],e[1],e[2]),s<o[t].length-1&&h.push(Math.floor(r.length/3)-1,Math.floor(r.length/3))}}o.setIndex(h),o.setAttribute("position",new s.a$l(r,3)),o.setAttribute("color",new s.a$l(a,3)),o.computeBoundingSphere();let l=new s.ejS(o,n);return this.solution.scene.add(l),l}constructor(t){this.streetOSM=[],this.routesTreated=[],this.routesControl=[],this.zones30=[],this.zones15=[],this.routesMain=[],this.polygonRingID={},this.selectedYear=2009,this.renderMultiPolygon=(t,e,i)=>{let o=[],n=[];for(let r=0;r<e.length;++r){let a=e[r];for(let e=0;e<a.length;++e){let r=a[e];if(1===r.length){let e=r[0],a=[];for(let t=0;t<e.length;++t){let[i,o]=this.solution.projectionToMercator(e[t][0],e[t][1]);n.push(i,0,o),a.push(new s.FM8(i,o))}let h=new s.oa8(new s.bnF(a)),l=new s.vBJ({side:s.ehD,color:new s.Ilk(i[0],i[1],i[2]),transparent:!0,opacity:.3}),c=new s.Kj0(h,l);t.add(c),o.push(c),c.rotateOnAxis(new s.Pa4(1,0,0),.5*Math.PI)}}}return o},this.renderPoints=(t,e)=>{let i=new s.u9r,o=new s.UY4({vertexColors:!0,size:.5}),n=[],r=[];for(let i=0;i<t.length;++i){let s=t[i];for(let t=0;t<s.length;++t)for(let i=0;i<s[t].length;++i){let[o,a]=this.solution.projectionToMercator(s[t][i][0],s[t][i][1]);n.push(o,0,a),r.push(e[0],e[1],e[2])}}i.setAttribute("position",new s.a$l(n,3)),i.setAttribute("color",new s.a$l(r,3)),i.computeBoundingSphere();let a=new s.woe(i,o);return this.solution.scene.add(a),a},this.solution=t,(0,r.getJSONFromURL)("https://raw.githubusercontent.com/NamjuLee/data/master/Paris/street_osm.geojson").then(t=>{for(let e=0;e<t.features.length;++e)this.streetOSM.push(t.features[e].geometry.coordinates);let e=[0,1,1];this.solution.PARAM.colorSOMStreet&&(e=(0,r.hexToRGBANormalized)("#"+this.solution.PARAM.colorSOMStreet),this.solution.ui.isActive_streetOSM=!0),this.meshStreetOSM=this.LineSeg(this.streetOSM,e,-.01),this.solution.start()}),(0,r.getJSONFromURL)("https://raw.githubusercontent.com/NamjuLee/data/master/Paris/Paris-main-st.geojson").then(t=>{for(let e=0;e<t.features.length;++e)this.routesMain.push(t.features[e].geometry.coordinates);let e=[0,1,1];this.solution.PARAM.colorMainStreet&&(e=(0,r.hexToRGBANormalized)("#"+this.solution.PARAM.colorMainStreet),this.solution.ui.isActiveMainStreet=!0),this.meshMainStreet=this.LineSeg(this.routesMain,e)}),(0,r.getJSONFromURL)("https://raw.githubusercontent.com/NamjuLee/data/master/Paris/treated-st.geojson").then(t=>{for(let e=0;e<t.features.length;++e)this.routesTreated.push(t.features[e].geometry.coordinates);let e=[0,1,1];this.solution.PARAM.colorTreatedStreet&&(e=(0,r.hexToRGBANormalized)("#"+this.solution.PARAM.colorTreatedStreet),this.solution.ui.isActive_treated_st=!0),this.meshTreated=this.LineSeg(this.routesTreated,e)}),(0,r.getJSONFromURL)("https://raw.githubusercontent.com/NamjuLee/data/master/Paris/control-st.geojson").then(t=>{for(let e=0;e<t.features.length;++e)this.routesControl.push(t.features[e].geometry.coordinates);let e=[0,1,1];this.solution.PARAM.colorControlStreet&&(e=(0,r.hexToRGBANormalized)("#"+this.solution.PARAM.colorControlStreet),this.solution.ui.isActive_control_st=!0),this.meshControl=this.LineSeg(this.routesControl,e)}),(0,r.getJSONFromURL)("https://raw.githubusercontent.com/NamjuLee/data/master/Paris/zones-30.geojson").then(t=>{for(let e=0;e<t.features.length;++e)this.zones30.push(t.features[e].geometry.coordinates);let e=[0,1,1];this.solution.PARAM.colorZones30&&(e=(0,r.hexToRGBANormalized)("#"+this.solution.PARAM.colorZones30),this.solution.ui.isActive_zones_30=!0),this.meshZones30=this.renderMultiPolygon(this.solution.scene,this.zones30,e)});let e="https://raw.githubusercontent.com/NamjuLee/data/master/Paris/zones_15_innerouter_byyr_rings.json";(null==a?void 0:a.urlZone)&&(e=null==a?void 0:a.urlZone),(0,r.getJSONFromURL)(e).then(t=>{let e=[0,1,1];this.solution.PARAM.colorYearPolygon&&(e=(0,r.hexToRGBANormalized)("#"+this.solution.PARAM.colorYearPolygon)),this.solution.PARAM.year&&(this.selectedYear=this.solution.PARAM.year),this.polygonRings=this.renderCustomPolygon(t,e),this.updateYear(this.selectedYear)})}}class l{initMesh(t){let e=[],i=[];this.dataRaw.meta["domain_"+t];for(let s=0;s<this.dataRaw.cells.length;++s){let o=this.dataRaw.cells[s],[n,r]=this.solution.projectionToMercator(+o.lon,+o.lat),a=+o[t],h=[a/=2,a,0];e.push(n,a*this.dataScale,r),i.push(h[0],h[1],h[2])}let o=new s.u9r,n=new s.UY4({vertexColors:!0,size:.5});this.material=n,this.pos=new Float32Array(e),o.setAttribute("position",new s.a$l(this.pos,3)),o.setAttribute("color",new s.a$l(i,3)),o.computeBoundingSphere(),this.mesh=new s.woe(o,n),this.solution.scene.add(this.mesh),this.active=!0}updateColor(t,e,i){this.material.color.setRGB(t,e,i)}updateMesh(t){this.active=!1,this.removeMesh(),this.initMesh(t)}removeMesh(){this.solution.scene.remove(this.mesh)}update(){this.active&&(this.t+=.05,this.updateAnimation())}updateAnimation(){let t=this.mesh.geometry.attributes.position.count;for(let e=0;e<t;e++){let t=this.mesh.geometry.attributes.position,i=t.getX(e),o=t.getZ(e),n=this.pos[3*e+1]*this.dataScale;n*=1+Math.sin(i+n+this.t)*Math.cos(i+n+this.t),n=n<.1?.1:n;let r=new s.Pa4(i,n,o);this.mesh.geometry.attributes.position.setXYZ(e,r.x,r.y,r.z);let a=n/this.colorScale;this.mesh.geometry.attributes.color.setXYZ(e,a,this.dotG,this.dotB)}this.mesh.geometry.attributes.position.needsUpdate=!0,this.mesh.geometry.attributes.color.needsUpdate=!0,this.mesh.geometry.computeVertexNormals()}constructor(t){this.active=!1,this.t=0,this.dataScale=1,this.colorScale=1,this.color="#0ff",this.dotG=0,this.dotB=0,this.solution=t;let e="https://raw.githubusercontent.com/NamjuLee/data/master/Paris/real_data_buffersonly.json",i=void 0;(null==i?void 0:i.url)&&(e=null==i?void 0:i.url),(null==i?void 0:i.dotG)&&(this.dotG=+(null==i?void 0:i.dotG)/255),(null==i?void 0:i.dotB)&&(this.dotB=+(null==i?void 0:i.dotB)/255),(0,r.getJSONFromURL)(e).then(t=>{this.dataRaw=t,this.initMesh("noNeighbsLog"),this.solution.updateParam()})}}class c{appendUI(){let t=document.createElement("div");t.style.position="absolute",t.style.margin="5px",this.hostDiv.append(t);let e=document.createElement("dv");e.style.display="flex",e.style.marginBottom="10px",e.textContent="pos target",this.divCameraPos=e,t.append(e);let i=document.createElement("input");t.append(i),i.type="color",i.oninput=()=>{this.solution.drawing.updateColor(i.value)};let s=d("main street");t.append(s.div),s.checkBox.checked=!0,s.checkBox.onchange=()=>{!0===s.checkBox.checked?this.isActiveMainStreet=!0:this.isActiveMainStreet=!1};let o=d("OSM street");t.append(o.div),o.checkBox.onchange=()=>{!0===o.checkBox.checked?this.isActive_streetOSM=!0:this.isActive_streetOSM=!1};let n=d("treated street");t.append(n.div),n.checkBox.onchange=()=>{!0===n.checkBox.checked?this.isActive_treated_st=!0:this.isActive_treated_st=!1};let r=d("control street");t.append(r.div),r.checkBox.onchange=()=>{!0===r.checkBox.checked?this.isActive_control_st=!0:this.isActive_control_st=!1};let a=d("zones 30");t.append(a.div),a.checkBox.onchange=()=>{!0===a.checkBox.checked?this.isActive_zones_30=!0:this.isActive_zones_30=!1};let h=u("Year");h.div.style.marginTop="25px",h.text.textContent="Year: 2019",t.append(h.div),h.slider.oninput=()=>{this.year=+h.slider.value,h.text.textContent="Year: "+h.slider.value,this.solution.drawing.updateYear(+h.slider.value)};let l=d("twitter data");l.div.style.marginTop="25px",t.append(l.div),l.checkBox.onchange=()=>{!0===l.checkBox.checked?this.isActive_twitter=!0:this.isActive_twitter=!1};let c=u("Scale","1","10");c.text.textContent="Scale: 1",t.append(c.div),c.slider.defaultValue="1",c.slider.oninput=()=>{this.year=+c.slider.value,c.text.textContent="Scale: "+c.slider.value,this.solution.dataTwitter.dataScale=+c.slider.value};let m=u("Color","1.","50.");m.text.textContent="Color: 1",t.append(m.div),m.slider.defaultValue="1",m.slider.oninput=()=>{this.year=+m.slider.value,m.text.textContent="Color: "+m.slider.value,this.solution.dataTwitter.colorScale=+m.slider.value};let g=d("Animation");g.checkBox.defaultChecked=!0,t.append(g.div),g.checkBox.onchange=()=>{!0===g.checkBox.checked?this.solution.dataTwitter.active=!0:this.solution.dataTwitter.active=!1,this.solution.dataTwitter.updateAnimation()};let p={noNeighbsLog:"noNeighbsLog",noNeighbsLogDensity:"noNeighbsLogDensity",noNeighbsRaw:"noNeighbsRaw",noNeighbsWins:"noNeighbsWins",noTwtsLog:"noTwtsLog",noTwtsLogDensity:"noTwtsLogDensity",noTwtsRaw:"noTwtsRaw",noTwtsWins:"noTwtsWins",noUsersLog:"noUsersLog",noUsersLogDensity:"noUsersLogDensity",noUsersRaw:"noUsersRaw",noUsersWins:"noUsersWins",treatmentCategory:"treatmentCategory"},v=document.createElement("select");for(let e in t.append(v),p){let t=document.createElement("option");t.value=e,t.textContent=e,v.appendChild(t)}v.onchange=t=>{this.solution.dataTwitter.updateMesh(t.target.value)}}constructor(t){this.isActiveMainStreet=!0,this.isActive_streetOSM=!1,this.isActive_treated_st=!1,this.isActive_control_st=!1,this.isActive_zones_30=!1,this.isActive_zones_buffer=!1,this.isActive_twitter=!1,this.year=2010,this.solution=t,this.hostDiv=t.hostDiv,void 0!==this.solution.PARAM.local_ui?!0===this.solution.PARAM.local_ui&&this.appendUI():this.appendUI()}}let d=t=>{let e=document.createElement("div");e.style.display="flex";let i=document.createElement("input");i.type="checkbox";let s=document.createElement("div");return s.textContent=t,s.style.color="#aaa",e.appendChild(i),e.appendChild(s),{div:e,checkBox:i}},u=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"2009",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"2015",s=document.createElement("div");s.style.display="flex";let o=document.createElement("input");o.type="range",o.min=e,o.max=i;let n=document.createElement("div");return n.textContent=t,n.style.color="#aaa",s.appendChild(o),s.appendChild(n),{div:s,slider:o,text:n}};class m extends o.RendererThree{projectionToMercator(t,e){let[i,s]=g(t,e);return[(i+this.xOFf)*this.scale,-((s+this.yOFf)*this.scale*1)]}updateParam(){this.PARAM.scale&&(this.ui.isActive_twitter=!0,this.dataTwitter.dataScale=+this.PARAM.scale),this.PARAM.colorScale&&(this.ui.isActive_twitter=!0,this.dataTwitter.colorScale=+this.PARAM.colorScale),this.PARAM.dataLayer&&(this.ui.isActive_twitter=!0,this.dataTwitter.updateMesh(this.PARAM.dataLayer))}update(t){var e;this.drawing.update(),null===(e=this.dataTwitter)||void 0===e||e.update();let i="Pos: ".concat(this.camera.position.x,", ").concat(this.camera.position.y,", ").concat(this.camera.position.z,"; Target: ").concat(this.controls.target.x,", ").concat(this.controls.target.y,", ").concat(this.controls.target.z);void 0!==this.ui.divCameraPos&&(this.ui.divCameraPos.textContent=i)}constructor(t="main"){super(t),this.pts=[],this.xOFf=-15478803.88731685,this.yOFf=-4766681.448690384,this.scale=.01;let e=o.NJSCORE.R7.getAllUrlParams();this.PARAM=JSON.parse(JSON.stringify(e)),this.drawing=new h(this),this.dataTwitter=new l(this);let i=new s.cek(16777215,.8);this.camera.add(i),this.scene.add(i);let r=document.createElement("canvas");r.style.position="absolute",r.style.pointerEvents="none",r.style.mixBlendMode="darken",r.width=this.hostDiv.clientWidth,r.height=this.hostDiv.clientHeight,this.hostDiv.appendChild(r);let a=r.getContext("webgl");if(new n.B(a,.5,5).Render(a),this.ui=new c(this),this.PARAM.posCamera){let t=this.PARAM.posCamera.split(",");this.camera.position.set(+t[0],+t[1],+t[2]),this.controls.enablePan=!1,this.controls.enableRotate=!1,this.controls.enableZoom=!1}else this.camera.position.set(0,100,100);if(this.PARAM.posTarget){let t=this.PARAM.posTarget.split(",");this.controls.target.set(+t[0],+t[1],+t[2])}}}let g=(t,e)=>[30559983.333/360*(t+180),223- -(30559983.333*Math.log(Math.tan(Math.PI/4+e*Math.PI/180/2))/(2*Math.PI)*1)]}}]);