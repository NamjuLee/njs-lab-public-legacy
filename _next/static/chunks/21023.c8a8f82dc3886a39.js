"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[21023],{21023:function(t,e,n){n.d(e,{zD:function(){return tr}});var o,r=n(76320),i=n(94976),s=function(t,e){return(s=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function a(t,e){function n(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var u=function(){return(u=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function c(t,e,n,o){return new(n||(n=Promise))(function(r,i){function s(t){try{u(o.next(t))}catch(t){i(t)}}function a(t){try{u(o.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?r(t.value):((e=t.value)instanceof n?e:new n(function(t){t(e)})).then(s,a)}u((o=o.apply(t,e||[])).next())})}function f(t,e){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d(t){var e=t.shape[2],n=i.argMax(t,2),o=i.reshape(n,[-1]);return i.oneHot(o,e)}function l(t,e){return i.tidy(function(){return i.cast(i.greater(t,i.scalar(e)),"int32")})}/**
 * @license
 * Copyright 2019 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var p=function(){function t(t,e){this.model=t,this.outputStride=e;var n=this.model.inputs[0].shape;i.util.assert(-1===n[1]&&-1===n[2],function(){return"Input shape [".concat(n[1],", ").concat(n[2],"] ")+"must both be equal to or -1"})}return t.prototype.predict=function(t){var e=this;return i.tidy(function(){var n=e.preprocessInput(i.cast(t,"float32")),o=i.expandDims(n,0),r=e.model.predict(o).map(function(t){return i.squeeze(t,[0])}),s=e.nameOutputResults(r);return{heatmapScores:i.sigmoid(s.heatmap),offsets:s.offsets,displacementFwd:s.displacementFwd,displacementBwd:s.displacementBwd,segmentation:s.segmentation,partHeatmaps:s.partHeatmaps,longOffsets:s.longOffsets,partOffsets:s.partOffsets}})},t.prototype.dispose=function(){this.model.dispose()},t}(),h=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.preprocessInput=function(t){return i.tidy(function(){return i.sub(i.div(t,127.5),1)})},e.prototype.nameOutputResults=function(t){return{offsets:t[0],segmentation:t[1],partHeatmaps:t[2],longOffsets:t[3],heatmap:t[4],displacementFwd:t[5],displacementBwd:t[6],partOffsets:t[7]}},e}(p),m=["nose","leftEye","rightEye","leftEar","rightEar","leftShoulder","rightShoulder","leftElbow","rightElbow","leftWrist","rightWrist","leftHip","rightHip","leftKnee","rightKnee","leftAnkle","rightAnkle"],g=m.length,v=m.reduce(function(t,e,n){return t[e]=n,t},{});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y(t,e,n){var o=t[0],r=t[1],i=e[0],s=e[1],a=n.top,u=n.bottom;return[s/(n.left+n.right+r),i/(a+u+o)]}function w(t,e,n,o){return{y:o.get(t,e,n),x:o.get(t,e,n+g)}}function b(t,e,n){var o=w(t.heatmapY,t.heatmapX,t.id,n),r=o.y,i=o.x;return{x:t.heatmapX*e+i,y:t.heatmapY*e+r}}function S(t,e){return{x:t.x+e.x,y:t.y+e.y}}function x(t,e,n,o,r,i,s,a,u,c){for(var f=r[0],d=r[1],l=i[0],p=i[1],h=a[0],m=a[1],v=[],y=function(t){var e,n,o,r,i,s,a;return e=[f,d],n=[l,p],o=e[0],r=e[1],i=n[0],s=n[1],a=Math.round(((o+t.y+1)*s-1)/u),{x:Math.round(((r+t.x+1)*i-1)/u),y:a}},w=0;w<o;w++){var b=function(t,e,n,o,r,i,s){for(var a=s[0],u=s[1],c=n(t),f=c.y*o+c.x,d=r[2*f*g+e],l=r[g*(2*f+1)+e],p=t.y+d,h=t.x+l,m=0;m<i;m++){p=Math.min(p,a-1);var v=n({x:h=Math.min(h,u-1),y:p}),y=v.y*o+v.x;d=r[2*y*g+e],l=r[g*(2*y+1)+e],p+=d,h+=l}return{x:h,y:p}}(t,w,y,s,e,c,[h,m]);v.push(b)}for(var S=-1,x=1/0,E=0;E<n.length;E++){var O=/**
 * @license
 * Copyright 2019 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function(t,e,n){void 0===n&&(n=.3);for(var o=0,r=0,i=0;i<t.length;i++)e.keypoints[i].score>n&&(r+=1,o+=Math.pow(t[i].x-e.keypoints[i].position.x,2)+Math.pow(t[i].y-e.keypoints[i].position.y,2));return 0===r?o=1/0:o/=r,o}(v,n[E]);O<x&&(S=E,x=O)}return S}function E(t,e){var n=t[0];return[Math.round((t[1]-1)/e+1),Math.round((n-1)/e+1)]}/**
 * @license
 * Copyright 2019 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O(t,e,n,o,r,s,a,u,c,f,d){for(var l=a[0],p=a[1],h=t.shape,m=h[0],v=h[1],w=e.shape.slice(0,2),b=w[0],S=w[1],x=i.reshape(e,[b,S,2,g]),E=new Float32Array(d*g*3).fill(0),O=0;O<n.length;O++)for(var M=O*g*3,R=n[O],k=0;k<g;k++){var H=R.keypoints[k],P=M+3*k;E[P]=H.score,E[P+1]=H.position.y,E[P+2]=H.position.x}var F=y([o,r],[l,p],u),T=F[0],B=F[1],I=i.tensor(E,[d,g,3]),A=u.top,D=u.left,L={variableNames:["segmentation","longOffsets","poses"],outputShape:[m,v],userCode:"\n    int convertToPositionInOutput(int pos, int pad, float scale, int stride) {\n      return round(((float(pos + pad) + 1.0) * scale - 1.0) / float(stride));\n    }\n\n    float convertToPositionInOutputFloat(\n        int pos, int pad, float scale, int stride) {\n      return ((float(pos + pad) + 1.0) * scale - 1.0) / float(stride);\n    }\n\n    float dist(float x1, float y1, float x2, float y2) {\n      return pow(x1 - x2, 2.0) + pow(y1 - y2, 2.0);\n    }\n\n    float sampleLongOffsets(float h, float w, int d, int k) {\n      float fh = fract(h);\n      float fw = fract(w);\n      int clH = int(ceil(h));\n      int clW = int(ceil(w));\n      int flH = int(floor(h));\n      int flW = int(floor(w));\n      float o11 = getLongOffsets(flH, flW, d, k);\n      float o12 = getLongOffsets(flH, clW, d, k);\n      float o21 = getLongOffsets(clH, flW, d, k);\n      float o22 = getLongOffsets(clH, clW, d, k);\n      float o1 = mix(o11, o12, fw);\n      float o2 = mix(o21, o22, fw);\n      return mix(o1, o2, fh);\n    }\n\n    int findNearestPose(int h, int w) {\n      float prob = getSegmentation(h, w);\n      if (prob < 1.0) {\n        return -1;\n      }\n\n      // Done(Tyler): convert from output space h/w to strided space.\n      float stridedH = convertToPositionInOutputFloat(\n        h, ".concat(A,", ").concat(B,", ").concat(s,");\n      float stridedW = convertToPositionInOutputFloat(\n        w, ").concat(D,", ").concat(T,", ").concat(s,");\n\n      float minDist = 1000000.0;\n      int iMin = -1;\n      for (int i = 0; i < ").concat(d,"; i++) {\n        float curDistSum = 0.0;\n        int numKpt = 0;\n        for (int k = 0; k < ").concat(g,"; k++) {\n          float dy = sampleLongOffsets(stridedH, stridedW, 0, k);\n          float dx = sampleLongOffsets(stridedH, stridedW, 1, k);\n\n          float y = float(h) + dy;\n          float x = float(w) + dx;\n\n          for (int s = 0; s < ").concat(c,"; s++) {\n            int yRounded = round(min(y, float(").concat(o-1,")));\n            int xRounded = round(min(x, float(").concat(r-1,")));\n\n            float yStrided = convertToPositionInOutputFloat(\n              yRounded, ").concat(A,", ").concat(B,", ").concat(s,");\n            float xStrided = convertToPositionInOutputFloat(\n              xRounded, ").concat(D,", ").concat(T,", ").concat(s,");\n\n            float dy = sampleLongOffsets(yStrided, xStrided, 0, k);\n            float dx = sampleLongOffsets(yStrided, xStrided, 1, k);\n\n            y = y + dy;\n            x = x + dx;\n          }\n\n          float poseScore = getPoses(i, k, 0);\n          float poseY = getPoses(i, k, 1);\n          float poseX = getPoses(i, k, 2);\n          if (poseScore > ").concat(f,") {\n            numKpt = numKpt + 1;\n            curDistSum = curDistSum + dist(x, y, poseX, poseY);\n          }\n        }\n        if (numKpt > 0 && curDistSum / float(numKpt) < minDist) {\n          minDist = curDistSum / float(numKpt);\n          iMin = i;\n        }\n      }\n      return iMin;\n    }\n\n    void main() {\n        ivec2 coords = getOutputCoords();\n        int nearestPose = findNearestPose(coords[0], coords[1]);\n        setOutput(float(nearestPose));\n      }\n  ")};return i.backend().compileAndRun(L,[t,x,I])}function M(){return"webgl"===(0,i.getBackend)()}/**
 * @license
 * Copyright 2019 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R(t){return Math.floor(t/2)}[["leftHip","leftShoulder"],["leftElbow","leftShoulder"],["leftElbow","leftWrist"],["leftHip","leftKnee"],["leftKnee","leftAnkle"],["rightHip","rightShoulder"],["rightElbow","rightShoulder"],["rightElbow","rightWrist"],["rightHip","rightKnee"],["rightKnee","rightAnkle"],["leftShoulder","rightShoulder"],["leftHip","rightHip"]].map(function(t){var e=t[0],n=t[1];return[v[e],v[n]]});var k=function(){function t(t,e){this.priorityQueue=Array(t),this.numberOfElements=-1,this.getElementValue=e}return t.prototype.enqueue=function(t){this.priorityQueue[++this.numberOfElements]=t,this.swim(this.numberOfElements)},t.prototype.dequeue=function(){var t=this.priorityQueue[0];return this.exchange(0,this.numberOfElements--),this.sink(0),this.priorityQueue[this.numberOfElements+1]=null,t},t.prototype.empty=function(){return -1===this.numberOfElements},t.prototype.size=function(){return this.numberOfElements+1},t.prototype.all=function(){return this.priorityQueue.slice(0,this.numberOfElements+1)},t.prototype.max=function(){return this.priorityQueue[0]},t.prototype.swim=function(t){for(;t>0&&this.less(R(t),t);)this.exchange(t,R(t)),t=R(t)},t.prototype.sink=function(t){for(;2*t<=this.numberOfElements;){var e=2*t;if(e<this.numberOfElements&&this.less(e,e+1)&&e++,!this.less(t,e))break;this.exchange(t,e),t=e}},t.prototype.getValueAt=function(t){return this.getElementValue(this.priorityQueue[t])},t.prototype.less=function(t,e){return this.getValueAt(t)<this.getValueAt(e)},t.prototype.exchange=function(t,e){var n=this.priorityQueue[t];this.priorityQueue[t]=this.priorityQueue[e],this.priorityQueue[e]=n},t}(),H=[["nose","leftEye"],["leftEye","leftEar"],["nose","rightEye"],["rightEye","rightEar"],["nose","leftShoulder"],["leftShoulder","leftElbow"],["leftElbow","leftWrist"],["leftShoulder","leftHip"],["leftHip","leftKnee"],["leftKnee","leftAnkle"],["nose","rightShoulder"],["rightShoulder","rightElbow"],["rightElbow","rightWrist"],["rightShoulder","rightHip"],["rightHip","rightKnee"],["rightKnee","rightAnkle"]].map(function(t){var e=t[0],n=t[1];return[v[e],v[n]]}),P=H.map(function(t){return t[1]}),F=H.map(function(t){return t[0]});function T(t,e,n,o){var r,i,s,a;return{y:(r=Math.round(t.y/e),i=n-1,r<0?0:r>i?i:r),x:(s=Math.round(t.x/e),a=o-1,s<0?0:s>a?a:s)}}function B(t,e,n,o,r,i,s,a){void 0===a&&(a=2);for(var u,c=o.shape,f=c[0],d=c[1],l=T(e.position,i,f,d),p=(u=s.shape[2]/2,{y:s.get(l.y,l.x,t),x:s.get(l.y,l.x,u+t)}),h=S(e.position,p),g=0;g<a;g++){var v=T(h,i,f,d),y=w(v.y,v.x,n,r);h=S({x:v.x*i,y:v.y*i},{x:y.x,y:y.y})}var b=T(h,i,f,d),x=o.get(b.y,b.x,n);return{position:h,part:m[n],score:x}}/**
 * @license
 * Copyright 2019 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I(t,e,n,o){var r=n.x,i=n.y;return t.some(function(t){var n,s,a,u,c=t.keypoints[o].position;return n=c.y,s=c.x,(a=n-i)*a+(u=s-r)*u<=e})}function A(t,e,n,o,r,i,s,a){void 0===s&&(s=.5),void 0===a&&(a=20);for(var u=[],c=function(t,e,n){for(var o=n.shape,r=o[0],i=o[1],s=o[2],a=new k(r*i*s,function(t){return t.score}),u=0;u<r;++u)for(var c=0;c<i;++c)for(var f=0;f<s;++f){var d=n.get(u,c,f);!(d<t)&&/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function(t,e,n,o,r,i){for(var s=i.shape,a=s[0],u=s[1],c=!0,f=Math.max(n-1,0),d=Math.min(n+1+1,a),l=f;l<d;++l){for(var p=Math.max(o-r,0),h=Math.min(o+r+1,u),m=p;m<h;++m)if(i.get(l,m,t)>e){c=!1;break}if(!c)break}return c}(f,d,u,c,1,n)&&a.enqueue({score:d,part:{heatmapY:u,heatmapX:c,id:f}})}return a}(s,0,t),f=a*a;u.length<i&&!c.empty();){var d=c.dequeue();if(!I(u,f,b(d.part,r,e),d.part.id)){var l=function(t,e,n,o,r,i){var s=e.shape[2],a=P.length,u=Array(s),c=t.part,f=t.score,d=b(c,o,n);u[c.id]={score:f,part:m[c.id],position:d};for(var l=a-1;l>=0;--l){var p=P[l],h=F[l];u[p]&&!u[h]&&(u[h]=B(l,u[p],h,e,n,o,i))}for(var l=0;l<a;++l){var p=F[l],h=P[l];u[p]&&!u[h]&&(u[h]=B(l,u[p],h,e,n,o,r))}return u}(d,t,e,r,n,o),p=function(t,e,n){return n.reduce(function(n,o,r){var i=o.position,s=o.score;return I(t,e,i,r)||(n+=s),n},0)/n.length}(u,f,l);u.push({keypoints:l,score:p})}}return u}/**
 * @license
 * Copyright 2019 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var D=[-123.15,-115.9,-103.06],L=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.preprocessInput=function(t){return i.add(t,D)},e.prototype.nameOutputResults=function(t){var e=t[0],n=t[1],o=t[2],r=t[3],i=t[4],s=t[5];return{offsets:i,segmentation:t[6],partHeatmaps:s,longOffsets:r,heatmap:o,displacementFwd:n,displacementBwd:e,partOffsets:t[7]}},e}(p),q="https://storage.googleapis.com/tfjs-models/savedmodel/bodypix/resnet50/",W="https://storage.googleapis.com/tfjs-models/savedmodel/bodypix/mobilenet/";function K(t){if("undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof OffscreenCanvas&&t instanceof OffscreenCanvas||"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement)return function(t){if("offsetHeight"in t&&0!==t.offsetHeight&&"offsetWidth"in t&&0!==t.offsetWidth)return[t.offsetHeight,t.offsetWidth];if(null!=t.height&&null!=t.width)return[t.height,t.width];throw Error("HTMLImageElement must have height and width attributes set.")}(t);if("undefined"!=typeof ImageData&&t instanceof ImageData)return[t.height,t.width];if("undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement)return t.hasAttribute("height")&&t.hasAttribute("width")?[t.height,t.width]:[t.videoHeight,t.videoWidth];if(t instanceof i.Tensor)return[t.shape[0],t.shape[1]];throw Error("error: Unknown input type: ".concat(t,"."))}function z(t,e){return(t-1)%e==0?t:Math.floor(t/e)*e+1}var N={low:"low",medium:"medium",high:"high",full:"full"},j=((o={})[N.low]=.25,o[N.medium]=.5,o[N.high]=.75,o[N.full]=1,o);function V(t,e,n){var o=n[0],r=n[1],s=function(t){if("string"!=typeof t)return i.util.assert("number"==typeof t&&t<=2&&t>=.1,function(){return"inputResolution must be a string or number between ".concat(.1," and ").concat(2,", but ")+"was ".concat(t)}),t;var e=j[t];return i.util.assert("number"==typeof e,function(){return"string value of inputResolution must be one of ".concat(Object.values(N).join(",")," but was ").concat(t,".")}),e}(t);return[z(o*s,e),z(r*s,e)]}function _(t,e,n,o,r){var s=e[0],a=e[1],u=n[0],c=n[1],f=o[0],d=f[0],l=f[1],p=o[1],h=p[0],m=p[1];return void 0===r&&(r=!1),i.tidy(function(){var e,n,o,f,p,g,v,y,w,b,S,x=i.image.resizeBilinear(t,[u,c],!0);return r&&(x=i.sigmoid(x)),e=x,n=[s,a],o=[[d,l],[h,m]],f=n[0],p=n[1],v=(g=o[0])[0],y=g[1],b=(w=o[1])[0],S=w[1],i.tidy(function(){var t=i.expandDims(e);return i.squeeze(i.image.cropAndResize(t,[[v/(f+v+y-1),b/(p+b+S-1),(v+f-1)/(f+v+y-1),(b+p-1)/(p+b+S-1)]],[0],[f,p]),[0])})})}function Q(t,e){var n=e[0],o=e[1],r=K(t),s=r[0],a=r[1],u=o/n,c=0,f=0,d=0,l=0;return a/s<u?(c=0,f=0,d=Math.round(.5*(u*s-a)),l=Math.round(.5*(u*s-a))):(c=Math.round(.5*(1/u*a-s)),f=Math.round(.5*(1/u*a-s)),d=0,l=0),{resized:i.tidy(function(){var e=t instanceof i.Tensor?t:i.browser.fromPixels(t);return e=i.pad3d(e,[[c,f],[d,l],[0,0]]),i.image.resizeBilinear(e,[n,o])}),padding:{top:c,left:d,right:l,bottom:f}}}function C(t){return c(this,void 0,void 0,function(){return f(this,function(e){return[2,Promise.all(t.map(function(t){return t.buffer()}))]})})}function Y(t,e,n,o,r){var i,s,a=e[0],u=e[1],c=n[0],f=n[1],d=(a+o.top+o.bottom)/c,l=(u+o.left+o.right)/f,p=(i=-o.top,s=-o.left,(void 0===i&&(i=0),void 0===s&&(s=0),1===l&&1===d&&0===i&&0===s)?t:t.map(function(t){var e,n;return void 0===(e=i)&&(e=0),void 0===(n=s)&&(n=0),{score:t.score,keypoints:t.keypoints.map(function(t){var o=t.score,r=t.part,i=t.position;return{score:o,part:r,position:{x:i.x*l+n,y:i.y*d+e}}})}}));return r?u<=0?p:p.map(function(t){return{score:t.score,keypoints:t.keypoints.map(function(t){var e=t.score,n=t.part,o=t.position;return{score:e,part:n,position:{x:u-1-o.x,y:o.y}}})}}):p}var X={architecture:"MobileNetV1",outputStride:16,quantBytes:4,multiplier:.75},U=["MobileNetV1","ResNet50"],G={MobileNetV1:[8,16,32],ResNet50:[32,16]},J={MobileNetV1:[.5,.75,1],ResNet50:[1]},Z=[1,2,4],$={flipHorizontal:!1,internalResolution:"medium",segmentationThreshold:.7,maxDetections:10,scoreThreshold:.4,nmsRadius:20},tt={flipHorizontal:!1,internalResolution:"medium",segmentationThreshold:.7,maxDetections:10,scoreThreshold:.4,nmsRadius:20,minKeypointScore:.3,refineSteps:10};function te(t){var e=t.segmentationThreshold,n=t.maxDetections,o=t.scoreThreshold,r=t.nmsRadius;if(e<0||e>1)throw Error("segmentationThreshold ".concat(e,". ")+"Should be in range [0.0, 1.0]");if(n<=0)throw Error("Invalid maxDetections ".concat(n,". ")+"Should be > 0");if(o<0||o>1)throw Error("Invalid scoreThreshold ".concat(o,". ")+"Should be in range [0.0, 1.0]");if(r<=0)throw Error("Invalid nmsRadius ".concat(r,"."))}function tn(t){var e=t.segmentationThreshold,n=t.maxDetections,o=t.scoreThreshold,r=t.nmsRadius,i=t.minKeypointScore,s=t.refineSteps;if(e<0||e>1)throw Error("segmentationThreshold ".concat(e,". ")+"Should be in range [0.0, 1.0]");if(n<=0)throw Error("Invalid maxDetections ".concat(n,". ")+"Should be > 0");if(o<0||o>1)throw Error("Invalid scoreThreshold ".concat(o,". ")+"Should be in range [0.0, 1.0]");if(r<=0)throw Error("Invalid nmsRadius ".concat(r,"."));if(i<0||i>1)throw Error("Invalid minKeypointScore ".concat(i,".")+"Should be in range [0.0, 1.0]");if(s<=0||s>20)throw Error("Invalid refineSteps ".concat(s,".")+"Should be in range [1, 20]")}var to=function(){function t(t){this.baseModel=t}return t.prototype.predictForPersonSegmentation=function(t){var e=this.baseModel.predict(t);return{segmentLogits:e.segmentation,heatmapScores:e.heatmapScores,offsets:e.offsets,displacementFwd:e.displacementFwd,displacementBwd:e.displacementBwd}},t.prototype.predictForPersonSegmentationAndPart=function(t){var e=this.baseModel.predict(t);return{segmentLogits:e.segmentation,partHeatmapLogits:e.partHeatmaps,heatmapScores:e.heatmapScores,offsets:e.offsets,displacementFwd:e.displacementFwd,displacementBwd:e.displacementBwd}},t.prototype.predictForMultiPersonInstanceSegmentationAndPart=function(t){var e=this.baseModel.predict(t);return{segmentLogits:e.segmentation,longOffsets:e.longOffsets,heatmapScores:e.heatmapScores,offsets:e.offsets,displacementFwd:e.displacementFwd,displacementBwd:e.displacementBwd,partHeatmaps:e.partHeatmaps}},t.prototype.segmentPersonActivation=function(t,e,n){var o=this;void 0===n&&(n=.5);var r=K(t),s=r[0],a=r[1],u=V(e,this.baseModel.outputStride,[s,a]),c=Q(t,u),f=c.resized,d=c.padding,p=i.tidy(function(){var t=o.predictForPersonSegmentation(f),e=t.segmentLogits,r=t.heatmapScores,u=t.offsets,c=t.displacementFwd,p=t.displacementBwd,h=f.shape,m=_(e,[s,a],[h[0],h[1]],[[d.top,d.bottom],[d.left,d.right]],!0);return{segmentation:l(i.squeeze(m),n),heatmapScores:r,offsets:u,displacementFwd:c,displacementBwd:p}}),h=p.segmentation,m=p.heatmapScores,g=p.offsets,v=p.displacementFwd,y=p.displacementBwd;return f.dispose(),{segmentation:h,heatmapScores:m,offsets:g,displacementFwd:v,displacementBwd:y,padding:d,internalResolutionHeightAndWidth:u}},t.prototype.segmentPerson=function(t,e){return void 0===e&&(e=$),c(this,void 0,void 0,function(){var n,o,r,i,s,a,c,d,l,p,h,m,g,v,y;return f(this,function(f){switch(f.label){case 0:return te(e=u(u({},$),e)),o=(n=this.segmentPersonActivation(t,e.internalResolution,e.segmentationThreshold)).segmentation,r=n.heatmapScores,i=n.offsets,s=n.displacementFwd,a=n.displacementBwd,c=n.padding,d=n.internalResolutionHeightAndWidth,p=(l=o.shape)[0],h=l[1],[4,o.data()];case 1:return m=f.sent(),o.dispose(),[4,C([r,i,s,a])];case 2:return v=(g=f.sent())[0],y=Y(y=A(v,g[1],g[2],g[3],this.baseModel.outputStride,e.maxDetections,e.scoreThreshold,e.nmsRadius),[p,h],d,c,!1),r.dispose(),i.dispose(),s.dispose(),a.dispose(),[2,{height:p,width:h,data:m,allPoses:y}]}})})},t.prototype.segmentMultiPerson=function(t,e){return void 0===e&&(e=tt),c(this,void 0,void 0,function(){var n,o,r,s,a,d,p,h,m,g,v,w,b,S,R,k,H,P,F=this;return f(this,function(T){switch(T.label){case 0:return tn(e=u(u({},tt),e)),o=(n=K(t))[0],r=n[1],d=(a=Q(t,s=V(e.internalResolution,this.baseModel.outputStride,[o,r]))).resized,p=a.padding,m=(h=i.tidy(function(){var t=F.predictForMultiPersonInstanceSegmentationAndPart(d),n=t.segmentLogits,a=t.longOffsets,u=t.heatmapScores,c=t.offsets,f=t.displacementFwd,h=t.displacementBwd,m=_(n,[o,r],s,[[p.top,p.bottom],[p.left,p.right]],!0);return{segmentation:l(i.squeeze(m),e.segmentationThreshold),longOffsets:a,heatmapScoresRaw:u,offsetsRaw:c,displacementFwdRaw:f,displacementBwdRaw:h}})).segmentation,g=h.longOffsets,v=h.heatmapScoresRaw,w=h.offsetsRaw,b=h.displacementFwdRaw,S=h.displacementBwdRaw,[4,C([v,w,b,S])];case 1:return k=(R=T.sent())[0],H=Y(H=A(k,R[1],R[2],R[3],this.baseModel.outputStride,e.maxDetections,e.scoreThreshold,e.nmsRadius),[o,r],s,p,!1),[4,function(t,e,n,o,r,s,a,u,d,l,p,h){var m=a[0],g=a[1];return void 0===d&&(d=.2),void 0===l&&(l=8),void 0===p&&(p=.3),void 0===h&&(h=10),c(this,void 0,void 0,function(){var a,c,v,w,b;return f(this,function(f){switch(f.label){case 0:if(a=n.filter(function(t){return t.score>=d}),!M())return[3,2];return[4,Promise.all((v=i.tidy(function(){var n=O(t,e,a,o,r,s,[m,g],u,l,p,h),c=i.engine().makeTensorFromDataId(n.dataId,n.shape,n.dtype);return a.map(function(t,e){return i.tidy(function(){return i.cast(i.equal(c,i.scalar(e)),"int32")})})})).map(function(t){return t.data()}))];case 1:return c=f.sent(),v.forEach(function(t){return t.dispose()}),[3,5];case 2:return[4,t.data()];case 3:return w=f.sent(),[4,e.data()];case 4:b=f.sent(),c=function(t,e,n,o,r,i,s,a,u,c){var f=s[0],d=s[1];void 0===c&&(c=5);for(var l=n.map(function(t){return new Uint8Array(o*r).fill(0)}),p=a.top,h=a.left,m=y([o,r],[f,d],a),g=m[0],v=m[1],w=E([f,d],i)[0],b=0;b<o;b+=1)for(var S=0;S<r;S+=1){var O=b*r+S;if(1===t[O]){var M=x({x:S,y:b},e,n,c,[p,h],[g,v],w,[o,r],i,u);M>=0&&(l[M][O]=1)}}return l}(w,b,a,o,r,s,[m,g],u,l),f.label=5;case 5:return[2,c.map(function(t,e){return{data:t,pose:a[e],width:r,height:o}})]}})})}(m,g,H,o,r,this.baseModel.outputStride,s,p,e.scoreThreshold,e.refineSteps,e.minKeypointScore,e.maxDetections)];case 2:return P=T.sent(),d.dispose(),m.dispose(),g.dispose(),v.dispose(),w.dispose(),b.dispose(),S.dispose(),[2,P]}})})},t.prototype.segmentPersonPartsActivation=function(t,e,n){var o=this;void 0===n&&(n=.5);var r=K(t),s=r[0],a=r[1],u=V(e,this.baseModel.outputStride,[s,a]),c=Q(t,u),f=c.resized,p=c.padding,h=i.tidy(function(){var t,e,r,u,c,h=o.predictForPersonSegmentationAndPart(f),m=h.segmentLogits,g=h.partHeatmapLogits,v=h.heatmapScores,y=h.offsets,w=h.displacementFwd,b=h.displacementBwd,S=f.shape,x=S[0],E=S[1],O=_(m,[s,a],[x,E],[[p.top,p.bottom],[p.left,p.right]],!0),M=_(g,[s,a],[x,E],[[p.top,p.bottom],[p.left,p.right]],!0);return{partSegmentation:(t=l(i.squeeze(O),n),r=(e=M.shape)[0],u=e[1],c=e[2],i.tidy(function(){var e=d(M),n=i.expandDims(i.range(0,c,1,"int32"),1),o=i.cast(i.matMul(e,n),"int32"),s=i.reshape(o,[r,u]),a=i.add(s,i.scalar(1,"int32"));return i.sub(i.mul(a,t),i.scalar(1,"int32"))})),heatmapScores:v,offsets:y,displacementFwd:w,displacementBwd:b}}),m=h.partSegmentation,g=h.heatmapScores,v=h.offsets,y=h.displacementFwd,w=h.displacementBwd;return f.dispose(),{partSegmentation:m,heatmapScores:g,offsets:v,displacementFwd:y,displacementBwd:w,padding:p,internalResolutionHeightAndWidth:u}},t.prototype.segmentPersonParts=function(t,e){return void 0===e&&(e=$),c(this,void 0,void 0,function(){var n,o,r,i,s,a,c,d,l,p,h,m,g,v,y;return f(this,function(f){switch(f.label){case 0:return te(e=u(u({},$),e)),o=(n=this.segmentPersonPartsActivation(t,e.internalResolution,e.segmentationThreshold)).partSegmentation,r=n.heatmapScores,i=n.offsets,s=n.displacementFwd,a=n.displacementBwd,c=n.padding,d=n.internalResolutionHeightAndWidth,p=(l=o.shape)[0],h=l[1],[4,o.data()];case 1:return m=f.sent(),o.dispose(),[4,C([r,i,s,a])];case 2:return v=(g=f.sent())[0],y=Y(y=A(v,g[1],g[2],g[3],this.baseModel.outputStride,e.maxDetections,e.scoreThreshold,e.nmsRadius),[p,h],d,c,!1),r.dispose(),i.dispose(),s.dispose(),a.dispose(),[2,{height:p,width:h,data:m,allPoses:y}]}})})},t.prototype.segmentMultiPersonParts=function(t,e){return void 0===e&&(e=tt),c(this,void 0,void 0,function(){var n,o,r,s,a,p,h,m,g,v,w,b,S,R,k,H,P,F,T,B=this;return f(this,function(I){switch(I.label){case 0:return tn(e=u(u({},tt),e)),o=(n=K(t))[0],r=n[1],p=(a=Q(t,s=V(e.internalResolution,this.baseModel.outputStride,[o,r]))).resized,h=a.padding,g=(m=i.tidy(function(){var t,n,a,u,c=B.predictForMultiPersonInstanceSegmentationAndPart(p),f=c.segmentLogits,m=c.longOffsets,g=c.heatmapScores,v=c.offsets,y=c.displacementFwd,w=c.displacementBwd,b=c.partHeatmaps,S=_(f,[o,r],s,[[h.top,h.bottom],[h.left,h.right]],!0),x=_(b,[o,r],s,[[h.top,h.bottom],[h.left,h.right]],!0);return{segmentation:l(i.squeeze(S),e.segmentationThreshold),longOffsets:m,heatmapScoresRaw:g,offsetsRaw:v,displacementFwdRaw:y,displacementBwdRaw:w,partSegmentation:(n=(t=x.shape)[0],a=t[1],u=t[2],i.tidy(function(){var t=d(x),e=i.expandDims(i.range(0,u,1,"int32"),1),o=i.cast(i.matMul(t,e),"int32");return i.reshape(o,[n,a])}))}})).segmentation,v=m.longOffsets,w=m.heatmapScoresRaw,b=m.offsetsRaw,S=m.displacementFwdRaw,R=m.displacementBwdRaw,k=m.partSegmentation,[4,C([w,b,S,R])];case 1:return P=(H=I.sent())[0],F=Y(F=A(P,H[1],H[2],H[3],this.baseModel.outputStride,e.maxDetections,e.scoreThreshold,e.nmsRadius),[o,r],s,h,!1),[4,function(t,e,n,o,r,s,a,u,d,l,p,h,m){var g=u[0],v=u[1];return void 0===l&&(l=.2),void 0===p&&(p=8),void 0===h&&(h=.3),void 0===m&&(m=10),c(this,void 0,void 0,function(){var u,c,w,b,S,R;return f(this,function(f){switch(f.label){case 0:if(u=o.filter(function(t){return t.score>=l}),!M())return[3,2];return[4,Promise.all((w=i.tidy(function(){var o=O(t,e,u,r,s,a,[g,v],d,p,h,m),c=i.engine().makeTensorFromDataId(o.dataId,o.shape,o.dtype);return u.map(function(t,e){return i.tidy(function(){return i.sub(i.mul(i.cast(i.equal(c,i.scalar(e)),"int32"),i.add(n,1)),1)})})})).map(function(t){return t.data()}))];case 1:return c=f.sent(),w.forEach(function(t){return t.dispose()}),[3,6];case 2:return[4,t.data()];case 3:return b=f.sent(),[4,e.data()];case 4:return S=f.sent(),[4,n.data()];case 5:R=f.sent(),c=function(t,e,n,o,r,i,s,a,u,c,f){var d=a[0],l=a[1];void 0===f&&(f=5);for(var p=o.map(function(t){return new Int32Array(r*i).fill(-1)}),h=u.top,m=u.left,g=y([r,i],[d,l],u),v=g[0],w=g[1],b=E([d,l],s)[0],S=0;S<r;S+=1)for(var O=0;O<i;O+=1){var M=S*i+O;if(1===t[M]){var R=x({x:O,y:S},e,o,f,[h,m],[v,w],b,[r,i],s,c);R>=0&&(p[R][M]=n[M])}}return p}(b,S,R,u,r,s,a,[g,v],d,p),f.label=6;case 6:return[2,c.map(function(t,e){return{pose:u[e],data:t,height:r,width:s}})]}})})}(g,v,k,F,o,r,this.baseModel.outputStride,s,h,e.scoreThreshold,e.refineSteps,e.minKeypointScore,e.maxDetections)];case 2:return T=I.sent(),p.dispose(),g.dispose(),v.dispose(),w.dispose(),b.dispose(),S.dispose(),R.dispose(),k.dispose(),[2,T]}})})},t.prototype.dispose=function(){this.baseModel.dispose()},t}();function tr(t){return void 0===t&&(t=X),c(this,void 0,void 0,function(){return f(this,function(e){return"ResNet50"===(t=function(t){if(null==(t=t||X).architecture&&(t.architecture="MobileNetV1"),0>U.indexOf(t.architecture))throw Error("Invalid architecture ".concat(t.architecture,". ")+"Should be one of ".concat(U));if(null==t.outputStride&&(t.outputStride=16),0>G[t.architecture].indexOf(t.outputStride))throw Error("Invalid outputStride ".concat(t.outputStride,". ")+"Should be one of ".concat(G[t.architecture]," ")+"for architecture ".concat(t.architecture,"."));if(null==t.multiplier&&(t.multiplier=1),0>J[t.architecture].indexOf(t.multiplier))throw Error("Invalid multiplier ".concat(t.multiplier,". ")+"Should be one of ".concat(J[t.architecture]," ")+"for architecture ".concat(t.architecture,"."));if(null==t.quantBytes&&(t.quantBytes=4),0>Z.indexOf(t.quantBytes))throw Error("Invalid quantBytes ".concat(t.quantBytes,". ")+"Should be one of ".concat(Z," ")+"for architecture ".concat(t.architecture,"."));return t}(t)).architecture?[2,function(t){return c(this,void 0,void 0,function(){var e,n,o;return f(this,function(s){switch(s.label){case 0:var a,u;if(e=t.outputStride,n=t.quantBytes,null==i)throw Error("Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this\n        model.");return a=e,u="model-stride".concat(a,".json"),o=4===n?q+"float/"+u:q+"quant".concat(n,"/")+u,[4,r.YL(t.modelUrl||o)];case 1:return[2,new to(new L(s.sent(),e))]}})})}(t)]:"MobileNetV1"===t.architecture?[2,function(t){return c(this,void 0,void 0,function(){var e,n,o,s;return f(this,function(a){switch(a.label){case 0:var u,c,f;if(e=t.outputStride,n=t.quantBytes,o=t.multiplier,null==i)throw Error("Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this\n        model.");return u=e,c={1:"100",.75:"075",.5:"050"},f="model-stride".concat(u,".json"),s=4===n?W+"float/".concat(c[o],"/")+f:W+"quant".concat(n,"/").concat(c[o],"/")+f,[4,r.YL(t.modelUrl||s)];case 1:return[2,new to(new h(a.sent(),e))]}})})}(t)]:[2,null]})})}}}]);