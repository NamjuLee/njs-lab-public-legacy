(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3967],{15510:function(e){function t(e){return Promise.resolve().then(function(){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t})}t.keys=function(){return[]},t.resolve=t,t.id=15510,e.exports=t},75410:function(){},48628:function(){},31601:function(){},67792:function(){},34977:function(){},75042:function(){},21322:function(e,t,s){"use strict";s.d(t,{P:function(){return n}});var i=s(88405);class n{predict1d(e){return e.mul(this.weights[0]).add(this.bias)}predict2d(e){return e.square().mul(this.weights[1]).add(e.mul(this.weights[0])).add(this.bias)}predict3d(e){return e.pow(i.scalar(3)).mul(this.weights[2]).add(e.square().mul(this.weights[1])).add(e.mul(this.weights[0])).add(this.bias)}predict4d(e){return e.pow(i.scalar(4)).mul(this.weights[3]).add(e.pow(i.scalar(3)).mul(this.weights[2])).add(e.square().mul(this.weights[1])).add(e.mul(this.weights[0])).add(this.bias)}predict5d(e){return e.pow(i.scalar(5)).mul(this.weights[4]).add(e.pow(i.scalar(4)).mul(this.weights[3])).add(e.pow(i.scalar(3)).mul(this.weights[2])).add(e.square().mul(this.weights[1])).add(e.mul(this.weights[0])).add(this.bias)}predict(e){return 5===this.dim?this.predict5d(e):4===this.dim?this.predict4d(e):3===this.dim?this.predict3d(e):2===this.dim?this.predict2d(e):(this.dim,this.predict1d(e))}loss(e,t){return e.sub(t).square().mean()}train(e,t){i.tidy(()=>{let s=i.tensor1d(e),n=i.tensor1d(t);this.optimizer.minimize(()=>this.loss(this.predict(s),n))})}constructor(e=0){this.weights=[],this.dim=3,this.leraningRate=.2,this.dim=e;for(let e=0;e<5;++e){let e=i.variable(i.scalar(2*Math.random()-1));e.print(),this.weights.push(e)}this.bias=i.variable(i.scalar(2*Math.random()-1)),this.optimizer=i.train.adam(this.leraningRate)}}},88876:function(e,t,s){"use strict";s.d(t,{NJSCORE:function(){return o},PolynomialRegression:function(){return r.P},RendererThree:function(){return i.T}});var i=s(14540),n=s(45169);s.o(n,"AStart")&&s.d(t,{AStart:function(){return n.AStart}}),s.o(n,"COLOR_BLENDING")&&s.d(t,{COLOR_BLENDING:function(){return n.COLOR_BLENDING}}),s.o(n,"Graph")&&s.d(t,{Graph:function(){return n.Graph}}),s.o(n,"KNN")&&s.d(t,{KNN:function(){return n.KNN}}),s.o(n,"LinearRegression")&&s.d(t,{LinearRegression:function(){return n.LinearRegression}}),s.o(n,"LinearRegressionGradientDescent")&&s.d(t,{LinearRegressionGradientDescent:function(){return n.LinearRegressionGradientDescent}}),s.o(n,"MercatorProjection")&&s.d(t,{MercatorProjection:function(){return n.MercatorProjection}}),s.o(n,"PolynomialRegression")&&s.d(t,{PolynomialRegression:function(){return n.PolynomialRegression}}),s.o(n,"RGBtoGray")&&s.d(t,{RGBtoGray:function(){return n.RGBtoGray}}),s.o(n,"RendererCanvas")&&s.d(t,{RendererCanvas:function(){return n.RendererCanvas}}),s.o(n,"RendererJSAPI")&&s.d(t,{RendererJSAPI:function(){return n.RendererJSAPI}}),s.o(n,"TypeDithering")&&s.d(t,{TypeDithering:function(){return n.TypeDithering}}),s.o(n,"Vector3")&&s.d(t,{Vector3:function(){return n.Vector3}}),s.o(n,"buildNetwork")&&s.d(t,{buildNetwork:function(){return n.buildNetwork}}),s.o(n,"crossProduct")&&s.d(t,{crossProduct:function(){return n.crossProduct}}),s.o(n,"deepCopy")&&s.d(t,{deepCopy:function(){return n.deepCopy}}),s.o(n,"distanceEuclidean")&&s.d(t,{distanceEuclidean:function(){return n.distanceEuclidean}}),s.o(n,"distanceTo")&&s.d(t,{distanceTo:function(){return n.distanceTo}}),s.o(n,"dithering4_4")&&s.d(t,{dithering4_4:function(){return n.dithering4_4}}),s.o(n,"ditheringFloydSteinberg")&&s.d(t,{ditheringFloydSteinberg:function(){return n.ditheringFloydSteinberg}}),s.o(n,"getArrayBinaryImgFromCtx")&&s.d(t,{getArrayBinaryImgFromCtx:function(){return n.getArrayBinaryImgFromCtx}}),s.o(n,"getCSVFromURL")&&s.d(t,{getCSVFromURL:function(){return n.getCSVFromURL}}),s.o(n,"getCheckBox")&&s.d(t,{getCheckBox:function(){return n.getCheckBox}}),s.o(n,"getImgFromURL")&&s.d(t,{getImgFromURL:function(){return n.getImgFromURL}}),s.o(n,"getJSONFromURL")&&s.d(t,{getJSONFromURL:function(){return n.getJSONFromURL}}),s.o(n,"getLineSeg")&&s.d(t,{getLineSeg:function(){return n.getLineSeg}}),s.o(n,"getRandomHex")&&s.d(t,{getRandomHex:function(){return n.getRandomHex}}),s.o(n,"getSlider")&&s.d(t,{getSlider:function(){return n.getSlider}}),s.o(n,"getUUID")&&s.d(t,{getUUID:function(){return n.getUUID}}),s.o(n,"hex2RGBA")&&s.d(t,{hex2RGBA:function(){return n.hex2RGBA}}),s.o(n,"isInsideOfVecs")&&s.d(t,{isInsideOfVecs:function(){return n.isInsideOfVecs}}),s.o(n,"normalize")&&s.d(t,{normalize:function(){return n.normalize}}),s.o(n,"reflect")&&s.d(t,{reflect:function(){return n.reflect}}),s.o(n,"remap")&&s.d(t,{remap:function(){return n.remap}}),s.o(n,"shuffleArray")&&s.d(t,{shuffleArray:function(){return n.shuffleArray}});var r=s(21322),o=s(8483)},14540:function(e,t,s){"use strict";s.d(t,{T:function(){return r}});var i=s(97776),n=s(78252);class r{initCanvas(){this.scene=new i.xsS,this.scene.background=new i.Ilk(0),this.scene.castShadow=!0,this.renderer=new i.CP7({antialias:!0,alpha:!0}),this.renderer.setPixelRatio(this.hostDiv.clientWidth/this.hostDiv.clientHeight),this.renderer.domElement.id="Three",this.renderer.domElement.style.position="absolute",this.renderer.shadowMap.enabled=!0,this.renderer.setSize(this.hostDiv.clientWidth,this.hostDiv.clientHeight),this.hostDiv.appendChild(this.renderer.domElement),this.camera=new i.cPb(30,this.hostDiv.clientWidth/this.hostDiv.clientHeight,1,5e3),this.controls=new n.OrbitControls(this.camera,this.renderer.domElement),this.camera.position.set(0,0,5),this.controls.update(),this.canvas=this.renderer.domElement,this.init()}init(){this.eventBind()}eventBind(){this.renderer.domElement.onmousedown=e=>this.mouseDown(e),this.renderer.domElement.onmouseup=e=>this.mouseUp(e),this.renderer.domElement.onmousemove=e=>this.mouseMove(e),this.renderer.domElement.addEventListener("click",e=>this.mouseClick(e)),window.addEventListener("resize",()=>this.onWindowResize())}onWindowResize(){this.camera.aspect=this.hostDiv.clientWidth/this.hostDiv.clientHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.hostDiv.clientWidth,this.hostDiv.clientHeight)}start(){this.loop()}mouseDown(e){}mouseUp(e){}mouseClick(e){}mouseDClick(e){}mouseMove(e){}mouseDrag(e){}update(e){}destroy(){for(window.removeEventListener("resize",()=>this.onWindowResize()),cancelAnimationFrame(this.requestFrame),this.requestFrame=void 0;this.hostDiv.lastChild;)this.hostDiv.removeChild(this.hostDiv.lastChild)}constructor(e){this.t=0,this.requestFrame=void 0,this.loop=()=>{this.requestFrame=requestAnimationFrame(this.loop),this.controls.update(),this.update(this.scene),this.renderer.render(this.scene,this.camera),this.t+=.01},this.hostDiv=document.getElementById(e),this.initCanvas()}}},6259:function(e,t,s){"use strict";s.r(t),s.d(t,{Solution:function(){return Q}});var i=s(77719),n=s.n(i);class r{initMap(e){n().accessToken="pk.eyJ1IjoiZGVzaWduanUiLCJhIjoiY2xhNGU0YWo4MDlhYzNwdHBwenVvang4eiJ9.P3sX4l_3KjdPeRRbVS1VVg",this.map=new(n()).Map({container:e,zoom:13,center:[-73.97646684462907,40.76334819495341],style:"mapbox://styles/mapbox/dark-v10"}),this.map.dragRotate.disable(),this.map.on("mousemove",e=>{this.mouseMove(e)}),this.map.on("click",e=>{this.mouseClick(e)}),this.map.on("mousedown",e=>{this.mouseDown(e)}),this.map.on("dblclick",e=>{this.mouseDClick(e)}),this.map.on("mouseup",e=>{this.mouseUp(e)});let t=document.getElementsByClassName("mapboxgl-canvas")[0];t.style.position="absolute",(t=document.getElementsByClassName("mapboxgl-control-container")[0]).style.display="none"}constructor(e){var t=this;this.dd=()=>{},this.center=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-99.292649,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:39.043903;t.map.setCenter({lat:s,lng:e})},this.toMap=(e,t)=>{let s=this.map.unproject({x:e,y:t});return[s.lng,s.lat]},this.toScreen=(e,t)=>{let s=this.map.project([e,t]);return[s.x,s.y]},this.mouseDown=e=>{},this.mouseUp=e=>{},this.mouseMove=e=>{},this.mouseClick=e=>{},this.mouseDClick=e=>{},this.initMap(e)}}var o=s(88876);class h extends o.RendererCanvas{render(e){this.time+=.1,this.offscreen.reset(),this.app.controller&&this.app.controller.render(e,this.offscreen.ctx)}constructor(e,t){super(e),this.time=0,this.pts=[],this.mouseDown=(e,t)=>{},this.mouseUp=(e,t)=>{},this.mouseDrag=(e,t)=>{},this.app=t,this.canvas.id="mapboxCustom",this.canvas.style.position="absolute",this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.pointerEvents="none",this.offscreen=new d(this.canvas),this.start()}}class d{appendCanvas(){this.refCanvas.parentElement.appendChild(this.canvas)}destroy(){window.removeEventListener("resize",this.resize);try{for(;void 0!==this.refCanvas&&void 0!==this.refCanvas.lastElementChild;)this.refCanvas.removeChild(this.refCanvas.lastElementChild)}catch(e){}}reset(){this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height)}constructor(e){this.getPix=(e,t)=>this.ctx.getImageData(e,t,1,1).data,this.resize=()=>{let e=this.refCanvas.getBoundingClientRect();this.canvas.width=e.width,this.canvas.height=e.height},this.refCanvas=e,this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.canvas.style.background="rgba(255, 0, 0, 0.12)",this.canvas.style.zIndex="10",this.canvas.style.position="absolute",this.canvas.style.pointerEvents="none",this.canvas.style.display="none",window.addEventListener("resize",this.resize),this.resize(),this.appendCanvas()}}class a{constructor(e,t,s=0){this.x=e,this.y=t,this.z=s}}let l=(e,t)=>Math.sqrt(c(e,t)),c=(e,t)=>(e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y)+(e.z-t.z)*(e.z-t.z),p=(e,t,s,i,n,r,o,h)=>{if(e===s&&t===i||n===o&&r===h)return;let d=(h-r)*(s-e)-(o-n)*(i-t);if(0===d)return;let a=((o-n)*(t-r)-(h-r)*(e-n))/d,l=((s-e)*(t-r)-(i-t)*(e-n))/d;if(!(a<0)&&!(a>1)&&!(l<0)&&!(l>1))return[e+a*(s-e),t+a*(i-t)]},u=(e,t,s)=>e+s*(t-e),g=(e,t,s)=>{let i=s.x-t.x,n=s.y-t.y,r=((e.x-t.x)*i+(e.y-t.y)*n)/(i*i+n*n);return new a(u(t.x,s.x,r),u(t.y,s.y,r))},m=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"download",s=document.createElement("a");s.href="data:application/json;charset=utf-8,"+encodeURIComponent(e),s.download="".concat(t),s.click()},v=()=>[Math.floor(255*Math.random()),Math.floor(255*Math.random()),Math.floor(255*Math.random())];class f{constructor(){this.type="node",this.isSelected=!1,this.id=0,this.visited=!1,this.data=[]}}class y{constructor(e){this.nodes=[],this.edges=[],this.nodesHash={},this.graphSystem=e}}class S extends f{getLength(){return this.length=l(this.n0.vec,this.n1.vec),this.length}toJSON(){return{id:this.id,n0:this.n0.id,n1:this.n1.id,data:this.data}}remove(){this.n0.removeEdge(this),this.n1.removeEdge(this)}constructor(e,t){super(),this.length=-1,this.color=v(),this.type="edge",this.n0=e,this.n1=t}}class x extends f{reset(){this.networkDistance=-1,this.countVisit=0,this.visited=!1}toJSON(){return{id:this.id,vec:{x:this.vec.x,y:this.vec.y,z:this.vec.z},data:this.data}}remove(){this.graph.graphSystem.removeNode(this)}removeEdge(e){this.edges.splice(this.edges.indexOf(e),1)}constructor(e,t,s,i=0){super(),this.edges=[],this.r=5,this.networkDistance=-1,this.countVisit=0,this.color=v(),this.graph=e,this.type="node",this.vec=new a(t,s,i)}}let E=e=>{let t=0,s=[],i=[];for(e.visited=!0,i.push(e),s.push(e);i.length>0;){let e=i.shift();for(let t=0;t<e.edges.length;++t){let n=e.edges[t],r=n.n0===e?n.n1:n.n0;r.visited||(r.visited=!0,s.push(r),i.push(r))}if(t++>1e5)return}return s},C=e=>{let t=[],s=e=>{if(!e.visited){e.visited=!0,t.push(e);for(let t=0;t<e.edges.length;++t){let i=e.edges[t];s(i.n0===e?i.n1:i.n0)}}};return s(e),t},w=(e,t,s)=>(k(e.nodes,t,D,.1),N(e.nodes,s)),b=(e,t,s,i,n,r)=>Math.sqrt((e-i)*(e-i)+(t-n)*(t-n)+(s-r)*(s-r)),D=function(e,t){return arguments.length>2&&void 0!==arguments[2]&&arguments[2],b(e.vec.x,e.vec.y,e.vec.z,t.vec.x,t.vec.y,t.vec.z)},k=function(e,t,s){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;void 0===s&&(s=D);for(let t=0;t<e.length;++t)e[t].reset();let n=[t];t.networkDistance=0;for(let e=0;e<1e7&&0!==n.length;++e){let e=n[0];n.shift();for(let t=0;t<e.edges.length;++t){let r=e.edges[t],o=e===r.n0?r.n1:r.n0,h=s(e,o,i),d=e.networkDistance+h;(-1===o.networkDistance||d<o.networkDistance)&&(o.networkDistance=d,n.push(o))}}},N=(e,t)=>{let s=0,i=0,n=[];if(-1!==t.networkDistance){n.push(e[t.id]);let r=t;for(s=0;s<1e5;++s){let t=r;for(t.countVisit++,i=0;i<r.edges.length;++i){let e=r.edges[i],s=r===e.n0?e.n1:e.n0;s.networkDistance<t.networkDistance&&(t=s)}if(t===r)break;r=t,n.push(e[r.id])}}return n},M=(e,t,s)=>{let i=[];for(let t=0;t<e.nodes.length;++t){let s=e.nodes[t],n=new R(s.vec.x,s.vec.y,s.vec.z);n.id=s.id,i.push(n)}let n=[];for(let t=0;t<e.edges.length;++t){let s=e.edges[t],r=new T(i[s.n0.id],i[s.n1.id]);n.push(r)}return P.gePath(i[t.id],i[s.id])};class P{}P.TYPE={Manhattan:"Manhattan  ",Euclidean:"Euclidean "},P.strength=.01,P.distanceManhattan=(e,t,s,i,n,r)=>Math.abs(e-i)+Math.abs(t-n)+Math.abs(s-r),P.distanceEuclidean=(e,t,s,i,n,r)=>Math.sqrt((e-i)*(e-i)+(t-n)*(t-n)+(s-r)*(s-r)),P.gePath=(e,t,s)=>{let i;P.typeHeuristic=P.distanceEuclidean,s===P.TYPE.Manhattan&&(P.typeHeuristic=P.distanceManhattan);let n=[e],r=[],o=100;for(;o--&&(void 0===(i=P.propagation(n,r,t))||!i.length););return i},P.path=[],P.propagation=(e,t,s)=>{if(!(e.length>0))return P.path;{let i=0;for(let t=0;t<e.length;t++)e[t].f<e[i].f&&(i=t),e[t].f===e[i].f&&e[t].g>e[i].g&&(i=t);let n=e[i];if(n===s)return[n,n.previous,...P.path];P.path=[];let r=n;for(;r.previous&&(P.path.push(r.previous),(r=r.previous).previous!==P.path[P.path.length-2]););e.splice(e.indexOf(n),1),t.push(n);let o=n.neighbors;for(let i=0;i<o.length;i++){let r=o[i];if(!t.includes(r)&&!r.blocked){let t=n.g+P.heuristic(r,n)*P.strength;if(e.includes(r))continue;e.push(r),r.g=t,r.h=P.heuristic(r,s),r.f=r.g+r.h,r.previous=n}}return}},P.heuristic=(e,t)=>P.typeHeuristic(e.x,e.y,e.z,t.x,t.y,t.z);class R{constructor(e,t,s){this.id=-1,this.f=0,this.h=0,this.g=0,this.x=0,this.y=0,this.z=0,this.neighbors=[],this.edges=[],this.previous=void 0,this.blocked=!1,this.x=e,this.y=t,this.z=s}}class T{constructor(e,t){this.id=-1,this.n0=e,this.n1=t,this.n0.edges.push(this),this.n1.edges.push(this),e.neighbors.push(t),t.neighbors.push(e)}}class I{addVertex(e){this.nodes.push(e)}addEdge(e,t,s){this.edges.push({n0:e,n1:t,weight:s})}primMST(e){let t={},s=[];for(t[e]=!0;s.length<this.nodes.length-1;){let e=null;if(this.edges.forEach(s=>{(t[s.n0]&&!t[s.n1]||!t[s.n0]&&t[s.n1])&&(!e||s.weight<e.weight)&&(e=s)}),!e)break;s.push(e),t[e.n0]=!0,t[e.n1]=!0}return s}constructor(){this.nodes=[],this.edges=[],this.nodes=[],this.edges=[]}}let L=e=>{let t=new I;for(let s=0;s<e.nodes.length;++s)t.addVertex(e.nodes[s].id);for(let s=0;s<e.edges.length;++s){let i=e.edges[s];t.addEdge(i.n0.id,i.n1.id,i.getLength())}return t.primMST(0)};class B{get captured(){return this._captured}set captured(e){this._captured&&(this._captured.isSelected=!1),this._captured=e,e&&(this._captured.isSelected=!0)}resetCapture(){this.captured=void 0,this.nodePre=void 0}getPix(e,t){return new Uint8ClampedArray}addNode(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2];let s=new x(this.graph,e,t,0);return this.graph.nodes.push(s),this.graph.nodesHash[s.color.join()]=s,this.resetCapture(),s}addEdge(e,t){if(e===t||this.findEdgeByNodes(e,t))return;let s=new S(e,t);return e.edges.push(s),t.edges.push(s),this.graph.edges.push(s),this.edgeSplitByEdge(s),this.resetCapture(),s}addEdgeByClosestNode(e){let t=this.findNode(e);t&&this.addEdge(e,t),this.resetCapture()}addEdgeSplit(e,t){let s=new S(e,t);return e.edges.push(s),t.edges.push(s),this.graph.edges.push(s),s}edgeSplitByNode(e,t){let s=t.n0,i=t.n1;this.addEdge(s,e),this.addEdge(e,i),this.removeEdge(t),this.resetCapture()}edgeSplitByNodeEdges(e){let t=[],s=e.edges.length;for(let i=0;i<s;++i){let s=e.edges[i],n=[];for(let e=this.graph.edges.length-1;e>-1;--e){let t=this.graph.edges[e];if(s.n0!==t.n0&&s.n0!==t.n1&&s.n1!==t.n0&&s.n1!==t.n1){let e=O(s,t);if(e){let s=new x(this.graph,e[0],e[1]);this.graph.nodesHash[s.color.join()]=s,this.graph.nodes.push(s),this.addEdgeSplit(s,t.n0),this.addEdgeSplit(s,t.n1),this.removeEdge(t),n.push(s)}}}if(n.length>0){let e=s.n0;n.push(s.n1);let i=n.map(e=>l(e.vec,s.n0.vec)),r=i.map((e,t)=>t).sort((e,t)=>i[e]-i[t]);this.addEdgeSplit(e,n[r[0]]);for(let e=0;e<r.length-1;++e)this.addEdgeSplit(n[r[e]],n[r[e+1]]);t.push(s),this.graph.edges.splice(this.graph.edges.indexOf(s),1)}}return t.forEach(e=>{e.n0.removeEdge(e),e.n1.removeEdge(e)}),0!==t.length&&(this.updateID(),!0)}edgeSplitByEdge(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],s=[];for(let t=this.graph.edges.length-1;t>-1;--t){let i=this.graph.edges[t];if(e.n0!==i.n0&&e.n0!==i.n1&&e.n1!==i.n0&&e.n1!==i.n1){let t=O(e,i);if(t){let e=new x(this.graph,t[0],t[1]);this.graph.nodes.push(e),this.graph.nodesHash[e.color.join()]=e,this.addEdgeSplit(e,i.n0),this.addEdgeSplit(e,i.n1),this.removeEdge(i),s.push(e)}}}if(s.length>0){let t=e.n0;s.push(e.n1);let i=s.map(t=>l(t.vec,e.n0.vec)),n=i.map((e,t)=>t).sort((e,t)=>i[e]-i[t]);this.addEdgeSplit(t,s[n[0]]);for(let e=0;e<n.length-1;++e)this.addEdgeSplit(s[n[e]],s[n[e+1]]);this.removeEdge(e)}t&&this.updateID()}removeNode(e){e.edges.forEach(t=>{t.n0===e?t.n1.removeEdge(t):t.n0.removeEdge(t),this.graph.edges.splice(this.graph.edges.indexOf(t),1)}),this.graph.nodes.splice(this.graph.nodes.indexOf(e),1),delete this.graph.nodesHash[e.color.join()],this.updateID(),this.resetCapture()}removeEdge(e){e.n0.removeEdge(e),e.n1.removeEdge(e),this.graph.edges.splice(this.graph.edges.indexOf(e),1)}findNode(e){let t=Number.MAX_VALUE,s=-1;for(let i=0;i<this.graph.nodes.length;++i){if(this.graph.nodes[i]===e)continue;let n=l(this.graph.nodes[i].vec,e.vec);t>n&&(t=n,s=i)}if(s>-1)return this.graph.nodes[s]}findNodeVec(e,t){arguments.length>2&&void 0!==arguments[2]?arguments[2]:B.minDis;let s=this.getPix(e,t);if(s){let e=new Uint8ClampedArray(s.subarray(0,s.length-1)),t=this.graph.nodesHash[e.join()];if(t)return t}}findEdgeVec(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:B.minDis,i=new a(e,t,0);for(let e=0;e<this.graph.edges.length;++e){let t=this.graph.edges[e],n=g(i,t.n0.vec,t.n1.vec);if(l(i,n)<s)return{edge:t,vec:n}}}findEdgeByEdge(e){return this.findEdgeByNodes(e.n0,e.n1)}findEdgeByNodes(e,t){for(let s=0;s<this.graph.edges.length;++s){let i=this.graph.edges[s];if(e===i.n0&&t===i.n1||e===i.n1&&t===i.n0)return i}}getEdgeByTwoNode(e,t){for(let s=0;s<this.graph.edges.length;++s){let i=this.graph.edges[s];if(i.n0===e&&i.n1===t||i.n0===t&&i.n1===e)return i}}mergeTwoNodes(e,t){let s=[];for(let e=0;e<t.edges.length;++e){let i=t.edges[e];i.n0===t?s.push(i.n1):s.push(i.n0)}t.remove(),s.forEach(t=>{this.getEdgeByTwoNode(e,t)||this.addEdge(e,t)})}updateID(){for(let e=0;e<this.graph.nodes.length;++e)this.graph.nodes[e].id=e;for(let e=0;e<this.graph.edges.length;++e)this.graph.edges[e].id=e}resetVisit(){for(let e=0;e<this.graph.nodes.length;++e)this.graph.nodes[e].visited=!1}setNodeStart(){this.captured&&(this.nodeStart=this.captured)}setNodeEnd(){this.captured&&(this.nodeEnd=this.captured)}computePath(){if(this.nodeStart&&this.nodeEnd)return j(this.graph,this.nodeStart.id,this.nodeEnd.id)}computePathAStar(){if(this.nodeStart&&this.nodeEnd)return H(this.graph,this.nodeStart.id,this.nodeEnd.id)}computeMST(){let e=z(this.graph);return this.pathMST=e,e}computeBFS(){return this.resetVisit(),E(this.graph.nodes[0]).map(e=>e.id)}computeDFS(){return this.resetVisit(),C(this.graph.nodes[0]).map(e=>e.id)}constructor(){this.pathMST=void 0,this.nodeStart=void 0,this.nodeEnd=void 0,this.nodePre=void 0,this._captured=void 0,this.graph=new y(this)}}B.minDis=1e-5;let O=(e,t)=>U(e.n0,e.n1,t.n0,t.n1),U=(e,t,s,i)=>p(e.vec.x,e.vec.y,t.vec.x,t.vec.y,s.vec.x,s.vec.y,i.vec.x,i.vec.y),z=e=>L(e),j=(e,t,s)=>w(e,e.nodes[t],e.nodes[s]),H=(e,t,s)=>M(e,e.nodes[t],e.nodes[s]);class F{reset(){this.histories=[],this.currentIndex=-1}push(e){this.currentIndex<this.histories.length-1&&this.histories.splice(this.currentIndex+1,this.histories.length),this.histories.push(e),this.currentIndex=this.histories.length-1}getCurrentIndex(){return this.currentIndex}getHistoryLength(){return this.histories.length}getCurrentState(){return{currentIndex:this.getCurrentIndex(),historyNum:this.getHistoryLength()}}undo(){if(0!==this.currentIndex)return this.currentIndex--,this.histories[this.currentIndex]}redo(){return this.currentIndex++,this.currentIndex=this.currentIndex<this.histories.length?this.currentIndex:this.histories.length-1,this.histories[this.currentIndex]}constructor(){this.histories=[],this.currentIndex=-1}}class A{getLog(){return this.manager.getCurrentState()}resetState(){this.manager.reset(),this.captureState([])}captureState(e){return this.manager.push(e),this.manager.getCurrentState()}undo(){return this.manager.undo()}redo(){return this.manager.redo()}constructor(){this.manager=new F}}class W{reset(){let e=this.controller.graphSystem.graph;e.nodes=[],e.edges=[],this.capture()}capture(){this.sceneState.captureState(this.toJSON()),this.updateUndoRedoHist()}updateUndoRedoHist(){if(this.controller.divHist){let e=this.sceneState.getLog();this.controller.divHist.textContent="hist: ".concat(e.currentIndex,"/").concat(e.historyNum-1)}}setCommandMode(e){this.controller.commandMode=e}undo(){let e=this.sceneState.undo();e&&this.dump(e),this.updateUndoRedoHist(),this.controller.graphSystem.resetCapture()}redo(){let e=this.sceneState.redo();e&&this.dump(e),this.updateUndoRedoHist(),this.controller.graphSystem.resetCapture()}toJSON(){let e={node:[],edge:[],MST:this.controller.common.computeMST()};return this.controller.graphSystem.graph.nodes.forEach(t=>{e.node.push(t.toJSON())}),this.controller.graphSystem.graph.edges.forEach(t=>{e.edge.push(t.toJSON())}),e}exportJSON(){m(JSON.stringify(this.toJSON()),"graph.json")}dump(e){let t=this.controller.graphSystem;t.graph.nodes=[],t.graph.edges=[];for(let s=0;s<e.node.length;++s){let i=e.node[s],n=t.addNode(i.vec.x,i.vec.y,i.vec.z);n.id=i.id,n.data=i.data}for(let s=0;s<e.edge.length;++s){let i=e.edge[s],n=t.addEdge(t.graph.nodes[i.n0],t.graph.nodes[i.n1]);n.id=i.id,n.data=i.data}}populate(){let e=Math.random()*this.controller.canvas.width,t=Math.random()*this.controller.canvas.height;this.controller.mouseClick(e,t,void 0)}toggleDelaunay(e){this.controller.renderer.toggleDelaunay=e}toggleMST(e){this.controller.renderer.toggleMST=e}computeMST(){return this.controller.graphSystem.computeMST()}computedBSF(){let e=this.controller.graphSystem.computeBFS();this.updateSearchResult("BFS: "+e.join(", "))}computedDFS(){let e=this.controller.graphSystem.computeDFS();this.updateSearchResult("DFS: "+e.join(", "))}updateSearchResult(e){this.controller.divSearchResult.textContent=e}computedDijkstra(e){this.controller.renderer.toggleDijkstra=e}computedAStar(e){this.controller.renderer.toggleAStar=e}removeSelection(){this.controller.graphSystem.captured&&(this.controller.graphSystem.captured.remove(),this.controller.graphSystem.captured=void 0)}addNodeWithClosestNode(e,t){let s=this.graphSystem.addNode(e,t,0);this.graphSystem.addEdgeByClosestNode(s)}constructor(e){this.toScreen=(e,t)=>this.controller.projection(e,t),this.toggleOffscreenBind=e=>{},this.controller=e,this.graphSystem=this.controller.graphSystem,this.sceneState=new A}}var V=s(8483);let G=(e,t,s)=>{new V.oc(t.map(e=>{let t=s(e.vec.x,e.vec.y);return new V.h9(t[0],t[1])})).DrawTriClass(e,"#fff")};class J{projection(e,t){return this.controller.projection(e,t)}render(e,t){if(this.controller.graphSystem.captured?this.controller.divSel.textContent=this.controller.graphSystem.captured.type:this.controller.divSel.textContent="undefined",this.renderNodeStartEnd(e,t),e.beginPath(),e.arc(this.controller.m.x,this.controller.m.y,2,0,6.28),e.closePath(),e.fillStyle="#888",e.fill(),this.toggleMST){this.controller.common.computeMST();let t=this.controller.graphSystem.graph.nodes;e.strokeStyle="#ff0",e.beginPath(),this.controller.graphSystem.pathMST.forEach(s=>{let i=this.controller.common.toScreen(t[s.n0].vec.x,t[s.n0].vec.y),n=this.controller.common.toScreen(t[s.n1].vec.x,t[s.n1].vec.y);e.moveTo(i[0],i[1]),e.lineTo(n[0],n[1])}),e.lineWidth=5,e.stroke()}if(this.toggleDelaunay&&G(e,this.controller.graphSystem.graph.nodes,this.controller.common.toScreen),this.toggleDijkstra&&this.controller.graphSystem.nodeStart&&this.controller.graphSystem.nodeEnd){let t=this.controller.graphSystem.computePath().map(e=>this.controller.common.toScreen(e.vec.x,e.vec.y));e.beginPath(),e.moveTo(t[0][0],t[0][1]);for(let s=1;s<t.length;++s)e.lineTo(t[s][0],t[s][1]);e.strokeStyle="#f0f",e.lineWidth=5,e.stroke()}if(this.toggleAStar&&this.controller.graphSystem.nodeStart&&this.controller.graphSystem.nodeEnd){let t=this.controller.graphSystem.computePathAStar().map(e=>this.controller.common.toScreen(e.x,e.y));e.beginPath(),e.moveTo(t[0][0],t[0][1]);for(let s=1;s<t.length;++s)e.lineTo(t[s][0],t[s][1]);e.strokeStyle="#f0f",e.lineWidth=5,e.stroke()}this.renderGraph(e,t)}renderNodeStartEnd(e,t){if(e.fillStyle="#0ff",this.controller.graphSystem.nodeStart){let t=this.controller.graphSystem.nodeStart.vec;e.beginPath(),e.arc(t.x,t.y,8,0,2*Math.PI),e.closePath(),e.fill()}if(this.controller.graphSystem.nodeEnd){let t=this.controller.graphSystem.nodeEnd.vec;e.beginPath(),e.arc(t.x,t.y,8,0,2*Math.PI),e.closePath(),e.fill()}}renderGraph(e,t){this.controller.log="N:".concat(this.controller.graphSystem.graph.nodes.length,", E:").concat(this.controller.graphSystem.graph.edges.length),this.controller.graphSystem.graph.edges.forEach(s=>{this.renderGraphEdge(e,t,s)}),this.controller.graphSystem.graph.nodes.forEach(s=>{this.renderGraphNode(e,t,s)})}renderGraphNode(e,t,s){let i=this.projection(s.vec.x,s.vec.y);e.beginPath(),e.arc(i[0],i[1],s.r,0,6.28),e.closePath(),e.fillStyle="#ff0000",e.fill(),s.isSelected&&(e.lineWidth=3,e.strokeStyle="#00f",e.stroke()),e.strokeStyle="#ff0000",e.lineWidth=1,e.strokeText("".concat(s.networkDistance),i[0],i[1]-20),e.strokeText("".concat(s.id),i[0],i[1]-7),t.beginPath(),t.arc(i[0],i[1],s.r+1,0,6.28),t.closePath(),t.fillStyle="rgb(".concat(s.color.join(),")"),t.fill()}renderGraphEdge(e,t,s){if(s.isSelected){e.lineWidth=3,e.strokeStyle="#00f",e.beginPath();let t=this.projection(s.n0.vec.x,s.n0.vec.y);e.moveTo(t[0],t[1]),t=this.projection(s.n1.vec.x,s.n1.vec.y),e.lineTo(t[0],t[1]),e.stroke()}e.lineWidth=1,e.beginPath();let i=this.projection(s.n0.vec.x,s.n0.vec.y);e.moveTo(i[0],i[1]),i=this.projection(s.n1.vec.x,s.n1.vec.y),e.lineTo(i[0],i[1]),e.strokeStyle="#0f0",e.stroke(),e.strokeStyle="#00ff00",e.lineWidth=1;let n=s.n0.vec.x+(s.n1.vec.x-s.n0.vec.x)*.5,r=s.n0.vec.y+(s.n1.vec.y-s.n0.vec.y)*.5;i=this.projection(n,r),e.strokeText("".concat(s.id),i[0],i[1]-7)}constructor(e){this.toggleDelaunay=!1,this.toggleMST=!1,this.toggleDijkstra=!1,this.toggleAStar=!1,this.controller=e}}class _{mouseDown(e,t,s){let i=this.graphSystem.findNodeVec(s.point.x,s.point.y);this.graphSystem.captured&&this.graphSystem.captured!==i&&(this.graphSystem.nodePre=this.graphSystem.captured),this.graphSystem.captured=i,this.pressed=!0}mouseClick(e,t,s){if(this.graphSystem.captured=this.graphSystem.findNodeVec(s.point.x,s.point.y),void 0===this.graphSystem.captured){this.common.addNodeWithClosestNode(e,t),this.common.capture(),this.updatePost();return}}mouseMove(e,t){this.m.x=e,this.m.y=t}mouseUp(){let e=!1;if(this.graphSystem.captured&&"node"===this.graphSystem.captured.type){let t=this.graphSystem.captured;e=this.graphSystem.edgeSplitByNodeEdges(t);let s=this.graphSystem.findNode(t);if(s){let i=this.common.toScreen(t.vec.x,t.vec.y),n=this.common.toScreen(s.vec.x,s.vec.y);16>l(new a(i[0],i[1],0),new a(n[0],n[1],0))&&(this.graphSystem.mergeTwoNodes(s,t),e=!0)}this.wasMoved&&(this.wasMoved=!1,e=!0),this.graphSystem.captured=void 0,this.updatePost()}e&&this.common.capture(),this.pressed=!1}mouseDrag(e,t){if(this.graphSystem.captured&&"node"===this.graphSystem.captured.type){let s=this.graphSystem.captured;s.vec.x=e,s.vec.y=t}this.wasMoved=!0}updatePost(){this.renderer.toggleMST&&this.graphSystem.computeMST()}render(e,t){this.needPopulate&&this.populate(),this.divLog.textContent=this.log,this.renderer.render(e,t)}exportJSON(){return this.common.exportJSON()}populate(){return this.common.populate()}constructor(e){this.commandMode="drawing",this.needPopulate=!1,this.m=new a(0,0,0),this.log="",this.wasMoved=!1,this.pressed=!1,this.projection=(e,t)=>[e,t],this.graphSystem=new B,this.common=new W(this),this.renderer=new J(this),this.canvas=e}}class q{initUI(){let e=document.createElement("div");e.style.width="160px",e.style.position="absolute",e.style.background="#222",e.style.padding="10px",this.app.divHost.appendChild(e);let t=document.createElement("button");t.textContent="remove",t.onclick=()=>{this.app.controller.common.removeSelection()},e.appendChild(t);let s=document.createElement("div");s.textContent="N:0, E:0",s.style.color="#bbb",e.appendChild(s),this.app.controller.divLog=s;let i=document.createElement("div");i.textContent="hist: 0",i.style.color="#bbb",e.appendChild(i),this.app.controller.divHist=i;let n=document.createElement("div");n.textContent="undefined",n.style.color="#bbb",e.appendChild(n),this.app.controller.divSel=n;let r=X();e.appendChild(r);let o=K("Delaunay",e=>{this.app.controller.common.toggleDelaunay(e)});e.appendChild(o.div);let h=K("MST",e=>{this.app.controller.common.toggleMST(e)});e.appendChild(h.div);let d=Y("DFS",()=>{this.app.controller.common.computedDFS()});e.appendChild(d);let a=Y("BFS",()=>{this.app.controller.common.computedBSF()});e.appendChild(a);let l=document.createElement("div"),c=document.createElement("p");c.style.marginTop="2px",l.appendChild(c),e.appendChild(l),this.app.controller.divSearchResult=c;let p=K("Dijkstra",e=>{this.app.controller.common.computedDijkstra(e)});e.appendChild(p.div);let u=K("*Star",e=>{this.app.controller.common.computedAStar(e)});e.appendChild(u.div);let g=Y("Start",()=>{this.app.controller.common.graphSystem.setNodeStart()});e.appendChild(g);let m=Y("End",()=>{this.app.controller.common.graphSystem.setNodeEnd()});e.appendChild(m);let v=K("Offscreen",e=>{this.app.controller.common.toggleOffscreenBind(e)});e.appendChild(v.div);let f=X();e.appendChild(f);let y=Z(["Selection","Drawing Line","Drawing Pline"],e=>{console.log({v:e}),this.app.controller.common.setCommandMode(e)});e.appendChild(y);let S=document.createElement("div");S.style.background="#111",S.style.margin="5px",S.style.height="100px",e.appendChild(S);let x=Y("undo",()=>{this.app.controller.common.undo()});S.appendChild(x);let E=Y("redo",()=>{this.app.controller.common.redo()});S.appendChild(E);let C=document.createElement("button");C.textContent="Export JSON",S.appendChild(C),C.onclick=()=>{this.app.controller.exportJSON()};let w=Y("reset",()=>{this.app.controller.common.reset()});S.appendChild(w);let b=document.createElement("button");b.textContent="run",b.onclick=()=>{this.app.controller.needPopulate=!this.app.controller.needPopulate},S.appendChild(b)}constructor(e){this.app=e,this.initUI()}}let Y=(e,t)=>{let s=document.createElement("button");return s.textContent=e,s.onclick=()=>{t()},s},K=(e,t)=>{let s=document.createElement("div");s.style.display="flex";let i=document.createElement("input");i.type="checkbox",i.defaultChecked=!1;let n=document.createElement("div");return n.textContent=e,n.style.color="#aaa",s.appendChild(i),s.appendChild(n),i.onchange=()=>t(i.checked),{div:s,checkBox:i}},X=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"#fff",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=document.createElement("div");return s.style.background=e,s.style.height=t+"px",s},Z=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:["A","B","C"],t=arguments.length>1?arguments[1]:void 0,s=document.createElement("div");s.style.background="#111",s.style.margin="5px",s.style.height="100px",s.style.display="grid";let i=document.createElement("div");return i.textContent="Command Mode",s.appendChild(i),e.forEach(e=>{let i=document.createElement("label");i.className="radio-item";let n=document.createElement("input");n.type="radio",n.name="ratio",n.value=e;let r=document.createTextNode(e);i.appendChild(n),i.appendChild(r),s.appendChild(i),n.addEventListener("change",function(){t(this.value)})}),s};class Q{keyDown(e){}destroy(){this.renderer.destroy();try{for(;this.divHost&&this.divHost.lastElementChild;){let e=this.divHost.lastElementChild;this.divHost.removeChild(e)}}catch(e){console.error("Error removing child elements:",e)}}initPost(){this.controller.common.toggleOffscreenBind=e=>{e?this.renderer.offscreen.canvas.style.display="block":this.renderer.offscreen.canvas.style.display="none"},this.controller.common.graphSystem.getPix=(e,t)=>this.renderer.offscreen.getPix(e,t)}constructor(e){this.mouseDown=e=>{this.controller.mouseDown(e.lngLat.lng,e.lngLat.lat,e),this.controller.graphSystem.captured&&this.mapboxWrapper.map.dragPan.disable()},this.mouseUp=e=>{this.controller.mouseUp()},this.mouseDrag=e=>{this.mapboxWrapper.map.dragPan.disable(),this.controller.mouseDrag(e.lngLat.lng,e.lngLat.lat)},this.mouseClick=e=>{this.controller.mouseClick(e.lngLat.lng,e.lngLat.lat,e)},this.mouseMove=e=>{if(this.controller.pressed){this.mouseDrag(e);return}this.mapboxWrapper.map.dragPan.enable(),this.controller.mouseMove(e.lngLat.lng,e.lngLat.lat)},this.divHost=document.getElementById(e),this.divHost.style.position="relative",this.mapboxWrapper=new r(this.divHost.id),this.mapboxWrapper.mouseDown=this.mouseDown,this.mapboxWrapper.mouseUp=this.mouseUp,this.mapboxWrapper.mouseClick=this.mouseClick,this.mapboxWrapper.mouseMove=this.mouseMove,setTimeout(()=>{this.renderer=new h(this.divHost,this),this.controller=new _(this.renderer.canvas),this.controller.projection=(e,t)=>this.mapboxWrapper.toScreen(e,t),this.ui=new q(this),this.initPost()},100)}}}}]);