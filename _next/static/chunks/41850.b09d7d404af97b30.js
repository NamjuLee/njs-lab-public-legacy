"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[41850],{4606:function(t,i,e){e.r(i),e.d(i,{Clustering:function(){return c},OPTIMIZER:function(){return n}});var s,n,h=e(5336);(s=n||(n={})).NONE="NONE",s.GRID="GRID",s.GRID_SCREEN="GRID_SCREEN",s.COLLISION="COLLISION",s.AGENT="AGENT";class r{update(t,i){this.initGrid(t,i)}initGrid(t,i){this.cells=[],this.xInterval=t/(this.rx-1),this.yInterval=i/(this.ry-1);for(let t=0;t<this.ry;t++){let i=[];for(let e=0;e<this.rx;e++)i.push(new o(this,e,t));this.cells.push(i)}for(let t=0;t<this.points.length;++t){let i=this.points[t];this.getCellAtPoint(i).push(i)}for(let t=0;t<this.ry;++t)for(let i=0;i<this.rx;++i)this.cells[t][i].points.length<2&&(this.cells[t][i].isRenderable=!1)}getCellAtPoint(t){let i=Math.round(t.x/this.xInterval),e=Math.round(t.y/this.yInterval);return i>=this.rx&&(i=this.rx-1),e>=this.ry&&(e=this.ry-1),i<0&&(i=0),e<0&&(e=0),this.cells[e][i]}render(t){for(let i=0;i<this.cells.length;i++)for(let e=0;e<this.cells[i].length;e++)this.cells[i][e].draw(t)}constructor(){this.xInterval=0,this.yInterval=0,this.rx=9,this.ry=7,this.cells=[],this.points=[]}}class o{push(t){t.isRenderable=!1,this.points.push(t),this.vecRender=new h.h9(0,0,0);for(let t=0;t<this.points.length;++t)this.vecRender.x+=this.points[t].x,this.vecRender.y+=this.points[t].y;this.vecRender.x/=this.points.length,this.vecRender.y/=this.points.length}get isRenderable(){return this._isRenderable}set isRenderable(t){if(!t){for(let t=0;t<this.points.length;++t)this.points[t].isRenderable=!0;this.points=[]}this._isRenderable=t}draw(t){let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t.beginPath(),t.rect(this.vec.x-.5*this.grid.xInterval,this.vec.y-.5*this.grid.yInterval,this.grid.xInterval,this.grid.yInterval),t.closePath(),t.stroke(),!this.isRenderable)return;if(i){this.vecRender=new h.h9(0,0,0);for(let t=0;t<this.points.length;++t)this.vecRender.x+=this.points[t].x,this.vecRender.y+=this.points[t].y;this.vecRender.x/=this.points.length,this.vecRender.y/=this.points.length}let e=5+.1*this.points.length;t.fillStyle="rgba(".concat(10*e,", 0, 0, 1)"),t.beginPath(),t.arc(this.vecRender.x,this.vecRender.y,e,0,2*Math.PI),t.closePath(),t.fill()}constructor(t,i,e){this.r0=16,this.r1=24,this.isHover=!1,this.points=[],this._isRenderable=!0,this.grid=t,this.xI=i,this.yI=e,this.vec=new h.h9(i*this.grid.xInterval,e*this.grid.yInterval)}}class l{update(t,i){this.initGrid(t,i)}initGrid(t,i){this.minP=new h.h9(Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER),this.maxP=new h.h9(Number.MIN_SAFE_INTEGER,Number.MIN_SAFE_INTEGER,Number.MIN_SAFE_INTEGER);for(let t=0;t<this.points.length;++t){let i=this.points[t];this.minP.x>i.x&&(this.minP.x=i.x),this.minP.y>i.y&&(this.minP.y=i.y),this.minP.z>i.z&&(this.minP.z=i.z),this.maxP.x<i.x&&(this.maxP.x=i.x),this.maxP.y<i.y&&(this.maxP.y=i.y),this.maxP.z<i.z&&(this.maxP.z=i.z)}this.cells=[],this.width=this.maxP.x-this.minP.x,this.height=this.maxP.y-this.minP.y,this.xInterval=this.width/(this.rx-1),this.yInterval=this.height/(this.ry-1);for(let t=0;t<this.ry;t++){let i=[];for(let e=0;e<this.rx;e++)i.push(new a(this,e,t));this.cells.push(i)}for(let t=0;t<this.points.length;++t){let i=this.points[t];this.getCellAtPoint(i).push(i)}for(let t=0;t<this.ry;++t)for(let i=0;i<this.rx;++i)this.cells[t][i].points.length<1&&(this.cells[t][i].isRenderable=!1)}getCellAtPoint(t){let i=Math.round((t.x-this.minP.x)/this.xInterval),e=Math.round((t.y-this.minP.y)/this.yInterval);return i>=this.rx&&(i=this.rx-1),e>=this.ry&&(e=this.ry-1),i<0&&(i=0),e<0&&(e=0),this.cells[e][i]}render(t){for(let i=0;i<this.cells.length;i++)for(let e=0;e<this.cells[i].length;e++)this.cells[i][e].draw(t);t.beginPath(),t.rect(this.minP.x,this.minP.y,this.maxP.x-this.minP.x,this.maxP.y-this.minP.y),t.stroke()}constructor(){this.xInterval=0,this.yInterval=0,this.width=0,this.height=0,this.rx=9,this.ry=7,this.cells=[],this.points=[],this.minP=new h.h9(Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER),this.maxP=new h.h9(Number.MIN_SAFE_INTEGER,Number.MIN_SAFE_INTEGER,Number.MIN_SAFE_INTEGER)}}class a{push(t){t.isRenderable=!1,this.points.push(t),this.vecRender=new h.h9(0,0,0);for(let t=0;t<this.points.length;++t)this.vecRender.x+=this.points[t].x,this.vecRender.y+=this.points[t].y;this.vecRender.x/=this.points.length,this.vecRender.y/=this.points.length}get isRenderable(){return this._isRenderable}set isRenderable(t){if(!t){for(let t=0;t<this.points.length;++t)this.points[t].isRenderable=!0;this.points=[]}this._isRenderable=t}draw(t){let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.isRenderable){t.beginPath(),t.rect(this.vec.x-.5*this.grid.xInterval,this.vec.y-.5*this.grid.yInterval,this.grid.xInterval,this.grid.yInterval),t.closePath(),t.stroke();return}if(i){this.vecRender=new h.h9(0,0,0);for(let t=0;t<this.points.length;++t)this.vecRender.x+=this.points[t].x,this.vecRender.y+=this.points[t].y;this.vecRender.x/=this.points.length,this.vecRender.y/=this.points.length}let e=5+.1*this.points.length;t.fillStyle="rgba(".concat(10*e,", 0, 0, 1)"),t.beginPath(),t.arc(this.vecRender.x,this.vecRender.y,e,0,2*Math.PI),t.closePath(),t.fill(),t.beginPath(),t.rect(this.vec.x-.5*this.grid.xInterval,this.vec.y-.5*this.grid.yInterval,this.grid.xInterval,this.grid.yInterval),t.closePath(),t.stroke()}constructor(t,i,e){this.r0=16,this.r1=24,this.isHover=!1,this.points=[],this._isRenderable=!0,this.grid=t,this.xI=i,this.yI=e,this.vec=new h.h9(t.minP.x+i*this.grid.xInterval,t.minP.y+e*this.grid.yInterval)}}class c{push(t,i,e){this.optimizer.points=t,this.update(i,e)}mouseInteraction(t,i){this.mv=this.optimizer.getCellAtPoint(new h.h9(t,i)).vec}update(t,i){this.optimizer.update(t,i)}render(t,i,e,s){i&&this.update(e,s),this.optimizer.render(t),this.mv&&(t.fillStyle="#00ff00",t.beginPath(),t.arc(this.mv.x,this.mv.y,9,0,6.28),t.closePath(),t.fill())}constructor(t){switch(this.mv=new h.h9(0,0),this.inspection=!0,this.optimizerType=t,t){case n.GRID_SCREEN:this.optimizer=new r;break;case n.GRID:this.optimizer=new l}console.debug("clustering... v 0.1.5")}}},5336:function(t,i,e){e.d(i,{TE:function(){return s.TE},h9:function(){return s.h9}});var s=e(20191)},59945:function(t,i,e){e.d(i,{J:function(){return G}});var s=e(12025);let n=()=>{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(i){let e=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"===i?e:3&e|8).toString(16)})};var h=e(47194);class r{mouseEvent(t){switch(t.type){case s.zK.LEFT:this.MouseLeftClickPre(t);return;case s.zK.MIDDLE:this.MouseMiddleClickPre(t);return;case s.zK.RIGHT:this.MouseRightClickPre(t);return;case s.zK.DOUBLE:this.MouseDoubleClickPre(t);return;case s.zK.MOVE:this.MouseMovePre(t);return;case s.zK.DRAG:this.MouseDragPre(t);return;case s.zK.DOWN:this.MouseDownPre(t);return;case s.zK.UP:this.MouseUpPre(t);return;case s.zK.WHEEL:this.MouseWheelPre(t);return}}MouseDown(t){}MouseDownPre(t){this.activeCommandController.drawingEngine.scene.capture=this.activeCommandController.drawingEngine.geometryCommon.find(t.x,t.y),this.MouseDown(t)}MouseLeftClick(t){}MouseLeftClickPre(t){this.activeCommandController.drawingEngine.scene.capture=this.activeCommandController.drawingEngine.geometryCommon.find(t.x,t.y),this.activeCommandController.drawingEngine.scene.capture?this.activeCommandController.drawingEngine.scene.capture.isSelected=!this.activeCommandController.drawingEngine.scene.capture.isSelected:this.activeCommandController.drawingEngine.geometryCommon.resetSelections(),this.MouseLeftClick(t)}MouseMiddleClick(t){}MouseMiddleClickPre(t){this.MouseMiddleClick(t)}MouseRightClick(t){}MouseRightClickPre(t){this.MouseRightClick(t)}MouseUp(t){}MouseUpPre(t){this.activeCommandController.drawingEngine.scene.capture=void 0,this.MouseUp(t)}MouseDoubleClick(t){}MouseDoubleClickPre(t){this.MouseDoubleClick(t)}MouseMove(t){}MouseMovePre(t){this.activeCommandController.drawingEngine.geometryCommon.updateHover(t.x,t.y),this.MouseMove(t)}MouseDrag(t){}MouseDragPre(t){if(this.activeCommandController.drawingEngine.scene.capture){let i=this.activeCommandController.drawingEngine.projection.toMap(t.x,t.y);this.activeCommandController.drawingEngine.scene.capture.translate(t.x,t.y,i[0],i[1])}this.MouseDrag(t)}MouseWheel(t){}MouseWheelPre(t){this.MouseWheel(t)}constructor(t){this.type=s.NI.SELECT,this.activeCommandController=t}}class o{Reset(){this.neighborShapes=[],this.numOrder=-1,this.geometryBase.numVisit=0,this.geometryBase.isCollapse=!1,this.isCollided=!1,this.isVisited=!1}constructor(t){this.isCollided=!1,this.neighborShapes=[],this.isVisited=!1,this.numOrder=-1,this.geometryBase=t,this.minVec=new h.h9(this.geometryBase.v.x-5,this.geometryBase.v.y-5,0),this.maxVec=new h.h9(this.geometryBase.v.x+5,this.geometryBase.v.y+5,0)}}class l{toJson(){return{}}translate(t,i,e,s){}isInside(t,i){return!1}update(t,i){}render(t,i){}renderPost(t,i){}constructor(t,i,e){this.id="",this.numVisit=0,this.isCollapse=!1,this.isHidden=!1,this.isRenderable=!0,this.isSelected=!1,this.isHover=!1,this.scene=t,this.v=new h.h9(i,e,0),this.id=n(),this.collision=new o(this)}}class a extends l{translate(t,i,e,s){this.v.x=t,this.v.y=i,this.v.long=e,this.v.lat=s}isInside(t,i){return(0,h.tl)(this.v.x,this.v.y,t,i)<this.r+3?(this.isHover=!0,!0):(this.isHover=!1,!1)}update(t,i){if(t&&this.scene.drawingEngine.projection.isCustom){let t=i(this.v.long,this.v.lat);this.v.x=t[0],this.v.y=t[1]}}toJson(){return{x:this.v.x,y:this.v.y}}renderPost(t,i){let e=this.r+Math.sin(this.t);this.isHover?(e+=3,t.fillStyle=this.colorHover):t.fillStyle=this.color,t.beginPath(),t.arc(this.v.x,this.v.y,e,0,2*Math.PI),t.closePath(),t.fill(),this.isSelected&&(t.lineWidth=3,t.strokeStyle="#ffffff",t.stroke()),this.t+=.06}constructor(t,i){super(t,i.x,i.y),this.r=5,this.t=0,this.color="#00ff00",this.colorHover="#0ffff0",this.type=s.mB.point,this.v=new h.h9(i.x,i.y,i.z)}}class c extends r{MouseLeftClick(t){}constructor(t){super(t),this.type=s.NI.SELECT}}class d extends r{MouseLeftClick(t){let i=new a(this.activeCommandController.drawingEngine.scene,{x:t.x,y:t.y,z:0}),e=this.activeCommandController.drawingEngine.projection.toMap(t.x,t.y);i.v.long=e[0],i.v.lat=e[1],this.activeCommandController.drawingEngine.scene.addGeometry(i),this.activeCommandController.hasShift||this.activeCommandController.drawingEngine.setCommand()}constructor(t){super(t),this.type=s.NI.POINT}}class u extends r{MouseLeftClick(t){}constructor(t){super(t),this.type=s.NI.LINE}}var g=e(15191);class p{setCommander(t){switch(t){case s.NI.SELECT:case s.NI.POINT:case s.NI.LINE:this.activeCommand=this.commands[t]}}apiCall(t){switch(t){case"getSelectedCPoint":return this.drawingEngine.geometryCommon.getSelCPoint();case"importZipData":return this.popZipData();case"importClustering":return this.drawingEngine.addon.InitClustering();case"importClusteringCollision":return this.drawingEngine.addon.InitClusteringCollision();case"save":return this.drawingEngine.geometryCommon.toJson()}}async popZipData(){let t=await (0,g.rd)("https://raw.githubusercontent.com/NamjuLee/data/master/US/zip.json"),i=0;for(let e of t.pos){let t=this.greatePointByGeoPos(e[0],e[1]);if(t.t+=10*Math.random(),i++>2e3)return}}greatePointByGeoPos(t,i){let e=this.drawingEngine.projection.toScreen(t,i),s=new a(this.drawingEngine.scene,{x:e[0],y:e[1],z:0});return s.v.long=t,s.v.lat=i,this.drawingEngine.scene.addGeometry(s),s}constructor(t){this.commands={},this.hasShift=!1,this.inspection=!1,this.drawingEngine=t,this.commands={SELECT:new c(this),POINT:new d(this),LINE:new u(this)},this.activeCommand=this.commands[s.NI.SELECT]}}class m{updateProjection(t){this.toMap=t.toMap,this.toScreen=t.toScreen,this.isCustom=!0}toScreen(t,i){return[t,i]}toMap(t,i){return[t,i]}constructor(t){this.isCustom=!1,this.drawingEngine=t}}class x{sendData(t){}constructor(t){this.firebaseConfig={apiKey:"AIzaSyA1yKg85WGZoshbk8xR23cXr3SwpqXVgIc",authDomain:"njs-data.firebaseapp.com",projectId:"njs-data",storageBucket:"njs-data.appspot.com",messagingSenderId:"635991152770",appId:"1:635991152770:web:722f5356e0d14cea50fc9b"},this.getData=t=>{let i=t.val();for(let t in i);},this.getError=t=>{console.error(t)},this.drawingEngine=t}}class v{find(t,i){for(let e in this.drawingEngine.scene.geoDict)if(this.drawingEngine.scene.geoDict[e].isInside(t,i))return this.drawingEngine.scene.geoDict[e]}resetSelections(){for(let t=0;t<this.drawingEngine.scene.geometryList.length;++t)this.drawingEngine.scene.geometryList[t].isSelected=!1}getAllVecFromCPoint(){let t=[];for(let i=0;i<this.drawingEngine.scene.pointList.length;++i)t.push(this.drawingEngine.scene.pointList[i].v);return t}getAllFromCPoint(){let t=[];for(let i=0;i<this.drawingEngine.scene.pointList.length;++i)t.push(this.drawingEngine.scene.pointList[i]);return t}getSelCPoint(){let t=[];for(let i=0;i<this.drawingEngine.scene.pointList.length;++i)this.drawingEngine.scene.pointList[i].isSelected&&t.push(this.drawingEngine.scene.pointList[i]);return t}updateHover(t,i){for(let e=0;e<this.drawingEngine.scene.geometryList.length;++e)this.drawingEngine.scene.geometryList[e].isInside(t,i)}toJson(){let t=[];for(let i=0;i<this.drawingEngine.scene.geometryList.length;++i)t.push(this.drawingEngine.scene.geometryList[i].toJson());return t}constructor(t){this.drawingEngine=t}}var y=e(4606),E=e(5336);class C{IsInside(t){return(0,E.TE)(this.vec,t)<this.r1?(this.isHover=!0,!0):(this.isHover=!1,!1)}AddPost(t){if(!this.points.includes(t)){this.points.push(t),this.vec=new E.h9(0,0,0);for(let t=0;t<this.points.length;++t)this.vec.x+=this.points[t].v.x,this.vec.y+=this.points[t].v.y,this.UpdateBoundingBox(this.points[t].v);this.vec.x/=this.points.length,this.vec.y/=this.points.length,this.minVec=new E.h9(this.vec.x-this.r1,this.vec.y-this.r1,0),this.maxVec=new E.h9(this.vec.x+this.r1,this.vec.y+this.r1,0)}}NeedDecompose(){return this.boundingBoxMax.x-this.boundingBoxMin.x>this.GridResolution||this.boundingBoxMax.y-this.boundingBoxMin.y>this.GridResolution}Split(){this.DeepRemove();let t=(this.boundingBoxMax.x-this.boundingBoxMin.x)/this.GridResolution<1?1:(this.boundingBoxMax.x-this.boundingBoxMin.x)/this.GridResolution,i=(this.boundingBoxMax.y-this.boundingBoxMin.y)/this.GridResolution<1?1:(this.boundingBoxMax.y-this.boundingBoxMin.y)/this.GridResolution,e=this.buildGrid(t,i);this.BuildSubCluster(e,t,i)}Merge(t){this.points.concat(t.points),this.vec=new E.h9(0,0,0);for(let t=0;t<this.points.length;++t)this.vec.x+=this.points[t].v.x,this.vec.y+=this.points[t].v.y,this.UpdateBoundingBox(this.points[t].v);this.vec.x/=this.points.length,this.vec.y/=this.points.length,this.minVec=new E.h9(this.vec.x-this.r1,this.vec.y-this.r1,0),this.maxVec=new E.h9(this.vec.x+this.r1,this.vec.y+this.r1,0),t.DeepRemove()}DeepRemove(){this.renderer.RemoveCluster(this)}buildGrid(t,i){this.tempGeoGridList=[];let e=[];for(let s=0;s<i;++s){let i=this.boundingBoxMin.y+s*this.GridResolution,n=[];for(let s=0;s<t;++s){let t=this.boundingBoxMin.x+s*this.GridResolution;e.push(new E.h9(t,i));let h=[];n.push(h)}this.tempGeoGridList.push(n)}return this.tempVecGridList=e,e}BuildSubCluster(t,i,e){for(let t=0;t<this.points.length;++t)this.GetCellAtPoint(this.points[t].v,i,e).push(this.points[t]);for(let t=0;t<this.tempGeoGridList.length;++t)for(let i=0;i<this.tempGeoGridList[t].length;++i)this.tempGeoGridList[t][i]&&(1===this.tempGeoGridList[t][i].length?this.tempGeoGridList[t][i][0].collision.Reset():this.tempGeoGridList[t][i].length>1&&this.renderer.clustersRPoint.push(new C(this.renderer,this.tempGeoGridList[t][i])))}GetCellAtPoint(t,i,e){let s=new E.h9(t.x-this.boundingBoxMin.x,t.y-this.boundingBoxMin.y),n=Math.round(s.x/this.GridResolution),h=Math.round(s.y/this.GridResolution);return n>=i&&(n=i-1),h>=e&&(h=e-1),n<0&&(n=0),h<0&&(h=0),n=Math.round(n),h=Math.round(h),this.tempGeoGridList[h][n]}Draw(t,i,e){if(this.UpdateTimeer(),e){this.vec=new E.h9(0,0,0),this.boundingBoxMin=new E.h9(Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER),this.boundingBoxMax=new E.h9(Number.MIN_SAFE_INTEGER,Number.MIN_SAFE_INTEGER,Number.MIN_SAFE_INTEGER);for(let t=0;t<this.points.length;++t)this.vec.x+=this.points[t].v.x,this.vec.y+=this.points[t].v.y,this.UpdateBoundingBox(this.points[t].v);this.vec.x/=this.points.length,this.vec.y/=this.points.length,this.minVec=new E.h9(this.vec.x-this.r1,this.vec.y-this.r1,0),this.maxVec=new E.h9(this.vec.x+this.r1,this.vec.y+this.r1,0)}if(i.optimizer.inspection&&(t.beginPath(),t.rect(this.minVec.x,this.minVec.y,this.maxVec.x-this.minVec.x,this.maxVec.y-this.minVec.y),t.closePath(),t.fillStyle="rgba(0, 0, 0, 0.3)",t.fill(),t.lineWidth=.5,t.beginPath(),t.rect(this.boundingBoxMin.x,this.boundingBoxMin.y,this.boundingBoxMax.x-this.boundingBoxMin.x,this.boundingBoxMax.y-this.boundingBoxMin.y),t.closePath(),t.stroke(),this.tempVecGridList.length>0))for(let i=0;i<this.tempVecGridList.length;++i)t.beginPath(),t.rect(this.tempVecGridList[i].x,this.tempVecGridList[i].y,this.GridResolution,this.GridResolution),t.closePath(),t.stroke()}UpdateTimeer(){this.t-=.1,this.t=this.t<.4?.4:this.t}UpdateBoundingBox(t){this.boundingBoxMin.x=t.x<this.boundingBoxMin.x?t.x:this.boundingBoxMin.x,this.boundingBoxMin.y=t.y<this.boundingBoxMin.y?t.y:this.boundingBoxMin.y,this.boundingBoxMax.x=t.x>this.boundingBoxMax.x?t.x:this.boundingBoxMax.x,this.boundingBoxMax.y=t.y>this.boundingBoxMax.y?t.y:this.boundingBoxMax.y}constructor(t,i){this.r0=16,this.r1=24,this.isHover=!1,this.isVisited=!1,this.boundingBoxMin=new E.h9(Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER),this.boundingBoxMax=new E.h9(Number.MIN_SAFE_INTEGER,Number.MIN_SAFE_INTEGER,Number.MIN_SAFE_INTEGER),this.vec=new E.h9(0,0,0),this.t=1,this.GridResolution=85,this.tempVecGridList=[],this.tempGeoGridList=[],this.renderer=t,this.points=i;for(let t=0;t<this.points.length;++t)this.vec.x+=this.points[t].v.x,this.vec.y+=this.points[t].v.y,this.UpdateBoundingBox(this.points[t].v);this.vec.x/=this.points.length,this.vec.y/=this.points.length,this.minVec=new E.h9(this.vec.x-this.r1,this.vec.y-this.r1,0),this.maxVec=new E.h9(this.vec.x+this.r1,this.vec.y+this.r1,0)}}class w{InitGeometry(){this.clustersRPoint=[]}addClusterByGeometries(t){for(let i=0;i<t.length;++i)this.clustersRPoint.push(new C(this,t[i]))}RemoveCluster(t){this.clustersRPoint.splice(this.clustersRPoint.indexOf(t),1)}Render(t,i){if(this.clustersRPoint.length>0)for(let e=0;e<this.clustersRPoint.length;++e)this.clustersRPoint[e].Draw(t,this,i)}constructor(t){this.clustersRPoint=[],this.optimizer=t}}var b=e(4361);class f{update(){this.updatePoints(),this.pointList=this.BuildConnectivity(this.pointList),this.initGeometry();let t=this.buildGraph(this.pointList);if(void 0!==t){this.addClusterByGeometries(t),this.PostUpdateCollisionBasedonGraph();let i=this.NeedDecompose();i.length>0&&(this.SplitClusters(i),this.PostMergeCluster())}}initGeometry(){this.optimizer.renderer.InitGeometry()}addClusterByGeometries(t){this.optimizer.renderer.addClusterByGeometries(t)}updatePoints(){this.pointList=[];for(let t=0;t<this.optimizer.points.length;++t)if(!this.optimizer.points[t].isHidden&&this.optimizer.points[t].isRenderable){let i=this.optimizer.points[t];i.collision.Reset(),this.pointList.push(i)}}BuildConnectivity(t){for(let i=0;i<t.length;++i){let e=t[i];for(let s=i+1;s<t.length;++s){let i=t[s];!i.isCollapse&&i!==e&&(0,b.Y4)([e.collision.minVec,e.collision.maxVec],[i.collision.minVec,i.collision.maxVec])&&(e.collision.isCollided=!0,e.isCollapse=!0,e.numVisit=0,e.collision.neighborShapes.push(i),i.collision.isCollided=!0,i.isCollapse=!0,i.numVisit=0,i.collision.neighborShapes.push(e))}}return t}buildGraph(t){let i=[];for(let e=0;e<t.length;++e){let s,n=[],h=[t[e]];h[0].collision.isVisited=!0,n.push(h[0]);let r=0;for(;void 0!==(s=h.shift());){for(let t=0;t<s.collision.neighborShapes.length;++t)s.collision.neighborShapes[t].collision.isVisited||(s.collision.neighborShapes[t].collision.isVisited=!0,h.push(s.collision.neighborShapes[t]),n.push(s.collision.neighborShapes[t]));if(r++>1e3){console.debug("fail to optimize");return}}n.length>1&&i.push(n)}return i}PostUpdateCollisionBasedonGraph(){for(let t=0;t<this.optimizer.renderer.clustersRPoint.length;++t)this.UpdateByQueue(this.optimizer.renderer.clustersRPoint[t],this.pointList)}UpdateByQueue(t,i){let e=0,s=[...i];for(;s.length;){let n=s.shift();if(n){if(n.numVisit>100){n.numVisit=0;break}if(0===s.length&&i.length<e++)break;n.collision.isCollided||((0,b.Y4)([n.collision.minVec,n.collision.maxVec],[t.minVec,t.maxVec])?(n.collision.isCollided=!0,n.isCollapse=!0,n.numVisit=0,t.AddPost(n)):(n.numVisit++,s.push(n)))}}}NeedDecompose(){let t=[];for(let i=0;i<this.optimizer.renderer.clustersRPoint.length;++i)this.optimizer.renderer.clustersRPoint[i].NeedDecompose()&&t.push(this.optimizer.renderer.clustersRPoint[i]);return t}SplitClusters(t){for(let i=0;i<t.length;++i)t[i].Split()}PostMergeCluster(){this.PostMergeClusterCompute(this.optimizer.renderer.clustersRPoint)}PostMergeClusterCompute(t){for(let i=0;i<t.length-1;++i){let e=t[i];for(let s=i+1;s<t.length;++s){let i=t[s];!i.isVisited&&(0,b.TE)(e.vec,i.vec)<e.r1+20&&(i.isVisited=!0,e.Merge(i))}}}constructor(t){this.pointList=[],this.optimizer=t}}class P{push(t){this.points=t,this.update()}mouseInteraction(t,i){}update(){this.graphClustering.update()}getCellAtPoint(t){}render(t,i){this.renderer.Render(t,i)}constructor(){this.mv=new E.h9(0,0),this.inspection=!0,this.points=[],this.graphClustering=new f(this),this.renderer=new w(this)}}class M{async InitClustering(){return Promise.resolve().then(e.bind(e,4606)).then(t=>{let{Clustering:i}=t,e=this.drawingEngine.geometryCommon.getAllVecFromCPoint();this.clustering=new i(y.OPTIMIZER.GRID),this.clustering.optimizer.rx=9,this.clustering.optimizer.ry=5,this.clustering.push(e,this.drawingEngine.renderer.ctx.canvas.width,this.drawingEngine.renderer.ctx.canvas.height)}).catch(t=>{})}async InitClusteringCollision(){return Promise.resolve().then(e.bind(e,4606)).then(t=>{let{Clustering:i}=t,e=this.drawingEngine.geometryCommon.getAllFromCPoint();this.clusteringCollisionBasedGraph=new P,this.clusteringCollisionBasedGraph.push(e)}).catch(t=>{})}mouseInteraction(t){switch(t.type){case s.zK.LEFT:case s.zK.MIDDLE:case s.zK.RIGHT:case s.zK.DOUBLE:break;case s.zK.MOVE:var i;null===(i=this.clustering)||void 0===i||i.mouseInteraction(t.x,t.y);case s.zK.DRAG:case s.zK.DOWN:case s.zK.UP:case s.zK.WHEEL:}}render(t,i){var e,s;null===(e=this.clustering)||void 0===e||e.render(t,i,this.drawingEngine.renderer.ctx.canvas.width,this.drawingEngine.renderer.ctx.canvas.height),null===(s=this.clusteringCollisionBasedGraph)||void 0===s||s.render(t,i)}constructor(t){this.clustering=void 0,this.clusteringCollisionBasedGraph=void 0,this.drawingEngine=t}}class R{render(t,i){this.ctx=t,this.update(i),this.renderPost(t,i)}update(t){for(let i in this.drawingEngine.scene.geoDict)this.drawingEngine.scene.geoDict[i].update(t,this.drawingEngine.projection.toScreen)}renderPost(t,i){for(let e in this.drawingEngine.scene.geoDict)this.drawingEngine.scene.geoDict[e].renderPost(t,i);this.ComputeFPS()}ComputeFPS(){this.delta=(Date.now()-this.lastCalledTime)/1e3,this.lastCalledTime=Date.now(),this.fps=1/this.delta}constructor(t){this.lastCalledTime=Date.now(),this.delta=1,this.fps=30,this.drawingEngine=t}}class I{get capture(){return this._capture}set capture(t){t?this.drawingEngine.ableToPan=!1:this.drawingEngine.ableToPan=!0,this._capture=t}addGeometry(t){this.geoDict[t.id]=t,this.geometryList.push(t),t.type===s.mB.point&&this.pointList.push(t)}constructor(t){this._capture=void 0,this.geometryList=[],this.pointList=[],this.geoDict={},this.drawingEngine=t}}class G{apiCall(t){return this.activeCommand.apiCall(t)}updateProjection(t){this.projection.updateProjection(t)}setCommand(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"SELECT";this.activeCommand.setCommander(t)}mouseEvent(t){this.activeCommand.activeCommand.mouseEvent(t),this.addon.mouseInteraction(t)}keyEvent(t){}render(t,i){this.renderer.render(t,i),this.addon.render(t,i)}set ableToPan(t){this._ableToPan=t,this.bindAbleToPan(t)}bindAbleToPan(t){}constructor(){this._ableToPan=!0,this.io=new x(this),this.addon=new M(this),this.projection=new m(this),this.geometryCommon=new v(this),this.activeCommand=new p(this),this.scene=new I(this),this.renderer=new R(this)}}},11827:function(t,i,e){e.d(i,{V:function(){return n}}),e(12025);var s=e(20191);e(47194);class n{toScreen(t,i){return[t,i]}toMap(t,i){return[t,i]}importDummyData(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"https://raw.githubusercontent.com/NamjuLee/data/master/NYC/NY_street_lat_long.csv";this.io.importCSV(t).then(t=>{this.data=new s.UO,this.data.ComputeCSV(t),this.data.initLines((t,i)=>this.toScreen(t,i)),this.core.graphSystem.initGraph(this.data.lineTest)})}updateProjection(t){this.toScreen=t.toScreen,this.toMap=t.toMap}apiCall(t,i,e){this.controller.execution(t,i,e)}initGraph(t){this.core.initGraph(t)}reset(){this.view.reset()}setUnit(t){this.core.setUnit(t)}computePath(t,i){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.002;this.core.computePath(t,i,e)}mouseEvent(t){this.controller.mouseEvent(t)}keyEvent(t){}render(t,i){this.core.render(t,i),this.ComputeFPS()}ComputeFPS(){this.delta=(Date.now()-this.lastCalledTime)/1e3,this.lastCalledTime=Date.now(),this.fps=1/this.delta}constructor(){this.lastCalledTime=Date.now(),this.fps=30,this.delta=1,console.log("NNAEngineV3 is running...")}}},4361:function(t,i,e){e.d(i,{MO:function(){return r},TE:function(){return n},Y4:function(){return s},h9:function(){return h}});let s=(t,i)=>{let e=t[0].x,s=t[1].x,n=i[0].x,h=i[1].x,r=t[0].y,o=t[1].y,l=i[0].y,a=i[1].y;return e<=h&&s>=n&&r<=a&&o>=l},n=(t,i)=>Math.sqrt((t.x-i.x)*(t.x-i.x)+(t.y-i.y)*(t.y-i.y)+(t.z-i.z)*(t.z-i.z));class h{constructor(t=0,i=0,e=0){this.x=0,this.y=0,this.z=0,this.lon=0,this.lat=0,this.elevation=0,this.d=!0,this.isRenderable=!0,this.x=t,this.y=i,this.z=e}}class r{updateBounding(){this.collision=new o(this)}render(t){t.beginPath(),t.arc(this.vec.x,this.vec.y,this.radius,0,2*Math.PI),t.closePath(),this.isCollapse?t.fillStyle="#f00":t.fillStyle="#0f0",t.fill(),this.renderBoundingBox(t)}renderBoundingBox(t){t.beginPath(),t.rect(this.collision.minVec.x,this.collision.minVec.y,this.collision.maxVec.x-this.collision.minVec.x,this.collision.maxVec.y-this.collision.minVec.y),t.stroke()}constructor(t,i){this.id="",this.numVisit=0,this.radius=10,this.isCollapse=!1,this.isHidden=!1,this.isRenderable=!0,this.isSelected=!1,this.isHover=!1,this.vec=new h(t,i,0),this.updateBounding()}}class o{Reset(){this.neighborShapes=[],this.numOrder=-1,this.base.numVisit=0,this.base.isCollapse=!1,this.isCollided=!1,this.isVisited=!1}constructor(t){this.isCollided=!1,this.neighborShapes=[],this.isVisited=!1,this.numOrder=-1,this.base=t;let i=this.base.radius;this.minVec=new h(this.base.vec.x-i,this.base.vec.y-i,0),this.maxVec=new h(this.base.vec.x+i,this.base.vec.y+i,0)}}}}]);