"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[78368,52520],{12840:function(e,a,t){t.d(a,{D:function(){return n}});var r=t(55110);function n(e){e?.writtenProperties&&e.writtenProperties.forEach(({target:e,propName:a,newOrigin:t})=>{(0,r.l)(e)&&t&&e.originOf(a)!==t&&e.updateOrigin(a,t)})}},55110:function(e,a,t){t.d(a,{l:function(){return r}});function r(e){return e&&"getAtOrigin"in e&&"originOf"in e}},78368:function(e,a,t){t.d(a,{save:function(){return E},saveAs:function(){return $}});var r=t(78628);t(94605);var n=t(48187),i=t(96922),l=t(3770),o=t(24243),s=t(27761),u=t(63332);let d="Feature Service",y="feature-layer-utils",c=`${y}-save`,f=`${y}-save-as`;function p(e){return{isValid:(0,o.fP)(e)&&("feature"!==e.type||!e.dynamicDataSource),errorMessage:"Feature layer should be a layer or table in a map or feature service"}}function m(e){let a=[],t=[];for(let{layer:r,layerJSON:n}of e)r.isTable?t.push(n):a.push(n);return{layers:a,tables:t}}async function w(e,a){return/\/\d+\/?$/.test(e.url)?m([a[0]]):h(a,e)}async function h(e,a){if(e.reverse(),!a)return m(e);let t=await b(a,e);for(let a of e)T(a.layer,a.layerJSON,t);return function(e,a){let t=[],r=[];for(let{layer:e}of a){let{isTable:a,layerId:n}=e;a?r.push(n):t.push(n)}P(e.layers,t),P(e.tables,r)}(t,e),t}async function b(e,a){var t,r;let n=await e.fetchData("json");if((t=n)&&Array.isArray(t.layers)&&Array.isArray(t.tables))return n;r=n||={},r.layers||=[],r.tables||=[];let{layer:{url:i,customParameters:l,apiKey:o}}=a[0];return await v(n,{url:i??"",customParameters:l,apiKey:o},a.map(e=>e.layer.layerId)),n}function P(e,a){if(e.length<2)return;let t=[];for(let{id:a}of e)t.push(a);(0,r.fS)(t.sort(L),a.slice().sort(L))&&e.sort((e,t)=>{let r=a.indexOf(e.id),n=a.indexOf(t.id);return r<n?-1:r>n?1:0})}function L(e,a){return e<a?-1:e>a?1:0}async function v(e,a,t){let{url:r,customParameters:n,apiKey:i}=a,{serviceJSON:o,layersJSON:s}=await (0,l.V)(r,{customParameters:n,apiKey:i}),u=S(e.layers,o.layers,t),d=S(e.tables,o.tables,t);e.layers=u.itemResources,e.tables=d.itemResources;let y=[...u.added,...d.added],c=s?[...s.layers,...s.tables]:[];await g(e,y,r,c)}function S(e,a,t){let n=(0,r.e5)(e,a,(e,a)=>e.id===a.id);e=e.filter(e=>!n.removed.some(a=>a.id===e.id));let i=n.added;return i.forEach(({id:a})=>{e.push({id:a})}),{itemResources:e,added:i.filter(({id:e})=>!t.includes(e))}}async function g(e,a,t,r){let n=await I(a),i=a.map(({id:e,type:a})=>new(n.get(a))({url:t,layerId:e,sourceJSON:r.find(({id:a})=>a===e)}));await Promise.allSettled(i.map(e=>e.load())),i.forEach(a=>{let{layerId:t,loaded:r,defaultPopupTemplate:n}=a;if(!r||null==n)return;let i={id:t,popupInfo:n.toJSON()};"ArcGISFeatureLayer"!==a.operationalLayerType&&(i.layerType=a.operationalLayerType),T(a,i,e)})}async function I(e){let a=[];e.forEach(({type:e})=>{let t=(0,l.W)(e),r=s.T[t];a.push(r())});let t=await Promise.all(a),r=new Map;return e.forEach(({type:e},a)=>{r.set(e,t[a])}),r}function T(e,a,t){e.isTable?O(t.tables,a):O(t.layers,a)}function O(e,a){let t=e.findIndex(({id:e})=>e===a.id);-1===t?e.push(a):e[t]=a}async function N(e,a){let{url:t,layerId:r,title:n,fullExtent:l,isTable:o}=e,s=(0,i.Qc)(t);a.url=("FeatureServer"===s?.serverType?t:`${t}/${r}`)??null,a.title||=n,a.extent=null,o||null==l||(a.extent=await (0,u.$o)(l)),(0,u.ck)(a,u.hz.METADATA),(0,u.ck)(a,u.hz.MULTI_LAYER),(0,u.qj)(a,u.hz.SINGLE_LAYER),o&&(0,u.qj)(a,u.hz.TABLE)}async function E(e,a){return(0,n.a1)({layer:e,itemType:d,validateLayer:p,createItemData:(e,a)=>w(a,[e]),errorNamePrefix:c},a)}async function $(e,a,t){return(0,n.po)({layer:e,itemType:d,validateLayer:p,createItemData:(e,a)=>Promise.resolve(m([e])),errorNamePrefix:f,newItem:a,setItemProperties:N},t)}},48187:function(e,a,t){t.d(a,{a1:function(){return b},po:function(){return P}});var r=t(94605),n=t(12840),i=t(81449),l=t(20550),o=t(89136),s=t(63332),u=t(97226),d=t(34433);async function y(e){let{layer:a,errorNamePrefix:t,validateLayer:n}=e;await a.load(),function(e,a,t){let n=t(e);if(!n.isValid)throw new r.Z(`${a}:invalid-parameters`,n.errorMessage,{layer:e})}(a,t,n)}function c(e,a){return`Layer (title: ${e.title}, id: ${e.id}) of type '${e.declaredClass}' ${a}`}function f(e){let{item:a,errorNamePrefix:t,layer:n,validateItem:i}=e;if((0,u.w)(a),function(e){let{item:a,itemType:t,additionalItemType:n,errorNamePrefix:i,layer:l}=e,o=[t];if(n&&o.push(n),!o.includes(a.type)){let e=o.map(e=>`'${e}'`).join(", ");throw new r.Z(`${i}:portal-item-wrong-type`,`Portal item type should be one of: "${e}"`,{item:a,layer:l})}}(e),i){let e=i(a);if(!e.isValid)throw new r.Z(`${t}:invalid-parameters`,e.errorMessage,{layer:n})}}function p(e){return(0,o.Y)(e,"portal-item")}async function m(e,a,t){"beforeSave"in e&&"function"==typeof e.beforeSave&&await e.beforeSave();let r=e.write({},a);return await Promise.all(a.resources?.pendingOperations??[]),(0,d.z)(a,{errorName:"layer-write:unsupported"},t),r}function w(e){(0,s.qj)(e,s.hz.JSAPI),e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter((e,a,t)=>t.indexOf(e)===a))}async function h(e,a,t){let r=e.portal;await r.signIn(),await r.user?.addItem({item:e,data:a,folder:t?.folder})}async function b(e,a){let{layer:t,createItemData:i,createJSONContext:l,setItemProperties:o,saveResources:s,supplementalUnsupportedErrors:u}=e;await y(e),function(e){let{layer:a,errorNamePrefix:t}=e,{portalItem:n}=a;if(!n)throw new r.Z(`${t}:portal-item-not-set`,c(a,"requires the portalItem property to be set"));if(!n.loaded)throw new r.Z(`${t}:portal-item-not-loaded`,c(a,"cannot be saved to a portal item that does not exist or is inaccessible"));f({...e,item:n})}(e);let d=t.portalItem,h=l?l(d):p(d),b=await m(t,h,{...a,supplementalUnsupportedErrors:u}),P=await i({layer:t,layerJSON:b},d);return await o?.(t,d),w(d),await d.update({data:P}),(0,n.D)(h),await s?.(d,h),d}async function P(e,a){let{layer:t,createItemData:r,createJSONContext:o,setItemProperties:s,saveResources:u,supplementalUnsupportedErrors:d}=e;await y(e);let c=function(e){let{newItem:a,itemType:t}=e,r=l.default.from(a);return r.id&&((r=r.clone()).id=null),r.type??=t,r.portal??=i.Z.getDefault(),f({...e,item:r}),r}(e),b=o?o(c):p(c),P=await m(t,b,{...a,supplementalUnsupportedErrors:d}),L=await r({layer:t,layerJSON:P},c);return await s(t,c),w(c),await h(c,L,a),t.portalItem=c,(0,n.D)(b),await u?.(c,b),c}},3770:function(e,a,t){t.d(a,{V:function(){return i},W:function(){return c}});var r=t(62709);let n=new Set(["Catalog Layer","Feature Layer","Oriented Imagery Layer"]);async function i(e,a){let{loadContext:t,...n}=a||{},i=t?await t.fetchServiceMetadata(e,n):await (0,r.T)(e,n);y(i),s(i);let l={serviceJSON:i};if((i.currentVersion??0)<10.5)return l;let o=`${e}/layers`,u=t?await t.fetchServiceMetadata(o,n):await (0,r.T)(o,n);return y(u),s(u),l.layersJSON={layers:u.layers,tables:u.tables},l}function l(e){let{type:a}=e;return!!a&&n.has(a)}function o(e){return"Table"===e.type}function s(e){e.layers=e.layers?.filter(l),e.tables=e.tables?.filter(o)}function u(e){e.type||="Feature Layer"}function d(e){e.type||="Table"}function y(e){e.layers?.forEach(u),e.tables?.forEach(d)}function c(e){switch(e){case"Feature Layer":case"Table":break;case"Oriented Imagery Layer":return"OrientedImageryLayer";case"Catalog Layer":return"CatalogLayer"}return"FeatureLayer"}},27761:function(e,a,t){t.d(a,{T:function(){return r}});let r={BingMapsLayer:async()=>(await Promise.all([t.e(55894),t.e(77957)]).then(t.bind(t,77957))).default,BuildingSceneLayer:async()=>(await Promise.all([t.e(31478),t.e(55894),t.e(5816),t.e(90071),t.e(80404),t.e(70202),t.e(56718),t.e(66072),t.e(60320),t.e(89446),t.e(56143),t.e(17329),t.e(3654),t.e(60008)]).then(t.bind(t,76822))).default,CSVLayer:async()=>(await Promise.all([t.e(31478),t.e(55894),t.e(5816),t.e(90071),t.e(80404),t.e(70202),t.e(56718),t.e(66072),t.e(60320),t.e(40344)]).then(t.bind(t,80261))).default,CatalogLayer:async()=>(await Promise.all([t.e(31478),t.e(55894),t.e(5816),t.e(90071),t.e(80404),t.e(70202),t.e(66072),t.e(15871),t.e(34907),t.e(3149),t.e(96087)]).then(t.bind(t,87941))).default,DimensionLayer:async()=>(await Promise.all([t.e(42972),t.e(32718)]).then(t.bind(t,32718))).default,ElevationLayer:async()=>(await Promise.all([t.e(80404),t.e(43364)]).then(t.bind(t,44746))).default,FeatureLayer:async()=>(await Promise.all([t.e(31478),t.e(55894),t.e(5816),t.e(90071),t.e(80404),t.e(70202),t.e(56718),t.e(66072),t.e(60320),t.e(5210)]).then(t.bind(t,60320))).default,GeoJSONLayer:async()=>(await Promise.all([t.e(31478),t.e(55894),t.e(5816),t.e(90071),t.e(70202),t.e(56718),t.e(79164)]).then(t.bind(t,80631))).default,GeoRSSLayer:async()=>(await Promise.all([t.e(55894),t.e(54757)]).then(t.bind(t,54757))).default,GroupLayer:async()=>(await Promise.all([t.e(55894),t.e(7786)]).then(t.bind(t,7786))).default,ImageryLayer:async()=>(await Promise.all([t.e(55894),t.e(5816),t.e(80404),t.e(15871),t.e(72151),t.e(57949),t.e(85460),t.e(13099),t.e(81624)]).then(t.bind(t,25190))).default,ImageryTileLayer:async()=>(await Promise.all([t.e(55894),t.e(5816),t.e(80404),t.e(72151),t.e(57949),t.e(85460),t.e(16177),t.e(13099),t.e(2731)]).then(t.bind(t,2731))).default,IntegratedMesh3DTilesLayer:async()=>(await Promise.all([t.e(80404),t.e(10528)]).then(t.bind(t,42110))).default,IntegratedMeshLayer:async()=>(await Promise.all([t.e(80404),t.e(56143),t.e(35340)]).then(t.bind(t,79556))).default,KMLLayer:async()=>(await Promise.all([t.e(55894),t.e(5816),t.e(90071),t.e(5982)]).then(t.bind(t,49128))).default,KnowledgeGraphLayer:async()=>(await Promise.all([t.e(31478),t.e(55894),t.e(5816),t.e(90071),t.e(80404),t.e(70202),t.e(15570),t.e(56718),t.e(11243),t.e(87400),t.e(25845),t.e(33362),t.e(26822),t.e(5871),t.e(57083)]).then(t.bind(t,57083))).default,LineOfSightLayer:async()=>(await Promise.all([t.e(42972),t.e(66519)]).then(t.bind(t,66519))).default,LinkChartLayer:async()=>(await Promise.all([t.e(31478),t.e(55894),t.e(5816),t.e(90071),t.e(70202),t.e(15570),t.e(56718),t.e(11243),t.e(87400),t.e(25845),t.e(33362),t.e(26822),t.e(5871),t.e(42455)]).then(t.bind(t,77415))).default,MapImageLayer:async()=>(await Promise.all([t.e(31478),t.e(55894),t.e(5816),t.e(90071),t.e(80404),t.e(70202),t.e(15871),t.e(34907),t.e(69928),t.e(73445)]).then(t.bind(t,73445))).default,MapNotesLayer:async()=>(await Promise.all([t.e(31478),t.e(55894),t.e(5816),t.e(90071),t.e(80404),t.e(70202),t.e(56718),t.e(66072),t.e(60320),t.e(97282)]).then(t.bind(t,13381))).default,MediaLayer:async()=>(await Promise.all([t.e(55894),t.e(84944)]).then(t.bind(t,84944))).default,OGCFeatureLayer:async()=>(await Promise.all([t.e(31478),t.e(55894),t.e(5816),t.e(90071),t.e(70202),t.e(56718),t.e(85069)]).then(t.bind(t,8625))).default,OpenStreetMapLayer:async()=>(await Promise.all([t.e(55894),t.e(57066),t.e(32619)]).then(t.bind(t,32619))).default,OrientedImageryLayer:async()=>(await Promise.all([t.e(31478),t.e(55894),t.e(5816),t.e(90071),t.e(80404),t.e(70202),t.e(56718),t.e(66072),t.e(60320),t.e(34862)]).then(t.bind(t,4600))).default,PointCloudLayer:async()=>(await Promise.all([t.e(80404),t.e(56143),t.e(51257)]).then(t.bind(t,18458))).default,RouteLayer:async()=>(await Promise.all([t.e(55894),t.e(5816),t.e(90071),t.e(93965),t.e(70258)]).then(t.bind(t,99927))).default,SceneLayer:async()=>(await Promise.all([t.e(31478),t.e(5816),t.e(90071),t.e(80404),t.e(70202),t.e(50359),t.e(89446),t.e(56143),t.e(17329),t.e(48816),t.e(3654),t.e(43684)]).then(t.bind(t,73224))).default,StreamLayer:async()=>(await Promise.all([t.e(31478),t.e(55894),t.e(5816),t.e(90071),t.e(80404),t.e(70202),t.e(56718),t.e(32182)]).then(t.bind(t,66036))).default,SubtypeGroupLayer:async()=>(await Promise.all([t.e(31478),t.e(55894),t.e(5816),t.e(90071),t.e(80404),t.e(70202),t.e(66072),t.e(73681)]).then(t.bind(t,75587))).default,TileLayer:async()=>(await Promise.all([t.e(31478),t.e(55894),t.e(5816),t.e(90071),t.e(80404),t.e(70202),t.e(15871),t.e(34907),t.e(69928),t.e(36945)]).then(t.bind(t,36945))).default,UnknownLayer:async()=>(await t.e(23524).then(t.bind(t,23524))).default,UnsupportedLayer:async()=>(await t.e(96338).then(t.bind(t,96338))).default,VectorTileLayer:async()=>(await Promise.all([t.e(55894),t.e(80404),t.e(78088),t.e(34377)]).then(t.bind(t,68889))).default,VideoLayer:async()=>(await Promise.all([t.e(10167),t.e(55894),t.e(97776),t.e(53550)]).then(t.bind(t,14346))).default,VoxelLayer:async()=>(await Promise.all([t.e(80404),t.e(56143),t.e(97040)]).then(t.bind(t,14232))).default,WFSLayer:async()=>(await Promise.all([t.e(31478),t.e(55894),t.e(5816),t.e(90071),t.e(70202),t.e(56718),t.e(25624)]).then(t.bind(t,93769))).default,WMSLayer:async()=>(await Promise.all([t.e(55894),t.e(17757)]).then(t.bind(t,17757))).default,WMTSLayer:async()=>(await Promise.all([t.e(55894),t.e(57066),t.e(25300)]).then(t.bind(t,25300))).default,WebTileLayer:async()=>(await Promise.all([t.e(55894),t.e(57066)]).then(t.bind(t,57066))).default}},89136:function(e,a,t){t.d(a,{Y:function(){return l},h:function(){return i}});var r=t(72659),n=t(81449);function i(e,a){return{...o(e,a),readResourcePaths:[]}}function l(e,a,t){let n=(0,r.mN)(e.itemUrl);return{...o(e,a),messages:[],writtenProperties:[],blockedRelativeUrls:[],verifyItemRelativeUrls:n?{rootPath:n.path,writtenUrls:[]}:null,resources:t?{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}:null}}function o(e,a){return{origin:a,url:(0,r.mN)(e.itemUrl),portal:e.portal||n.Z.getDefault(),portalItem:e}}},62709:function(e,a,t){t.d(a,{T:function(){return n}});var r=t(54748);async function n(e,a){let{data:t}=await (0,r.Z)(e,{responseType:"json",query:{f:"json",...a?.customParameters,token:a?.apiKey}});return t}},97226:function(e,a,t){t.d(a,{w:function(){return l}});var r=t(39301),n=t(94605),i=t(56528);function l(e){if(r.default.apiKey&&(0,i.r)(e.portal.url))throw new n.Z("save-api-key-utils:api-key-not-supported",`Saving is not supported on ${e.portal.url} when using an api key`)}},34433:function(e,a,t){t.d(a,{P:function(){return n},z:function(){return l}});var r=t(94605);async function n(e){let a=[];for(let t of e.allLayers)if("beforeSave"in t&&"function"==typeof t.beforeSave){let e=t.beforeSave();e&&a.push(e)}await Promise.allSettled(a)}let i=new Set(["layer:unsupported","property:unsupported","symbol:unsupported","symbol-layer:unsupported","url:unsupported"]);function l(e,a,t){let n=(e.messages??[]).filter(({type:e})=>"error"===e).map(({name:e,message:a,details:t})=>new r.Z(e,a,t));if(e.blockedRelativeUrls&&(n=n.concat(e.blockedRelativeUrls.map(e=>new r.Z("url:unsupported",`Relative url '${e}' is not supported`)))),t){let{ignoreUnsupported:e,supplementalUnsupportedErrors:a=[],requiredPropertyChecksDisabled:r}=t;e&&(n=n.filter(({name:e})=>!(i.has(e)||a.includes(e)))),r&&(n=n.filter(e=>"web-document-write:property-required"!==e.name))}if(n.length>0)throw new r.Z(a.errorName,"Failed to save due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:n})}}}]);