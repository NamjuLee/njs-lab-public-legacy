"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[28370],{28370:function(t,i,s){s.r(i),s.d(i,{Demo21AppD3USTopoVis:function(){return m},Solution:function(){return x}});var e=s(18743),h=s(24219),a=s(52786),n=s(6674),o=s(90454),r=s(8483);class l{async Init(){this.InitProjection(),this.InitSVG(),this.InitBase().then(()=>{this.DrawMapSVG()}),this.InitRefer()}InitRefer(){let t=document.createElement("div");t.textContent="Reference: https://observablehq.com/@d3/choropleth",t.style.marginLeft="10px",t.style.marginTop="10px",this.USTopoSVG.divHost.append(t)}InitProjection(){let t=.5*this.width,i=.5*this.height;this.d3projection=(0,n.Z)().scale(1e3).translate([t,i]),this.d3GeoPathGenerator=(0,o.Z)().projection(this.d3projection).pointRadius(4)}InitSVG(){this.d3Selection=(0,a.Ys)("#".concat(this.id)).append("svg").attr("width",this.width+this.USTopoSVG.margin.left+this.USTopoSVG.margin.right).attr("height",this.height+this.USTopoSVG.margin.top+this.USTopoSVG.margin.bottom).style("position","absolute").append("g").attr("transform","translate("+this.USTopoSVG.margin.left+","+this.USTopoSVG.margin.top+")")}async InitBase(){return r.G7.URL("https://gist.githubusercontent.com/mbostock/4090846/raw/d534aba169207548a8a3d670c9c2cc719ff05c47/us.json").then(t=>{this.topoUSARaw=JSON.parse(t),this.geoJsonBase=(0,h.zL)(this.topoUSARaw,this.topoUSARaw.objects.counties);for(let t=0;t<this.geoJsonBase.features.length;++t){let i=this.geoJsonBase.features[t],s=this.USTopoSVG.dataClass.data[i.id],e=this.USTopoSVG.sleID;try{if(s[e]){let i=r.$H.Remap(+s[e],this.USTopoSVG.dataClass.min,this.USTopoSVG.dataClass.max,0,600);this.geoJsonBase.features[t].properties.data=i}else this.geoJsonBase.features[t].properties.data=0}catch(i){this.geoJsonBase.features[t].properties.data=0}.5>Math.random()?this.geoJsonBase.features[t].properties.visited=!0:this.geoJsonBase.features[t].properties.visited=!1}return this.geoJsonBase})}DrawMapSVG(){this.d3Selection.selectAll("path").data(this.geoJsonBase.features).enter().append("path").attr("d",this.d3GeoPathGenerator).style("stroke","#fff").style("stroke-width",".25").style("fill",t=>{let i=t.properties.data;return"rgb(0, 0, ".concat(i,")")}).on("mouseover",function(t){null!==event.currentTarget&&(0,a.Ys)("svg").style("fill",function(t){let i=t.properties.data;return"rgb(0, 0, ".concat(i+i,")")})}).on("mousemove",(t,i)=>{this.USTopoSVG.UpdateLegend(t)}).on("click",function(t,i){null!==event.currentTarget&&(0,a.Ys)("svg").style("fill",function(t){let i=t.properties.data;return"rgb(0, 0, ".concat(i,")")})}).on("mouseleave",()=>{null!==event.currentTarget&&(0,a.Ys)("svg").style("fill",function(t){let i=t.properties.data;return"rgb(0, 0, ".concat(i,")")})})}constructor(t){this.USTopoSVG=t,this.id=this.USTopoSVG.divHost.id,this.width=this.USTopoSVG.properties.widthVis-this.USTopoSVG.margin.left-this.USTopoSVG.margin.right,this.height=this.USTopoSVG.properties.heightVis-this.USTopoSVG.margin.top-this.USTopoSVG.margin.bottom,this.Init()}}class c{InitDiv(){let t=document.createElement("div");if(t){this.div=t,this.hostDiv.append(this.div),this.div.style.position="absolute",this.div.style.background="rgba(255, 255, 255, 1.0)",this.div.style.pointerEvents="none",this.div.style.top="".concat(this.vec.y,"px"),this.div.style.left="".concat(this.vec.x,"px"),this.div.style.width="".concat(this.width,"px"),this.div.style.height="".concat(this.height,"px"),this.div.style.border="".concat(2,"px"),this.div.style.borderColor="#000000";let i=document.createElement("div");i&&(this.divTitle=i,this.div.append(this.divTitle),this.divTitle.style.margin="5px",this.divTitle.textContent="Unemployment rate (%)"),this.InitCanvas();let s=document.createElement("div");s&&(this.divInspection=s,this.div.append(this.divInspection),this.divInspection.style.margin="5px",this.divInspection.textContent="Move your mouse to inspect the data")}}UpdateLegend(t,i){let s=t.id,e=this.USTopoSVG.dataClass.data[s];try{let t=e[3]+","+e[4]+", value:"+e[i];this.valSel=e[i],this.binIndexSel=r.cb.GetIndexByDataForHistDataFromNumeric(this.histData,e[i]),this.divInspection.textContent=t}catch(t){this.divInspection.textContent=""}}InitCanvas(){let t=document.createElement("canvas");if(t){this.canvas=t,this.canvas.style.pointerEvents="none",this.canvas.height=50,this.canvas.width=this.width-10,this.canvas.style.margin="5px";let i=this.canvas.getContext("2d");i&&(this.ctx=i,this.div.append(this.canvas),this.histData=r.cb.GetDataForHistDataFromNumeric(this.USTopoSVG.dataClass.dataSelArray,this.binNum),this.xStandardDeviation=r.cb.StandardDeviation(this.USTopoSVG.dataClass.dataSelArray))}}IsInside(t,i){return!(this.vec.x>t)&&!(this.vec.x+this.width<t)&&!(this.vec.y>i)&&!(this.vec.y+this.height<i)}MouseDown(t){this.IsInside(t.x,t.y)?this.isCaptured=!0:this.isCaptured=!1}MouseUp(t){this.isCaptured=!0}MouseMove(t){this.IsInside(t.x,t.y)?(this.isCaptured=!0,this.div.style.background="rgba(255, 255, 255, 1.0)"):(this.div.style.background="rgba(230, 230, 230, 0.0)",this.isCaptured=!1)}MouseDrag(t){if(!this.isCaptured)return;let i=t.x-t.preX,s=t.y-t.preY;if(this.div.style.top&&this.div.style.left){let t=parseFloat(this.div.style.top),e=parseFloat(this.div.style.left);t&&e&&(this.vec.x=e*i,this.vec.y=t*s,this.div.style.top="".concat(this.vec.y,"px"),this.div.style.left="".concat(this.vec.x,"px"))}}Render(){requestAnimationFrame(()=>{this.Render()}),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.beginPath(),this.ctx.rect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.closePath(),this.ctx.fillStyle="rgba(0, 0, 0, 0)",this.ctx.fill();let t=this.ctx.canvas.width/this.binNum+1,i=Number.MIN_SAFE_INTEGER;for(let t=0;t<this.histData.length;++t){let s=this.histData[t].length;i<s&&(i=s)}for(let s=0;s<this.histData.length;++s){let e=this.histData[s].length;this.binIndexSel===s&&this.binIndexSel>0?this.ctx.fillStyle="#0000ff":this.ctx.fillStyle="#0000aa",this.ctx.beginPath();let h=r.$H.Remap(e,0,i,this.ctx.canvas.height-3,5);this.ctx.rect(s*t,h,t-5,this.ctx.canvas.height),this.ctx.closePath(),this.ctx.fill()}let s=r.$H.Remap(this.xStandardDeviation,this.USTopoSVG.dataClass.min,this.USTopoSVG.dataClass.max,5,this.ctx.canvas.width);this.ctx.setLineDash([2,4]),this.ctx.strokeStyle="#000000",this.ctx.beginPath(),this.ctx.moveTo(s,0),this.ctx.lineTo(s,this.ctx.canvas.height),this.ctx.closePath(),this.ctx.lineWidth=1,this.ctx.stroke(),this.ctx.setLineDash([0,0]),s=r.$H.Remap(this.valSel,this.USTopoSVG.dataClass.min,this.USTopoSVG.dataClass.max,5,this.ctx.canvas.width),this.ctx.setLineDash([3,3]),this.ctx.beginPath(),this.ctx.moveTo(s,0),this.ctx.lineTo(s,this.ctx.canvas.height),this.ctx.closePath(),this.ctx.strokeStyle="#0000ff",this.ctx.lineWidth=1.5,this.ctx.stroke(),this.ctx.setLineDash([0,0])}constructor(t,i,s=670,e=400,h=250,a=150){this.width=250,this.height=300,this.vec=new r.h9(0,0),this.isCaptured=!1,this.histData=[],this.binNum=20,this.binIndexSel=-1,this.valSel=-1,this.xStandardDeviation=0,this.USTopoSVG=t,this.hostDiv=i,this.vec.x=s,this.vec.y=e,this.width=h,this.height=a,this.InitDiv(),this.Render()}}class d{async Init(t){return fetch("njslabSandboxStatic/data/dataUSUnemployed.csv").then(t=>t.text()).then(i=>{let s=[],e=i.split("\r\n");this.index=e[4].split(",");for(let i=6;i<e.length;++i){let h=e[i].split(",");s.push(h);let a=+h[t];a&&(this.dataSelArray.push(a),a<this.min&&(this.min=a),a>this.max&&(this.max=a))}this.dataRaw=s;for(let t=0;t<s.length;++t){let i=s[t][1]+s[t][2];this.data[i]=s[t]}return this.dataRaw}).catch(t=>{console.log(t)})}constructor(t){this.data={},this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER,this.dataSelArray=[],this.USTopoSVG=t}}var p=s(52302);class v{async Init(){this.InitData().then(()=>{this.d3Implementation=new l(this),this.InitCanvas(),this.legend=new c(this,this.divHost)})}async InitData(){return this.dataClass=new d(this),await this.dataClass.Init(this.sleID)}UpdateLegend(t){this.legend&&this.legend.UpdateLegend(t,this.sleID)}InitCanvas(){let t=document.createElement("canvas");t.style.pointerEvents="none",t.style.position="absolute",t.width=1e3,t.height=1e3,this.divHost.append(t);let i=t.getContext("2d");this.id=this.divHost.id,i&&(this.ctx=i,this.Update())}MouseDown(t){this.legend&&this.legend.MouseDown(t)}MouseUp(t){this.legend&&this.legend.MouseUp(t)}MouseMove(t){this.mp[0]=t.x,this.mp[1]=t.y,this.legend&&this.legend.MouseMove(t)}MouseDrag(t){this.legend.MouseDrag(t)}arcToCoordinates(t,i){let s=0,e=0;return i.map(i=>[(s+=i[0])*t.transform.scale[0]+t.transform.translate[0],(e+=i[1])*t.transform.scale[1]+t.transform.translate[1]])}Update(){requestAnimationFrame(()=>{this.Update()}),this.ctx.clearRect(0,0,1500,1500);let t=(0,p.Z)();this.ctx.beginPath(),this.ctx.strokeStyle="#eee",this.d3Implementation.d3GeoPathGenerator(t()),this.ctx.strokeStyle="#bbbbbb",this.ctx.stroke(),this.ctx.lineWidth=.5,this.ctx.strokeStyle="#333",this.ctx.beginPath(),this.ctx.stroke(),this.ctx.globalCompositeOperation=r.kz.SCREEN,this.d3Implementation.d3projection([this.mp[0],this.mp[1]]),this.ctx.beginPath(),this.ctx.arc(this.mp[0],this.mp[1],25,0,6.28),this.ctx.closePath(),this.ctx.fillStyle="rgba(255, 255, 255, 0.25)",this.ctx.fill(),this.ctx.globalCompositeOperation=r.kz.SOURCE_OVER}constructor(t){this.width=800,this.height=500,this.mp=[0,0],this.divHost=t,this.properties={widthVis:800,heightVis:500,labelX:"string",labelY:"string",minX:0,maxX:500,minY:0,maxY:500},this.margin=new r.yA,this.margin.bottom=5,this.margin.left=5,this.margin.right=5,this.margin.top=5,this.listShapes={},this.color=(0,e.Z)().range(["rgb(213,222,217)","rgb(69,173,168)","rgb(84,36,55)","rgb(217,91,67)"]),this.sleID=10,this.Init()}}class g{InitApp(){console.log("ddsdd"),this.USTopoSVG=new v(this.divHost)}constructor(t){let i=document.getElementById(t);i&&(this.divHost=i,this.InitApp())}}class m{static Init(t){new m(t).Dummy()}Dummy(){}constructor(t="SandBox"){this.implementation=new g(t)}}class x{destroy(){if(this.divHost)try{for(;this.divHost.firstChild;)this.divHost.removeChild(this.divHost.firstChild)}catch(t){console.error("Error in destroy method:",t)}else console.warn("divHost is undefined in destroy method")}constructor(t){this.divHost=document.getElementById(t),m.Init(t)}}}}]);