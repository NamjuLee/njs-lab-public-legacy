"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[31712],{57812:function(e,t,i){i.d(t,{z:function(){return r}});var s=i(85515);class r{constructor(e,t){this._storage=new s.WJ,this.id="",this.name="",this.size=0,this._storage.maxSize=e,this._storage.register(this),t&&this._storage.registerRemoveFunc("",t)}destroy(){this._storage.deregister(this),this._storage.destroy()}put(e,t,i=1){this._storage.put(this,e,t,i,1)}pop(e){return this._storage.pop(this,e)}get(e){return this._storage.get(this,e)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}resetHitRate(){}}},85515:function(e,t,i){i.d(t,{WJ:function(){return a},Xq:function(){return n}});var s,r,l=i(35313);(s=r||(r={}))[s.ALL=0]="ALL",s[s.SOME=1]="SOME";class n{constructor(e,t,i){this.name=e,this._storage=t,this.id=o+++":",this.size=0,this.maxSize=-1,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),i&&(this._storage.registerRemoveFunc(this.id,i),this._removeFunc=!0)}destroy(){this._storage.clear(this),this._removeFunc&&this._storage.deregisterRemoveFunc(this.id),this._storage.deregister(this),this._storage=null}get hitRate(){return this._hit/(this._hit+this._miss)}get storageSize(){return this._storage.size}getSize(e){return this._storage.getSize(this,e)}resetHitRate(){this._hit=this._miss=0}put(e,t,i,s=0){this._storage.put(this,e,t,i,s)}pop(e){let t=this._storage.pop(this,e);return void 0===t?++this._miss:++this._hit,t}get(e){let t=this._storage.get(this,e);return void 0===t?++this._miss:++this._hit,t}peek(e){return this._storage.peek(this,e)}updateSize(e,t,i){this._storage.updateSize(this,e,t,i)}clear(){this._storage.clear(this)}clearAll(){this._storage.clearAll()}get performanceInfo(){return this._storage.performanceInfo}resetStats(){this._storage.resetStats()}}class a{get size(){return this._size}constructor(e=10485760){this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new l.Z,this._users=new l.Z}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(e){this._users.push(e)}deregister(e){this._users.removeUnordered(e)}registerRemoveFunc(e,t){this._removeFuncs.push([e,t])}deregisterRemoveFunc(e){this._removeFuncs.filterInPlace(t=>t[0]!==e)}get maxSize(){return this._maxSize}set maxSize(e){this._maxSize=Math.max(e,-1),this._checkSize()}getSize(e,t){let i=this._db.get(e.id+t);return i?.size??0}put(e,t,i,s,l){t=e.id+t;let n=this._db.get(t);return(n&&(this._size-=n.size,e.size-=n.size,this._db.delete(t),n.entry!==i&&this._notifyRemove(t,n.entry,n.size,r.ALL)),s>this._maxSize)?void this._notifyRemove(t,i,s,r.ALL):void 0===i?void console.warn("Refusing to cache undefined entry "):!s||s<0?(console.warn(`Refusing to cache entry with size ${s} for key ${t}`),void this._notifyRemove(t,i,0,r.ALL)):void(this._db.set(t,new h(i,s,1+Math.max(l,-4)- -3)),this._size+=s,e.size+=s,this._checkSize())}updateSize(e,t,i,s){t=e.id+t;let l=this._db.get(t);if(l&&l.entry===i){for(this._size-=l.size,e.size-=l.size;s>this._maxSize;){let e=this._notifyRemove(t,i,s,r.SOME);if(!(null!=e&&e>0))return void this._db.delete(t);s=e}l.size=s,this._size+=s,e.size+=s,this._checkSize()}}pop(e,t){t=e.id+t;let i=this._db.get(t);if(i)return this._size-=i.size,e.size-=i.size,this._db.delete(t),++this._hit,i.entry;++this._miss}get(e,t){t=e.id+t;let i=this._db.get(t);if(void 0!==i)return this._db.delete(t),i.lives=i.lifetime,this._db.set(t,i),++this._hit,i.entry;++this._miss}peek(e,t){let i=this._db.get(e.id+t);return i?++this._hit:++this._miss,i?.entry}get performanceInfo(){let e={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},t={},i=[];this._db.forEach((e,s)=>{let r=e.lifetime;i[r]=(i[r]||0)+e.size,this._users.forAll(i=>{let{id:r,name:l}=i;if(s.startsWith(r)){let i=t[l]||0;t[l]=i+e.size}})});let s={};this._users.forAll(e=>{let i=e.name;if("hitRate"in e&&"number"==typeof e.hitRate&&!isNaN(e.hitRate)&&e.hitRate>0){let r=t[i]||0;t[i]=r,s[i]=Math.round(100*e.hitRate)+"%"}else s[i]="0%"});let r=Object.keys(t);r.sort((e,i)=>t[i]-t[e]),r.forEach(i=>e[i]=Math.round(t[i]/1048576)+"MB / "+s[i]);for(let t=i.length-1;t>=0;--t){let s=i[t];s&&(e["Priority "+(t+-3-1)]=Math.round(s/this._size*100)+"%")}return e}resetStats(){this._hit=this._miss=0,this._users.forAll(e=>e.resetHitRate())}clear(e){let t=e.id;this._db.forEach((e,i)=>{i.startsWith(t)&&(this._size-=e.size,this._db.delete(i),this._notifyRemove(i,e.entry,e.size,r.ALL))}),e.size=0}clearAll(){this._db.forEach((e,t)=>this._notifyRemove(t,e.entry,e.size,r.ALL)),this._users.forAll(e=>e.size=0),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(e,t,i,s){let r;return this._removeFuncs.some(l=>{if(e.startsWith(l[0])){let e=l[1](t,s,i);return"number"==typeof e&&(r=e),!0}return!1}),r}_checkSize(){this._users.forAll(e=>this._checkSizeLimits(e)),this._checkSizeLimits()}_checkSizeLimits(e){let t=e??this;if(t.maxSize<0||t.size<=t.maxSize)return;let i=e?.id,s=!0;for(;s;)for(let[r,l]of(s=!1,this._db))if(0===l.lifetime&&(!i||r.startsWith(i))){if(this._purgeItem(r,l,e),t.size<=.9*t.maxSize)return;s||=this._db.has(r)}for(let[s,r]of this._db)if((!i||s.startsWith(i))&&(this._purgeItem(s,r,e),t.size<=.9*t.maxSize))return}_purgeItem(e,t,i=this._users.find(t=>e.startsWith(t.id))){if(this._db.delete(e),t.lives<=1){this._size-=t.size,i&&(i.size-=t.size);let s=this._notifyRemove(e,t.entry,t.size,r.SOME);null!=s&&s>0&&(this._size+=s,i&&(i.size+=s),t.lives=t.lifetime,t.size=s,this._db.set(e,t))}else--t.lives,this._db.set(e,t)}}let o=0;class h{constructor(e,t,i){this.entry=e,this.size=t,this.lifetime=i,this.lives=i}}},97558:function(e,t,i){i.d(t,{$c:function(){return _},Hg:function(){return y},jW:function(){return c},uD:function(){return d}});var s=i(94761),r=i(50973),l=i(56529);let n=new Set(["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"]);function a(e){return e instanceof s.Z}function o(e){return e instanceof r.Z?Object.keys(e.items):a(e)?(0,l.vw)(e).keys():e?Object.keys(e):[]}function h(e,t){return e instanceof r.Z?e.items[t]:e[t]}function u(e){return e?e.declaredClass:null}function c(e,t){return d(e,t)}function d(e,t){if(null==e)return!1;let i=t.split("."),s=e;for(let e of i){if("complete"===s.type)break;if("partial"!==s.type)return!1;{let t=s.diff[e];if(!t)return!1;s=t}}return!0}function _(e,t){if(!e)return!1;if("partial"===e.type){let i=Object.keys(e.diff);return 1===i.length&&i[0]===t}return!1}function y(e,t){if("function"!=typeof e&&"function"!=typeof t&&(null!=e||null!=t))return null==e||null==t||"object"==typeof e&&"object"==typeof t&&u(e)!==u(t)?{type:"complete",oldValue:e,newValue:t}:function e(t,i){let s;let r=t.diff;if(r&&"function"==typeof r)return r(t,i);let l=o(t),c=o(i);if(0===l.length&&0===c.length)return;if(!l.length||!c.length||!(!Array.isArray(t)||!Array.isArray(i))&&t.length!==i.length)return{type:"complete",oldValue:t,newValue:i};let d=c.filter(e=>!l.includes(e)),_=l.filter(e=>!c.includes(e)),y=l.filter(e=>c.includes(e)&&h(t,e)!==h(i,e)).concat(d,_).sort(),p=u(t);if(p&&n.has(p)&&y.length)return{type:"complete",oldValue:t,newValue:i};let f=a(t)&&a(i);for(let l of y){let n;let a=h(t,l),o=h(i,l);if((f||"function"!=typeof a&&"function"!=typeof o)&&a!==o&&(null!=a||null!=o)){if(r&&r[l]&&"function"==typeof r[l])n=r[l]?.(a,o);else if(a instanceof Date&&o instanceof Date){if(a.getTime()===o.getTime())continue;n={type:"complete",oldValue:a,newValue:o}}else n="object"==typeof a&&"object"==typeof o&&u(a)===u(o)?e(a,o):{type:"complete",oldValue:a,newValue:o};null!=n&&(null!=s?s.diff[l]=n:s={type:"partial",diff:{[l]:n}})}}return s}(e,t)}},44837:function(e,t,i){i.d(t,{I:function(){return r},v:function(){return l}});var s=i(13507);function r(e,t,i=0){let r=(0,s.uZ)(e,0,o);for(let e=0;e<4;e++){var l;t[i+e]=Math.floor(256*((l=r*n[e])-Math.floor(l)))}}function l(e,t=0){let i=0;for(let s=0;s<4;s++)i+=e[t+s]*a[s];return i}let n=[1,256,65536,16777216],a=[1/256,1/65536,1/16777216,1/4294967296],o=l(new Uint8ClampedArray([255,255,255,255]))},76465:function(e,t,i){i.d(t,{Q:function(){return n}});var s=i(78628);i(37180);var r=i(35313),l=i(80521);class n{constructor(e=9,t){this._compareMinX=c,this._compareMinY=d,this._toBBox=e=>e,this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&("function"==typeof t?this._toBBox=t:this._initFormat(t)),this.clear()}destroy(){this.clear(),m.prune(),x.prune(),b.prune(),w.prune()}all(e){a(this._data,e)}search(e,t){let i=this._data,s=this._toBBox;if(f(e,i))for(m.clear();i;){for(let r=0,l=i.children.length;r<l;r++){let l=i.children[r],n=i.leaf?s(l):l;f(e,n)&&(i.leaf?t(l):p(e,n)?a(l,t):m.push(l))}i=m.pop()}}collides(e){let t=this._data,i=this._toBBox;if(!f(e,t))return!1;for(m.clear();t;){for(let s=0,r=t.children.length;s<r;s++){let r=t.children[s],l=t.leaf?i(r):r;if(f(e,l)){if(t.leaf||p(e,l))return!0;m.push(r)}}t=m.pop()}return!1}load(e){if(!e.length)return this;if(e.length<this._minEntries){for(let t=0,i=e.length;t<i;t++)this.insert(e[t]);return this}let t=this._build(e.slice(0,e.length),0,e.length-1,0);if(this._data.children.length){if(this._data.height===t.height)this._splitRoot(this._data,t);else{if(this._data.height<t.height){let e=this._data;this._data=t,t=e}this._insert(t,this._data.height-t.height-1,!0)}}else this._data=t;return this}insert(e){return e&&this._insert(e,this._data.height-1),this}clear(){return this._data=new I([]),this}remove(e){if(!e)return this;let t,i=this._data,r=null,l=0,n=!1,a=this._toBBox(e);for(b.clear(),w.clear();i||b.length>0;){if(i||(i=b.pop(),r=b.data[b.length-1],l=w.pop()??0,n=!0),i.leaf&&-1!==(t=(0,s.cq)(i.children,e,i.children.length,i.indexHint)))return i.children.splice(t,1),b.push(i),this._condense(b),this;n||i.leaf||!p(i,a)?r?(l++,i=r.children[l],n=!1):i=null:(b.push(i),w.push(l),l=0,r=i,i=i.children[0])}return this}toJSON(){return this._data}fromJSON(e){return this._data=e,this}_build(e,t,i,s){let r=i-t+1,l=this._maxEntries;if(r<=l){let s=new I(e.slice(t,i+1));return o(s,this._toBBox),s}s||(s=Math.ceil(Math.log(r)/Math.log(l)),l=Math.ceil(r/l**(s-1)));let n=new T([]);n.height=s;let a=Math.ceil(r/l),h=a*Math.ceil(Math.sqrt(l));g(e,t,i,h,this._compareMinX);for(let r=t;r<=i;r+=h){let t=Math.min(r+h-1,i);g(e,r,t,a,this._compareMinY);for(let i=r;i<=t;i+=a){let r=Math.min(i+a-1,t);n.children.push(this._build(e,i,r,s-1))}}return o(n,this._toBBox),n}_insert(e,t,i){let s=this._toBBox,r=i?e:s(e);b.clear();let l=function(e,t,i,s){for(;s.push(t),!0!==t.leaf&&s.length-1!==i;){let i,s=1/0,r=1/0;for(let l=0,n=t.children.length;l<n;l++){let n=t.children[l],a=_(n),o=(Math.max(n.maxX,e.maxX)-Math.min(n.minX,e.minX))*(Math.max(n.maxY,e.maxY)-Math.min(n.minY,e.minY))-a;o<r?(r=o,s=a<s?a:s,i=n):o===r&&a<s&&(s=a,i=n)}t=i||t.children[0]}return t}(r,this._data,t,b);for(l.children.push(e),u(l,r);t>=0&&b.data[t].children.length>this._maxEntries;)this._split(b,t),t--;!function(e,t,i){for(let s=i;s>=0;s--)u(t.data[s],e)}(r,b,t)}_split(e,t){let i=e.data[t],s=i.children.length,r=this._minEntries;this._chooseSplitAxis(i,r,s);let l=this._chooseSplitIndex(i,r,s);if(!l)return;let n=i.children.splice(l,i.children.length-l),a=i.leaf?new I(n):new T(n);a.height=i.height,o(i,this._toBBox),o(a,this._toBBox),t?e.data[t-1].children.push(a):this._splitRoot(i,a)}_splitRoot(e,t){this._data=new T([e,t]),this._data.height=e.height+1,o(this._data,this._toBBox)}_chooseSplitIndex(e,t,i){let s,r,l;s=r=1/0;for(let n=t;n<=i-t;n++){let t=h(e,0,n,this._toBBox),a=h(e,n,i,this._toBBox),o=function(e,t){let i=Math.max(e.minX,t.minX),s=Math.max(e.minY,t.minY);return Math.max(0,Math.min(e.maxX,t.maxX)-i)*Math.max(0,Math.min(e.maxY,t.maxY)-s)}(t,a),u=_(t)+_(a);o<s?(s=o,l=n,r=u<r?u:r):o===s&&u<r&&(r=u,l=n)}return l}_chooseSplitAxis(e,t,i){let s=e.leaf?this._compareMinX:c,r=e.leaf?this._compareMinY:d;this._allDistMargin(e,t,i,s)<this._allDistMargin(e,t,i,r)&&e.children.sort(s)}_allDistMargin(e,t,i,s){e.children.sort(s);let r=this._toBBox,l=h(e,0,t,r),n=h(e,i-t,i,r),a=y(l)+y(n);for(let s=t;s<i-t;s++){let t=e.children[s];u(l,e.leaf?r(t):t),a+=y(l)}for(let s=i-t-1;s>=t;s--){let t=e.children[s];u(n,e.leaf?r(t):t),a+=y(n)}return a}_condense(e){for(let t=e.length-1;t>=0;t--){let i=e.data[t];if(0===i.children.length){if(t>0){let r=e.data[t-1],l=r.children;l.splice((0,s.cq)(l,i,l.length,r.indexHint),1)}else this.clear()}else o(i,this._toBBox)}}_initFormat(e){let t=["return a"," - b",";"];this._compareMinX=Function("a","b",t.join(e[0])),this._compareMinY=Function("a","b",t.join(e[1])),this._toBBox=Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}}function a(e,t){let i=e;for(x.clear();i;){if(!0===i.leaf)for(let e of i.children)t(e);else x.pushArray(i.children);i=x.pop()??null}}function o(e,t){h(e,0,e.children.length,t,e)}function h(e,t,i,s,r){r||(r=new I([])),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(let l,n=t;n<i;n++)l=e.children[n],u(r,e.leaf?s(l):l);return r}function u(e,t){e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY)}function c(e,t){return e.minX-t.minX}function d(e,t){return e.minY-t.minY}function _(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function y(e){return e.maxX-e.minX+(e.maxY-e.minY)}function p(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function f(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function g(e,t,i,s,r){let n=[t,i];for(;n.length;){let t=n.pop(),i=n.pop();if(t-i<=s)continue;let a=i+Math.ceil((t-i)/s/2)*s;(0,l.q)(e,a,i,t,r),n.push(i,a,a,t)}}let m=new r.Z,x=new r.Z,b=new r.Z,w=new r.Z({deallocator:void 0});class v{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}}class S extends v{constructor(){super(...arguments),this.height=1,this.indexHint=new s.SO}}class I extends S{constructor(e){super(),this.children=e,this.leaf=!0}}class T extends S{constructor(e){super(),this.children=e,this.leaf=!1}}},97177:function(e,t,i){i.d(t,{Z:function(){return h}});var s,r,l=i(37180),n=i(5574);(s=r||(r={}))[s.varint=0]="varint",s[s.fixed64=1]="fixed64",s[s.delimited=2]="delimited",s[s.fixed32=5]="fixed32",s[s.unknown=99]="unknown";let a=new TextDecoder("utf-8"),o=(0,l.Z)("safari")||(0,l.Z)("ios")?6:(0,l.Z)("ff")?12:32;class h{constructor(e,t,i=0,s=e?e.byteLength:0){this._tag=0,this._dataType=r.unknown,this._init(e,t,i,s)}_init(e,t,i,s){this._data=e,this._dataView=t,this._pos=i,this._end=s}asUnsafe(){return this}clone(){return new h(this._data,this._dataView,this._pos,this._end)}pos(){return this._pos}move(e){this._pos=e}nextTag(e){for(;;){if(this._pos===this._end)return!1;let t=this._decodeVarint();if(this._tag=t>>3,this._dataType=7&t,!e||e===this._tag)break;this.skip()}return!0}next(){if(this._pos===this._end)return!1;let e=this._decodeVarint();return this._tag=e>>3,this._dataType=7&e,!0}empty(){return this._pos>=this._end}tag(){return this._tag}getInt32(){return this._decodeVarint()}getInt64(){return this._decodeVarint()}getUInt32(){let e=4294967295;if(e=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128||(e=(e|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128)||(e=(e|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128)||(e=(e|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128)||(e=(e|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128))return e;throw Error("Varint overflow")}getUInt64(){return this._decodeVarint()}getSInt32(){let e=this.getUInt32();return e>>>1^-(1&e)}getSInt64(){return this._decodeSVarint()}getBool(){let e=0!==this._data[this._pos];return this._skip(1),e}getEnum(){return this._decodeVarint()}getFixed64(){let e=this._dataView,t=this._pos,i=e.getUint32(t,!0)+4294967296*e.getUint32(t+4,!0);return this._skip(8),i}getSFixed64(){let e=this._dataView,t=this._pos,i=e.getUint32(t,!0)+4294967296*e.getInt32(t+4,!0);return this._skip(8),i}getDouble(){let e=this._dataView.getFloat64(this._pos,!0);return this._skip(8),e}getFixed32(){let e=this._dataView.getUint32(this._pos,!0);return this._skip(4),e}getSFixed32(){let e=this._dataView.getInt32(this._pos,!0);return this._skip(4),e}getFloat(){let e=this._dataView.getFloat32(this._pos,!0);return this._skip(4),e}getString(){let e=this._getLength(),t=this._pos,i=this._toString(this._data,t,t+e);return this._skip(e),i}getBytes(){let e=this._getLength(),t=this._pos,i=this._toBytes(this._data,t,t+e);return this._skip(e),i}getLength(){return this._getLengthUnsafe()}processMessageWithArgs(e,t,i,s){let r=this.getMessage(),l=e(r,t,i,s);return r.release(),l}processMessage(e){let t=this.getMessage(),i=e(t);return t.release(),i}getMessage(){let e=this._getLength(),t=h.pool.acquire();return t._init(this._data,this._dataView,this._pos,this._pos+e),this._skip(e),t}release(){h.pool.release(this)}dataType(){return this._dataType}skip(){switch(this._dataType){case r.varint:this._decodeVarint();break;case r.fixed64:this._skip(8);break;case r.delimited:this._skip(this._getLength());break;case r.fixed32:this._skip(4);break;default:throw Error("Invalid data type!")}}skipLen(e){this._skip(e)}_skip(e){if(this._pos+e>this._end)throw Error("Attempt to skip past the end of buffer!");this._pos+=e}_decodeVarint(){let e=this._data,t=this._pos,i=0,s=0;if(this._end-t>=10)do{if(i|=127&(s=e[t++]),!(128&s)||(i|=(127&(s=e[t++]))<<7,!(128&s))||(i|=(127&(s=e[t++]))<<14,!(128&s))||(i|=(127&(s=e[t++]))<<21,!(128&s))||(i+=268435456*(127&(s=e[t++])),!(128&s))||(i+=34359738368*(127&(s=e[t++])),!(128&s))||(i+=4398046511104*(127&(s=e[t++])),!(128&s))||(i+=562949953421312*(127&(s=e[t++])),!(128&s))||(i+=72057594037927940*(127&(s=e[t++])),!(128&s))||(i+=0x7fffffffffffffff*(127&(s=e[t++])),!(128&s)))break;throw Error("Varint too long!")}while(0);else{let r=1;for(;t!==this._end&&128&(s=e[t]);)++t,i+=(127&s)*r,r*=128;if(t===this._end)throw Error("Varint overrun!");++t,i+=s*r}return this._pos=t,i}_decodeSVarint(){let e=this._data,t,i=0,s=0,r=1&e[this._pos];if(i|=127&(s=e[this._pos++]),!(128&s)||(i|=(127&(s=e[this._pos++]))<<7,!(128&s))||(i|=(127&(s=e[this._pos++]))<<14,!(128&s))||(i|=(127&(s=e[this._pos++]))<<21,!(128&s))||(i+=268435456*(127&(s=e[this._pos++])),!(128&s))||(i+=34359738368*(127&(s=e[this._pos++])),!(128&s))||(i+=4398046511104*(127&(s=e[this._pos++])),!(128&s)))return r?-(i+1)/2:i/2;if(t=BigInt(i)+562949953421312n*BigInt(127&(s=e[this._pos++])),!(128&s)||(t+=0x100000000000000n*BigInt(127&(s=e[this._pos++])),!(128&s))||(t+=0x8000000000000000n*BigInt(127&(s=e[this._pos++])),!(128&s)))return Number(r?-(t+1n)/2n:t/2n);throw Error("Varint too long!")}_getLength(){if(this._dataType!==r.delimited)throw Error("Not a delimited data type!");return this._decodeVarint()}_getLengthUnsafe(){return this.getUInt32()}_toString(e,t,i){if((i=Math.min(this._end,i))-t>o){let s=e.subarray(t,i);return a.decode(s)}let s="",r="";for(let l=t;l<i;++l){let t=e[l];128&t?r+="%"+t.toString(16):(s+=decodeURIComponent(r)+String.fromCharCode(t),r="")}return r.length&&(s+=decodeURIComponent(r)),s}_toBytes(e,t,i){return i=Math.min(this._end,i),new Uint8Array(e.buffer,t,i-t)}}h.pool=new n.Z(h,void 0,e=>{e._data=null,e._dataView=null})},83536:function(e,t,i){var s,r,l,n;i.d(t,{E9:function(){return a},I6:function(){return u},Vl:function(){return s},bN:function(){return h}}),(l=s||(s={}))[l.Unknown=0]="Unknown",l[l.Point=1]="Point",l[l.LineString=2]="LineString",l[l.Polygon=3]="Polygon";class a{constructor(e,t){this.x=e,this.y=t}clone(){return new a(this.x,this.y)}equals(e,t){return e===this.x&&t===this.y}isEqual(e){return e.x===this.x&&e.y===this.y}setCoords(e,t){return this.x=e,this.y=t,this}normalize(){let e=this.x,t=this.y,i=Math.sqrt(e*e+t*t);return this.x/=i,this.y/=i,this}rightPerpendicular(){let e=this.x;return this.x=this.y,this.y=-e,this}leftPerpendicular(){let e=this.x;return this.x=-this.y,this.y=e,this}move(e,t){return this.x+=e,this.y+=t,this}assign(e){return this.x=e.x,this.y=e.y,this}assignAdd(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}assignSub(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}rotate(e,t){let i=this.x,s=this.y;return this.x=i*e-s*t,this.y=i*t+s*e,this}scale(e){return this.x*=e,this.y*=e,this}length(){let e=this.x,t=this.y;return Math.sqrt(e*e+t*t)}sub(e){return this.x-=e.x,this.y-=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}static distance(e,t){let i=t.x-e.x,s=t.y-e.y;return Math.sqrt(i*i+s*s)}static add(e,t){return new a(e.x+t.x,e.y+t.y)}static sub(e,t){return new a(e.x-t.x,e.y-t.y)}}class o{constructor(e,t,i){this.ratio=e,this.x=t,this.y=i}}class h{constructor(e,t,i,s=8,r=8){this._lines=[],this._starts=[],this.validateTessellation=!0,this._pixelRatio=s,this._pixelMargin=r,this._tileSize=512*s,this._dz=e,this._yPos=t,this._xPos=i}setPixelMargin(e){e!==this._pixelMargin&&(this._pixelMargin=e,this.setExtent(this._extent))}setExtent(e){this._extent=e,this._finalRatio=this._tileSize/e*(1<<this._dz);let t=this._pixelRatio*this._pixelMargin;t/=this._finalRatio;let i=e>>this._dz;t>i&&(t=i),this._margin=t,this._xmin=i*this._xPos-t,this._ymin=i*this._yPos-t,this._xmax=this._xmin+i+2*t,this._ymax=this._ymin+i+2*t}reset(e){this._type=e,this._lines=[],this._starts=[],this._line=null,this._start=0}moveTo(e,t){this._pushLine(),this._prevIsIn=this._isIn(e,t),this._moveTo(e,t,this._prevIsIn),this._prevPt=new a(e,t),this._firstPt=new a(e,t),this._dist=0}lineTo(e,t){let i,s,r,l,n,h,u,c;let d=this._isIn(e,t),_=new a(e,t),y=a.distance(this._prevPt,_);if(d)this._prevIsIn?this._lineTo(e,t,!0):(i=this._prevPt,s=_,r=this._intersect(s,i),this._start=this._dist+y*(1-this._r),this._lineTo(r.x,r.y,!0),this._lineTo(s.x,s.y,!0));else if(this._prevIsIn)s=this._prevPt,i=_,r=this._intersect(s,i),this._lineTo(r.x,r.y,!0),this._lineTo(i.x,i.y,!1);else{let e=this._prevPt;if(e.x<=this._xmin&&_.x<=this._xmin||e.x>=this._xmax&&_.x>=this._xmax||e.y<=this._ymin&&_.y<=this._ymin||e.y>=this._ymax&&_.y>=this._ymax)this._lineTo(_.x,_.y,!1);else{let t=[];if((e.x<this._xmin&&_.x>this._xmin||e.x>this._xmin&&_.x<this._xmin)&&(l=(this._xmin-e.x)/(_.x-e.x),(c=e.y+l*(_.y-e.y))<=this._ymin?h=!1:c>=this._ymax?h=!0:t.push(new o(l,this._xmin,c))),(e.x<this._xmax&&_.x>this._xmax||e.x>this._xmax&&_.x<this._xmax)&&(l=(this._xmax-e.x)/(_.x-e.x),(c=e.y+l*(_.y-e.y))<=this._ymin?h=!1:c>=this._ymax?h=!0:t.push(new o(l,this._xmax,c))),(e.y<this._ymin&&_.y>this._ymin||e.y>this._ymin&&_.y<this._ymin)&&(l=(this._ymin-e.y)/(_.y-e.y),(u=e.x+l*(_.x-e.x))<=this._xmin?n=!1:u>=this._xmax?n=!0:t.push(new o(l,u,this._ymin))),(e.y<this._ymax&&_.y>this._ymax||e.y>this._ymax&&_.y<this._ymax)&&(l=(this._ymax-e.y)/(_.y-e.y),(u=e.x+l*(_.x-e.x))<=this._xmin?n=!1:u>=this._xmax?n=!0:t.push(new o(l,u,this._ymax))),0===t.length)n?h?this._lineTo(this._xmax,this._ymax,!0):this._lineTo(this._xmax,this._ymin,!0):h?this._lineTo(this._xmin,this._ymax,!0):this._lineTo(this._xmin,this._ymin,!0);else if(t.length>1&&t[0].ratio>t[1].ratio)this._start=this._dist+y*t[1].ratio,this._lineTo(t[1].x,t[1].y,!0),this._lineTo(t[0].x,t[0].y,!0);else{this._start=this._dist+y*t[0].ratio;for(let e=0;e<t.length;e++)this._lineTo(t[e].x,t[e].y,!0)}this._lineTo(_.x,_.y,!1)}}this._dist+=y,this._prevIsIn=d,this._prevPt=_}close(){if(this._line.length>2){let e=this._firstPt,t=this._prevPt;e.x===t.x&&e.y===t.y||this.lineTo(e.x,e.y);let i=this._line,s=i.length;for(;s>=4&&(i[0].x===i[1].x&&i[0].x===i[s-2].x||i[0].y===i[1].y&&i[0].y===i[s-2].y);)i.pop(),i[0].x=i[s-2].x,i[0].y=i[s-2].y,--s}}result(e=!0){return this._pushLine(),0===this._lines.length?null:(this._type===s.Polygon&&e&&c.simplify(this._tileSize,this._margin*this._finalRatio,this._lines),this._lines)}resultWithStarts(){if(this._type!==s.LineString)throw Error("Only valid for lines");this._pushLine();let e=this._lines,t=e.length;if(0===t)return null;let i=[];for(let s=0;s<t;s++)i.push({line:e[s],start:this._starts[s]||0});return i}_isIn(e,t){return e>=this._xmin&&e<=this._xmax&&t>=this._ymin&&t<=this._ymax}_intersect(e,t){let i,s,r;if(t.x>=this._xmin&&t.x<=this._xmax)r=((s=t.y<=this._ymin?this._ymin:this._ymax)-e.y)/(t.y-e.y),i=e.x+r*(t.x-e.x);else if(t.y>=this._ymin&&t.y<=this._ymax)r=((i=t.x<=this._xmin?this._xmin:this._xmax)-e.x)/(t.x-e.x),s=e.y+r*(t.y-e.y);else{s=t.y<=this._ymin?this._ymin:this._ymax;let l=((i=t.x<=this._xmin?this._xmin:this._xmax)-e.x)/(t.x-e.x),n=(s-e.y)/(t.y-e.y);l<n?(r=l,s=e.y+l*(t.y-e.y)):(r=n,i=e.x+n*(t.x-e.x))}return this._r=r,new a(i,s)}_pushLine(){this._line&&(this._type===s.Point?this._line.length>0&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===s.LineString?this._line.length>1&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===s.Polygon&&this._line.length>3&&(this._lines.push(this._line),this._starts.push(this._start))),this._line=[],this._start=0}_moveTo(e,t,i){this._type!==s.Polygon?i&&(e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),t=Math.round((t-(this._ymin+this._margin))*this._finalRatio),this._line.push(new a(e,t))):(i||(e<this._xmin&&(e=this._xmin),e>this._xmax&&(e=this._xmax),t<this._ymin&&(t=this._ymin),t>this._ymax&&(t=this._ymax)),e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),t=Math.round((t-(this._ymin+this._margin))*this._finalRatio),this._line.push(new a(e,t)),this._isH=!1,this._isV=!1)}_lineTo(e,t,i){let r,l;if(this._type!==s.Polygon){if(i){if(e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),t=Math.round((t-(this._ymin+this._margin))*this._finalRatio),this._line.length>0&&(r=this._line[this._line.length-1]).equals(e,t))return;this._line.push(new a(e,t))}else this._line&&this._line.length>0&&this._pushLine()}else if(i||(e<this._xmin&&(e=this._xmin),e>this._xmax&&(e=this._xmax),t<this._ymin&&(t=this._ymin),t>this._ymax&&(t=this._ymax)),e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),t=Math.round((t-(this._ymin+this._margin))*this._finalRatio),this._line&&this._line.length>0){let i=(r=this._line[this._line.length-1]).x===e,s=r.y===t;if(i&&s)return;this._isH&&i||this._isV&&s?(r.x=e,r.y=t,(l=this._line[this._line.length-2]).x===e&&l.y===t?(this._line.pop(),this._line.length<=1?(this._isH=!1,this._isV=!1):(l=this._line[this._line.length-2],this._isH=l.x===e,this._isV=l.y===t)):(this._isH=l.x===e,this._isV=l.y===t)):(this._line.push(new a(e,t)),this._isH=i,this._isV=s)}else this._line.push(new a(e,t))}}class u{setExtent(e){this._ratio=4096===e?1:4096/e}get validateTessellation(){return this._ratio<1}reset(e){this._lines=[],this._line=null}moveTo(e,t){this._line&&this._lines.push(this._line),this._line=[];let i=this._ratio;this._line.push(new a(e*i,t*i))}lineTo(e,t){let i=this._ratio;this._line.push(new a(e*i,t*i))}close(){let e=this._line;e&&!e[0].isEqual(e[e.length-1])&&e.push(e[0])}result(){return this._line&&this._lines.push(this._line),0===this._lines.length?null:this._lines}}(n=r||(r={}))[n.sideLeft=0]="sideLeft",n[n.sideRight=1]="sideRight",n[n.sideTop=2]="sideTop",n[n.sideBottom=3]="sideBottom";class c{static simplify(e,t,i){if(!i)return;let s=-t,l=e+t,n=-t,a=e+t,o=[],h=[],u=i.length;for(let e=0;e<u;++e){let t=i[e];if(!t||t.length<2)continue;let u,c=t[0],d=t.length;for(let i=1;i<d;++i)u=t[i],c.x===u.x&&(c.x<=s&&(c.y>u.y?(o.push(e),o.push(i),o.push(r.sideLeft),o.push(-1)):(h.push(e),h.push(i),h.push(r.sideLeft),h.push(-1))),c.x>=l&&(c.y<u.y?(o.push(e),o.push(i),o.push(r.sideRight),o.push(-1)):(h.push(e),h.push(i),h.push(r.sideRight),h.push(-1)))),c.y===u.y&&(c.y<=n&&(c.x<u.x?(o.push(e),o.push(i),o.push(r.sideTop),o.push(-1)):(h.push(e),h.push(i),h.push(r.sideTop),h.push(-1))),c.y>=a&&(c.x>u.x?(o.push(e),o.push(i),o.push(r.sideBottom),o.push(-1)):(h.push(e),h.push(i),h.push(r.sideBottom),h.push(-1)))),c=u}if(0===o.length||0===h.length)return;c.fillParent(i,h,o),c.fillParent(i,o,h);let d=[];c.calcDeltas(d,h,o),c.calcDeltas(d,o,h),c.addDeltas(d,i)}static fillParent(e,t,i){let s=i.length,l=t.length;for(let n=0;n<l;n+=4){let l=t[n],a=t[n+1],o=t[n+2],h=e[l][a-1],u=e[l][a],c=8092,_=-1;for(let t=0;t<s;t+=4){if(i[t+2]!==o)continue;let s=i[t],l=i[t+1],n=e[s][l-1],a=e[s][l];switch(o){case r.sideLeft:case r.sideRight:if(d(h.y,n.y,a.y)&&d(u.y,n.y,a.y)){let e=Math.abs(a.y-n.y);e<c&&(c=e,_=t)}break;case r.sideTop:case r.sideBottom:if(d(h.x,n.x,a.x)&&d(u.x,n.x,a.x)){let e=Math.abs(a.x-n.x);e<c&&(c=e,_=t)}}}t[n+3]=_}}static calcDeltas(e,t,i){let s=t.length;for(let r=0;r<s;r+=4){let s=[],l=c.calcDelta(r,t,i,s);e.push(t[r]),e.push(t[r+1]),e.push(t[r+2]),e.push(l)}}static calcDelta(e,t,i,s){let r=t[e+3];if(-1===r)return 0;let l=s.length;return l>1&&s[l-2]===r?0:(s.push(r),c.calcDelta(r,i,t,s)+1)}static addDeltas(e,t){let i=e.length,s=0;for(let t=0;t<i;t+=4){let i=e[t+3];i>s&&(s=i)}for(let l=0;l<i;l+=4){let i=t[e[l]],n=e[l+1],a=s-e[l+3];switch(e[l+2]){case r.sideLeft:i[n-1].x-=a,i[n].x-=a,1===n&&(i[i.length-1].x-=a),n===i.length-1&&(i[0].x-=a);break;case r.sideRight:i[n-1].x+=a,i[n].x+=a,1===n&&(i[i.length-1].x+=a),n===i.length-1&&(i[0].x+=a);break;case r.sideTop:i[n-1].y-=a,i[n].y-=a,1===n&&(i[i.length-1].y-=a),n===i.length-1&&(i[0].y-=a);break;case r.sideBottom:i[n-1].y+=a,i[n].y+=a,1===n&&(i[i.length-1].y+=a),n===i.length-1&&(i[0].y+=a)}}}}let d=(e,t,i)=>e>=t&&e<=i||e>=i&&e<=t},92353:function(e,t,i){i.d(t,{Q:function(){return u}});var s=i(92882),r=i(94605),l=i(68665);i(19324);var n,a=i(42656),o={exports:{}};n=function(){function e(t,i,s,r){var l=Error.call(this,t);return Object.setPrototypeOf&&Object.setPrototypeOf(l,e.prototype),l.expected=i,l.found=s,l.location=r,l.name="SyntaxError",l}function t(e,t,i){return i=i||" ",e.length>t?e:(t-=e.length,e+(i+=i.repeat(t)).slice(0,t))}return function(e,t){function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i}(e,Error),e.prototype.format=function(e){var i="Error: "+this.message;if(this.location){var s,r=null;for(s=0;s<e.length;s++)if(e[s].source===this.location.source){r=e[s].text.split(/\r\n|\n|\r/g);break}var l=this.location.start,n=this.location.source&&"function"==typeof this.location.source.offset?this.location.source.offset(l):l,a=this.location.source+":"+n.line+":"+n.column;if(r){var o=this.location.end,h=t("",n.line.toString().length," "),u=r[l.line-1],c=(l.line===o.line?o.column:u.length+1)-l.column||1;i+="\n --> "+a+"\n"+h+" |\n"+n.line+" | "+u+"\n"+h+" | "+t("",l.column-1," ")+t("",c,"^")}else i+="\n at "+a}return i},e.buildMessage=function(e,t){var i={literal:function(e){return'"'+r(e.text)+'"'},class:function(e){var t=e.parts.map(function(e){return Array.isArray(e)?l(e[0])+"-"+l(e[1]):l(e)});return"["+(e.inverted?"^":"")+t.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(e){return e.description}};function s(e){return e.charCodeAt(0).toString(16).toUpperCase()}function r(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(e){return"\\x0"+s(e)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(e){return"\\x"+s(e)})}function l(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(e){return"\\x0"+s(e)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(e){return"\\x"+s(e)})}function n(e){return i[e.type](e)}return"Expected "+function(e){var t,i,s=e.map(n);if(s.sort(),s.length>0){for(t=1,i=1;t<s.length;t++)s[t-1]!==s[t]&&(s[i]=s[t],i++);s.length=i}switch(s.length){case 1:return s[0];case 2:return s[0]+" or "+s[1];default:return s.slice(0,-1).join(", ")+", or "+s[s.length-1]}}(e)+" but "+(t?'"'+r(t)+'"':"end of input")+" found."},{SyntaxError:e,parse:function(t,i){var s,r,l,n,a,o,h,u,c={},d=(i=void 0!==i?i:{}).grammarSource,_={start:e_},y=e_,p="none",f="grad",g="turn",m=/^[ \t\n\r]/,x=/^[a-z\-]/,b=/^[0-9a-fA-F]/,w=/^[+\-]/,v=/^[0-9]/,S=eu("none"),I=eo("none",!1),T=eo(")",!1),R=eo(",",!1),C=eu("whitespace"),M=eh([" ","	","\n","\r"],!1,!1),A=eu("function"),D=eo("(",!1),P=eu("identifier"),L=eh([["a","z"],"-"],!1,!1),k=eu("percentage"),z=eo("%",!1),U=eu("length"),O=eo("px",!1),F=eo("cm",!1),E=eo("mm",!1),V=eo("in",!1),B=eo("pt",!1),q=eo("pc",!1),H=eu("angle"),Z=eo("deg",!1),N=eo("rad",!1),Y=eo("grad",!1),W=eo("turn",!1),X=eu("number"),j=eu("color"),Q=eo("#",!1),J=eh([["0","9"],["a","f"],["A","F"]],!1,!1),G=eh(["+","-"],!1,!1),K=eh([["0","9"]],!1,!1),$=eo(".",!1),ee=eo("e",!1),et=0,ei=0,es=[{line:1,column:1}],er=0,el=[],en=0;if("startRule"in i){if(!(i.startRule in _))throw Error("Can't start parsing from rule \""+i.startRule+'".');y=_[i.startRule]}function ea(){return t.substring(ei,et)}function eo(e,t){return{type:"literal",text:e,ignoreCase:t}}function eh(e,t,i){return{type:"class",parts:e,inverted:t,ignoreCase:i}}function eu(e){return{type:"other",description:e}}function ec(e){var i,s=es[e];if(s)return s;for(i=e-1;!es[i];)i--;for(s={line:(s=es[i]).line,column:s.column};i<e;)10===t.charCodeAt(i)?(s.line++,s.column=1):s.column++,i++;return es[e]=s,s}function ed(e){et<er||(et>er&&(er=et,el=[]),el.push(e))}function e_(){var e,i,s;return en++,i=et,ef(),t.substr(et,4)===p?(s=p,et+=4):(s=c,0===en&&ed(I)),s!==c?(ef(),ei=i,i=[]):(et=i,i=c),en--,i===c&&0===en&&ed(S),(e=i)===c&&(e=function(){var e,t;if(e=[],(t=ey())!==c)for(;t!==c;)e.push(t),t=ey();else e=c;return e}()),e}function ey(){var e,i,s,r,l,n,a;return e=et,ef(),(en++,l=et,(n=eg())!==c?(40===t.charCodeAt(et)?(a="(",et++):(a=c,0===en&&ed(D)),a!==c?(ei=l,l=n):(et=l,l=c)):(et=l,l=c),en--,l===c&&(n=c,0===en&&ed(A)),(i=l)!==c)?(ef(),(s=function(){var e,i,s,r,l,n,a,o,h;if(e=et,(i=ep())!==c){for(s=[],r=et,l=ef(),44===t.charCodeAt(et)?(n=",",et++):(n=c,0===en&&ed(R)),n===c&&(n=null),a=ef(),(o=ep())!==c?r=l=[l,n,a,o]:(et=r,r=c);r!==c;)s.push(r),r=et,l=ef(),44===t.charCodeAt(et)?(n=",",et++):(n=c,0===en&&ed(R)),n===c&&(n=null),a=ef(),(o=ep())!==c?r=l=[l,n,a,o]:(et=r,r=c);ei=e,e=s.length>0?(h=0,[i].concat(s.map(function(e){return e[3]}))):[i]}else et=e,e=c;return e}())===c&&(s=null),ef(),41===t.charCodeAt(et)?(r=")",et++):(r=c,0===en&&ed(T)),r!==c?(ef(),ei=e,e={type:"function",name:i,parameters:s||[]}):(et=e,e=c)):(et=e,e=c),e}function ep(){var e,i,s,r,l,n,a,o,h,u,d,_,y,p,m;return e=et,en++,l=et,ef(),(n=em())!==c?(37===t.charCodeAt(et)?(a="%",et++):(a=c,0===en&&ed(z)),a!==c?(ei=l,l={value:n,unit:"%"}):(et=l,l=c)):(et=l,l=c),en--,l===c&&0===en&&ed(k),(i=l)===c&&(en++,o=et,ef(),(h=em())!==c?("px"===t.substr(et,2)?(u="px",et+=2):(u=c,0===en&&ed(O)),u!==c?(ei=o,o={value:h,unit:"px"}):(et=o,o=c)):(et=o,o=c),o===c&&(o=et,ef(),(h=em())!==c?("cm"===t.substr(et,2)?(u="cm",et+=2):(u=c,0===en&&ed(F)),u!==c?(ei=o,o={value:h,unit:"cm"}):(et=o,o=c)):(et=o,o=c),o===c&&(o=et,ef(),(h=em())!==c?("mm"===t.substr(et,2)?(u="mm",et+=2):(u=c,0===en&&ed(E)),u!==c?(ei=o,o={value:h,unit:"mm"}):(et=o,o=c)):(et=o,o=c),o===c&&(o=et,ef(),(h=em())!==c?("in"===t.substr(et,2)?(u="in",et+=2):(u=c,0===en&&ed(V)),u!==c?(ei=o,o={value:h,unit:"in"}):(et=o,o=c)):(et=o,o=c),o===c&&(o=et,ef(),(h=em())!==c?("pt"===t.substr(et,2)?(u="pt",et+=2):(u=c,0===en&&ed(B)),u!==c?(ei=o,o={value:h,unit:"pt"}):(et=o,o=c)):(et=o,o=c),o===c&&(o=et,ef(),(h=em())!==c?("pc"===t.substr(et,2)?(u="pc",et+=2):(u=c,0===en&&ed(q)),u!==c?(ei=o,o={value:h,unit:"pc"}):(et=o,o=c)):(et=o,o=c)))))),en--,o===c&&0===en&&ed(U),(i=o)===c)&&(en++,d=et,(_=em())!==c?("deg"===t.substr(et,3)?(y="deg",et+=3):(y=c,0===en&&ed(Z)),y!==c?(ei=d,d={value:_,unit:"deg"}):(et=d,d=c)):(et=d,d=c),d===c&&(d=et,(_=em())!==c?("rad"===t.substr(et,3)?(y="rad",et+=3):(y=c,0===en&&ed(N)),y!==c?(ei=d,d={value:_,unit:"rad"}):(et=d,d=c)):(et=d,d=c),d===c&&(d=et,(_=em())!==c?(t.substr(et,4)===f?(y=f,et+=4):(y=c,0===en&&ed(Y)),y!==c?(ei=d,d={value:_,unit:"grad"}):(et=d,d=c)):(et=d,d=c),d===c&&(d=et,(_=em())!==c?(t.substr(et,4)===g?(y=g,et+=4):(y=c,0===en&&ed(W)),y!==c?(ei=d,d={value:_,unit:"turn"}):(et=d,d=c)):(et=d,d=c)))),en--,d===c&&(_=c,0===en&&ed(H)),(i=d)===c)&&(en++,p=et,ef(),(m=em())!==c?(ei=p,p={value:m,unit:null}):(et=p,p=c),en--,p===c&&0===en&&ed(X),i=p),i!==c&&(ei=e,i={type:"quantity",value:(s=i).value,unit:s.unit}),(e=i)===c&&(e=et,(i=function(){var e,i,s,r;if(en++,e=et,35===t.charCodeAt(et)?(i="#",et++):(i=c,0===en&&ed(Q)),i!==c){if(s=[],b.test(t.charAt(et))?(r=t.charAt(et),et++):(r=c,0===en&&ed(J)),r!==c)for(;r!==c;)s.push(r),b.test(t.charAt(et))?(r=t.charAt(et),et++):(r=c,0===en&&ed(J));else s=c;s!==c?(ei=e,e={type:"hex",value:ea()}):(et=e,e=c)}else et=e,e=c;return e===c&&(e=et,(i=ey())!==c&&(ei=e,i={type:"function",value:i}),(e=i)===c&&(e=et,(i=eg())!==c&&(ei=e,i={type:"named",value:ea()}),e=i)),en--,e===c&&(i=c,0===en&&ed(j)),e}())!==c&&(ei=e,i={type:"color",colorType:(r=i).type,value:r.value}),e=i),e}function ef(){var e,i;for(en++,e=[],m.test(t.charAt(et))?(i=t.charAt(et),et++):(i=c,0===en&&ed(M));i!==c;)e.push(i),m.test(t.charAt(et))?(i=t.charAt(et),et++):(i=c,0===en&&ed(M));return en--,i=c,0===en&&ed(C),e}function eg(){var e,i,s;if(en++,e=et,i=[],x.test(t.charAt(et))?(s=t.charAt(et),et++):(s=c,0===en&&ed(L)),s!==c)for(;s!==c;)i.push(s),x.test(t.charAt(et))?(s=t.charAt(et),et++):(s=c,0===en&&ed(L));else i=c;return i!==c&&(ei=e,i=ea()),en--,(e=i)===c&&(i=c,0===en&&ed(P)),e}function em(){var e,i,s,r,l,n,a;for(e=et,w.test(t.charAt(et))?(t.charAt(et),et++):0===en&&ed(G),i=et,s=[],v.test(t.charAt(et))?(r=t.charAt(et),et++):(r=c,0===en&&ed(K));r!==c;)s.push(r),v.test(t.charAt(et))?(r=t.charAt(et),et++):(r=c,0===en&&ed(K));if(46===t.charCodeAt(et)?(r=".",et++):(r=c,0===en&&ed($)),r!==c){if(l=[],v.test(t.charAt(et))?(n=t.charAt(et),et++):(n=c,0===en&&ed(K)),n!==c)for(;n!==c;)l.push(n),v.test(t.charAt(et))?(n=t.charAt(et),et++):(n=c,0===en&&ed(K));else l=c;l!==c?i=s=[s,r,l]:(et=i,i=c)}else et=i,i=c;if(i===c){if(i=[],v.test(t.charAt(et))?(s=t.charAt(et),et++):(s=c,0===en&&ed(K)),s!==c)for(;s!==c;)i.push(s),v.test(t.charAt(et))?(s=t.charAt(et),et++):(s=c,0===en&&ed(K));else i=c}if(i!==c){if(s=et,101===t.charCodeAt(et)?(r="e",et++):(r=c,0===en&&ed(ee)),r!==c){if(w.test(t.charAt(et))?(l=t.charAt(et),et++):(l=c,0===en&&ed(G)),l===c&&(l=null),n=[],v.test(t.charAt(et))?(a=t.charAt(et),et++):(a=c,0===en&&ed(K)),a!==c)for(;a!==c;)n.push(a),v.test(t.charAt(et))?(a=t.charAt(et),et++):(a=c,0===en&&ed(K));else n=c;n!==c?s=r=[r,l,n]:(et=s,s=c)}else et=s,s=c;s===c&&(s=null),ei=e,e=parseFloat(ea())}else et=e,e=c;return e}if((u=y())!==c&&et===t.length)return u;throw u!==c&&et<t.length&&ed({type:"end"}),a=el,o=er<t.length?t.charAt(er):null,s=er,r=er<t.length?er+1:er,l=ec(s),n=ec(r),h={source:d,start:{offset:s,line:l.line,column:l.column},end:{offset:r,line:n.line,column:n.column}},new e(e.buildMessage(a,o),a,o,h)}}},o.exports&&(o.exports=n());var h=o.exports;function u(e){if(!e||0===e.length)return null;if("string"==typeof e){let t=c(e);return t&&0!==t.length?t:null}let t=e.map(e=>{if(!Number.isFinite(e.scale)||e.scale<=0)throw new r.Z("effect:invalid-scale","scale must be finite and greater than 0",{stop:e});return{scale:e.scale,effects:c(e.value)}});t.sort((e,t)=>t.effects.length-e.effects.length);for(let e=0;e<t.length-1;e++){if(!(0,a.AS)(t[e].effects,t[e+1].effects))throw new r.Z("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:t[e].effects,b:t[e+1].effects});(0,a.uF)(t[e].effects,t[e+1].effects)}return t.sort((e,t)=>t.scale-e.scale),t}function c(e){let t;if(!e)return[];try{t=h.parse(e)}catch(t){throw new r.Z("effect:invalid-syntax","Invalid effect syntax",{value:e,error:t})}return t.map(e=>(function(e){try{var t;switch(e.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":let i;return i=1,d(e.parameters,1),1===e.parameters.length&&(i=g(e.parameters[0])),new l.GI(e.name,i);case"opacity":let n;return n=1,d(e.parameters,1),1===e.parameters.length&&(n=g(e.parameters[0])),new l.Zx(n);case"hue-rotate":let a;return a=0,d(e.parameters,1),1===e.parameters.length&&(t=e.parameters[0],function(e){if("quantity"!==e.type||!(0===e.value&&null===e.unit||e.unit&&null!=p[e.unit]))throw new r.Z("effect:type-error",`Expected <angle>, Actual: ${_(e)}`,{term:e})}(t),a=t.value*p[t.unit]||0),new l.Tq(a);case"blur":let o;return o=0,d(e.parameters,1),1===e.parameters.length&&y(o=m(e.parameters[0]),e.parameters[0]),new l.Tj(o);case"drop-shadow":return function(e){let t=[],i=null;for(let l of e.parameters)if("color"===l.type){if(t.length&&Object.freeze(t),i)throw new r.Z("effect:type-error","Accepts only one color",{});i=function(e){switch(e.colorType){case"hex":return(0,s.rW)(e.value);case"named":return x(e.value);case"function":return function(e){if(d(e.parameters,4),b.test(e.name))return[g(e.parameters[0]),g(e.parameters[1]),g(e.parameters[2]),e.parameters[3]?g(e.parameters[3]):1];if(w.test(e.name)){var t;return(0,s.B7)((function(e){if("quantity"!==e.type||null!==e.unit)throw new r.Z("effect:type-error",`Expected <double>, Actual: ${_(e)}`,{term:e})}(t=e.parameters[0]),y(t.value,t),t.value),g(e.parameters[1]),g(e.parameters[2]),e.parameters[3]?g(e.parameters[3]):1)}throw new r.Z("effect:syntax-error",`Invalid color function '${e.name}'`,{colorFunction:e})}(e.value)}}(l)}else{let e=m(l);if(Object.isFrozen(t))throw new r.Z("effect:type-error","<length> parameters not consecutive",{lengths:t});t.push(e),3===t.length&&y(e,l)}if(t.length<2||t.length>3)throw new r.Z("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${t.length}}`,{lengths:t});return new l.CE(t[0],t[1],t[2]||0,i||x("black"))}(e);case"bloom":let h,u,c;return h=1,u=0,c=0,d(e.parameters,3),e.parameters[0]&&(h=g(e.parameters[0])),e.parameters[1]&&y(u=m(e.parameters[1]),e.parameters[1]),e.parameters[2]&&(c=g(e.parameters[2])),new l.rk(h,u,c)}}catch(t){throw t.details.filter=e,t}throw new r.Z("effect:unknown-effect",`Effect '${e.name}' is not supported`,{effect:e})})(e))}function d(e,t){if(e.length>t)throw new r.Z("effect:type-error",`Function supports up to ${t} parameters, Actual: ${e.length}`,{parameters:e})}function _(e){if("color"===e.type)return"<color>";if(e.unit){if(e.unit in f)return"<length>";if(e.unit in p)return"<angle>";if("%"===e.unit)return"<percentage>"}return"<double>"}function y(e,t){if(e<0)throw new r.Z("effect:type-error",`Negative values are not allowed, Actual: ${e}`,{term:t})}let p={deg:1,grad:.9,rad:180/Math.PI,turn:360},f={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function g(e){!function(e){if("quantity"!==e.type||null!==e.unit&&"%"!==e.unit)throw new r.Z("effect:type-error",`Expected <double> or <percentage>, Actual: ${_(e)}`,{term:e})}(e);let t=e.value;return y(t,e),"%"===e.unit?.01*t:t}function m(e){return function(e){if("quantity"!==e.type||!(0===e.value&&null===e.unit||e.unit&&null!=f[e.unit]))throw new r.Z("effect:type-error",`Expected <length>, Actual: ${_(e)}`,{term:e})}(e),e.value*f[e.unit]||0}function x(e){if(!(0,s.St)(e))throw new r.Z("effect:unknown-color",`color '${e}' isn't valid`,{namedColor:e});return(0,s.VL)(e)}let b=/^rgba?/i,w=/^hsla?/i},9736:function(e,t,i){i.d(t,{L:function(){return r},v:function(){return s}});let s=15.5,r=1024},27522:function(e,t,i){i.d(t,{Y:function(){return a},m:function(){return o}});var s=i(44837),r=i(13507),l=i(9736);let n=e=>"vertical"===e||"horizontal"===e||"cross"===e||"esriSFSCross"===e||"esriSFSVertical"===e||"esriSFSHorizontal"===e;function a(e,t,i){let s;let l=t.style,a=(0,r.fp)(Math.ceil(i)),o=n(l)?8*a:16*a,h=2*a;e.width=o,e.height=o;let u=e.getContext("2d");u.strokeStyle="#FFFFFF",u.lineWidth=a,u.beginPath(),"vertical"!==l&&"cross"!==l&&"esriSFSCross"!==l&&"esriSFSVertical"!==l||(u.moveTo(o/2,-h),u.lineTo(o/2,o+h)),"horizontal"!==l&&"cross"!==l&&"esriSFSCross"!==l&&"esriSFSHorizontal"!==l||(u.moveTo(-h,o/2),u.lineTo(o+h,o/2)),"backward-diagonal"!==l&&"diagonal-cross"!==l&&"esriSFSDiagonalCross"!==l&&"esriSFSBackwardDiagonal"!==l||(u.moveTo(-h,-h),u.lineTo(o+h,o+h),u.moveTo(o-h,-h),u.lineTo(o+h,h),u.moveTo(-h,o-h),u.lineTo(h,o+h)),"forward-diagonal"!==l&&"diagonal-cross"!==l&&"esriSFSForwardDiagonal"!==l&&"esriSFSDiagonalCross"!==l||(u.moveTo(o+h,-h),u.lineTo(-h,o+h),u.moveTo(h,-h),u.lineTo(-h,h),u.moveTo(o+h,o-h),u.lineTo(o-h,o+h)),u.stroke();let c=new Uint8Array(u.getImageData(0,0,e.width,e.height).data);for(let e=0;e<c.length;e+=4)s=c[e+3]/255,c[e]=c[e]*s,c[e+1]=c[e+1]*s,c[e+2]=c[e+2]*s;return[c,e.width,e.height,a]}function o(e,t){null==e&&(e=[]);let i="Butt"===t,r="Square"===t,n=!i&&!r;e.length%2==1&&(e=[...e,...e]);let a=l.v,o=2*a,h=0;for(let t of e)h+=t;let u=Math.round(h*a),c=new Float32Array(u*o),d=.5*a,_=0,y=0,p=.5,f=!0;for(let t of e){for(_=y,y+=t*a;p<=y;){let e=.5;for(;e<o;){let t=(e-.5)*u+p-.5,s=n?(e-a)*(e-a):Math.abs(e-a);c[t]=f?i?Math.max(Math.max(_+d-p,s),Math.max(p-y+d,s)):s:n?Math.min((p-_)*(p-_)+s,(p-y)*(p-y)+s):r?Math.min(Math.max(p-_,s),Math.max(y-p,s)):Math.min(Math.max(p-_+d,s),Math.max(y+d-p,s)),e++}p++}f=!f}let g=c.length,m=new Uint8Array(4*g);for(let e=0;e<g;++e){let t=(n?Math.sqrt(c[e]):c[e])/a;(0,s.I)(t,m,4*e)}return[m,u,o]}},54583:function(e,t,i){i.d(t,{Z:function(){return n}});var s,r,l=i(83536);(s=r||(r={}))[s.moveTo=1]="moveTo",s[s.lineTo=2]="lineTo",s[s.close=7]="close";class n{constructor(e,t,i=0){this.values={},this._geometry=void 0,this._pbfGeometry=null,this.featureIndex=i;let s=t.keys,r=t.values,l=e.asUnsafe();for(;l.next();)switch(l.tag()){case 1:this.id=l.getUInt64();break;case 2:{let e=l.getMessage().asUnsafe(),t=this.values;for(;!e.empty();){let i=e.getUInt32(),l=e.getUInt32();t[s[i]]=r[l]}e.release();break}case 3:this.type=l.getUInt32();break;case 4:this._pbfGeometry=l.getMessage();break;default:l.skip()}}getGeometry(e){let t,i;if(void 0!==this._geometry)return this._geometry;if(!this._pbfGeometry)return null;let s=this._pbfGeometry.asUnsafe();this._pbfGeometry=null,e?e.reset(this.type):t=[];let n,a=r.moveTo,o=0,h=0,u=0;for(;!s.empty();){if(0===o){let e=s.getUInt32();a=7&e,o=e>>3}switch(o--,a){case r.moveTo:h+=s.getSInt32(),u+=s.getSInt32(),e?e.moveTo(h,u):t&&(i&&t.push(i),(i=[]).push(new l.E9(h,u)));break;case r.lineTo:h+=s.getSInt32(),u+=s.getSInt32(),e?e.lineTo(h,u):i&&i.push(new l.E9(h,u));break;case r.close:e?e.close():i&&!i[0].equals(h,u)&&i.push(i[0].clone());break;default:throw s.release(),Error("Invalid path operation")}}return e?n=e.result():t&&(i&&t.push(i),n=t),s.release(),this._geometry=n,n}}},78610:function(e,t,i){i.d(t,{DQ:function(){return d},FM:function(){return l},KU:function(){return g},Of:function(){return m},Or:function(){return _},Px:function(){return b},RD:function(){return n},Wg:function(){return v},Z0:function(){return x},k3:function(){return p},nF:function(){return u},pK:function(){return w},s5:function(){return y},sX:function(){return f},yF:function(){return a}});var s=i(20058),r=i(83536);let l=Number.POSITIVE_INFINITY,n=Math.PI,a=2*n,o=128/n,h=256/360,u=n/180,c=1/Math.LN2;function d(e,t){return(e%=t)>=0?e:e+t}function _(e){return d(e*o,256)}function y(e){return d(e*h,256)}function p(e){return Math.log(e)*c}function f(e,t,i){return e*(1-i)+t*i}function g(e){return 8+Math.max((e-14)*16,0)}function m(e,t,i){let s,r,l,n=0;for(let a of i){s=a.length;for(let i=1;i<s;++i)r=a[i-1],l=a[i],r.y>t!=l.y>t&&((l.x-r.x)*(t-r.y)-(l.y-r.y)*(e-r.x)>0?n++:n--)}return 0!==n}function x(e,t,i,r){let l,n,a,o;let h=r*r;for(let r of i){let i=r.length;if(!(i<2)){l=r[0].x,n=r[0].y;for(let u=1;u<i;++u){if(a=r[u].x,o=r[u].y,(0,s.Hu)(e,t,l,n,a,o)<h)return!0;l=a,n=o}}}return!1}function b(e,t,i,s,r,l,n){let a=Math.max(s,Math.min(t,l))-t,o=Math.max(r,Math.min(i,n))-i;return a*a+o*o<=e*e}function w(e,t){if(0===t||Number.isNaN(t))return e;let i=[],s=new r.E9(0,0),l=new r.E9(0,0),n=new r.E9(0,0);for(let a=0;a<e.length;a++){let o=e[a],h=[];for(let e=0;e<o.length;e++){let i=o[e-1],a=o[e],u=o[e+1];0===e?s.setCoords(0,0):s.assignSub(a,i).normalize().rightPerpendicular(),e===o.length-1?l.setCoords(0,0):l.assignSub(u,a).normalize().rightPerpendicular(),n.assignAdd(s,l).normalize();let c=n.x*l.x+n.y*l.y;0!==c&&n.scale(1/c),h.push(r.E9.add(a,n.scale(t)))}i.push(h)}return i}function v(e,t,i,s){let l=new r.E9(e[0],e[1]);if(l.scale(s),"viewport"===t){let e=-(Math.PI/180*i),t=Math.cos(e),s=Math.sin(e);l.rotate(t,s)}return l}},40050:function(e,t,i){i.d(t,{Z:function(){return s}});class s{constructor(e){this.extent=4096,this.keys=[],this.values=[],this._pbfLayer=e.clone();let t=e.asUnsafe();for(;t.next();)switch(t.tag()){case 1:this.name=t.getString();break;case 3:this.keys.push(t.getString());break;case 4:this.values.push(t.processMessage(s._parseValue));break;case 5:this.extent=t.getUInt32();break;default:t.skip()}}getData(){return this._pbfLayer}static _parseValue(e){for(;e.next();)switch(e.tag()){case 1:return e.getString();case 2:return e.getFloat();case 3:return e.getDouble();case 4:return e.getInt64();case 5:return e.getUInt64();case 6:return e.getSInt64();case 7:return e.getBool();default:e.skip()}return null}}},42860:function(e,t,i){i.d(t,{Z:function(){return s}});class s{constructor(e=0,t=0,i=0,s=0){this.x=e,this.y=t,this.width=i,this.height=s}get isEmpty(){return this.width<=0||this.height<=0}union(e){this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.width=Math.max(this.width,e.width),this.height=Math.max(this.height,e.height)}}},7748:function(e,t,i){i.d(t,{Z:function(){return h}});var s=i(37180),r=i(80320),l=i(67236),n=i(10219),a=i(55101);let o=(e,t)=>e.key.level-t.key.level!=0?e.key.level-t.key.level:e.key.row-t.key.row!=0?e.key.row-t.key.row:e.key.col-t.key.col;class h extends l.Z{constructor(e){super(),this._tileInfoView=e}renderChildren(e){this.sortChildren(o),this.setStencilReference(e),super.renderChildren(e)}createRenderParams(e){let{state:t}=e,i=super.createRenderParams(e);return i.requiredLevel=this._tileInfoView.getClosestInfoForScale(t.scale).level,i.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(t.scale),i}prepareRenderPasses(e){let t=super.prepareRenderPasses(e);return t.push(e.registerRenderPass({name:"stencil",brushes:[n.Z],drawPhase:r.jx.DEBUG|r.jx.MAP|r.jx.HIGHLIGHT|r.jx.LABEL,target:()=>this.getStencilTarget()})),(0,s.Z)("esri-tiles-debug")&&t.push(e.registerRenderPass({name:"tileInfo",brushes:[a.Z],drawPhase:r.jx.DEBUG,target:()=>this.children})),t}getStencilTarget(){return this.children}setStencilReference(e){let t=1;for(let e of this.children)e.stencilRef=t++}}},50338:function(e,t,i){i.d(t,{y:function(){return w}});var s,r=i(86641),l=i(50973),n=i(4514),a=i(94605),o=i(20128),h=i(89312);i(37180),i(65223),i(3457);var u=i(64186),c=i(43390),d=i(25823),_=i(76457);let y=s=class extends _.Z{constructor(e){super(e),this.type="rect",this.left=null,this.right=null,this.top=null,this.bottom=null}clone(){return new s({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}commitVersionProperties(){this.commitProperty("left"),this.commitProperty("right"),this.commitProperty("top"),this.commitProperty("bottom")}};(0,r._)([(0,h.Cb)({type:[Number,String],json:{write:!0}})],y.prototype,"left",void 0),(0,r._)([(0,h.Cb)({type:[Number,String],json:{write:!0}})],y.prototype,"right",void 0),(0,r._)([(0,h.Cb)({type:[Number,String],json:{write:!0}})],y.prototype,"top",void 0),(0,r._)([(0,h.Cb)({type:[Number,String],json:{write:!0}})],y.prototype,"bottom",void 0);let p=y=s=(0,r._)([(0,u.j)("esri.views.layers.support.ClipRect")],y);var f=i(55485);let g=class extends _.Z{constructor(e){super(e),this.type="path",this.path=[]}commitVersionProperties(){this.commitProperty("path")}};(0,r._)([(0,h.Cb)({type:[[[Number]]],json:{write:!0}})],g.prototype,"path",void 0);let m=g=(0,r._)([(0,u.j)("esri.views.layers.support.Path")],g);var x=i(37864);let b=l.Z.ofType({key:"type",base:null,typeMap:{rect:p,path:m,geometry:f.Z}}),w=e=>{let t=class extends e{constructor(){super(...arguments),this.attached=!1,this.clips=new b,this.highlightOptions=null,this.lastUpdateId=-1,this.moving=!1,this.updateRequested=!1,this._visibleAtCurrentScale=!0}initialize(){let e=this.view?.spatialReferenceLocked??!0;this.view?.spatialReference&&e&&!this.spatialReferenceSupported?this.addResolvingPromise(Promise.reject(new a.Z("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new c.W),this.container.fadeTransitionEnabled=!0,this.container.visible=!1,this.container.endTransitions(),this.addHandles([(0,o.YP)(()=>this.suspended,e=>{this.container&&(this.container.visible=!e)},o.tX),(0,o.YP)(()=>this.updateSuspended,e=>{this.view&&!e&&this.updateRequested&&this.view.requestUpdate()},o.tX),(0,o.YP)(()=>this.layer?.opacity??1,e=>{this.container&&(this.container.opacity=e)},o.tX),(0,o.YP)(()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal",e=>{this.container&&(this.container.blendMode=e)},o.tX),(0,o.YP)(()=>this.layer&&"effect"in this.layer?this.layer.effect:null,e=>{this.container&&(this.container.effect=e)},o.tX),(0,o.YP)(()=>this.highlightOptions,e=>this.container.highlightOptions=e,o.tX),(0,o.on)(()=>this.clips,"change",()=>{this.container&&(this.container.clips=this.clips)},o.tX),(0,o.YP)(()=>({scale:this.view?.scale,scaleRange:this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null}),({scale:e,scaleRange:t})=>{let i=(0,x.GB)(t,e);i!==this._visibleAtCurrentScale&&(this._visibleAtCurrentScale=i)},o.tX)],"constructor"),this.view?.whenLayerView?this.view.whenLayerView(this.layer).then(e=>{e===this&&this.processAttach()},()=>{}):this.when().then(()=>{this.processAttach()},()=>{}))}destroy(){this.processDetach(),this.updateRequested=!1}get spatialReferenceSupported(){let e=this.view?.spatialReference;return null==e||this.supportsSpatialReference(e)}get updating(){return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!!this._updatingHandles?.updating)}get visibleAtCurrentScale(){return this._visibleAtCurrentScale}processAttach(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())}processDetach(){this.attached&&(this.attached=!1,this.removeHandles("attach"),this.detach(),this.updateRequested=!1)}requestUpdate(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.updateSuspended||this.view.requestUpdate())}processUpdate(e){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",e),this.updateRequested&&!this.updateSuspended&&(this.updateRequested=!1,this.update(e))):this.updateRequested=!1}hitTest(e,t){return Promise.resolve(null)}supportsSpatialReference(e){return!0}canResume(){return!!this.spatialReferenceSupported&&!!super.canResume()&&this.visibleAtCurrentScale}getSuspendInfo(){let e=super.getSuspendInfo(),t=!this.spatialReferenceSupported;return t&&(e.spatialReferenceNotSupported=t),e}addAttachHandles(e){this.addHandles(e,"attach")}};return(0,r._)([(0,h.Cb)()],t.prototype,"attached",void 0),(0,r._)([(0,h.Cb)({type:b,set(e){let t=(0,n.Z)(e,this._get("clips"),b);this._set("clips",t)}})],t.prototype,"clips",void 0),(0,r._)([(0,h.Cb)()],t.prototype,"container",void 0),(0,r._)([(0,h.Cb)({type:d.Z})],t.prototype,"highlightOptions",void 0),(0,r._)([(0,h.Cb)()],t.prototype,"moving",void 0),(0,r._)([(0,h.Cb)({readOnly:!0})],t.prototype,"spatialReferenceSupported",null),(0,r._)([(0,h.Cb)({readOnly:!0})],t.prototype,"updateParameters",void 0),(0,r._)([(0,h.Cb)()],t.prototype,"updateRequested",void 0),(0,r._)([(0,h.Cb)()],t.prototype,"updating",null),(0,r._)([(0,h.Cb)()],t.prototype,"view",void 0),(0,r._)([(0,h.Cb)()],t.prototype,"_visibleAtCurrentScale",void 0),(0,r._)([(0,h.Cb)({readOnly:!0})],t.prototype,"visibleAtCurrentScale",null),t=(0,r._)([(0,u.j)("esri.views.2d.layers.LayerView2D")],t)}},59199:function(e,t,i){i.r(t),i.d(t,{default:function(){return eP}});var s=i(86641),r=i(61764),l=i(65223),n=i(36152),a=i(31124),o=i(89312);i(37180);var h=i(64186),u=i(97558),c=i(33876),d=i(20795),_=i(62329),y=i(36362),p=i(72659),f=i(28707),g=i(42860);class m{constructor(e,t){this._width=0,this._height=0,this._free=[],this._width=e,this._height=t,this._free.push(new g.Z(0,0,e,t))}get width(){return this._width}get height(){return this._height}allocate(e,t){if(e>this._width||t>this._height)return new g.Z;let i=null,s=-1;for(let r=0;r<this._free.length;++r){let l=this._free[r];e<=l.width&&t<=l.height&&(null===i||l.y<=i.y&&l.x<=i.x)&&(i=l,s=r)}return null===i?new g.Z:(this._free.splice(s,1),i.width<i.height?(i.width>e&&this._free.push(new g.Z(i.x+e,i.y,i.width-e,t)),i.height>t&&this._free.push(new g.Z(i.x,i.y+t,i.width,i.height-t))):(i.width>e&&this._free.push(new g.Z(i.x+e,i.y,i.width-e,i.height)),i.height>t&&this._free.push(new g.Z(i.x,i.y+t,e,i.height-t))),new g.Z(i.x,i.y,e,t))}release(e){for(let t=0;t<this._free.length;++t){let i=this._free[t];if(i.y===e.y&&i.height===e.height&&i.x+i.width===e.x)i.width+=e.width;else if(i.x===e.x&&i.width===e.width&&i.y+i.height===e.y)i.height+=e.height;else if(e.y===i.y&&e.height===i.height&&e.x+e.width===i.x)i.x=e.x,i.width+=e.width;else{if(e.x!==i.x||e.width!==i.width||e.y+e.height!==i.y)continue;i.y=e.y,i.height+=e.height}this._free.splice(t,1),this.release(e)}this._free.push(e)}}var x=i(71193),b=i(15809),w=i(66897);class v{constructor(e,t,i){this.width=0,this.height=0,this._dirties=[],this._glyphData=[],this._currentPage=0,this._glyphIndex={},this._textures=[],this._rangePromises=new Map,this.width=e,this.height=t,this._glyphSource=i,this._binPack=new m(e-4,t-4),this._glyphData.push(new Uint8Array(e*t)),this._dirties.push(!0),this._textures.push(void 0)}getGlyphItems(e,t){let i=[],s=this._glyphSource,r=new Set,l=1/256;for(let e of t){let t=Math.floor(e*l);r.add(t)}let n=[];return r.forEach(t=>{let i=e+t;if(this._rangePromises.has(i))n.push(this._rangePromises.get(i));else{let r=s.getRange(e,t).then(()=>{this._rangePromises.delete(i)},()=>{this._rangePromises.delete(i)});this._rangePromises.set(i,r),n.push(r)}}),Promise.all(n).then(()=>{let r=this._glyphIndex[e];for(let l of(r||(r={},this._glyphIndex[e]=r),t)){let t;let n=r[l];if(n){i[l]={sdf:!0,rect:n.rect,metrics:n.metrics,page:n.page,code:l};continue}let a=s.getGlyph(e,l);if(!a?.metrics)continue;let o=a.metrics;if(0===o.width)t=new g.Z(0,0,0,0);else{let e,i;let s=o.width+6,r=o.height+6,l=s%4?4-s%4:4,n=r%4?4-r%4:4;1===l&&(l=5),1===n&&(n=5),(t=this._binPack.allocate(s+l,r+n)).isEmpty&&(this._dirties[this._currentPage]||(this._glyphData[this._currentPage]=null),this._currentPage=this._glyphData.length,this._glyphData.push(new Uint8Array(this.width*this.height)),this._dirties.push(!0),this._textures.push(void 0),this._binPack=new m(this.width-4,this.height-4),t=this._binPack.allocate(s+l,r+n));let h=this._glyphData[this._currentPage],u=a.bitmap;if(u)for(let l=0;l<r;l++){e=s*l,i=this.width*(t.y+l+1)+t.x;for(let t=0;t<s;t++)h[i+t+1]=u.at(e+t)}}r[l]={rect:t,metrics:o,tileIDs:null,page:this._currentPage},i[l]={sdf:!0,rect:t,metrics:o,page:this._currentPage,code:l},this._dirties[this._currentPage]=!0}return i})}removeGlyphs(e){for(let t in this._glyphIndex){let i;let s=this._glyphIndex[t];if(s){for(let t in s)if((i=s[t]).tileIDs.delete(e),0===i.tileIDs.size){let e,r;let l=this._glyphData[i.page],n=i.rect;for(let t=0;t<n.height;t++)for(e=this.width*(n.y+t)+n.x,r=0;r<n.width;r++)l[e+r]=0;delete s[t],this._dirties[i.page]=!0}}}}bind(e,t,i,s=0){if(!this._textures[i]){let t=new w.X;t.pixelFormat=x.VI.ALPHA,t.wrapMode=x.e8.CLAMP_TO_EDGE,t.width=this.width,t.height=this.height,this._textures[i]=new b.x(e,t,new Uint8Array(this.width*this.height))}let r=this._textures[i];r.setSamplingMode(t),this._dirties[i]&&r.setData(this._glyphData[i]),e.bindTexture(r,s),this._dirties[i]=!1}destroy(){this.dispose()}dispose(){for(let e of(this._glyphData.length=0,this._binPack=null,this._textures))e&&e.dispose();this._textures.length=0}}var S=i(54748),I=i(97177);class T{constructor(e){if(this._metrics=[],!e)return void(this._allBitmaps=null);let t=new Map,i=0;for(;e.next();)if(1===e.tag()){let s=e.getMessage();for(;s.next();)if(3===s.tag()){let e,r,l,n,a,o,h;let u=s.getMessage();for(;u.next();)switch(u.tag()){case 1:e=u.getUInt32();break;case 2:r=u.getBytes();break;case 3:l=u.getUInt32();break;case 4:n=u.getUInt32();break;case 5:a=u.getSInt32();break;case 6:o=u.getSInt32();break;case 7:h=u.getUInt32();break;default:u.skip()}if(u.release(),e){let s=r?.length??0;this._metrics[e]={width:l,height:n,left:a,top:o,advance:h,startOffset:i,length:s},t.set(e,r),i+=s}}else s.skip();s.release()}else e.skip();let s=new Uint8Array(i),r=this._metrics;for(let[e,i]of t){let{startOffset:t,length:l}=r[e];if(i)for(let e=0;e<l;++e)s[t+e]=i[e]}this._allBitmaps=s}getMetrics(e){return this._metrics[e]}getBitmap(e){if(!this._allBitmaps)return;let t=this._metrics[e];if(void 0===t)return;let{startOffset:i,length:s}=t;return 0!==s?new M(this._allBitmaps,i,s):void 0}}class R{constructor(){this._ranges=[]}get ranges(){return this._ranges}getRange(e){return this._ranges[e]}addRange(e,t){this._ranges[e]=t}}class C{constructor(e){this._glyphInfo={},this._baseURL=e}getRange(e,t){let i=this._getFontStack(e);if(i.getRange(t))return Promise.resolve();let s=256*t;if(this._baseURL){let r=this._baseURL.replace("{fontstack}",e).replace("{range}",s+"-"+(s+255));return(0,S.Z)(r,{responseType:"array-buffer"}).then(e=>{i.addRange(t,new T(new I.Z(new Uint8Array(e.data),new DataView(e.data))))}).catch(()=>{i.addRange(t,new T)})}return i.addRange(t,new T),Promise.resolve()}getGlyph(e,t){let i=this._getFontStack(e);if(!i)return;let s=Math.floor(t/256),r=i.getRange(s);return r?{metrics:r.getMetrics(t),bitmap:r.getBitmap(t)}:void 0}_getFontStack(e){let t=this._glyphInfo[e];return t||(t=this._glyphInfo[e]=new R),t}}class M{constructor(e,t,i){this._array=e,this._start=t,this.length=i}at(e){return 0<=e&&e<this.length?this._array[this._start+e]:void 0}}var A=i(27522);class D{constructor(e,t,i=0){this._size=[],this._mosaicsData=[],this._textures=[],this._dirties=[],this._maxItemSize=0,this._currentPage=0,this._pageWidth=0,this._pageHeight=0,this._mosaicRects={},this.pixelRatio=1,t<=0&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!"),this._pageWidth=e,this._pageHeight=t,i>0&&(this._maxItemSize=i),this._binPack=new m(e-4,t-4)}destroy(){this.dispose()}dispose(){for(let e of(this._binPack=null,this._mosaicsData.length=0,this._mosaicRects={},this._textures))e&&e.dispose();this._textures.length=0}getWidth(e){return e>=this._size.length?-1:this._size[e][0]}getHeight(e){return e>=this._size.length?-1:this._size[e][1]}getPageSize(e){return e>=this._size.length?null:this._size[e]}setSpriteSource(e){if(this.dispose(),this.pixelRatio=e.devicePixelRatio,0===this._mosaicsData.length){this._binPack=new m(this._pageWidth-4,this._pageHeight-4);let e=new Uint32Array(Math.floor(this._pageWidth)*Math.floor(this._pageHeight));this._mosaicsData[0]=e,this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0)}this._sprites=e}getSpriteItem(e,t=!1){let i,s,r=this._mosaicRects[e];if(r)return r;if(!this._sprites||"loaded"!==this._sprites.loadStatus||(e&&e.startsWith("dasharray-")?([i,s]=this._rasterizeDash(e),t=!0):i=this._sprites.getSpriteInfo(e),!i?.width||!i.height||i.width<0||i.height<0))return null;let l=i.width,n=i.height,[a,o,h]=this._allocateImage(l,n);return a.width<=0?null:(this._copy(a,i,o,h,t,s),r={type:"sprite",rect:a,width:l,height:n,sdf:i.sdf,simplePattern:!1,rasterizationScale:i.pixelRatio,page:o},this._mosaicRects[e]=r,r)}getSpriteItems(e){let t={};for(let i of e)t[i.name]=this.getSpriteItem(i.name,i.repeat);return t}getMosaicItemPosition(e,t){let i=this.getSpriteItem(e,t),s=i?.rect;if(!s)return null;s.width=i.width,s.height=i.height;let r=i.width,l=i.height;return{tl:[s.x+2,s.y+2],br:[s.x+2+r,s.y+2+l],page:i.page}}bind(e,t,i=0,s=0){if(i>=this._size.length||i>=this._mosaicsData.length)return;if(!this._textures[i]){let t=new w.X;t.wrapMode=x.e8.CLAMP_TO_EDGE,t.width=this._size[i][0],t.height=this._size[i][1],this._textures[i]=new b.x(e,t,new Uint8Array(this._mosaicsData[i].buffer))}let r=this._textures[i];r.setSamplingMode(t),this._dirties[i]&&r.setData(new Uint8Array(this._mosaicsData[i].buffer)),e.bindTexture(r,s),this._dirties[i]=!1}static _copyBits(e,t,i,s,r,l,n,a,o,h,u){let c=s*t+i,d=a*l+n;if(u){d-=l;for(let n=-1;n<=h;c=((++n+h)%h+s)*t+i,d+=l)for(let t=-1;t<=o;t++)r[d+t]=e[c+(t+o)%o]}else for(let i=0;i<h;i++){for(let t=0;t<o;t++)r[d+t]=e[c+t];c+=t,d+=l}}_copy(e,t,i,s,r,l){if(!this._sprites||"loaded"!==this._sprites.loadStatus||i>=this._mosaicsData.length)return;let n=new Uint32Array(l?l.buffer:this._sprites.image.buffer),a=this._mosaicsData[i],o=l?t.width:this._sprites.width;D._copyBits(n,o,t.x,t.y,a,s[0],e.x+2,e.y+2,t.width,t.height,r),this._dirties[i]=!0}_allocateImage(e,t){e+=2,t+=2;let i=Math.max(e,t);if(this._maxItemSize&&this._maxItemSize<i){let i=new g.Z(0,0,e,t);return this._mosaicsData.push(new Uint32Array(e*t)),this._dirties.push(!0),this._size.push([e,t]),this._textures.push(void 0),[i,this._mosaicsData.length-1,[e,t]]}let s=e%4?4-e%4:4,r=t%4?4-t%4:4;1===s&&(s=5),1===r&&(r=5);let l=this._binPack.allocate(e+s,t+r);return l.width<=0?(this._dirties[this._currentPage]||(this._mosaicsData[this._currentPage]=null),this._currentPage=this._mosaicsData.length,this._mosaicsData.push(new Uint32Array(this._pageWidth*this._pageHeight)),this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0),this._binPack=new m(this._pageWidth-4,this._pageHeight-4),this._allocateImage(e,t)):[l,this._currentPage,[this._pageWidth,this._pageHeight]]}_rasterizeDash(e){let t=e.match(/\[(.*?)\]/);if(!t)return null;let i=t[1].split(",").map(Number),s=e.slice(e.lastIndexOf("-")+1),[r,l,n]=(0,A.m)(i,s);return[{x:0,y:0,width:l,height:n,sdf:!0,pixelRatio:1},new Uint8Array(r.buffer)]}}var P=i(8622);class L{constructor(e,t,i,s){this._layer=e,this._styleRepository=t,this.devicePixelRatio=i,this._sourceDataMaxLOD=s,this._spriteMosaic=null,this._glyphMosaic=null,this._connection=null,this._spriteSourceAbortController=null,this._startOptionsInputSignal=null,this._inputSignalEventListener=null}destroy(){this._connection?.close(),this._connection=null,this._styleRepository=null,this._layer=null,this._spriteMosaic?.destroy(),this._spriteMosaic=null,this._glyphMosaic=null,this._spriteSourceAbortController=(0,n.IM)(this._spriteSourceAbortController),this._spriteSourcePromise=null,this._inputSignalEventListener&&this._startOptionsInputSignal?.removeEventListener("abort",this._inputSignalEventListener),this._startOptionsInputSignal=null,this._inputSignalEventListener=null}get spriteMosaic(){return this._spriteSourcePromise.then(()=>this._spriteMosaic)}get glyphMosaic(){return this._glyphMosaic}async start(e){this._requestSprite(e);let t=this._layer.currentStyleInfo.glyphsUrl,i=new C(t?(0,p.fl)(t,{...this._layer.customParameters,token:this._layer.apiKey}):null);this._glyphMosaic=new v(1024,1024,i),this._broadcastPromise=(0,f.bA)("WorkerTileHandler",{client:this,schedule:e.schedule,signal:e.signal}).then(t=>{this._layer&&(this._connection?.close(),this._connection=t,this._layer&&!this._connection.closed)&&Promise.all(t.broadcast("setStyle",{style:this._layer.currentStyleInfo.style,sourceDataMaxLOD:this._sourceDataMaxLOD},e)).catch(e=>(0,a.H9)(e))})}_requestSprite(e){this._spriteSourceAbortController?.abort();let t=new AbortController;this._spriteSourceAbortController=t;let i=e?.signal;this._inputSignalEventListener&&this._startOptionsInputSignal?.removeEventListener("abort",this._inputSignalEventListener),this._startOptionsInputSignal=null,i&&(this._inputSignalEventListener=()=>t.abort(),i.addEventListener("abort",this._inputSignalEventListener,{once:!0}));let{signal:s}=t,r={...e,signal:s};this._spriteSourcePromise=this._layer.loadSpriteSource(this.devicePixelRatio,r),this._spriteSourcePromise.then(e=>{(0,a.r9)(s),this._spriteMosaic=new D(1024,1024,250),this._spriteMosaic.setSpriteSource(e)})}async updateStyle(e){return await this._broadcastPromise,this._broadcastPromise=Promise.all(this._connection.broadcast("updateStyle",e)),this._broadcastPromise}setSpriteSource(e){let t=new D(1024,1024,250);return t.setSpriteSource(e),this._spriteMosaic=t,this._spriteSourcePromise=Promise.resolve(e),this._spriteSourceAbortController=null,t}async setStyle(e,t,i){await this._broadcastPromise,this._styleRepository=e,this._sourceDataMaxLOD=i,this._requestSprite();let s=new C(this._layer.currentStyleInfo.glyphsUrl?(0,p.fl)(this._layer.currentStyleInfo.glyphsUrl,{...this._layer.customParameters,token:this._layer.apiKey}):null);return this._glyphMosaic=new v(1024,1024,s),this._broadcastPromise=Promise.all(this._connection.broadcast("setStyle",{style:t,sourceDataMaxLOD:this._sourceDataMaxLOD})),this._broadcastPromise}async fetchTileData(e,t){let i=await this._getRefKeys(e,t);return this._getSourcesData(Object.keys(this._layer.sourceNameToSource),i,t)}async fetchTilePBFs(e){let t=Object.keys(this._layer.sourceNameToSource),i={},s=await this._getRefKeys(e,i),r=[],l=[];for(let e=0;e<s.length;e++)if(null==s[e].value||null==t[e])l.push(null);else{let n=s[e].value,a=this._getTilePayload(n,t[e],i);a.then(e=>{r.push({...e,key:n})}),l.push(a)}return Promise.all(l).then(()=>r)}async parseTileData(e,t){let i=e&&e.data;if(!i)return null;let{sourceName2DataAndRefKey:s,transferList:r}=i;return 0===Object.keys(s).length?null:this._broadcastPromise.then(()=>this._connection.invoke("createTileAndParse",{key:e.key.id,sourceName2DataAndRefKey:s,styleLayerUIDs:e.styleLayerUIDs},{...t,transferList:r}))}async getSprites(e){return await this._spriteSourcePromise,this._spriteMosaic.getSpriteItems(e)}getGlyphs(e){return this._glyphMosaic.getGlyphItems(e.font,e.codePoints)}async _getTilePayload(e,t,i){let s=P.Z.pool.acquire(e.id),r=this._layer.sourceNameToSource[t],{level:l,row:n,col:o}=s;P.Z.pool.release(s);try{return{protobuff:await r.requestTile(l,n,o,i),sourceName:t}}catch(e){if((0,a.D_)(e))throw e;return{protobuff:null,sourceName:t}}}async _getRefKeys(e,t){let i=this._layer.sourceNameToSource,s=[];for(let r in i){let l=i[r].getRefKey(e,t);s.push(l)}return(0,a.as)(s)}_getSourcesData(e,t,i){let s=[];for(let r=0;r<t.length;r++)if(null==t[r].value||null==e[r])s.push(null);else{let l=t[r].value,n=this._getTilePayload(l,e[r],i);s.push(n)}return(0,a.as)(s).then(e=>{let i={},s=[];for(let r=0;r<e.length;r++){let l=e[r].value;if(l&&l.protobuff&&l.protobuff.byteLength>0){let e=t[r].value.id;i[l.sourceName]={refKey:e,protobuff:l.protobuff},s.push(l.protobuff)}}return{sourceName2DataAndRefKey:i,transferList:s}})}}var k=i(57812),z=i(25640);let U=(e,t)=>e+1/(1<<2*t);class O{constructor(e,t){this._tiles=new Map,this._tileCache=new k.z(40,e=>e.dispose()),this._viewSize=[0,0],this._visibleTiles=new Map,this.acquireTile=e.acquireTile,this.releaseTile=e.releaseTile,this.tileInfoView=e.tileInfoView,this._container=t}destroy(){for(let[e,t]of this._tiles)t.dispose();this._tiles=null,this._tileCache.clear(),this._tileCache=null}update(e){this._updateCacheSize(e);let t=this.tileInfoView,i=t.getTileCoverage(e.state,0,!0,"smallest");if(!i)return!0;let{spans:s,lodInfo:r}=i,{level:l}=r,n=this._tiles,a=new Set,o=new Set;for(let{row:e,colFrom:t,colTo:i}of s)for(let s=t;s<=i;s++){let t=P.Z.getId(l,e,r.normalizeCol(s),r.getWorldForColumn(s)),i=this._getOrAcquireTile(t);a.add(t),i.processed()?this._addToContainer(i):o.add(new P.Z(t))}for(let[e,t]of n)t.isCoverage=a.has(e);for(let e of o)this._findPlaceholdersForMissingTiles(e,a);let h=!1;for(let[e,s]of n)s.neededForCoverage=a.has(e),s.neededForCoverage||s.isHoldingForFade&&t.intersects(i,s.key)&&a.add(e),s.isFading&&(h=!0);for(let[e,t]of this._tiles)a.has(e)||this._releaseTile(e);return z.Z.pool.release(i),!h}clear(){this._tiles.clear(),this._tileCache.clear(),this._visibleTiles.clear()}clearCache(){this._tileCache.clear()}getIntersectingTiles(e,t,i,s,r){let l=[0,0],n=[0,0];s.toMap(l,e-i,t+i),s.toMap(n,e+i,t-i);let a=Math.min(l[0],n[0]),o=Math.min(l[1],n[1]),h=Math.max(l[0],n[0]),u=Math.max(l[1],n[1]),c=(0,d.al)(a,o,h,u),_=(0,d.Ue)(),y=[];for(let[e,t]of this._visibleTiles)this.tileInfoView.getTileBounds(_,t.key),(0,d.kK)(c,_)&&y.push(t);if(null!=r&&r.length>0){let e=new Set(y.map(e=>e.id)),t=r.filter(t=>!e.has(t.tileKey.id)).map(e=>this._visibleTiles.get(e.tileKey.id)).filter(e=>void 0!==e);y.push(...t)}return y}_findPlaceholdersForMissingTiles(e,t){let i=[];for(let[s,r]of this._tiles)this._addPlaceholderChild(i,r,e,t);1e-6>Math.abs(1-i.reduce(U,0))||this._addPlaceholderParent(e.id,t)}_addPlaceholderChild(e,t,i,s){t.key.level<=i.level||!t.hasData()||function(e,t){let i=t.level-e.level;return e.row===t.row>>i&&e.col===t.col>>i&&e.world===t.world}(i,t.key)&&(this._addToContainer(t),s.add(t.id),e.push(t.key.level-i.level))}_addPlaceholderParent(e,t){let i=this._tiles,s=e;for(;;){if(!(s=function(e){let[t,i,s,r]=e.split("/"),l=parseInt(t,10);return 0===l?null:`${l-1}/${parseInt(i,10)>>1}/${parseInt(s,10)>>1}/${parseInt(r,10)}`}(s))||t.has(s))return;let e=i.get(s);if(e?.hasData())return this._addToContainer(e),void t.add(e.id)}}_getOrAcquireTile(e){let t=this._tiles.get(e);return t||((t=this._tileCache.pop(e))||(t=this.acquireTile(new P.Z(e))),this._tiles.set(e,t),t)}_releaseTile(e){let t=this._tiles.get(e);this.releaseTile(t),this._removeFromContainer(t),this._tiles.delete(e),t.hasData()?this._tileCache.put(e,t,1):t.dispose()}_addToContainer(e){let t;let i=[],s=this._container;if(s.contains(e))return;let r=this._visibleTiles;for(let[s,l]of r)this._canConnectDirectly(e,l)&&i.push(l),null==t&&this._canConnectDirectly(l,e)&&(t=l);if(null!=t){for(let s of i)t.childrenTiles.delete(s),e.childrenTiles.add(s),s.parentTile=e;t.childrenTiles.add(e),e.parentTile=t}else for(let t of i)e.childrenTiles.add(t),t.parentTile=e;r.set(e.id,e),s.addChild(e)}_removeFromContainer(e){if(this._visibleTiles.delete(e.id),this._container.removeChild(e),null!=e.parentTile)for(let t of(e.parentTile.childrenTiles.delete(e),e.childrenTiles))null!=e.parentTile&&e.parentTile.childrenTiles.add(t);for(let t of e.childrenTiles)t.parentTile=e.parentTile;e.parentTile=null,e.childrenTiles.clear()}_canConnectDirectly(e,t){let i=e.key,{level:s,row:r,col:l,world:n}=t.key,a=this._visibleTiles;for(;s>0;){if(s--,r>>=1,l>>=1,i.level===s&&i.row===r&&i.col===l&&i.world===n)return!0;if(a.has(`${s}/${r}/${l}/${n}`))break}return!1}_updateCacheSize(e){let t=e.state.size;if(t[0]===this._viewSize[0]&&t[1]===this._viewSize[1])return;let i=Math.ceil(t[0]/512)+1,s=Math.ceil(t[1]/512)+1;this._viewSize[0]=t[0],this._viewSize[1]=t[1],this._tileCache.maxSize=5*i*s}}var F=i(15514),E=i(24971),V=i(13677),B=i(10045),q=i(49841);i(97123);var H=i(78610);class Z{constructor(e,t){this.sourceTile=t,this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.featureIndex=0,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=e}}class N{constructor(){this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}}function Y(e,t,i,s,r,l){let n=i-r;if(n>=0)return(t>>n)+(s-(l<<n))*(e>>n);let a=-n;return t-(l-(s<<a))*(e>>a)<<a}class W{constructor(e,t,i){this._rows=Math.ceil(t/i),this._columns=Math.ceil(e/i),this._cellSize=i,this.cells=Array(this._rows);for(let e=0;e<this._rows;e++){this.cells[e]=Array(this._columns);for(let t=0;t<this._columns;t++)this.cells[e][t]=[]}}getCell(e,t){let i=Math.min(Math.max(Math.floor(t/this._cellSize),0),this._rows-1),s=Math.min(Math.max(Math.floor(e/this._cellSize),0),this._columns-1);return this.cells[i]&&this.cells[i][s]||null}getCellSpan(e,t,i,s){return[Math.min(Math.max(Math.floor(e/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(t/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(s/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}}var X=i(28859),j=i(98163);class Q{constructor(e,t){this.layerUIDs=[],this.isDestroyed=!1,this._data=e;let i=1,s=new Uint32Array(e);this.layerUIDs=[];let r=s[i++];for(let e=0;e<r;e++)this.layerUIDs[e]=s[i++];this.bufferDataOffset=i,t&&(this.layer=t.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return null==this._data}get offset(){return this.bufferDataOffset}get data(){return this._data}destroy(){this.isDestroyed||(this.doDestroy(),this._data=null,this.isDestroyed=!0)}prepareForRendering(e){null!=this._data&&(this.doPrepareForRendering(e,this._data,this.bufferDataOffset),this._data=null)}}class J extends Q{constructor(e,t){super(e,t),this.type=y.al.LINE,this.lineIndexStart=0,this.lineIndexCount=0;let i=new Uint32Array(e),s=this.bufferDataOffset;this.lineIndexStart=i[s++],this.lineIndexCount=i[s++];let r=i[s++];if(r>0){this.patternMap=new Map;for(let e=0;e<r;e++){let e=i[s++],t=i[s++],r=i[s++];this.patternMap.set(e,[t,r])}}this.bufferDataOffset=s}get memoryUsed(){return(this.data?.byteLength??0)+(this.vao?.usedMemory??0)}hasData(){return this.lineIndexCount>0}triangleCount(){return this.lineIndexCount/3}doDestroy(){this.vao=(0,n.M2)(this.vao)}doPrepareForRendering(e,t,i){let s=new Uint32Array(t),r=new Int32Array(s.buffer),l=s[i++],n=X.f.createVertex(e,x.l1.STATIC_DRAW,new Int32Array(r.buffer,4*i,l));i+=l;let a=s[i++],o=X.f.createIndex(e,x.l1.STATIC_DRAW,new Uint32Array(s.buffer,4*i,a));i+=a;let h=this.layer.lineMaterial;this.vao=new j.U(e,h.getAttributeLocations(),h.getLayoutInfo(),{geometry:n},o)}}class G extends Q{constructor(e,t){super(e,t),this.type=y.al.FILL,this.fillIndexStart=0,this.fillIndexCount=0,this.outlineIndexStart=0,this.outlineIndexCount=0;let i=new Uint32Array(e),s=this.bufferDataOffset;this.fillIndexStart=i[s++],this.fillIndexCount=i[s++],this.outlineIndexStart=i[s++],this.outlineIndexCount=i[s++];let r=i[s++];if(r>0){this.patternMap=new Map;for(let e=0;e<r;e++){let e=i[s++],t=i[s++],r=i[s++];this.patternMap.set(e,[t,r])}}this.bufferDataOffset=s}get memoryUsed(){return(this.data?.byteLength??0)+(this.fillVAO?.usedMemory??0)+(this.outlineVAO?.usedMemory??0)}hasData(){return this.fillIndexCount>0||this.outlineIndexCount>0}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){this.fillVAO=(0,n.M2)(this.fillVAO),this.outlineVAO=(0,n.M2)(this.outlineVAO)}doPrepareForRendering(e,t,i){let s=new Uint32Array(t),r=new Int32Array(s.buffer),l=s[i++],n=X.f.createVertex(e,x.l1.STATIC_DRAW,new Int32Array(r.buffer,4*i,l));i+=l;let a=s[i++],o=X.f.createIndex(e,x.l1.STATIC_DRAW,new Uint32Array(s.buffer,4*i,a));i+=a;let h=s[i++],u=X.f.createVertex(e,x.l1.STATIC_DRAW,new Int32Array(r.buffer,4*i,h));i+=h;let c=s[i++],d=X.f.createIndex(e,x.l1.STATIC_DRAW,new Uint32Array(s.buffer,4*i,c));i+=c;let _=this.layer,y=_.fillMaterial,p=_.outlineMaterial;this.fillVAO=new j.U(e,y.getAttributeLocations(),y.getLayoutInfo(),{geometry:n},o),this.outlineVAO=new j.U(e,p.getAttributeLocations(),p.getLayoutInfo(),{geometry:u},d)}}class K extends Q{constructor(e,t,i){super(e,t),this.type=y.al.SYMBOL,this.iconPerPageElementsMap=new Map,this.glyphPerPageElementsMap=new Map,this.symbolInstances=[],this.isIconSDF=!1,this.opacityChanged=!1,this.lastOpacityUpdate=0,this.symbols=[];let s=new Uint32Array(e),r=new Int32Array(e),l=new Float32Array(e),n=this.bufferDataOffset;this.isIconSDF=!!s[n++];let a=s[n++],o=s[n++],h=s[n++],u=new P.Z(a,o,h,0),c=s[n++];for(let e=0;e<c;e++){let e=s[n++],t=s[n++],i=s[n++];this.iconPerPageElementsMap.set(e,[t,i])}let d=s[n++];for(let e=0;e<d;e++){let e=s[n++],t=s[n++],i=s[n++];this.glyphPerPageElementsMap.set(e,[t,i])}let _=s[n++],p=s[n++];this.iconOpacity=new Int32Array(_),this.textOpacity=new Int32Array(p),n=function(e,t,i,s,r,l,n){let a=t[s++];for(let o=0;o<a;o++){let a=new Z(l,n);a.xTile=t[s++],a.yTile=t[s++],a.hash=t[s++],a.priority=t[s++],a.featureIndex=t[s++];let o=t[s++];for(let e=0;e<o;e++){let e=t[s++],r=t[s++],l=t[s++],n=t[s++],o=!!t[s++],h=t[s++],u=i[s++],c=i[s++],d=t[s++],_=t[s++];a.colliders.push({xTile:e,yTile:r,dxPixels:l,dyPixels:n,hard:o,partIndex:h,width:d,height:_,minLod:u,maxLod:c})}let h=e[s++];for(let t=0;t<h;t++)a.textVertexRanges.push([e[s++],e[s++]]);let u=e[s++];for(let t=0;t<u;t++)a.iconVertexRanges.push([e[s++],e[s++]]);r.push(a)}return s}(s,r,l,n,this.symbols,i,u),this.bufferDataOffset=n}get memoryUsed(){return(this.data?.byteLength??0)+(this.iconVAO?.usedMemory??0)+(this.textVAO?.usedMemory??0)+(0,V.Xw)(this.iconOpacity)+(0,V.Xw)(this.textOpacity)}hasData(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}triangleCount(){let e=0;for(let[t,i]of this.iconPerPageElementsMap)e+=i[1];for(let[t,i]of this.glyphPerPageElementsMap)e+=i[1];return e/3}doDestroy(){this.iconVAO=(0,n.M2)(this.iconVAO),this.textVAO=(0,n.M2)(this.textVAO)}updateOpacityInfo(){if(!this.opacityChanged)return;this.opacityChanged=!1;let e=this.iconOpacity,t=this.iconVAO.vertexBuffers.opacity;e.length>0&&e.byteLength===t.usedMemory&&t.setSubData(e,0,0,e.length);let i=this.textOpacity,s=this.textVAO.vertexBuffers.opacity;i.length>0&&i.byteLength===s.usedMemory&&s.setSubData(i,0,0,i.length)}doPrepareForRendering(e,t,i){let s=new Uint32Array(t),r=new Int32Array(s.buffer),l=s[i++],n=X.f.createVertex(e,x.l1.STATIC_DRAW,new Int32Array(r.buffer,4*i,l));i+=l;let a=s[i++],o=X.f.createIndex(e,x.l1.STATIC_DRAW,new Uint32Array(s.buffer,4*i,a));i+=a;let h=s[i++],u=X.f.createVertex(e,x.l1.STATIC_DRAW,new Int32Array(r.buffer,4*i,h));i+=h;let c=s[i++],d=X.f.createIndex(e,x.l1.STATIC_DRAW,new Uint32Array(s.buffer,4*i,c));i+=c;let _=X.f.createVertex(e,x.l1.STATIC_DRAW,this.iconOpacity.buffer),y=X.f.createVertex(e,x.l1.STATIC_DRAW,this.textOpacity.buffer),p=this.layer,f=p.iconMaterial,g=p.textMaterial;this.iconVAO=new j.U(e,f.getAttributeLocations(),f.getLayoutInfo(),{geometry:n,opacity:_},o),this.textVAO=new j.U(e,g.getAttributeLocations(),g.getLayoutInfo(),{geometry:u,opacity:y},d)}}class $ extends Q{constructor(e,t){super(e,t),this.type=y.al.CIRCLE,this.circleIndexStart=0,this.circleIndexCount=0;let i=new Uint32Array(e),s=this.bufferDataOffset;this.circleIndexStart=i[s++],this.circleIndexCount=i[s++],this.bufferDataOffset=s}get memoryUsed(){return(this.data?.byteLength??0)+(this.vao?.usedMemory??0)}hasData(){return this.circleIndexCount>0}triangleCount(){return this.circleIndexCount/3}doDestroy(){this.vao=(0,n.M2)(this.vao)}doPrepareForRendering(e,t,i){let s=new Uint32Array(t),r=new Int32Array(s.buffer),l=s[i++],n=X.f.createVertex(e,x.l1.STATIC_DRAW,new Int32Array(r.buffer,4*i,l));i+=l;let a=s[i++],o=X.f.createIndex(e,x.l1.STATIC_DRAW,new Uint32Array(s.buffer,4*i,a));i+=a;let h=this.layer.circleMaterial;this.vao=new j.U(e,h.getAttributeLocations(),h.getLayoutInfo(),{geometry:n},o)}}var ee=i(28207),et=i(56742);class ei extends et.I{constructor(e,t,i,s,r,l,n,a=null){super(e,t,i,s,r,l,4096,4096),this.styleRepository=n,this._memCache=a,this.type="vector-tile",this._referenced=0,this._hasSymbolBuckets=!1,this._memoryUsedByLayerData=0,this.layerData=new Map,this.status="loading",this.allSymbolsFadingOut=!1,this.lastOpacityUpdate=0,this.symbols=new Map,this.isCoverage=!1,this.neededForCoverage=!1,this.decluttered=!1,this.parentTile=null,this.childrenTiles=new Set,this.featureIndex=null,this.triangleCount=0,this._processed=!1,this._referenced=1,this.id=e.id}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<ee.v7}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<ee.v7)}get wasRequested(){return"errored"===this.status||"loaded"===this.status||"reloading"===this.status}setData(e){this.changeDataImpl(e),this.requestRender(),this.ready(),this._processed=!0}deleteLayerData(e){let t=!1;for(let i of e){let e=this.layerData.get(i);e&&(this._memoryUsedByLayerData-=e.memoryUsed,e.type===y.al.SYMBOL&&this.symbols.delete(i)&&(t=!0),e.destroy(),this.layerData.delete(i))}this._memCache?.updateSize(this.key.id,this,this._memoryUsedByLayerData),t&&(this.featureIndex?.clear(),this.emit("symbols-changed")),this.requestRender()}processed(){return this._processed}hasData(){return this.layerData.size>0}dispose(){"unloaded"!==this.status&&(this.featureIndex=null,es.delete(this),ei._destroyRenderBuckets(this.layerData),this.layerData.clear(),this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}release(){return 0==--this._referenced&&(this.dispose(),this.stage=null,!0)}retain(){++this._referenced}get referenced(){return this._referenced}get usedMemory(){return this._memoryUsedByLayerData+256}changeDataImpl(e){this.featureIndex?.clear();let t=!1;if(e){let{bucketsWithData:i,emptyBuckets:s}=e,r=this._createRenderBuckets(i);if(s&&s.byteLength>0)for(let e of new Uint32Array(s))this._deleteLayerData(e);for(let[e,i]of r)this._deleteLayerData(e),i.type===y.al.SYMBOL&&(this.symbols.set(e,i.symbols),t=!0),this._memoryUsedByLayerData+=i.memoryUsed,this.layerData.set(e,i);this._memCache?.updateSize(this.key.id,this,this.usedMemory)}for(let[e,t]of(this._hasSymbolBuckets=!1,this.layerData))t.type===y.al.SYMBOL&&(this._hasSymbolBuckets=!0);t&&this.emit("symbols-changed")}attachWithContext(e){this.stage={context:e,trashDisplayObject(e){e.processDetach()},untrashDisplayObject:()=>!1}}setTransform(e){super.setTransform(e);let t=this.resolution/(e.resolution*e.pixelRatio),i=this.width/this.rangeX*t,s=this.height/this.rangeY*t,r=[0,0];e.toScreen(r,[this.x,this.y]);let l=this.transforms.tileUnitsToPixels;(0,F.yR)(l),(0,F.Iu)(l,l,r),(0,F.U1)(l,l,Math.PI*e.rotation/180),(0,F.bA)(l,l,[i,s,1])}_createTransforms(){return{displayViewScreenMat3:(0,E.Ue)(),tileMat3:(0,E.Ue)(),tileUnitsToPixels:(0,E.Ue)()}}static _destroyRenderBuckets(e){if(!e)return;let t=new Set;for(let i of e.values())t.has(i)||(i.destroy(),t.add(i));e.clear()}_createRenderBuckets(e){let t=new Map,i=new Map;for(let s of e){let e=this._deserializeBucket(s,i);for(let i of e.layerUIDs)t.set(i,e)}return t}_deserializeBucket(e,t){let i=t.get(e);if(i)return i;switch(new Uint32Array(e)[0]){case y.al.FILL:i=new G(e,this.styleRepository);break;case y.al.LINE:i=new J(e,this.styleRepository);break;case y.al.SYMBOL:i=new K(e,this.styleRepository,this);break;case y.al.CIRCLE:i=new $(e,this.styleRepository)}return t.set(e,i),i}_deleteLayerData(e){if(!this.layerData.has(e))return;let t=this.layerData.get(e);this._memoryUsedByLayerData-=t.memoryUsed,t.destroy(),this.layerData.delete(e)}}let es=new Map;var er=i(62903),el=i(89163),en=i(83653);class ea{constructor(e,t,i,s,r,l){for(let n of(this._symbols=e,this._styleRepository=s,this._zoom=r,this._currentLayerCursor=0,this._currentSymbolCursor=0,this._styleProps=new Map,this._allNeededMatrices=new Map,this._gridIndex=new W(t,i,ee.cn),this._si=Math.sin(Math.PI*l/180),this._co=Math.cos(Math.PI*l/180),e))for(let e of n.symbols)this._allNeededMatrices.has(e.tile)||this._allNeededMatrices.set(e.tile,(0,E.d9)(e.tile.transforms.tileUnitsToPixels))}work(e){let t=this._gridIndex,i=performance.now();for(;this._currentLayerCursor<this._symbols.length;this._currentLayerCursor++,this._currentSymbolCursor=0){let s=this._symbols[this._currentLayerCursor],r=this._getProperties(s.styleLayerUID);for(;this._currentSymbolCursor<s.symbols.length;this._currentSymbolCursor++){if(this._currentSymbolCursor%100==99&&performance.now()-i>e)return!1;let l=s.symbols[this._currentSymbolCursor];if(!l.unique.show)continue;!function(e,t,i,s,r,l){let{iconRotationAlignment:n,textRotationAlignment:a,iconTranslate:o,iconTranslateAnchor:h,textTranslate:u,textTranslateAnchor:c}=s,d=0;for(let s of e.colliders){let[e,_]=0===s.partIndex?o:u,y=0===s.partIndex?h:c,p=s.minLod<=l&&l<=s.maxLod;d+=p?0:1,s.enabled=p,s.xScreen=s.xTile*r[0]+s.yTile*r[3]+r[6],s.yScreen=s.xTile*r[1]+s.yTile*r[4]+r[7],y===en.fD.MAP?(s.xScreen+=i*e-t*_,s.yScreen+=t*e+i*_):(s.xScreen+=e,s.yScreen+=_),en.aF.VIEWPORT===(0===s.partIndex?n:a)?(s.dxScreen=s.dxPixels,s.dyScreen=s.dyPixels):(s.dxScreen=i*(s.dxPixels+s.width/2)-t*(s.dyPixels+s.height/2)-s.width/2,s.dyScreen=t*(s.dxPixels+s.width/2)+i*(s.dyPixels+s.height/2)-s.height/2)}e.colliders.length>0&&d===e.colliders.length&&(e.unique.show=!1)}(l,this._si,this._co,r,this._allNeededMatrices.get(l.tile),this._zoom);let n=l.unique;if(!n.show)continue;let{iconAllowOverlap:a,iconIgnorePlacement:o,textAllowOverlap:h,textIgnorePlacement:u}=r;for(let e of l.colliders){if(!e.enabled)continue;let i=n.parts[e.partIndex];i.show&&!(e.partIndex?h:a)&&function(e){let i=e.xScreen+e.dxScreen,s=e.yScreen+e.dyScreen,r=i+e.width,l=s+e.height,[n,a,o,h]=t.getCellSpan(i,s,r,l);for(let e=a;e<=h;e++)for(let a=n;a<=o;a++)for(let n of t.cells[e][a]){let e=n.xScreen+n.dxScreen,t=n.yScreen+n.dyScreen,a=e+n.width,o=t+n.height;if(!(r<e||i>a||l<t||s>o))return!0}return!1}(e)&&(e.hard?n.show=!1:i.show=!1)}if(n.show)for(let e of l.colliders){if(!e.enabled||(e.partIndex?u:o)||!n.parts[e.partIndex].show)continue;let t=e.xScreen+e.dxScreen,i=e.yScreen+e.dyScreen,s=t+e.width,r=i+e.height,[l,a,h,c]=this._gridIndex.getCellSpan(t,i,s,r);for(let t=a;t<=c;t++)for(let i=l;i<=h;i++)this._gridIndex.cells[t][i].push(e)}}}return!0}_getProperties(e){let t=this._styleProps.get(e);if(t)return t;let i=this._zoom,s=this._styleRepository.getStyleLayerByUID(e),r=s.getLayoutValue("symbol-placement",i)!==en.R.POINT,l=s.getLayoutValue("icon-rotation-alignment",i);l===en.aF.AUTO&&(l=r?en.aF.MAP:en.aF.VIEWPORT);let n=s.getLayoutValue("text-rotation-alignment",i);n===en.aF.AUTO&&(n=r?en.aF.MAP:en.aF.VIEWPORT);let a=s.getPaintValue("icon-translate",i),o=s.getPaintValue("icon-translate-anchor",i),h=s.getPaintValue("text-translate",i),u=s.getPaintValue("text-translate-anchor",i),c={iconAllowOverlap:s.getLayoutValue("icon-allow-overlap",i),iconIgnorePlacement:s.getLayoutValue("icon-ignore-placement",i),textAllowOverlap:s.getLayoutValue("text-allow-overlap",i),textIgnorePlacement:s.getLayoutValue("text-ignore-placement",i),iconRotationAlignment:l,textRotationAlignment:n,iconTranslateAnchor:o,iconTranslate:a,textTranslateAnchor:u,textTranslate:h};return this._styleProps.set(e,c),c}}function eo(e,t){if(e.priority-t.priority)return e.priority-t.priority;let i=e.tile.key,s=t.tile.key;return i.world-s.world?i.world-s.world:i.level-s.level?i.level-s.level:i.row-s.row?i.row-s.row:i.col-s.col?i.col-s.col:e.xTile-t.xTile?e.xTile-t.xTile:e.yTile-t.yTile}class eh{get running(){return this._running}constructor(e,t,i,s,r,l){this._visibleTiles=e,this._symbolRepository=t,this._createCollisionJob=i,this._assignTileSymbolsOpacity=s,this._symbolLayerSorter=r,this._isLayerVisible=l,this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}setScreenSize(e,t){this._screenWidth===e&&this._screenHeight===t||this.restart(),this._screenWidth=e,this._screenHeight=t}restart(){this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}continue(e){if(this._selectionJob||(this._selectionJob=this._createSelectionJob()),!this._selectionJobCompleted){let t=performance.now();if(!this._selectionJob.work(e)||(this._selectionJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-t)))))return!1}if(this._collisionJob||(this._collisionJob=this._createCollisionJob(this._selectionJob.sortedSymbols,this._screenWidth,this._screenHeight)),!this._collisionJobCompleted){let t=performance.now();if(!this._collisionJob.work(e)||(this._collisionJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-t)))))return!1}if(this._opacityJob||(this._opacityJob=this._createOpacityJob()),!this._opacityJobCompleted){let t=performance.now();if(!this._opacityJob.work(e)||(this._opacityJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-t)))))return!1}return this._running=!1,!0}_createSelectionJob(){let e=this._symbolRepository.uniqueSymbols;for(let t=0;t<e.length;t++){let i=e[t];for(let e=0;e<i.uniqueSymbols.length;e++)for(let t of i.uniqueSymbols[e].tileSymbols)t.selectedForRendering=!1}let t=[],i=0,s=0,r=this._isLayerVisible,l=this._symbolLayerSorter;return{work:function(l){let n;let a=performance.now();for(;s<e.length;s++,i=0){let o=e[s],h=o.styleLayerUID;if(!r(h)){t[s]||(t[s]={styleLayerUID:h,symbols:[]});continue}t[s]=t[s]||{styleLayerUID:h,symbols:[]};let u=t[s];for(;i<o.uniqueSymbols.length;i++){if(n=o.uniqueSymbols[i],i%100==99&&performance.now()-a>l)return!1;let e=null,t=!1,s=!1;for(let i of n.tileSymbols)if(!s||!t){let r=i.tile;(!e||r.isCoverage||r.neededForCoverage&&!t)&&(e=i,(r.neededForCoverage||r.isCoverage)&&(s=!0),r.isCoverage&&(t=!0))}if(e.selectedForRendering=!0,s)for(let t of(u.symbols.push(e),n.show=!0,n.parts))t.show=!0;else n.show=!1}}for(let e of t)e.symbols.sort(eo);return!0},get sortedSymbols(){return t.sort(l)}}}_createOpacityJob(){let e=this._assignTileSymbolsOpacity,t=this._visibleTiles,i=0;return{work(s){let r=performance.now();for(;i<t.length;i++){if(performance.now()-r>s)return!1;let l=t[i];null==l.parentTile&&function t(i,s){for(let[e,t]of i.symbols)!function(e,t){for(let i of e){let e=i.unique;for(let i of e.parts){let s=i.targetOpacity>.5?1:-1;i.startOpacity+=(t-i.startTime)/ee.v7*s,i.startOpacity=Math.min(Math.max(i.startOpacity,0),1),i.startTime=t,i.targetOpacity=e.show&&i.show?1:0}}}(t,s);for(let r of(e(i,s),i.childrenTiles))t(r,s)}(l,performance.now())}return!0}}}}class eu{constructor(e,t,i){this.tileCoordRange=e,this._visibleTiles=t,this._createUnique=i,this._tiles=new Map,this._uniqueSymbolsReferences=new Map}get uniqueSymbols(){return null==this._uniqueSymbolLayerArray&&(this._uniqueSymbolLayerArray=this._createUniqueSymbolLayerArray()),this._uniqueSymbolLayerArray}get uniqueSymbolsReferences(){return this._uniqueSymbolsReferences}add(e,t){this._uniqueSymbolLayerArray=null;let i=this._tiles.get(e.id);i||(i={symbols:new Map},this._tiles.set(e.id,i));let s=new Map;if(t)for(let e of t)i.symbols.has(e)&&(s.set(e,i.symbols.get(e)),i.symbols.delete(e));else for(let[t,r]of e.layerData)i.symbols.has(t)&&(s.set(t,i.symbols.get(t)),i.symbols.delete(t));this._removeSymbols(s);let r=e.symbols,l=new Map;for(let[e,t]of r){let s=t.length;if(s>=32){let r=this.tileCoordRange;do r/=2,s/=4;while(s>8&&r>64);let n=new W(this.tileCoordRange,this.tileCoordRange,r);for(let s of(l.set(e,{flat:t,index:n}),i.symbols.set(e,{flat:t,index:n}),t))n.getCell(s.xTile,s.yTile).push(s)}else l.set(e,{flat:t}),i.symbols.set(e,{flat:t})}this._addSymbols(e.key,r)}deleteStyleLayers(e){for(let[t,i]of(this._uniqueSymbolLayerArray=null,this._tiles)){let s=new Map;for(let t of e)i.symbols.has(t)&&(s.set(t,i.symbols.get(t)),i.symbols.delete(t));this._removeSymbols(s),0===i.symbols.size&&this._tiles.delete(t)}}removeTile(e){this._uniqueSymbolLayerArray=null;let t=this._tiles.get(e.id);if(!t)return;let i=new Map;for(let[s,r]of e.symbols)t.symbols.has(s)&&(i.set(s,t.symbols.get(s)),t.symbols.delete(s));this._removeSymbols(i),0===t.symbols.size&&this._tiles.delete(e.id)}querySymbols(e,t,i,s){let r=[];for(let s of this.uniqueSymbols){let l=s.styleLayerUID;for(let n of s.uniqueSymbols){let s=n.tileSymbols.find(e=>e.selectedForRendering);s&&function(e,t,i,s){let r,l,n,a;for(let o of e.colliders)if(e.unique.show&&e.unique.parts[o.partIndex].show&&(r=o.xScreen-s[0]+o.dxScreen,l=o.yScreen-s[1]+o.dyScreen,n=r+o.width,a=l+o.height,(0,H.Px)(i,t.x,t.y,r,l,n,a)))return!0;return!1}(s,e,t*(window.devicePixelRatio||1),i)&&r.push({vtlSymbol:s,styleLayerUID:l,tileKey:s.tile.key})}}return r}_removeSymbols(e){for(let[t,{flat:i}]of e)for(let e of i){let i=e.unique,s=i.tileSymbols,r=s.length-1;for(let t=0;t<r;t++)if(s[t]===e){s[t]=s[r];break}if(s.length=r,0===r){let e=this._uniqueSymbolsReferences.get(t);e.delete(i),0===e.size&&this._uniqueSymbolsReferences.delete(t)}e.unique=null}}_addSymbols(e,t){if(0!==t.size){for(let i of this._visibleTiles)i.parentTile||i.key.world!==e.world||i.key.level===e.level&&!i.key.equals(e)||this._matchSymbols(i,e,t);for(let[e,i]of t)for(let t of i)if(null==t.unique){let i=this._createUnique();t.unique=i,i.tileSymbols.push(t);let s=this._uniqueSymbolsReferences.get(e);s||(s=new Set,this._uniqueSymbolsReferences.set(e,s)),s.add(i)}}}_matchSymbols(e,t,i){if(e.key.level>t.level){let i=e.key.level-t.level;if(e.key.row>>i!==t.row||e.key.col>>i!==t.col)return}if(t.level>e.key.level){let i=t.level-e.key.level;if(t.row>>i!==e.key.row||t.col>>i!==e.key.col)return}if(t.equals(e.key)){for(let s of e.childrenTiles)this._matchSymbols(s,t,i);return}let s=new Map;for(let[r,l]of i){let i=[];for(let s of l){let r=Y(this.tileCoordRange,s.xTile,t.level,t.col,e.key.level,e.key.col),l=Y(this.tileCoordRange,s.yTile,t.level,t.row,e.key.level,e.key.row);r>=0&&r<this.tileCoordRange&&l>=0&&l<this.tileCoordRange&&i.push({symbol:s,xTransformed:r,yTransformed:l})}let n=[],a=(e.key.level<t.level?1:1<<e.key.level-t.level)+20,o=this._tiles.get(e.id).symbols.get(r);if(o){let e=o.flat;for(let t of i){let i,s=!1,r=t.xTransformed,l=t.yTransformed;i=null!=o.index?o.index.getCell(r,l):e;let h=t.symbol,u=h.hash;for(let e of i)if(u===e.hash&&Math.abs(r-e.xTile)<=a&&Math.abs(l-e.yTile)<=a){let t=e.unique;h.unique=t,t.tileSymbols.push(h),s=!0;break}s||n.push(h)}}n.length>0&&s.set(r,n)}for(let i of e.childrenTiles)this._matchSymbols(i,t,s)}_createUniqueSymbolLayerArray(){let e=this._uniqueSymbolsReferences,t=Array(e.size),i,s=0;for(let[r,l]of e){let e=Array(l.size);for(let t of(i=0,l))e[i++]=t;t[s]={styleLayerUID:r,uniqueSymbols:e},s++}return t}}class ec{constructor(e,t){this.styleRepository=e,this._tileToHandle=new Map,this._viewState={scale:0,rotation:0,center:[0,0],size:[0,0]},this._declutterViewState={scale:0,rotation:0,center:[0,0],size:[0,0]},this._offsetFromScreenCenter=[0,0],this._completed=!1,this._fading=(0,el.t)(!1),this._symbolRepository=new eu(4096,t,()=>new N),this._symbolDeclutterer=new eh(t,this._symbolRepository,(e,t,i)=>this._createCollisionJob(e,t,i),(e,t)=>{e.allSymbolsFadingOut=!0,e.lastOpacityUpdate=t,function(e,t,i){for(let[s,r]of e.symbols)(function(e,t,i,s,r){let l=e.layerData.get(r);if(l.type===y.al.SYMBOL){for(let t of s){let s;let r=t.unique;if(t.selectedForRendering){let t=r.parts[0],l=t.startOpacity,n=t.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&0===n;let a=i?Math.floor(127*l)|n<<7:n?255:0;s=a<<24|a<<16|a<<8|a}else s=0;for(let[e,i]of t.iconVertexRanges)for(let t=e;t<e+i;t+=4)l.iconOpacity[t/4]=s;if(t.selectedForRendering){let t=r.parts[1],l=t.startOpacity,n=t.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&0===n;let a=i?Math.floor(127*l)|n<<7:n?255:0;s=a<<24|a<<16|a<<8|a}else s=0;for(let[e,i]of t.textVertexRanges)for(let t=e;t<e+i;t+=4)l.textOpacity[t/4]=s}l.lastOpacityUpdate=t,l.opacityChanged=!0}})(e,t,i,r,s)}(e,t,!0),e.decluttered=!0,e.requestRender()},(e,t)=>this.styleRepository.getStyleLayerByUID(e.styleLayerUID).z-this.styleRepository.getStyleLayerByUID(t.styleLayerUID).z,e=>{let t=this.styleRepository.getStyleLayerByUID(e);if(this._zoom+1e-6<t.minzoom||this._zoom-1e-6>=t.maxzoom)return!1;let i=t.getLayoutProperty("visibility");return!i||i.getValue()!==en.EE.NONE})}get symbolRepository(){return this._symbolRepository}_createCollisionJob(e,t,i){return this.updateDecluttererViewState(),new ea(e,t,i,this.styleRepository,this._zoom,this._viewState.rotation)}get fading(){return this._fading.value}get decluttererOffset(){return this._offsetFromScreenCenter}addTile(e){e.decluttered=!1,this._tileToHandle.set(e,e.on("symbols-changed",()=>{this._symbolRepository.add(e),this.restartDeclutter()})),this._symbolRepository.add(e),this.restartDeclutter()}removeTile(e){let t=this._tileToHandle.get(e);t&&(this._symbolRepository.removeTile(e),this.restartDeclutter(),t.remove(),this._tileToHandle.delete(e))}update(e,t){this._zoom=e,this._viewState={scale:t.scale,rotation:t.rotation,center:[t.center[0],t.center[1]],size:[t.size[0],t.size[1]]};let i=[0,0];t.toScreen(i,t.center);let s=[0,0];return t.toScreen(s,this._declutterViewState.center),this._offsetFromScreenCenter[0]=i[0]-s[0],this._offsetFromScreenCenter[1]=i[1]-s[1],this._continueDeclutter(),this._completed}restartDeclutter(){this._completed=!1,this._symbolDeclutterer.restart(),this._notifyUnstable()}clear(){this._completed=!1,this._symbolRepository=null,this._symbolDeclutterer.restart(),this._tileToHandle.forEach(e=>e.remove()),this._tileToHandle.clear()}get stale(){return this._zoom!==this._declutterZoom||this._viewState.size[0]!==this._declutterViewState.size[0]||this._viewState.size[1]!==this._declutterViewState.size[1]||this._viewState.scale!==this._declutterViewState.scale||this._viewState.rotation!==this._declutterViewState.rotation}deleteStyleLayers(e){this._symbolRepository.deleteStyleLayers(e)}_continueDeclutter(){this._completed&&!this.stale||(this._symbolDeclutterer.running||(this.updateDecluttererViewState(),this._symbolDeclutterer.restart()),this._symbolDeclutterer.setScreenSize(this._viewState.size[0],this._viewState.size[1]),this._completed=this._symbolDeclutterer.continue(ee.JM),this._completed&&this._scheduleNotifyStable())}_scheduleNotifyStable(){null!=this._stableNotificationHandle&&clearTimeout(this._stableNotificationHandle),this._stableNotificationHandle=setTimeout(()=>{this._stableNotificationHandle=null,this._fading.value=!1},1.5*ee.v7)}_notifyUnstable(){null!=this._stableNotificationHandle&&(clearTimeout(this._stableNotificationHandle),this._stableNotificationHandle=null),this._fading.value=!0}updateDecluttererViewState(){this._declutterZoom=this._zoom,this._declutterViewState.center[0]=this._viewState.center[0],this._declutterViewState.center[1]=this._viewState.center[1],this._declutterViewState.rotation=this._viewState.rotation,this._declutterViewState.scale=this._viewState.scale,this._declutterViewState.size[0]=this._viewState.size[0],this._declutterViewState.size[1]=this._viewState.size[1],this._offsetFromScreenCenter[0]=0,this._offsetFromScreenCenter[1]=0}}var ed=i(80320);class e_ extends et.I{_createTransforms(){return{displayViewScreenMat3:(0,E.Ue)(),tileMat3:(0,E.Ue)()}}}var ey=i(7748);function ep(e,t){if(e){let i=e.getLayoutProperty("visibility");if(!i||i.getValue()!==en.EE.NONE&&(void 0===e.minzoom||e.minzoom<t+1e-6)&&(void 0===e.maxzoom||e.maxzoom>=t-1e-6))return!0}return!1}class ef extends ey.Z{constructor(e){super(e),this._backgroundTiles=[],this._computeDisplayInfoView(e)}destroy(){this.removeAllChildren(),this._spriteMosaic?.dispose(),this._spriteMosaic=null,this._glyphMosaic?.dispose(),this._glyphMosaic=null,null!=this._symbolFader&&(this._symbolFader.clear(),this._symbolFader=null),this._styleRepository=null,this._backgroundTiles=[]}get fading(){return this._symbolFader?.fading??!1}get symbolFader(){return this._symbolFader}get symbolRepository(){return this._symbolFader?.symbolRepository}setStyleResources(e,t,i,s){this._spriteMosaic=e,this._glyphMosaic=t,this._styleRepository=i,this._tileInfoView=s,this._computeDisplayInfoView(s),null==this._symbolFader&&(this._symbolFader=new ec(this._styleRepository,this.children)),this._symbolFader.styleRepository=i}setSpriteMosaic(e){this._spriteMosaic?.dispose(),this._spriteMosaic=e}deleteStyleLayers(e){null!=this._symbolFader&&this._symbolFader.deleteStyleLayers(e)}createRenderParams(e){return{...super.createRenderParams(e),renderPass:null,styleLayer:null,styleLayerUID:-1,glyphMosaic:this._glyphMosaic,spriteMosaic:this._spriteMosaic,hasClipping:!!this._clippingInfos}}doRender(e){this.visible&&(e.drawPhase===ed.jx.MAP||e.drawPhase===ed.jx.DEBUG)&&void 0!==this._spriteMosaic&&super.doRender(e)}addChild(e){return super.addChild(e),null!=this._symbolFader?this._symbolFader.addTile(e):e.decluttered=!0,this.requestRender(),e}removeChild(e){return null!=this._symbolFader&&this._symbolFader.removeTile(e),this.requestRender(),super.removeChild(e)}renderChildren(e){let{drawPhase:t}=e;t!==ed.jx.DEBUG?this._doRender(e):super.renderChildren(e)}removeAllChildren(){for(let e=0;e<this.children.length;e++){let t=this.children[e];null!=this._symbolFader&&this._symbolFader.removeTile(t),t.dispose()}super.removeAllChildren()}getStencilTarget(){return this.children.filter(e=>e.neededForCoverage&&e.hasData())}restartDeclutter(){null!=this._symbolFader&&this._symbolFader.restartDeclutter()}_doRender(e){let{context:t,state:i}=e,s=this._styleRepository;if(!s)return;let r=s.layers,l=this._displayInfo.scaleToZoom(i.scale);s.backgroundBucketIds.length>0&&(e.renderPass="background",this._renderBackgroundLayers(e,s.backgroundBucketIds,l)),super.renderChildren(e),e.drawPhase===ed.jx.MAP&&this._fade(l,i);let n=this.children.filter(e=>e.visible&&e.hasData());if(!n||0===n.length)return t.bindVAO(),t.setStencilTestEnabled(!0),void t.setBlendingEnabled(!0);for(let e of n)e.triangleCount=0;t.setStencilWriteMask(0),t.setColorMask(!0,!0,!0,!0),t.setStencilOp(x.xS.KEEP,x.xS.KEEP,x.xS.REPLACE),t.setStencilTestEnabled(!0),t.setBlendingEnabled(!1),t.setDepthTestEnabled(!0),t.setDepthWriteEnabled(!0),t.setDepthFunction(x.wb.LEQUAL),t.setClearDepth(1),t.clear(t.gl.DEPTH_BUFFER_BIT),e.renderPass="opaque";for(let t=r.length-1;t>=0;t--)this._renderStyleLayer(r[t],e,n);t.setDepthWriteEnabled(!1),t.setBlendingEnabled(!0),t.setBlendFunctionSeparate(x.zi.ONE,x.zi.ONE_MINUS_SRC_ALPHA,x.zi.ONE,x.zi.ONE_MINUS_SRC_ALPHA),e.renderPass="translucent";for(let t=0;t<r.length;t++)this._renderStyleLayer(r[t],e,n);for(let e of(t.bindVAO(),t.setStencilTestEnabled(!0),t.setBlendingEnabled(!0),n))e.debugInfo.display.triangleCount=e.triangleCount}_fade(e,t){null!=this._symbolFader&&(this._symbolFader.update(e,t)||this.requestRender())}_renderStyleLayer(e,t,i){let s;let{displayLevel:r,painter:l,renderPass:n}=t;if(void 0===e)return;let a=e.getLayoutProperty("visibility");if(a&&a.getValue()===en.EE.NONE)return;switch(e.type){case en.fR.BACKGROUND:return;case en.fR.FILL:if("opaque"!==n&&"translucent"!==t.renderPass)return;s="vtlFill";break;case en.fR.LINE:if("translucent"!==n)return;s="vtlLine";break;case en.fR.CIRCLE:if("translucent"!==n)return;s="vtlCircle";break;case en.fR.SYMBOL:if("translucent"!==n)return;s="vtlSymbol"}if(i=e.type===en.fR.SYMBOL?i.filter(e=>e.decluttered):i.filter(e=>e.neededForCoverage),"vtlSymbol"!==s&&(0===i.length||void 0!==e.minzoom&&e.minzoom>=r+1e-6||void 0!==e.maxzoom&&e.maxzoom<r-1e-6))return;let o=e.uid;for(let r of(t.styleLayerUID=o,t.styleLayer=e,i))if(r.layerData.has(o)){l.renderObjects(t,i,s);break}}_renderBackgroundLayers(e,t,i){let{context:s,painter:r,state:l}=e,n=this._styleRepository,a=!1;for(let e of t)if(n.getLayerById(e).type===en.fR.BACKGROUND&&ep(n.getLayerById(e),i)){a=!0;break}if(!a)return;let o=this._tileInfoView,h=o.getTileCoverage(e.state,0,!0,"smallest"),{spans:u,lodInfo:c}=h,{level:_}=c,y=(0,d.Ue)(),p=[];if(this._renderPasses){let t=this._renderPasses[0];null!=this._clippingInfos&&(t.brushes[0].prepareState(e),t.brushes[0].drawMany(e,this._clippingInfos))}let f=this._backgroundTiles,g,m=0;for(let{row:e,colFrom:t,colTo:i}of u)for(let s=t;s<=i;s++){if(m<f.length)(g=f[m]).key.set(_,e,c.normalizeCol(s),c.getWorldForColumn(s)),o.getTileBounds(y,g.key,!1),g.x=y[0],g.y=y[3],g.resolution=o.getTileResolution(_);else{let t=new P.Z(_,e,c.normalizeCol(s),c.getWorldForColumn(s)),i=o.getTileBounds((0,d.Ue)(),t);g=new e_(t,o.getTileResolution(_),i[0],i[3],512,512,4096,4096),f.push(g)}g.setTransform(l),p.push(g),m++}for(let l of(s.setStencilWriteMask(0),s.setColorMask(!0,!0,!0,!0),s.setStencilOp(x.xS.KEEP,x.xS.KEEP,x.xS.REPLACE),s.setStencilFunction(x.wb.EQUAL,0,255),s.setStencilTestEnabled(!0),t)){let t=n.getLayerById(l);t.type===en.fR.BACKGROUND&&ep(t,i)&&(e.styleLayerUID=t.uid,e.styleLayer=t,r.renderObjects(e,p,"vtlBackground"))}z.Z.pool.release(h)}_computeDisplayInfoView(e){let t=e.tileInfo.lods[0].scale,i=Math.max(25,e.tileInfo.lods.length),s=[];for(let e=0;e<=i;e++)s.push(t),t/=2;this._displayInfo=er.Z.create({scales:s,size:512,spatialReference:e.spatialReference,numLODs:i})}}var eg=i(19637),em=i(59528),ex=i(76465),eb=i(54583),ew=i(40050),ev=i(85857);let eS=(e,t)=>{let i=e.vtlSymbol.sourceTile,s=t.vtlSymbol.sourceTile;return i.level!==s.level?i.level-s.level:i.row!==s.row?i.row-s.row:i.col!==s.col?i.col-s.col:e.styleLayerUID-t.styleLayerUID};class eI{constructor(e,t,i,s,r){this.tileKey=e,this._index=null,this._styleRepository=null,this._tileHandler=null,this._tileKeyToPBF=new Map,this._tileLayerData=t,this._styleRepository=i,this._tileHandler=s,this._parentLayer=r}static create(e,t,i,s,r){return new eI(e,t,i,s,r)}clear(){this._index?.clear(),this._tileKeyToPBF.clear()}async queryAttributes(e,t,i,s,r){if(0===this._tileLayerData.size||!this._styleRepository||!this._tileHandler)return[];null===this._index&&(this._index=new ex.Q(100,eT),await this._indexLayers());let l=[];return this._queryIndex(l,e,t,i,this.tileKey.level,s),r&&r?.length>0&&await this._getSymbolsAttributes(l,r),l}async _indexLayers(){let e=this.tileKey,t=this._styleRepository.layers,i=await this._getTilePayload(e);for(let[s,r]of this._tileLayerData){let l=t[s],n=i.find(e=>e.sourceName===l.source);if(!n)continue;let{protobuff:a,key:o}=n;if(r.type!==y.al.SYMBOL){let t=1<<e.level-o.level,i=e.row-o.row*t,s=e.col-o.col*t;this._indexLayer(l,a,e.level,t,i,s)}}}_indexLayer(e,t,i,s,r,l){let n=e.sourceLayer,a=e.getFeatureFilter(),o=i+1,h=(0,H.KU)(i),u=new I.Z(new Uint8Array(t),new DataView(t));for(;u.next();)if(3===u.tag()){let t=u.getMessage(),c=new ew.Z(t);if(t.release(),c.name!==n)continue;let d=c.getData(),_=c.extent/s,y=_*l-h,p=_*r-h,f=y+_+2*h,g=p+_+2*h,m=_/512,x=4096/_,b=_*l,w=_*r;for(;d.nextTag(2);){let t=d.getMessage(),s=new eb.Z(t,c);if(t.release(),a&&!a.filter(s,i))continue;let r=s.values||{},l=r._minzoom,n=r._maxzoom;if(l&&l>=10*o||n&&n<=10*i)continue;let h=e.getFeatureInflatedBounds(s,i,c.extent,m);null==h||h[0]>f||h[1]>g||h[2]<y||h[3]<p||(h[0]=(h[0]-b)*x,h[1]=(h[1]-w)*x,h[2]=(h[2]-b)*x,h[3]=(h[3]-w)*x,this._index.insert(new ev.$L(e,s,h,x,b,w)))}}else u.skip()}async _getSymbolsAttributes(e,t){if(!t||0===t.length)return e;let i=[];t.sort(eS);let s=t[0].styleLayerUID,r=0;for(let e=0;e<t.length;e++)s!==t[e].styleLayerUID&&(i.push({from:r,to:e,styleLayerUID:s,sourceTileKey:t[e].vtlSymbol.sourceTile}),r=e,s=t[e].styleLayerUID);i.push({from:r,to:t.length,styleLayerUID:s,sourceTileKey:t[t.length-1].vtlSymbol.sourceTile});let l=this._styleRepository.layers,n,a=null;for(let r of i){let i=await this._getTilePayload(r.sourceTileKey);(a=!!(n=l[r.styleLayerUID])&&i.find(e=>e.sourceName===n.source))&&this._addSymbolsAttributes(e,t.slice(r.from,r.to).map(e=>e.vtlSymbol),s,a)}return e}_addSymbolsAttributes(e,t,i,s){let r=this._styleRepository.layers,l=s.key,n=this.tileKey,a=1<<n.level-l.level,o=n.row-l.row*a,h=n.col-l.col*a;this._getSymbolAttributes(s.protobuff,t,i,a,o,h).forEach(t=>{let{attributes:s,tilePoint:l}=t;e.push({layerId:r[i].id,layerIndex:i,graphic:new eg.Z({attributes:s,origin:{type:"vector-tile",layerId:r[i].id,layerIndex:i,layer:this._parentLayer}}),tilePoint:l})})}_getSymbolAttributes(e,t,i,s,r,l){let n=[],a=this._styleRepository.layers,o=0;t.sort((e,t)=>e.featureIndex-t.featureIndex);let h=new I.Z(new Uint8Array(e),new DataView(e));for(;h.next();)if(3===h.tag()){let e=h.getMessage(),u=new ew.Z(e);if(e.release(),u.name!==a[i].sourceLayer)continue;let c=u.getData(),d=u.extent/s,_=4096/d,y=d*l,p=d*r,f=0;for(;c.nextTag(2);){let e=c.getMessage();if(f++===t[o].featureIndex){let t=new eb.Z(e,u),i=t.values,s=t.getGeometry(),r=null!=s?[_*(s[0][0].x-y),_*(s[0][0].y-p)]:null;n.push({attributes:i,tilePoint:r}),o++}if(e.release(),o===t.length)return n}}else h.skip();return n}_queryIndex(e,t,i,s,r,l){let n=8*s*(window.devicePixelRatio||1);return this._index?.search({minX:t-n,minY:i-n,maxX:t+n,maxY:i+n},n=>{let{layer:a,feature:o}=n;a.isIntersectingFeature(t,i,s,o,r,l,n)&&e.push({layerId:a.id,layerIndex:a.uid,tilePoint:null,graphic:new eg.Z({attributes:o.values,origin:{type:"vector-tile",layerId:n.layer.id,layerIndex:n.layer.uid,layer:this._parentLayer}})})}),e}async _getTilePayload(e){return(0,em.s1)(this._tileKeyToPBF,e.id,()=>this._tileHandler.fetchTilePBFs(e)).then(e=>e)}}let eT=e=>({minX:e.bounds[0],minY:e.bounds[1],maxX:e.bounds[2],maxY:e.bounds[3]});var eR=i(78088),eC=i(50338);class eM extends B.Z{constructor(){super(...arguments),this._fullCacheLodInfos=null,this._levelByScale={}}getTileParentId(e){let t=P.Z.pool.acquire(e),i=0===t.level?null:P.Z.getId(t.level-1,t.row>>1,t.col>>1,t.world);return P.Z.pool.release(t),i}getTileCoverage(e,t,i=!0,s){let r=super.getTileCoverage(e,t,i,s);if(!r)return r;let l=1<<r.lodInfo.level;return r.spans=r.spans.filter(e=>e.row>=0&&e.row<l),r}scaleToLevel(e){if(this._fullCacheLodInfos||this._initializeFullCacheLODs(this._lodInfos),this._levelByScale[e])return this._levelByScale[e];{let t,i;let s=this._fullCacheLodInfos;if(e>s[0].scale)return s[0].level;for(let r=0;r<s.length-1;r++)if(e>(i=s[r+1]).scale)return(t=s[r]).level+(t.scale-e)/(t.scale-i.scale);return s[s.length-1].level}}_initializeFullCacheLODs(e){let t;if(0===e[0].level)t=e.map(e=>({level:e.level,resolution:e.resolution,scale:e.scale}));else{let e=this.tileInfo.size[0],i=this.tileInfo.spatialReference;t=er.Z.create({size:e,spatialReference:i}).lods.map(e=>({level:e.level,resolution:e.resolution,scale:e.scale}))}for(let e=0;e<t.length;e++)this._levelByScale[t[e].scale]=t[e].level;this._fullCacheLodInfos=t}}var eA=i(1003);let eD=class extends(0,eC.y)(eA.Z){constructor(){super(...arguments),this._styleChanges=[],this._fetchQueue=null,this._parseQueue=null,this._tileHandlerPromise=null,this._isTileHandlerReady=!1}get fading(){return this._vectorTileContainer?.fading??!1}async hitTest(e,t){let i=this._tileHandlerPromise,s=this._vectorTileContainer?.symbolFader;if(!i||!this._isTileHandlerReady||!s)return;await i;let r=null,l=this._vectorTileContainer?.symbolRepository;l&&(r=l.querySymbols(t,2,s.decluttererOffset,{}));let n=this.view.state,a=this._tileManager.getIntersectingTiles(t.x,t.y,2,n,r);if((!a||0===a.length)&&0===r?.length)return null;e=e.clone().normalize();let o=[],h=[];for(let t of a)o.push(this._queryTile(h,e,2,this.view.state.rotation,t,r?.filter(e=>e.tileKey.id===t.id)));return await Promise.all(o),h}update(e){if(this._tileHandlerPromise&&this._isTileHandlerReady)return e.pixelRatio!==this._tileHandler.devicePixelRatio?(this._start(),void(this._tileHandler.devicePixelRatio=e.pixelRatio)):void(this._styleChanges.length>0?this._tileHandlerPromise=this._applyStyleChanges():(this._fetchQueue.pause(),this._parseQueue.pause(),this._fetchQueue.state=e.state,this._parseQueue.state=e.state,this._tileManager.update(e)||this.requestUpdate(),this._parseQueue.resume(),this._fetchQueue.resume()))}attach(){let{style:e}=this.layer.currentStyleInfo;this._styleRepository=new eR.Z(e),this._tileInfoView=new eM(this.layer.tileInfo,this.layer.fullExtent),this._vectorTileContainer=new ef(this._tileInfoView),this._tileHandler=new L(this.layer,this._styleRepository,window.devicePixelRatio||1,this.layer.tileInfo.lods.length-1),this.container.addChild(this._vectorTileContainer),this._start(),this.addAttachHandles([this.layer.on("paint-change",e=>{if(e.isDataDriven)this._styleChanges.push({type:y.Fr.PAINTER_CHANGED,data:e}),this.requestUpdate();else{let t=this._styleRepository,i=t.getLayerById(e.layer);if(!i)return;let s=i.type===en.fR.SYMBOL;t.setPaintProperties(e.layer,e.paint),s&&this._vectorTileContainer?.restartDeclutter(),this._vectorTileContainer?.requestRender()}}),this.layer.on("layout-change",e=>{let t=this._styleRepository,i=t.getLayerById(e.layer);if(!i)return;let s=(0,u.Hg)(i.layout,e.layout);if(null!=s){if((0,u.uD)(s,"visibility")&&1===function(e){if(null==e)return 0;switch(e.type){case"partial":return Object.keys(e.diff).length;case"complete":return Math.max(Object.keys(e.oldValue).length,Object.keys(e.newValue).length);case"collection":return Object.keys(e.added).length+Object.keys(e.changed).length+Object.keys(e.removed).length}}(s))return t.setLayoutProperties(e.layer,e.layout),i.type===en.fR.SYMBOL&&this._vectorTileContainer?.restartDeclutter(),void this._vectorTileContainer?.requestRender();this._styleChanges.push({type:y.Fr.LAYOUT_CHANGED,data:e}),this.requestUpdate()}}),this.layer.on("style-layer-visibility-change",e=>{let t=this._styleRepository,i=t.getLayerById(e.layer);i&&(t.setStyleLayerVisibility(e.layer,e.visibility),i.type===en.fR.SYMBOL&&this._vectorTileContainer?.restartDeclutter(),this._vectorTileContainer?.requestRender())}),this.layer.on("style-layer-change",e=>{this._styleChanges.push({type:y.Fr.LAYER_CHANGED,data:e}),this.requestUpdate()}),this.layer.on("delete-style-layer",e=>{this._styleChanges.push({type:y.Fr.LAYER_REMOVED,data:e}),this.requestUpdate()}),this.layer.on("load-style",()=>this._loadStyle()),this.layer.on("spriteSource-change",e=>{for(let t of(this._styleChanges.push({type:y.Fr.SPRITES_CHANGED,data:e}),this._styleRepository.layers))switch(t.type){case en.fR.SYMBOL:t.getLayoutProperty("icon-image")&&this._styleChanges.push({type:y.Fr.LAYOUT_CHANGED,data:{layer:t.id,layout:t.layout}});break;case en.fR.LINE:t.getPaintProperty("line-pattern")&&this._styleChanges.push({type:y.Fr.PAINTER_CHANGED,data:{layer:t.id,paint:t.paint,isDataDriven:t.isPainterDataDriven()}});break;case en.fR.FILL:t.getLayoutProperty("fill-pattern")&&this._styleChanges.push({type:y.Fr.PAINTER_CHANGED,data:{layer:t.id,paint:t.paint,isDataDriven:t.isPainterDataDriven()}})}this.requestUpdate()})])}detach(){this._stop(),this.container.removeAllChildren(),this._vectorTileContainer=(0,n.SC)(this._vectorTileContainer),this._tileHandler=(0,n.SC)(this._tileHandler)}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}supportsSpatialReference(e){return(0,_.fS)(this.layer.tileInfo?.spatialReference,e)}canResume(){let e=super.canResume(),{currentStyleInfo:t}=this.layer;if(e&&t?.layerDefinition){let i=this.view.scale,{minScale:s,maxScale:r}=t.layerDefinition;t?.layerDefinition&&(s&&s<i&&(e=!1),r&&r>i&&(e=!1))}return e}isUpdating(){return this.fading}acquireTile(e){let t=this._createVectorTile(e);return this._updatingHandles.addPromise(this._fetchQueue.push(t.key).then(e=>this._parseQueue.push({key:t.key,data:e})).then(e=>{t.once("attach",()=>this.requestUpdate()),t.setData(e),this.requestUpdate()}).catch(e=>{(0,a.D_)(e)||l.Z.getLogger(this).error(e)})),t}releaseTile(e){let t=e.key.id;this._fetchQueue.abort(t),this._parseQueue.abort(t),this.requestUpdate()}_start(){if(this._stop(),this._tileManager=new O({acquireTile:e=>this.acquireTile(e),releaseTile:e=>this.releaseTile(e),tileInfoView:this._tileInfoView},this._vectorTileContainer),!this.layer.currentStyleInfo)return;let e=new AbortController,t=this._tileHandler.start({signal:e.signal}).then(()=>{this._fetchQueue=new q.Z({tileInfoView:this._tileInfoView,process:(e,t)=>this._getTileData(e,t),concurrency:15}),this._parseQueue=new q.Z({tileInfoView:this._tileInfoView,process:(e,t)=>this._parseTileData(e,t),concurrency:8}),this.requestUpdate(),this._isTileHandlerReady=!0});this._tileHandler.spriteMosaic.then(e=>{this._vectorTileContainer.setStyleResources(e,this._tileHandler.glyphMosaic,this._styleRepository,this._tileInfoView),this.requestUpdate()}),this._tileHandlerAbortController=e,this._tileHandlerPromise=t}_stop(){if(!this._tileHandlerAbortController||!this._vectorTileContainer)return;let e=this._tileHandlerAbortController;e&&e.abort(),this._tileHandlerPromise=null,this._isTileHandlerReady=!1,this._fetchQueue=(0,n.SC)(this._fetchQueue),this._parseQueue=(0,n.SC)(this._parseQueue),this._tileManager=(0,n.SC)(this._tileManager),this._vectorTileContainer.removeAllChildren()}async _getTileData(e,t){return this._tileHandler.fetchTileData(e,t)}async _parseTileData(e,t){return this._tileHandler.parseTileData(e,t)}async _applyStyleChanges(){this._isTileHandlerReady=!1,this._fetchQueue.pause(),this._parseQueue.pause(),this._fetchQueue.clear(),this._parseQueue.clear(),this._tileManager.clearCache();let e=this._styleChanges;try{await this._tileHandler.updateStyle(e)}catch(e){l.Z.getLogger(this).error("error applying vector-tiles style update",e.message),this._fetchQueue.resume(),this._parseQueue.resume(),this._isTileHandlerReady=!0}let t=this._styleRepository,i=new Set;e.forEach(e=>{if(e.type!==y.Fr.LAYER_REMOVED)return;let s=e.data,r=t.getLayerById(s.layer);r&&i.add(r.uid)});let s=new Set;e.forEach(e=>{let i;switch(e.type){case y.Fr.PAINTER_CHANGED:t.setPaintProperties(e.data.layer,e.data.paint),i=e.data.layer;break;case y.Fr.LAYOUT_CHANGED:t.setLayoutProperties(e.data.layer,e.data.layout),i=e.data.layer;break;case y.Fr.LAYER_REMOVED:return void t.deleteStyleLayer(e.data.layer);case y.Fr.LAYER_CHANGED:t.setStyleLayer(e.data.layer,e.data.index),i=e.data.layer.id;break;case y.Fr.SPRITES_CHANGED:this._vectorTileContainer.setSpriteMosaic(this._tileHandler.setSpriteSource(e.data.spriteSource))}if(i){let e=t.getLayerById(i);e&&s.add(e.uid)}});let r=this._vectorTileContainer.children;if(i.size>0){let e=Array.from(i);for(let t of(this._vectorTileContainer.deleteStyleLayers(e),r))t.deleteLayerData(e)}if(this._fetchQueue.resume(),this._parseQueue.resume(),s.size>0){let e=Array.from(s),t=[];for(let i of r){let s=this._updatingHandles.addPromise(this._fetchQueue.push(i.key).then(t=>this._parseQueue.push({key:i.key,data:t,styleLayerUIDs:e})).then(e=>i.setData(e)));t.push(s)}await Promise.all(t)}this._styleChanges=[],this._isTileHandlerReady=!0,this.requestUpdate()}async _loadStyle(){let{style:e}=this.layer.currentStyleInfo,t=(0,r.d9)(e);this._isTileHandlerReady=!1,this._fetchQueue.pause(),this._parseQueue.pause(),this._fetchQueue.clear(),this._parseQueue.clear(),this._styleRepository=new eR.Z(t),this._vectorTileContainer.destroy(),this._tileManager.clear(),this._tileHandlerAbortController.abort(),this._tileHandlerAbortController=new AbortController;let{signal:i}=this._tileHandlerAbortController;try{this._tileHandlerPromise=this._tileHandler.setStyle(this._styleRepository,t,this.layer.tileInfo.lods.length-1),await this._tileHandlerPromise}catch(e){if(!(0,a.D_)(e))throw e}if(i.aborted)return this._fetchQueue.resume(),this._parseQueue.resume(),this._isTileHandlerReady=!0,void this.requestUpdate();let s=await this._tileHandler.spriteMosaic,l=this._vectorTileContainer;this._tileInfoView=new eM(this.layer.tileInfo,this.layer.fullExtent),l.setStyleResources(s,this._tileHandler.glyphMosaic,this._styleRepository,this._tileInfoView),this._tileManager=new O({acquireTile:e=>this.acquireTile(e),releaseTile:e=>this.releaseTile(e),tileInfoView:this._tileInfoView},this._vectorTileContainer),this._fetchQueue.resume(),this._parseQueue.resume(),this._isTileHandlerReady=!0,this.requestUpdate()}_createVectorTile(e){let t=this._tileInfoView.getTileBounds((0,d.Ue)(),e),i=this._tileInfoView.getTileResolution(e.level);return new ei(e,i,t[0],t[3],512,512,this._styleRepository)}async _queryTile(e,t,i,s,r,l){if(0===r.layerData.size)return;let n=this._ensureTileIndex(r),a=this._tileInfoView.getTileBounds((0,d.Ue)(),r.key,!0),o=(t.x-a[0])/(a[2]-a[0])*4096,h=4096*(1-(t.y-a[1])/(a[3]-a[1]));for(let a of(await n.queryAttributes(o,h,i,s,l)))a.graphic.geometry=this._tileToMapPoint(a.tilePoint,r.transforms.tileUnitsToPixels),e.push({type:"graphic",layer:this.layer,graphic:a.graphic,mapPoint:t.clone()});e.sort((e,t)=>t.graphic.origin.layerIndex-e.graphic.origin.layerIndex)}_tileToMapPoint(e,t){if(!e)return null;let i=e[0]*t[0]+e[1]*t[3]+t[6],s=e[0]*t[1]+e[1]*t[4]+t[7],r=this.view.state,l=[0,0];return r.toMap(l,[i,s]),new c.Z({x:l[0],y:l[1],spatialReference:r.spatialReference})}_ensureTileIndex(e){let t=e.featureIndex;return t||(t=eI.create(e.key,e.layerData,this._styleRepository,this._tileHandler,this.layer),e.featureIndex=t),t}};(0,s._)([(0,o.Cb)()],eD.prototype,"_isTileHandlerReady",void 0);let eP=eD=(0,s._)([(0,h.j)("esri.views.2d.layers.VectorTileLayerView2D")],eD)},1003:function(e,t,i){i.d(t,{Z:function(){return p}});var s=i(86641),r=i(94761),l=i(60163),n=i(2090),a=i(65223),o=i(36152),h=i(31534),u=i(89312);i(37180),i(3457);var c=i(64186),d=i(66789),_=i(37864);let y=class extends(0,n.IG)((0,h.v)(l.Z.EventedMixin(r.Z))){constructor(e){super(e),this._updatingHandles=new d.R,this.layer=null,this.parent=null}initialize(){this.when().catch(e=>{if("layerview:create-error"!==e.name){let t=this.layer&&this.layer.id||"no id",i=this.layer?.title||"no title";a.Z.getLogger(this).error("#resolve()",`Failed to resolve layer view (layer title: '${i}', id: '${t}')`,e)}})}destroy(){this._updatingHandles=(0,o.SC)(this._updatingHandles)}get fullOpacity(){return(this.layer?.opacity??1)*(this.parent?.fullOpacity??1)}get suspended(){return this.destroyed||!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){return!this.suspended&&!0===this.layer?.legendEnabled}get updating(){return!(!this._updatingHandles?.updating&&!this.isUpdating())}get updatingProgress(){return this.updating?0:1}get updateSuspended(){return this.suspended}get visible(){return!0===this.layer?.visible}set visible(e){this._overrideIfSome("visible",e)}get visibleAtCurrentScale(){return!0}get visibleAtCurrentTimeExtent(){let e=this.view.timeExtent,t=this.layer?.visibilityTimeExtent;return!e||!t||!e.intersection(t).isEmpty}canResume(){let e=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return this.visible&&this.layer?.loaded&&!this.parent?.suspended&&this.view?.ready&&(0,_.Cy)(e)&&this.visibleAtCurrentScale&&this.visibleAtCurrentTimeExtent||!1}getSuspendInfo(){let e=this.parent?.suspended?this.parent.suspendInfo:{};this.view?.ready||(e.viewNotReady=!0),this.layer&&this.layer.loaded||(e.layerNotLoaded=!0);let t=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return(0,_.Cy)(t)&&this.visibleAtCurrentScale||(e.outsideScaleRange=!0),this.visibleAtCurrentTimeExtent||(e.outsideVisibilityTimeExtent=!0),this.visible||(e.layerInvisible=!0),e}isUpdating(){return!1}};(0,s._)([(0,u.Cb)()],y.prototype,"view",void 0),(0,s._)([(0,u.Cb)()],y.prototype,"fullOpacity",null),(0,s._)([(0,u.Cb)()],y.prototype,"layer",void 0),(0,s._)([(0,u.Cb)()],y.prototype,"parent",void 0),(0,s._)([(0,u.Cb)({readOnly:!0})],y.prototype,"suspended",null),(0,s._)([(0,u.Cb)({readOnly:!0})],y.prototype,"suspendInfo",null),(0,s._)([(0,u.Cb)({readOnly:!0})],y.prototype,"legendEnabled",null),(0,s._)([(0,u.Cb)({type:Boolean,readOnly:!0})],y.prototype,"updating",null),(0,s._)([(0,u.Cb)({readOnly:!0})],y.prototype,"updatingProgress",null),(0,s._)([(0,u.Cb)()],y.prototype,"updateSuspended",null),(0,s._)([(0,u.Cb)()],y.prototype,"visible",null),(0,s._)([(0,u.Cb)({readOnly:!0})],y.prototype,"visibleAtCurrentScale",null),(0,s._)([(0,u.Cb)({readOnly:!0})],y.prototype,"visibleAtCurrentTimeExtent",null);let p=y=(0,s._)([(0,c.j)("esri.views.layers.LayerView")],y)},76457:function(e,t,i){i.d(t,{Z:function(){return o}});var s=i(86641),r=i(689),l=i(89312);i(37180),i(65223),i(3457);var n=i(64186);let a=class extends r.wq{get version(){return this.commitVersionProperties(),(this._get("version")||0)+1}};(0,s._)([(0,l.Cb)({readOnly:!0})],a.prototype,"version",null);let o=a=(0,s._)([(0,n.j)("esri.views.layers.support.ClipArea")],a)},55485:function(e,t,i){i.d(t,{Z:function(){return y}});var s,r=i(86641);i(55066);var l=i(89312);i(37180),i(65223),i(3457);var n=i(64186),a=i(90389),o=i(5005),h=i(76457),u=i(9377),c=i(54001);let d={base:a.Z,key:"type",typeMap:{extent:u.Z,polygon:c.Z}},_=s=class extends h.Z{constructor(e){super(e),this.type="geometry",this.geometry=null}clone(){return new s({geometry:this.geometry?.clone()??null})}commitVersionProperties(){this.commitProperty("geometry")}};(0,r._)([(0,l.Cb)({types:d,json:{read:o.im,write:!0}})],_.prototype,"geometry",void 0);let y=_=s=(0,r._)([(0,n.j)("esri.views.layers.support.Geometry")],_)},37864:function(e,t,i){function s(e){return e&&"function"==typeof e.highlight}function r(e,t){if(t&&e){let{minScale:i,maxScale:s}=e;if(null!=i&&i>0||null!=s&&s>0)return null==t||t>=s&&(0===i||t<=i)}return!0}function l(e){return!e?.minScale||!e.maxScale||e.minScale>=e.maxScale}i.d(t,{Cy:function(){return l},GB:function(){return r},tl:function(){return s}})}}]);