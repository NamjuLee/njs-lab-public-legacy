"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[27504],{66394:function(t,e,i){i.d(e,{Du:function(){return s}});let s=(t,e,i)=>{let s=document.createElement("div");s.style.display="flex";let n=document.createElement("input");n.type="range",n.min="".concat(e),n.max="".concat(i);let r=document.createElement("div");return r.textContent=t,r.style.color="#aaa",s.appendChild(n),s.appendChild(r),{div:s,slider:n,text:r}}},27504:function(t,e,i){i.r(e),i.d(e,{Solution:function(){return x}});let s=new Float32Array([0,.5,0,-.5,-.5,0,.5,-.5,0]);class n{async initWebGPU(){if(!navigator.gpu)throw Error("Not Support WebGPU");let t=await navigator.gpu.requestAdapter({powerPreference:"high-performance"});if(!t)throw Error("No Adapter Found");let e=await t.requestDevice();this.ctx=this.canvas.getContext("webgpu");let i=navigator.gpu.getPreferredCanvasFormat?navigator.gpu.getPreferredCanvasFormat():this.ctx.getPreferredFormat(t);window.devicePixelRatio,this.canvas.width=this.canvas.clientWidth,this.canvas.height=this.canvas.clientHeight,this.ctx.configure({device:e,format:i,alphaMode:"opaque"}),this.size={width:this.canvas.width,height:this.canvas.height},this.device=e,this.format=i,this.loop()}draw(t){void 0!==t&&(this.solution.camera.update(),this.commandEncoder=this.device.createCommandEncoder(),this.view=this.ctx.getCurrentTexture().createView(),this.renderPassDescriptor={colorAttachments:[{view:this.view,clearValue:{r:0,g:0,b:0,a:1},loadOp:"clear",storeOp:"store"}]},this.passEncoder=this.commandEncoder.beginRenderPass(this.renderPassDescriptor),this.passEncoder.setPipeline(t.pipeline),this.passEncoder.setBindGroup(0,t.uniformGroup),this.passEncoder.setVertexBuffer(0,t.vertexBuffer),this.passEncoder.draw(3),this.passEncoder.end(),this.device.queue.submit([this.commandEncoder.finish()]))}destroy(){this.device.destroy(),cancelAnimationFrame(this.requestAni)}constructor(t){this.loop=()=>{this.solution.scene.render(),this.requestAni=requestAnimationFrame(this.loop)},this.solution=t,this.canvas=t.canvas}}var r=i(49644);class o{constructor(){}}class a extends o{async initPipeline(t,e){let i=await t.createRenderPipelineAsync({label:"Basic Pipline",layout:"auto",vertex:{module:t.createShaderModule({code:"\n@vertex\nfn main(@location(0) position : vec3<f32>) -> @builtin(position) vec4<f32> {\n    return vec4<f32>(position, 1.0);\n}\n"}),entryPoint:"main",buffers:[{arrayStride:12,attributes:[{shaderLocation:0,offset:0,format:"float32x3"}]}]},fragment:{module:t.createShaderModule({code:"\n@group(0) @binding(0) var<uniform> color : vec4<f32>;\n\n@fragment\nfn main() -> @location(0) vec4<f32> {\n    return color;\n}"}),entryPoint:"main",targets:[{format:e}]},primitive:{topology:"triangle-list"}}),s=t.createBuffer({label:"GPUBuffer store vertex",size:this.vertex.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST});t.queue.writeBuffer(s,0,this.vertex);let n=t.createBuffer({label:"GPUBuffer store rgba color",size:16,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});t.queue.writeBuffer(n,0,new Float32Array([1,0,0,1]));let r=t.createBindGroup({label:"Uniform Group with colorBuffer",layout:i.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:n}}]});this.pipeline={pipeline:i,vertexBuffer:s,colorBuffer:n,uniformGroup:r},this.scene.geometries.push(this)}constructor(t){super(),this.vertex=new Float32Array([0,.1,0,-.5,-.5,0,.5,-.5,0]),this.vertexCount=3,this.position=r.al(0,0,0),this.scene=t,this.position[0]=.5,this.vertex[1]+=Math.random(),this.initPipeline(this.scene.solution.renderer.device,this.scene.solution.renderer.format)}}class h{init(){this.geometries.push(new a(this))}render(){for(this.index=0;this.index<this.geometries.length;++this.index)this.solution.renderer.draw(this.geometries[this.index].pipeline);console.log("rendering...",this.geometries.length)}constructor(t){this.geometries=[],this.index=0,this.solution=t}}class c{appendEvent(){this.solution.divHost.addEventListener("mousedown",t=>{console.log(t),this.solution.controller.addTri()})}constructor(t){this.solution=t,this.appendEvent()}}class d{addTri(){new a(this.solution.scene)}constructor(t){this.solution=t}}var l=i(66394);class u{appendEvent(){this.divColor.addEventListener("input",t=>{let e=t.target.value;e.slice(1,3),e.slice(3,5),e.slice(5,7)}),this.divRange.slider.addEventListener("input",t=>{let e=+t.target.value;console.log(e),s[0]=0,s[3]=-.5+-(.01*e),s[6]=.5+.01*e}),window.addEventListener("resize",()=>{this.solution.canvas.width=this.solution.divHost.clientWidth,this.solution.canvas.height=this.solution.divHost.clientHeight})}constructor(t){this.solution=t,this.divHost=t.divHost,this.divColor=document.createElement("input"),this.divColor.type="color",this.divColor.defaultValue="#ff0000",this.divHost.appendChild(this.divColor),this.divRange=(0,l.Du)("size",0,100),this.divHost.appendChild(this.divRange.div),this.appendEvent()}}var v=i(81519);let p=i(31859),g=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0,0],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],n=v.Ue(),r=v.Ue(),o=v.Ue(),a=v.Ue(),h=v.Ue();v.vc(a,e),v.aC(n,i[0]),v.gT(r,i[1]),v.QO(o,i[2]),v.xJ(h,s),v.Jp(t,n,h),v.Jp(t,r,t),v.Jp(t,o,t),v.Jp(t,a,t)},m=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[2,2,4],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0,0],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[0,1,0],n=v.Ue(),r=v.Ue(),o=v.Ue();return v.G3(r,2*Math.PI/5,t,.1,100),v.zB(n,e,i,s),v.Jp(o,r,n),{viewMatrix:n,projectionMatrix:r,viewProjectionMatrix:o,cameraOption:{eye:e,center:i,zoomMax:100,zoomSpeed:2}}};class f{update(){let t=this.vp.projectionMatrix;this.vMatrix=this.camera.matrix,v.Jp(this.vpMatrix,t,this.vMatrix),g(this.modelMatrix,this.translation,this.rotation),v.Jp(this.mvpMatrix,this.vpMatrix,this.modelMatrix)}constructor(t){this.rotation=r.al(0,0,0),this.translation=r.al(0,0,0),this.solution=t,this.canvas=t.canvas,this.modelMatrix=v.Ue(),this.mvpMatrix=v.Ue(),this.vMatrix=v.Ue(),this.vpMatrix=v.Ue(),this.vp=m(this.canvas.width/this.canvas.height),this.vpMatrix=this.vp.viewProjectionMatrix,this.camera=p(this.canvas,this.vp.cameraOption)}}class x{initPost(){}destroy(){for(this.renderer.destroy();this.divHost.lastElementChild;)this.divHost.removeChild(this.divHost.lastElementChild)}constructor(t){this.init=async()=>{this.camera=new f(this),this.scene=new h(this),this.ui=new u(this),this.eventListener=new c(this),this.controller=new d(this),this.renderer=new n(this),await this.initRenderer(),this.scene.init(),this.initPost()},this.initRenderer=async()=>this.renderer.initWebGPU(),this.divHost=document.getElementById(t),this.divHost.style.position="relative",this.canvas=document.createElement("canvas"),this.divHost.appendChild(this.canvas),this.canvas.width=this.divHost.clientWidth,this.canvas.height=this.divHost.clientHeight,this.canvas.style.background="rgba(0,0,0,0)",this.init()}}}}]);