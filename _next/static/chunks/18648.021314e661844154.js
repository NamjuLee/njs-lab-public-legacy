"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[18648],{18648:function(e,t,s){s.r(t),s.d(t,{Implementations:function(){return iy}});var i,n,o,r,a,h,c,l,p=s(10706),d=s(85241);class m{constructor(e="",t=""){this.content=e,this.font=t}}class u{constructor(e,t,s){this.sx=e,this.sy=t,this.sz=s}}class g{pushNode(e){this.nodes=[];for(let t=0;t<e.length;++t)this.nodes.push(new u(e[t].x,e[t].y,e[t].z))}pushData(e,t){this.data=new m(e,t)}constructor(e,t,s,i,n){this.id=e,this.type=t,this.isSelected=s,this.isOver=i,this.isHidden=n,this.nodes=[],this.data={}}}class v{constructor(){}}class y{reset(){this.neighborShapes=[],this.numOrder=-1,this.geo.numVisit=0,this.isCollided=!1,this.isVisited=!1,this.geo.isCollapse=!1}updateBBox(){}set minVec(e){this._minVec.x=e.x-this.offset,this._minVec.y=e.y-this.offset}get minVec(){return this._minVec}set maxVec(e){this._maxVec.x=e.x+this.offset,this._maxVec.y=e.y+this.offset}get maxVec(){return this._maxVec}updateByScale(e){this._minVec.x=this.geo.vec.x-this.geo.styleComponent.renderStyle.width*e*.25,this._maxVec.x=this.geo.vec.x+this.geo.styleComponent.renderStyle.width*e*.25,this._minVec.y=this.geo.vec.y-this.geo.styleComponent.renderStyle.height*e}update(){this.isFixed||(this.cVec.x=this._minVec.x+(this._maxVec.x-this._minVec.x)*.5,this.cVec.y=this._minVec.y+(this._maxVec.y-this._minVec.y)*.5)}render(e){this.geo.scene.annotationInstance.implementations.app.INSPECTION&&this.isRenderable&&(this.isCollided?e.fillStyle=this.colB:e.fillStyle=this.colA,this.isFixed&&(e.fillStyle=this.colC),e.beginPath(),e.rect(this.minVec.x,this.minVec.y,this.maxVec.x-this.minVec.x,this.maxVec.y-this.minVec.y),e.closePath(),e.fill())}constructor(e){this.neighborShapes=[],this.numOrder=-1,this.offset=-2,this.isVisited=!1,this.isFixed=!1,this.isRenderable=!0,this.colA="rgba(0, 255, 0, 0.3)",this.colB="rgba(255, 0, 0, 0.3)",this.colC="rgba(0, 0, 0, 0.3)",this.cVec=new p.h9(0,0),this.isCollided=!1,this.isCollidable=!0,this.geoCollided=void 0,this.geo=e,this._minVec=new p.h9(e.vec.x-1,e.vec.y-1),this._maxVec=new p.h9(e.vec.x+1,e.vec.y+1)}}class C{update(e){this.host.scene.annotationInstance.implementations.app.INSPECTION&&(e.font="10px Arial",this.showStatus(e))}showStatus(e){let t=this.host.vec;e.beginPath(),e.arc(t.x,t.y,5,0,6.28),e.closePath(),e.fillStyle="#ff0000",e.fill();let s="IsTransform: ".concat(this.host.isTransform);e.fillText(s,t.x+10,t.y+10);let i="Type: ".concat(this.host.type);e.fillText(i,t.x+100,t.y+10);let n="scale: ".concat(this.host.scaleMap);e.fillText(n,t.x+10,t.y+25),e.fillStyle="#000000";let o="neighbors: ".concat(this.host.collision.neighborShapes.length);e.fillText(o,t.x+100,t.y+25)}constructor(e){this.host=e}}class S extends v{getNode(){let e=[];return e.push(this.vec),e}getArea(){return Number.MAX_SAFE_INTEGER}toJSON(){let e=new g(this.id,this.type,this.isSelectedValue,this.isHoverValue,this.isHiddenValue);return e.pushNode(this.getNode()),e}isSelectedByWindow(e){return(0,p.X0)(this.vec,e)}isSelectedByCrossing(e){return(0,p.vD)(this.vec,5,5,e)}isMouseInsideSnapFrom(e){}get v(){return this.vec}set v(e){this.vec=e}get isHidden(){return this.isHiddenValue}set isHidden(e){this.isHiddenPre=this.isHiddenValue,this.isHiddenValue=e,this.scene.annotationInstance.io.eventListenerAnnotation.hideStack(this.toJSON())}get size(){return this.sizeValue}set size(e){this.sizeValue=e}get isMovable(){return this.isMovableValue}set isMovable(e){this.isMovableValue=e}get isHover(){return this.isHoverValue}set isHover(e){e||(this.needEmitHoverPost=!0),this.isHoverValue=e}get visibility(){return this.visibilityValue}set visibility(e){this.visibilityValue=e}set isCollapse(e){this.isRenderCollapse=e}get isCollapse(){return this.isRenderCollapse}get textLeaderline(){return this.textLeaderlineValue}set textLeaderline(e){e===this.textLeaderlineValue||e&&this.textLeaderlinePost(e)||(this.textLeaderlineValue&&e&&this.textLeaderlineValue.removeLeaderline(),this.textLeaderlineValue=e)}updateColor(e){this.styleComponent.updateColor(e)}textLeaderlinePost(e){return!1}updateLeaderlineSnap(e,t){}get isPin(){return this.isPinValue}set isPin(e){this.isPinValue=e}get isSelected(){return this.isSelectedValue}set isSelected(e){this.isSelectedValue=e}get isCaptured(){return this.isCapturedValue}set isCaptured(e){this.isCapturedValue=e}get isEditiable(){return this.enableEditValue}set isEditiable(e){this.enableEditValue=e}get isTransform(){return this.isTransformValue}set isTransform(e){this.isTransformValue=e}get isMove(){return this.isMovedValue}set isMove(e){this.isMovedValue=e}get disable(){return this.disableValue}set disable(e){this.disableValue=e}get hasPopup(){return this.hasPopupValue}set hasPopup(e){this.hasPopupValue=e}getNodePopup(){}getBoundary(){return[this.vec]}updateActiveCursor(){}showPopupSummary(){if(this.scene.annotationInstance.activeCommandController.needPopup()&&!this.hasPopupValue&&!this.isGhost){if(this.hasPopupValue=!0,this.popup=document.createElement("div"),this.popup.id="pa-"+this.id,this.popup.style.position="absolute",this.popup.style.zIndex="1000",this.popup.style.height="0px",this.popup.style.width="0px",this.popup.style.backgroundColor="red",this.scene.annotationInstance.implementations.app.model.modelViewWrapper.div.appendChild(this.popup),this.type===p.zq.POLYLINE||this.type===p.zq.POLYLINE_BENDING||this.type===p.zq.POLYGON||this.type===p.zq.RECTANGLE||this.type===p.zq.CIRCLE){let e=this.getNodePopup();this.popup.style.top=e.vec.y+"px",this.popup.style.left=e.vec.x+"px"}else this.popup.style.top=this.vec.y+"px",this.popup.style.left=this.vec.x+"px";this.showPopupStackTimer&&clearTimeout(this.showPopupStackTimer),this.showPopupStackTimer=setTimeout(()=>{this.popup&&this.scene.annotationInstance.io.eventListenerAnnotation.showPopupStack(this.toJSON())},this.timePopupDelay)}}getVecs(){return[this.vec]}hidePopUpSummary(){if(this.popup&&this.popup.parentNode){if(this.renderer.tOverPopupSummary=0,this.popup.parentNode.removeChild(this.popup),this.type===p.zq.CNODE){let e=new g(this.id,this.type,this.isSelectedValue,this.isHoverValue,this.isHiddenValue);e.pushNode(this.getNode()),this.scene.annotationInstance.io.eventListenerAnnotation.hidePopupStack(e)}else this.scene.annotationInstance.io.eventListenerAnnotation.hidePopupStack(this.toJSON());this.hasPopupPre=!1,this.popup=void 0,this.hasPopupValue=!1}}needSnapping(e){return[(0,p.Sp)(this.vec,e),this.vec]}getVecForSnapping(){return this.vec}move(e,t){if(this.isRemove||!this.isRenderable||this.isHiddenValue)return}activateEasing(e,t){}easing(){}accelerating(){}findClosestNode(e,t){}renderPre(e){this.styleComponent.renderStyle.scaleGlobal=this.scene.annotationInstance.activeCommandController.scaleGlobal}setDash(e){return this.styleComponent.setDash(e)}updateBoundingBox(){}mouseDoubleClick(){}outExtent(){}inExtent(){}updateTheme(){}updateStyle(e){}updateStyleCustom(e){return this.styleComponent.updateStyleCustom(e)}initScale(e){this.scene.annotationInstance.activeCommandController.acProperties.activateMapScale&&(e?this.scaleMap=e:this.scaleMap=this.scene.annotationInstance.activeCommandController.acProperties.mapScale)}setScaleLocal(e){this.styleComponent.renderStyle.scaleLocal=e,this.scene.annotationInstance.graphicsCoreWrapper.renderForce()}updateScaleByZoomLevel(){if(!this.scene.annotationInstance.activeCommandController.acProperties.activateMapScale)return;let e=this.scaleMap/this.scene.annotationInstance.activeCommandController.acProperties.mapScale;if(!this.scene.annotationInstance.activeCommandController.acProperties.isScaleDynamicRender){this.scaleForRender=1;return}e>1?this.scaleForRender=1:e<.05?this.scaleForRender=0:this.scaleForRender=e}render(e){this.renderPre(e),Number.isNaN(this.vec.x)?this.outExtent():this.inExtent(),this.isRemove||!this.isRenderable||this.isHiddenValue&&this.visibilityValue<.01||(this.isAniEasing&&this.easing(),this.isAniAccel&&this.accelerating(),this.isUndo&&this.renderer&&(this.renderer.t=1,this.renderer.tDown1=1,this.renderer.tDown2=1),this.needBlackhole&&this.removeByBlackhole(),this.isMoveUpdate(),this.updatePopup(),this.updateHoverPost(),this.scene.annotationInstance.activeCommandController.acProperties.needCollisionDetection,this.renderPost(e))}updatePopup(){if(this.hasPopupValue&&void 0!==this.popup){if(this.hasGhostPopup)this.popup.style.top=this.vec.y-this.scene.annotationInstance.customization.themeCurrent.nPoint.height-this.ghostPopupOffset+"px",this.popup.style.left=this.vec.x+"px";else if(this.type===p.zq.POLYLINE||this.type===p.zq.POLYLINE_BENDING||this.type===p.zq.POLYGON||this.type===p.zq.RECTANGLE||this.type===p.zq.CIRCLE){let e=this.getNodePopup();this.popup.style.top=e.vec.y+"px",this.popup.style.left=e.vec.x+"px"}else this.popup.style.top=this.vec.y+"px",this.popup.style.left=this.vec.x+"px"}}updateHoverPost(){this.renderer.tOverPopupSummary>.2&&this.needEmitHoverPost&&(this.showPopupSummary(),this.emitHoverPostStack(),this.needEmitHoverPost=!1)}isMoveUpdate(){this.type===p.zq.ANODE||this.type===p.zq.ANODE_CIRCLE||this.type===p.zq.ANODE_NGON||this.type===p.zq.ANODE_RECT||this.type===p.zq.ANODE_TEXT||this.type===p.zq.AMIDPOINT||this.vecsHistory.length<1||((0,p.$5)(this.vecsHistory[this.vecsHistory.length-1],this.vec)?this.isMove=!1:(this.isMove=!0,this.isTransform=!0))}initVecsHistory(){this.vecsHistory=[],this.vecsHistory.push((0,p.p$)(this.vec),(0,p.p$)(this.vec),(0,p.p$)(this.vec))}updateVecsHistory(){for(this.vecsHistory.push((0,p.p$)(this.vec));this.vecsHistory.length>3;)this.vecsHistory.shift()}deepCopy(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2]}goToBlackhole(){}updatePostTransformation(){}fromJSON(e){}dummy(){}removeByBlackhole(){10>(0,p.CV)([this.scene.annotationInstance.renderer.blackhole.v.x,this.scene.annotationInstance.renderer.blackhole.v.y,this.scene.annotationInstance.renderer.blackhole.v.z],[this.vec.x,this.vec.y,this.vec.z])&&this.remove(this.needEmitRemoveByBlackhole)}mouseLeftClick(e,t){}mouseRightClick(e){}mouseUp(){}emitAddStack(){this.scene.annotationInstance.io.eventListenerAnnotation.addGeometryStack(this.toJSON())}emitHoverPostStack(){this.scene.annotationInstance.io.eventListenerAnnotation.hoverPostStack(this.toJSON())}constructor(e){super(),this.isFill=!1,this.isGhost=!1,this.isTransformValue=!1,this.needEmitRemoveByBlackhole=!0,this.numVisit=0,this.scaleMap=1,this.scaleForRender=1,this.isRenderCollapse=!1,this.timePopupDelay=100,this.vecSelectedSnapping=void 0,this.disableValue=!1,this.sizeValue=p.$u.MEDIUM,this.textLeaderlineValue=void 0,this.scene=e,this.scene.addGeometry(this),this.vec=(0,p.hW)(),this.id=this.scene.getUUID(),this.hashColor=this.scene.getHashColor(this),this.isRemove=!1,this.isHoverValue=!1,this.isGeoPos=!1,this.isSelectedValue=!1,this.isPinValue=!0,this.isSelectable=!0,this.isRenderable=!1,this.isMovableValue=!0,this.isDraggable=!1,this.isLeave=!1,this.isInsideExtent=!0,this.isHiddenValue=!1,this.isHiddenPre=!1,this.isAniEasing=!1,this.isAniAccel=!1,this.isCapturedValue=!1,this.isMovedValue=!1,this.isUnderConstruction=!0,this.isVisited=!1,this.isGrayColor=!1,this.isDrop=!1,this.isDrag=!1,this.isSelectedValue=!1,this.needEmitHoverPost=!0,this.isHoverValue=!1,this.enableEditValue=!1,this.hasSound=!1,this.vecsHistory=[],this.trajectoryVecs=[],this.zoomDisX=0,this.zoomDisY=0,this.isZoomStart=!0,this.needEmit=!0,this.isUndo=!0,this.ghostPopupOffset=5,this.scaleForRender=1,this.visibilityValue=1,this.needBlackhole=!1,this.inspector=new C(this),this.collision=new y(this),this.initScale()}}S.list=[];class A extends S{static mouseRightClick(e){}static mouseMiddleClick(e){}static mouseLeftClick(e,t,s){}static onMouseMove(e){}static mouseDrag(e){}static mouseUp(e){}init(){}update(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(e){this.updatePostTransformation();return}1===this.scene.annotationInstance.graphicsCoreWrapper.canvasWrapper.aCanvas.canvasLoopController.level&&this.isPinValue&&(this.updateScreenVecForPan(),this.updatePostTransformation())}updateScreenVecForPan(){this.updateScaleByZoomLevel()}getParentType(){return"APointBase"}distance(e,t){return Math.sqrt((this.vec.x-e)*(this.vec.x-e)+(this.vec.y-t)*(this.vec.y-t))}addEdge(e){-1===this.edges.indexOf(e)&&this.edges.push(e)}removeEdge(e){}activateEasing(e,t){this.scene.annotationInstance.scene.capture=void 0,this.tVec=new p.h9(e.x,e.y,0),this.isAniEasing=!0}easing(){this.isAniEasing&&(this.vec=(0,p.PD)((0,p.bA)(this.vec,.95),(0,p.bA)(this.tVec,.05)),1>(0,p.Sp)(this.vec,this.tVec)&&(this.isAniEasing=!1))}accelerating(){this.vec=(0,p.PD)((0,p.bA)(this.vec,.9),(0,p.bA)(this.tVec,.1)),1>(0,p.Sp)(this.vec,this.tVec)&&(this.isAniEasing=!1),this.renderer.t+=.01}get isPin(){return this.isPinValue}set isPin(e){this.isPinValue=e}remove(){}move(e,t){this.vec.x=e,this.vec.y=t}isMouseInside(e,t){return!this.isRemove&&!!this.isRenderable&&!this.isHiddenValue&&this.distance(e,t)<=this.r*this.scaleForRender+3*this.scaleForRender}deepCopy(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.vec.x,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.vec.y;arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.vec.z;let s=new A(this.scene,e,t,this.vec.z,this.type,this.r);if(s)return s}get v(){return this.vec}set v(e){this.vec=e}get isHover(){return this.isHoverValue}set isHover(e){this.isHoverValue=e}get isSelected(){return this.isSelectedValue}set isSelected(e){this.isSelectedValue=e}getLog(){return"GUID : "+this.id+"/TYPE : "+this.type.toString()+"/Screen : /SIZE : "+this.r+" pixel/CONNE :"+this.edges.length.toString()+"/IsCap :"+this.isCapturedValue+"/IsSEL : "+this.isSelectedValue+"/IsHid : "+this.isHiddenValue+"/IsDeg : "+this.isDrag+"/isSelable : "+this.isSelectable+"/hasTextLeaderline : "+this.textLeaderline}getLogDOM(){return"Geometry ID : "+this.id+'<br>geometry Type : APointBase" <br>position : <br>size : '+this.r+" pixel<br>type : "+this.type+"<br>isSelected : "+this.isSelectedValue+"<br>isSelectable : "+this.isSelectable+"<br>"}goToBlackhole(){this.needBlackhole=!0,this.tVec=this.scene.annotationInstance.renderer.blackhole.v,this.isAniAccel=!0}hide(){this.isSelectable=!1,this.isRenderable=!1}translateByMouseEventData(e){this.isRemove||!this.isRenderable||this.isHiddenValue||this.isGhost||(this.vec.x+=e.x-e.preX,this.vec.y+=e.y-e.preY,this.isDrag=!0,this.textLeaderline&&(this.textLeaderline.translateByMouseEventData(e),this.textLeaderline&&this.textLeaderline.leaderline&&(this.textLeaderline.leaderline.v2.x=this.vec.x,this.textLeaderline.leaderline.v2.y=this.vec.y)),this.updatePostTransformation())}translate(e,t){}getNode(){let e=[];return e.push(this.vec),e}toJSON(){if(this.isGhost||this.type===p.zq.ANODE||this.type===p.zq.ANODE_CIRCLE||this.type===p.zq.AMIDPOINT||this.type===p.zq.AN_GON||this.type===p.zq.ANODE_RECT)return;let e=new g(this.id,this.type,this.isSelectedValue,this.isHoverValue,this.isHiddenValue);this.type===p.zq.POINT_REGULAR&&this.styleComponent.renderStyle.url&&(e.data={url:this.styleComponent.renderStyle.url}),e.pushNode(this.getNode());let t=this.styleComponent.toJson();return t&&(e.styles=t),e}getIOGeometry(){return this.toJSON()}visTrajectory(e,t){this.trajectoryVecs.push(t),this.trajectoryVecs.length>6&&this.trajectoryVecs.shift()}outExtent(){this.isInsideExtent&&(this.hasPopup&&(this.hidePopUpSummary(),this.hasPopupPre=!0),this.isInsideExtent=!1)}inExtent(){this.isInsideExtent||(this.hasPopupPre&&this.showPopupSummary(),this.isInsideExtent=!0)}renderPost(e){}updateDivPos(){}updatePostTransformation(){this.updateBoundingBox()}set disable(e){this.disableValue=e,this.disableValue?this.isSelectedValue=!1:this.isSelectedValue=!0}constructor(e,t=0,s=0,i=0,n=p.zq.APOINT,o=5){super(e),this.isLineNetwork=!1,this.vec=new p.h9(t,s,i),this.trajectoryVecs=[],this.edges=[],this.nodes=[],this.r=o,this.rOrigin=o,this.rTarget=o+10,this.weightLeft=0,this.weightRight=0,this.type=n,this.isMid=!1,this.isGeoPos=!0,this.isPointMid=!1,this.isAniUp=!0,this.hasPopupValue=!1,this.scene.addBasePoint(this),this.isUnderConstruction=!1,this.visTrajector=!0,this.collision.isFixed=!0,this.scaleForRender=1,this.updateBoundingBox(),this.initVecsHistory(),this.initScale(),this.init()}}class f{update(){this.interpolateColor(),this.updateVauleNormalized(),this.host.styleComponent.renderStyle.interpolationNum=this._opacity}updateVauleNormalized(){this.host.scene.annotationInstance.renderer.needFocus?(this._opacity-=this.value,this._opacity=this._opacity<.4?.4:this._opacity):(this._opacity+=this.value,this._opacity=this._opacity>1?1:this._opacity)}interpolateColor(){if(!this.host.scene.annotationInstance.renderer.needFocus||this.host.isHover||this.host.isSelected){if(this.tOpacityA+=this.host.scene.annotationInstance.customization.themeCurrent.properties.timeTransitionA,this.tOpacityB=0,this.value=this.tOpacityA,this.tOpacityA<1){let e=(0,p.Hq)(this.host.styleComponent.renderStyle.colorInterpolated.getArray(),this.host.styleComponent.renderStyle.colorA.getArray(),this.tOpacityA);this.host.styleComponent.renderStyle.colorInterpolated.r=e[0],this.host.styleComponent.renderStyle.colorInterpolated.g=e[1],this.host.styleComponent.renderStyle.colorInterpolated.b=e[2],this.host.styleComponent.renderStyle.colorInterpolated.a=e[3],this.value=this.tOpacityA}}else if(this.tOpacityA=0,this.tOpacityB+=this.host.scene.annotationInstance.customization.themeCurrent.properties.timeTransitionB,this.value=this.tOpacityB,this.tOpacityB<1){let e=(0,p.Hq)(this.host.styleComponent.renderStyle.colorInterpolated.getArray(),this.host.styleComponent.renderStyle.colorB.getArray(),this.tOpacityB);this.host.styleComponent.renderStyle.colorInterpolated.r=e[0],this.host.styleComponent.renderStyle.colorInterpolated.g=e[1],this.host.styleComponent.renderStyle.colorInterpolated.b=e[2],this.host.styleComponent.renderStyle.colorInterpolated.a=e[3],this.value=this.tOpacityB}}get opacity(){return this._opacity}constructor(e){this.value=0,this.tOpacityA=0,this.tOpacityB=0,this._opacity=1,this.host=e,this.host.styleComponent.renderStyle.colorInterpolated&&this.interpolateColor()}}class P{update(){this.host.geo.isDrag?(this.host.tUp+=.5*this.host.geo.scene.annotationInstance.renderer.dt,this.host.tDown2=0):(this.host.geo.isSelectedValue?(this.host.tOver+=this.host.geo.scene.annotationInstance.renderer.dt,this.host.tDown1=0,this.host.geo.isHoverValue?this.host.tOverPopupSummary+=this.incrementTimePopupSummary:this.host.tOverPopupSummary=0,this.host.geo.isLeave=!0):this.host.geo.isHoverValue?(this.host.tOver+=.5*this.host.geo.scene.annotationInstance.renderer.dt,this.host.tOverPopupSummary+=this.incrementTimePopupSummary,this.host.tDown1=0,this.host.geo.isLeave=!0):this.host.geo.isLeave&&!this.host.geo.isDrag?(this.host.tDown1+=this.host.geo.scene.annotationInstance.renderer.dt,this.host.tOver=this.host.tOverPopupSummary=0,this.host.tDown1>.15&&(this.host.geo.isLeave=!1)):this.host.geo.isDrag||(this.host.tDown1+=this.host.geo.scene.annotationInstance.renderer.dt,this.host.tOver=this.host.tOverPopupSummary=0),this.host.tUp=0,this.host.tDown2+=.01),this.host.t+=.01}updatePopupSummery(){this.host.geo.isDrag||(this.host.geo.isSelectedValue?this.host.geo.isHoverValue?this.host.tOverPopupSummary+=this.incrementTimePopupSummary:this.host.tOverPopupSummary=0:this.host.geo.isHoverValue?this.host.tOverPopupSummary+=this.incrementTimePopupSummary:this.host.geo.isLeave&&!this.host.geo.isDrag?(this.host.tOverPopupSummary=0,this.host.tDown1>.15&&(this.host.geo.isLeave=!1)):this.host.geo.isDrag||(this.host.tOverPopupSummary=0))}constructor(e){this.host=e,this.incrementTimePopupSummary=.02}}class x{renderPost(e){}constructor(e){this.t=0,this.tOver=0,this.tOverPopupSummary=0,this.tDown1=0,this.tDown2=0,this.tUp=0,this.geo=e,this.timer=new P(this),this.interpolateColor=new f(this.geo),this.geo.isRenderable=!0}}class w extends x{renderPost(e){if(this.timer.update(),this.host.scaleForRender=this.host.scene.annotationInstance.graphicsCoreWrapper.scaleScreenByRatioImageSize,e.lineCap=p.cg.Butt,this.host.scene.annotationInstance.implementations.app.model.appCoreWrapper.appControllerStatus.mode!==p.An.Drawing||this.host.isUnderConstruction||this.host.type===p.zq.APOINT_PATH)return;this.host.scene.annotationInstance.activeCommandController.acProperties.pressESC&&this.host.isDrag&&(this.host.isDrag=!1);let t=this.host.scene.annotationInstance.geometryCommon.gcmdSupporting.toScreenVecOnCropping(this.host.vec);this.host.type===p.zq.AMIDPOINT?1<this.tOver?this.host.scene.annotationInstance.renderer.draw.shape.node.nodeMidHover(e,this.host.styleComponent.renderStyle,t.x,t.y,this.host.scaleForRender,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(2*this.tOver),this.host.isSelectedSole):this.host.isHoverValue||this.host.isSelectedValue?this.host.scene.annotationInstance.renderer.draw.shape.node.nodeMidHover(e,this.host.styleComponent.renderStyle,t.x,t.y,this.host.scaleForRender,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(2*this.tOver),this.host.isSelectedSole):this.host.edges[0]&&(this.host.edges[0].type===p.zq.ARROW_SINGLE||this.host.edges[0].type===p.zq.ARROW_DOUBLE)&&this.host.scene.annotationInstance.renderer.draw.shape.node.nodeMidHoverForArrow(e,this.host.styleComponent.renderStyle,t.x,t.y,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(2*this.tOver),this.geo.scene.annotationInstance.customization.themeCurrent.node.sizeMid*this.host.scaleForRender,this.host.isSelectedSole,this.host.edges[0].styleComponent.state.themeColorId):1<this.tOver?this.host.isHoverValue||this.host.isSelectedValue?this.host.scene.annotationInstance.renderer.draw.shape.node.nodeHover(e,this.host.styleComponent.renderStyle,t.x,t.y,this.host.scaleForRender,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(2*this.tOver)):this.host.scene.annotationInstance.renderer.draw.shape.node.node(e,this.host.styleComponent.renderStyle,t.x,t.y,this.host.scaleForRender):this.host.edges[0]&&(this.host.edges[0].type===p.zq.ARROW_SINGLE||this.host.edges[0].type===p.zq.ARROW_DOUBLE)?this.host.scene.annotationInstance.renderer.draw.shape.node.nodeStart(e,this.host.styleComponent.renderStyle,t.x,t.y,this.host.scaleForRender,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(2*this.tOver),this.host.edges[0].styleComponent.state.themeColorId):this.host.scene.annotationInstance.renderer.draw.shape.node.nodeStart(e,this.host.styleComponent.renderStyle,t.x,t.y,this.host.scaleForRender,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(2*this.tOver)),this.host.isSelectedSole&&this.host.type===p.zq.ANODE?(this.host.scene.annotationInstance.renderer.draw.shape.node.nodeSelected(e,this.host.styleComponent.renderStyle,t.x,t.y,this.host.scaleForRender),this.host.tSelectedSole+=.01):this.host.tSelectedSole=0,this.t+=this.host.scene.annotationInstance.renderer.dt}constructor(e){super(e),this.host=e}}(i=a||(a={})).Small="small",i.Large="large",i.Continuous="continuous",(n=h||(h={})).ThemeColor1="themeColor1",n.ThemeColor2="themeColor2",n.ThemeColor3="themeColor3",n.BackgroundColor="backgroundColor",n.TitleColor="titleColor",n.AccentColor1="accentColor1";let I=e=>{switch(e){case"large":return[8,4];case"small":return[4,4];case"continuous":return[0,0];default:return[]}};class R{static fromHex(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=(0,p.rW)(e,t);return new R(s[0],s[1],s[2],s[3])}static fromRGBA(e,t,s){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return new R(e,t,s,i)}static toHex(e){return(0,p.iC)(e.r,e.g,e.b)}updateByRGBA(e,t,s){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this._r=e,this._g=t,this._b=s,this._a=i,this.updateString()}get r(){return this._r}set r(e){this._r=e,this.updateString()}get g(){return this._g}set g(e){this._g=e,this.updateString()}get b(){return this._b}set b(e){this._b=e,this.updateString()}get a(){return this._a}set a(e){this._a=e,this.updateString()}normaliz(){return this.r/=255,this.g/=255,this.b/=255,this}deepCopy(){return new R(this._r,this._g,this._b,this._a)}getArray(){return[this._r,this._g,this._b,this._a]}toRBGA_String(){return this.rgnaStringValue}updateString(){this.rgnaStringValue="rgba(".concat(this._r,", ").concat(this._g,", ").concat(this._b,", ").concat(this._a,")")}constructor(e,t,s,i=1){this.updateByRGBA(e,t,s,i)}}class b{static updateRenderStyleRPoint(e,t){let s=t.rPoint;e._colorFillFirst.updateByRGBA(s.fillStyleFirstArray[0],s.fillStyleFirstArray[1],s.fillStyleFirstArray[2],s.fillStyleFirstArray[3]),e._colorFillSecond.updateByRGBA(s.fillStyleSecondArray[0],t.rPoint.fillStyleSecondArray[1],t.rPoint.fillStyleSecondArray[2],t.rPoint.fillStyleSecondArray[3]),e._lineWidth=t.rPoint.lineWidth,e.width=t.rPoint.width,e.height=t.rPoint.height,e.initInterpolation(t.properties.desaturationValue)}static updateRenderColorRPointCustom(e,t,s){e._colorFillFirst.updateByRGBA(s[0],s[1],s[2],s[3]),e._colorFillSecond.updateByRGBA(s[0],s[1],s[2],t.properties.opacity),e._lineWidth=t.rPoint.lineWidth,e.width=t.rPoint.width,e.height=t.rPoint.height,e.initInterpolation(t.properties.desaturationValue)}static updateRenderStyleNPoint(e,t){let s=t.nPoint;e._colorFillFirst.updateByRGBA(s.fillStyleFirstArray[0],s.fillStyleFirstArray[1],s.fillStyleFirstArray[2],s.fillStyleFirstArray[3]),e._colorFillSecond.updateByRGBA(s.fillStyleSecondArray[0],s.fillStyleSecondArray[1],s.fillStyleSecondArray[2],s.fillStyleSecondArray[3]),e._lineWidth=t.nPoint.lineWidth,e.width=t.nPoint.width,e.height=t.nPoint.height,e.initInterpolation(t.properties.desaturationValue)}static updateRenderColorNPoint(e,t,s){e._colorFillFirst.updateByRGBA(s[0],s[1],s[2],s[3]),e._colorFillSecond.updateByRGBA(s[0],s[1],s[2],t.properties.opacity+.5),e.initInterpolation(t.properties.desaturationValue)}static updateRenderStylePolyline(e,t){let s=t.polyline;e._colorStrokeFirst.updateByRGBA(s.strokeStyleFirstArray[0],s.strokeStyleFirstArray[1],s.strokeStyleFirstArray[2],s.strokeStyleFirstArray[3]),e._colorStrokeSecond.updateByRGBA(s.strokeStyleSecondArray[0],s.strokeStyleSecondArray[1],s.strokeStyleSecondArray[2],s.strokeStyleSecondArray[3]),e._lineWidth=t.polyline.lineWidth,e.initInterpolationStroke(t.properties.desaturationValue)}static updateRenderColorPolyline(e,t,s){e._colorStrokeFirst.updateByRGBA(s[0],s[1],s[2],s[3]),e._colorStrokeSecond.updateByRGBA(s[0],s[1],s[2],t.properties.opacity+.5),e._lineWidth=t.polyline.lineWidth,e.initInterpolationStroke(t.properties.desaturationValue)}static updateRenderStylePolylineNode(e,t){let s=t.polyline;e._colorStrokeFirst.updateByRGBA(s.strokeStyleFirstArray[0],s.strokeStyleFirstArray[1],s.strokeStyleFirstArray[2],s.strokeStyleFirstArray[3]),e._colorStrokeSecond.updateByRGBA(s.strokeStyleSecondArray[0],s.strokeStyleSecondArray[1],s.strokeStyleSecondArray[2],s.strokeStyleSecondArray[3]),e._lineWidth=t.polyline.lineWidth,t.properties.isDarkBG?e._colorFillFirst.updateByRGBA(0,0,0,1):e._colorFillFirst.updateByRGBA(255,255,255,1),e.initInterpolation(t.properties.desaturationValue)}static updateRenderColorPolylineNode(e,t,s){e._colorStrokeFirst.updateByRGBA(s[0],s[1],s[2],s[3]),e._colorStrokeSecond.updateByRGBA(s[0],s[1],s[2],t.properties.opacity+.5),e._lineWidth=t.polyline.lineWidth,t.properties.isDarkBG?e._colorFillFirst.updateByRGBA(0,0,0,1):e._colorFillFirst.updateByRGBA(255,255,255,1),e.initInterpolation(t.properties.desaturationValue)}static updateRenderStylePolylineCustom(e,t,s){e._colorStrokeFirst.updateByRGBA(s[0],s[1],s[2],s[3]),e._colorStrokeSecond.updateByRGBA(s[0],s[1],s[2],t.properties.opacity),e._lineWidth=t.polyline.lineWidth,e.initInterpolationStroke(t.properties.desaturationValue)}static updateRenderStylePolylineNodeCustom(e,t,s){e._colorStrokeFirst.updateByRGBA(s[0],s[1],s[2],s[3]),e._colorStrokeSecond.updateByRGBA(s[0],s[1],s[2],t.properties.opacity),e._lineWidth=t.polyline.lineWidth,t.properties.isDarkBG?e._colorFillFirst.updateByRGBA(0,0,0,1):e._colorFillFirst.updateByRGBA(255,255,255,1),e.initInterpolation(t.properties.desaturationValue)}static updateRenderStyleArrow(e,t){let s=t.arrow;e._colorFillFirst.updateByRGBA(s.fillStyleFirstArray[0],s.fillStyleFirstArray[1],s.fillStyleFirstArray[2],s.fillStyleFirstArray[3]),e._colorFillSecond.updateByRGBA(s.fillStyleSecondArray[0],s.fillStyleSecondArray[1],s.fillStyleSecondArray[2],s.fillStyleSecondArray[3]),e._colorStrokeFirst.updateByRGBA(s.strokeStyleFirstArray[0],s.strokeStyleFirstArray[1],s.strokeStyleFirstArray[2],s.strokeStyleFirstArray[3]),e._colorStrokeSecond.updateByRGBA(s.strokeStyleSecondArray[0],s.strokeStyleSecondArray[1],s.strokeStyleSecondArray[2],s.strokeStyleSecondArray[3]),e._lineWidth=s.lineWidth,e.initInterpolationStroke(t.properties.desaturationValue)}static updateRenderStyleArrowNode(e,t){let s=t.arrow;e._colorStrokeFirst.updateByRGBA(s.strokeStyleFirstArray[0],s.strokeStyleFirstArray[1],s.strokeStyleFirstArray[2],s.strokeStyleFirstArray[3]),e._colorStrokeSecond.updateByRGBA(s.strokeStyleSecondArray[0],s.strokeStyleSecondArray[1],s.strokeStyleSecondArray[2],s.strokeStyleSecondArray[3]),e._lineWidth=s.lineWidth,t.properties.isDarkBG?e._colorFillFirst.updateByRGBA(0,0,0,1):e._colorFillFirst.updateByRGBA(255,255,255,1),e.initInterpolation(t.properties.desaturationValue)}static updateRenderStyleArrowCustom(e,t,s){let i=s.colorRgba;e._colorFillFirst.updateByRGBA(i[0],i[1],i[2],i[3]),e._colorFillSecond.updateByRGBA(i[0],i[1],i[2],t.properties.opacity+.5),e._colorStrokeFirst.updateByRGBA(i[0],i[1],i[2],i[3]),e._colorStrokeSecond.updateByRGBA(i[0],i[1],i[2],t.properties.opacity),e._lineWidth=s.width,e.initInterpolationStroke(t.properties.desaturationValue)}static updateRenderColorArrowCustom(e,t,s){e._colorFillFirst.updateByRGBA(s[0],s[1],s[2],s[3]),e._colorFillSecond.updateByRGBA(s[0],s[1],s[2],t.properties.opacity+.5),e._colorStrokeFirst.updateByRGBA(s[0],s[1],s[2],s[3]),e._colorStrokeSecond.updateByRGBA(s[0],s[1],s[2],t.properties.opacity),e._lineWidth=t.arrow.lineWidth,e.initInterpolationStroke(t.properties.desaturationValue)}static updateRenderStyleArrowNodeCustom(e,t,s){let i=s.colorRgba;e._colorStrokeFirst.updateByRGBA(i[0],i[1],i[2],i[3]),e._colorStrokeSecond.updateByRGBA(i[0],i[1],i[2],i[3]),e._lineWidth=s.width,t.properties.isDarkBG?e._colorFillFirst.updateByRGBA(0,0,0,1):e._colorFillFirst.updateByRGBA(255,255,255,1),e.initInterpolation(t.properties.desaturationValue)}static updateRenderColorArrowNodeCustom(e,t,s){e._colorStrokeFirst.updateByRGBA(s[0],s[1],s[2],s[3]),e._colorStrokeSecond.updateByRGBA(s[0],s[1],s[2],s[3]),t.properties.isDarkBG?e._colorFillFirst.updateByRGBA(0,0,0,1):e._colorFillFirst.updateByRGBA(255,255,255,1),e.initInterpolation(t.properties.desaturationValue)}static updateRenderStylePolygon(e,t){let s=t.polygon;e._colorFillFirst.updateByRGBA(s.fillStyleFirstArray[0],s.fillStyleFirstArray[1],s.fillStyleFirstArray[2],s.fillStyleFirstArray[3]),e._colorFillSecond.updateByRGBA(s.fillStyleSecondArray[0],s.fillStyleSecondArray[1],s.fillStyleSecondArray[2],s.fillStyleSecondArray[3]),e._colorStrokeFirst.updateByRGBA(s.strokeStyleFirstArray[0],s.strokeStyleFirstArray[1],s.strokeStyleFirstArray[2],s.strokeStyleFirstArray[3]),e._colorStrokeSecond.updateByRGBA(s.strokeStyleSecondArray[0],s.strokeStyleSecondArray[1],s.strokeStyleSecondArray[2],s.strokeStyleSecondArray[3]),e._lineWidth=s.lineWidth,e.initInterpolation(t.properties.desaturationValue)}static updateRenderColorPolygon(e,t,s,i){e._colorFillFirst.updateByRGBA(i[0],i[1],i[2],i[3]),e._colorFillSecond.updateByRGBA(i[0],i[1],i[2],t.properties.opacity+.5),e._colorStrokeFirst.updateByRGBA(s[0],s[1],s[2],s[3]),e._colorStrokeSecond.updateByRGBA(s[0],s[1],s[2],t.properties.opacity+.5),e._lineWidth=t.polygon.lineWidth,e.initInterpolation(t.properties.desaturationValue)}static updateRenderStylePolygonNode(e,t){let s=t.polygon;e._colorStrokeFirst.updateByRGBA(s.strokeStyleFirstArray[0],s.strokeStyleFirstArray[1],s.strokeStyleFirstArray[2],s.strokeStyleFirstArray[3]),e._colorStrokeSecond.updateByRGBA(s.strokeStyleSecondArray[0],s.strokeStyleSecondArray[1],s.strokeStyleSecondArray[2],s.strokeStyleSecondArray[3]),e._lineWidth=s.lineWidth,t.properties.isDarkBG?e._colorFillFirst.updateByRGBA(0,0,0,1):e._colorFillFirst.updateByRGBA(255,255,255,1),e.initInterpolation(t.properties.desaturationValue)}static updateRenderColorPolygonNode(e,t,s){e._colorStrokeFirst.updateByRGBA(s[0],s[1],s[2],s[3]),e._colorStrokeSecond.updateByRGBA(s[0],s[1],s[2],t.properties.opacity+.5),t.properties.isDarkBG?e._colorFillFirst.updateByRGBA(0,0,0,1):e._colorFillFirst.updateByRGBA(255,255,255,1),e.initInterpolation(t.properties.desaturationValue)}static updateRenderStylePolygonCustom(e,t,s,i){let n=t.polygon;e._colorFillFirst.updateByRGBA(i[0],i[1],i[2],i[3]),i[3]-t.properties.opacity>0?e._colorFillSecond.updateByRGBA(i[0],i[1],i[2],i[3]-t.properties.opacity):e._colorFillSecond.updateByRGBA(i[0],i[1],i[2],.3),e._colorStrokeFirst.updateByRGBA(s[0],s[1],s[2],s[3]),e._colorStrokeSecond.updateByRGBA(s[0],s[1],s[2],t.properties.opacity),e._lineWidth=n.lineWidth,e.initInterpolation(t.properties.desaturationValue)}static updateRenderStylePolygonNodeCustom(e,t,s,i){let n=t.polygon;e._colorStrokeFirst.updateByRGBA(s[0],s[1],s[2],s[3]),e._colorStrokeSecond.updateByRGBA(s[0],s[1],s[2],t.properties.opacity),e._lineWidth=n.lineWidth,t.properties.isDarkBG?e._colorFillFirst.updateByRGBA(0,0,0,1):e._colorFillFirst.updateByRGBA(255,255,255,1),e.initInterpolation(t.properties.desaturationValue)}static updateRenderStyleFH(e,t){let s=t.freehand;e._colorFillFirst.updateByRGBA(s.fillStyleFirstArray[0],s.fillStyleFirstArray[1],s.fillStyleFirstArray[2],s.fillStyleFirstArray[3]),e._colorStrokeFirst.updateByRGBA(s.strokeStyleFirstArray[0],s.strokeStyleFirstArray[1],s.strokeStyleFirstArray[2],s.strokeStyleFirstArray[3]),e._lineWidth=s.lineWidth,e.initInterpolation(t.properties.desaturationValue)}static updateRenderStyleFHPolyline(e,t){let s=t.polyline,i=t.properties.opacity;e._colorStrokeFirst.updateByRGBA(s.strokeStyleFirstArray[0],s.strokeStyleFirstArray[1],s.strokeStyleFirstArray[2],i),e._colorStrokeSecond.updateByRGBA(s.strokeStyleSecondArray[0],s.strokeStyleSecondArray[1],s.strokeStyleSecondArray[2],i),e._lineWidth=t.polyline.lineWidth,e.initInterpolation(t.properties.desaturationValue)}static updateRenderStyleFHPolylineNode(e,t){let s=t.polyline,i=t.properties.opacity;e._colorStrokeFirst.updateByRGBA(s.strokeStyleFirstArray[0],s.strokeStyleFirstArray[1],s.strokeStyleFirstArray[2],i),e._colorStrokeSecond.updateByRGBA(s.strokeStyleSecondArray[0],s.strokeStyleSecondArray[1],s.strokeStyleSecondArray[2],i),e._lineWidth=t.polyline.lineWidth,t.properties.isDarkBG?e._colorFillFirst.updateByRGBA(0,0,0,i):e._colorFillFirst.updateByRGBA(255,255,255,i),e.initInterpolation(t.properties.desaturationValue)}static updateRenderStyleFHPolygon(e,t){let s=t.polygon,i=t.properties.opacity;e._colorFillFirst.updateByRGBA(s.fillStyleFirstArray[0],s.fillStyleFirstArray[1],s.fillStyleFirstArray[2],i),e._colorFillSecond.updateByRGBA(s.fillStyleSecondArray[0],s.fillStyleSecondArray[1],s.fillStyleSecondArray[2],i),e._colorStrokeFirst.updateByRGBA(s.strokeStyleFirstArray[0],s.strokeStyleFirstArray[1],s.strokeStyleFirstArray[2],i),e._colorStrokeSecond.updateByRGBA(s.strokeStyleSecondArray[0],s.strokeStyleSecondArray[1],s.strokeStyleSecondArray[2],i),e._lineWidth=s.lineWidth,e.initInterpolation(t.properties.desaturationValue)}static updateRenderStyleFHPolygonNode(e,t){let s=t.polygon,i=t.properties.opacity;e._colorStrokeFirst.updateByRGBA(s.strokeStyleFirstArray[0],s.strokeStyleFirstArray[1],s.strokeStyleFirstArray[2],i),e._colorStrokeSecond.updateByRGBA(s.strokeStyleSecondArray[0],s.strokeStyleSecondArray[1],s.strokeStyleSecondArray[2],i),e._lineWidth=s.lineWidth,t.properties.isDarkBG?e._colorFillFirst.updateByRGBA(0,0,0,i):e._colorFillFirst.updateByRGBA(255,255,255,i),e.initInterpolation(t.properties.desaturationValue)}static shiftNodeStyle(e,t){t._colorFillFirst=e._colorStrokeFirst.deepCopy(),t._colorStrokeFirst=e._colorFillFirst.deepCopy()}static shiftNodeStyleCustom(e,t){t._colorFillFirst=e._colorStrokeFirst.deepCopy(),t._colorStrokeFirst=e._colorFillFirst.deepCopy()}static deepCopy(e,t){t._colorFillFirst=e._colorFillFirst.deepCopy(),t._colorFillSecond=e._colorFillSecond.deepCopy(),t._colorStrokeFirst=e._colorStrokeFirst.deepCopy(),t._colorStrokeSecond=e._colorStrokeSecond.deepCopy(),t._lineCap=e._lineCap,t._lineWidth=e._lineWidth}initInterpolation(e){this.colorInterpolated=this._colorFillFirst.deepCopy(),this.colorA=this._colorFillFirst.deepCopy(),this.colorB=this._colorFillSecond.deepCopy();let t=(0,p.AJ)([this.colorB.r,this.colorB.g,this.colorB.b,this.colorB.a],0,e,0);this.colorB.r=t[0],this.colorB.g=t[1],this.colorB.b=t[2],this.colorB.a=t[3]}initInterpolationStroke(e){this.colorInterpolated=this._colorStrokeFirst.deepCopy(),this.colorA=this._colorStrokeFirst.deepCopy(),this.colorB=this._colorStrokeSecond.deepCopy();let t=(0,p.AJ)([this.colorB.r,this.colorB.g,this.colorB.b,this.colorB.a],0,e,0);this.colorB.r=t[0],this.colorB.g=t[1],this.colorB.b=t[2],this.colorB.a=t[3]}get colorInterpolatedString(){return this.colorInterpolated.toRBGA_String()}get colorFill(){return this._colorFillFirst.toRBGA_String()}get colorFillHover(){return this._colorFillSecond.toRBGA_String()}get colorStroke(){return this._colorStrokeFirst.toRBGA_String()}get colorStrokeHover(){return this._colorStrokeSecond.toRBGA_String()}get lineWidth(){return this._lineWidth}get lineCap(){return this._lineCap}get dash(){return this._dash}set dash(e){this._dash=e}get url(){return this._url}set url(e){this._url=e,this.styleComponent.geo.scene.annotationInstance.customization.iconAsset.addIcon(e)}get size(){return this._size}set size(e){this._size=e}constructor(e){this.width=32,this.height=32,this.scaleLocal=1,this.scaleGlobal=1,this._url=void 0,this._lineCap=p.cg.Round,this._dash=[],this._size=p.$u.MEDIUM,e&&(this.styleComponent=e,this.scaleGlobal=e.geo.scene.annotationInstance.activeCommandController.scaleGlobal),this._colorFillFirst=new R(0,0,0),this._colorFillSecond=new R(0,0,0),this._colorStrokeFirst=new R(0,0,0),this._colorStrokeSecond=new R(0,0,0),this._lineWidth=3}}class L{constructor(){this.scale=1,this.width=2,this.themeColorId=h.TitleColor,this.lineTypeId=a.Continuous}}class O{updateColor(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]}updateStyle(){}updateStyleCustom(e){return!1}setDash(e){}toJson(){}isSameStyle(e){return!1}constructor(e){this.isCustom=!1,this.tempColorRgba=[0,0,0,0],this.tempFillRgba=[0,0,0,0],this.geo=e,this.state=new L,this.renderStyle=new b,this.renderStyleNode=new b}}class V extends O{updateStyle(){}updateStyleForNode(e){this.renderStyle=e,b.deepCopy(e,this.renderStyleOrigin),b.shiftNodeStyle(e,this.renderStyleOpposite)}shiftNodeStyle(e){e?this.renderStyle=this.renderStyleOpposite:this.renderStyle=this.renderStyleOrigin}constructor(e){super(e),this.renderStyle=new b,this.renderStyleNode=new b,this.renderStyleOrigin=new b,this.renderStyleOpposite=new b,this.updateStyle()}}class N{update(e){this.host.scene.annotationInstance.implementations.app.INSPECTION&&this.showStatus(e)}show(e){let t=this.host.vec;e.beginPath(),e.arc(t.x,t.y,5,0,6.28),e.closePath(),e.fillStyle="#ff0000",e.fill(),e.fillText("0",t.x,t.y-5),t=this.host.vec,e.beginPath(),e.arc(t.x,t.y,5,0,6.28),e.closePath(),e.fillStyle="#ff0000",e.fill(),e.fillText("0",t.x,t.y+10)}showStatus(e){let t=this.host.vec;e.beginPath(),e.arc(t.x,t.y,5,0,6.28),e.closePath(),e.fillStyle="#ff0000",e.fill();let s="IsTransform: ".concat(this.host.isTransform);e.fillText(s,t.x+10,t.y+10);let i="Type: ".concat(this.host.type);e.fillText(i,t.x+100,t.y+10)}constructor(e){this.host=e}}class k extends A{static computeAllLineNetworkSnap(e){for(let t=0;t<e.listAPoint.length-1;++t)for(let s=t+1;s<e.listAPoint.length;++s)5>(0,p.Sp)(e.listAPoint[t].vec,e.listAPoint[s].vec)&&(e.listAPoint[s].vec=e.listAPoint[t].vec)}static computeLineNetworkSnap(e){}static getVecs(e){let t=[],s=e.length;for(;s--;)t.push(e[s].vec);return t}static getIndexFromParent(e){let t=e.edges[0];return t.pts[0]===e?0:t.pts[1]===e?1:t.pts[2]===e?2:t.pts[3]===e?3:-1}static findAtPoint(e,t,s){for(let i=e.listAPoint.length-1;i>=0;--i)if(e.listAPoint[i].isSelectable&&e.listAPoint[i].isMouseInside(t,s))return e.listAPoint[i]}static removeAllCapturedGeo(e){let t=e.listAPoint;for(let s=0;s<t.length;++s)!0===e.listAPoint[s].isSelectedValue&&e.listAPoint[s].remove()}static DeSelecteCaptureObjects(e){for(let t=0;t<e.listAPoint.length;++t)e.listAPoint[t].isSelectedValue=!1}static moveSelectedGeo(e,t){for(let s=0;s<e.listAPoint.length;++s)!0!==e.listAPoint[s].isSelectedValue||e.listAPoint[s].isHoverValue||e.listAPoint[s].translateByMouseEventData(t),!0===e.listAPoint[s].isHoverValue&&e.listAPoint[s].translateByMouseEventData(t)}static getNodeFromScreenPos(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];arguments.length>3&&void 0!==arguments[3]&&arguments[3];let i=new k(e,t.x,t.y,t.z,s);return i.vec.w=t.w,i.weightLeft=t.w,i.weightRight=t.w,i.isUnderConstruction=!1,i}static getNodeFromJSON(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];arguments.length>3&&void 0!==arguments[3]&&arguments[3];let i=new k(e,t.sx,t.sy,0,s);return i.isUnderConstruction=!1,i}static getNodeFromVec(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return k.getNodeFromScreenPos(e,t,s,i)}static fromJSON(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],new k(e,t.nodes[0].sx,t.nodes[0].sy,0).type=p.zq[t.type]}static mouseRightClick(e){}static mouseMiddleClick(e){}static mouseLeftClick(e,t){void 0!==e.capture||new k(e,t.x,t.y,0).dummy()}init(){this.isPointMid=!1}initComponent(){this.styleComponent=new V(this),this.renderer=new w(this)}getParentType(){return"APoint"}addEdge(e){-1===this.edges.indexOf(e)&&(this.type=p.zq.ANODE,this.edges.push(e),this.edges[0]&&this.styleComponent.updateStyleForNode(this.edges[0].styleComponent.renderStyleNode))}addNode(e){-1===this.nodes.indexOf(e)&&(e.type=p.zq.ANODE,this.nodes.push(e))}getSharedNode(e){for(let t of this.edges){let s=(0,p.Sp)(t.p0.vec,e.vec);if(s<.01)return t.p0;if((s=(0,p.Sp)(t.p1.vec,e.vec))<.01)return t.p1}}removeEdge(e){this.edges.splice(this.edges.indexOf(e),1)}removeAPolylineEdge(e){this.aEdges.splice(this.aEdges.indexOf(e),1)}activateEasing(e,t){this.scene.capture=void 0,this.tVec=new p.h9(e.x,e.y,0),this.isAniEasing=!0}makeUnique(){for(let e of this.edges)e.p0.id===this.id&&(e.p0.vec=new p.h9(this.vec.x,this.vec.y,this.vec.z)),e.p1.id===this.id&&(e.p1.vec=new p.h9(this.vec.x,this.vec.y,this.vec.z))}easing(){this.isAniEasing&&(this.vec=(0,p.PD)((0,p.bA)(this.vec,.95),(0,p.bA)(this.tVec,.05)),1>(0,p.Sp)(this.vec,this.tVec)&&(this.isAniEasing=!1))}accelerating(){this.vec=(0,p.PD)((0,p.bA)(this.vec,.9),(0,p.bA)(this.tVec,.1)),1.5>(0,p.Sp)(this.vec,this.tVec)&&(this.isRenderable=!1,this.isAniEasing=!1),this.renderer.t+=.01}move(e,t){this.isRemove||!this.isRenderable||this.isHiddenValue||(this.vec.x=e,this.vec.y=t)}add_AEdge(e){this.aEdges.push(e),this.aEdges[0]&&this.styleComponent.updateStyleForNode(this.aEdges[0].pGraph.styleComponent.renderStyleNode),this.isConnected=!0}get v(){return this.vec}set v(e){this.vec=e}get isHover(){return this.isHoverValue}set isHover(e){this.edges[0]&&this.edges[0].type===p.zq.POLYLINE_BENDING&&this.isMouseInside(this.scene.annotationInstance.activeCommandController.m.x,this.scene.annotationInstance.activeCommandController.m.y)&&this.renderer.tOver>.9&&(this.renderer.tOver=0),this.isHoverValue=e}get isSelected(){return this.isSelectedValue}set isSelected(e){this.isSelectedValue=e,e||(this.isSelectedSole=e)}get isSelectedSole(){return this._isSelectedSole}set isSelectedSole(e){this._isSelectedSole=e,this.styleComponent.shiftNodeStyle(e)}showPopupSummary(){this.edges[0]&&this.edges[0].showPopupSummary()}hidePopUpSummary(){this.edges[0]&&this.edges[0].hidePopUpSummary()}isMouseInside(e,t){return!!this.edges[0]&&this.distance(e,t)<=this.r+9*this.scene.annotationInstance.activeCommandController.scaleGlobal&&((this.edges[0].type===p.zq.CIRCLE||this.edges[0].type===p.zq.RECTANGLE)&&(this.scene.capturePT=this),!0)}mergeTwoEdge(){if(this.aEdges.length>1){let e,t;if(e=this.aEdges[0].p0===this?this.aEdges[0].p1:this.aEdges[0].p0,this.aEdges[0].pm.deepRemove(),t=this.aEdges[1].p0===this?this.aEdges[1].p1:this.aEdges[1].p0,this.aEdges[1].pm.deepRemove(),e&&t){e.removeAPolylineEdge(this.aEdges[0]),t.removeAPolylineEdge(this.aEdges[1]);let s=this.aEdges[0].pGraph.addEdge(e,t);this.aEdges[0].pGraph.edges.push(s),s.pGraph.removeEdge(this.aEdges[0]),s.pGraph.removeEdge(this.aEdges[1]),s.pGraph.checkMinPt(),s.pGraph.computeCenterVec(),s.pGraph.initVecsHistory()}}else this.aEdges[0].pm.remove(),this.aEdges[0].pGraph.removeEdge(this.aEdges[0])}remove(){if(!this.isRemove){if(this.popup&&this.hidePopUpSummary(),this.aEdges[0]){if(this.type===p.zq.ANODE&&this.aEdges.length>0&&!this.isRemove){if(this.scene.annotationInstance.activeCommandController.acProperties.pressKey&&this.aEdges[0].pGraph){if(3===this.aEdges[0].pGraph.getVecs().length)this.aEdges[0].p0!==this&&this.aEdges[0].p0.deepRemove(),this.aEdges[0].p1!==this&&this.aEdges[0].p1.deepRemove(),this.deepRemove(),this.aEdges[0].pGraph.remove(!0),this.aEdges[0].pGraph.deepRemove();else{this.aEdges[0].pGraph.remove(!1);let e=this.aEdges[0].pGraph.toJSON();e&&this.scene.annotationInstance.io.eventListenerAnnotation.transformStack([e])}}return}if(this.type===p.zq.AMIDPOINT&&this.aEdges.length>0&&!this.isRemove){if(this.scene.annotationInstance.activeCommandController.acProperties.pressKey&&(this.isRemove=!0,this.aEdges[0].pGraph)){this.aEdges[0].pGraph.remove();let e=this.aEdges[0].pGraph.toJSON();e&&this.scene.annotationInstance.io.eventListenerAnnotation.transformStack([e])}return}}if(this.edges[0]){if(this.type===p.zq.ANODE&&this.edges.length>0&&!this.isRemove&&!this.edges[0].isUnderConstruction){this.isRemove=!0,this.edges[0].remove();let e=this.edges[0].toJSON();e&&this.scene.annotationInstance.io.eventListenerAnnotation.transformStack([e]);return}if((this.type===p.zq.ANODE||this.type===p.zq.AMIDPOINT)&&this.edges.length>0&&(this.edges[0].type===p.zq.ARROW_SINGLE||this.edges[0].type===p.zq.ARROW_DOUBLE)){if(this.isRemove=!0,this.edges[0]){this.edges[0].remove();let e=this.edges[0].toJSON();e&&this.scene.annotationInstance.io.eventListenerAnnotation.transformStack([e])}return}}this.deepRemove()}}deepRemove(){this.isRemove||(this.textLeaderline&&(this.textLeaderline.removeByAttachedShape(),this.textLeaderline=void 0),this.isSelectable=!1,this.isRenderable=!1,this.isRemove=!0,this.scene.removeBasePoint(this),this.scene.removeAPoint(this),this.scene.removeGeometry(this))}goToBlackhole(){this.isSelectable=!1,this.tVec=this.scene.annotationInstance.renderer.blackhole.v,this.isAniAccel=!0}hide(){this.isSelectable=!1,this.isRenderable=!1}translateByMouseEventData(e){if(this.type!==p.zq.ANODE_RECT&&this.type!==p.zq.ANODE_CIRCLE&&!this.isRemove&&this.isRenderable&&!this.isHiddenValue){if(this.textLeaderline&&this.textLeaderline.translateByMouseEventData(e),this.aEdges.length>0){this.translateForCurvedPolyline(e);return}if(this.type===p.zq.AMIDPOINT_ALINE){this.translateForLineMidPoint(e);return}if(this.scene.annotationInstance.activeCommandController.acProperties.pressCtrlKey?this.splitPointbyNewVec(e.x,e.y):(this.vec.x=e.x,this.vec.y=e.y,this.isDrag=!0),this.type===p.zq.ANODE&&this.edges[0]&&this.edges[0].type===p.zq.POLYGON||this.edges[0].type===p.zq.ARROW_SINGLE||this.edges[0].type===p.zq.ARROW_DOUBLE||this.edges[0].type===p.zq.CURVE_OPEN||this.edges[0].type===p.zq.CURVE_CLOSE||this.edges[0].type===p.zq.ALINE)return}}translate(e,t){}splitPointbyNewVec(e,t){let s=this.scene.listAPoint;for(let i=0;i<s.length;++i)5>(0,p.Sp)(s[i].vec,this.vec)&&(this.vec=new p.h9(e,t),this.scene.Capture=s[i],this.scene.annotationInstance.activeCommandController.acProperties.pressCtrlKey=!1)}mouseLeftClick(){if(this.aEdges.length>0){if(!this.scene.annotationInstance.activeCommandController.acProperties.pressShift){let e=this.aEdges[0];for(let t=0;t<e.pGraph.edges.length;++t)e.pGraph.edges[t].p0!==this&&e.pGraph.edges[t].p0.isSelectedSole&&(e.pGraph.edges[t].p0.isSelectedSole=!1),e.pGraph.edges[t].p1!==this&&e.pGraph.edges[t].p1.isSelectedSole&&(e.pGraph.edges[t].p1.isSelectedSole=!1),e.pGraph.edges[t].pm!==this&&e.pGraph.edges[t].pm.isSelectedSole&&(e.pGraph.edges[t].pm.isSelectedSole=!1)}this.isSelectedSole=!this.isSelectedSole,this.aEdges[0].pGraph.isSelected=!0;return}if(this.edges.length>0){if(this.edges[0].type===p.zq.ARROW_SINGLE||this.edges[0].type===p.zq.ARROW_DOUBLE){this.isSelected=!1,this.edges[0].isSelected=!this.edges[0].isSelected;return}if(!this.scene.annotationInstance.activeCommandController.acProperties.pressShift){let e=this.edges[0];for(let t=0;t<e.pts.length;++t)e.pts[t]!==this&&e.pts[t].isSelectedSole&&(e.pts[t].isSelectedSole=!1)}this.isSelectedSole=!this.isSelectedSole,this.edges[0].isSelected=!0;return}}translateForLineMidPoint(e){}splitMidPointbyNewVec(e,t){}translateForCurvedPolyline(e){if(this.vec.x+=e.x-e.preX,this.vec.y+=e.y-e.preY,this.isDrag=!0,this.type===p.zq.AMIDPOINT){if(this.scene.annotationInstance.activeCommandController.acProperties.pressCtrlKey)this.aEdges[0].checkIsCurved();else{let e=this.aEdges[0].splitEdge(this);e&&(e.isSelected=!1,this.scene.Capture=e)}}else for(let t=0;t<this.aEdges.length;++t)this.aEdges[t].moveMidPt(e)}deepCopy(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.vec.x,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.vec.y;if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.vec.z,this.type===p.zq.AMIDPOINT||this.type===p.zq.ANODE)return;let s=new k(this.scene,e,t,this.vec.z,!1,this.type,this.r);if(s)return s}mouseRightClick(e){}renderPost(e){this.inspector.update(e),this.renderer.renderPost(e)}mouseUp(){}textLeaderlinePost(e){return(this.type===p.zq.ANODE_CIRCLE||this.type===p.zq.ANODE_RECT)&&(this.edges[0].type===p.zq.CIRCLE||this.edges[0].type===p.zq.RECTANGLE)&&(this.edges[0].textLeaderline=e,!0)}constructor(e,t=0,s=0,i=0,n=!1,o=p.zq.ANODE,r=5){super(e,t,s,i,o),this.aEdges=[],this.nodeID=-1,this.tSelectedSole=0,this._isSelectedSole=!1,this.initComponent(),this.isUndo=n,this.aEdges=[],this.isConnected=!1,this.inspector=new N(this),this.scene.addAPoint(this)}}k.id=0;class E extends x{initRenderTheme(){}renderPost(e){(this.host.isConstraint&&this.host.isHoverValue||this.host.isSelected)&&(e.textAlign="center",e.fillStyle="#000000",e.fillText("Total constraint length: ".concat(this.host.constraintTargetDistance," Mile"),this.host.vecs[0].x,this.host.vecs[0].y-10)),this.host.scene.annotationInstance.activeCommandController.acProperties.showUnit&&!this.host.isConstraint&&(this.host.type===p.zq.POLYGON?(this.host.isHoverValue||this.host.isUnderConstruction)&&(this.host.dimension.renderLength(e,!0,this.host.vecs),this.host.dimension.renderTotalArea(e,this.host.vecs)):(this.host.isHoverValue||this.host.isUnderConstruction)&&(this.host.dimension.renderLength(e,!1,this.host.vecs),this.host.dimension.renderTotalLength(e,this.host.vecs))),this.host.isConstraint?this.renderPostGeometryConstraint(e):this.renderPostGeometry(e),this.offscreenRender(),this.host.renderer.t+=this.host.scene.annotationInstance.renderer.dt}renderPostGeometryConstraint(e){if(this.host.type===p.zq.POLYLINE){if(this.host.isHoverValue||this.host.isSelectedValue||this.host.isUnderConstruction){e.lineDashOffset=-this.host.renderer.t,e.setLineDash([4,4]),e.strokeStyle=this.host.styleComponent.renderStyle.colorStroke,e.lineWidth=1,e.beginPath(),e.moveTo(this.host.vecs[0].x,this.host.vecs[0].y);for(let t=1;t<this.host.vecs.length;++t)e.lineTo(this.host.vecs[t].x,this.host.vecs[t].y);e.stroke(),e.setLineDash([0,0])}this.host.isConstraint&&(this.host.renderConstraintTargetDistance,this.host.renderConstraintTargetDistancePercentage),this.host.isHoverValue||this.host.isUnderConstruction}else this.host.type===p.zq.POLYGON&&this.host.isConstraint}renderPostGeometry(e){this.host.type===p.zq.POLYLINE?this.host.isUnderConstruction?(this.renderPolyline(e),this.host.scene.annotationInstance.implementations.app.model.appCoreWrapper.appControllerStatus.mode===p.An.Drawing&&this.renderMidVec(e)):this.host.isCurvedPolyline||(this.renderPolyline(e),this.host.scene.annotationInstance.implementations.app.model.appCoreWrapper.appControllerStatus.mode===p.An.Drawing&&this.renderMidVec(e)):this.renderPolygon(e,this.host.getVecs())}renderPolyline(e){this.host.isHoverValue||this.host.isSelectedValue?(this.host.scene.annotationInstance.renderer.draw.shape.line.polylineHover(e,this.host.styleComponent.renderStyle,this.host.getVecs(),this.host.isGrayColor,this.host.visibilityValue,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tOver),this.host.isHoverValue),this.tOver+=.015,this.tDown1=0,this.host.isLeave=!0):this.tOver=0,this.host.scene.annotationInstance.renderer.draw.shape.line.polyline(e,this.host.styleComponent.renderStyle,this.host.getVecs(),this.host.isGrayColor,this.host.visibilityValue,this.host.isHoverValue,this.host.isSelectedValue)}renderPolygon(e,t){this.offscreenRender(),this.host.isHoverValue||this.host.isSelectedValue?(this.host.scene.annotationInstance.renderer.draw.shape.area.polygonHover(e,this.host.styleComponent.renderStyle,t,this.host.isGrayColor,this.host.visibilityValue,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tOver),this.host.isHoverValue,this.host.isSelectedValue),this.tOver+=.01,this.tDown1=0,this.host.isLeave=!0):this.tOver=0,this.host.scene.annotationInstance.renderer.draw.shape.area.polygon(e,this.host.styleComponent.renderStyle,t,this.host.isUnderConstruction,this.host.isGrayColor,this.host.visibilityValue,this.host.isFill,this.host.isHover,this.host.isSelectedValue)}renderMidVec(e){if(this.host.isHoverValue||this.host.isSelectedValue||this.host.isUnderConstruction){this.host.updateMidVec();let t=this.host.vecMid.length;for(;t--;)this.host.scene.annotationInstance.renderer.draw.shape.node.nodeMidHover(e,this.host.styleComponent.renderStyleNode,this.host.vecMid[t].x,this.host.vecMid[t].y,this.host.scaleForRender,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tOver))}}offscreenRender(){this.host.type===p.zq.POLYGON&&this.offscreenRenderPolygon()}offscreenRenderPolygon(){this.host.scene.annotationInstance.renderer.offscreen.polygonOffScreen(this.host.scene.annotationInstance.renderer.ctxOffscreen,this.host.hashColor,this.host.getVecs())}constructor(e){super(e),this.host=e,this.initRenderTheme()}}class T extends O{updateStyle(){if(b.updateRenderStylePolyline(this.renderStyle,this.geo.scene.annotationInstance.customization.themeCurrent),b.updateRenderStylePolylineNode(this.renderStyleNode,this.geo.scene.annotationInstance.customization.themeCurrent),this.geo.pts)for(let e=0;e<this.geo.pts.length;++e)this.geo.pts[e].styleComponent.updateStyleForNode(this.renderStyleNode)}constructor(e){super(e),this.updateStyle()}}class D extends S{static findAtPoint(e,t){for(let s=e.listAPolylineWrapper.length-1;s>=0;--s)if(e.listAPolylineWrapper[s].isSelectable&&e.listAPolylineWrapper[s].isMouseInside(t.x,t.y))return e.listAPolylineWrapper[s]}static getLengthSelection(e){let t=e.listAPolylineWrapper.length,s=0;for(;t--;)e.listAPolylineWrapper[t].isSelected&&(s+=1);return s}static computeOver(e,t){let s=D.findAtPoint(e,t);void 0!==s&&(s.isHoverValue=!0)}static fromJSON(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=!1;n=!!t.data.isConstraint;let o=new D(e,k.getNodeFromJSON(e,t.nodes[0],s),s,n);if(n&&(o.constraintTargetDistance=+t.data.constraintTargetDistance),s){o.isUndo=s;for(let i=1;i<t.nodes.length;++i)o.addPT(k.getNodeFromJSON(e,t.nodes[i],s))}else for(let s=1;s<t.nodes.length;++s)o.addPT(k.getNodeFromJSON(e,t.nodes[s]));return o.type=p.zq[t.type],i?o.id=e.getUUID():o.id=t.id,o.IsSelectable=!0,o.isUnderConstruction=!1,o.isHover=!1,o.isHiddenValue=t.isHidden,t.isHidden?o.visibilityValue=0:o.visibilityValue=1,o.initVecsHistory(),s||e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(o.toJSON()),o}static getPolylineByVecs(e,t){let s=new D(e,new k(e,t[0].x,t[0].y,0));for(let i=1;i<t.length;++i)s.addPT(new k(e,t[i].x,t[i].y,0));s.computeCenterVec(),s.IsSelectable=!0,s.isUnderConstruction=!1,e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(s.toJSON())}static drawShadow(e){arguments.length>1&&void 0!==arguments[1]?arguments[1]:p.zq.ALINE,void 0!==D.construction&&D.construction.pts[D.construction.pts.length-1].move(e.x,e.y)}static getLine(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];void 0!==D.construction||(D.construction=new D(e,new k(e,t.x,t.y),!1,s),D.construction.pts[0].isSelectable=!0),D.construction.addPT(new k(e,t.x,t.y))}static getLineByPt(e){}static undo(e,t){if(!D.construction)return;let s=D.construction.pts.length-1;if(1===s){D.cancel(e);return}D.construction.removePT(D.construction.pts[--s]),D.construction.pts[s].vec.x=t.x,D.construction.pts[s].vec.y=t.y}static done(e){void 0!==D.construction&&(D.construction.IsSelectable=!0,D.construction.isUnderConstruction=!0,D.construction.removePT(D.construction.pts[D.construction.pts.length-1]),3>(0,p.Sp)(D.construction.pts[D.construction.pts.length-1].vec,D.construction.pts[0].vec)&&D.construction.removePT(D.construction.pts[D.construction.pts.length-1]),D.construction.computeCenterVec(),D.construction.removePT(D.construction.pts[D.construction.pts.length-1]),D.construction.isUnderConstruction=!1,e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(D.construction.toJSON()),D.construction=void 0,e.annotationInstance.activeCommandController.goToACMode()),e.annotationInstance.implementations.app.model.ioWrapper.eventInteraction.isEnableZoomByDoubleClick=!0}static doneByKeyboard(e){void 0!==D.construction&&(D.construction.IsSelectable=!0,D.construction.removePT(D.construction.pts[D.construction.pts.length-1]),D.construction.isUnderConstruction=!1,D.construction.computeCenterVec(),e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(D.construction.toJSON()),D.construction=void 0,e.annotationInstance.activeCommandController.goToACMode())}static cancel(e){void 0!==D.construction&&(D.construction.needEmit=!1,D.construction.remove(),D.construction=void 0)}static mouseDown(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e.annotationInstance.activeCommandController.acProperties.isSmartSelectionWhenDrawing){let s=e.annotationInstance.geometryCommon.gcmdProcessing.findAtPoint(t);D.construction&&(D.getLine(e,t),s&&(D.construction.type=p.zq.POLYGON,D.construction.isClosed=!0,D.construction.removePT(D.construction.pts[D.construction.pts.length-1]),D.construction.removePT(D.construction.pts[D.construction.pts.length-1]),s.isSelectedValue=!1,s.isHoverValue=!1,s.isCapturedValue=!1,s.isSelectable=!1,D.construction.IsSelectable=!0,D.construction.isUnderConstruction=!1,D.construction.computeCenterVec(),D.construction.initVecsHistory(),e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(D.construction.toJSON()),D.construction=void 0))}else D.getLine(e,t,s)}static mouseLeftClick(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(void 0===e.capture){if(void 0!==D.construction&&D.isDone){D.construction.isSelectedValue=!1,D.construction=void 0,D.isDone=!1;return}void 0===D.construction&&D.getLine(e,t,s)}}static mouseMove(e){void 0!==D.construction&&D.drawShadow(e)}static mouseDoubleClick(e,t){void 0!==D.construction&&D.done(e)}initComponent(){this.styleComponent=new T(this),this.renderer=new E(this)}initPolyline(){this.isCurvedPolyline=!1,this.type=p.zq.POLYLINE,this.scene.addAPolylineWrapper(this)}updateScreenVec(){}updatePan(){}updateZoom(){}getLog(){if(this.isRemove||!this.isRenderable||this.isHiddenValue)return"";let e="";return this.type===p.zq.POLYGON?e+="GUID : "+this.id+"/TYPE : "+this.type.toString()+"/Screen : /pos : "+this.pts.length+"/Area : "+this.getArea().toFixed(3).toString()+" m2/IsSEL : "+this.isSelectedValue+"/isSelable : "+this.isSelectable:(this.type===p.zq.POLYLINE&&(e+="GUID : "+this.id+"/TYPE : "+this.type.toString()+"/Screen : /pos : "+this.pts.length+"/length : "+this.getArea().toFixed(3).toString()+" m2/IsSEL : "+this.isSelectedValue+"/isSelable : "+this.isSelectable),e)}getLogDOM(){return"Geometry ID : "+this.id+"<br>geometry Type : CCircle<br>position : <br>size : "+this.r+" pixel<br>"}isColse(){}isMouseInside(e,t){return!this.isRemove&&!!this.isRenderable&&!this.isHiddenValue&&!0!==this.isUnderConstruction&&void 0!==this.isUnderConstruction&&(this.checkDistance(e,t)?(this.isHover=!0,!0):(this.isHover=!1,!1))}checkDistance(e,t){let s=this.pts.length;for(let i=0;i<s;++i)if(i<s-1){if((0,p.xs)(new p.h9(e,t),this.pts[i].vec,this.pts[i+1].vec)<this.lineWidth)return!0}else if(this.type!==p.zq.POLYLINE&&(0,p.xs)(new p.h9(e,t),this.pts[i].vec,this.pts[0].vec)<this.lineWidth)return!0;return!!this.scene.annotationInstance.geometryCommon.gcmdProcessing.isMouseInsideByOffScreen(e,t,this.hashColor)}hasSamePtWtithCapture(){for(let e=0;e<this.pts.length;++e)if(this.pts[e]===this.scene.capture)return!0;return!1}translateByMouseEventData(e){if(this.hasSamePtWtithCapture())return;if(-1!==this.vecSelected){this.pts[this.vecSelected].translateByMouseEventData(e);return}if(this.isRemove||!this.isRenderable||this.isHiddenValue)return;let t=e.x-e.preX,s=e.y-e.preY;for(let i=0;i<this.pts.length;++i)if(this.pts[i].vec.x+=t,this.pts[i].vec.y+=s,this.pts[i].textLeaderline){let t=this.pts[i];this.translateForTextLeaderline(e,t)}if(this.isCurvedPolyline&&this.mPts)for(let e=0;e<this.mPts.length;++e)this.mPts[e].vec.x+=t,this.mPts[e].vec.y+=s}translateForTextLeaderline(e,t){return!!t.textLeaderline&&(t.textLeaderline.translateByMouseEventData(e),!!t.textLeaderline.leaderline)&&(t.textLeaderline.leaderline.v2.x=t.vec.x,t.textLeaderline.leaderline.v2.y=t.vec.y,!0)}translate(e,t){}move(e,t){if(this.isRemove||!this.isRenderable||this.isHiddenValue)return;this.computeCenterVec();let s=e-this.vec.x,i=t-this.vec.y;for(let e=0;e<this.pts.length;++e)this.pts[e].vec.x+=s,this.pts[e].vec.y+=i}remove(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];if(!this.isRemove&&this.isRenderable&&!this.isHiddenValue){for(let e=0;e<this.pts.length;++e)this.pts[e].deepRemove();if(this.isSelectable=!1,this.isRenderable=!1,this.hidePopUpSummary(),e){let e=this.toJSON();e&&this.scene.annotationInstance.io.eventListenerAnnotation.removeGeometryStack([e])}this.scene.removeAPolylineWrapper(this),this.scene.removeGeometry(this)}}hide(){}getLength(){if(this.pts.length<2)return 0;let e=0;for(let t=0;t<this.pts.length-1;++t)e+=0;return Math.abs(e)}findClosestNode(e,t){for(let s=0;s<this.pts.length;++s)if(this.pts[s].isMouseInside(e,t))return this.pts[s]}removeByBlackhole(){this.computeCenterVec(),10>(0,p.CV)([this.scene.annotationInstance.renderer.blackhole.v.x,this.scene.annotationInstance.renderer.blackhole.v.y,this.scene.annotationInstance.renderer.blackhole.v.z],[this.vec.x,this.vec.y,this.vec.z])&&this.remove(!0)}getArea(){this.vecs=[];for(let e=0;e<this.pts.length;++e)this.vecs.push(this.pts[e].vec);return(0,p.$4)(this.vecs)}get constraintTargetDistance(){return this._constraintTargetDistance}set constraintTargetDistance(e){this.renderConstraintTargetDistance=!0,this.renderConstraintTargetDistancePercentage=!1,this._constraintTargetDistance=e}get constraintTargetDistancePercentage(){return this._constraintTargetDistancePercentage}set constraintTargetDistancePercentage(e){this.renderConstraintTargetDistance=!1,this.renderConstraintTargetDistancePercentage=!0,e<=0?this._constraintTargetDistancePercentage=.001:this._constraintTargetDistancePercentage=e}getNodePopup(){let e=this.pts[0];for(let t=1;t<this.pts.length;++t)this.pts[t].vec.x<e.vec.x&&(e=this.pts[t]);return e}addPT(e){this.type===p.zq.POLYLINE?e.type=p.zq.ANODE:this.type===p.zq.POLYGON&&(e.type=p.zq.AN_GON),e.isSelectable=!1,e.addEdge(this),this.pts.push(e)}toJSON(){let e=new g(this.id,this.type,this.isSelectedValue,this.isHoverValue,this.isHiddenValue);return e.pushNode(this.getVecs()),e.data.isConstraint=this.isConstraint,e.data.constraintTargetDistance=this.constraintTargetDistance,e}getVecsFromDivision(){arguments.length>0&&void 0!==arguments[0]&&arguments[0],this.getLength();for(let e=0;e<this.pts.length-1;++e){let t=this.pts[e].vec,s=(0,p.$$)(t.x,t.y),i=this.scene.annotationInstance.geometryCommon.gcmdSupporting.toScreen(s.x,s.y),n=.7*(0,p.Sp)(new p.h9(i[0],i[1]),this.pts[e].vec),o=this.pts[e].vec,r=this.pts[e+1].vec,a=(0,p.bA)((0,p.Fv)((0,p.lu)(o,r)),n);a=(0,p.PD)(o,a),new k(this.scene,a.x,a.y,a.z).dummy()}}getVecsFromNumber(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;for(let t=0;t<this.pts.length-1;++t){let s=this.pts[t].vec,i=this.pts[t+1].vec;(0,p.fi)(s,i,e).forEach(e=>{new k(this.scene,e.x,e.y,e.z).dummy()})}}getBoundary(){return this.getVecs()}computeVec(){this.computeCenterVec(),this.computeBoundingVecs()}goToBlackhole(){this.isSelectable=!1,this.needBlackhole=!0,this.pts.forEach(e=>{e.goToBlackhole()})}updateMidVec(){if(this.vecMid=[],this.type===p.zq.POLYLINE)for(let e=0;e<this.pts.length-1;++e)this.vecMid.push((0,p.zQ)(this.pts[e].vec,this.pts[e+1].vec))}computeMidPts(){let e=this.pts.length;for(;e--;)if(this.pts[e].isMid){let t=this.pts[e];t.vec=(0,p.zQ)(t.nodes[0].vec,t.nodes[1].vec)}}computeCenterVec(){let e=[];for(let t=0;t<this.pts.length;++t)e.push(this.pts[t].vec);return this.vec=(0,p.mI)(e),this.vec}computeBoundingVecs(){this.vecs=[];for(let e=0;e<this.pts.length;++e)this.vecs.push(this.pts[e].vec);this.vecsBound=(0,p.rv)(this.vecs)}computeMidPT(e){if(this.pts.length<3)return;let t=this.pts[e],s=(0,p.zQ)(this.pts[e-1].vec,this.pts[e+1].vec);t.vec=s}removePT(e){this.pts.splice(this.pts.indexOf(e),1),e.remove()}getVecs(){let e=[];for(let t=0;t<this.pts.length;++t)e.push(this.pts[t].vec);return this.vecs=e,e}deepCopy(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2];let s=this.toJSON(),i=D.fromJSON(this.scene,s,!0,!0);return i.move(e,t),i.isHoverValue=!0,i.emitAddStack(),i}get isHidden(){return this.isHiddenValue}set isHidden(e){this.isHiddenPre=this.isHiddenValue,this.isHiddenValue=e;for(let t=0;t<this.pts.length;++t)this.pts[t].isHiddenValue=e,this.pts[t].visibility=0;this.scene.annotationInstance.io.eventListenerAnnotation.hideStack(this.toJSON())}set IsSelectable(e){this.isSelectable=e;for(let t=0;t<this.pts.length;++t)this.pts[t].isSelectable=e}get IsSelectable(){return this.isSelectable}get v(){return this.vec}set v(e){this.vec=e}get isSelected(){return this.isSelectedValue}set isSelected(e){if(!this.isRemove&&this.isRenderable&&!this.isHiddenValue){for(let t of(this.isSelectedValue=e,this.pts))t.isRenderable=e;this.scene.annotationInstance.io.eventListenerAnnotation.selectionStack(this.toJSON())}}get isHover(){return this.isHoverValue}set isHover(e){if(!this.isUnderConstruction){if(this.isHoverValue=e,this.isHoverValue&&!this.isHoverPre?this.scene.annotationInstance.io.eventListenerAnnotation.hoverStack(this.toJSON()):!this.isHoverValue&&this.isHoverPre&&this.scene.annotationInstance.io.eventListenerAnnotation.hoverStack(this.toJSON()),this.isHoverPre=this.isHoverValue,!this.isSelectedValue)for(let t of this.pts)t.isRenderable=e;e||(this.needEmitHoverPost=!0,this.hidePopUpSummary())}}mouseLeftClick(){this.scene.annotationInstance.geometryCommon.gcmdProcessing.removeAllPopup(),this.showPopupSummary(),this.dimension.renderTotalLengthInput()}mouseRightClick(){}update(){}renderPost(e){this.update(),this.computeVec(),this.renderer.timer.updatePopupSummery(),this.scene.annotationInstance.activeCommandController.acProperties.isPanning,this.renderer.renderPost(e)}constructor(e,t,s=!1,i=!1){super(e),this.constraintTargetArea=340,this.vecSelected=-1,this.isPan=!1,this.renderConstraintTargetDistancePercentage=!1,this.renderConstraintTargetDistance=!1,this._constraintTargetDistancePercentage=.5,this._constraintTargetDistance=340,this.isFill=!1,this.pts=[],this.isUndo=s,this.isConstraint=i,this.lineWidth=8,this.isUnderConstruction=!0,this.vec=new p.h9(t.vec.x,t.vec.y,t.vec.z),this.isMove=!0,this.initComponent(),this.addPT(t),this.initVecsHistory(),this.initPolyline(),this.scene.annotationInstance.implementations.app.model.ioWrapper.eventInteraction.isEnableZoomByDoubleClick=!1}}D.split=!1,D.isDone=!1;class z extends O{updateStyle(){if(b.updateRenderStylePolygon(this.renderStyle,this.geo.scene.annotationInstance.customization.themeCurrent),b.updateRenderStylePolygonNode(this.renderStyleNode,this.geo.scene.annotationInstance.customization.themeCurrent),this.geo.pts)for(let e=0;e<this.geo.pts.length;++e)this.geo.pts[e].styleComponent.updateStyleForNode(this.renderStyleNode)}constructor(e){super(e)}}class M extends D{static addGhost(e,t){}static findAtPoint(e,t){for(let s=e.listAPolygonWrapper.length-1;s>=0;--s)if(e.listAPolygonWrapper[s].isSelectable&&e.listAPolygonWrapper[s].isMouseInside(t.x,t.y))return e.listAPolygonWrapper[s]}static computeOver(e,t){let s=e.annotationInstance.geometryCommon.gcmdProcessing.findAtPoint(t);void 0!==s&&(s.isHoverValue=!0)}static aPolygonFromNGon(e,t){let s=new M(e,t.pts[0].deepCopy());for(let e=1;e<t.pts.length;++e)s.addPT(t.pts[e].deepCopy());return s.type=p.zq.POLYGON,s.id=t.id,s.IsSelectable=!0,s.isUnderConstruction=!1,s}static getPolygonbyVecs(e,t){let s=new M(e,new k(e,t[0].x,t[0].y));for(let i=1;i<t.length-1;++i)s.addPT(new k(e,t[i].x,t[i].y));return s.type=p.zq.POLYGON,s.computeCenterVec(),s.initVecsHistory(),e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(s.toJSON()),s.IsSelectable=!0,s.isUnderConstruction=!1,s.isHover=!1,s.visibilityValue=1,s.isRenderable=!0,s}static fromJSON(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=new M(e,k.getNodeFromJSON(e,t.nodes[0],s));if(s){n.isUndo=s;for(let i=1;i<t.nodes.length;++i)n.addPT(k.getNodeFromJSON(e,t.nodes[i],s))}else for(let s=1;s<t.nodes.length;++s)n.addPT(k.getNodeFromJSON(e,t.nodes[s]));return n.type=p.zq[t.type],i?n.id=e.getUUID():n.id=t.id,n.IsSelectable=!0,n.isUnderConstruction=!1,n.isHover=!1,n.isHiddenValue=t.isHidden,t.isHidden?n.visibilityValue=0:n.visibilityValue=1,n.computeCenterVec(),n.initVecsHistory(),s||e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(n.toJSON()),n}static drawShadow(e){void 0!==M.construction&&M.construction.pts[M.construction.pts.length-1].move(e.x,e.y)}static getLine(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];arguments.length>3&&void 0!==arguments[3]?arguments[3]:p.zq.AN_GON,void 0!==M.construction?M.construction.addPT(new k(e,t.x,t.y,0,!1,p.zq.ANODE_NGON)):(M.construction=new M(e,new k(e,t.x,t.y),!1,s),M.construction.pts[0].isSelectable=!0,M.construction.addPT(new k(e,t.x,t.y,0,!1,p.zq.ANODE_NGON)),M.construction.isUnderConstruction=!0)}static getLineByPt(e){}static undo(e,t){if(!M.construction)return;let s=M.construction.pts.length-1;if(1===s){M.cancel(e);return}M.construction.removePT(M.construction.pts[--s]),M.construction.pts[s].vec.x=t.x,M.construction.pts[s].vec.y=t.y}static done(e){e.annotationInstance.activeCommandController.IsTouchEvent?this.doneByTouch(e):this.doneByMouseClick(e),e.annotationInstance.implementations.app.model.ioWrapper.eventInteraction.isEnableZoomByDoubleClick=!0}static doneByTouch(e){void 0!==M.construction&&(M.construction.IsSelectable=!0,M.construction.removePT(M.construction.pts[0]),15>(0,p.Sp)(M.construction.pts[M.construction.pts.length-1].vec,M.construction.pts[0].vec)&&M.construction.removePT(M.construction.pts[M.construction.pts.length-1]),M.construction.removePT(M.construction.pts[M.construction.pts.length-1]),M.construction.computeCenterVec(),M.construction.initVecsHistory(),M.construction.isUnderConstruction=!1,e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(M.construction.toJSON()),M.construction.pts.length<2&&M.construction.remove(),M.construction=void 0,e.annotationInstance.activeCommandController.goToACMode())}static doneByMouseClick(e){void 0!==M.construction&&(M.construction.IsSelectable=!0,M.construction.removePT(M.construction.pts[M.construction.pts.length-1]),2>(0,p.Sp)(M.construction.pts[M.construction.pts.length-1].vec,M.construction.pts[0].vec)&&M.construction.removePT(M.construction.pts[M.construction.pts.length-1]),M.construction.removePT(M.construction.pts[M.construction.pts.length-1]),M.construction.computeCenterVec(),M.construction.isUnderConstruction=!1,e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(M.construction.toJSON()),M.construction.pts.length<2&&M.construction.remove(),M.construction=void 0,e.annotationInstance.activeCommandController.goToACMode())}static doneByKeyboard(e){void 0!==M.construction&&(M.construction.IsSelectable=!0,M.construction.removePT(M.construction.pts[M.construction.pts.length-1]),M.construction.isUnderConstruction=!1,M.construction.computeCenterVec(),e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(M.construction.toJSON()),M.construction.pts.length<2&&M.construction.remove(),M.construction=void 0,e.annotationInstance.activeCommandController.goToACMode())}static cancel(e){void 0!==M.construction&&(M.construction.needEmit=!1,M.construction.remove(),M.construction=void 0,e.annotationInstance.activeCommandController.goToACMode())}static mouseDown(e,t){if(e.annotationInstance.activeCommandController.acProperties.isSmartSelectionWhenDrawing){let s=e.annotationInstance.geometryCommon.gcmdProcessing.findAtPoint(t);M.construction&&(M.getLine(e,t),s&&(M.construction.type=p.zq.POLYGON,M.construction.isClosed=!0,M.construction.removePT(M.construction.pts[M.construction.pts.length-1]),M.construction.removePT(M.construction.pts[M.construction.pts.length-1]),s.isSelectedValue=!1,s.isHoverValue=!1,s.isCapturedValue=!1,s.isSelectable=!1,M.construction.IsSelectable=!0,M.construction.isUnderConstruction=!1,M.construction.computeCenterVec(),e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(M.construction.toJSON()),M.construction=void 0))}else M.getLine(e,t)}static mouseLeftClick(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:p.zq.POLYGON;void 0===e.capture&&(void 0!==M.construction&&M.isDone?(M.construction.isSelectedValue=!1,M.construction=void 0,M.isDone=!1):void 0===M.construction&&M.getLine(e,t,s,i))}static mouseMove(e){if(void 0!==M.construction){if(M.construction.scene.annotationInstance.activeCommandController.acProperties.pressShift&&M.construction.pts.length>1){let t=M.construction.pts[M.construction.pts.length-2];(0,p.Sp)(t.vec,new p.h9(e.x,e.y))>20&&this.mouseDown(M.construction.scene,e)}M.drawShadow(e)}}static mouseDoubleClick(e,t){void 0!==M.construction&&M.done(e)}initComponentPolygon(){this.styleComponent=new z(this)}initPolygon(){this.type=p.zq.POLYGON,this.scene.addAPolygonWrapper(this)}getLog(){return this.isRemove||!this.isRenderable||this.isHiddenValue?"":"GUID : "+this.id+"/TYPE : "+this.type.toString()+"/Screen : /pos : "+this.pts.length+"/Area : "+this.getArea().toFixed(3).toString()+" m2/IsSEL : "+this.isSelectedValue+"/isSelable : "+this.isSelectable}getLogDOM(){return"Geometry ID : "+this.id+"<br>geometry Type : CCircle<br>position : <br>size : "+this.r+" pixel<br>"}set IsSelectable(e){this.isSelectable=e;for(let t=0;t<this.pts.length;++t)this.pts[t].isSelectable=e}get IsSelectable(){return this.isSelectable}set isHidden(e){this.isHiddenPre=this.isHiddenValue,this.isHiddenValue=e;for(let t=0;t<this.pts.length;++t)this.pts[t].isHiddenValue=e,this.pts[t].visibility=0;this.scene.annotationInstance.io.eventListenerAnnotation.hideStack(this.toJSON())}get isHidden(){return this.isHiddenValue}mouseRightClick(){}findClosestNode(e,t){if(!this.isRemove&&this.isRenderable&&!this.isHiddenValue){for(let s=0;s<this.pts.length;++s)if(this.pts[s].isMouseInside(e,t))return this.pts[s]}}remove(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];if(!this.isRemove&&this.isRenderable&&!this.isHiddenValue){for(let e=0;e<this.pts.length;++e)this.pts[e].deepRemove();if(this.isSelectable=!1,this.isRenderable=!1,this.hidePopUpSummary(),!this.isUnderConstruction&&e){let e=this.toJSON();e&&this.scene.annotationInstance.io.eventListenerAnnotation.removeGeometryStack([e])}this.scene.removeAPolygonWrapper(this),this.scene.removeGeometry(this)}}deepCopy(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2];let s=this.toJSON(),i=M.fromJSON(this.scene,s,!0,!0);return i.move(e,t),i.isHoverValue=!0,i.emitAddStack(),i}constructor(e,t,s=!1,i=!1){super(e,t,s),this.initComponentPolygon(),t.styleComponent.updateStyleForNode(this.styleComponent.renderStyleNode),this.isConstraint=i,this.isFill=!0,e.annotationInstance.implementations.app.model.ioWrapper.eventInteraction.isEnableZoomByDoubleClick=!1,this.initPolygon()}}M.split=!1,M.isDone=!1;class G{render(e,t,s){this.renderLength(e,t,s),this.renderDimTotal(e,s),this.renderTotalArea(e,s)}renderLength(e,t,s){for(let t=0;t<s.length-1;++t)s[t].x<s[t+1].x?this.geometryBase.scene.annotationInstance.renderer.draw.shape.line.lineDim(e,this.geometryBase.styleComponent.renderStyle,s[t].x,s[t].y,s[t+1].x,s[t+1].y,0):this.geometryBase.scene.annotationInstance.renderer.draw.shape.line.lineDim(e,this.geometryBase.styleComponent.renderStyle,s[t+1].x,s[t+1].y,s[t].x,s[t].y,0);if(t&&(s[s.length-1].x<s[0].x?this.geometryBase.scene.annotationInstance.renderer.draw.shape.line.lineDim(e,this.geometryBase.styleComponent.renderStyle,s[s.length-1].x,s[s.length-1].y,s[0].x,s[0].y,0):this.geometryBase.scene.annotationInstance.renderer.draw.shape.line.lineDim(e,this.geometryBase.styleComponent.renderStyle,s[0].x,s[0].y,s[s.length-1].x,s[s.length-1].y,0)),t)for(let t=0;t<s.length;++t)t===s.length-1?this.geometryBase.scene.annotationInstance.renderer.draw.shape.line.lineDim(e,this.geometryBase.styleComponent.renderStyle,s[t].x,s[t].y,s[0].x,s[0].y,0):s[t].x<s[t+1].x?this.geometryBase.scene.annotationInstance.renderer.draw.shape.line.lineDim(e,this.geometryBase.styleComponent.renderStyle,s[t].x,s[t].y,s[t+1].x,s[t+1].y,0):this.geometryBase.scene.annotationInstance.renderer.draw.shape.line.lineDim(e,this.geometryBase.styleComponent.renderStyle,s[t+1].x,s[t+1].y,s[t].x,s[t].y,0);else for(let t=0;t<s.length-1;++t)s[t].x<s[t+1].x?this.geometryBase.scene.annotationInstance.renderer.draw.shape.line.lineDim(e,this.geometryBase.styleComponent.renderStyle,s[t].x,s[t].y,s[t+1].x,s[t+1].y,0):this.geometryBase.scene.annotationInstance.renderer.draw.shape.line.lineDim(e,this.geometryBase.styleComponent.renderStyle,s[t+1].x,s[t+1].y,s[t].x,s[t].y,0)}renderDimTotal(e,t){t.length>2&&this.geometryBase.type===p.zq.POLYLINE&&this.renderTotalLength(e,t)}renderTotalArea(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2]}renderTotalLength(e,t){}renderLengthCircle(e,t,s){}renderTotalAreaCircle(e,t,s){}renderLengthRect(e,t){}renderTotalAreaRect(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2]}renderLengthCurve(e,t,s){}renderTotalLengthCurve(e,t,s){for(let e=0;e<t.length-1;++e);}renderRemainLengthByValue(e,t,s){}renderTotalAreaCurve(e,t,s){for(let e=0;e<t.length-1;++e);}renderTotalLengthInput(){}constructor(e,t=2){this.numToFixed=2,this.geometryBase=e,this.numToFixed=t}}class W{isMouseInside(e,t){let s=new p.h9(e,t);return!this.host.isRemove&&!!this.host.isRenderable&&!this.host.isHiddenValue&&!0!==this.host.isUnderConstruction&&void 0!==this.host.isUnderConstruction&&!this.geo.isCollapse&&(this.host.isRotate=!1,!!this.isMouseInsidePt(s)||(this.isMouseInsideCPMid(s)||this.isMouseInsideCP(s)?(this.host.isHover=!0,!0):10>(0,p.Sp)(this.host.vecRotationHandler,s)?(this.host.isRotate=!0,this.host.isHover=!0,!0):this.checkDistance(e,t)?(this.host.isHover=!0,!0):!!(0,p.xt)(this.host.vec,s,.5*this.host.width,.5*this.host.height)||(this.host.isHover=!1,!1)))}getLog(){return"GUID : "+this.host.id+"/TYPE : "+this.host.type.toString()+"/Screen : /Area : "+this.host.getArea().toFixed(3).toString()+" m2/IsSEL : "+this.host.isSelectedValue+"/isSelable : "+this.host.isSelectable}hide(){}isMouseInsideCPMid(e){for(let t=0;t<this.host.vecsCP.length;++t)if(10>(0,p.Sp)(this.host.vecsCP[t],e))return this.host.vecSelectedCp=t,this.host.isHoverDuplicatedVecs=!1,!0;return this.host.vecSelectedCp=-1,!1}isMouseInsideCP(e){for(let t=0;t<this.host.pts.length-1;++t)if(10>(0,p.xs)(e,this.host.pts[t].vec,this.host.pts[t+1].vec))return this.host.isHoverDuplicatedVecs=!1,!0;return!1}isMouseInsidePt(e){for(let t=0;t<this.host.pts.length;++t)if(10>(0,p.Sp)(this.host.pts[t].vec,e))return this.host.vecSelected=t,!0;return this.host.vecSelected=-1,!1}checkDistance(e,t){return this.geo.scene.annotationInstance.geometryCommon.gcmdProcessing.isMouseInsideByOffScreen(e-this.geo.scene.paramsEditing.croppingMaskParams.x,t-this.geo.scene.paramsEditing.croppingMaskParams.y,this.geo.hashColor)}updateActiveMouseCursor(){this.host.vecSelectedCp>-1?this.setMouseCursorMidCP():this.setMouseCursorCP()}setMouseCursorCP(){this.host.scene.capturePT?this.host.pts.indexOf(this.host.scene.capturePT)%2==0?this.host.scene.annotationInstance.activeCommandController.activeMouseCursor.setActiveCursor(p.CF.NWSEresize):this.host.scene.annotationInstance.activeCommandController.activeMouseCursor.setActiveCursor(p.CF.NESWresize):this.host.scene.annotationInstance.activeCommandController.activeMouseCursor.setActiveCursorDrag()}setMouseCursorMidCP(){-1===this.host.vecSelectedCp&&this.host.scene.annotationInstance.activeCommandController.activeMouseCursor.setActiveCursorDrag(),this.host.vecSelectedCp%2==0?this.host.scene.annotationInstance.activeCommandController.activeMouseCursor.setActiveCursor(p.CF.NSresize):this.host.scene.annotationInstance.activeCommandController.activeMouseCursor.setActiveCursor(p.CF.EWresize)}isMouseInsideSnapFrom(e){this.host.vecSelectedSnapping=void 0;for(let t=0;t<this.host.vecsCP.length;t+=1)if((0,p.Sp)(this.host.vecsCP[t],e)<this.host.scene.annotationInstance.activeCommandController.acProperties.toleranceSnapping)return this.host.vecSelectedSnapping=this.host.vecsCP[t],this.host.vecSelectedSnapping;if((0,p.Sp)(this.host.vec,e)<this.host.scene.annotationInstance.activeCommandController.acProperties.toleranceSnapping)return this.host.vecSelectedSnapping=this.host.vec,this.host.vecSelectedSnapping}checkAttachedTextleaderline(){if(!this.host.textLeaderline||!this.host.textLeaderline.leaderline)return!1;let e=!1;5>(0,p.Sp)(this.host.vec,this.host.textLeaderline.leaderline.v2)&&(e=!0);for(let t=0;t<this.host.vecsCP.length;++t)5>(0,p.Sp)(this.host.vecsCP[t],this.host.textLeaderline.leaderline.v2)&&(e=!0);return!!e||(this.host.textLeaderline.attachedShape=void 0,this.host.textLeaderline=void 0,!1)}updateLeaderlineSnap(e,t){if(this.host.computeCenterVec(),this.host.updateVecsCP(),5>(0,p.Sp)(this.host.vec,e)){this.host.vecSelectedSnapping=this.host.vec;return}for(let t=0;t<this.host.vecsCP.length;++t)if(5>(0,p.Sp)(this.host.vecsCP[t],e)){this.host.vecSelectedSnapping=this.host.vecsCP[t];return}}constructor(e){this.geo=e,this.host=e}}class B extends x{renderPost(e){this.interpolateColor.update(),this.timer.update(),this.timer.updatePopupSummery(),this.host.transformation.updateRotationAbsolute(),(this.host.scene.annotationInstance.activeCommandController.acProperties.isPanning||this.host.scene.annotationInstance.activeCommandController.acProperties.extentChanging)&&this.host.computeVec(),this.host.scene.annotationInstance.activeCommandController.acProperties.showUnit&&this.host.isConstraintRatio&&this.host.isHoverValue&&(e.textAlign="center",e.fillStyle="#ffffff",100<Math.abs(this.host.width)&&e.fillText("constrained by ratio",this.host.vec.x,this.host.vec.y)),this.host.scene.annotationInstance.activeCommandController.acProperties.showUnit&&(this.host.isHoverValue||this.host.isUnderConstruction)&&(this.host.dimension.renderLengthRect(e,this.host.vecs),this.host.isConstraintRatio?this.host.dimension.renderTotalAreaRect(e,this.host.vecs,", constrained by ratio"):this.host.dimension.renderTotalAreaRect(e,this.host.vecs)),this.renderPostGeometry(e,this.host.scene.annotationInstance.geometryCommon.gcmdSupporting.toScreenVecsOnCropping(this.host.getVecs()))}renderPostGeometry(e,t){let s=this.host.scene.annotationInstance.geometryCommon.gcmdSupporting.toScreenVecOnCropping(this.host.vec),i=Math.abs(this.host.vecsCP[1].x-this.host.vecsCP[0].x),n=Math.abs((this.host.vecsCP[2].y-this.host.vecsCP[0].y)*.5);this.host.updateVecsCP(),this.host.isHoverValue||this.host.isSelectedValue?(this.host.scene.annotationInstance.renderer.draw.shape.area.ellipseHover(e,this.host.styleComponent.renderStyle,s.x,s.y,i,n,this.host.isGrayColor,this.host.visibilityValue,this.host.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.host.renderer.tOver),this.host.isHoverValue,this.host.isSelectedValue),this.host.renderer.tOver+=this.host.scene.annotationInstance.renderer.dt,this.host.renderer.tDown1=0,this.host.isLeave=!0,this.host.scene.annotationInstance.implementations.app.model.appCoreWrapper.appControllerStatus.mode===p.An.Drawing&&this.host.enableRotate&&this.renderRotationHandler(e)):this.host.renderer.tOver=0,this.host.scene.annotationInstance.renderer.draw.shape.area.ellipse(e,this.host.styleComponent.renderStyle,s.x,s.y,i,n,!0,!0,!1),(this.host.isHoverValue||this.host.isSelectedValue||this.host.isUnderConstruction)&&this.host.scene.annotationInstance.implementations.app.model.appCoreWrapper.appControllerStatus.mode===p.An.Drawing&&(this.host.scene.annotationInstance.renderer.draw.shape.point.centerPointCircle(e,s.x,s.y),this.renderBoundingBox(e,t),this.renderCP(e,this.host.vecsCP)),this.t+=this.host.scene.annotationInstance.renderer.dt,this.renderPostGeometryOffScreen(s)}renderCP(e,t){if(this.host.scene.annotationInstance.implementations.app.model.appCoreWrapper.appControllerStatus.mode===p.An.Drawing&&this.host.isHoverValue||this.host.isSelectedValue||this.host.isUnderConstruction)for(let s=0;s<t.length;++s){let i=this.host.scene.annotationInstance.geometryCommon.gcmdSupporting.toScreenVecOnCropping(t[s]);this.host.scene.annotationInstance.renderer.draw.shape.node.nodeHover(e,this.host.pts[0].styleComponent.renderStyle,i.x,i.y,this.host.scene.annotationInstance.graphicsCoreWrapper.scaleScreenByRatioImageSize,1)}}renderPostGeometryOffScreen(e){this.host.scene.annotationInstance.renderer.offscreen.ellipseOffScreen(this.host.scene.annotationInstance.renderer.ctxOffscreen,this.host.styleComponent.renderStyle,this.host.hashColor,e.x,e.y,.5*Math.abs(this.host.width),.5*Math.abs(this.host.height),this.host.isFill)}renderBoundingBox(e,t){e.globalAlpha=1,e.lineWidth=1,e.strokeStyle=this.host.styleComponent.renderStyle.colorStroke,e.beginPath(),e.moveTo(t[0].x,t[0].y),e.lineTo(t[1].x,t[1].y),e.lineTo(t[2].x,t[2].y),e.lineTo(t[3].x,t[3].y),e.closePath(),e.stroke()}renderRotationHandler(e){this.host.isHover&&(this.host.enableRotate&&this.host.transformation.updateRotationHandler(),e.strokeStyle=this.host.styleComponent.renderStyle.colorStroke,e.beginPath(),e.moveTo(this.host.vecRotationHandler.x,this.host.vecRotationHandler.y),e.lineTo(this.host.vecs[0].x+(this.host.vecs[1].x-this.host.vecs[0].x)*.5,this.host.vecs[0].y+(this.host.vecs[1].y-this.host.vecs[0].y)*.5),e.closePath(),e.stroke(),e.fillStyle=this.host.styleComponent.renderStyle.colorStroke,e.beginPath(),e.arc(this.host.vecRotationHandler.x,this.host.vecRotationHandler.y,7,0,2*Math.PI),e.closePath(),e.fill())}constructor(e){super(e),this.host=e}}class H extends O{updateStyle(){if(!this.isCustom){this.state.themeColorId=h.AccentColor1,this.isCustom=!0,b.updateRenderStylePolygon(this.renderStyle,this.geo.scene.annotationInstance.customization.themeCurrent),b.updateRenderStylePolygonNode(this.renderStyleNode,this.geo.scene.annotationInstance.customization.themeCurrent);for(let e=0;e<this.geo.pts.length;++e)this.geo.pts[e].styleComponent.updateStyleForNode(this.renderStyleNode)}}updateColor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;this.isCustom=!0,void 0===e&&(e=this.geo.scene.annotationInstance.activeCommandController.activeColorController.activeColor),b.updateRenderColorPolygon(this.renderStyle,this.geo.scene.annotationInstance.customization.themeCurrent,e,[0,0,0,0]),b.updateRenderColorPolygonNode(this.renderStyleNode,this.geo.scene.annotationInstance.customization.themeCurrent,e);for(let e=0;e<this.geo.pts.length;++e)this.geo.pts[e].styleComponent.updateStyleForNode(this.renderStyleNode);this.tempColorRgba=e}updateStyleCustom(e){if(e.width&&(this.state.width=e.width),void 0!==e.color&&(this.state.themeColorId=e.color),e.colorRgba.length>0&&e.fill.length>0){this.tempColorRgba=e.colorRgba,this.tempFillRgba=e.fill,b.updateRenderStylePolygonCustom(this.renderStyle,this.geo.scene.annotationInstance.customization.themeCurrent,e.colorRgba,e.fill),b.updateRenderStylePolygonNodeCustom(this.renderStyleNode,this.geo.scene.annotationInstance.customization.themeCurrent,e.colorRgba,e.fill);for(let e=0;e<this.geo.pts.length;++e)this.geo.pts[e].styleComponent.updateStyleForNode(this.renderStyleNode)}return e.scale&&(this.renderStyle.scaleLocal=e.scale,this.state.scale=e.scale),this.isCustom=!0,!0}setDash(e){this.renderStyle.dash=e,this.geo.scene.annotationInstance.io.eventListenerAnnotation.addGeometryStack(this.geo.toJSON())}toJson(){if(!this.isCustom)return;let e={width:this.state.width,scale:this.renderStyle.scaleLocal,colorRgba:this.tempColorRgba,fill:this.tempFillRgba};return this.state.themeColorId!==h.AccentColor1&&(e.color=this.state.themeColorId),e}isSameStyle(e){if(e.colorRgba.length===this.tempColorRgba.length||e.fill.length===this.tempFillRgba){for(let t=0;t<e.colorRgba.length;t++)if(e.colorRgba[t]!==this.tempColorRgba[t])return!1;for(let t=0;t<e.fill.length;t++)if(e.fill[t]!==this.tempFillRgba[t])return!1}return!0}constructor(e){super(e),this.updateStyle(),this.updateColor()}}class F{translateByMouseEventData(e){}translate(e,t){}move(e,t){}constructor(e){this.geo=e}}class _ extends F{translateByMouseEventData(e){if(this.host.vecSelected>-1){this.translateByMouseEventDataNode(e,this.host.vecSelected);return}if(this.host.isRotate){this.rotatingShape(e.x,e.y);return}if(this.host.isRemove||!this.host.isRenderable||this.host.isHiddenValue)return;let t=e.x-e.preX,s=e.y-e.preY;if(-1!==this.host.vecSelectedCp){this.translateCPByMouseEventData(e),this.host.computeCenterVec(),this.updateTextleaderlineVec();return}if(-1!==this.host.vecSelected){this.host.pts[this.host.vecSelected].translateByMouseEventData(e),this.host.computeCenterVec(),this.updateTextleaderlineVec();return}for(let e=0;e<this.host.pts.length;++e)this.host.pts[e].vec.x+=t,this.host.pts[e].vec.y+=s;this.host.computeCenterVec(),this.host.textLeaderline&&(this.host.vecSelectedSnapping||this.host.updateLeaderlineSnap(this.host.textLeaderline.vec,5),this.updateTextleaderlineVec(),this.host.textLeaderline.translateByMouseEventData(e))}translate(e,t){}updateRotationAbsolute(){this.angle=180*Math.atan2(this.host.vecRotationHandler.y-this.host.vec.y,this.host.vecRotationHandler.x-this.host.vec.x)/Math.PI}translateCPByMouseEventData(e){if(0===this.host.vecSelectedCp){let t=e.y-this.host.pts[0].vec.y;this.host.pts[0].vec.y+=t,this.host.pts[1].vec.y+=t,this.host.height<16&&(this.host.pts[0].vec.y-=t,this.host.pts[1].vec.y-=t)}else if(2===this.host.vecSelectedCp){let t=e.y-this.host.pts[2].vec.y;this.host.pts[2].vec.y+=t,this.host.pts[3].vec.y+=t,this.host.height<16&&(this.host.pts[2].vec.y-=t,this.host.pts[3].vec.y-=t)}else if(1===this.host.vecSelectedCp){let t=this.host.isHoverDuplicatedVecs?e.x:e.x-this.host.pts[1].vec.x;this.host.pts[1].vec.x+=t,this.host.pts[2].vec.x+=t,this.host.width<16&&(this.host.pts[1].vec.x-=t,this.host.pts[2].vec.x-=t)}else if(3===this.host.vecSelectedCp){let t=this.host.isHoverDuplicatedVecs?e.x:e.x-this.host.pts[0].vec.x;this.host.pts[0].vec.x+=t,this.host.pts[3].vec.x+=t,this.host.width<16&&(this.host.pts[0].vec.x-=t,this.host.pts[3].vec.x-=t)}}translateByMouseEventDataNode(e,t){for(let e=0;e<this.host.pts.length;++e)this.host.pts[e].isRenderable=!0;this.host.textLeaderline&&!this.host.vecSelectedSnapping&&this.host.updateLeaderlineSnap(this.host.textLeaderline.vec,5);let s=e.x-e.preX,i=e.y-e.preY;0===t||2===t?Math.abs(s)>Math.abs(i)?i=s:s=i:(1===t||3===t)&&(Math.abs(s)>Math.abs(i)?i=-1*s:s=-1*i),this.host.isConstraintRatio?this.computeConstraintRatio(t,s,i):0===t?(this.translatePt(0,s,i),this.translatePt(3,s,0),this.translatePt(1,0,i),(this.host.width<16||this.host.height<16)&&(this.translatePt(0,-s,-i),this.translatePt(3,-s,0),this.translatePt(1,0,-i))):1===t?(this.translatePt(1,s,i),this.translatePt(2,s,0),this.translatePt(0,0,i),(this.host.width<16||this.host.height<16)&&(this.translatePt(1,-s,-i),this.translatePt(2,-s,0),this.translatePt(0,0,-i))):2===t?(this.translatePt(2,s,i),this.translatePt(1,s,0),this.translatePt(3,0,i),(this.host.width<16||this.host.height<16)&&(this.translatePt(2,-s,-i),this.translatePt(1,-s,0),this.translatePt(3,0,-i))):3===t&&(this.translatePt(3,s,i),this.translatePt(0,s,0),this.translatePt(2,0,i),(this.host.width<16||this.host.height<16)&&(this.translatePt(3,-s,-i),this.translatePt(0,-s,0),this.translatePt(2,0,-i))),this.host.computeCenterVec(),this.host.transformation.updateTextleaderlineVec()}translatePt(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.host.pts[e].vec.x+=t,this.host.pts[e].vec.y+=s}updateTextleaderlineVec(){let e=0;this.host.vecSelectedSnapping&&this.host.textLeaderline&&this.host.textLeaderline.leaderline&&(e=this.host.textLeaderline.leaderline.v2.x-this.host.vecSelectedSnapping.x,this.host.textLeaderline.leaderline.v2.x=this.host.vecSelectedSnapping.x,this.host.textLeaderline.widthOffset+=e,e=this.host.textLeaderline.leaderline.v2.y-this.host.vecSelectedSnapping.y,this.host.textLeaderline.leaderline.v2.y=this.host.vecSelectedSnapping.y,this.host.textLeaderline.heightOffset+=e,this.host.textLeaderline.computeCenterVec())}rotatingShape(e,t){let s=180*Math.atan2(t-this.host.vec.y,e-this.host.vec.x)/Math.PI-this.angle,i=this.rotateVecsLoal([this.host.vecRotationHandler],this.host.vec,s);this.host.vecRotationHandler.x=i[0].x,this.host.vecRotationHandler.y=i[0].y,this.host.vecRotationHandler.z=i[0].z,i=this.rotateVecsLoal(this.host.vecs,this.host.vec,s),this.host.vecs[0].x=i[0].x,this.host.vecs[0].y=i[0].y,this.host.vecs[0].z=i[0].z,this.host.vecs[1].x=i[1].x,this.host.vecs[1].y=i[1].y,this.host.vecs[1].z=i[1].z,this.host.vecs[2].x=i[2].x,this.host.vecs[2].y=i[2].y,this.host.vecs[2].z=i[2].z,this.host.vecs[3].x=i[3].x,this.host.vecs[3].y=i[3].y,this.host.vecs[3].z=i[3].z,this.angle+=s}rotateVecsLoal(e,t,s){let i=new p.h9(-t.x,-t.y,-t.z),n=(0,p.Vt)(e,i);return n=(0,p.DM)(n,s),n=(0,p.Vt)(n,t)}updateRotationHandler(){this.host.vecRotationHandler.x=this.host.vecs[0].x+(this.host.vecs[1].x-this.host.vecs[0].x)*.5,this.host.vecRotationHandler.y=this.host.vecs[0].y+(this.host.vecs[1].y-this.host.vecs[0].y)*.5;let e=(0,p.ir)(this.host.vecs[0],this.host.vecs[1]),t=new p.h9(this.host.vecs[1].x-this.host.vecs[0].x,this.host.vecs[1].y-this.host.vecs[0].y,this.host.vecs[1].z-this.host.vecs[0].z),s=(0,p.ir)(e,t);s.unitize(),this.host.vecRotationHandler.x+=20*s.x,this.host.vecRotationHandler.y+=20*s.y,(0,p.Sp)(this.host.vec,this.host.vecRotationHandler)<.5*this.host.height&&(this.host.vecRotationHandler.x+=-(40*s.x),this.host.vecRotationHandler.y+=-(40*s.y))}computeConstraintRatio(e,t,s){let i=this.resizeConstraintRatio();if(0===e){if(Math.abs(t)>Math.abs(s)){let s=(0,p.kC)(i[0],i[1],i[0]+t);this.host.pts[e].vec.x+=t,this.host.pts[e].vec.y-=i[1]-s[1],this.host.pts[e+1].vec.y-=i[1]-s[1],this.host.pts[e+3].vec.x+=t}else{let t=(0,p.Ux)(i[0],i[1],i[1]+s);this.host.pts[e].vec.x-=i[0]-t[0],this.host.pts[e].vec.y+=s,this.host.pts[e+1].vec.y+=s,this.host.pts[e+3].vec.x-=i[0]-t[0]}}else if(1===e){if(Math.abs(t)>Math.abs(s)){this.host.pts[e].vec.x+=t;let s=(0,p.kC)(i[0],i[1],i[0]+t);this.host.pts[e].vec.y+=i[1]-s[1],this.host.pts[e+1].vec.x+=t,this.host.pts[e-1].vec.y+=i[1]-s[1]}else{let t=(0,p.Ux)(i[0],i[1],i[1]+s);this.host.pts[e].vec.x+=i[0]-t[0],this.host.pts[e].vec.y+=s,this.host.pts[e+1].vec.x+=i[0]-t[0],this.host.pts[e-1].vec.y+=s}}else if(2===e){if(Math.abs(t)>Math.abs(s)){let s=(0,p.kC)(i[0],i[1],i[0]+t);this.host.pts[e].vec.x+=t,this.host.pts[e].vec.y=this.host.pts[0].vec.y+s[1],this.host.pts[e-1].vec.x+=t,this.host.pts[e+1].vec.y=this.host.pts[0].vec.y+s[1]}else{let t=(0,p.Ux)(i[0],i[1],i[1]+s);this.host.pts[e].vec.x=this.host.pts[0].vec.x+t[0],this.host.pts[e].vec.y+=s,this.host.pts[e-1].vec.x=this.host.pts[0].vec.x+t[0],this.host.pts[e+1].vec.y+=s}}else if(3===e){if(Math.abs(t)>Math.abs(s)){let s=(0,p.kC)(i[0],i[1],i[0]+t);this.host.pts[e].vec.x+=t,this.host.pts[e].vec.y+=i[1]-s[1],this.host.pts[e-1].vec.y+=i[1]-s[1],this.host.pts[0].vec.x+=t}else{let t=(0,p.Ux)(i[0],i[1],i[1]+s);this.host.pts[e].vec.x+=i[0]-t[0],this.host.pts[e].vec.y+=s,this.host.pts[e-1].vec.y+=s,this.host.pts[0].vec.x+=i[0]-t[0]}}}resizeConstraintRatio(){return[this.host.pts[1].vec.x-this.host.pts[0].vec.x,this.host.pts[2].vec.y-this.host.pts[1].vec.y]}constructor(e){super(e),this.anglePre=0,this.angle=0,this.geo=e,this.host=e}}class U extends S{static getRectangleFromVoice(e){let t=new p.h9(.5*e.annotationInstance.geometryCommon.gcmdProcessing.width,.5*e.annotationInstance.geometryCommon.gcmdProcessing.height);this.getRectByVecs(e,[new p.h9(t.x-100,t.y-100),new p.h9(t.x+100,t.y-100),new p.h9(t.x+100,t.y+100),new p.h9(t.x-100,t.y+100)])}static findAtPoint(e){}static computeOver(e){U.findAtPoint(e)}static getRectByVecs(e,t){let s=(0,p.HP)(t),i=new U(e,s[0].x,s[0].y,0,!1),n=s[1].x-s[0].x,o=s[1].y-s[0].y;i.pts[1].vec.x+=n,i.pts[2].vec.x+=n,i.pts[2].vec.y+=o,i.pts[3].vec.y+=o,i.IsSelectable=!0,i.isUnderConstruction=!1,i.updatePos(2,i.pts[1].vec.x+1,i.pts[3].vec.y+1,0),e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(i.toJSON())}static getRectByTouch(e,t){let s=new p.h9(t.x,t.y,0);this.getRectByVecs(e,[new p.h9(s.x-100,s.y-100),new p.h9(s.x+100,s.y-100),new p.h9(s.x+100,s.y+100),new p.h9(s.x-100,s.y+100)])}static getRect(e,t){if(void 0===U.construction){U.construction=new U(e,t.x,t.y),U.construction.IsSelectable=!1;return}U.construction.isUnderConstruction=!1,U.construction.IsSelectable=!0,U.construction.updatePos(2,U.construction.pts[1].vec.x,U.construction.pts[3].vec.y+.1,0),e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(U.construction.toJSON()),U.construction=void 0}static getRectByPt(e){}static drawShadow(e,t){void 0===U.construction?new k(e,t.x,t.y,0).isSelectable=!1:(U.construction.pts[1].move(t.x,U.construction.pts[1].vec.y),U.construction.pts[2].move(t.x,t.y),U.construction.pts[3].move(U.construction.pts[3].vec.x,t.y),U.construction.computeCenterVec())}static fromJSON(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=k.getNodeFromJSON(e,t.nodes[0],s),o=new U(e,n.vec.x,n.vec.y,0,s);n.remove();for(let i=1;i<o.pts.length;++i){let n=k.getNodeFromJSON(e,t.nodes[i],s);o.pts[i].vec.x=n.vec.x,o.pts[i].vec.y=n.vec.y,o.pts[i].type=p.zq.ANODE_CIRCLE,n.remove()}return o.type=p.zq[t.type],o.isHiddenValue=t.isHidden,t.isHidden?o.visibility=0:o.visibility=1,t.styles&&t.styles.dash&&(o.styleComponent.renderStyle.dash=t.styles.dash),i?o.id=e.getUUID():o.id=t.id,o.IsSelectable=!0,o.isUnderConstruction=!1,o.isHover=!1,t.styles&&o.updateStyleCustom(t.styles),o.initVecsHistory(),o.computeCenterVec(),s||e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(o.toJSON()),o}static cancel(){void 0!==U.construction&&U.construction.remove(),U.construction=void 0}static mouseDown(e,t){}static onMouseLeftClick(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:128,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:128;U.construction&&U.construction.remove();let n=new U(e,t.x-.5*s,t.y-.5*i);n.pts[1].vec.x+=s,n.pts[2].vec.x+=s,n.pts[2].vec.y+=i,n.pts[3].vec.y+=i,n.computeCenterVec(),n.IsSelectable=!0,n.isUnderConstruction=!1,n.isHover=!1,n.emitAddStack(),e.annotationInstance.activeCommandController.goToACMode()}static onMouseMiddleClick(e){}static onMouseRightClick(e){}static onMouseDoubleClick(e){}static onMouseMove(e,t){void 0!==U.construction&&U.drawShadow(e,t)}static onMouseDrag(e,t){void 0!==U.construction?U.drawShadow(e,t):(e.annotationInstance.geometryCommon.gcmdSelecting.deSelectAllObjects(),U.getRect(e,t))}static onMouseUp(e,t){U.construction&&(U.swap(U.construction),e.annotationInstance.activeCommandController.goToACMode(),U.construction.IsSelectable=!0,U.construction.isUnderConstruction=!1,U.construction.isHover=!1,5>(0,p.Sp)(U.construction.pts[0].vec,U.construction.pts[1].vec)&&(U.construction.pts[0].vec.x+=-60,U.construction.pts[0].vec.y+=-60,U.construction.pts[1].vec.x+=60,U.construction.pts[1].vec.y+=-60,U.construction.pts[2].vec.x+=60,U.construction.pts[2].vec.y+=60,U.construction.pts[3].vec.x+=-60,U.construction.pts[3].vec.y+=60),U.construction.isSelectedValue=!1,U.construction.isSelected=!1,U.construction.computeCenterVec(),U.construction.emitAddStack(),U.construction=void 0,U.isDone=!0)}static swap(e){let t,s,i=0;e.pts[0].vec.x>e.pts[1].vec.x&&(t=e.pts[0].vec.x,s=e.pts[0].vec.y,i=e.pts[0].vec.z,e.pts[0].vec.x=e.pts[1].vec.x,e.pts[0].vec.y=e.pts[1].vec.y,e.pts[0].vec.z=e.pts[1].vec.z,e.pts[1].vec.x=t,e.pts[1].vec.y=s,e.pts[1].vec.z=i,t=e.pts[3].vec.x,s=e.pts[3].vec.y,i=e.pts[3].vec.z,e.pts[3].vec.x=e.pts[2].vec.x,e.pts[3].vec.y=e.pts[2].vec.y,e.pts[3].vec.z=e.pts[2].vec.z,e.pts[2].vec.x=t,e.pts[2].vec.y=s,e.pts[2].vec.z=i),e.pts[0].vec.y>e.pts[3].vec.y&&(t=e.pts[0].vec.x,s=e.pts[0].vec.y,i=e.pts[0].vec.z,e.pts[0].vec.x=e.pts[3].vec.x,e.pts[0].vec.y=e.pts[3].vec.y,e.pts[0].vec.z=e.pts[3].vec.z,e.pts[3].vec.x=t,e.pts[3].vec.y=s,e.pts[3].vec.z=i,t=e.pts[1].vec.x,s=e.pts[1].vec.y,i=e.pts[1].vec.z,e.pts[1].vec.x=e.pts[2].vec.x,e.pts[1].vec.y=e.pts[2].vec.y,e.pts[1].vec.z=e.pts[2].vec.z,e.pts[2].vec.x=t,e.pts[2].vec.y=s,e.pts[2].vec.z=i)}initComponent(){this.styleComponent=new H(this),this.renderer=new B(this),this.interaction=new W(this),this.transformation=new _(this)}initShape(){this.dimension=new G(this),this.isFill=!0,this.scene.addACircleWrapper(this)}computeCenterVec(){let e=(0,p.mI)([this.pts[0].vec,this.pts[1].vec,this.pts[2].vec,this.pts[3].vec]);return this.vec.x=e.x,this.vec.y=e.y,this.vec}computeRecPts(){let e=this.pts[0].vec,t=this.pts[2].vec,s=0,i=0,n=0;s=e.x<t.x?e.x:t.x,i=e.y<t.y?e.y:t.y,n=e.z<t.z?e.z:t.z;let o=new p.h9(s,i,n);s=e.x>t.x?e.x:t.x,i=e.y>t.y?e.y:t.y,n=e.z>t.z?e.z:t.z;let r=new p.h9(s,i,n);this.updatePos(1,r.x,o.y,o.z),this.updatePos(3,o.x,r.y,o.z);for(let e=0;e<this.pts.length;++e)this.pts[e].addEdge(this),this.pts[e].type=p.zq.ANODE_CIRCLE;this.updateVecsCP()}getRelatedVec(){let e=[];for(let t=0;t<this.pts.length;++t){let s=this.pts[t];e.push(new p.h9(s.vec.x-this.vec.x,s.vec.y-this.vec.y,s.vec.z-this.vec.z))}}updatePos(e,t,s,i){this.pts[e].vec.x=t,this.pts[e].vec.y=s,this.pts[e].vec.z=i}getNodePopup(){return this.pts[this.pts.length-2]}getArea(){return(this.pts[1].vec.x-this.pts[0].vec.x)*(this.pts[2].vec.y-this.pts[0].vec.y)}getLog(){return this.interaction.getLog()}set visibility(e){this.visibilityValue=e;for(let t=0;t<this.pts.length;++t)this.pts[t].visibilityValue=e}set IsHiddenChildren(e){this.isHiddenPre=this.isHiddenValue,this.isHiddenValue=e;for(let t=0;t<this.pts.length;++t)this.pts[t].isHiddenValue=e}set isHidden(e){this.isHiddenPre=this.isHiddenValue,this.isHiddenValue=e,this.IsHiddenChildren=e,this.scene.annotationInstance.io.eventListenerAnnotation.hideStack(this.toJSON())}move(e,t){if(this.isRemove||!this.isRenderable||this.isHiddenValue)return;let s=e-this.vec.x-(this.pts[1].vec.x-this.pts[0].vec.x)*.5,i=t-this.vec.y-(this.pts[2].vec.y-this.pts[0].vec.y)*.5;for(let e=0;e<this.pts.length;++e)this.pts[e].vec.x+=s,this.pts[e].vec.y+=i;this.computeCenterVec()}goToBlackhole(){this.isSelectable=!1,this.needBlackhole=!0,this.pts.forEach(e=>{e.goToBlackhole()})}translateByMouseEventData(e){return this.transformation.translateByMouseEventData(e)}translate(e,t){return this.transformation.translate(e,t)}computeConstraintRatio(e,t,s){return this.transformation.computeConstraintRatio(e,t,s)}isMouseInside(e,t){return this.interaction.isMouseInside(e,t)}updateVecsBySnapping(e,t,s){let i=-1;for(let t=0;t<this.pts.length;++t)e===this.pts[t]&&(i=t);0===i?(this.pts[1].vec.y+=s,this.pts[3].vec.x+=t):1===i?(this.pts[0].vec.y+=s,this.pts[2].vec.x+=t):2===i?(this.pts[3].vec.y+=s,this.pts[1].vec.x+=t):3===i&&(this.pts[2].vec.y+=s,this.pts[0].vec.x+=t),this.computeCenterVec()}initVecsCP(){this.vecsCP.push(new p.h9(this.pts[0].vec.x+(this.pts[1].vec.x-this.pts[0].vec.x)*.5,this.pts[0].vec.y+(this.pts[1].vec.y-this.pts[0].vec.y)*.5,0)),this.vecsCP.push(new p.h9(this.pts[1].vec.x+(this.pts[2].vec.x-this.pts[1].vec.x)*.5,this.pts[1].vec.y+(this.pts[2].vec.y-this.pts[1].vec.y)*.5,0)),this.vecsCP.push(new p.h9(this.pts[2].vec.x+(this.pts[3].vec.x-this.pts[2].vec.x)*.5,this.pts[2].vec.y+(this.pts[3].vec.y-this.pts[2].vec.y)*.5,0)),this.vecsCP.push(new p.h9(this.pts[3].vec.x+(this.pts[0].vec.x-this.pts[3].vec.x)*.5,this.pts[3].vec.y+(this.pts[0].vec.y-this.pts[3].vec.y)*.5,0))}updateVecsCP(){this.vecsCP[0].x=this.pts[0].vec.x+(this.pts[1].vec.x-this.pts[0].vec.x)*.5,this.vecsCP[0].y=this.pts[0].vec.y+(this.pts[1].vec.y-this.pts[0].vec.y)*.5,this.vecsCP[1].x=this.pts[1].vec.x+(this.pts[2].vec.x-this.pts[1].vec.x)*.5,this.vecsCP[1].y=this.pts[1].vec.y+(this.pts[2].vec.y-this.pts[1].vec.y)*.5,this.vecsCP[2].x=this.pts[2].vec.x+(this.pts[3].vec.x-this.pts[2].vec.x)*.5,this.vecsCP[2].y=this.pts[2].vec.y+(this.pts[3].vec.y-this.pts[2].vec.y)*.5,this.vecsCP[3].x=this.pts[3].vec.x+(this.pts[0].vec.x-this.pts[3].vec.x)*.5,this.vecsCP[3].y=this.pts[3].vec.y+(this.pts[0].vec.y-this.pts[3].vec.y)*.5}getVecs(){this.vecs=[];for(let e=0;e<this.pts.length;++e)this.vecs.push(this.pts[e].vec);return this.vecs}remove(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];for(let e=0;e<this.pts.length;++e)this.pts[e].remove();if(e){let e=this.toJSON();e&&this.scene.annotationInstance.io.eventListenerAnnotation.removeGeometryStack([e])}this.deepRemove()}deepRemove(){this.isSelectable=!1,this.isRenderable=!1,this.hidePopUpSummary(),this.scene.removeACircle(this),this.scene.removeGeometry(this)}getParentType(){return"ACircle,ID:"+this.id}hide(){throw Error("Method not implemented.")}set IsSelectable(e){this.isSelectable=e;for(let t=0;t<this.pts.length;++t)this.pts[t].isSelectable=e}get IsSelectable(){return this.isSelectable}set IsRenderable(e){this.isRenderable=e;for(let t=0;t<this.pts.length;++t)this.pts[t].isRenderable=e}get isSelected(){return this.isSelectedValue}set isSelected(e){for(let t of(this.isSelectedValue=e,this.pts))t.isRenderable=e,t.isSelectable=e,t.isSelectedValue=e;this.scene.annotationInstance.io.eventListenerAnnotation.selectionStack(this.toJSON())}get isHover(){return this.isHoverValue}set isHover(e){if(!this.isUnderConstruction){if(this.isHoverValue=e,this.isHoverValue&&!this.isHoverPre?this.scene.annotationInstance.io.eventListenerAnnotation.hoverStack(this.toJSON()):!this.isHoverValue&&this.isHoverPre&&this.scene.annotationInstance.io.eventListenerAnnotation.hoverStack(this.toJSON()),this.isHoverPre=this.isHoverValue,!this.isSelectedValue)for(let t of this.pts)t.isRenderable=e,t.isSelectable=e;e||(this.needEmitHoverPost=!0,this.hidePopUpSummary())}}getNode(){let e=[];for(let t=0;t<this.pts.length;++t)e.push(this.pts[t].vec);return e}toJSON(){let e=new g(this.id,this.type,this.isSelectedValue,this.isHoverValue,this.isHiddenValue);e.pushNode(this.getNode());let t=this.styleComponent.toJson();return t&&(e.styles=t),e}deepCopy(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2];let s=this.toJSON(),i=U.fromJSON(this.scene,s,!0,!0);return i.move(e,t),i.emitAddStack(),i}get width(){return this.pts[1].vec.x-this.pts[0].vec.x}get height(){return this.pts[2].vec.y-this.pts[1].vec.y}computeBoundingVecs(){this.vecs=[];for(let e=0;e<this.pts.length;++e)this.vecs.push(this.pts[e].vec)}getBoundary(){return this.getVecs()}computeVec(){this.computeCenterVec(),this.computeBoundingVecs(),this.updateVecsCP()}mouseRightClick(){this.isFill=!this.isFill,this.isConstraintRatio=!this.isConstraintRatio}updateActiveCursor(){this.interaction.updateActiveMouseCursor()}renderPost(e){this.renderer.renderPost(e)}getVecForSnapping(){return this.vecSelectedSnapping}isMouseInsideSnapFrom(e){return this.interaction.isMouseInsideSnapFrom(e)}CheckAttachedTextleaderline(){return this.interaction.checkAttachedTextleaderline()}updateLeaderlineSnap(e,t){return this.interaction.updateLeaderlineSnap(e,t)}constructor(e,t,s,i=0,n=!1,o=8){super(e),this.vecsCP=[],this.vecRotationHandler=new p.h9(0,0,0),this.isRotate=!1,this.isHoverDuplicatedVecs=!1,this.vecSelected=-1,this.vecSelectedCp=-1,this.enableRotate=!1,this.type=p.zq.CIRCLE,this.pts=[],this.pts.push(new k(e,t,s,0,n)),this.pts.push(new k(e,t,s,0,n)),this.pts.push(new k(e,t,s,0,n)),this.pts.push(new k(e,t,s,0,n));for(let e=0;e<this.pts.length;++e)n&&(this.pts[e].isHoverValue=!1),this.pts[e].type=p.zq.ANODE_CIRCLE;this.lineWidth=o,this.initComponent(),this.initVecsCP(),this.computeRecPts(),this.isConstraintRatio=!1,this.initShape()}}U.isDone=!1,U.split=!1,U.isConstraintRatio=!1;class q{isMouseInside(e,t){let s=new p.h9(e,t);return!this.host.isRemove&&!!this.host.isRenderable&&!this.host.isHiddenValue&&!0!==this.host.isUnderConstruction&&void 0!==this.host.isUnderConstruction&&!this.geo.isCollapse&&((this.host.isRotate=!1,10>(0,p.Sp)(this.host.vecRotationHandler,s))?(this.host.isRotate=!0,this.host.isHover=!0,!0):!!(this.isMouseInsidePt(s)||this.isMouseInsideCP(s))||(this.checkDistance(e,t)?(this.host.isHover=!0,!0):(this.host.isHover=!1,!1)))}getLog(){return"GUID : "+this.host.id+"/TYPE : "+this.host.type.toString()+"/Screen : /Area : "+this.host.getArea().toFixed(3).toString()+" m2/IsSEL : "+this.host.isSelectedValue+"/isSelable : "+this.host.isSelectable}hide(){}isMouseInsidePt(e){for(let t=0;t<this.host.pts.length;++t)if(10>(0,p.Sp)(this.host.pts[t].vec,e))return this.host.vecSelected=t,!0;return this.host.vecSelected=-1,!1}isMouseInsideCP(e){for(let t=0;t<this.host.vecsCP.length;++t)if(10>(0,p.Sp)(this.host.vecsCP[t],e))return this.host.vecSelectedCp=t,this.host.isHoverDuplicatedVecs=!1,!0;return this.host.vecSelectedCp=-1,!1}checkDistance(e,t){let s=new p.h9(e,t),i=this.host.pts.length;for(let e=0;e<i;++e)if(e<i-1){if((0,p.xs)(s,this.host.pts[e].vec,this.host.pts[e+1].vec)<this.host.lineWidth)return!0}else if((0,p.xs)(s,this.host.pts[e].vec,this.host.pts[0].vec)<this.host.lineWidth)return!0;return!!(this.host.isFill&&(0,p.X0)(s,this.host.vecs))}updateActiveMouseCursor(){this.host.vecSelectedCp>-1?this.setMouseCursorMidCP():this.setMouseCursorCP()}setMouseCursorCP(){this.host.scene.capturePT?this.host.pts.indexOf(this.host.scene.capturePT)%2==0?this.host.scene.annotationInstance.activeCommandController.activeMouseCursor.setActiveCursor(p.CF.NWSEresize):this.host.scene.annotationInstance.activeCommandController.activeMouseCursor.setActiveCursor(p.CF.NESWresize):this.host.scene.annotationInstance.activeCommandController.activeMouseCursor.setActiveCursorDrag()}setMouseCursorMidCP(){-1===this.host.vecSelectedCp&&this.host.scene.annotationInstance.activeCommandController.activeMouseCursor.setActiveCursorDrag(),this.host.vecSelectedCp%2==0?this.host.scene.annotationInstance.activeCommandController.activeMouseCursor.setActiveCursor(p.CF.NSresize):this.host.scene.annotationInstance.activeCommandController.activeMouseCursor.setActiveCursor(p.CF.EWresize)}isMouseInsideSnapFrom(e){this.host.vecSelectedSnapping=void 0;for(let t=0;t<this.host.pts.length;t+=1)if((0,p.Sp)(this.host.pts[t].vec,e)<this.host.scene.annotationInstance.activeCommandController.acProperties.toleranceSnapping)return this.host.vecSelectedSnapping=this.host.pts[t].vec,this.host.vecSelectedSnapping;if((0,p.Sp)(this.host.vec,e)<this.host.scene.annotationInstance.activeCommandController.acProperties.toleranceSnapping)return this.host.vecSelectedSnapping=this.host.vec,this.host.vecSelectedSnapping}checkAttachedTextleaderline(){if(!this.host.textLeaderline||!this.host.textLeaderline.leaderline)return!1;let e=!1;for(let t=0;t<this.host.pts.length;++t)5>(0,p.Sp)(this.host.pts[t].vec,this.host.textLeaderline.leaderline.v2)&&(e=!0);5>(0,p.Sp)(this.host.vec,this.host.textLeaderline.leaderline.v2)&&(e=!0);for(let t=0;t<this.host.vecsCP.length;++t)5>(0,p.Sp)(this.host.vecsCP[t],this.host.textLeaderline.leaderline.v2)&&(e=!0);return!!e||(this.host.textLeaderline.attachedShape=void 0,this.host.textLeaderline=void 0,!1)}updateLeaderlineSnap(e,t){if(this.host.computeCenterVec(),5>(0,p.Sp)(this.host.vec,e)){this.host.vecSelectedSnapping=this.host.vec;return}for(let t=0;t<this.host.pts.length;++t)if(5>(0,p.Sp)(this.host.pts[t].vec,e)){this.host.vecSelectedSnapping=this.host.pts[t].vec;return}}constructor(e){this.geo=e,this.host=e}}class J extends x{renderPost(e){this.interpolateColor.update(),this.timer.update(),this.timer.updatePopupSummery(),this.host.transformation.updateRotationAbsolute(),this.host.scene.annotationInstance.activeCommandController.acProperties.isPanning&&this.host.computeVec(),this.host.scene.annotationInstance.activeCommandController.acProperties.showUnit&&this.host.isConstraintRatio&&this.host.isHoverValue&&(e.textAlign="center",e.fillStyle="#ffffff",100<Math.abs(this.host.width)&&e.fillText("constrained by ratio",this.host.vec.x,this.host.vec.y)),this.host.scene.annotationInstance.activeCommandController.acProperties.showUnit&&(this.host.isHoverValue||this.host.isUnderConstruction)&&(this.host.dimension.renderLengthRect(e,this.host.vecs),this.host.isConstraintRatio?this.host.dimension.renderTotalAreaRect(e,this.host.vecs,", constrained by ratio"):this.host.dimension.renderTotalAreaRect(e,this.host.vecs)),this.renderPostGeometry(e,this.host.scene.annotationInstance.geometryCommon.gcmdSupporting.toScreenVecsOnCropping(this.host.getVecs()))}renderPostGeometry(e,t){let s=this.host.scene.annotationInstance.geometryCommon.gcmdSupporting.toScreenVecOnCropping(this.host.vec);this.host.isHoverValue||this.host.isSelectedValue?(this.host.scene.annotationInstance.renderer.draw.shape.area.rectangleHover(e,this.host.styleComponent.renderStyle,t,this.host.isGrayColor,this.host.visibilityValue,this.host.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.host.renderer.tOver),this.host.isHoverValue,this.host.isSelectedValue),this.host.renderer.tOver+=this.host.scene.annotationInstance.renderer.dt,this.host.renderer.tDown1=0,this.host.isLeave=!0,this.host.scene.annotationInstance.implementations.app.model.appCoreWrapper.appControllerStatus.mode===p.An.Drawing&&this.host.enableRotate&&this.renderRotationHandler(e)):this.host.renderer.tOver=0,this.host.scene.annotationInstance.renderer.draw.shape.area.rectangle(e,this.host.styleComponent.renderStyle,t,this.host.vec,!0,!0,!1),(this.host.isHoverValue||this.host.isSelectedValue||this.host.isUnderConstruction)&&this.host.scene.annotationInstance.implementations.app.model.appCoreWrapper.appControllerStatus.mode===p.An.Drawing&&(this.host.scene.annotationInstance.renderer.draw.shape.point.centerPointCircle(e,s.x,s.y),this.renderCP(e,t)),this.t+=this.host.scene.annotationInstance.renderer.dt,this.renderPostGeometryOffScreen(t)}renderCP(e,t){this.host.updateVecsCP();let s=0,i=0;for(let n=0;n<t.length;++n)n===t.length-1?(s=t[n].x+(t[0].x-t[n].x)*.5,i=t[n].y+(t[0].y-t[n].y)*.5):(s=t[n].x+(t[n+1].x-t[n].x)*.5,i=t[n].y+(t[n+1].y-t[n].y)*.5),this.host.scene.annotationInstance.renderer.draw.shape.node.nodeHover(e,this.host.pts[0].styleComponent.renderStyle,s,i,this.host.scene.annotationInstance.graphicsCoreWrapper.scaleScreenByRatioImageSize,1)}renderPostGeometryOffScreen(e){this.host.scene.annotationInstance.renderer.offscreen.rectangleOffScreen(this.host.scene.annotationInstance.renderer.ctxOffscreen,this.host.hashColor,e)}renderRotationHandler(e){this.host.isHover&&(this.host.enableRotate&&this.host.transformation.updateRotationHandler(),e.strokeStyle=this.host.styleComponent.renderStyle.colorStroke,e.beginPath(),e.moveTo(this.host.vecRotationHandler.x,this.host.vecRotationHandler.y),e.lineTo(this.host.vecs[0].x+(this.host.vecs[1].x-this.host.vecs[0].x)*.5,this.host.vecs[0].y+(this.host.vecs[1].y-this.host.vecs[0].y)*.5),e.closePath(),e.stroke(),e.fillStyle=this.host.styleComponent.renderStyle.colorStroke,e.beginPath(),e.arc(this.host.vecRotationHandler.x,this.host.vecRotationHandler.y,7,0,2*Math.PI),e.closePath(),e.fill())}constructor(e){super(e),this.host=e}}class Y extends O{updateStyle(){if(!this.isCustom){this.state.themeColorId=h.AccentColor1,this.isCustom=!0,b.updateRenderStylePolygon(this.renderStyle,this.geo.scene.annotationInstance.customization.themeCurrent),b.updateRenderStylePolygonNode(this.renderStyleNode,this.geo.scene.annotationInstance.customization.themeCurrent);for(let e=0;e<this.geo.pts.length;++e)this.geo.pts[e].styleComponent.updateStyleForNode(this.renderStyleNode)}}updateColor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;this.isCustom=!0,void 0===e&&(e=this.geo.scene.annotationInstance.activeCommandController.activeColorController.activeColor),b.updateRenderColorPolygon(this.renderStyle,this.geo.scene.annotationInstance.customization.themeCurrent,e,[0,0,0,0]),b.updateRenderColorPolygonNode(this.renderStyleNode,this.geo.scene.annotationInstance.customization.themeCurrent,e);for(let e=0;e<this.geo.pts.length;++e)this.geo.pts[e].styleComponent.updateStyleForNode(this.renderStyleNode);this.tempColorRgba=e}updateStyleCustom(e){if(e.width&&(this.state.width=e.width),void 0!==e.color&&(this.state.themeColorId=e.color),e.colorRgba.length>0&&e.fill.length>0){this.tempColorRgba=e.colorRgba,this.tempFillRgba=e.fill,b.updateRenderStylePolygonCustom(this.renderStyle,this.geo.scene.annotationInstance.customization.themeCurrent,e.colorRgba,e.fill),b.updateRenderStylePolygonNodeCustom(this.renderStyleNode,this.geo.scene.annotationInstance.customization.themeCurrent,e.colorRgba,e.fill);for(let e=0;e<this.geo.pts.length;++e)this.geo.pts[e].styleComponent.updateStyleForNode(this.renderStyleNode)}return e.scale&&(this.renderStyle.scaleLocal=e.scale,this.state.scale=e.scale),this.isCustom=!0,!0}setDash(e){this.renderStyle.dash=e,this.geo.scene.annotationInstance.io.eventListenerAnnotation.addGeometryStack(this.geo.toJSON())}toJson(){if(!this.isCustom)return;let e={width:this.state.width,scale:this.renderStyle.scaleLocal,colorRgba:this.tempColorRgba,fill:this.tempFillRgba};return this.state.themeColorId!==h.AccentColor1&&(e.color=this.state.themeColorId),e}isSameStyle(e){if(e.colorRgba.length===this.tempColorRgba.length||e.fill.length===this.tempFillRgba){for(let t=0;t<e.colorRgba.length;t++)if(e.colorRgba[t]!==this.tempColorRgba[t])return!1;for(let t=0;t<e.fill.length;t++)if(e.fill[t]!==this.tempFillRgba[t])return!1}return!0}constructor(e){super(e),this.updateStyle(),this.updateColor()}}class j extends F{translateByMouseEventData(e){if(this.host.vecSelected>-1){this.translateByMouseEventDataNode(e,this.host.vecSelected);return}if(this.host.isRotate){this.rotatingShape(e.x,e.y);return}let t=e.x-e.preX,s=e.y-e.preY;if(-1!==this.host.vecSelectedCp){this.translateCPByMouseEventData(e),this.host.computeCenterVec(),this.updateTextleaderlineVec();return}if(-1!==this.host.vecSelected){this.host.pts[this.host.vecSelected].translateByMouseEventData(e),this.host.computeCenterVec(),this.updateTextleaderlineVec();return}for(let e=0;e<this.host.pts.length;++e)this.host.pts[e].vec.x+=t,this.host.pts[e].vec.y+=s;this.host.computeCenterVec(),this.host.textLeaderline&&(this.host.vecSelectedSnapping||this.host.updateLeaderlineSnap(this.host.textLeaderline.vec,5),this.updateTextleaderlineVec(),this.host.textLeaderline.translateByMouseEventData(e))}translateByMouseEventDataNode(e,t){for(let e=0;e<this.host.pts.length;++e)this.host.pts[e].isRenderable=!0;this.host.textLeaderline&&!this.host.vecSelectedSnapping&&this.host.updateLeaderlineSnap(this.host.textLeaderline.vec,5);let s=e.x-e.preX,i=e.y-e.preY;0===t||2===t?Math.abs(s)>Math.abs(i)?i=s:s=i:(1===t||3===t)&&(Math.abs(s)>Math.abs(i)?i=-1*s:s=-1*i),this.host.isConstraintRatio?this.computeConstraintRatio(t,s,i):0===t?(this.translatePt(0,s,i),this.translatePt(3,s,0),this.translatePt(1,0,i),(this.host.width<16||this.host.height<16)&&(this.translatePt(0,-s,-i),this.translatePt(3,-s,0),this.translatePt(1,0,-i))):1===t?(this.translatePt(1,s,i),this.translatePt(2,s,0),this.translatePt(0,0,i),(this.host.width<16||this.host.height<16)&&(this.translatePt(1,-s,-i),this.translatePt(2,-s,0),this.translatePt(0,0,-i))):2===t?(this.translatePt(2,s,i),this.translatePt(1,s,0),this.translatePt(3,0,i),(this.host.width<16||this.host.height<16)&&(this.translatePt(2,-s,-i),this.translatePt(1,-s,0),this.translatePt(3,0,-i))):3===t&&(this.translatePt(3,s,i),this.translatePt(0,s,0),this.translatePt(2,0,i),(this.host.width<16||this.host.height<16)&&(this.translatePt(3,-s,-i),this.translatePt(0,-s,0),this.translatePt(2,0,-i))),this.host.computeCenterVec(),this.host.transformation.updateTextleaderlineVec()}translate(e,t){}updateRotationAbsolute(){this.angle=180*Math.atan2(this.host.vecRotationHandler.y-this.host.vec.y,this.host.vecRotationHandler.x-this.host.vec.x)/Math.PI}translatePt(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.host.pts[e].vec.x+=t,this.host.pts[e].vec.y+=s}translateCPByMouseEventData(e){if(0===this.host.vecSelectedCp){let t=e.y-this.host.pts[0].vec.y;this.host.pts[0].vec.y+=t,this.host.pts[1].vec.y+=t,this.host.height<16&&(this.host.pts[0].vec.y-=t,this.host.pts[1].vec.y-=t)}else if(2===this.host.vecSelectedCp){let t=e.y-this.host.pts[2].vec.y;this.host.pts[2].vec.y+=t,this.host.pts[3].vec.y+=t,this.host.height<16&&(this.host.pts[2].vec.y-=t,this.host.pts[3].vec.y-=t)}else if(1===this.host.vecSelectedCp){let t=this.host.isHoverDuplicatedVecs?e.x:e.x-this.host.pts[1].vec.x;this.host.pts[1].vec.x+=t,this.host.pts[2].vec.x+=t,this.host.width<16&&(this.host.pts[1].vec.x-=t,this.host.pts[2].vec.x-=t)}else if(3===this.host.vecSelectedCp){let t=this.host.isHoverDuplicatedVecs?e.x:e.x-this.host.pts[0].vec.x;this.host.pts[0].vec.x+=t,this.host.pts[3].vec.x+=t,this.host.width<16&&(this.host.pts[0].vec.x-=t,this.host.pts[3].vec.x-=t)}}rotatingShape(e,t){let s=180*Math.atan2(t-this.host.vec.y,e-this.host.vec.x)/Math.PI-this.angle,i=this.rotateVecsLoal([this.host.vecRotationHandler],this.host.vec,s);this.host.vecRotationHandler.x=i[0].x,this.host.vecRotationHandler.y=i[0].y,this.host.vecRotationHandler.z=i[0].z,i=this.rotateVecsLoal(this.host.vecs,this.host.vec,s),this.host.vecs[0].x=i[0].x,this.host.vecs[0].y=i[0].y,this.host.vecs[0].z=i[0].z,this.host.vecs[1].x=i[1].x,this.host.vecs[1].y=i[1].y,this.host.vecs[1].z=i[1].z,this.host.vecs[2].x=i[2].x,this.host.vecs[2].y=i[2].y,this.host.vecs[2].z=i[2].z,this.host.vecs[3].x=i[3].x,this.host.vecs[3].y=i[3].y,this.host.vecs[3].z=i[3].z,this.angle+=s}rotateVecsLoal(e,t,s){let i=new p.h9(-t.x,-t.y,-t.z),n=(0,p.Vt)(e,i);return n=(0,p.DM)(n,s),n=(0,p.Vt)(n,t)}updateTextleaderlineVec(){let e=0;this.host.vecSelectedSnapping&&this.host.textLeaderline&&this.host.textLeaderline.leaderline&&(e=this.host.textLeaderline.leaderline.v2.x-this.host.vecSelectedSnapping.x,this.host.textLeaderline.leaderline.v2.x=this.host.vecSelectedSnapping.x,this.host.textLeaderline.widthOffset+=e,e=this.host.textLeaderline.leaderline.v2.y-this.host.vecSelectedSnapping.y,this.host.textLeaderline.leaderline.v2.y=this.host.vecSelectedSnapping.y,this.host.textLeaderline.heightOffset+=e,this.host.textLeaderline.computeCenterVec())}updateRotationHandler(){this.host.vecRotationHandler.x=this.host.vecs[0].x+(this.host.vecs[1].x-this.host.vecs[0].x)*.5,this.host.vecRotationHandler.y=this.host.vecs[0].y+(this.host.vecs[1].y-this.host.vecs[0].y)*.5;let e=(0,p.ir)(this.host.vecs[0],this.host.vecs[1]),t=new p.h9(this.host.vecs[1].x-this.host.vecs[0].x,this.host.vecs[1].y-this.host.vecs[0].y,this.host.vecs[1].z-this.host.vecs[0].z),s=(0,p.ir)(e,t);s.unitize(),this.host.vecRotationHandler.x+=20*s.x,this.host.vecRotationHandler.y+=20*s.y,(0,p.Sp)(this.host.vec,this.host.vecRotationHandler)<.5*this.host.height&&(this.host.vecRotationHandler.x+=-(40*s.x),this.host.vecRotationHandler.y+=-(40*s.y))}computeConstraintRatio(e,t,s){let i=this.resizeConstraintRatio();if(0===e){if(Math.abs(t)>Math.abs(s)){let s=(0,p.kC)(i[0],i[1],i[0]+t);this.host.pts[e].vec.x+=t,this.host.pts[e].vec.y-=i[1]-s[1],this.host.pts[e+1].vec.y-=i[1]-s[1],this.host.pts[e+3].vec.x+=t}else{let t=(0,p.Ux)(i[0],i[1],i[1]+s);this.host.pts[e].vec.x-=i[0]-t[0],this.host.pts[e].vec.y+=s,this.host.pts[e+1].vec.y+=s,this.host.pts[e+3].vec.x-=i[0]-t[0]}}else if(1===e){if(Math.abs(t)>Math.abs(s)){this.host.pts[e].vec.x+=t;let s=(0,p.kC)(i[0],i[1],i[0]+t);this.host.pts[e].vec.y+=i[1]-s[1],this.host.pts[e+1].vec.x+=t,this.host.pts[e-1].vec.y+=i[1]-s[1]}else{let t=(0,p.Ux)(i[0],i[1],i[1]+s);this.host.pts[e].vec.x+=i[0]-t[0],this.host.pts[e].vec.y+=s,this.host.pts[e+1].vec.x+=i[0]-t[0],this.host.pts[e-1].vec.y+=s}}else if(2===e){if(Math.abs(t)>Math.abs(s)){let s=(0,p.kC)(i[0],i[1],i[0]+t);this.host.pts[e].vec.x+=t,this.host.pts[e].vec.y=this.host.pts[0].vec.y+s[1],this.host.pts[e-1].vec.x+=t,this.host.pts[e+1].vec.y=this.host.pts[0].vec.y+s[1]}else{let t=(0,p.Ux)(i[0],i[1],i[1]+s);this.host.pts[e].vec.x=this.host.pts[0].vec.x+t[0],this.host.pts[e].vec.y+=s,this.host.pts[e-1].vec.x=this.host.pts[0].vec.x+t[0],this.host.pts[e+1].vec.y+=s}}else if(3===e){if(Math.abs(t)>Math.abs(s)){let s=(0,p.kC)(i[0],i[1],i[0]+t);this.host.pts[e].vec.x+=t,this.host.pts[e].vec.y+=i[1]-s[1],this.host.pts[e-1].vec.y+=i[1]-s[1],this.host.pts[0].vec.x+=t}else{let t=(0,p.Ux)(i[0],i[1],i[1]+s);this.host.pts[e].vec.x+=i[0]-t[0],this.host.pts[e].vec.y+=s,this.host.pts[e-1].vec.y+=s,this.host.pts[0].vec.x+=i[0]-t[0]}}}resizeConstraintRatio(){return[this.host.pts[1].vec.x-this.host.pts[0].vec.x,this.host.pts[2].vec.y-this.host.pts[1].vec.y]}constructor(e){super(e),this.anglePre=0,this.angle=0,this.geo=e,this.host=e}}class X extends S{static getRectangleFromVoice(e){let t=new p.h9(.5*e.annotationInstance.geometryCommon.gcmdProcessing.width,.5*e.annotationInstance.geometryCommon.gcmdProcessing.height);this.getRectByVecs(e,[new p.h9(t.x-100,t.y-100),new p.h9(t.x+100,t.y-100),new p.h9(t.x+100,t.y+100),new p.h9(t.x-100,t.y+100)])}static findAtPoint(e){}static computeHover(e){X.findAtPoint(e)}static getRectByVecs(e,t){let s=(0,p.HP)(t),i=new X(e,s[0].x,s[0].y,0,!1),n=s[1].x-s[0].x,o=s[1].y-s[0].y;i.pts[1].vec.x+=n,i.pts[2].vec.x+=n,i.pts[2].vec.y+=o,i.pts[3].vec.y+=o,i.IsSelectable=!0,i.isUnderConstruction=!1,i.updatePos(2,i.pts[1].vec.x+1,i.pts[3].vec.y+1,0),e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(i.toJSON())}static getRectByTouch(e,t){let s=new p.h9(t.x,t.y,0);this.getRectByVecs(e,[new p.h9(s.x-100,s.y-100),new p.h9(s.x+100,s.y-100),new p.h9(s.x+100,s.y+100),new p.h9(s.x-100,s.y+100)])}static getRect(e,t){if(void 0===X.construction){X.construction=new X(e,t.x,t.y),X.construction.IsSelectable=!1;return}X.construction.isUnderConstruction=!1,X.construction.IsSelectable=!0,X.construction.updatePos(2,X.construction.pts[1].vec.x,X.construction.pts[3].vec.y+.1,0),e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(X.construction.toJSON()),X.construction=void 0}static getRectByPt(e){}static drawShadow(e,t){void 0===X.construction?new k(e,t.x,t.y,0).isSelectable=!1:(X.construction.pts[1].move(t.x,X.construction.pts[1].vec.y),X.construction.pts[2].move(t.x,t.y),X.construction.pts[3].move(X.construction.pts[3].vec.x,t.y),X.construction.computeCenterVec())}static fromJSON(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=k.getNodeFromJSON(e,t.nodes[0],s),o=new X(e,n.vec.x,n.vec.y,0,s);n.remove();for(let i=1;i<o.pts.length;++i){let n=k.getNodeFromJSON(e,t.nodes[i],s);o.pts[i].vec.x=n.vec.x,o.pts[i].vec.y=n.vec.y,o.pts[i].type=p.zq.ANODE_RECT,n.remove()}return o.type=p.zq[t.type],o.isHiddenValue=t.isHidden,t.isHidden?o.visibility=0:o.visibility=1,t.styles&&t.styles.dash&&(o.styleComponent.renderStyle.dash=t.styles.dash),i?o.id=e.getUUID():o.id=t.id,o.IsSelectable=!0,o.isUnderConstruction=!1,o.isHover=!1,t.styles&&o.updateStyleCustom(t.styles),o.initVecsHistory(),s||e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(o.toJSON()),o}static cancel(){void 0!==X.construction&&X.construction.remove(),X.construction=void 0}static mouseDown(e,t){}static onMouseLeftClick(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:128,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:128;X.construction&&X.construction.remove();let n=new X(e,t.x-.5*s,t.y-.5*i);n.pts[1].vec.x+=s,n.pts[2].vec.x+=s,n.pts[2].vec.y+=i,n.pts[3].vec.y+=i,n.IsSelectable=!0,n.isUnderConstruction=!1,n.isHover=!1,n.emitAddStack(),e.annotationInstance.activeCommandController.goToACMode()}static onMouseMiddleClick(e){}static onMouseRightClick(e){}static onMouseDoubleClick(e){}static onMouseMove(e,t){void 0!==X.construction&&X.drawShadow(e,t)}static onMouseDrag(e,t){void 0!==X.construction?X.drawShadow(e,t):(e.annotationInstance.geometryCommon.gcmdSelecting.deSelectAllObjects(),X.getRect(e,t))}static onMouseUp(e,t){X.construction&&(U.swap(X.construction),e.annotationInstance.activeCommandController.goToACMode(),X.construction.IsSelectable=!0,X.construction.isUnderConstruction=!1,X.construction.isHover=!1,5>(0,p.Sp)(X.construction.pts[0].vec,X.construction.pts[1].vec)&&(X.construction.pts[0].vec.x+=-60,X.construction.pts[0].vec.y+=-60,X.construction.pts[1].vec.x+=60,X.construction.pts[1].vec.y+=-60,X.construction.pts[2].vec.x+=60,X.construction.pts[2].vec.y+=60,X.construction.pts[3].vec.x+=-60,X.construction.pts[3].vec.y+=60),X.construction.isSelected=!1,X.construction.computeCenterVec(),X.construction.emitAddStack(),X.construction=void 0,X.isDone=!0)}initComponent(){this.styleComponent=new Y(this),this.renderer=new J(this),this.interaction=new q(this),this.transformation=new j(this)}initShape(){this.dimension=new G(this),this.isFill=!0,this.scene.addARectangleWrapper(this)}computeCenterVec(){return this.vec=(0,p.mI)([this.pts[0].vec,this.pts[1].vec,this.pts[2].vec,this.pts[3].vec]),this.vec}computeRecPts(){let e=this.pts[0].vec,t=this.pts[2].vec,s=0,i=0,n=0;s=e.x<t.x?e.x:t.x,i=e.y<t.y?e.y:t.y,n=e.z<t.z?e.z:t.z;let o=new p.h9(s,i,n);s=e.x>t.x?e.x:t.x,i=e.y>t.y?e.y:t.y,n=e.z>t.z?e.z:t.z;let r=new p.h9(s,i,n);this.updatePos(1,r.x,o.y,o.z),this.updatePos(3,o.x,r.y,o.z);for(let e=0;e<this.pts.length;++e)this.pts[e].addEdge(this),this.pts[e].type=p.zq.ANODE_RECT;this.updateVecsCP()}getRelatedVec(){let e=[];for(let t=0;t<this.pts.length;++t){let s=this.pts[t];e.push(new p.h9(s.vec.x-this.vec.x,s.vec.y-this.vec.y,s.vec.z-this.vec.z))}}updatePos(e,t,s,i){this.pts[e].vec.x=t,this.pts[e].vec.y=s,this.pts[e].vec.z=i}getNodePopup(){return this.pts[this.pts.length-2]}getArea(){return(this.pts[1].vec.x-this.pts[0].vec.x)*(this.pts[2].vec.y-this.pts[0].vec.y)}getLog(){return this.interaction.getLog()}set visibility(e){this.visibilityValue=e;for(let t=0;t<this.pts.length;++t)this.pts[t].visibilityValue=e}set IsHiddenChildren(e){this.isHiddenPre=this.isHiddenValue,this.isHiddenValue=e;for(let t=0;t<this.pts.length;++t)this.pts[t].isHiddenValue=e}set isHidden(e){this.isHiddenPre=this.isHiddenValue,this.isHiddenValue=e,this.IsHiddenChildren=e,this.scene.annotationInstance.io.eventListenerAnnotation.hideStack(this.toJSON())}move(e,t){if(this.isRemove||!this.isRenderable||this.isHiddenValue)return;let s=e-this.vec.x-(this.pts[1].vec.x-this.pts[0].vec.x)*.5,i=t-this.vec.y-(this.pts[2].vec.y-this.pts[0].vec.y)*.5;for(let e=0;e<this.pts.length;++e)this.pts[e].vec.x+=s,this.pts[e].vec.y+=i;this.computeCenterVec()}goToBlackhole(){this.isSelectable=!1,this.needBlackhole=!0,this.pts.forEach(e=>{e.goToBlackhole()})}translateByMouseEventData(e){return this.transformation.translateByMouseEventData(e)}translate(e,t){return this.transformation.translate(e,t)}computeConstraintRatio(e,t,s){return this.transformation.computeConstraintRatio(e,t,s)}isMouseInside(e,t){return this.interaction.isMouseInside(e,t)}updateVecsBySnapping(e,t,s){let i=-1;for(let t=0;t<this.pts.length;++t)e===this.pts[t]&&(i=t);0===i?(this.pts[1].vec.y+=s,this.pts[3].vec.x+=t):1===i?(this.pts[0].vec.y+=s,this.pts[2].vec.x+=t):2===i?(this.pts[3].vec.y+=s,this.pts[1].vec.x+=t):3===i&&(this.pts[2].vec.y+=s,this.pts[0].vec.x+=t),this.computeCenterVec()}initVecsCP(){this.vecsCP.push(new p.h9(this.pts[0].vec.x+(this.pts[1].vec.x-this.pts[0].vec.x)*.5,this.pts[0].vec.y+(this.pts[1].vec.y-this.pts[0].vec.y)*.5,0)),this.vecsCP.push(new p.h9(this.pts[1].vec.x+(this.pts[2].vec.x-this.pts[1].vec.x)*.5,this.pts[1].vec.y+(this.pts[2].vec.y-this.pts[1].vec.y)*.5,0)),this.vecsCP.push(new p.h9(this.pts[2].vec.x+(this.pts[3].vec.x-this.pts[2].vec.x)*.5,this.pts[2].vec.y+(this.pts[3].vec.y-this.pts[2].vec.y)*.5,0)),this.vecsCP.push(new p.h9(this.pts[3].vec.x+(this.pts[0].vec.x-this.pts[3].vec.x)*.5,this.pts[3].vec.y+(this.pts[0].vec.y-this.pts[3].vec.y)*.5,0))}updateVecsCP(){this.vecsCP[0].x=this.pts[0].vec.x+(this.pts[1].vec.x-this.pts[0].vec.x)*.5,this.vecsCP[0].y=this.pts[0].vec.y+(this.pts[1].vec.y-this.pts[0].vec.y)*.5,this.vecsCP[1].x=this.pts[1].vec.x+(this.pts[2].vec.x-this.pts[1].vec.x)*.5,this.vecsCP[1].y=this.pts[1].vec.y+(this.pts[2].vec.y-this.pts[1].vec.y)*.5,this.vecsCP[2].x=this.pts[2].vec.x+(this.pts[3].vec.x-this.pts[2].vec.x)*.5,this.vecsCP[2].y=this.pts[2].vec.y+(this.pts[3].vec.y-this.pts[2].vec.y)*.5,this.vecsCP[3].x=this.pts[3].vec.x+(this.pts[0].vec.x-this.pts[3].vec.x)*.5,this.vecsCP[3].y=this.pts[3].vec.y+(this.pts[0].vec.y-this.pts[3].vec.y)*.5}getVecs(){this.vecs=[];for(let e=0;e<this.pts.length;++e)this.vecs.push(this.pts[e].vec);return this.vecs}remove(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];for(let e=0;e<this.pts.length;++e)this.pts[e].remove();if(e){let e=this.toJSON();e&&this.scene.annotationInstance.io.eventListenerAnnotation.removeGeometryStack([e])}this.deepRemove()}deepRemove(){this.isSelectable=!1,this.isRenderable=!1,this.hidePopUpSummary(),this.scene.removeARectangleWrapper(this),this.scene.removeGeometry(this)}getParentType(){return"ARectangle,ID:"+this.id}hide(){throw Error("Method not implemented.")}set IsSelectable(e){this.isSelectable=e;for(let t=0;t<this.pts.length;++t)this.pts[t].isSelectable=e}get IsSelectable(){return this.isSelectable}set IsRenderable(e){this.isRenderable=e;for(let t=0;t<this.pts.length;++t)this.pts[t].isRenderable=e}get isSelected(){return this.isSelectedValue}set isSelected(e){for(let t of(this.isSelectedValue=e,this.pts))t.isRenderable=e,t.isSelectable=e,t.isSelectedValue=e;this.scene.annotationInstance.io.eventListenerAnnotation.selectionStack(this.toJSON())}get isHover(){return this.isHoverValue}set isHover(e){if(!this.isUnderConstruction){if(this.isHoverValue=e,this.isHoverValue&&!this.isHoverPre?this.scene.annotationInstance.io.eventListenerAnnotation.hoverStack(this.toJSON()):!this.isHoverValue&&this.isHoverPre&&this.scene.annotationInstance.io.eventListenerAnnotation.hoverStack(this.toJSON()),this.isHoverPre=this.isHoverValue,!this.isSelectedValue)for(let t of this.pts)t.isRenderable=e,t.isSelectable=e;e||(this.needEmitHoverPost=!0,this.hidePopUpSummary())}}getNode(){let e=[];for(let t=0;t<this.pts.length;++t)e.push(this.pts[t].vec);return e}toJSON(){let e=new g(this.id,this.type,this.isSelectedValue,this.isHoverValue,this.isHiddenValue);e.pushNode(this.getNode());let t=this.styleComponent.toJson();return t&&(e.styles=t),e}deepCopy(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2];let s=this.toJSON(),i=X.fromJSON(this.scene,s,!0,!0);return i.move(e,t),i.emitAddStack(),i}get width(){return this.pts[1].vec.x-this.pts[0].vec.x}get height(){return this.pts[2].vec.y-this.pts[1].vec.y}computeBoundingVecs(){this.vecs=[];for(let e=0;e<this.pts.length;++e)this.vecs.push(this.pts[e].vec)}getBoundary(){return this.getVecs()}computeVec(){this.computeBoundingVecs(),this.updateVecsCP(),this.computeCenterVec()}mouseRightClick(){this.isFill=!this.isFill,this.isConstraintRatio=!this.isConstraintRatio}renderPost(e){this.renderer.renderPost(e)}getVecForSnapping(){return this.vecSelectedSnapping}updateActiveCursor(){this.interaction.updateActiveMouseCursor()}isMouseInsideSnapFrom(e){return this.interaction.isMouseInsideSnapFrom(e)}checkAttachedTextleaderline(){return this.interaction.checkAttachedTextleaderline()}updateLeaderlineSnap(e,t){return this.interaction.updateLeaderlineSnap(e,t)}set textLeaderline(e){e!==this.textLeaderlineValue&&(this.textLeaderlineValue&&e&&this.textLeaderlineValue.removeLeaderline(),this.textLeaderlineValue=e)}get textLeaderline(){return this.textLeaderlineValue}constructor(e,t,s,i=0,n=!1,o=8){super(e),this.vecsCP=[],this.vecRotationHandler=new p.h9(0,0,0),this.isRotate=!1,this.isHoverDuplicatedVecs=!1,this.vecSelected=-1,this.vecSelectedCp=-1,this.enableRotate=!1,this.type=p.zq.RECTANGLE,this.pts=[],this.pts.push(new k(e,t,s,0,n)),this.pts.push(new k(e,t,s,0,n)),this.pts.push(new k(e,t,s,0,n)),this.pts.push(new k(e,t,s,0,n));for(let e=0;e<this.pts.length;++e)n&&(this.pts[e].isHoverValue=!1),this.pts[e].type=p.zq.ANODE_RECT;this.lineWidth=o,this.initComponent(),this.initVecsCP(),this.computeRecPts(),this.computeVec(),this.isConstraintRatio=!1,this.initShape()}}X.isDone=!1,X.split=!1,X.isConstraintRatio=!1;class K{static renderEdge(e,t,s,i,n,o){arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]&&arguments[7],arguments.length>8&&void 0!==arguments[8]&&arguments[8];let r=arguments.length>9?arguments[9]:void 0;for(let a=0;a<i.length-2;a+=2){let h=[i[a].x,i[a].y,i[a+1].x,i[a+1].y,i[a+2].x,i[a+2].y],c=[.5,.5,.5,.5,.5,.5],l=this.getControlPoints(i[a].x,i[a].y,i[a+1].x,i[a+1].y,i[a+2].x,i[a+2].y,.5);this.drawSpline(e,t,s,h,l,c,n,o),this.offscreenRender(e,s,r,h,l,h.length)}}static getControlPoints(e,t,s,i,n,o,r){let a=Math.sqrt(Math.pow(s-e,2)+Math.pow(i-t,2)),h=r*a/(a+Math.sqrt(Math.pow(n-s,2)+Math.pow(o-i,2))),c=r-h;return[s+h*(e-n),i+h*(t-o),s-c*(e-n),i-c*(t-o)]}static drawSpline(e,t,s,i,n,o,r,a){let h=i.length;r||a?(e.annotationInstance.renderer.draw.shape.curve.edgeCurveQuadraticHover(t,s,i[0],i[1],n[0],n[1],i[2],i[3],e.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tOver),r,a),e.annotationInstance.renderer.draw.shape.curve.edgeCurveQuadraticHover(t,s,i[h-2],i[h-1],n[2*h-10],n[2*h-9],i[h-4],i[h-3],e.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tOver),r,a),this.tOver+=.015,this.tDown1=0,this.isLeave=!0):this.tOver=0,e.annotationInstance.renderer.draw.shape.curve.curveQuadratic(t,s,i[0],i[1],n[0],n[1],i[2],i[3],r,a),e.annotationInstance.renderer.draw.shape.curve.curveQuadratic(t,s,i[h-2],i[h-1],n[2*h-10],n[2*h-9],i[h-4],i[h-3],r,a)}static offscreenRender(e,t,s,i,n,o){e.annotationInstance.renderer.offscreen.curveQuadraticArrowOffScreen(e.annotationInstance.renderer.ctxOffscreen,t,s,i[0],i[1],n[0],n[1],i[2],i[3]),e.annotationInstance.renderer.offscreen.curveQuadraticArrowOffScreen(e.annotationInstance.renderer.ctxOffscreen,t,s,i[o-2],i[o-1],n[2*o-10],n[2*o-9],i[o-4],i[o-3])}init(){this.IsHidden=!1,this.IsRenderable=!0,this.IsSelectable=!0}get IsHover(){return this.isHover}set IsHover(e){this.isHover=e,this.p0.isHover=e,this.pm.isHover=e,this.p1.isHover=e}get IsRenderable(){return this.isRenderable}set IsRenderable(e){this.isRenderable=e,this.p0.isRenderable=e,this.pm.isRenderable=e,this.p1.isRenderable=e}get IsHidden(){return this.isHidden}set IsHidden(e){this.isHiddenPre=this.isHidden,this.isHidden=e,this.p0.isHidden=e,this.pm.isHidden=e,this.p1.isHidden=e}get Visibility(){return this.visibility}set Visibility(e){this.visibility=e,this.p0.visibility=0,this.pm.visibility=0,this.p1.visibility=0}get IsSelected(){return this.isSelected}set IsSelected(e){this.isSelected=e,this.p0.isRenderable=e,this.pm.isRenderable=e,this.p1.isRenderable=e}getClosePt(e,t){return 10>this.p0.distance(e,t)?this.p0:10>this.p1.distance(e,t)?this.p1:10>this.pm.distance(e,t)?this.pm:void 0}translateByMouseEventData(e){!this.p0.isVisited&&(this.p0.isVisited=!0,this.p0.translateByMouseEventData(e),this.p0.textLeaderline&&this.translateForTextLeaderline(e,this.p0)),!this.p1.isVisited&&(this.p1.isVisited=!0,this.p1.translateByMouseEventData(e),this.p1.textLeaderline&&this.translateForTextLeaderline(e,this.p1)),this.isCurved&&!this.pm.isVisited&&(this.pm.isVisited=!0,this.pm.vec.x+=e.x-e.preX,this.pm.vec.y+=e.y-e.preY,this.pm.textLeaderline&&(this.pm.textLeaderline.translateByMouseEventData(e),this.translateForTextLeaderline(e,this.pm)))}translateForTextLeaderline(e,t){return!!t.textLeaderline&&!!t.textLeaderline.leaderline&&(t.textLeaderline.leaderline.v2.x=t.vec.x,t.textLeaderline.leaderline.v2.y=t.vec.y,!0)}splitEdge(e){if(e.type!==p.zq.AMIDPOINT)return;let t=this.pGraph.edges.indexOf(this);this.pGraph.edges.splice(t,1);let s=new k(this.scene,e.vec.x,e.vec.y,e.vec.z);s.type=p.zq.ANODE;let i=this.pGraph.addEdge(this.p0,s),n=this.pGraph.addEdge(s,this.p1);return this.p0.aEdges.splice(this.p0.aEdges.indexOf(this),1),this.p1.aEdges.splice(this.p1.aEdges.indexOf(this),1),this.pGraph.edges.splice(t,0,n),this.pGraph.edges.splice(t,0,i),e.deepRemove(),this.pGraph.reBuildConnection(),s}computeCurve(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5;this.computeVertex(e),this.computeWeight(e),this.computeControlPoint()}checkIsCurved(){let e=(0,p.zQ)(this.p0.vec,this.p1.vec);return(0,p.Sp)(e,this.pm.vec)<this.curveTolerance?(this.pm.vec.x=e.x,this.pm.vec.y=e.y,this.isCurved=!1,!1):(this.isCurved=!0,!0)}checkIsSnapStraight(){this.isCurved?(this.needBend=!1,this.curveTolerance=3):(this.needBend=!0,this.curveTolerance=0)}isMouseInsideByCurve(e,t){return(this.computeCurve(.3),this.isInsideFirstAndLastCurves(e,t))?(this.IsHover=!0,!0):(this.IsHover=!1,!1)}isMouseInside(e,t){if(this.isCurved){if(this.isMouseInsideByCurve(e,t))return!0}else if(this.distance(e,t)<this.detectionTolerance*this.scene.annotationInstance.activeCommandController.scaleGlobal)return!0;return!1}getOtherPt(e){return this.p0===e?this.p1:this.p0}distance(e,t){return(0,p.xs)(new p.h9(e,t),this.p0.vec,this.p1.vec)}moveMidPt(e){if(this.isCurved);else{let e=(0,p.zQ)(this.p0.vec,this.p1.vec);this.pm.vec.x=e.x,this.pm.vec.y=e.y}}remove(){this.isRemove=!0,this.isRenderable=!1,this.p0.deepRemove(),this.pm.deepRemove(),this.p1.deepRemove(),this.removeFromParent()}getCenVec(){return new p.h9((this.p0.vec.x+this.pm.vec.x+this.p1.vec.x)/3,(this.p0.vec.y+this.pm.vec.y+this.p1.vec.y)/3,(this.p0.vec.z+this.pm.vec.z+this.p1.vec.z)/3)}getVecs(){return[this.p0.vec,this.pm.vec,this.p1.vec]}deepRemove(){}removeFromParent(){this.pGraph.removeEdge(this)}get IsSelectable(){return this.isSelectable}set IsSelectable(e){this.isSelectable=e,this.p0.isSelectable=e,this.pm.isSelectable=e,this.p1.isSelectable=e}updateMidVec(){if(!this.isCurved){let e=(0,p.zQ)(this.p0.vec,this.p1.vec);this.pm.vec.x=e.x,this.pm.vec.y=e.y}}renderPostHover(e){(!this.pGraph.isPath||this.isHover)&&(this.isCurved?(this.computeCurve(),this.drawSplineHover(e,this.pGraph.styleComponent.renderStyle,this.arrayVertexs,this.arrayControlPoint,this.arrayWeight,this.isHover,this.isSelected)):this.drawLineHover(e,this.pGraph.styleComponent.renderStyle,this.isHover,this.isSelected))}renderPost(e){if(this.pGraph.isPath&&!this.isHover)return;let t=this.scene.paramsEditing.croppingMaskParams.x,s=this.scene.paramsEditing.croppingMaskParams.y;if(this.isCurved)this.computeCurve(),this.drawSpline(e,this.pGraph.styleComponent.renderStyle,this.arrayVertexs,this.arrayControlPoint,this.arrayWeight,this.isHover,this.isSelected),K.offscreenRender(this.scene,this.pGraph.styleComponent.renderStyle,this.pGraph.hashColor,this.arrayVertexs,this.arrayControlPoint,this.arrayVertexs.length);else{this.drawLine(e,this.pGraph.styleComponent.renderStyle,this.isHover,this.isSelected);let i=[this.p0.vec.x-t,this.p0.vec.y-s,this.pm.vec.x-t,this.pm.vec.y-s,this.p1.vec.x-t,this.p1.vec.y-s],n=K.getControlPoints(this.p0.vec.x-t,this.p0.vec.y-s,this.pm.vec.x-t,this.pm.vec.y-s,this.p1.vec.x-t,this.p1.vec.y-s,.5);K.offscreenRender(this.scene,this.pGraph.styleComponent.renderStyle,this.pGraph.hashColor,i,n,i.length)}if(!this.pGraph.scene.annotationInstance.activeCommandController.acProperties.isHiddenLog){let t=this.pGraph.edges.indexOf(this);e.font="30px Arial",e.fillText(t.toString(),this.pm.vec.x,this.pm.vec.y)}}drawLine(e,t,s,i){let n=this.scene.paramsEditing.croppingMaskParams.x,o=this.scene.paramsEditing.croppingMaskParams.y;this.scene.annotationInstance.renderer.draw.shape.polyline.edgePolylineLineTo(e,this.pGraph.styleComponent.renderStyle,this.p0.vec.x-n,this.p0.vec.y-o,this.p1.vec.x-n,this.p1.vec.y-o,!1,!1,1,1,s,this.isSelected)}drawLineHover(e,t,s,i){if(s||i){let i=this.scene.paramsEditing.croppingMaskParams.x,n=this.scene.paramsEditing.croppingMaskParams.y;this.scene.annotationInstance.renderer.draw.shape.line.edgePolylineHover(e,t,this.p0.vec.x-i,this.p0.vec.y-n,this.p1.vec.x-i,this.p1.vec.y-n,this.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tOver),s,this.isSelected),this.tOver+=.015,this.tDown1=0,this.isLeave=!0}else this.tOver=0}drawSplineHover(e,t,s,i,n,o,r){let a=s.length;o||r?(this.scene.annotationInstance.implementations.app.model.appCoreWrapper.appControllerStatus.mode===p.An.Drawing&&this.scene.annotationInstance.renderer.draw.shape.line.shadowMidPointForBending(e,t,(0,p.zQ)(this.p0.vec,this.p1.vec)),this.scene.annotationInstance.renderer.draw.shape.curve.edgeCurveQuadraticHover(e,t,s[0],s[1],i[0],i[1],s[2],s[3],this.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tOver),o,r),this.scene.annotationInstance.renderer.draw.shape.curve.edgeCurveQuadraticHover(e,t,s[a-2],s[a-1],i[2*a-10],i[2*a-9],s[a-4],s[a-3],1,o,r),this.tOver+=.015,this.tDown1=0,this.isLeave=!0):this.tOver=0}drawSpline(e,t,s,i,n,o,r){let a=s.length;this.scene.annotationInstance.renderer.draw.shape.polyline.curveQuadratic(e,t,s[0],s[1],i[0],i[1],s[2],s[3],this.isHover,this.isSelected),this.scene.annotationInstance.renderer.draw.shape.polyline.curveQuadratic(e,t,s[a-2],s[a-1],i[2*a-10],i[2*a-9],s[a-4],s[a-3],this.isHover,this.isSelected)}computeVertex(e){let t=[];this.p0.weightLeft=e,this.p0.weightRight=e;let s=this.scene.paramsEditing.croppingMaskParams.x,i=this.scene.paramsEditing.croppingMaskParams.y;t.push(this.p0.vec.x-s,this.p0.vec.y-i),this.pm.weightLeft=e,this.pm.weightRight=e,t.push(this.pm.vec.x-s,this.pm.vec.y-i),this.p1.weightLeft=e,this.p1.weightRight=e,t.push(this.p1.vec.x-s,this.p1.vec.y-i),this.arrayVertexs=t}computeWeight(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.arrayWeight=[e,e,e]}computeControlPoint(){let e=[];for(let t of this.arrayVertexs)e.push(t);let t=[];for(let s=0;s<e.length-4;s+=2)t=t.concat(K.getControlPoints(e[s]-this.scene.paramsEditing.croppingMaskParams.x,e[s+1]-this.scene.paramsEditing.croppingMaskParams.y,e[s+2]-this.scene.paramsEditing.croppingMaskParams.x,e[s+3]-this.scene.paramsEditing.croppingMaskParams.y,e[s+4]-this.scene.paramsEditing.croppingMaskParams.x,e[s+5]-this.scene.paramsEditing.croppingMaskParams.y,this.arrayWeight[s]));this.arrayControlPoint=t}isInsideFirstAndLastCurves(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,i=this.arrayVertexs,n=this.arrayControlPoint;for(let o=0;o<1;o+=.001){let r=Math.abs(Math.pow(1-o,3))*i[0]+3*Math.pow(1-o,2)*o*n[0]+3*Math.abs(1-o)*Math.pow(o,2)*n[0]+Math.abs(Math.pow(o,3))*i[2],a=Math.abs(Math.pow(1-o,3))*i[1]+3*Math.pow(1-o,2)*o*n[1]+3*Math.abs(1-o)*Math.pow(o,2)*n[1]+Math.abs(Math.pow(o,3))*i[3],h=Math.abs(Math.pow(1-o,3))*i[2]+3*Math.pow(1-o,2)*o*n[2]+3*Math.abs(1-o)*Math.pow(o,2)*n[2]+Math.abs(Math.pow(o,3))*i[4],c=Math.abs(Math.pow(1-o,3))*i[3]+3*Math.pow(1-o,2)*o*n[3]+3*Math.abs(1-o)*Math.pow(o,2)*n[3]+Math.abs(Math.pow(o,3))*i[5];if((0,p.Th)(new p.h9(r,a),new p.h9(e,t))<s||(0,p.Th)(new p.h9(h,c),new p.h9(e,t))<s)return!0}return!1}constructor(e,t,s,i,n){this.detectionTolerance=10,this.curveTolerance=3,this.needBend=!0,this.scene=e,this.pGraph=t,this.tOver=0,this.tDown1=0,this.isLeave=!0,this.isHiddenPre=!1,this.isRemove=!1,this.visibility=1,s.add_AEdge(this),i.add_AEdge(this),n.add_AEdge(this),this.p0=s,this.pm=i,this.p1=n,this.p0.type=p.zq.ANODE,this.pm.type=p.zq.AMIDPOINT,this.p1.type=p.zq.ANODE,this.isCurved=!1,this.init()}}K.isLeave=!1,K.tOver=0,K.tDown1=0;class ${initStyle(e){e===p.zq.POLYLINE_BENDING?b.updateRenderColorPolylineNode(this.renderStyleNode,this.scene.annotationInstance.customization.themeCurrent,this.scene.annotationInstance.activeCommandController.activeColorController.activeColor):e===p.zq.POLYGON_GRAPH&&b.updateRenderColorPolygonNode(this.renderStyleNode,this.scene.annotationInstance.customization.themeCurrent,this.scene.annotationInstance.activeCommandController.activeColorController.activeColor)}move(e,t){this.v.x=e,this.v.y=t}update(){}render(e){this.isRender&&(this.t+=.01,this.update(),this.renderPost(e))}renderPost(e){this.scene.annotationInstance.renderer.draw.shape.node.nodeStart(e,this.renderStyleNode,this.v.x-this.scene.paramsEditing.croppingMaskParams.x,this.v.y-this.scene.paramsEditing.croppingMaskParams.y,1,this.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.t))}constructor(e,t,s){this.scene=e,this.type=p.zq.APOINT,this.v=new p.h9(t.x,t.y),this.t=0,this.isRender=!1,this.renderStyleNode=new b,this.initStyle(s)}}class Q extends ${renderPost(e){this.scene.annotationInstance.renderer.draw.shape.node.nodeMidStart(e,this.renderStyleNode,this.v.x-this.scene.paramsEditing.croppingMaskParams.x,this.v.y-this.scene.paramsEditing.croppingMaskParams.y,this.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.t))}constructor(e,t,s){super(e,t,s),this.type=p.zq.AMIDPOINT}}class Z{initStyle(e){e===p.zq.POLYLINE_BENDING?b.updateRenderColorPolyline(this.renderStyle,this.scene.annotationInstance.customization.themeCurrent,this.scene.annotationInstance.activeCommandController.activeColorController.activeColor):e===p.zq.POLYGON_GRAPH&&b.updateRenderColorPolygon(this.renderStyle,this.scene.annotationInstance.customization.themeCurrent,this.scene.annotationInstance.activeCommandController.activeColorController.activeColor,this.scene.annotationInstance.activeCommandController.activeColorController.activeColor)}getVecs(){let e=[];for(let t=1;t<this.ps.length;++t){let s=this.ps[t].v;e.push(s)}let t=new p.h9(this.MouseVec.x+this.scene.paramsEditing.croppingMaskParams.x,this.MouseVec.y+this.scene.paramsEditing.croppingMaskParams.y);return e.push(t),(0,p.z1)(e,2)}getVecsVis(){let e=[];for(let t=1;t<this.ps.length;++t){let s=this.ps[t].v;e.push(new p.h9(s.x-this.scene.paramsEditing.croppingMaskParams.x,s.y-this.scene.paramsEditing.croppingMaskParams.y))}return e}add(e){let t=new $(this.scene,new p.h9(e.x,e.y),this.type);this.ps.push(t),this.ps.length>2?(this.ps[this.ps.length-1].isRender=!0,this.MouseVec=new p.h9(this.ps[this.ps.length-1].v.x-this.scene.paramsEditing.croppingMaskParams.x,this.ps[this.ps.length-1].v.y-this.scene.paramsEditing.croppingMaskParams.y),this.addMid(this.ps[this.ps.length-2].v,this.ps[this.ps.length-1].v)):(this.ps[0].isRender=!0,this.MouseVec=new p.h9(this.ps[this.ps.length-1].v.x-this.scene.paramsEditing.croppingMaskParams.x,this.ps[this.ps.length-1].v.y-this.scene.paramsEditing.croppingMaskParams.y))}mouseMove(e,t){this.MouseVec.x=e-this.scene.paramsEditing.croppingMaskParams.x,this.MouseVec.y=t-this.scene.paramsEditing.croppingMaskParams.y}undo(){if(this.ps.length<3){this.scene.listAPolylineGraphShadow=void 0,this.scene.annotationInstance.activeCommandController.goToACMode();return}this.ps.pop(),this.psMid.pop()}render(e){if(this.update(),this.renderPLine(e),this.renderNode(e),this.scene.annotationInstance.activeCommandController.acProperties.showUnit){let t=this.getVecs();t&&(this.dimension.renderLength(e,!1,t),this.dimension.renderTotalLength(e,t))}}addMid(e,t){let s=(0,p.zQ)(e,t),i=new Q(this.scene,new p.h9(s.x,s.y),this.type);i.isRender=!0,this.psMid.push(i)}update(){let e=this.ps.length;for(;e--;)this.ps[e].update();for(e=this.psMid.length;e--;)this.psMid[e].update()}renderPLine(e){this.type===p.zq.POLYLINE_BENDING?this.scene.annotationInstance.renderer.draw.shape.line.polylineShadow(e,this.renderStyle,this.getVecsVis(),this.MouseVec,this.type):this.type===p.zq.POLYGON_GRAPH&&this.scene.annotationInstance.renderer.draw.shape.line.polygonShadow(e,this.renderStyle,this.getVecsVis(),this.MouseVec,this.type)}renderNode(e){let t=this.ps.length;for(;t--;)this.ps[t].render(e)}constructor(e,t,s=100){this.scene=e,this.type=t,this.constraintLength=s,0!==s?this.isConstraintDrawing=!0:this.isConstraintDrawing=!1,this.ps=[],this.psMid=[],this.renderStyle=new b,this.renderStyle.scaleGlobal=this.scene.annotationInstance.activeCommandController.scaleGlobal,this.initStyle(t)}}class ee extends x{renderPost(e){!this.host.isRemove&&this.host.isRenderable&&(this.interpolateColor.update(),this.host.computeCenterVec(),this.timer.updatePopupSummery(),this.host.updateProjection(),this.renderPostGeometry(e))}renderPostGeometry(e){this.host.scene.annotationInstance.activeCommandController.acProperties.showUnit&&(this.host.isHoverValue||this.host.isUnderConstruction)&&this.host.dimension.renderLength(e,!1,this.host.getVecs()),this.renderHoverEffect(e),this.host.scene.annotationInstance.renderer.draw.shape.draw.renderer.needFocus&&this.host.isHoverValue,e.strokeStyle=this.host.styleComponent.renderStyle.colorInterpolatedString,this.host.isSelectedValue&&(e.strokeStyle=this.host.styleComponent.renderStyle.colorInterpolatedString),e.lineWidth=this.host.styleComponent.renderStyle.lineWidth*this.host.styleComponent.renderStyle.scaleGlobal*this.host.styleComponent.renderStyle.scaleLocal,e.beginPath();let t=this.host.edges[0].p0.vec.x-this.host.scene.paramsEditing.croppingMaskParams.x,s=this.host.edges[0].p0.vec.y-this.host.scene.paramsEditing.croppingMaskParams.y;e.moveTo(t,s);let i=this.host.edges.length;for(let t=0;t<i;++t)this.host.edges[t].renderPost(e);e.lineCap="round",e.setLineDash(this.host.styleComponent.renderStyle.dash),e.stroke(),e.setLineDash([0,0])}renderHoverEffect(e){let t=this.host.edges.length;if(this.host.isHover||this.host.isSelected){this.tOver+=.015,this.tDown1=0,this.host.isLeave=!0;let s=this.host.scene.paramsEditing.croppingMaskParams.x,i=this.host.scene.paramsEditing.croppingMaskParams.y,n=this.host.styleComponent.renderStyle,o=this.host.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tOver);e.lineWidth=o*n.lineWidth*n.scaleGlobal*n.scaleLocal*this.host.scene.annotationInstance.implementations.imageAnnoApp.customization.themeCurrent.properties.elasticScale,e.beginPath();for(let n=0;n<t;++n){let t=this.host.edges[n].p0;e.moveTo(t.vec.x-s,t.vec.y-i);let o=this.host.edges[n].p1;e.strokeStyle=this.host.scene.annotationInstance.renderer.imageAnnoApp.customization.themeCurrent.properties.outlineHoverColorRGBAString,e.lineTo(o.vec.x-s,o.vec.y-i)}e.setLineDash(n.dash),e.lineCap="round",e.stroke(),e.setLineDash([0,0])}else this.tOver=0}constructor(e){super(e),this.host=e}}class et extends O{updateStyle(){if(!this.isCustom&&(this.state.themeColorId=h.AccentColor1,this.isCustom=!0,b.updateRenderStylePolyline(this.renderStyle,this.geo.scene.annotationInstance.customization.themeCurrent),b.updateRenderStylePolylineNode(this.renderStyleNode,this.geo.scene.annotationInstance.customization.themeCurrent),this.geo.edges))for(let e=0;e<this.geo.edges.length;++e)this.geo.edges[e].p0.styleComponent.updateStyleForNode(this.renderStyleNode),this.geo.edges[e].pm.styleComponent.updateStyleForNode(this.renderStyleNode),this.geo.edges[e].p1.styleComponent.updateStyleForNode(this.renderStyleNode)}updateColor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(this.isCustom=!0,void 0===e&&(e=this.geo.scene.annotationInstance.activeCommandController.activeColorController.activeColor),b.updateRenderColorPolyline(this.renderStyle,this.geo.scene.annotationInstance.customization.themeCurrent,e),b.updateRenderColorPolylineNode(this.renderStyleNode,this.geo.scene.annotationInstance.customization.themeCurrent,e),this.geo.edges)for(let e=0;e<this.geo.edges.length;++e)this.geo.edges[e].p0.styleComponent.updateStyleForNode(this.renderStyleNode),this.geo.edges[e].pm.styleComponent.updateStyleForNode(this.renderStyleNode),this.geo.edges[e].p1.styleComponent.updateStyleForNode(this.renderStyleNode);this.tempColorRgba=e}updateStyleCustom(e){if(e.width&&(this.state.width=e.width),void 0!==e.color&&(this.state.themeColorId=e.color),e.colorRgba.length>0&&(this.tempColorRgba=e.colorRgba,b.updateRenderStylePolylineCustom(this.renderStyle,this.geo.scene.annotationInstance.customization.themeCurrent,e.colorRgba),b.updateRenderStylePolylineNodeCustom(this.renderStyleNode,this.geo.scene.annotationInstance.customization.themeCurrent,e.colorRgba),this.geo.edges))for(let e=0;e<this.geo.edges.length;++e)this.geo.edges[e].p0.styleComponent.updateStyleForNode(this.renderStyleNode),this.geo.edges[e].pm.styleComponent.updateStyleForNode(this.renderStyleNode),this.geo.edges[e].p1.styleComponent.updateStyleForNode(this.renderStyleNode);return e.scale&&(this.renderStyle.scaleLocal=e.scale,this.state.scale=e.scale),this.isCustom=!0,e.colorRgba.length>0&&this.updateColor(e.colorRgba),!0}setDash(e){this.renderStyle.dash=e,this.geo.scene.annotationInstance.io.eventListenerAnnotation.addGeometryStack(this.geo.toJSON())}toJson(){if(!this.isCustom)return;let e={width:this.state.width,scale:this.renderStyle.scaleLocal,colorRgba:this.tempColorRgba};return this.state.themeColorId!==h.AccentColor1&&(e.color=this.state.themeColorId),e}isSameStyle(e){if(e.colorRgba.length===this.tempColorRgba.length){for(let t=0;t<e.colorRgba.length;t++)if(e.colorRgba[t]!==this.tempColorRgba[t])return!1}return!0}constructor(e){super(e),this.updateStyle(),this.updateColor()}}class es extends S{static findAtPoint(e,t){for(let s=e.listAPolylineGraphWrapper.length-1;s>=0;--s)if(e.listAPolylineGraphWrapper[s].isSelectable&&e.listAPolylineGraphWrapper[s].isMouseInside(t.x,t.y))return e.listAPolylineGraphWrapper[s]}static getLengthSelection(e){let t=e.listAPolylineGraphWrapper.length,s=0;for(;t--;)e.listAPolylineGraphWrapper[t].isSelected&&(s+=1);return s}static computeOver(e,t){let s=this.findAtPoint(e,t);void 0!==s&&(s.isHoverValue=!0)}static computeVectorsForBuild(){}static fromJSON(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=[];for(let e=0;e<t.nodes.length;e+=2){let s=[t.nodes[e].sx,t.nodes[e].sy],i=new p.h9(s[0],s[1]);n.push(i)}let o=new es(e,n,p.zq.POLYLINE_BENDING,s,!0);return o.type=p.zq[t.type],i?o.id=e.getUUID():o.id=t.id,o.IsSelectable=!0,o.isUnderConstruction=!1,o.isHover=!1,t.styles&&t.styles.dash&&(o.styleComponent.renderStyle.dash=t.styles.dash),o.isHiddenValue=t.isHidden,t.isHidden?o.visibilityValue=0:o.visibilityValue=1,t.styles&&o.updateStyleCustom(t.styles),o.computeCenterVec(),o.initVecsHistory(),s||e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(o.toJSON()),o}static getLine(e){}static getLineByPt(e){}static mouseDown(e,t){void 0!==e.listAPolylineGraphShadow&&e.listAPolylineGraphShadow.ps.length>0&&e.listAPolylineGraphShadow.add(new p.h9(t.x,t.y))}static mouseLeftClick(e,t){void 0===e.capture&&(void 0===e.listAPolylineGraphShadow&&(e.listAPolylineGraphShadow=new Z(e,p.zq.POLYLINE_BENDING),e.listAPolylineGraphShadow.add(new p.h9(t.x,t.y)),e.listAPolylineGraphShadow.add(new p.h9(t.x,t.y))),e.annotationInstance.implementations.app.model.ioWrapper.eventInteraction.isEnableZoomByDoubleClick=!1)}static mouseMove(e,t){if(void 0!==e.listAPolylineGraphShadow){if(e.annotationInstance.activeCommandController.acProperties.pressShift){let s=e.listAPolylineGraphShadow.ps[e.listAPolylineGraphShadow.ps.length-1];(0,p.Sp)(s.v,new p.h9(t.x,t.y))>20&&e.listAPolylineGraphShadow.add(new p.h9(t.x,t.y))}e.listAPolylineGraphShadow.ps.length>1&&e.listAPolylineGraphShadow.mouseMove(t.x,t.y)}}static mouseDoubleClick(e,t){if(void 0!==e.listAPolylineGraphShadow){if(e.annotationInstance.activeCommandController.IsTouchEvent){if(e.listAPolylineGraphShadow.ps.length>1){let t=e.listAPolylineGraphShadow.getVecs();t&&((t=t.slice(0,t.length-1))&&es.getPolyline(e,t),e.listAPolylineGraphShadow=void 0,e.annotationInstance.activeCommandController.goToACMode())}}else if(e.listAPolylineGraphShadow.ps.length>1){let t=e.listAPolylineGraphShadow.getVecs();t&&es.getPolyline(e,t),e.listAPolylineGraphShadow=void 0,e.annotationInstance.activeCommandController.goToACMode()}e.annotationInstance.implementations.app.model.ioWrapper.eventInteraction.isEnableZoomByDoubleClick=!0}}static undo(e,t){void 0!==e.listAPolylineGraphShadow&&e.listAPolylineGraphShadow.undo()}static doneByKeyboard(e){if(void 0!==e.listAPolylineGraphShadow){let t=e.listAPolylineGraphShadow.getVecs();t&&es.getPolyline(e,t),e.listAPolylineGraphShadow=void 0,e.annotationInstance.activeCommandController.goToACMode()}}static cancel(e){void 0!==e.listAPolylineGraphShadow&&(e.listAPolylineGraphShadow=void 0)}static getPolyline(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!(t.length<2)){if(s&&10>(0,p.Sp)(t[0],t[t.length-1])){M.getPolygonbyVecs(e,t);return}return e.listAPolylineGraphShadow=void 0,new es(e,t,p.zq.POLYLINE_BENDING,!1,!0)}}initPolylineGraph(){this.dimension=new G(this),this.isUndo||this.scene.annotationInstance.io.eventListenerAnnotation.addGeometryStack(this.toJSON()),this.scene.addAPolylineGraphWrapper(this)}initComponent(){this.styleComponent=new et(this),this.renderer=new ee(this)}get isHidden(){return this.isHiddenValue}set isHidden(e){this.isHiddenPre=this.isHiddenValue,this.isHiddenValue=e;for(let t=0;t<this.edges.length;++t)this.edges[t].IsHidden=e,this.edges[t].Visibility=0;this.scene.annotationInstance.io.eventListenerAnnotation.hideStack(this.toJSON())}get isHover(){return this.isHoverValue}set isHover(e){if(this.isHoverValue=e,this.isHoverValue&&!this.isHoverPre?this.scene.annotationInstance.io.eventListenerAnnotation.hoverStack(this.toJSON()):!this.isHoverValue&&this.isHoverPre&&this.scene.annotationInstance.io.eventListenerAnnotation.hoverStack(this.toJSON()),this.isHoverPre=this.isHoverValue,!this.isSelectedValue){let t=this.edges.length;for(;t--;)this.edges[t].IsRenderable=e,this.edges[t].IsHover=e}e||(this.needEmitHoverPost=!0,this.hidePopUpSummary())}get IsSelectable(){return this.isSelectable}set IsSelectable(e){this.isSelectable=e;for(let t=0;t<this.edges.length;++t)this.edges[t].IsSelectable=e}get isSelected(){return this.isSelectedValue}set isSelected(e){if(this.isRemove||this.isHiddenValue)return;for(let t of(this.isSelectedValue=e,this.edges))t.IsSelected=e;let t=!0;for(let e of this.edges)if(e.p0.isSelectedValue||e.pm.isSelectedValue||e.p1.isSelectedValue){t=!1;break}t&&this.scene.annotationInstance.io.eventListenerAnnotation.selectionStack(this.toJSON())}move(e,t){if(this.isRemove||!this.isRenderable||this.isHiddenValue)return;this.computeCenterVec();let s=e-this.vec.x,i=t-this.vec.y;for(let e=0;e<this.edges.length;++e)this.edges[e].p0.vec.x+=s,this.edges[e].p0.vec.y+=i,this.edges[e].pm.vec.x+=s,this.edges[e].pm.vec.y+=i,this.edges[e].p1.vec.x+=s,this.edges[e].p1.vec.y+=i}computeCenterVec(){let e=[];for(let t=0;t<this.edges.length;++t)e.push(this.edges[t].p0.vec,this.edges[t].pm.vec,this.edges[t].p1.vec);this.vec=(0,p.mI)(e)}computeEdge(e){this.edges=[];for(let t=0;t<e.length-1;++t)this.edges.push(this.addEdge(e[t],e[t+1]))}addEdge(e,t){let s=(0,p.zQ)(e.vec,t.vec),i=new k(this.scene,s.x,s.y,0,!1,p.zq.AMIDPOINT);return new K(this.scene,this,e,i,t)}getNodePopup(){if(0===this.edges.length)return;let e=this.edges[0].p0,t=Number.MAX_SAFE_INTEGER;for(let s=0;s<this.edges.length;++s)this.edges[s].p0.vec.x<t&&(e=this.edges[s].p0,t=this.edges[s].p0.vec.x),this.edges[s].pm.vec.x<t&&(e=this.edges[s].pm,t=this.edges[s].pm.vec.x),this.edges[s].p1.vec.x<t&&(e=this.edges[s].p1,t=this.edges[s].p1.vec.x);return e}computeNode(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],s=[];if(t)for(let t=0;t<e.length;++t){let i=new k(this.scene,e[t].x,e[t].y);i.type=p.zq.ANODE,i.edges.push(this),i.isUnderConstruction=!1,s.push(i)}else for(let t=0;t<e.length;++t){let i=k.getNodeFromScreenPos(this.scene,e[t]);i.type=p.zq.ANODE,i.isUnderConstruction=!1,i.edges.push(this),s.push(i)}return s}removeAndAppendEdge(e,t){let s=this.edges.indexOf(e);this.edges.splice(s,1);for(let e=0;e<t.length;++e)this.edges.splice(s,0,t[e])}removeEdge(e){this.edges.splice(this.edges.indexOf(e),1)}RemovePt(e){}remove(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];if(this.isRemove||!this.isRenderable||this.isHiddenValue)return;if(this.scene.Capture&&this.scene.Capture.type===p.zq.ANODE){let t=this.scene.Capture;if(t.aEdges[1]&&t.aEdges[0]){let e=t.aEdges[0].p0===t?t.aEdges[0].p1:t.aEdges[0].p0,s=t.aEdges[1].p0===t?t.aEdges[1].p1:t.aEdges[1].p0,i=[];e.aEdges.forEach(e=>{e.p0!==t&&e.p1!==t&&i.push(e)}),e.aEdges=i,i=[],s.aEdges.forEach(e=>{e.p0!==t&&e.p1!==t&&i.push(e)}),s.aEdges=i;let n=this.edges.lastIndexOf(t.aEdges[0]),o=this.edges.lastIndexOf(t.aEdges[1]),r=this.addEdge(e,s);this.edges.splice(n<o?n:o,0,r),t.aEdges[0].pm.deepRemove(),t.aEdges[1].pm.deepRemove(),this.edges.splice(this.edges.indexOf(t.aEdges[0]),1),this.edges.splice(this.edges.indexOf(t.aEdges[1]),1)}else if(t.aEdges[0]){let e=t.aEdges[0].p0===t?t.aEdges[0].p1:t.aEdges[0].p0,s=[];e.aEdges.forEach(e=>{e.p0!==t&&e.p1!==t&&s.push(e)}),e.aEdges=s,t.aEdges[0].pm.deepRemove(),this.edges.splice(this.edges.indexOf(t.aEdges[0]),1)}if(t.deepRemove(),this.reBuildConnection(),this.computeCenterVec(),this.initVecsHistory(),e){let e=this.toJSON();e&&this.scene.annotationInstance.io.eventListenerAnnotation.removeGeometryStack([e])}return}let t=this.edges.length;for(;t--;)this.edges[t].remove();if(e){let e=this.toJSON();e&&this.scene.annotationInstance.io.eventListenerAnnotation.removeGeometryStack([e])}this.deepRemove()}deepRemove(){this.isSelectable=!1,this.isRenderable=!1,this.hidePopUpSummary(),this.scene.removeAPolylineGraphWrapper(this),this.scene.removeGeometry(this)}removeOrphanNode(){}checkMinPt(){}updateGeometryByProjectedpos(e){}getLog(){return this.type}goToBlackhole(){this.isSelectable=!1,this.needBlackhole=!0,this.edges.forEach(e=>{e.p0.goToBlackhole(),e.pm.goToBlackhole(),e.p1.goToBlackhole()})}isMouseInside(e,t){let s=!1;for(let i=0;i<this.edges.length;++i)this.edges[i].isMouseInside(e,t)&&(s=!0);if(this.vecOthers){let i=this.vecOthers[0].x-this.edges[0].p0.vec.x;for(let n=0;n<this.edges.length;++n)this.edges[n].isMouseInside(e-i,t)&&(s=!0)}for(let e=0;e<this.edges.length;++e)this.edges[e].IsHover=s;return s}isMouseInsideNode(e,t){return!1}hasSamePtWtithCapture(){for(let e=0;e<this.edges.length;++e)if(this.edges[e].p0===this.scene.capture||this.edges[e].pm===this.scene.capture||this.edges[e].p1===this.scene.capture)return!0;return!1}translateByMouseEventData(e){if(!this.hasSamePtWtithCapture()){this.resetVisitPt();for(let t=0;t<this.edges.length;++t)this.edges[t].translateByMouseEventData(e)}}translateByMouseEventDataForTextLeaderline(e){}mouseLeftClick(){this.scene.annotationInstance.geometryCommon.gcmdProcessing.removeAllPopup(),this.showPopupSummary()}translate(e,t){}getVecForSnapping(){}hide(){}updateProjection(){if(this.isUnderConstruction)return}wrappingProjectedPosShape(e,t){e.isVisited||(e.isVisited=!0)}renderPost(e){this.renderer.renderPost(e)}getVecs(){let e=[];for(let t=0;t<this.edges.length;++t)t===this.edges.length-1?(e.push(this.edges[t].p0.vec),e.push(this.edges[t].pm.vec),e.push(this.edges[t].p1.vec)):(e.push(this.edges[t].p0.vec),e.push(this.edges[t].pm.vec));return e}checkIsClosed(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!t){this.isClosed=!1;return}20>(0,p.Sp)(e[0],e[e.length-1])&&(this.isClosed=!0,this.type=p.zq.POLYGON)}getNode(){let e=[];for(let t=0;t<this.edges.length;++t)t===this.edges.length-1?(e.push(this.edges[t].p0.vec),e.push(this.edges[t].pm.vec),e.push(this.edges[t].p1.vec)):(e.push(this.edges[t].p0.vec),e.push(this.edges[t].pm.vec));return e}toJSON(){let e=new g(this.id,this.type,this.isSelectedValue,this.isHoverValue,this.isHiddenValue);e.pushNode(this.getNode());let t=this.styleComponent.toJson();return t&&(e.styles=t),e}deepCopy(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2];let s=this.toJSON();if(s){let i=es.fromJSON(this.scene,s,!1,!0);return i.move(e,t),i}}reBuildConnection(){this.edges.length>0&&(this.edges=this.reorderEdges())}updatePostTransformation(){for(let e=0;e<this.edges.length;++e)this.edges[e].updateMidVec()}resetVisitPt(){this.edges.forEach(e=>{e.p0.isVisited=!1,e.pm.isVisited=!1,e.p1.isVisited=!1})}reorderEdges(){let e=[this.edges[0]],t=1e3,s=this.edges[0],i=1===this.edges[0].p0.aEdges.length?this.edges[0].p1:this.edges[0].p0;for(;i&&2===i.aEdges.length&&(e.push(s=i.aEdges[0]===s?i.aEdges[1]:i.aEdges[0]),i=i===s.p0?s.p1:s.p0,!(--t<0)););return e}checkAttachedTextleaderline(){for(let e of this.edges){if(e.p0.textLeaderline&&e.p0.textLeaderline.leaderline){if(5>(0,p.Sp)(e.p0.vec,e.p0.textLeaderline.leaderline.v2))return!0;e.p0.textLeaderline.attachedShape=void 0,e.p0.textLeaderline=void 0}if(e.pm.textLeaderline&&e.pm.textLeaderline.leaderline){if(5>(0,p.Sp)(e.pm.vec,e.pm.textLeaderline.leaderline.v2))return!0;e.pm.textLeaderline.attachedShape=void 0,e.pm.textLeaderline=void 0}if(e.p1.textLeaderline&&e.p1.textLeaderline.leaderline){if(5>(0,p.Sp)(e.p1.vec,e.p1.textLeaderline.leaderline.v2))return!0;e.p1.textLeaderline.attachedShape=void 0,e.p1.textLeaderline=void 0}}return!1}updateMidVec(){for(let e=0;e<this.edges.length;++e)if(!this.edges[e].isCurved){let t=(0,p.zQ)(this.edges[e].p0.vec,this.edges[e].p1.vec);this.edges[e].pm.vec.x=t.x,this.edges[e].pm.vec.y=t.y}}constructor(e,t,s=p.zq.POLYLINE_BENDING,i=!1,n=!0){super(e),this.torVisMidPt=10,this.vecSelected=-1,this.type=s,this.isUnderConstruction=!1,this.isSelectable=!0,this.isRenderable=!0,this.isUndo=i,this.isPath=!1,this.initComponent(),this.checkIsClosed(t);let o=this.computeNode(t,n);this.computeEdge(o),this.computeCenterVec(),this.initVecsHistory(),this.isMovedValue=!0,this.initPolylineGraph()}}es.isSplit=!0;class ei{static mouseDown(e,t){let s=e.annotationInstance.geometryCommon.gcmdProcessing.findAtPoint(t);s&&s.remove()}static mouseMove(e){}constructor(){}}class en{computeRecPtsWithMouse(e,t){}addVecs(e,t){this.vecs.push(new p.h9(e,t))}remove(){}cancel(){void 0!==en.construction&&en.construction.remove(),en.construction=void 0}drawShadow(e){void 0===en.construction||en.construction.computeRecPtsWithMouse(e.x,e.y)}mouseDown(e){this.v0=new p.h9(e.x,e.y),this.vecTooltip.x=-100,this.vecTooltip.y=-100,en.isTooltipRenderable=!1}mouseDrag(e){en.isLasso?this.addVecs(e.x,e.y):this.v1=new p.h9(e.x,e.y)}mouseUp(e){if(this.scene.annotationInstance.geometryCommon.gcmdSelecting.deSelectCaptureObjects(),en.isLasso)this.vecs.length<1||(this.scene.annotationInstance.geometryCommon.gcmdSelecting.selecteObjectsByVecs((0,p.z1)(this.vecs)),this.vecs=[]);else{if(void 0===this.v0||void 0===this.v1)return;this.scene.annotationInstance.geometryCommon.gcmdSelecting.selecteObjectsByVecs((0,p.F$)(this.v0,this.v1),this.isWindow),this.v0=void 0,this.v1=void 0}}mouseMove(e){this.vecTooltip.x=e.x,this.vecTooltip.y=e.y}render(e){if(en.isTooltipRenderable,en.isLasso){if(this.vecs.length<1)return;this.scene.annotationInstance.renderer.draw.shape.selection.selectionLasso(e,this.vecs,!1,this.t)}else{if(void 0===this.v0||void 0===this.v1)return;this.v0.x>this.v1.x||this.v0.y>this.v1.y?this.isWindow=!0:this.isWindow=!1,this.scene.annotationInstance.renderer.draw.shape.selection.selection(e,this.v0,this.v1,this.isWindow,this.t)}this.t+=.5}constructor(e){this.scene=e,this.vecs=[],this.isWindow=!1,this.t=0,this.vecTooltip=new p.h9(0,0)}}en.isLasso=!1,en.isTooltipRenderable=!1;class eo{keypress(e){let t=this.keyEventController.acWrapper.acs.imageAnnoApp.customization.shortcut.shortcutCommands[e.key.toUpperCase()];return void 0!==t&&e.hasCtrlKey===t.hasControl&&e.hasShiftKey===t.hasShift&&(this.keyEventController.acWrapper.acs.setActiveCommand(t.ac),!0)}ByDeleteKey(){(this.keyEventController.acWrapper.acs.type===p.uA.POLYLINE||this.keyEventController.acWrapper.acs.type===p.uA.POLYGON||this.keyEventController.acWrapper.acs.type===p.uA.CPOLYLINE||this.keyEventController.acWrapper.acs.type===p.uA.CPOLYGON||this.keyEventController.acWrapper.acs.type===p.uA.POLYLINE_BENDING||this.keyEventController.acWrapper.acs.type===p.uA.POLYGON_GRAPH)&&this.keyEventController.acWrapper.acs.activeCommand.undo(),this.keyEventController.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdProcessing.removeAllCapturedGeoGroup(),this.keyEventController.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce()}ByESCKey(){this.keyEventController.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdSelecting.cancelActiveCommand(),this.keyEventController.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdSelecting.deSelectCaptureObjects(),this.keyEventController.acWrapper.acs.acProperties.pressESC=!0,this.keyEventController.acWrapper.acs.goToACMode(),this.keyEventController.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce()}constructor(e){this.keyEventController=e}}class er{keyboardEventController(e){switch(e.PRESS_TYPE){case p.rO.Down:this.keydownPre(e);break;case p.rO.Up:this.keyUpPre(e)}}keyboardEventControllerFromDocument(e){switch(e.PRESS_TYPE){case p.rO.Down:this.keydownPreFromDocument(e);break;case p.rO.Up:this.keyUpPreFromDocument(e)}}keydownPre(e){if(this.acWrapper.acs.acProperties.pressKey=!0,e.hasCtrlKey&&(this.acWrapper.acs.acProperties.pressCtrlKey=!0),e.hasShiftKey&&e.hasCtrlKey&&76===e.keyCode){this.acWrapper.acs.imageAnnoApp.apiWrapper.environment.shiftLog();return}if(e.hasShiftKey&&e.hasCtrlKey&&32===e.keyCode){this.acWrapper.acs.imageAnnoApp.implementations.app.initViewController();return}if(!this.shortcutImplementation.keypress(e)){if(!this.acWrapper.acs.imageAnnoApp.implementations.app.PRODUCTION&&e.hasShiftKey&&49===e.keyCode){this.acWrapper.acs.imageAnnoApp.apiWrapper.environment.toggleDebuggerMode();return}if(!this.acWrapper.acs.imageAnnoApp.implementations.app.PRODUCTION&&e.hasShiftKey&&50===e.keyCode){this.acWrapper.acs.imageAnnoApp.apiWrapper.environment.shiftOptimizerTextleaderline();return}if(!this.acWrapper.acs.imageAnnoApp.implementations.app.PRODUCTION&&e.hasShiftKey&&51===e.keyCode){this.acWrapper.acs.imageAnnoApp.apiWrapper.environment.shiftScaleDynamicRender();return}if(!this.acWrapper.acs.imageAnnoApp.implementations.app.PRODUCTION&&e.hasShiftKey&&52===e.keyCode){this.acWrapper.acs.imageAnnoApp.apiWrapper.environment.shiftActiveCluster();return}if(e.hasShiftKey&&73===e.keyCode){this.acWrapper.acs.activecommandIconPoint();return}if(e.hasShiftKey&&67===e.keyCode){this.acWrapper.acs.imageAnnoApp.activeCommandController.setActiveCommand(p.uA.CIRCLE),this.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();return}if(e.hasShiftKey&&82===e.keyCode){this.acWrapper.acs.imageAnnoApp.activeCommandController.setActiveCommand(p.uA.RECTANGLE),this.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();return}if(e.hasShiftKey&&70===e.keyCode){this.acWrapper.acs.imageAnnoApp.apiWrapper.environment.shiftDash(),this.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();return}if(!this.acWrapper.acs.imageAnnoApp.implementations.app.PRODUCTION&&e.hasShiftKey&&83===e.keyCode){this.acWrapper.acs.imageAnnoApp.apiWrapper.environment.shiftScaleForRPoint();return}if(!this.acWrapper.acs.imageAnnoApp.implementations.app.PRODUCTION&&e.hasShiftKey&&87===e.keyCode){this.acWrapper.acs.imageAnnoApp.apiWrapper.environment.shiftRenderShapeForRPoint();return}if(!this.acWrapper.acs.imageAnnoApp.implementations.app.PRODUCTION&&e.hasShiftKey&&69===e.keyCode){this.acWrapper.acs.imageAnnoApp.apiWrapper.environment.shiftIcon();return}if(49===e.keyCode?this.acWrapper.acs.imageAnnoApp.graphicsCoreWrapper.canvasWrapper.aCanvas.setLevel1():50===e.keyCode?this.acWrapper.acs.imageAnnoApp.graphicsCoreWrapper.canvasWrapper.aCanvas.setLevel2():51===e.keyCode?this.acWrapper.acs.imageAnnoApp.graphicsCoreWrapper.canvasWrapper.aCanvas.setLevel3():52===e.keyCode?this.acWrapper.acs.imageAnnoApp.graphicsCoreWrapper.canvasWrapper.aCanvas.setLevel4():53===e.keyCode?this.acWrapper.acs.imageAnnoApp.graphicsCoreWrapper.canvasWrapper.aCanvas.setLevel5():54===e.keyCode&&this.acWrapper.acs.imageAnnoApp.graphicsCoreWrapper.canvasWrapper.aCanvas.setLevel6(),this.acWrapper.acs.imageAnnoApp.implementations.app.model.appCoreWrapper.appControllerStatus.mode===p.An.Drawing){if(e.hasShiftKey&&8===e.keyCode||e.hasShiftKey&&e.keyCode&&46===e.keyCode){this.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdProcessing.removeAll();return}if(8===e.keyCode||46===e.keyCode){this.shortcutImplementation.ByDeleteKey();return}if(this.acWrapper.acs.imageAnnoApp.implementations.app.model.appCoreWrapper.appProperties.compileMode!==p.ct.Production&&(9===e.keyCode&&e.hasShiftKey&&(this.acWrapper.acs.acProperties.shiftDTMode++,this.acWrapper.acs.acProperties.shiftDTMode%3==0?this.acWrapper.acs.imageAnnoApp.implementations.app.model.appCoreWrapper.appControllerStatus.mode=p.An.Drawing:this.acWrapper.acs.acProperties.shiftDTMode%3==1?this.acWrapper.acs.imageAnnoApp.implementations.app.model.appCoreWrapper.appControllerStatus.mode=p.An.InteractiveViewer:this.acWrapper.acs.acProperties.shiftDTMode%3==2&&(this.acWrapper.acs.imageAnnoApp.implementations.app.model.appCoreWrapper.appControllerStatus.mode=p.An.ObserveViewer),this.acWrapper.acs.setActiveCommand(p.uA.NONE),this.acWrapper.acs.imageAnnoApp.apiWrapper.environment.logCommon(this.acWrapper.acs.m.x,this.acWrapper.acs.m.y)),e.hasShiftKey&&68===e.keyCode&&this.acWrapper.acs.imageAnnoApp.implementations.app.model.ioWrapper.download(),e.hasShiftKey&&79===e.keyCode&&this.acWrapper.acs.imageAnnoApp.implementations.app.model.ioWrapper.open(),85===e.keyCode&&this.acWrapper.acs.imageAnnoApp.apiWrapper.environment.shiftUnit()),e.hasShiftKey&&(this.acWrapper.acs.acProperties.pressShift=!0),e.hasAltKey&&(this.acWrapper.acs.acProperties.pressAltKey=!0,this.acWrapper.acs.acProperties.needDuplicateByAlt=!0),(this.acWrapper.acs.imageAnnoApp.implementations.app.model.appCoreWrapper.appControllerStatus.mode!==p.An.ObserveViewer||this.acWrapper.acs.imageAnnoApp.implementations.app.model.appCoreWrapper.appControllerStatus.currentControllerStatus.keyDown)&&(71===e.keyCode&&this.acWrapper.acs.imageAnnoApp.apiWrapper.environment.shiftGrid(),this.acWrapper.acs.imageAnnoApp.implementations.app.model.appCoreWrapper.appControllerStatus.mode!==p.An.InteractiveViewer||this.acWrapper.acs.imageAnnoApp.implementations.app.model.appCoreWrapper.appControllerStatus.currentControllerStatus.keyDown)){if(77===e.keyCode&&this.acWrapper.acs.imageAnnoApp.apiWrapper.environment.shiftMeasure(),70===e.keyCode&&this.acWrapper.acs.imageAnnoApp.apiWrapper.environment.shiftMapfilter(),27===e.keyCode&&this.shortcutImplementation.ByESCKey(),83===e.keyCode){this.acWrapper.acs.imageAnnoApp.activeCommandController.acProperties.snap=!this.acWrapper.acs.imageAnnoApp.activeCommandController.acProperties.snap;return}if(49===e.keyCode){this.acWrapper.acs.imageAnnoApp.apiWrapper.environment.toggleBorderFeaturePolygon();return}e.hasShiftKey&&65===e.keyCode&&this.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdSelecting.selectAllObjects(),(e.hasAltKey||e.hasMetaCommand||e.hasCtrlKey)&&67===e.keyCode&&this.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdProcessing.copySelGeo(),((e.hasAltKey||e.hasMetaCommand||e.hasCtrlKey)&&90===e.keyCode||90===e.keyCode)&&this.acWrapper.acs.activeCommand.undo(),(e.hasAltKey||e.hasMetaCommand||e.hasCtrlKey)&&86===e.keyCode&&(this.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdAProcessing.pasteSelGeo(this.acWrapper.acs.imageAnnoApp.activeCommandController.m.x,this.acWrapper.acs.imageAnnoApp.activeCommandController.m.y),this.acWrapper.acs.setActiveCommand(p.uA.NONE)),this.acWrapper.keydown(e),this.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce()}}}}keyUpPre(e){27===e.keyCode&&(this.acWrapper.acs.acProperties.pressESC=!1),16===e.keyCode&&(this.acWrapper.acs.acProperties.pressShift=!1),this.acWrapper.acs.acProperties.pressCtrlKey=!1,this.acWrapper.keyUp(e),this.acWrapper.acs.acProperties.pressKey=!1}keydownPreFromDocument(e){switch(this.acWrapper.acs.acProperties.pressKey=!0,this.acWrapper.acs.acProperties.pressShift=e.hasShiftKey,this.acWrapper.acs.acProperties.pressCtrlKey=e.hasCtrlKey,e.key){case"Backspace":case"Delete":this.shortcutImplementation.ByDeleteKey();break;case"Escape":this.shortcutImplementation.ByESCKey()}}keyUpPreFromDocument(e){this.acWrapper.acs.acProperties.pressKey=!1,this.acWrapper.acs.acProperties.pressShift=e.hasShiftKey,this.acWrapper.acs.acProperties.pressCtrlKey=e.hasCtrlKey}constructor(e){this.acWrapper=e,this.shortcutImplementation=new eo(this)}}class ea{mouseDownPre(e){}mouseLeftClickPre(e){}mouseMiddleClickPre(e){}mouseRightClickPre(e){}mouseUpPre(e){}mouseDoubleClickPre(e){}mouseMovePre(e){}mouseDragPre(e){}mouseWheelPre(e){}constructor(e){this.mc=e}}class eh extends ea{mouseDownPre(e){this.mc.acWrapper.acs.imageAnnoApp.implementations.app.INSPECTION&&this.mc.acWrapper.acs.screenLog.push("MouseDownPre"),this.mc.acWrapper.acs.type!==p.uA.SELECT&&this.mc.acWrapper.acs.acProperties.isActivateSnapping&&this.mc.updatePosBySnapping(e);let t=this.mc.acWrapper.acs.imageAnnoApp;if(this.mc.mDownPos.x=e.x,this.mc.mDownPos.y=e.y,e=this.mc.acWrapper.acs.commonEvent(e),t.renderer.blackhole&&(t.renderer.blackhole.stopRender=!1),t.activeCommandController.acProperties.isDown=!0,t.activeCommandController.acProperties.isUp=!1,this.mc.acWrapper.acs.acProperties.needExecuteOptimizer=!0,t.activeCommandController.acProperties.clickMenu){t.activeCommandController.acProperties.clickMenu=!1;return}if(!this.mc.acWrapper.acs.acProperties.isReturn&&t.implementations.app.model.appCoreWrapper.appControllerStatus.currentControllerStatus.mouseDown){if(e.isDown=!0,t.geometryCommon.gcmdProcessing.resetTranformation(),t.geometryCommon.gcmdProcessing.hasMultiSel(),t.activeCommandController&&(t.activeCommandController.acProperties.isTextEditing=!1,t.scene.captureText&&(t.io.eventListenerAnnotation.endEditingText(t.scene.captureText.toJSON()),t.scene.captureText=void 0)),t.implementations.app.model.appCoreWrapper.appControllerStatus.mode===p.An.InteractiveViewer){this.mc.acWrapper.acs.IsTouchEvent&&(this.mc.acWrapper.acs.type,p.uA.SELECT);return}if(this.mc.acWrapper.acs.acProperties.isSmartSelectionWhenDrawing||!this.mc.acWrapper.acs.acProperties.isDrawing){let s=t.geometryCommon.gcmdProcessing.findAtPoint(e),i=t.geometryCommon.gcmdProcessing.findAtPointFromAPoint(e),n=t.geometryCommon.gcmdProcessing.findAtPointFromPolygonGraph(e);if(n&&(i=n),s&&this.filterNodeSelectionForMovingMultipleShapes(s,e),s&&i&&s.type===p.zq.POLYLINE_BENDING&&(i.type===p.zq.POINT_REGULAR||i.type===p.zq.POINT_NUMBERED)&&(s=i),s&&s.type===p.zq.TEXT_LEADERLINE){t.implementations.app.model.ioWrapper.eventInteraction.isEnableZoomByDoubleClick=!1;let e=s;e.attachedShape&&e.leaderline&&10>(0,p.Sp)(e.leaderline.v2,new p.h9(this.mc.acWrapper.acs.m.x,this.mc.acWrapper.acs.m.y))&&(s=e.attachedShape)}else t.implementations.app.model.ioWrapper.eventInteraction.isEnableZoomByDoubleClick=!0;void 0!==s&&s.type!==p.zq.POLYGON_MULTIPLE?(s.type===p.zq.TEXT_LEADERLINE&&i&&(s=i),(s.type===p.zq.ANODE_RECT||s.type===p.zq.ANODE_CIRCLE)&&(s=s.edges[0]),t.scene.Capture&&(!this.mc.acWrapper.acs.acProperties.pressShift&&t.scene.Capture.isSelected&&(t.scene.Capture.isSelected=!1),t.scene.Capture.isCapturedValue=!1),t.scene.Capture=s,t.scene.Capture.isCapturedValue=!0):(t.scene.Capture&&(t.scene.Capture.isCapturedValue=!1),t.scene.Capture=void 0)}if(t.scene.Capture&&t.scene.Capture.type===p.zq.AMIDPOINT){let e=t.scene.Capture;e.aEdges[0]&&e.aEdges[0].checkIsSnapStraight()}this.mc.acWrapper.mouseDown(e)}}mouseLeftClickPre(e){if(this.mc.acWrapper.acs.imageAnnoApp.implementations.app.INSPECTION&&this.mc.acWrapper.acs.screenLog.push("MouseLeftClickPre"),this.mc.acWrapper.acs.imageAnnoApp.activeCommandController.acProperties.isClick=!0,!this.mc.acWrapper.acs.acProperties.isReturn&&this.mc.acWrapper.acs.imageAnnoApp.implementations.app.model.appCoreWrapper.appControllerStatus.currentControllerStatus.clickLeft&&(e=this.mc.acWrapper.acs.commonEvent(e),!this.mc.acWrapper.acs.imageAnnoApp.renderer.optimizer.mouseClick(e.x,e.y))){if(this.mc.acWrapper.acs.type===p.uA.SELECT&&this.mc.acWrapper.acs.acProperties.isActivateSnapping&&this.mc.updatePosBySnapping(e),!this.mc.acWrapper.acs.acProperties.pressShift&&this.mc.acWrapper.acs.acProperties.deselectNeeded?this.mc.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdSelecting.deSelectCaptureObjects():this.mc.acWrapper.acs.acProperties.deselectNeeded=!0,this.mc.acWrapper.acs.acProperties.isSmartSelectionWhenDrawing||!this.mc.acWrapper.acs.acProperties.isDrawing){let t;(t=this.mc.acWrapper.acs.imageAnnoApp.implementations.app.model.appCoreWrapper.browserUtility.isMobile&&this.mc.acWrapper.acs.imageAnnoApp.implementations.app.model.appCoreWrapper.appControllerStatus.mode!==p.An.Drawing?this.mc.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdProcessing.findAtPointByTouch(e):this.mc.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdProcessing.findAtPoint(e))&&(this.mc.acWrapper.acs.imageAnnoApp.scene.Capture=t),this.mc.acWrapper.acs.type===p.uA.APOINT||this.mc.acWrapper.acs.type===p.uA.POINT_ICON||this.mc.acWrapper.acs.type===p.uA.POINT_NUMBERED||this.mc.acWrapper.acs.type===p.uA.POINT_REGULAR||this.mc.acWrapper.acs.type===p.uA.TEXT?void 0!==this.mc.acWrapper.acs.imageAnnoApp.scene.capture&&(this.mc.acWrapper.acs.imageAnnoApp.scene.capture.type===p.zq.POINT_ICON||this.mc.acWrapper.acs.imageAnnoApp.scene.capture.type===p.zq.POINT_NUMBERED||this.mc.acWrapper.acs.imageAnnoApp.scene.capture.type===p.zq.POINT_REGULAR||this.mc.acWrapper.acs.imageAnnoApp.scene.capture.type===p.zq.TEXT||this.mc.acWrapper.acs.imageAnnoApp.scene.capture.type===p.zq.APOINT||this.mc.acWrapper.acs.imageAnnoApp.scene.capture.type===p.zq.CNODE?this.mc.acWrapper.acs.imageAnnoApp.scene.capture.isSelected=!this.mc.acWrapper.acs.imageAnnoApp.scene.capture.isSelected:(this.mc.acWrapper.acs.imageAnnoApp.scene.capture.isCapturedValue=!1,this.mc.acWrapper.acs.imageAnnoApp.scene.capture=void 0)):(void 0!==this.mc.acWrapper.acs.imageAnnoApp.scene.capture&&(this.mc.acWrapper.acs.imageAnnoApp.scene.capture.type===p.zq.TEXT||(this.mc.acWrapper.acs.imageAnnoApp.scene.capture.isSelected=!this.mc.acWrapper.acs.imageAnnoApp.scene.capture.isSelected,this.mc.acWrapper.acs.imageAnnoApp.scene.capture.mouseLeftClick(e.x,e.y))),this.mc.acWrapper.acs.imageAnnoApp.implementations.app.model.appCoreWrapper.appControllerStatus.mode===p.An.InteractiveViewer&&this.mc.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdProcessing.processSelectionViewerMode())}if((this.mc.acWrapper.acs.type===p.uA.NONE||this.mc.acWrapper.acs.type===p.uA.SELECT||this.mc.acWrapper.acs.type===p.uA.SELECT_LASSO||this.mc.acWrapper.acs.type===p.uA.SELECT_RECT)&&this.mc.acWrapper.acs.imageAnnoApp.renderer.updateMouseHover(e),!this.mc.acWrapper.acs.imageAnnoApp.scene.capture)for(let e=0;e<this.mc.acWrapper.acs.imageAnnoApp.scene.listAPoint.length;++e)this.mc.acWrapper.acs.imageAnnoApp.scene.listAPoint[e].isSelectedSole=!1;this.mc.acWrapper.acs.imageAnnoApp.scene.Capture||this.mc.acWrapper.acs.type!==p.uA.SELECT||(this.mc.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdProcessing.removeAllPopup(),this.mc.acWrapper.acs.imageAnnoApp.io.eventListenerAnnotation.pointerOutStack()),this.mc.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdProcessing.emitSelections(),this.mc.acWrapper.mouseLeftClick(e)}}mouseMiddleClickPre(e){this.mc.acWrapper.acs.imageAnnoApp.implementations.app.model.appCoreWrapper.appControllerStatus.currentControllerStatus.clickMiddle&&(e=this.mc.acWrapper.acs.commonEvent(e),this.mc.acWrapper.mouseMiddleClick(e))}mouseRightClickPre(e){this.mc.acWrapper.acs.imageAnnoApp.implementations.app.model.appCoreWrapper.appControllerStatus.currentControllerStatus.clickRight&&(e=this.mc.acWrapper.acs.commonEvent(e),this.mc.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdProcessing.rightClickOnHoverGeo(e),this.mc.acWrapper.mouseRightClick(e))}mouseUpPre(e){if(this.mc.acWrapper.acs.imageAnnoApp.implementations.app.INSPECTION&&this.mc.acWrapper.acs.screenLog.push("MouseUpPre"),this.mc.acWrapper.acs.imageAnnoApp.activeCommandController.acProperties.isDragging=!1,this.mc.acWrapper.acs.imageAnnoApp.activeCommandController.acProperties.isUp=!0,this.mc.acWrapper.acs.imageAnnoApp.activeCommandController.acProperties.isDown=!1,this.mc.acWrapper.acs.imageAnnoApp.activeCommandController.acProperties.isClick=!1,e.isDown=!1,this.mc.acWrapper.acs.imageAnnoApp.scene.capture){let e=this.mc.acWrapper.acs.imageAnnoApp.scene.capture.getVecForSnapping();e&&this.mc.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdProcessing.autoSnapping(e)}this.mc.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdProcessing.doneDragging(),this.mc.acWrapper.acs.imageAnnoApp.scene.Capture&&(this.mc.acWrapper.acs.imageAnnoApp.scene.Capture.type,p.zq.ANODE),this.mc.acWrapper.acs.acProperties.isDrawing&&(this.mc.acWrapper.acs.imageAnnoApp.scene.Capture=void 0),this.mc.acWrapper.acs.imageAnnoApp.scene.Capture&&this.mc.acWrapper.acs.imageAnnoApp.scene.Capture.mouseUp(),this.mc.acWrapper.acs.imageAnnoApp.renderer.objectSnapping.updateGhostSnappingVec(void 0),this.mc.acWrapper.acs.imageAnnoApp.scene.capturePT=void 0,this.mc.acWrapper.acs.activeMouseCursor.updateActiveCursorByUp(this.mc.acWrapper.acs.type),this.mc.acWrapper.mouseUp(e),this.mouseUpPost(e)}mouseUpPost(e){this.mc.mDownPos.x!==e.x&&this.mc.mDownPos.y!==e.y&&this.mc.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdProcessing.transformStack()}mouseDoubleClickPre(e){if(!this.mc.acWrapper.acs.imageAnnoApp.implementations.app.model.appCoreWrapper.appControllerStatus.currentControllerStatus.clickDouble)return;e=this.mc.acWrapper.acs.commonEvent(e);let t=this.mc.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdProcessing.findAtPoint(e);void 0!==t&&(t.type===p.zq.TEXT_LEADERLINE||t.mouseDoubleClick()),this.mc.acWrapper.mouseDoubleClick(e)}mouseMovePre(e){if(this.mc.acWrapper.acs.imageAnnoApp.implementations.app.model.appCoreWrapper.appControllerStatus.currentControllerStatus.mouseMove){if(e.isDown){this.mouseDragPre(e);return}this._frameMove++%2==0&&(e=this.mc.acWrapper.acs.commonEvent(e),this.mc.acWrapper.acs.acProperties.isDrawing||this.mc.acWrapper.acs.type!==p.uA.SELECT&&this.mc.acWrapper.acs.type!==p.uA.NONE||this.mc.acWrapper.acs.imageAnnoApp.renderer.updateMouseHover(e),3===this.mc.acWrapper.acs.imageAnnoApp.graphicsCoreWrapper.canvasWrapper.aCanvas.canvasLoopController.level&&this.mc.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce(),this.mc.acWrapper.acs.activeMouseCursor.updateActiveCursorByMove(this.mc.acWrapper.acs.type),this.mc.acWrapper.mouseMove(e),this.mc.acWrapper.acs.imageAnnoApp.renderer.optimizer.mouseMove(e.x,e.y))}}mouseDragPre(e){if(this.mc.acWrapper.acs.imageAnnoApp.implementations.app.model.appCoreWrapper.appControllerStatus.currentControllerStatus.mouseDrag){if(e=this.mc.acWrapper.acs.commonEvent(e),this.mc.acWrapper.acs.imageAnnoApp.activeCommandController.acProperties.isDragging=!0,!0===e.isDown&&(this.mc.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdProcessing.moveMidPoint(e),this.mc.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdProcessing.moveSelectedGeo(e),this.mc.acWrapper.acs.imageAnnoApp.scene.capture&&(this.mc.acWrapper.acs.imageAnnoApp.scene.capture.type===p.zq.APOINT||this.mc.acWrapper.acs.imageAnnoApp.scene.capture.type===p.zq.CNODE)&&this.mc.acWrapper.acs.imageAnnoApp.scene.capture.move(e.x,e.y),this.mc.acWrapper.acs.acProperties.pressAltKey&&this.mc.acWrapper.acs.acProperties.needDuplicateByAlt&&(this.mc.acWrapper.acs.acProperties.needDuplicateByAlt=!1)),this.mc.acWrapper.acs.imageAnnoApp.scene.capture){let e=this.mc.acWrapper.acs.imageAnnoApp.scene.capture.getVecForSnapping();e&&this.mc.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdProcessing.autoSnappingTracker(e)}3===this.mc.acWrapper.acs.imageAnnoApp.graphicsCoreWrapper.canvasWrapper.aCanvas.canvasLoopController.level&&this.mc.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce(),this.mc.acWrapper.acs.imageAnnoApp.scene.captureHovered&&this.mc.acWrapper.acs.activeMouseCursor.updateActiveCursorByDrag(this.mc.acWrapper.acs.imageAnnoApp.scene.captureHovered),this.mc.acWrapper.acs.acProperties.needExecuteOptimizer=!0,this.mc.acWrapper.mouseDrag(e)}}filterNodeSelectionForMovingMultipleShapes(e,t){if(e.type===p.zq.AMIDPOINT&&e.edges[0].type===p.zq.ARROW_SINGLE||e.type===p.zq.AMIDPOINT&&e.edges[0].type===p.zq.ARROW_DOUBLE){this.mc.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdSelecting.deSelectAllObjects(),e.edges[0].isHover=!0,e.isSelected=!0;return}if(e.type===p.zq.ARROW_SINGLE||e.type===p.zq.ARROW_DOUBLE){let s=e.findClosestNode(t.x,t.y);s&&(this.mc.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdSelecting.deSelectAllObjects(),s.edges[0].isHover=!0,s.isSelected=!0);return}if(e.type===p.zq.ANODE){this.mc.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdSelecting.deSelectAllObjects(),e.aEdges[0].pGraph.isSelected=!0;return}if(e.type===p.zq.ANODE_RECT||e.type===p.zq.ANODE_CIRCLE){this.mc.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdSelecting.deSelectAllObjects(),e.isSelected=!0;return}if(e.type===p.zq.POLYGON_GRAPH){e.getVecForSnapping()&&(this.mc.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdSelecting.deSelectAllObjects(),e.isSelected=!0);return}}constructor(e){super(e),this._frameMove=0}}class ec{mouseEventController(e){if(!(this.acWrapper.acs.imageAnnoApp.graphicsCoreWrapper.canvasWrapper.aCanvas.canvasLoopController.level<3)&&(4===this.acWrapper.acs.imageAnnoApp.graphicsCoreWrapper.canvasWrapper.aCanvas.canvasLoopController.level&&(this.acWrapper.acs.imageAnnoApp.graphicsCoreWrapper.canvasWrapper.aCanvas.canvasLoopController.stop=!1),!(!this.acWrapper.acs.imageAnnoApp.implementations.app.model.appCoreWrapper.appProperties.isStandalone&&this.isOutsideExtent(e))))switch(e.CLICK_TYPE){case p.uD.Down:this.MouseEvent.mouseDownPre(e),this.mouseDownPost(e);break;case p.uD.Up:this.MouseEvent.mouseUpPre(e),this.mouseUpPost(e);break;case p.uD.Left:this.MouseEvent.mouseLeftClickPre(e),this.mouseLeftClickPost(e);break;case p.uD.Middle:this.MouseEvent.mouseMiddleClickPre(e),this.mouseMiddleClickPost(e);break;case p.uD.Right:this.MouseEvent.mouseRightClickPre(e),this.mouseRightClickPost(e);break;case p.uD.Double:this.MouseEvent.mouseDoubleClickPre(e),this.mouseDoubleClickPost(e);break;case p.uD.Move:this.MouseEvent.mouseMovePre(e),this.mouseMovePost(e);break;case p.uD.Drag:this.MouseEvent.mouseDragPre(e),this.mouseDragPost(e);break;case p.uD.Wheel:this.MouseEvent.mouseWheelPre(e),this.mouseWheelPost(e)}}updatePosBySnapping(e){let t=this.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdProcessing.getPosBySnapping(e.x,e.y,20);e.x=t[0],e.y=t[1]}isOutsideExtent(e){let t=this.acWrapper.acs.imageAnnoApp.graphicsCoreWrapper.canvasWrapper.aCanvasMask.width;return t>e.x||this.acWrapper.acs.imageAnnoApp.graphicsCoreWrapper.canvasWrapper.aCanvasMask.canvas.width-t<e.x}mouseDownPost(e){}mouseUpPost(e){}mouseLeftClickPost(e){}mouseMiddleClickPost(e){}mouseRightClickPost(e){}mouseDoubleClickPost(e){}mouseMovePost(e){}mouseDragPost(e){}mouseWheelPost(e){}constructor(e){this.mDownPos=new p.h9(-1,-1),this.acWrapper=e,this.MouseEvent=new eh(this)}}class el{mouseEventController(e){this.mouseController.mouseEventController(e)}keyboardEventController(e){this.keyboardController.keyboardEventController(e)}keyboardEventControllerFromDocument(e){this.keyboardController.keyboardEventControllerFromDocument(e)}touchEventController(e){}mouseDown(e){}mouseLeftClick(e){}mouseMiddleClick(e){}mouseRightClick(e){}mouseDoubleClick(e){}mouseUp(e){}mouseMove(e){}mouseDrag(e){}keydown(e){}keyUp(e){}undo(){}cancel(){}constructor(e){this.acs=e,this.mouseController=new ec(this),this.keyboardController=new er(this)}}class ep extends el{mouseLeftClick(e){}constructor(e){super(e)}}class ed extends el{mouseDown(e){ei.mouseDown(this.acs.imageAnnoApp.scene,e)}mouseMove(e){ei.mouseMove(e)}constructor(e){super(e)}}class em extends el{mouseDown(e){this.acs.imageAnnoApp.renderer.selection.mouseDown(e)}mouseDrag(e){}mouseUp(e){}constructor(e){super(e)}}class eu extends el{mouseDown(e){this.acs.imageAnnoApp.geometryCommon.gcmdSelecting.deSelectAllObjects(),this.acs.imageAnnoApp.renderer.selection.mouseDown(e)}mouseDrag(e){en.isLasso=!1,this.acs.imageAnnoApp.renderer.selection.mouseDrag(e)}mouseUp(e){en.isLasso=!1,this.acs.imageAnnoApp.renderer.selection.mouseUp(e),this.acs.goToACMode()}mouseMove(e){this.acs.imageAnnoApp.renderer.selection.mouseMove(e)}constructor(e){super(e)}}class eg extends eu{mouseDown(e){this.acs.imageAnnoApp.geometryCommon.gcmdSelecting.deSelectAllObjects(),this.acs.imageAnnoApp.renderer.selection.mouseDown(e)}mouseDrag(e){en.isLasso=!0,this.acs.imageAnnoApp.renderer.selection.mouseDrag(e)}mouseUp(e){en.isLasso=!0,this.acs.imageAnnoApp.renderer.selection.mouseUp(e),this.acs.goToACMode()}mouseMove(e){this.acs.imageAnnoApp.renderer.selection.mouseMove(e)}constructor(e){super(e)}}class ev{isMouseInside(e,t){if(this.host.isRemove||!this.host.isRenderable||this.host.isHiddenValue)return!1;if(this.checkCP(e,t))return!0;let s=e-this.host.vec.x,i=t-this.host.vec.y;return s*s/(this.host.widthHalf*this.host.widthHalf)+i*i/(this.host.heightHalf*this.host.heightHalf)<=1.1}getLog(){return"GUID : "+this.host.id+"/TYPE : "+this.host.type.toString()+"/Screen : /heightHalf : "+this.host.widthHalf.toFixed(3).toString()+" pixel/R2 : "+this.host.heightHalf.toFixed(3).toString()+" pixel/Area : "+this.host.getArea().toFixed(3).toString()+" m2/IsSEL : "+this.host.isSelectedValue+"/isSelable : "+this.host.isSelectable}checkCP(e,t){let s=new p.h9(e,t);for(let e=0;e<this.host.vecsCP.length;++e)if(10>(0,p.Sp)(s,this.host.vecsCP[e]))return this.host.vecSelectedCp=e,!0;return this.host.vecSelectedCp=-1,!1}hide(){}constructor(e){this.geo=e,this.host=e}}class ey extends x{renderPost(e){this.host.getCenterVec(),this.interpolateColor.update(),this.timer.update(),this.timer.updatePopupSummery(),this.renderPostGeometry(e)}renderPostGeometry(e){this.host.isHoverValue||this.host.isSelectedValue?(this.renderBoundbox(e),this.host.scene.annotationInstance.renderer.draw.shape.point.centerPoint(e,this.host.vec.x,this.host.vec.y),this.host.scene.annotationInstance.renderer.draw.shape.area.ellipseHover(e,this.host.styleComponent.renderStyle,this.host.vec.x,this.host.vec.y,this.host.widthHalf,this.host.heightHalf,this.host.isGrayColor,this.host.visibilityValue,this.host.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.host.renderer.tOver),this.host.isHoverValue,this.host.isSelectedValue),this.host.scene.annotationInstance.renderer.draw.shape.area.ellipse(e,this.host.styleComponent.renderStyle,this.host.vec.x,this.host.vec.y,this.host.widthHalf,this.host.heightHalf,this.host.isFill,this.host.isHoverValue,this.host.isSelectedValue),this.host.renderer.tOver+=this.host.scene.annotationInstance.renderer.dt,this.host.renderer.tDown1=0,this.host.isLeave=!0):(this.host.scene.annotationInstance.renderer.draw.shape.area.ellipse(e,this.host.styleComponent.renderStyle,this.host.vec.x,this.host.vec.y,this.host.widthHalf,this.host.heightHalf,this.host.isFill,this.host.isHoverValue,this.host.isSelectedValue),this.host.renderer.tOver=0),this.host.isUnderConstruction||this.host.isHoverValue,this.renderPostGeometryOffScreen(this.host.vec)}renderBoundbox(e){this.host.vecsCP[0].x=this.host.vec.x-this.host.widthHalf,this.host.vecsCP[0].y=this.host.vec.y-this.host.heightHalf,this.host.vecsCP[1].x=this.host.vec.x+this.host.widthHalf,this.host.vecsCP[1].y=this.host.vec.y-this.host.heightHalf,this.host.vecsCP[2].x=this.host.vec.x+this.host.widthHalf,this.host.vecsCP[2].y=this.host.vec.y+this.host.heightHalf,this.host.vecsCP[3].x=this.host.vec.x-this.host.widthHalf,this.host.vecsCP[3].y=this.host.vec.y+this.host.heightHalf,e.lineWidth=1.5,e.strokeStyle=this.host.styleComponent.renderStyle.colorStroke,e.beginPath(),e.moveTo(this.host.vecsCP[0].x,this.host.vecsCP[0].y);for(let t=1;t<this.host.vecsCP.length;++t)e.lineTo(this.host.vecsCP[t].x,this.host.vecsCP[t].y);e.closePath(),e.stroke(),e.fillStyle=this.host.styleComponent.renderStyleNode.colorFill,e.lineWidth=this.host.styleComponent.renderStyleNode.lineWidth,e.strokeStyle=this.host.styleComponent.renderStyleNode.colorStroke;for(let t=0;t<this.host.vecsCP.length;++t)e.beginPath(),e.arc(this.host.vecsCP[t].x,this.host.vecsCP[t].y,5,0,2*Math.PI),e.closePath(),e.fill(),e.stroke()}renderPostGeometryOffScreen(e){this.host.scene.annotationInstance.renderer.offscreen.ellipseOffScreen(this.host.scene.annotationInstance.renderer.ctxOffscreen,this.host.styleComponent.renderStyle,this.host.hashColor,e.x,e.y,this.host.widthHalf,this.host.heightHalf,this.host.isFill)}constructor(e){super(e),this.host=e}}class eC extends O{updateStyle(){b.updateRenderStylePolygon(this.renderStyle,this.geo.scene.annotationInstance.customization.themeCurrent),b.updateRenderStylePolygonNode(this.renderStyleNode,this.geo.scene.annotationInstance.customization.themeCurrent);for(let e=0;e<this.geo.pts.length;++e)this.geo.pts[e].styleComponent.updateStyleForNode(this.renderStyleNode)}setDash(e){this.renderStyle.dash=e,this.geo.scene.annotationInstance.io.eventListenerAnnotation.addGeometryStack(this.geo.toJSON())}toJson(){if(this.renderStyle.dash.length>0)return{dash:this.renderStyle.dash}}constructor(e){super(e),this.renderStyle=new b(this),this.renderStyleNode=new b(this),this.updateStyle()}}class eS extends F{translateByMouseEventData(e){if(-1!==this.host.vecSelected){this.host.pts[this.host.vecSelected].translateByMouseEventData(e);return}this.host.isRemove||!this.host.isRenderable||this.host.isHiddenValue||(this.host.vec.x+=e.x-e.preX,this.host.vec.y+=e.y-e.preY,this.host.updateCP())}constructor(e){super(e),this.geo=e,this.host=e}}class eA extends S{static fromJSON(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=k.getNodeFromJSON(e,t.nodes[0],s),o=new eA(e,n.vec.x,n.vec.y,0,s);n.remove();let r=k.getNodeFromJSON(e,t.nodes[1]),a=k.getNodeFromJSON(e,t.nodes[2]);return o.R0=r.vec.x-o.vec.x,o.R1=a.vec.y-o.vec.y,r.remove(),a.remove(),o.type=p.zq[t.type],o.IsSelectable=!0,o.isUnderConstruction=!1,o.isHiddenValue=t.isHidden,t.isHidden?o.visibilityValue=0:o.visibilityValue=1,t.styles&&t.styles.dash&&(o.styleComponent.renderStyle.dash=t.styles.dash),i?o.id=e.getUUID():o.id=t.id,o.initVecsHistory(),!s&&i?e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(o.toJSON()):o.isHover=!1,o}static cancel(){void 0!==eA.construction&&eA.construction.remove(),eA.construction=void 0}static getLengthSelection(e){let t=e.listACircleWrapperr.length,s=0;for(;t--;)e.listACircleWrapperr[t].isSelected&&(s+=1);return s}static drawShadow(e){void 0!==eA.construction&&(eA.construction.R=eA.construction.distance(e.x,e.y),eA.construction.updateCP())}static getCircleFromVoice(e){let t=new p.h9(.5*e.annotationInstance.geometryCommon.gcmdProcessing.width,.5*e.annotationInstance.geometryCommon.gcmdProcessing.height);this.getCircleByVecs(e,[t,new p.h9(t.x+100,t.y),new p.h9(t.x,t.y+100)])}static getCircleByVecs(e,t){let s=(0,p.mI)(t),i=(0,p.lh)(t),n=new eA(e,s.x,s.y,0,!1,2*i[0]);n.updateCP(),n.IsSelectable=!0,n.isUnderConstruction=!1,e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(n.toJSON())}static getCircleByArea(e,t,s,i){let n=(0,p.yP)(t);n=e.annotationInstance.geometryCommon.gcmdProcessing.toMapConvertGeoDis(s,i,n);let o=new eA(e,s,i,0,!1,n);o.updateCP(),o.IsSelectable=!0,o.isUnderConstruction=!1,e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(o.toJSON()),eA.construction=o}static getCircleByCircumference(e,t,s,i){let n=(0,p.sI)(t);n=e.annotationInstance.geometryCommon.gcmdProcessing.toMapConvertGeoDis(s,i,n);let o=new eA(e,s,i,0,!1,n);o.updateCP(),o.IsSelectable=!0,o.isUnderConstruction=!1,e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(o.toJSON()),eA.construction=o}static getCircle(e,t){void 0!==eA.construction?(eA.construction.r=eA.construction.distance(t.x,t.y),eA.construction.IsSelectable=!0,eA.construction.isUnderConstruction=!1,e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(eA.construction.toJSON()),eA.construction=void 0):(eA.construction=new eA(e,t.x,t.y),eA.construction.IsSelectable=!1)}static mouseDown(e,t){}static onMouseMiddleClick(e){}static onMouseRightClick(e){}static onMouseLeftClick(e,t){this.getCirlceByTouch(e,t)}static onMouseMove(e){}static onMouseDrag(e,t){void 0!==eA.construction?eA.drawShadow(t):eA.getCircle(e,t)}static onMouseUp(e,t){eA.construction&&(eA.construction.IsSelectable=!0,eA.construction.isUnderConstruction=!1,eA.construction.isSelected=!1,eA.construction=void 0,eA.isDone=!0,e.annotationInstance.activeCommandController.goToACMode())}static getCirlceByTouch(e,t){let s=new eA(e,t.x,t.y,0,!1,64);s.updateCP(),s.IsSelectable=!0,s.isUnderConstruction=!1,s.isSelected=!1,e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(s.toJSON()),e.annotationInstance.activeCommandController.goToACMode()}initComponent(){this.styleComponent=new eC(this),this.renderer=new ey(this),this.interaction=new ev(this),this.transformation=new eS(this)}Init(){}initCircle(){this.dimension=new G(this),this.type=p.zq.CIRCLE,this.isRemove=!1,this.isHoverValue=!1,this.isFill=!0,this.isSelectable=!0,this.isRenderable=!0,this.isDraggable=!1,this.isSelectedValue=!1,this.isAniEasing=!1,this.isUnderConstruction=!0}getArea(){return Math.PI*this.heightHalf*this.widthHalf}getLog(){return this.interaction.getLog()}getLogDOM(){return"Geometry ID : "+this.id+"<br>geometry Type : ACircle<br>position : <br>size : "+this.r+" pixel<br>"}getParentType(){return""}getType(){return"ACircle"}getVecs(){let e=[];for(let t=0;t<this.pts.length;++t)e.push(this.pts[t].vec);return this.vecs=e,e}set visibility(e){this.visibilityValue=e;for(let t=0;t<this.pts.length;++t)this.pts[t].visibilityValue=e}set IsHiddenChildren(e){this.isHiddenPre=this.isHiddenValue,this.isHiddenValue=e;for(let t=0;t<this.pts.length;++t)this.pts[t].isHiddenValue=e}set isHidden(e){this.isHiddenPre=this.isHiddenValue,this.isHiddenValue=e,this.IsHiddenChildren=e,this.scene.annotationInstance.io.eventListenerAnnotation.hideStack(this.toJSON())}updateCP(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.widthHalf,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.heightHalf;this.widthHalf=e,this.heightHalf=t,this.pts[0].vec.x=this.vec.x+this.widthHalf,this.pts[0].vec.y=this.vec.y,this.pts[2].vec.x=this.vec.x-this.widthHalf,this.pts[2].vec.y=this.vec.y,this.pts[1].vec.x=this.vec.x,this.pts[1].vec.y=this.vec.y-this.heightHalf,this.pts[3].vec.x=this.vec.x,this.pts[3].vec.y=this.vec.y+this.heightHalf}getCenterVec(){return this.vec=new p.h9(0,0,0),this.vec=(0,p.PD)(this.vec,this.pts[0].vec),this.vec=(0,p.PD)(this.vec,this.pts[1].vec),this.vec=(0,p.PD)(this.vec,this.pts[2].vec),this.vec=(0,p.PD)(this.vec,this.pts[3].vec),this.vec.divByVal(4),this.widthHalf=Math.abs(this.pts[0].vec.x-this.vec.x),this.heightHalf=Math.abs(this.pts[1].vec.y-this.vec.y),this.vec}goToBlackhole(){this.isSelectable=!1,this.needBlackhole=!0,this.pts.forEach(e=>{e.goToBlackhole()})}getNodePopup(){return this.pts[0]}set R(e){this.widthHalf=e,this.heightHalf=e}set R0(e){this.widthHalf=e,this.pts[0].vec.x=this.vec.x+this.widthHalf,this.pts[0].vec.y=this.vec.y,this.pts[2].vec.x=this.vec.x-this.widthHalf,this.pts[2].vec.y=this.vec.y}set R1(e){this.heightHalf=e,this.pts[1].vec.x=this.vec.x,this.pts[1].vec.y=this.vec.y-this.heightHalf,this.pts[3].vec.x=this.vec.x,this.pts[3].vec.y=this.vec.y+this.heightHalf}set IsSelectable(e){this.isSelectable=e,this.pts[0].isSelectable=e,this.pts[1].isSelectable=e,this.pts[2].isSelectable=e,this.pts[3].isSelectable=e}isMouseInside(e,t){return this.interaction.isMouseInside(e,t)}distance(e,t){return Math.sqrt((this.vec.x-e)*(this.vec.x-e)+(this.vec.y-t)*(this.vec.y-t))}geoToScreen(){}activateEasing(e,t){this.tVec=new p.h9(e.x,e.y,0),this.isAniEasing=!0,this.updateCP()}easing(){this.isAniEasing&&(this.vec=(0,p.PD)((0,p.bA)(this.vec,.95),(0,p.bA)(this.tVec,.05)),1>(0,p.Sp)(this.vec,this.tVec)&&(this.isAniEasing=!1)),this.updateCP()}remove(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];if(this.isRemove=!1,this.isRenderable=!1,this.pts[0].remove(),this.pts[1].remove(),this.pts[2].remove(),this.pts[3].remove(),e){let e=this.toJSON();e&&this.scene.annotationInstance.io.eventListenerAnnotation.removeGeometryStack([e])}this.scene.removeGeometry(this)}hide(){}move(e,t){this.isRemove||!this.isRenderable||this.isHiddenValue||(this.vec.x=e,this.vec.y=t,this.updateCP())}translateByMouseEventData(e){return this.transformation.translateByMouseEventData(e)}translate(e,t){}get isSelected(){return this.isSelectedValue}set isSelected(e){this.isSelectedValue=e,this.pts[0].isRenderable=e,this.pts[1].isRenderable=e,this.pts[2].isRenderable=e,this.pts[3].isRenderable=e,this.scene.annotationInstance.io.eventListenerAnnotation.selectionStack(this.toJSON())}get isHover(){return this.isHoverValue}set isHover(e){this.isRemove||!this.isRenderable||this.isHiddenValue||this.isUnderConstruction||(this.isHoverValue=e,this.isHoverValue&&!this.isHoverPre?this.scene.annotationInstance.io.eventListenerAnnotation.hoverStack(this.toJSON()):!this.isHoverValue&&this.isHoverPre&&this.scene.annotationInstance.io.eventListenerAnnotation.hoverStack(this.toJSON()),this.isHoverPre=this.isHoverValue,this.isSelectedValue||(this.pts[0].isRenderable=e,this.pts[1].isRenderable=e,this.pts[2].isRenderable=e,this.pts[3].isRenderable=e),e||(this.needEmitHoverPost=!0,this.hidePopUpSummary()))}getNode(){let e=[];return e.push(this.vec),e.push(this.pts[0].vec),e.push(this.pts[1].vec),e.push(this.pts[2].vec),e.push(this.pts[3].vec),e}toJSON(){let e=new g(this.id,this.type,this.isSelectedValue,this.isHoverValue,this.isHiddenValue);e.pushNode(this.getNode());let t=this.styleComponent.toJson();return t&&(e.styles=t),e}deepCopy(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2];let s=this.toJSON();if(s){let i=eA.fromJSON(this.scene,s,!0,!0);return i.move(e,t),i.emitAddStack(),i}}mouseRightClick(){this.isFill=!this.isFill}renderPost(e){this.renderer.renderPost(e)}constructor(e,t=0,s=0,i=0,n=!1,o=5,r="white",a="black"){super(e),this.vecs=[],this.vecsCP=[],this.vecSelected=-1,this.vecSelectedCp=-1,this.isUndo=n,this.vec=new p.h9(t,s,i),this.widthHalf=o,this.heightHalf=o,this.rOrigin=o,this.rTaget=o+10,this.pts=[],this.r=1,this.initComponent(),this.pts[0]=new k(this.scene,this.vec.x+.5*this.r,this.vec.y+.5*this.r,this.vec.z,this.isUndo),this.pts[2]=new k(this.scene,this.vec.x+.5*this.r,this.vec.y+.5*this.r,this.vec.z+.5*this.r,this.isUndo),this.pts[1]=new k(this.scene,this.vec.x,this.vec.y-.5*this.r,this.vec.z,this.isUndo),this.pts[3]=new k(this.scene,this.vec.x+.5*this.r,this.vec.y+.5*this.r,this.vec.z+.5*this.r,this.isUndo),this.pts[0].addEdge(this),this.pts[1].addEdge(this),this.pts[2].addEdge(this),this.pts[3].addEdge(this),this.pts[0].type=p.zq.ANODE_CIRCLE,this.pts[1].type=p.zq.ANODE_CIRCLE,this.pts[2].type=p.zq.ANODE_CIRCLE,this.pts[3].type=p.zq.ANODE_CIRCLE,this.vecsCP=[],this.vecsCP.push(new p.h9(this.pts[3].vec.x,this.pts[0].vec.y,0)),this.vecsCP.push(new p.h9(this.pts[1].vec.x,this.pts[0].vec.y,0)),this.vecsCP.push(new p.h9(this.pts[1].vec.x,this.pts[2].vec.y,0)),this.vecsCP.push(new p.h9(this.pts[3].vec.x,this.pts[2].vec.y,0)),this.initCircle()}}eA.isDone=!1,eA.construction=void 0;class ef extends O{updateStyle(){if(b.updateRenderStylePolygon(this.renderStyle,this.geo.scene.annotationInstance.customization.themeCurrent),b.updateRenderStylePolygonNode(this.renderStyleNode,this.geo.scene.annotationInstance.customization.themeCurrent),this.geo.pts)for(let e=0;e<this.geo.pts.length;++e)this.geo.pts[e].styleComponent.updateStyleForNode(this.renderStyleNode)}constructor(e){super(e)}}class eP extends S{static findAtPoint(e){for(let t=eP.list.length-1;t>=0;--t)if(eP.list[t].isSelectable&&eP.list[t].isMouseInside(e.x,e.y))return eP.list[t]}static computeOver(e){let t=eP.findAtPoint(e);void 0!==t&&(t.isHoverValue=!0)}static fromJSON(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4];let s=k.getNodeFromJSON(e,t.nodes[0]),i=new eP(e,s.vec.x,s.vec.y);i.type=p.zq[t.type],s.remove();for(let s=1;s<i.pts.length;++s){let n=k.getNodeFromJSON(e,t.nodes[s]);i.pts[s].vec.x=n.vec.x,i.pts[s].vec.y=n.vec.y,i.pts[s].type=p.zq.CNODE}i.id=t.id,i.IsSelectable=!0,i.isUnderConstruction=!1,e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(i.toJSON()),eP.construction=void 0}static getLine(e,t,s){void 0!==eP.construction?eP.construction.type===p.zq.CN_GON?(eP.construction.IsSelectable=!0,eP.construction.isUnderConstruction=!1,M.aPolygonFromNGon(e,eP.construction),eP.construction.remove(),e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(eP.construction.toJSON()),eP.construction=void 0):eP.construction.type===p.zq.CN_STAR&&(eP.construction.numClick++,2===eP.construction.numClick&&(eP.construction.IsSelectable=!0,eP.construction.isUnderConstruction=!1,e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(eP.construction.toJSON()),M.aPolygonFromNGon(e,eP.construction),eP.construction.remove(),eP.construction=void 0)):(eP.construction=new eP(e,t.x,t.y,0,s),eP.construction.shiftNGon(),eP.construction.isUnderConstruction=!0,eP.construction.IsSelectable=!1)}static getLineByPt(e){}static cancel(){void 0!==eP.construction&&(eP.construction.IsSelectable=!0,eP.construction.isUnderConstruction=!1,eP.construction.remove(),eP.construction=void 0)}static drawShadow(e){void 0!==eP.construction&&eP.construction.updateGeo(e.x,e.y)}static add(e){eP.list.push(e)}static remove(e,t){let s=t.toJSON();s&&(e.annotationInstance.io.eventListenerAnnotation.removeGeometryStack([s]),eP.list.splice(eP.list.indexOf(t),1))}static mouseDown(e,t,s){void 0!==eP.construction&&(s===p.zq.CN_GON?(eP.getLine(e,t,s),eP.construction=void 0,eP.isDone=!0,e.annotationInstance.activeCommandController.goToACMode()):s===p.zq.CN_STAR&&(eP.getLine(e,t,s),eP.numClick++>0&&(eP.construction=void 0,eP.isDone=!0,eP.numClick=0,e.annotationInstance.activeCommandController.goToACMode())))}static mouseLeftClick(e,t,s){if(eP.isDone){eP.isDone=!1;return}void 0===e.annotationInstance.scene.capture&&void 0===eP.construction&&eP.getLine(e,t,s)}static mouseMove(e){void 0!==eP.construction&&eP.drawShadow(e)}initComponent(){this.styleComponent=new ef(this)}init(){this.r1=10,this.lineWidth=8,this.numClick=0,this.vecs=[],eP.add(this)}updateVecs(){this.vecs=[];for(let e=0;e<this.pts.length;++e)this.vecs.push(this.pts[e].vec);return this.vecs}getLog(){let e=0;return this.type===p.zq.CN_GON?e=this.n:this.type===p.zq.CN_STAR&&(e=Math.trunc(.5*this.n)),"GUID : "+this.id+"/TYPE : "+this.type.toString()+"/N num : "+e+"/Screen : /IsSEL : "+this.isSelectedValue+"/isSelable : "+this.isSelectable}translate(e,t){}translateByMouseEventData(e){let t=e.x-e.preX,s=e.y-e.preY;for(let e=0;e<this.pts.length;++e)this.pts[e].vec.x+=t,this.pts[e].vec.y+=s}remove(){for(let e=0;e<this.pts.length;++e)this.pts[e].remove();this.isSelectable=!1,this.isRenderable=!1,eP.remove(this.scene,this)}hide(){}set Scale(e){this.updateNGonByScale(e)}get v(){return this.vec}set v(e){this.vec=e}get R(){return this.r}set R(e){this.r=e}set IsSelectable(e){this.isSelectable=e;for(let t=0;t<this.pts.length;++t)this.pts[t].isSelectable=e}get IsSelectable(){return this.isSelectable}isMouseInside(e,t){return!0!==this.isUnderConstruction&&void 0!==this.isUnderConstruction&&(this.checkDistance(e,t)?(this.isHover=!0,!0):(this.isHover=!1,!1))}checkDistance(e,t){if((0,p.X0)(new p.h9(e,t),this.getVecs()))return!0;for(let s=0;s<this.pts.length-1;++s)if((0,p.xs)(new p.h9(e,t),this.pts[s].vec,this.pts[s+1].vec)<this.lineWidth)return!0;return!1}getVecs(){let e=[];for(let t=0;t<this.pts.length;++t)e.push(this.pts[t].vec);return e}computeCenterVec(){let e=[];for(let t=0;t<this.pts.length;++t)e.push(this.pts[t].vec);this.vec=(0,p.mI)(e)}distance(e,t){return Math.sqrt((this.vec.x-e)*(this.vec.x-e)+(this.vec.y-t)*(this.vec.y-t))}updateNGonByScale(e){this.updateNGon(this.vec.x+e,this.vec.y)}updateNGon(e,t){this.r1=this.distance(e,t);let s=new p.h9(this.vec.x-e,this.vec.y-t).normalize(),i=(0,p.p$)(this.vec).normalize(),n=(0,p.Cj)(i,s)*(Math.PI/180);(0,p.lu)(s,i).x<0&&(n*=-1);let o=2*Math.PI/this.n,r=this.n;for(;r--;){let e=this.vec.x+this.r1*Math.cos(n),t=this.vec.y+this.r1*Math.sin(n);n+=o,this.pts[r].vec.x=e,this.pts[r].vec.y=t}}updateNStar(e,t){0===this.numClick?this.r1=this.distance(e,t):1===this.numClick&&(this.r2=this.distance(e,t));let s=new p.h9(this.vec.x-e,this.vec.y-t).normalize(),i=(0,p.p$)(this.vec).normalize(),n=(0,p.Cj)(i,s)*(Math.PI/180);(0,p.lu)(s,i).x<0&&(n*=-1);let o=2*Math.PI/this.n,r=this.n;for(;r--;)if(0===this.numClick){let e,t;r%2==0?(e=this.vec.x+this.r1*Math.cos(n),t=this.vec.y+this.r1*Math.sin(n)):(e=this.vec.x+(this.r1-5)*Math.cos(n),t=this.vec.y+(this.r1-5)*Math.sin(n)),n+=o,this.pts[r].vec.x=e,this.pts[r].vec.y=t}else{let e,t;r%2==0?(e=this.vec.x+this.r1*Math.cos(n),t=this.vec.y+this.r1*Math.sin(n)):(e=this.vec.x+this.r2*Math.cos(n),t=this.vec.y+this.r2*Math.sin(n)),n+=o,this.pts[r].vec.x=e,this.pts[r].vec.y=t}}updateGeo(e,t){this.type===p.zq.CN_GON?this.updateNGon(e,t):this.type===p.zq.CN_STAR&&this.updateNStar(e,t)}computeNGon(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.n;if(this.pts.length>0){let e=this.pts.length;for(;e--;)this.pts[e].remove();this.pts=[]}this.type===p.zq.CN_STAR&&(this.n=2*e);let t=0,s=2*Math.PI/this.n,i=this.n;for(;i--;){let e=this.vec.x+this.r1*Math.cos(t),i=this.vec.y+this.r1*Math.sin(t);t+=s;let n=new k(this.scene,e,i);n.addEdge(this),n.type=p.zq.CNODE,n.isSelectable=!1,this.pts.push(n)}}shiftNGon(){this.isUnderConstruction||this.computeCenterVec(),this.computeNGon()}get isSelected(){return this.isSelectedValue}set isSelected(e){this.isSelectedValue=e,this.scene.annotationInstance.io.eventListenerAnnotation.selectionStack(this.toJSON())}get isHover(){return this.isHoverValue}set isHover(e){if(!this.isUnderConstruction&&(this.isHoverValue=e,!this.isUnderConstruction)){for(let t of this.pts)t.isRenderable=e;this.isHoverValue&&!this.isHoverPre?this.scene.annotationInstance.io.eventListenerAnnotation.hoverStack(this.toJSON()):!this.isHoverValue&&this.isHoverPre&&this.scene.annotationInstance.io.eventListenerAnnotation.hoverStack(this.toJSON()),this.isHoverPre=this.isHoverValue}}getNode(){let e=[];for(let t=0;t<this.pts.length;++t)e.push(this.pts[t].vec);return e}toJSON(){let e=new g(this.id,this.type,this.isSelectedValue,this.isHoverValue,this.isHiddenValue);return e.pushNode(this.getNode()),e}renderPost(e){if(this.pts.length<3)return;let t=[];for(let e=0;e<this.pts.length;++e)t.push(new p.h9(this.pts[e].vec.x-this.scene.annotationInstance.scene.paramsEditing.croppingMaskParams.x,this.pts[e].vec.y-this.scene.annotationInstance.scene.paramsEditing.croppingMaskParams.y));this.type===p.zq.CN_GON?this.scene.annotationInstance.renderer.draw.shape.ngon.nGon(e,t,this.isHoverValue,this.isSelectedValue):this.type===p.zq.CN_STAR&&this.scene.annotationInstance.renderer.draw.shape.ngon.nStar(e,this.pts,this.isHoverValue,this.isSelectedValue)}constructor(e,t,s,i=0,n=p.zq.CN_GON,o=eP.nNumber){super(e),this.pts=[],this.vec=new p.h9(t,s),this.type=n,this.n=o,this.initComponent(),this.init()}}eP.list=[],eP.isDone=!1,eP.numClick=0,eP.split=!1,eP.nNumber=5;class ex{initByVec(e){this.vs=e}getVecs(){return this.vs}removeSelVec(){if(this.selVec=void 0,this.selMidVec=void 0,this.selectedVec=void 0,this.vs.length<4){this.host.remove();return}this.vs.splice(this.vs.indexOf(this.vs[this.index]),1)}getCenVec(){return this.cVec=(0,p.mI)(this.vs),this.cVec}getclosestVec(e,t){let s=-1,i=Number.MAX_SAFE_INTEGER;for(let n=0;n<this.vs.length;++n){let o=(0,p.Sp)(e,this.vs[n]);o<t&&o<i&&(i=o,s=n)}if(s>-1)return this.selVec=this.vs[s],this.selVecForTextLeaderline=this.vs[s],this.vs[s];this.selVec=void 0,this.selVecForTextLeaderline=void 0}isMouseInside(e,t){this.mouseV.x=e,this.mouseV.y=t;for(let e=0;e<this.vs.length-1;++e){if((0,p.Sp)(this.mouseV,this.vs[e])<this.mouseR*this.host.scaleForRender*this.host.scene.annotationInstance.activeCommandController.scaleGlobal)return this.selVec=this.vs[e],this.selMidVec=void 0,this.index=e,e;let t=this.vs[e].x+(this.vs[e+1].x-this.vs[e].x)*.5,s=this.vs[e].y+(this.vs[e+1].y-this.vs[e].y)*.5;if(this.selMidVec=new p.h9(t,s,0),(0,p.Sp)(this.mouseV,this.selMidVec)<this.mouseR*this.host.scaleForRender*this.host.scene.annotationInstance.activeCommandController.scaleGlobal)return this.selVec=void 0,this.index=e,e;this.selMidVec=void 0}if((0,p.Sp)(this.mouseV,this.vs[this.vs.length-1])<this.mouseR*this.host.scaleForRender*this.host.scene.annotationInstance.activeCommandController.scaleGlobal)return this.selVec=this.vs[this.vs.length-1],this.selMidVec=void 0,this.index=this.vs.length-1,this.vs.length-1;let s=this.vs[this.vs.length-1].x+(this.vs[0].x-this.vs[this.vs.length-1].x)*.5,i=this.vs[this.vs.length-1].y+(this.vs[0].y-this.vs[this.vs.length-1].y)*.5;return(this.selMidVec=new p.h9(s,i,0),(0,p.Sp)(this.mouseV,this.selMidVec)<this.mouseR*this.host.scaleForRender*this.host.scene.annotationInstance.activeCommandController.scaleGlobal)?(this.selVec=void 0,this.index=this.vs.length-1,this.vs.length-1):(this.selVec=void 0,this.selMidVec=void 0,this.index=-1,-1)}insertMidVec(){this.selMidVec&&(this.vs.splice(this.index+1,0,this.selMidVec),this.selVec=this.selMidVec,this.selMidVec=void 0)}splitNodeVec(){let e=this.vs[this.index],t=this.vs[this.index+1],s=this.vs[this.index-1];this.index>0&&this.index<this.vs.length-1?(t=this.vs[this.index+1],s=this.vs[this.index-1]):this.index===this.vs.length-1?(t=this.vs[0],s=this.vs[this.index-1]):0===this.index&&(s=this.vs[this.vs.length-1]);let i=(0,p.zQ)(e,t);this.vs.splice(this.index+1,0,i),i=(0,p.zQ)(e,s),this.vs.splice(this.index,0,i)}constructor(e){this.selVec=void 0,this.selMidVec=void 0,this.selectedVec=void 0,this.selVecForTextLeaderline=void 0,this.vs=[],this.mouseV=new p.h9(0,0,0),this.mouseR=10,this.index=-1,this.host=e,this.index=-1}}class ew{isMouseInside(e,t){return!!(-1!==this.geo.graphCore.isMouseInside(e,t)||this.geo.scene.annotationInstance.geometryCommon.gcmdProcessing.isMouseInsideByOffScreen(e-this.geo.scene.paramsEditing.croppingMaskParams.x,t-this.geo.scene.paramsEditing.croppingMaskParams.y,this.geo.hashColor))}GetLog(){return this.geo.isRemove||!this.geo.isRenderable||this.geo.isHiddenValue?"":"GUID : "+this.geo.id+"/TYPE : "+this.geo.type.toString()+"/Screen : /pos : "+this.geo.graphCore.vs.length+"/Area : "+this.geo.getArea().toFixed(3).toString()+" m2/IsSEL : "+this.geo.isSelectedValue+"/isSelable : "+this.geo.isSelectable}hide(){}showPopupSummary(){!this.geo.scene.annotationInstance.activeCommandController.needPopup()||this.geo.hasPopup||this.geo.isGhost||(this.geo.hasPopup=!0,this.geo.popup=document.createElement("div"),this.geo.popup.id="pa-"+this.geo.id,this.geo.popup.style.position="absolute",this.geo.popup.style.zIndex="1000",this.geo.popup.style.height="0px",this.geo.popup.style.width="0px",this.geo.popup.style.backgroundColor="red",this.geo.scene.annotationInstance.implementations.app.model.modelViewWrapper.div.appendChild(this.geo.popup),this.geo.popup.style.top=this.geo.vec.y+"px",this.geo.popup.style.left=this.geo.vec.x+"px",this.showPopupStackTimer&&clearTimeout(this.showPopupStackTimer),this.showPopupStackTimer=setTimeout(()=>{this.geo.popup&&this.geo.scene.annotationInstance.io.eventListenerAnnotation.showPopupStack(this.geo.toJSON())},this.geo.timePopupDelay))}needSnapping(e){let t=15,s=15,i=new p.h9(-100,-100);for(let n=0;n<this.geo.graphCore.vs.length-1;++n)(s=(0,p.Sp)(this.geo.graphCore.vs[n],e))<t&&(t=s,i=this.geo.graphCore.vs[n]),(s=(0,p.iV)(e.x,e.y,this.geo.graphCore.vs[n+1].x-this.geo.graphCore.vs[n].x,this.geo.graphCore.vs[n+1].y-this.geo.graphCore.vs[n].y))<t&&(t=s,i.x=this.geo.graphCore.vs[n+1].x-this.geo.graphCore.vs[n].x,i.y=this.geo.graphCore.vs[n+1].y-this.geo.graphCore.vs[n].y);return(s=(0,p.Sp)(this.geo.graphCore.vs[this.geo.graphCore.vs.length-1],e))<t&&(t=s,i=this.geo.graphCore.vs[this.geo.graphCore.vs.length-1]),(s=(0,p.iV)(e.x,e.y,this.geo.graphCore.vs[this.geo.graphCore.vs.length-1].x-this.geo.graphCore.vs[0].x,this.geo.graphCore.vs[this.geo.graphCore.vs.length-1].y-this.geo.graphCore.vs[0].y))<t&&(t=s,i.x=this.geo.graphCore.vs[this.geo.graphCore.vs.length-1].x-this.geo.graphCore.vs[0].x,i.y=this.geo.graphCore.vs[this.geo.graphCore.vs.length-1].y-this.geo.graphCore.vs[0].y),[t,i]}constructor(e){this.xOff=5,this.yOff=5,this.geo=e}}class eI{ToJSON(){let e=new g(this.geo.id,p.zq.POLYGON_GRAPH,this.geo.isSelectedValue,this.geo.isHoverValue,this.geo.isHiddenValue);e.pushNode(this.getNode());let t=this.geo.styleComponent.toJson();return t&&(e.styles=t),e}getNode(){let e=[];for(let t=0;t<this.geo.graphCore.vs.length;++t)e.push(this.geo.graphCore.vs[t]);return e}remove(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];if(e){let e=this.ToJSON();e&&this.geo.scene.annotationInstance.io.eventListenerAnnotation.removeGeometryStack([e])}this.geo.deepRemove()}constructor(e){this.geo=e}}class eR{mouseLeftClick(){if(this.geo.graphCore.selVec){this.geo.graphCore.selectedVec=this.geo.graphCore.selVec;return}this.geo.graphCore.selectedVec=void 0,this.geo.scene.annotationInstance.geometryCommon.gcmdProcessing.removeAllPopup(),this.geo.showPopupSummary()}mouseRightClick(){}mouseMiddleClick(e){}mouseMoveClick(e){}constructor(e){this.geo=e}}class eb extends x{renderPost(e){this.interpolateColor.update(),this.timer.update(),this.geo.inspector.update(e),this.geo.updateCenVec();let t=[];for(let e=0;e<this.geo.graphCore.vs.length;++e)t.push(new p.h9(this.geo.graphCore.vs[e].x-this.geo.scene.paramsEditing.croppingMaskParams.x,this.geo.graphCore.vs[e].y-this.geo.scene.paramsEditing.croppingMaskParams.y));this.renderPolygon(e,t)}renderPostNodes(e){this.geo.scene.annotationInstance.interactionMode===p.An.Drawing&&((this.geo.isHoverValue||this.geo.isSelectedValue)&&this.renderNodes(e,this.geo.graphCore.vs,this.geo.scaleForRender*this.geo.scene.annotationInstance.graphicsCoreWrapper.scaleScreenByRatioImageSize),this.renderSelectedVec(e))}renderPolygon(e,t){this.offscreenRenderPolygon(t),this.geo.isHoverValue||this.geo.isSelectedValue?(this.geo.scene.annotationInstance.renderer.draw.shape.area.polygonHover(e,this.geo.styleComponent.renderStyle,t,this.geo.isGrayColor,this.geo.visibilityValue,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tOver),this.geo.isHoverValue,this.geo.isSelectedValue),this.tOver+=.01,this.tDown1=0,this.geo.isLeave=!0):this.tOver=0,this.geo.scene.annotationInstance.renderer.draw.shape.area.polygon(e,this.geo.styleComponent.renderStyle,t,this.geo.isUnderConstruction,this.geo.isGrayColor,this.geo.visibilityValue,this.geo.isFill,this.geo.isHover,this.geo.isSelectedValue)}renderSelectedVec(e){this.geo.graphCore.selectedVec&&this.geo.scene.annotationInstance.renderer.draw.shape.node.nodeSelected(e,this.geo.styleComponent.renderStyleNodeSelected,this.geo.graphCore.selectedVec.x-this.geo.scene.paramsEditing.croppingMaskParams.x,this.geo.graphCore.selectedVec.y-this.geo.scene.paramsEditing.croppingMaskParams.y,this.geo.scene.annotationInstance.graphicsCoreWrapper.scaleScreenByRatioImageSize)}renderNodes(e,t,s){let i=this.geo.scene.paramsEditing.croppingMaskParams.x,n=this.geo.scene.paramsEditing.croppingMaskParams.y;for(let o=0;o<t.length-1;++o)this.geo.scene.annotationInstance.renderer.draw.shape.node.nodeMidHover(e,this.geo.styleComponent.renderStyleNode,t[o].x+(t[o+1].x-t[o].x)*.5-i,t[o].y+(t[o+1].y-t[o].y)*.5-n,s,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tOver),!1),this.geo.scene.annotationInstance.renderer.draw.shape.node.nodeStart(e,this.geo.styleComponent.renderStyleNode,t[o].x-i,t[o].y-n,s,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tOver));this.geo.scene.annotationInstance.renderer.draw.shape.node.nodeMidHover(e,this.geo.styleComponent.renderStyleNode,t[t.length-1].x+(t[0].x-t[t.length-1].x)*.5-i,t[t.length-1].y+(t[0].y-t[t.length-1].y)*.5-n,s,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tOver),!1),this.geo.scene.annotationInstance.renderer.draw.shape.node.nodeStart(e,this.geo.styleComponent.renderStyleNode,t[t.length-1].x-i,t[t.length-1].y-n,s,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tOver))}offscreenRenderPolygon(e){this.geo.scene.annotationInstance.renderer.offscreen.polygonOffScreen(this.geo.scene.annotationInstance.renderer.ctxOffscreen,this.geo.hashColor,e)}constructor(e){super(e),this.geo=e}}class eL extends O{updateStyle(){this.isCustom||(this.state.themeColorId=h.AccentColor1,this.isCustom=!0,b.updateRenderStylePolygon(this.renderStyle,this.geo.scene.annotationInstance.customization.themeCurrent),b.updateRenderStylePolygonNode(this.renderStyleNode,this.geo.scene.annotationInstance.customization.themeCurrent),b.shiftNodeStyle(this.renderStyleNode,this.renderStyleNodeSelected))}updateColor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;this.isCustom=!0,void 0===e&&(e=this.geo.scene.annotationInstance.activeCommandController.activeColorController.activeColor),b.updateRenderColorPolygon(this.renderStyle,this.geo.scene.annotationInstance.customization.themeCurrent,e,e),b.updateRenderColorPolygonNode(this.renderStyleNode,this.geo.scene.annotationInstance.customization.themeCurrent,e),b.shiftNodeStyle(this.renderStyleNode,this.renderStyleNodeSelected),this.tempColorRgba=e}updateStyleCustom(e){return e.width&&(this.state.width=e.width),void 0!==e.color&&(this.state.themeColorId=e.color),e.colorRgba.length>0&&e.fill.length>0&&(this.tempColorRgba=e.colorRgba,this.tempFillRgba=e.fill,b.updateRenderStylePolygonCustom(this.renderStyle,this.geo.scene.annotationInstance.customization.themeCurrent,e.colorRgba,e.fill),b.updateRenderStylePolygonNodeCustom(this.renderStyleNode,this.geo.scene.annotationInstance.customization.themeCurrent,e.colorRgba,e.fill),b.shiftNodeStyleCustom(this.renderStyleNode,this.renderStyleNodeSelected),this.updateColor(e.colorRgba)),e.scale&&(this.renderStyle.scaleLocal=e.scale,this.state.scale=e.scale),this.isCustom=!0,!0}setDash(e){this.renderStyle.dash=e,this.geo.scene.annotationInstance.io.eventListenerAnnotation.addGeometryStack(this.geo.toJSON())}toJson(){if(!this.isCustom)return;let e={width:this.state.width,scale:this.renderStyle.scaleLocal,colorRgba:this.tempColorRgba,fill:this.tempFillRgba};return this.state.themeColorId!==h.AccentColor1&&(e.color=this.state.themeColorId),e}isSameStyle(e){if(e.colorRgba.length===this.tempColorRgba.length||e.fill.length===this.tempFillRgba){for(let t=0;t<e.colorRgba.length;t++)if(e.colorRgba[t]!==this.tempColorRgba[t])return!1;for(let t=0;t<e.fill.length;t++)if(e.fill[t]!==this.tempFillRgba[t])return!1}return!0}constructor(e){super(e),this.renderStyleNodeSelected=new b,this.updateStyle(),this.updateColor()}}class eO{polygonGraphResetForSplit(){this._needCtrlKey=!0}translateByMouseEventData(e){if(this.geo.isRemove||!this.geo.isRenderable||this.geo.isHiddenValue)return;let t=e.x-e.preX,s=e.y-e.preY;if(this.geo.graphCore.selVec){if(this.geo.scene.annotationInstance.activeCommandController.acProperties.pressCtrlKey&&this._needCtrlKey&&(this.geo.graphCore.splitNodeVec(),this._needCtrlKey=!1),this.geo.graphCore.selVec.x+=t,this.geo.graphCore.selVec.y+=s,this.geo.skipTranslationForLeaderline)return;this.geo.textLeaderline&&(this.geo.textLeaderline.translateByMouseEventData(e),this.geo.textLeaderline&&this.geo.textLeaderline.leaderline&&(this.geo.textLeaderline.leaderline.v2.x+=t,this.geo.textLeaderline.leaderline.v2.y+=s)),this.geo.isSelectedNode=!0;return}if(this.geo.graphCore.selMidVec){this.geo.graphCore.insertMidVec(),this.geo.isSelectedNode=!0;return}this.geo.isSelectedNode=!1;for(let e=0;e<this.geo.graphCore.vs.length;++e)this.geo.graphCore.vs[e].x+=t,this.geo.graphCore.vs[e].y+=s;this.geo.textLeaderline&&(this.geo.textLeaderline.translateByMouseEventData(e),this.geo.textLeaderline.leaderline&&(this.geo.textLeaderline.leaderline.v2.x+=t,this.geo.textLeaderline.leaderline.v2.y+=s))}translate(e,t){}constructor(e){this._needCtrlKey=!0,this.geo=e}}class eV extends S{static cancel(e){void 0!==e.listAPolylineGraphShadow&&(e.listAPolylineGraphShadow=void 0)}static doneByKeyboard(e){if(void 0!==e.listAPolylineGraphShadow){let t=e.listAPolylineGraphShadow.getVecs();t&&eV.getPolygon(e,t),e.listAPolylineGraphShadow=void 0,e.annotationInstance.activeCommandController.goToACMode()}}static undo(e,t){void 0!==e.listAPolylineGraphShadow&&e.listAPolylineGraphShadow.undo()}static mouseDown(e,t){void 0!==e.listAPolylineGraphShadow&&e.listAPolylineGraphShadow.ps.length>0&&e.listAPolylineGraphShadow.add(new p.h9(t.x,t.y))}static mouseLeftClick(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2];let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:p.zq.POLYGON_GRAPH;void 0===e.capture&&(void 0===e.listAPolylineGraphShadow&&(e.listAPolylineGraphShadow=new Z(e,s),e.listAPolylineGraphShadow.add(new p.h9(t.x,t.y)),e.listAPolylineGraphShadow.add(new p.h9(t.x,t.y))),e.annotationInstance.implementations.app.model.ioWrapper.eventInteraction.isEnableZoomByDoubleClick=!1)}static mouseMove(e,t){if(void 0!==e.listAPolylineGraphShadow){if(e.annotationInstance.activeCommandController.acProperties.pressShift){let s=e.listAPolylineGraphShadow.ps[e.listAPolylineGraphShadow.ps.length-1];(0,p.Sp)(s.v,new p.h9(t.x,t.y))>20&&e.listAPolylineGraphShadow.add(new p.h9(t.x,t.y))}e.listAPolylineGraphShadow.ps.length>1&&e.listAPolylineGraphShadow.mouseMove(t.x,t.y)}}static mouseDoubleClick(e,t){if(void 0!==e.listAPolylineGraphShadow){if(e.annotationInstance.activeCommandController.IsTouchEvent){if(e.listAPolylineGraphShadow.ps.length>1){let t=e.listAPolylineGraphShadow.getVecs();t&&((t=t.slice(0,t.length-1))&&eV.getPolygon(e,t),e.listAPolylineGraphShadow=void 0,e.annotationInstance.activeCommandController.goToACMode())}}else if(e.listAPolylineGraphShadow.ps.length>1){let t=e.listAPolylineGraphShadow.getVecs();t&&eV.getPolygon(e,t),e.listAPolylineGraphShadow=void 0,e.annotationInstance.activeCommandController.goToACMode()}e.annotationInstance.implementations.app.model.ioWrapper.eventInteraction.isEnableZoomByDoubleClick=!0}}static getPolygonbyVecs(e,t){return this.getPolygon(e,t)}static getPolygon(e,t){return arguments.length>2&&void 0!==arguments[2]&&arguments[2],e.listAPolylineGraphShadow=void 0,new eV(e,t,p.zq.POLYGON_GRAPH,!1,!0)}static fromJSON(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=[];for(let e=0;e<t.nodes.length;++e){let s=new p.h9(t.nodes[e].sx,t.nodes[e].sy);n.push(s)}let o=new eV(e,n,p.zq.POLYGON_GRAPH,!0);return o.type=p.zq[t.type],i?o.id=e.getUUID():o.id=t.id,o.isUnderConstruction=!1,o.isHover=!1,o.isHiddenValue=t.isHidden,t.isHidden?o.visibilityValue=0:o.visibilityValue=1,t.styles&&t.styles.dash&&(o.styleComponent.renderStyle.dash=t.styles.dash),t.styles&&o.updateStyleCustom(t.styles),t.data.scale&&o.initScale(t.data.scale),o.initVecsHistory(),s||e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(o.toJSON()),o}initComponent(){this.styleComponent=new eL(this),this.mouseEventComponent=new eR(this),this.ioComponent=new eI(this),this.interactionComponent=new ew(this),this.transformationComponent=new eO(this),this.renderer=new eb(this)}initGraph(e){this.graphCore=new ex(this),this.graphCore.initByVec(e)}updateCenVec(){this.vec=this.graphCore.getCenVec()}polygonGraphResetForSplit(){this.transformationComponent.polygonGraphResetForSplit()}needSnapping(e){return this.interactionComponent.needSnapping(e)}getVecForSnapping(){return this.graphCore.selVec}getVecs(){return this.graphCore.vs}goToBlackhole(){this.needBlackhole=!0,this.tVec=this.scene.annotationInstance.renderer.blackhole.v,this.isAniAccel=!0}isMoveUpdate(){this.vecsHistory.length<1||(this.isMove=!0,this.isTransform=!0)}remove(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];if(!this.isRemove&&this.isRenderable&&!this.isHiddenValue){if(this.graphCore.selectedVec){this.graphCore.removeSelVec();let e=this.toJSON();if(e){this.scene.annotationInstance.io.eventListenerAnnotation.transformStack([e]);return}}this.ioComponent.remove(e)}}deepRemove(){this.isSelectable=!1,this.isRenderable=!1,this.hidePopUpSummary(),this.scene.removeAPolygonGraphWrapper(this),this.scene.removeGeometry(this)}isMouseInside(e,t){return this.interactionComponent.isMouseInside(e,t)}getLog(){return this.interactionComponent.GetLog()}hide(){this.interactionComponent.hide()}translateByMouseEventData(e){this.transformationComponent.translateByMouseEventData(e)}translate(e,t){this.transformationComponent.translate(e,t)}toJSON(){return this.ioComponent.ToJSON()}mouseLeftClick(){this.mouseEventComponent.mouseLeftClick()}mouseRightClick(){this.mouseEventComponent.mouseRightClick()}renderPost(e){this.renderer.renderPost(e)}renderPostNodes(e){this.renderer.renderPostNodes(e)}get isHidden(){return this.isHiddenValue}set isHidden(e){this.isHiddenPre=this.isHiddenValue,this.isHiddenValue=e,this.scene.annotationInstance.io.eventListenerAnnotation.hideStack(this.toJSON())}get isSelected(){return this.isSelectedValue}set isSelected(e){this.isRemove||!this.isRenderable||this.isHiddenValue||this.graphCore.selVec||(this.isSelectedValue=e,e||(this.graphCore.selectedVec=void 0),this.scene.annotationInstance.io.eventListenerAnnotation.selectionStack(this.toJSON()))}get isHover(){return this.isHoverValue}set isHover(e){!this.isUnderConstruction&&(this.isHoverValue=e,this.isHoverValue&&!this.isHoverPre?this.scene.annotationInstance.io.eventListenerAnnotation.hoverStack(this.toJSON()):!this.isHoverValue&&this.isHoverPre&&this.scene.annotationInstance.io.eventListenerAnnotation.hoverStack(this.toJSON()),this.isHoverPre=this.isHoverValue,e||(this.needEmitHoverPost=!0,this.hidePopUpSummary()))}getBoundary(){return[this.vec]}showPopupSummary(){this.interactionComponent.showPopupSummary()}getclosestNode(e,t){if(this.graphCore.getclosestVec(e,t))return this}findClosestVec(e){return this.graphCore.getclosestVec(e,20)}updatePopup(){this.hasPopupValue&&void 0!==this.popup&&(this.hasGhostPopup?this.popup.style.top=this.vec.y-this.scene.annotationInstance.customization.themeCurrent.nPoint.height-this.ghostPopupOffset+"px":this.popup.style.top=this.vec.y+"px",this.popup.style.left=this.vec.x+"px")}checkAttachedTextleaderline(){if(!this.textLeaderline||!this.textLeaderline.leaderline)return!1;if(this.skipTranslationForLeaderline=!0,this.graphCore.selVec&&this.textLeaderline&&this.textLeaderline.leaderline){if((0,p.Sp)(this.graphCore.selVec,this.textLeaderline.leaderline.v2)>5)return this.skipTranslationForLeaderline=!0,!1;this.skipTranslationForLeaderline=!1}let e=!1;for(let t=0;t<this.graphCore.vs.length;++t)5>(0,p.Sp)(this.graphCore.vs[t],this.textLeaderline.leaderline.v2)&&(e=!0);return!!e||(this.textLeaderline.attachedShape=void 0,this.textLeaderline=void 0,!1)}constructor(e,t,s=p.zq.POLYGON_GRAPH,i=!1,n=!0){super(e),this.isSelectedNode=!1,this.torVisMidPt=10,this.skipTranslationForLeaderline=!0,this.type=s,this.isUnderConstruction=!1,this.isSelectable=!0,this.isRenderable=!0,this.isFill=!0,this.isUndo=i,this.initGraph(t),this.updateCenVec(),this.initVecsHistory(),this.initComponent(),this.scene.addAPolygonGraphWrapper(this),this.isUndo||this.scene.annotationInstance.io.eventListenerAnnotation.addGeometryStack(this.toJSON())}}eV.isSplit=!0;class eN extends x{renderPost(e){this.timer.update(),this.host.computeBoundingVecsAndCenterVec(),this.host.scene.annotationInstance.activeCommandController.acProperties.showUnit&&(this.host.type===p.zq.CURVE_CLOSE?(this.host.isHoverValue||this.host.isUnderConstruction)&&this.host.dimension.renderTotalAreaCurve(e,this.host.vecs,this.host.isClosed):(this.host.isHoverValue||this.host.isUnderConstruction)&&this.host.dimension.renderTotalLengthCurve(e,this.host.vecs,this.host.isClosed)),this.host.computeCurve(),this.renderPostGeometry(e)}renderPostGeometry(e){this.renderSpline(e,this.host.arrayVertexs,this.host.arrayControlPoint,this.host.arrayWeight,this.host.isHoverValue,this.host.isSelectedValue,this.host.isClosed),(this.host.isHoverValue||this.host.isSelectedValue)&&this.host.scene.annotationInstance.implementations.app.model.appCoreWrapper.appControllerStatus.mode===p.An.Drawing&&(this.drawControlLine(e,this.host.arrayControlPoint,this.host.arrayVertexs),this.drawControPoint(e,this.host.arrayControlPoint))}renderSpline(e,t,s,i,n,o,r){let a=t.length;if(r){if(this.host.isHoverValue||this.host.isSelectedValue)for(let i=2;i<a+2;i+=2)this.host.scene.annotationInstance.renderer.draw.shape.curve.curveBezierClosedHoverPolygon(e,this.host.styleComponent.renderStyle,t[i],t[i+1],s[2*i-2],s[2*i-1],s[2*i],s[2*i+1],t[i+2],t[i+3],this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.host.renderer.tOver));for(let i=2;i<a+2;i+=2)this.host.scene.annotationInstance.renderer.draw.shape.curve.curveBezierClosed(e,this.host.styleComponent.renderStyle,t[i],t[i+1],s[2*i-2],s[2*i-1],s[2*i],s[2*i+1],t[i+2],t[i+3],this.host.isHoverValue,this.host.isSelectedValue);this.host.isFill&&this.renderCurveInfill(e,t,s)}else{if(this.host.isHoverValue||this.host.isSelectedValue){for(let i=2;i<t.length-5;i+=2)this.host.scene.annotationInstance.renderer.draw.shape.curve.curveBezierHoverPolyline(e,this.host.styleComponent.renderStyle,t[i],t[i+1],s[2*i-2],s[2*i-1],s[2*i],s[2*i+1],t[i+2],t[i+3],this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.host.renderer.tOver));this.host.scene.annotationInstance.renderer.draw.shape.curve.curveQuadraticHoverPolyline(e,this.host.styleComponent.renderStyle,t[0],t[1],s[0],s[1],t[2],t[3],this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.host.renderer.tOver)),this.host.scene.annotationInstance.renderer.draw.shape.curve.curveQuadraticHoverPolyline(e,this.host.styleComponent.renderStyle,t[a-2],t[a-1],s[2*a-10],s[2*a-9],t[a-4],t[a-3],this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.host.renderer.tOver))}for(let i=2;i<t.length-5;i+=2)this.host.scene.annotationInstance.renderer.draw.shape.curve.curveBezier(e,this.host.styleComponent.renderStyle,t[i],t[i+1],s[2*i-2],s[2*i-1],s[2*i],s[2*i+1],t[i+2],t[i+3],this.host.isHoverValue,this.host.isSelectedValue);this.host.scene.annotationInstance.renderer.draw.shape.curve.curveQuadratic(e,this.host.styleComponent.renderStyle,t[0],t[1],s[0],s[1],t[2],t[3],this.host.isHoverValue,this.host.isSelectedValue),this.host.scene.annotationInstance.renderer.draw.shape.curve.curveQuadratic(e,this.host.styleComponent.renderStyle,t[a-2],t[a-1],s[2*a-10],s[2*a-9],t[a-4],t[a-3],this.host.isHoverValue,this.host.isSelectedValue)}this.offscreenRender(t,s,a,r)}drawControPoint(e,t){e.lineWidth=.5*this.host.styleComponent.renderStyleNode.lineWidth,e.fillStyle=this.host.styleComponent.renderStyleNode.colorFill,e.strokeStyle=this.host.styleComponent.renderStyleNode.colorStroke;for(let s=0;s<t.length-1;s+=2)e.beginPath(),e.arc(t[s],t[s+1],3*this.host.scaleForRender,0,2*Math.PI,!1),e.fill(),e.stroke()}drawControlLine(e,t,s){for(let i=2;i<s.length-5;i+=2)this.host.scene.annotationInstance.renderer.draw.shape.curve.drawControlLine(e,this.host.styleComponent.renderStyle,s[i],s[i+1],t[2*i-2],t[2*i-1]),this.host.scene.annotationInstance.renderer.draw.shape.curve.drawControlLine(e,this.host.styleComponent.renderStyle,s[i+2],s[i+3],t[2*i],t[2*i+1]);this.host.scene.annotationInstance.renderer.draw.shape.curve.drawControlLine(e,this.host.styleComponent.renderStyle,s[2],s[3],t[0],t[1]),this.host.scene.annotationInstance.renderer.draw.shape.curve.drawControlLine(e,this.host.styleComponent.renderStyle,s[s.length-4],s[s.length-3],t[2*s.length-10],t[2*s.length-9])}renderCurveInfill(e,t,s){arguments.length>3&&void 0!==arguments[3]&&arguments[3];let i=t.length;this.host.scene.annotationInstance.renderer.needFocus&&!this.host.isHoverValue?(e.strokeStyle=this.host.styleComponent.renderStyle.colorStrokeHover,e.fillStyle=this.host.styleComponent.renderStyle.colorFillHover):(e.strokeStyle=this.host.styleComponent.renderStyle.colorStroke,e.fillStyle=this.host.styleComponent.renderStyle.colorFill),this.host.isSelectedValue&&(e.strokeStyle=this.host.styleComponent.renderStyle.colorStroke,e.fillStyle=this.host.styleComponent.renderStyle.colorFill),e.beginPath(),e.moveTo(t[2],t[3]);for(let n=2;n<i+2;n+=2)this.host.scene.annotationInstance.renderer.draw.shape.curve.curveBezierClosedFill(e,this.host.styleComponent.renderStyle,t[n],t[n+1],s[2*n-2],s[2*n-1],s[2*n],s[2*n+1],t[n+2],t[n+3]);e.closePath(),e.fill()}renderCurveInfillOffscreen(e,t,s,i){let n=s.length;e.save(),e.beginPath(),e.fillStyle=t,e.moveTo(s[2],s[3]);for(let t=2;t<n+2;t+=2)this.host.scene.annotationInstance.renderer.draw.shape.curve.curveBezierClosedFill(e,this.host.styleComponent.renderStyle,s[t],s[t+1],i[2*t-2],i[2*t-1],i[2*t],i[2*t+1],s[t+2],s[t+3]);e.closePath(),e.fill(),e.restore()}offscreenRender(e,t,s,i){if(i){for(let i=2;i<s+2;i+=2)this.host.scene.annotationInstance.renderer.offscreen.curveBezierOffScreen(this.host.scene.annotationInstance.renderer.ctxOffscreen,this.host.styleComponent.renderStyle,this.host.hashColor,e[i],e[i+1],t[2*i-2],t[2*i-1],t[2*i],t[2*i+1],e[i+2],e[i+3]);this.renderCurveInfillOffscreen(this.host.scene.annotationInstance.renderer.ctxOffscreen,this.host.hashColor,e,t)}else{for(let s=2;s<e.length-5;s+=2)this.host.scene.annotationInstance.renderer.offscreen.curveBezierOffScreen(this.host.scene.annotationInstance.renderer.ctxOffscreen,this.host.styleComponent.renderStyle,this.host.hashColor,e[s],e[s+1],t[2*s-2],t[2*s-1],t[2*s],t[2*s+1],e[s+2],e[s+3]);this.host.scene.annotationInstance.renderer.offscreen.curveQuadraticArrowOffScreen(this.host.scene.annotationInstance.renderer.ctxOffscreen,this.host.styleComponent.renderStyle,this.host.hashColor,e[0],e[1],t[0],t[1],e[2],e[3]),this.host.scene.annotationInstance.renderer.offscreen.curveQuadraticArrowOffScreen(this.host.scene.annotationInstance.renderer.ctxOffscreen,this.host.styleComponent.renderStyle,this.host.hashColor,e[s-2],e[s-1],t[2*s-10],t[2*s-9],e[s-4],e[s-3])}}constructor(e){super(e),this.host=e}}class ek extends O{updateStyle(){b.updateRenderStylePolygon(this.renderStyle,this.geo.scene.annotationInstance.customization.themeCurrent),b.updateRenderStylePolygonNode(this.renderStyleNode,this.geo.scene.annotationInstance.customization.themeCurrent)}constructor(e){super(e),this.updateStyle()}}class eE extends S{static getControlPoints(e,t,s,i,n,o,r){let a=Math.sqrt(Math.pow(s-e,2)+Math.pow(i-t,2)),h=r*a/(a+Math.sqrt(Math.pow(n-s,2)+Math.pow(o-i,2))),c=r-h;return[s+h*(e-n),i+h*(t-o),s-c*(e-n),i-c*(t-o)]}static computeControlPoints(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=[];if(s){e.push(e[0],e[1],e[2],e[3]),e.unshift(e[e.length-1]),e.unshift(e[e.length-1]);for(let s=0;s<e.length;s+=2)i=i.concat(eE.getControlPoints(e[s],e[s+1],e[s+2],e[s+3],e[s+4],e[s+5],t));i=i.concat(i[0],i[1])}else for(let s=0;s<e.length-4;s+=2)i=i.concat(eE.getControlPoints(e[s],e[s+1],e[s+2],e[s+3],e[s+4],e[s+5],t));return i}static getLength(e,t){let s=e.listACurve.length,i=0;for(;s--;)t===e.listACurve[s].type&&(i+=1);return i}static getLengthSelection(e,t){let s=e.listACurve.length,i=0;for(;s--;)e.listACurve[s].isSelected&&t===e.listACurve[s].type&&(i+=1);return i}static fromJSON(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=new eE(e,n,s);if(s)for(let i=0;i<t.nodes.length;++i)o.addPT(k.getNodeFromJSON(e,t.nodes[i],s));else for(let s=0;s<t.nodes.length;++s)o.addPT(k.getNodeFromJSON(e,t.nodes[s]));return o.type=p.zq[t.type],o.IsSelectable=!0,o.isUnderConstruction=!1,o.isHover=!1,o.isHidden=t.isHidden,i?o.id=e.getUUID():o.id=t.id,t.isHidden?o.visibilityValue=0:o.visibilityValue=1,o.initVecsHistory(),eE.construction=void 0,o}static getCurveByVecs(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=new eE(e,s);for(let s=0;s<t.length;++s)i.addPT(new k(e,t[s].x,t[s].y,0));return i.IsSelectable=!0,i.isUnderConstruction=!1,e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(i.toJSON()),i}static drawShadow(e){if(void 0!==eE.construction){if(eE.construction.pts.length<3){if(eE.construction.isRemove)return;eE.construction.pts[eE.construction.pts.length-1].move(e.x,e.y);let t=eE.construction.pts[0],s=eE.construction.pts[1],i=eE.construction.pts[2];s.vec.x=(t.vec.x+i.vec.x)*.5,s.vec.y=(t.vec.y+i.vec.y)*.5}else eE.construction.pts[eE.construction.pts.length-1].move(e.x,e.y)}}static getCurveByPt(e,t){eE.construction=new eE(e),eE.construction.addPT(new k(e,t.vec.x,t.vec.y)),eE.construction.addPT(new k(e,t.vec.x,t.vec.y)),eE.construction.addPT(new k(e,t.vec.x,t.vec.y)),t.remove()}static getCurve(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];void 0!==eE.construction?5>eE.construction.pts[0].distance(t.x,t.y)?(eE.construction.isClosed=s,eE.construction.isClosed&&eE.construction.removePT(eE.construction.pts[0]),eE.construction.removePT(eE.construction.pts[0]),eE.construction.removePT(eE.construction.pts[eE.construction.pts.length-1]),eE.construction.removePT(eE.construction.pts[eE.construction.pts.length-1]),eE.construction.IsCapture=!1,eE.construction=void 0):eE.construction.addPT(new k(e,t.x,t.y)):(eE.construction=new eE(e,s),eE.construction.addPT(new k(e,t.x,t.y)),eE.construction.addPT(new k(e,t.x,t.y)),eE.construction.addPT(new k(e,t.x,t.y)))}static done(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1],void 0!==eE.construction&&(eE.construction.pts.length<5?(new k(e,eE.construction.pts[0].vec.x,eE.construction.pts[0].vec.y,eE.construction.pts[0].vec.z).dummy(),eE.construction.remove()):(eE.construction.isClosed&&eE.construction.removePT(eE.construction.pts[0]),eE.construction.removePT(eE.construction.pts[0]),eE.construction.removePT(eE.construction.pts[eE.construction.pts.length-1]),eE.construction.removePT(eE.construction.pts[eE.construction.pts.length-1]),eE.construction.IsSelectable=!0,eE.construction.isUnderConstruction=!1,e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(eE.construction.toJSON())),eE.construction=void 0,e.annotationInstance.activeCommandController.goToACMode())}static doneByKeyboard(e){void 0!==eE.construction&&(eE.construction.pts.length<5?(new k(e,eE.construction.pts[0].vec.x,eE.construction.pts[0].vec.y,eE.construction.pts[0].vec.z).dummy(),eE.construction.remove()):(eE.construction.removePT(eE.construction.pts[0]),eE.construction.removePT(eE.construction.pts[1]),eE.construction.removePT(eE.construction.pts[eE.construction.pts.length-1]),eE.construction.IsSelectable=!0,eE.construction.isUnderConstruction=!1,e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(eE.construction.toJSON())),eE.construction=void 0,e.annotationInstance.activeCommandController.goToACMode())}static undo(e){if(!eE.construction)return;let t=eE.construction.pts.length-1;if(t<4){eE.cancel();return}eE.construction.removePT(eE.construction.pts[--t]),eE.construction.pts[t].vec.x=e.x,eE.construction.pts[t].vec.y=e.y}static cancel(){void 0!==eE.construction&&(eE.construction.isRemove=!0,eE.construction.remove(),eE.construction=void 0)}static mouseDown(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e.annotationInstance.activeCommandController.acProperties.isSmartSelectionWhenDrawing){let i=e.annotationInstance.geometryCommon.gcmdProcessing.findAtPoint(t);eE.construction&&(i===eE.construction.pts[eE.construction.pts.length-1]?void 0!==i&&i.type===p.zq.ANODE&&void 0!==eE.construction?(eE.construction&&eE.construction.addPT(new k(e,i.v.x,i.v.y,i.v.z)),i.remove()):void 0!==i&&i.type===p.zq.ANODE&&void 0===eE.construction&&eE.getCurveByPt(e,i):eE.getCurve(e,t,s))}else eE.getCurve(e,t,s)}static mouseDoubleClick(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];void 0!==eE.construction&&eE.done(e,s)}static mouseLeftClick(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];void 0===e.capture&&void 0===eE.construction&&eE.getCurve(e,t,s)}static mouseMove(e){eE.drawShadow(e)}initComponent(){this.styleComponent=new ek(this),this.renderer=new eN(this)}init(){}getLog(){return"GUID : "+this.id+"/TYPE : "+this.type.toString()+"/Screen : /Nodes : "+this.pts.length+"/IsSEL : "+this.isSelectedValue+"/isSelable : "+this.isSelectable}getLogDOM(){return"Geometry ID : "+this.id+"<br>geometry Type : CCircle<br>position : size : "+this.r+" pixel<br>"}getVecs(){for(let e of(this.vecs=[],this.pts))this.vecs.push(e.vec);return this.vecs}computeVertex(){for(let e of(this.arrayVertexs=[],this.pts))this.arrayVertexs.push(e.vec.x,e.vec.y)}computeWeight(){for(let e of(this.arrayWeight=[],this.pts))this.arrayWeight.push(e.weightLeft,e.weightRight)}computeControlPoint(){let e=[];for(let t of this.arrayVertexs)e.push(t);let t=[];if(this.isClosed){e.push(e[0],e[1],e[2],e[3]),e.unshift(e[this.arrayVertexs.length-1]),e.unshift(e[this.arrayVertexs.length-1]);for(let s=0;s<this.arrayVertexs.length;s+=2)t=t.concat(eE.getControlPoints(e[s],e[s+1],e[s+2],e[s+3],e[s+4],e[s+5],this.arrayWeight[s]));t=t.concat(t[0],t[1]),this.arrayControlPoint=t,this.arrayVertexs=e;return}for(let s=0;s<e.length-4;s+=2)t=t.concat(eE.getControlPoints(e[s],e[s+1],e[s+2],e[s+3],e[s+4],e[s+5],this.arrayWeight[s]));this.arrayControlPoint=t}goToBlackhole(){this.isSelectable=!1,this.needBlackhole=!0,this.pts.forEach(e=>{e.goToBlackhole()})}computeVertexDuplication(e){for(let t of(this.arrayVertexs=[],e))this.arrayVertexs.push(t.x,t.y);let t=[];for(let e of this.arrayVertexs)t.push(e);let s=[];if(this.isClosed){t.push(t[0],t[1],t[2],t[3]),t.unshift(t[this.arrayVertexs.length-1]),t.unshift(t[this.arrayVertexs.length-1]);for(let e=0;e<this.arrayVertexs.length;e+=2)s=s.concat(eE.getControlPoints(t[e],t[e+1],t[e+2],t[e+3],t[e+4],t[e+5],this.arrayWeight[e]));s=s.concat(s[0],s[1]),this.arrayControlPoint=s,this.arrayVertexs=t;return}for(let e=0;e<t.length-4;e+=2)s=s.concat(eE.getControlPoints(t[e],t[e+1],t[e+2],t[e+3],t[e+4],t[e+5],this.arrayWeight[e]));this.arrayControlPoint=s}computeCurve(){this.computeVertex(),this.computeWeight(),this.computeControlPoint()}remove(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0],t=this.pts.length;for(;t--;)this.pts[t].remove();if(e){let e=this.toJSON();e&&this.scene.annotationInstance.io.eventListenerAnnotation.removeGeometryStack([e])}this.scene.removeACurve(this),this.scene.removeGeometry(this)}hide(){}addPT(e){e.type=p.zq.ANODE,e.vec.w=.5,e.weightLeft=e.vec.w,e.weightRight=0,e.isSelectable=!1,e.styleComponent.renderStyle=this.styleComponent.renderStyleNode,e.styleComponent.renderStyleNode=this.styleComponent.renderStyleNode,e.styleComponent.updateStyleForNode(this.styleComponent.renderStyleNode),e.edges.push(this),this.pts.push(e),this.pts.length>2&&this.computeCurve()}removePT(e){this.pts.splice(this.pts.indexOf(e),1),e.remove()}deepCopy(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2];let s=this.toJSON();if(s){let i;return(i=s.type===p.zq.CURVE_CLOSE?eE.fromJSON(this.scene,s,!0,!0,!0):eE.fromJSON(this.scene,s,!0,!0)).move(e,t),i.isHover=!0,i.emitAddStack(),i}}move(e,t){if(this.isRemove||!this.isRenderable||this.isHiddenValue)return;this.computeBoundingVecsAndCenterVec();let s=e-this.vec.x,i=t-this.vec.y;for(let e=0;e<this.pts.length;++e)this.pts[e].vec.x+=s,this.pts[e].vec.y+=i}isMouseInside(e,t){return!0!==this.isUnderConstruction&&void 0!==this.isUnderConstruction&&!!(this.checkDistance(e,t)||this.isMouseInsideByOffScreen(e,t))}checkDistance(e,t){return!1}isMouseInsideByOffScreen(e,t){return this.scene.annotationInstance.geometryCommon.gcmdProcessing.isMouseInsideByOffScreen(e,t,this.hashColor)?(this.isHover=!0,!0):(this.isHover=!1,!1)}set IsSelectable(e){this.isSelectable=e;for(let t=0;t<this.pts.length;++t)this.pts[t].isSelectable=e}get IsSelectable(){return this.isSelectable}translateByMouseEventData(e){let t=e.x-e.preX,s=e.y-e.preY;for(let e=0;e<this.pts.length;++e)this.pts[e].vec.x+=t,this.pts[e].vec.y+=s}translate(e,t){}get isSelected(){return this.isSelectedValue}set isSelected(e){for(let t of(this.isSelectedValue=e,this.pts))t.isRenderable=e;this.scene.annotationInstance.io.eventListenerAnnotation.selectionStack(this.toJSON())}get isHover(){return this.isHoverValue}set isHover(e){if(!this.isUnderConstruction&&!this.isSelectedValue){for(let t of this.pts)t.isRenderable=e;if(this.isHoverValue=e,this.isHoverValue&&!this.isHoverPre){for(let e=0;e<this.pts.length;++e)this.pts[e].renderer.t=0;this.scene.annotationInstance.io.eventListenerAnnotation.hoverStack(this.toJSON())}else!this.isHoverValue&&this.isHoverPre&&this.scene.annotationInstance.io.eventListenerAnnotation.hoverStack(this.toJSON());this.isHoverPre=this.isHoverValue,e||(this.needEmitHoverPost=!0,this.hidePopUpSummary())}}get IsCapture(){return this.isCapturedValue}set IsCapture(e){for(let t=0;t<this.pts.length;++t)this.pts[t].isCapturedValue=e}getNode(){let e=[];for(let t=0;t<this.pts.length;++t)e.push(this.pts[t].vec);return e}mouseRightClick(){this.isClosed&&(this.isFill=!this.isFill)}toJSON(){let e=new g(this.id,this.type,this.isSelectedValue,this.isHoverValue,this.isHiddenValue);return e.pushNode(this.getNode()),e}renderPost(e){this.renderer.renderPost(e)}computeBoundingVecsAndCenterVec(){this.vecs=[];for(let e=0;e<this.pts.length;++e)this.vecs.push(this.pts[e].vec);this.vec=(0,p.mI)(this.vecs)}constructor(e,t=!1,s=!1){super(e),this.vecSelected=-1,this.vec=new p.h9(0,0,0),this.pts=[],this.initComponent(),this.isClosed=t,this.isUndo=s,this.isUnderConstruction=!0,this.showDetails=!0,this.isClosed?(this.type=p.zq.CURVE_CLOSE,this.isFill=!0):(this.type=p.zq.CURVE_OPEN,this.isFill=!1),this.dimension=new G(this),this.scene.addACurve(this),this.init()}}eE.construction=void 0;class eT extends S{get v(){let e=(this.p0.vec.x+this.p1.vec.y+this.pm.vec.x)/3,t=(this.p0.vec.x+this.p1.vec.y+this.pm.vec.x)/3,s=(this.p0.vec.z+this.p1.vec.z+this.pm.vec.z)/3;return this.vec=new p.h9(e,t,s),this.vec}set v(e){this.vec=e}getLog(){return""}renderPost(e){}isMouseInside(e,t){return!1}translateByMouseEventData(e){}translate(e,t){}remove(){}hide(){}constructor(e){super(e),this.vec=new p.h9(0,0,0)}}class eD{isMouseInside(e,t){return!1}getLog(){return""}hide(){}constructor(e){this.geo=e}}class ez extends eD{isMouseInside(e,t){return!0!==this.host.isUnderConstruction&&void 0!==this.host.isUnderConstruction&&this.host.scene.annotationInstance.implementations.app.model.appCoreWrapper.appControllerStatus.mode===p.An.Drawing&&!!(this.isMouseInsideByMath(e,t)||this.isMouseInsideByOffScreen(e,t))}isMouseInsideByOffScreen(e,t){return this.host.scene.annotationInstance.geometryCommon.gcmdProcessing.isMouseInsideByOffScreen(e-this.host.scene.annotationInstance.scene.paramsEditing.croppingMaskParams.x,t-this.host.scene.annotationInstance.scene.paramsEditing.croppingMaskParams.y,this.host.hashColor)?(this.host.isHover=!0,!0):(this.host.isHover=!1,!1)}isMouseInsideByMath(e,t){return(e-=this.host.scene.annotationInstance.scene.paramsEditing.croppingMaskParams.x,t-=this.host.scene.annotationInstance.scene.paramsEditing.croppingMaskParams.y,this.host.computeCurve(.3),this.isInsideFirstAndLastCurves(e,t))?(this.host.isHover=!0,!0):(this.host.isHover=!1,!1)}isInsideFirstAndLastCurves(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,i=this.host.arrayVertexs,n=this.host.arrayControlPoint;for(let o=0;o<1;o+=.001){let r=Math.abs(Math.pow(1-o,3))*i[0]+3*Math.pow(1-o,2)*o*n[0]+3*Math.abs(1-o)*Math.pow(o,2)*n[0]+Math.abs(Math.pow(o,3))*i[2],a=Math.abs(Math.pow(1-o,3))*i[1]+3*Math.pow(1-o,2)*o*n[1]+3*Math.abs(1-o)*Math.pow(o,2)*n[1]+Math.abs(Math.pow(o,3))*i[3],h=Math.abs(Math.pow(1-o,3))*i[2]+3*Math.pow(1-o,2)*o*n[2]+3*Math.abs(1-o)*Math.pow(o,2)*n[2]+Math.abs(Math.pow(o,3))*i[4],c=Math.abs(Math.pow(1-o,3))*i[3]+3*Math.pow(1-o,2)*o*n[3]+3*Math.abs(1-o)*Math.pow(o,2)*n[3]+Math.abs(Math.pow(o,3))*i[5];if((0,p.Th)(new p.h9(r,a),new p.h9(e,t))<s*this.host.scene.annotationInstance.activeCommandController.scaleGlobal||(0,p.Th)(new p.h9(h,c),new p.h9(e,t))<s*this.host.scene.annotationInstance.activeCommandController.scaleGlobal)return!0}return!1}translateByMouseEventData(e){if(this.host.isRemove||!this.host.isRenderable||this.host.isHiddenValue)return;let t=e.x-e.preX,s=e.y-e.preY;this.host.p0.vec.x+=t,this.host.p0.vec.y+=s,this.host.p1.vec.x+=t,this.host.p1.vec.y+=s,this.host.pm.vec.x+=t,this.host.pm.vec.y+=s}getLog(){return"GUID : "+this.host.id+"/TYPE : "+this.host.type.toString()+"/POS : /SIZE : "+this.host.r+" pixel/IsSEL : "+this.host.isSelectedValue+"/isSelable : "+this.host.isSelectable}hide(){}constructor(e){super(e),this.host=e}}class eM extends x{renderPost(e){this.host.arrowScale!==this.host.scene.annotationInstance.customization.themeCurrent.arrow.scale&&(this.host.arrowScale=this.host.scene.annotationInstance.customization.themeCurrent.arrow.scale),this.host.computeCurve(),(this.host.scene.annotationInstance.activeCommandController.acProperties.isPanning||this.host.scene.annotationInstance.activeCommandController.acProperties.isViewChanging)&&this.host.updateScaleByZoomLevel(),this.host.isUnderConstruction&&this.host.computeMidPoint(),this.renderPostGeometry(e)}renderPostGeometry(e){this.drawSpline(e,this.host.arrayVertexs,this.host.arrayControlPoint)}drawSpline(e,t,s){let i=t.length,n=[this.host.p0.vec,this.host.p1.vec,this.host.pm.vec];this.offscreenRender(t,s,i);let o=this.host.scene.annotationInstance.renderer.draw.shape.curve;this.host.isHoverValue||this.host.isSelectedValue?(o.curveQuadraticArrow(e,this.host.styleComponent.renderStyle,t[0],t[1],s[0],s[1],t[2],t[3],this.host.isHoverValue,n,this.host.isGrayColor,this.host.visibilityValue,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tOver),this.host.isSelectedValue,this.host.styleComponent.state.themeColorId,this._isDash,3),o.curveQuadraticArrow(e,this.host.styleComponent.renderStyle,t[i-2],t[i-1],s[2*i-10],s[2*i-9],t[i-4],t[i-3],this.host.isHoverValue,n,this.host.isGrayColor,this.host.visibilityValue,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tOver),this.host.isSelectedValue,this.host.styleComponent.state.themeColorId,this._isDash),o.cArrowByTranslation(e,this.host.styleComponent.renderStyle,new p.h9(t[4],t[5]),new p.h9(s[2],s[3]),t[4],t[5],this.host.arrowScale,this.host.styleComponent.renderStyle.scaleLocal*this.host.scene.annotationInstance.activeCommandController.scaleGlobal,this.host.isHoverValue,this.host.isGrayColor,this.host.visibilityValue,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tOver),this.host.isSelectedValue,this.host.styleComponent.state.themeColorId),this.host.type===p.zq.ARROW_DOUBLE&&o.cArrowByTranslation(e,this.host.styleComponent.renderStyle,new p.h9(t[0],t[1]),new p.h9(s[0],s[1]),t[0],t[1],this.host.arrowScale,this.host.styleComponent.renderStyle.scaleLocal*this.host.scene.annotationInstance.activeCommandController.scaleGlobal,!0,this.host.isGrayColor,this.host.visibilityValue,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tOver),this.host.isSelectedValue,this.host.styleComponent.state.themeColorId),this.tOver+=this.host.scene.annotationInstance.renderer.dt,this.tDown1=0,this.host.isLeave=!0):(o.curveQuadraticArrow(e,this.host.styleComponent.renderStyle,t[0],t[1],s[0],s[1],t[2],t[3],this.host.isHoverValue,n,this.host.isGrayColor,this.host.visibilityValue,1,this.host.isSelectedValue,this.host.styleComponent.state.themeColorId,this._isDash,3),o.curveQuadraticArrow(e,this.host.styleComponent.renderStyle,t[i-2],t[i-1],s[2*i-10],s[2*i-9],t[i-4],t[i-3],this.host.isHoverValue,n,this.host.isGrayColor,this.host.visibilityValue,1,this.host.isSelectedValue,this.host.styleComponent.state.themeColorId,this._isDash),o.cArrowByTranslation(e,this.host.styleComponent.renderStyle,new p.h9(t[4],t[5]),new p.h9(s[2],s[3]),t[4],t[5],this.host.arrowScale,this.host.styleComponent.renderStyle.scaleLocal*this.host.scene.annotationInstance.activeCommandController.scaleGlobal,this.host.isHoverValue,this.host.isGrayColor,this.host.visibilityValue,1,this.host.isSelectedValue,this.host.styleComponent.state.themeColorId),this.host.type===p.zq.ARROW_DOUBLE&&o.cArrowByTranslation(e,this.host.styleComponent.renderStyle,new p.h9(t[0],t[1]),new p.h9(s[0],s[1]),t[0],t[1],this.host.arrowScale,this.host.styleComponent.renderStyle.scaleLocal*this.host.scene.annotationInstance.activeCommandController.scaleGlobal,!1,this.host.isGrayColor,this.host.visibilityValue,1,this.host.isSelectedValue,this.host.styleComponent.state.themeColorId),this.tOver=0)}offscreenRender(e,t,s){this.host.scene.annotationInstance.renderer.offscreen.curveQuadraticArrowOffScreen(this.host.scene.annotationInstance.renderer.ctxOffscreen,this.host.styleComponent.renderStyle,this.host.hashColor,e[0],e[1],t[0],t[1],e[2],e[3]),this.host.scene.annotationInstance.renderer.offscreen.curveQuadraticArrowOffScreen(this.host.scene.annotationInstance.renderer.ctxOffscreen,this.host.styleComponent.renderStyle,this.host.hashColor,e[s-2],e[s-1],t[2*s-10],t[2*s-9],e[s-4],e[s-3])}get isDash(){return this._isDash}set isDash(e){this._isDash=e}constructor(e){super(e),this._isDash=!1,this.host=e}}class eG extends O{updateStyle(){this.isCustom||(this.state.themeColorId=h.TitleColor,this.tempColorRgba=[0,0,0,1],this.isCustom=!0,b.updateRenderStyleArrow(this.renderStyle,this.geo.scene.annotationInstance.customization.themeCurrent),b.updateRenderStyleArrowNode(this.renderStyleNode,this.geo.scene.annotationInstance.customization.themeCurrent),this.updateStyleNode())}updateColor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;this.isCustom=!0,void 0===e&&(e=this.geo.scene.annotationInstance.activeCommandController.activeColorController.activeColor),b.updateRenderColorArrowCustom(this.renderStyle,this.geo.scene.annotationInstance.customization.themeCurrent,e),b.updateRenderColorArrowNodeCustom(this.renderStyleNode,this.geo.scene.annotationInstance.customization.themeCurrent,e),this.updateStyleNode(),this.tempColorRgba=e}updateAccentColor(){}updateStyleCustom(e){return e.colorRgba&&(this.tempColorRgba=e.colorRgba),e.scale&&(this.renderStyle.scaleLocal=e.scale,this.state.scale=e.scale),e.width&&(this.state.width=e.width),void 0!==e.color&&(this.state.themeColorId=e.color),void 0!==e.lineDash&&(this.state.lineTypeId=e.lineDash,this.renderStyle.dash=I(e.lineDash)),e.colorRgba.length>0&&(b.updateRenderStyleArrowCustom(this.renderStyle,this.geo.scene.annotationInstance.customization.themeCurrent,e),b.updateRenderStyleArrowNodeCustom(this.renderStyleNode,this.geo.scene.annotationInstance.customization.themeCurrent,e),this.updateStyleNode()),this.isCustom=!0,!0}updateStyleNode(){if(this.geo.pts)for(let e=0;e<this.geo.pts.length;++e)this.geo.pts[e].styleComponent.updateStyleForNode(this.renderStyleNode)}toJson(){if(!this.isCustom)return;let e={width:this.state.width,scale:this.renderStyle.scaleLocal,colorRgba:this.tempColorRgba};return this.state.lineTypeId!==a.Continuous&&(e.lineDash=this.state.lineTypeId),this.state.themeColorId!==h.TitleColor&&(e.color=this.state.themeColorId),e}constructor(e){super(e),this.updateStyle(),this.updateColor()}}class eW extends O{translateByMouseEventData(e){if(this.host.isRemove||!this.host.isRenderable||this.host.isHiddenValue)return;if(this.host.pm.isHoverValue){this.host.pm.translateByMouseEventData(e);return}let t=e.x-e.preX,s=e.y-e.preY;this.host.p0.vec.x+=t,this.host.p0.vec.y+=s,this.translateForTextLeaderline(e,this.host.p0),this.host.p1.vec.x+=t,this.host.p1.vec.y+=s,this.translateForTextLeaderline(e,this.host.p1),this.host.pm.vec.x+=t,this.host.pm.vec.y+=s,this.translateForTextLeaderline(e,this.host.pm)}translateForTextLeaderline(e,t){return!!t.textLeaderline&&(t.textLeaderline.translateByMouseEventData(e),!!t.textLeaderline.leaderline)&&(t.textLeaderline.leaderline.v2.x=t.vec.x,t.textLeaderline.leaderline.v2.y=t.vec.y,!0)}translate(e,t){}move(e,t){if(this.host.isRemove||!this.host.isRenderable||this.host.isHiddenValue)return;this.host.computeCenterVec();let s=e-this.host.vec.x,i=t-this.host.vec.y;for(let e=0;e<this.host.pts.length;++e)this.host.pts[e].vec.x+=s,this.host.pts[e].vec.y+=i}constructor(e){super(e),this.host=e}}class eB{constructor(){}}class eH extends eT{static findAtPoint(e,t){for(let s=e.listAArrow.length-1;s>=0;--s)if(e.listAArrow[s].isSelectable&&e.listAArrow[s].isMouseInside(t.x,t.y))return e.listAArrow[s]}static computeOver(e,t){let s=eH.findAtPoint(e,t);void 0!==s&&(s.isHoverValue=!0)}static getLength(e,t){let s=e.listAArrow.length,i=0;for(;s--;)e.listAArrow[s].type===t&&(i+=1);return i}static getLengthSelection(e,t){let s=e.listAArrow.length,i=0;for(;s--;)e.listAArrow[s].isSelected&&e.listAArrow[s].type===t&&(i+=1);return i}static fromJSON(e,t){let s,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],r=k.getNodeFromJSON(e,t.nodes[0],i),a=k.getNodeFromJSON(e,t.nodes[1],i),h=k.getNodeFromJSON(e,t.nodes[2],i);r.type=p.zq.ANODE,a.type=p.zq.AMIDPOINT,h.type=p.zq.ANODE,(s=o?i?new eH(e,r,h,i,p.zq.ARROW_SINGLE):new eH(e,r,h,!1,p.zq.ARROW_SINGLE):i?new eH(e,r,h,i,p.zq.ARROW_DOUBLE):new eH(e,r,h,!1,p.zq.ARROW_DOUBLE)).pm.vec.x=a.vec.x,s.pm.vec.y=a.vec.y,a.remove(),n?s.id=e.getUUID():s.id=t.id,s.isUnderConstruction=!1,s.numSelectionWhenConstruction=2,s.isHover=!1,s.pm.type=p.zq.AMIDPOINT,t.data.isDash&&(s.renderer.isDash=t.data.isDash),t.styles&&s.updateStyleCustom(t.styles),s.computeCenterVec(),s.initVecsHistory(),i||e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(s.toJSON()),eH.condition.v0=void 0,eH.condition.v1=void 0,eH.condition.geo=void 0}static fromSmartDrawing(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:p.zq.ARROW_SINGLE;eH.getRectByVecs(e,t,s)}static getRectByVecs(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:p.zq.ARROW_SINGLE,i=t[0],n=t[t.length-1],o=new k(e,i.x,i.y,0,!1,p.zq.ANODE),r=new k(e,n.x,n.y,0,!1,p.zq.ANODE),a=new eH(e,o,r,!1,s);a.isSelected=a.isHover=a.isUnderConstruction=!1,e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(a.toJSON())}static drawShadow(e,t,s){if(void 0===eH.condition.geo){let i=new k(e,t.x,t.y,0);i.isSelectable=!1,s===p.zq.ARROW_SINGLE&&void 0!==eH.condition.v0&&(eH.condition.geo=new eH(e,eH.condition.v0,i,!1,p.zq.ARROW_SINGLE)),s===p.zq.ARROW_DOUBLE&&void 0!==eH.condition.v0&&(eH.condition.geo=new eH(e,eH.condition.v0,i,!1,p.zq.ARROW_DOUBLE)),void 0!==eH.condition.geo&&(eH.condition.geo.isSelectable=!1)}else void 0!==eH.condition.geo.p1&&eH.condition.geo.p1.move(t.x,t.y)}static getLine(e,t){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:p.zq.ARROW_SINGLE,void 0===eH.condition.v0){eH.condition.v0=new k(e,t.x,t.y);return}if(void 0!==eH.condition.v0){if(void 0===eH.condition.geo)return;eH.condition.geo.p1.move(t.x,t.y),eH.condition.geo.computeMidPoint(),eH.condition.geo.isSelectable=!0,eH.condition.geo.isUnderConstruction=!1,eH.condition.geo.isSelected=!1,eH.condition.geo.isCaptured=!1,e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(eH.condition.geo.toJSON());return}}static getLineByPt(e,t){if(void 0===eH.condition.v0&&void 0===eH.condition.v1){eH.condition.v0=new k(e,t.vec.x,t.vec.y,t.vec.z),eH.split?eH.condition.v0.vec=t.vec:t.remove();return}void 0!==eH.condition.geo&&void 0!==eH.condition.geo.p1&&eH.condition.geo.p1.move(t.vec.x,t.vec.y),void 0!==eH.condition.geo&&(eH.condition.geo.isSelectable=!0,eH.condition.geo.isUnderConstruction=!1),t.type===p.zq.CNODE?eH.split&&void 0!==eH.condition.geo&&(eH.condition.geo.p1.vec=t.vec):t.type===p.zq.APOINT&&t.remove()}static cancel(){void 0!==eH.condition.geo&&eH.condition.geo.remove(),eH.condition.v0=void 0,eH.condition.v1=void 0,eH.condition.geo=void 0}static mouseDown(e,t,s){void 0!==eH.condition.geo&&(void 0!==e.capture&&e.capture.type===p.zq.APOINT?eH.getLineByPt(e,e.capture):eH.getLine(e,t,s),eH.condition.geo.computeCenterVec(),eH.condition.geo.isUnderConstruction=!1,e.Capture=eH.condition.geo,eH.condition.geo.isSelected=!0,eH.condition.v0=void 0,eH.condition.v1=void 0,eH.condition.geo=void 0,eH.isDone=!1,e.annotationInstance.activeCommandController.acProperties.deselectNeeded=!1,e.annotationInstance.activeCommandController.goToACMode()),eH.condition.geo&&this.drawShadow(e,t,s)}static mouseLeftClick(e,t,s){if(eH.isDone){eH.isDone=!1;return}void 0!==e.capture&&e.capture.type===p.zq.APOINT&&void 0!==e.capture&&(eH.getLineByPt(e,e.capture),eH.isDone=!1),void 0===eH.condition.geo&&(eH.getLine(e,t,s),eH.isDone=!1),eH.drawShadow(e,t,s)}static mouseMove(e,t,s){void 0!==eH.condition.v0&&eH.drawShadow(e,t,s)}static mouseUp(e){}initComponent(){this.transformation=new eW(this),this.interaction=new ez(this),this.styleComponent=new eG(this),this.renderer=new eM(this)}initAArow(){this.computeCenterVec(),this.p0.addEdge(this),this.pm.addEdge(this),this.p1.addEdge(this),this.pts=[this.p0,this.pm,this.p1],this.arrowScale=1,this.lineWidth=5,this.curveWeight=.5,this.scene.addAArrow(this)}computeMidPoint(){let e=(0,p.zQ)(this.p0.vec,this.p1.vec);this.pm.vec.x=e.x,this.pm.vec.y=e.y,this.pm.isPointMid=!0,this.pm.type=p.zq.AMIDPOINT}computeVertex(e){let t=[],s=this.scene.paramsEditing.croppingMaskParams.x,i=this.scene.paramsEditing.croppingMaskParams.y;for(let n of e)t.push(n.x-s,n.y-i);return t}computeWeight(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=[];for(let s=0;s<this.pts.length;++s)t.push(e);this.arrayWeight=t}computeControlPoint(e){let t=[];for(let s of e)t.push(s);let s=[];for(let e=0;e<t.length-4;e+=2)s=s.concat(eE.getControlPoints(t[e],t[e+1],t[e+2],t[e+3],t[e+4],t[e+5],this.arrayWeight[e]));return s}findClosestNode(e,t){return this.isRemove||!this.isRenderable||this.isHiddenValue?void 0:this.p0.isMouseInside(e,t)?this.p0:this.p1.isMouseInside(e,t)?this.p1:void 0}computeCurve(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5;this.arrayVertexs=this.computeVertex(this.getVecs()),this.computeWeight(e),this.arrayControlPoint=this.computeControlPoint(this.arrayVertexs),this.computeCenterVec()}computeCenterVec(){let e=[this.p0.vec,this.p1.vec,this.pm.vec];return this.vec=(0,p.mI)(e),this.vec}getLog(){return this.interaction.getLog()}deepCopy(e,t){this.isSelected=!1;let s=this.p0.deepCopy(),i=this.p1.deepCopy();if(s&&i){let n=new eH(this.scene,s,i,!1,this.type);return n.pm.vec.x=this.pm.vec.x,n.pm.vec.y=this.pm.vec.y,n.isUnderConstruction=!1,n.move(e,t),n.emitAddStack(),n}}goToBlackhole(){this.isSelectable=!1,this.needBlackhole=!0,this.p0.goToBlackhole(),this.pm.goToBlackhole(),this.p1.goToBlackhole()}move(e,t){if(this.isRemove||!this.isRenderable||this.isHiddenValue)return;this.computeCenterVec();let s=e-this.vec.x,i=t-this.vec.y;for(let e=0;e<this.pts.length;++e)this.pts[e].vec.x+=s,this.pts[e].vec.y+=i}getVecs(){return[this.p0.vec,this.pm.vec,this.p1.vec]}isSelectedByWindow(e){return!!((0,p.X0)(this.p0.vec,e)&&(0,p.X0)(this.pm.vec,e)&&(0,p.X0)(this.p1.vec,e))}isSelectedByCrossing(e){return!!((0,p.X0)(this.p0.vec,e)||(0,p.X0)(this.pm.vec,e)||(0,p.X0)(this.p1.vec,e))}isMouseInside(e,t){return this.interaction.isMouseInside(e,t)}translateByMouseEventData(e){this.transformation.translateByMouseEventData(e)}remove(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];if(this.isSelectable=!1,this.isRenderable=!1,this.isRemove=!0,this.p0.deepRemove(),this.p1.deepRemove(),this.pm.deepRemove(),this.scene.removeAArrow(this),this.scene.removeGeometry(this),e){let e=this.toJSON();e&&this.scene.annotationInstance.io.eventListenerAnnotation.removeGeometryStack([e])}}hide(){this.interaction.hide()}getNode(){let e=[];return e.push(this.p0.vec),e.push(this.pm.vec),e.push(this.p1.vec),e}get isSelected(){return this.isSelectedValue}set isSelected(e){1!=this.numSelectionWhenConstruction++&&(this.scene.capture===this&&this.isMouseInside(this.scene.annotationInstance.activeCommandController.m.x,this.scene.annotationInstance.activeCommandController.m.y)?(this.isSelectedValue=!0,this.p0.isRenderable=!0,this.p1.isRenderable=!0,this.pm.isRenderable=!0):(this.isSelectedValue=e,this.p0.isRenderable=e,this.p1.isRenderable=e,this.pm.isRenderable=e),this.scene.annotationInstance.io.eventListenerAnnotation.selectionStack(this.toJSON()))}get isHover(){return this.isHoverValue}set isHover(e){this.isRemove||!this.isRenderable||this.isHiddenValue||this.isUnderConstruction||(this.isHoverValue=e,this.isHoverValue&&!this.isHoverPre?this.scene.annotationInstance.io.eventListenerAnnotation.hoverStack(this.toJSON()):!this.isHoverValue&&this.isHoverPre&&this.scene.annotationInstance.io.eventListenerAnnotation.hoverStack(this.toJSON()),this.isHoverPre=this.isHoverValue,this.isSelectedValue||(this.p0.isRenderable=e,this.p1.isRenderable=e,this.pm.isRenderable=e),e||(this.needEmitHoverPost=!0,this.hidePopUpSummary()))}get isHidden(){return this.isHiddenValue}set isHidden(e){this.isHiddenValue=e,this.p0.isHiddenValue=e,this.p0.visibility=0,this.pm.isHiddenValue=e,this.pm.visibility=0,this.p1.isHiddenValue=e,this.p1.visibility=0,this.scene.annotationInstance.io.eventListenerAnnotation.hideStack(this.toJSON())}get isCaptured(){return this.isCapturedValue}set isCaptured(e){this.isCapturedValue=this.p0.isCapturedValue=this.pm.isCapturedValue=this.p1.isCapturedValue=e}renderPost(e){this.renderer.renderPost(e)}mouseRightClick(){if(!this.scene.annotationInstance.implementations.app.CONFIG.LAB)return;this.renderer.isDash=!this.renderer.isDash;let e=this.toJSON();e&&this.scene.annotationInstance.io.eventListenerAnnotation.transformStack([e])}mouseUp(){}toJSON(){let e=new g(this.id,this.type,this.isSelectedValue,this.isHoverValue,this.isHiddenValue);e.pushNode(this.getNode());let t=this.styleComponent.toJson();return t&&(e.styles=t),e}constructor(e,t,s,i=!1,n=p.zq.ARROW_SINGLE){super(e),this.vecSelected=-1,this.numSelectionWhenConstruction=0,this.isUndo=i,this.type=n,this.p0=t,this.p1=s;let o=(0,p.zQ)(this.p0.vec,this.p1.vec);this.pm=new k(e,o.x,o.y,o.z),this.p0.type=p.zq.ANODE,this.pm.type=p.zq.ANODE,this.p1.type=p.zq.ANODE,this.vecs=[this.p0.vec,this.pm.vec,this.p1.vec],this.isMove=!0,this.tVec=new p.h9(0,0,0),this.initComponent(),this.initAArow()}}eH.isDone=!1,eH.split=!1,eH.condition=new eB;class eF{set textCol(e){this.divText&&(this.divText.style.color="black")}updateDiv(){if(this.divText){let e=this.wrapper.scene.annotationInstance.customization.themeCurrent.textleaderline.scale,t=(this.wrapper.v1.x-this.wrapper.v0.x)*e*.5;1===e?this.divText.style.left=this.wrapper.vecOffset.x+this.offsetForTextDiv*e-t+"px":this.divText.style.left=this.wrapper.vecOffset.x-t+"px",this.divText.style.top=this.wrapper.vUp.vec.y+Math.abs(this.wrapper.v1.y-this.wrapper.v0.y)-.5*Math.abs(this.wrapper.v1.y-this.wrapper.v0.y)+"px",this.divText.style.top=this.wrapper.v0.y+this.offsetForTextDiv+"px",this.divText.style.width=(this.wrapper.width-2*this.offsetForTextDiv)*e+"px"}this.divTextAnchor&&(this.divTextAnchor.style.top=this.wrapper.v0.y-this.wrapper.offsetForTextEditor+"px",this.divTextAnchor.style.left=this.wrapper.v0.x+"px")}hideTextDiv(){this.divText&&this.wrapper.scene.annotationInstance.implementations.app.model.modelViewWrapper.div.removeChild(this.divText),this.divTextAnchor&&this.wrapper.scene.annotationInstance.implementations.app.model.modelViewWrapper.div.removeChild(this.divTextAnchor),this.divText=void 0,this.divTextAnchor=void 0,this.wrapper.scene.annotationInstance.io.eventListenerAnnotation.hideTextStack(this.wrapper.toJSON())}showTextDiv(){this.getDivBaseContainer(),this.getDivAnchor(),this.wrapper.isUnderConstruction||this.wrapper.scene.annotationInstance.io.eventListenerAnnotation.showTextStack(this.wrapper.toJSON())}focusOnTextDiv(){document.getElementById("text-editor-"+this.wrapper.id)&&(this.wrapper.scene.annotationInstance.io.eventListenerAnnotation.startEditingText(this.wrapper.toJSON()),this.wrapper.scene.annotationInstance.activeCommandController.IsTextEditing=!0)}getDivAnchor(){let e=document.createElement("div");return e.id="text-toolbar-"+this.wrapper.id,e.style.position="absolute",e.style.height="0px",e.style.width="0px",e.style.backgroundColor="#00ff00",e.style.top=this.wrapper.v0.y-this.wrapper.offsetForTextEditor+"px",e.style.left=this.wrapper.v0.x+"px",this.divTextAnchor=e,this.wrapper.scene.annotationInstance.implementations.app.model.modelViewWrapper.div.insertBefore(this.divTextAnchor,this.wrapper.scene.annotationInstance.graphicsCoreWrapper.canvasWrapper.aCanvasMask.canvas),e}getDivBaseContainer(){let e=document.createElement("div");return e.id="text-editor-"+this.wrapper.id,e.style.position="absolute",e.style.textOverflow="false",e.style.minWidth=this.wrapper.widthMin-2*this.offsetForTextDiv+"px",e.style.width=this.wrapper.width-2*this.offsetForTextDiv+"px",e.style.left=this.wrapper.v0.x+this.offsetForTextDiv+"px",e.style.top=this.wrapper.v0.y+this.offsetForTextDiv+"px",e.onmousedown=()=>{this.wrapper.scene.annotationInstance.implementations.app.model.appCoreWrapper.appControllerStatus.mode===p.An.Drawing&&(this.wrapper.scene.annotationInstance.activeCommandController.IsTextEditing=!0)},e.addEventListener("keydown",t=>{this.wrapper&&e.clientHeight&&(this.wrapper.height=e.clientHeight,this.wrapper.updateBoundingBox()),e.textContent,this.wrapper.scene.annotationInstance.graphicsCoreWrapper.renderForce()}),this.wrapper.scene.annotationInstance.implementations.app.model.modelViewWrapper.div.insertBefore(e,this.wrapper.scene.annotationInstance.graphicsCoreWrapper.canvasWrapper.aCanvasMask.canvas),this.divText=e,e}constructor(e){this.offsetForTextDiv=10,this.wrapper=e,this.showTextDiv(),this.textCol="rgba(".concat(255,", ").concat(0,", ").concat(0,", ").concat(1,")")}}(o=c||(c={})).CIRCLE="CIRCLE",o.DIAMOND="DIAMOND",o.LEFT="LEFT",o.RIGHT="RIGHT";class e_{isMouseInside(e,t){return(0,p.Sp)(new p.h9(e,t),this.vec)<this.r+5}updatePos(e,t){this.vec.x=e,this.vec.y=t}render(e){this.caText.scene.annotationInstance.renderer.draw.shape.text.renderNodeDia(e,this.caText.styleComponent,this.vec.x,this.vec.y,this.diaWidth,this.diaHeight)}constructor(e,t,s,i="CIRCLE"){this.r=6,this.diaHeight=6.5,this.diaWidth=6.5,this.isConnected=!0,this.caText=e,this.type=i,this.vec=new p.h9(t,s)}}class eU extends e_{constructor(e,t,s,i="CIRCLE"){super(e,t,s,i)}}class eq extends e_{constructor(e,t,s,i="DIAMOND"){super(e,t,s,i)}}class eJ{isMouseInside(e,t){let s=new p.h9(e,t);return!!(10>(0,p.xs)(s,this.v0,this.v1)||10>(0,p.xs)(s,this.v1,this.v2))}updateMidV(){this.v1.x=this.v0.x,this.v1.y=this.v2.y,this.v1Render.x=this.caText.vecOffset.x,this.v1Render.y=this.caText.vec.y}updateTransformationStack(){(0,p.Sp)(this.v2,new p.h9(this.caText.mouseX,this.caText.mouseY))<this.r&&(this.caText.scene.annotationInstance.activeCommandController.acProperties.isDown||this.isMouseClick||(this.caText.scene.annotationInstance.io.eventListenerAnnotation.transformStack([this.caText.toJSON()]),this.isMouseClick=!0),this.caText.scene.annotationInstance.activeCommandController.acProperties.isDown&&(this.isMouseClick=!1))}get v2(){return this._v2}set v2(e){this._v2=e}renderLeaderLine(e){this.v0=this.caText.vecOffset,this.v2=this.caText.vec,this.isDrag&&(this.isDrag=!1,this.v2=(0,p.p$)(this.vecsHistory[this.vecsHistory.length-1])),this.updateMidV(),this.caText.scene.annotationInstance.renderer.draw.shape.text.renderLeaderLine(e,this.caText.styleComponent,this.caText.vecOffset,this.v1Render,this.v2,this.t,this.isUpperDia,this.caText.isHoverValue,this.caText.isSelectedValue),this.t+=.1}constructor(e,t){this.isHover=!0,this.t=0,this.r=2.5,this.isDrag=!1,this.isMouseClick=!1,this.isUpperDia=!1,this.caText=e,this.v0=t.vec,this.vecOffset=new p.h9(0,0),this.v1=new p.h9(this.v0.x,this.v0.y),this.v1Render=new p.h9(this.v0.x,this.v0.y),this.v2=new p.h9(this.v0.x,this.v0.y),this.vecsHistory=[this.v2]}}class eY extends eD{get IsSelected(){return this.wrapper.isSelectedValue}set IsSelected(e){this.wrapper.isSelectedValue=e,this.wrapper.scene.annotationInstance.io.eventListenerAnnotation.selectionStack(this.wrapper.toJSON())}get IsSelectedReaderline(){return this._isSelectedReaderline}set IsSelectedReaderline(e){this._isSelectedReaderline=e}get IsHover(){return this.wrapper.isHoverValue}set IsHover(e){!this.wrapper.isRemove&&this.wrapper.isRenderable&&!this.wrapper.isHiddenValue&&(this.wrapper.isHoverValue=e,this.wrapper.leaderline&&(this.wrapper.leaderline.isHover=e),this.wrapper.isHoverValue&&!this.wrapper.isHoverPre?this.wrapper.scene.annotationInstance.io.eventListenerAnnotation.hoverStack(this.wrapper.toJSON()):!this.wrapper.isHoverValue&&this.wrapper.isHoverPre&&this.wrapper.scene.annotationInstance.io.eventListenerAnnotation.hoverStack(this.wrapper.toJSON()),this.wrapper.isHoverPre=this.wrapper.isHoverValue,e||(this.wrapper.needEmitHoverPost=!0,this.wrapper.hidePopUpSummary()))}translateByMouseEventData(e){if(this.wrapper.mouseX=e.x,this.wrapper.mouseY=e.y,!this.wrapper.isRenderable||this.wrapper.isHiddenValue||this.wrapper.enableEditValue||!this.wrapper.enableDrag)return;if(this.wrapper.isRenderCollapse){this.translateByMouseEventDataCollapse(e);return}let t=e.x-e.preX,s=e.y-e.preY,i=!1;if(this.wrapper.nodeSelected){if(this.wrapper.width=this.wrapper.v1.x-this.wrapper.v0.x,this.wrapper.nodeSelected.type===c.LEFT?(this.wrapper.width-t>this.wrapper.widthMin+2?this.wrapper.v0.x+=t:this.wrapper.v0.x-=2,i=!0):this.wrapper.nodeSelected.type===c.RIGHT&&(this.wrapper.width+t>this.wrapper.widthMin+2?this.wrapper.v1.x+=t:this.wrapper.v1.x+=2,i=!0),this.wrapper.nodeSelected.type===c.DIAMOND){this.wrapper.attachedShape&&(this.wrapper.attachedShape.textLeaderline&&(this.wrapper.attachedShape.textLeaderline=void 0),this.wrapper.attachedShape=void 0),this.wrapper.leadlineInteraction(e.x,e.y),this.wrapper.leaderline&&this.wrapper.vUp.isConnected&&(this.wrapper.vecOffset.x=this.wrapper.v0.x+(this.wrapper.v1.x-this.wrapper.v0.x)*.5,this.wrapper.vecOffset.y=this.wrapper.v1.y,this.wrapper.widthOffset=this.wrapper.vecOffset.x-this.wrapper.vec.x,this.wrapper.heightOffset=this.wrapper.vecOffset.y-this.wrapper.vec.y),this.wrapper.computeCenterVec(),this.wrapper.updateBoundingBox();return}}else if(this.wrapper.nodeTargetLeaderLine){this.updateLeaderlineTarget(e.x,e.y),this.wrapper.vecOffset.x=this.wrapper.v0.x+(this.wrapper.v1.x-this.wrapper.v0.x)*.5,this.wrapper.vecOffset.y=this.wrapper.v0.y+(this.wrapper.v1.y-this.wrapper.v0.y)*.5,this.wrapper.widthOffset=this.wrapper.vecOffset.x-this.wrapper.vec.x,this.wrapper.heightOffset=this.wrapper.vecOffset.y-this.wrapper.vec.y+.5*this.wrapper.height,this.wrapper.computeCenterVec(),this.wrapper.updateVecsBox(),this.wrapper.updateBoundingBox();return}else this.wrapper.v0.x+=t,this.wrapper.v0.y+=s,this.wrapper.v1.x+=t,this.wrapper.v1.y+=s;i?this.wrapper.leaderline?(this.wrapper.vecOffset.x=this.wrapper.v0.x+(this.wrapper.v1.x-this.wrapper.v0.x)*.5,this.wrapper.widthOffset=this.wrapper.vecOffset.x-this.wrapper.vec.x):(this.wrapper.vec.x=this.wrapper.v0.x+(this.wrapper.v1.x-this.wrapper.v0.x)*.5,this.wrapper.vecOffset.x=this.wrapper.v0.x+(this.wrapper.v1.x-this.wrapper.v0.x)*.5,this.wrapper.widthOffset=0,this.wrapper.heightOffset=0):(this.wrapper.leaderline?(this.wrapper.vecOffset.x=this.wrapper.v0.x+(this.wrapper.v1.x-this.wrapper.v0.x)*.5,this.wrapper.vecOffset.y=this.wrapper.v0.y+(this.wrapper.v1.y-this.wrapper.v0.y)*.5,this.wrapper.widthOffset=this.wrapper.vecOffset.x-this.wrapper.vec.x,this.wrapper.heightOffset=this.wrapper.vecOffset.y-this.wrapper.vec.y+.5*this.wrapper.height):(this.wrapper.vec.x+=t,this.wrapper.vec.y+=s,this.wrapper.vecOffset.x+=this.wrapper.vec.x,this.wrapper.vecOffset.y+=this.wrapper.vec.y,this.wrapper.widthOffset=0,this.wrapper.heightOffset=0),this.wrapper.updateVecsBox()),this.wrapper.computeCenterVec(),this.wrapper.txtDiv.updateDiv(),this.updateSideNodes(),this.updateConectNodes(),this.wrapper.updateBoundingBox()}translateByMouseEventDataCollapse(e){let t=e.x-e.preX,s=e.y-e.preY;this.wrapper.leaderline?(this.wrapper.vecOffset.x+=t,this.wrapper.vecOffset.y+=s,this.wrapper.widthOffset+=t,this.wrapper.heightOffset+=s,this.updateSideNodes()):(this.wrapper.widthOffset=0,this.wrapper.heightOffset=0,this.wrapper.vecOffset.x+=t,this.wrapper.vecOffset.y+=s,this.wrapper.vec.x+=t,this.wrapper.vec.y+=s),this.wrapper.updateVecsBox(),this.wrapper.updateBoundingBox()}mouseLeftClick(e,t){if(this.wrapper.scene.captureText=this.wrapper,this.wrapper.isCollapse){this.wrapper.collision.isCollided=!1,this.wrapper.isCollapse=!1,this.wrapper.txtDiv.focusOnTextDiv();return}this.wrapper.IsSelectedReaderline?this.wrapper.isSelectedReaderlineByClick=!0:this.wrapper.isSelectedReaderlineByClick=!1,!this.wrapper.isSelectedReaderlineByClick&&this.wrapper.isMouseInsideDiv(e,t)&&this.wrapper.txtDiv.focusOnTextDiv()}mouseUp(){this.wrapper.snapForPoint()}mouseDoubleClick(){this.wrapper.isEditiable=!this.wrapper.isEditiable}isMouseInside(e,t){return this.wrapper.isRenderCollapse?15>(0,p.Sp)(new p.h9(e,t),this.geo.vec)?(this.wrapper.isHover=!0,!0):(this.wrapper.isHover=!1,!1):this.wrapper.scene.annotationInstance.implementations.app.model.appCoreWrapper.appControllerStatus.mode===p.An.Drawing&&(this.isMouseInsideLeaderline(e,t)||this.isMouseInsideNodes(e,t)?(this.wrapper.IsSelectedReaderline=!0,this.wrapper.isHover=!0,!0):(this.wrapper.IsSelectedReaderline=!1,(0,p.mp)(new p.h9(e,t),this.wrapper.v0,this.wrapper.v1))?(this.wrapper.isHover=!0,!0):(this.wrapper.isHover=!1,!1))}isMouseInsideDiv(e,t){if(this.wrapper.isRenderCollapse)return!1;let s=[new p.h9(this.wrapper.v0.x+this.wrapper.offDiv,this.wrapper.v0.y+this.wrapper.offDiv),new p.h9(this.wrapper.v0.x+this.wrapper.width-this.wrapper.offDiv,this.wrapper.v0.y+this.wrapper.offDiv),new p.h9(this.wrapper.v0.x+this.wrapper.width-this.wrapper.offDiv,this.wrapper.v0.y+this.wrapper.height-this.wrapper.offDiv),new p.h9(this.wrapper.v0.x+this.wrapper.offDiv,this.wrapper.v0.y+this.wrapper.height-this.wrapper.offDiv)];return!!(0,p.X0)(new p.h9(e,t,0),s)}updateLeaderlineTarget(e,t){void 0!==this.wrapper.nodeTargetLeaderLine&&(this.wrapper.nodeTargetLeaderLine.x=e,this.wrapper.nodeTargetLeaderLine.y=t,this.wrapper.nodeTargetLeaderLine.x=e,this.wrapper.nodeTargetLeaderLine.y=t)}isMouseInsideLeaderline(e,t){if(this.wrapper.leaderline){if(this.wrapper.leaderline.isMouseInside(e,t))return this.wrapper.nodeTargetLeaderLine=this.wrapper.leaderline.v2,this.wrapper.leaderline.isHover=!0,!0;this.wrapper.leaderline.isHover=!1}return this.wrapper.nodeTargetLeaderLine=void 0,!1}updateSideNodes(){this.wrapper.vLeft.updatePos(this.wrapper.v0.x,this.wrapper.v0.y+.5*this.wrapper.height),this.wrapper.vRight.updatePos(this.wrapper.v1.x,this.wrapper.v0.y+.5*this.wrapper.height)}updateConectNodes(){this.wrapper.vUp.updatePos(this.wrapper.v0.x+.5*this.wrapper.width,this.wrapper.v0.y),this.wrapper.vDown.updatePos(this.wrapper.v0.x+.5*this.wrapper.width,this.wrapper.v1.y)}isMouseInsideNodes(e,t){this.wrapper.nodeSelected=void 0;for(let s=0;s<this.wrapper.nodes.length;++s)if(this.wrapper.nodes[s].isMouseInside(e,t))return this.wrapper.nodeSelected=this.wrapper.nodes[s],!0;return!1}leadlineInteraction(e,t){this.wrapper.leaderline?(this.wrapper.vec.x=e,this.wrapper.vec.y=t,this.wrapper.widthOffset=this.wrapper.vecOffset.x-this.wrapper.vec.x,this.wrapper.heightOffset=this.wrapper.vecOffset.y-this.wrapper.vec.y):this.wrapper.leaderline=new eJ(this.wrapper,this.wrapper.getClosestNodeDia(e,t))}constructor(e){super(e),this._isSelectedReaderline=!1,this.wrapper=e}}class ej{toJSON(){let e=new g(this.wrapper.id,p.zq.TEXT_LEADERLINE,this.wrapper.isSelectedValue,this.wrapper.isHoverValue,this.wrapper.isHiddenValue);0!==this.wrapper.widthOffset||0!==this.wrapper.heightOffset?e.pushNode([this.wrapper.vec,new p.h9(this.wrapper.widthOffset,this.wrapper.heightOffset)]):e.pushNode([this.wrapper.vec]),e.data={content:this.wrapper.contentHtmltemp,width:this.wrapper.width,height:this.wrapper.height,version:2,zoom:this.wrapper.renderer.zoomLevel};let t=this.wrapper.styleComponent.toJson();return t&&(e.styles=t),e}getLog(){return"GUID : "+this.wrapper.id+"/TYPE : "+this.wrapper.type.toString()+"/Screen : SIZE : "+this.wrapper.r+" pixel/IsCap :"+this.wrapper.isCapturedValue+"/IsSEL : "+this.wrapper.isSelectedValue+"/IsHid : "+this.wrapper.isHiddenValue+"/IsDeg : "+this.wrapper.isDrag+"/isSelable : "+this.wrapper.isSelectable+"/hasLeaderline : "+this.wrapper.leaderline}processingUpdate(e){let t=JSON.parse(e);t.content&&(this.wrapper.contentHtmltemp=t.content),this.wrapper.scene.annotationInstance.io.eventListenerAnnotation.updateStack(this.toJSON())}deepCopy(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2];let s=this.toJSON();if(s){let i=this.wrapper.fromJSON(s,!0,!0);return i.move(e,t),i.isHover=!1,i.emitAddStack(),i}}remove(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];if(this.wrapper.scene.annotationInstance.implementations.app.model.appCoreWrapper.appControllerStatus.drawing){if(this.wrapper.attachedShape&&(this.wrapper.attachedShape.textLeaderline=void 0),this.wrapper.isSelectedReaderlineByClick){this.wrapper.leaderline=void 0,this.wrapper.isSelected=!1,this.wrapper.scene.annotationInstance.io.eventListenerAnnotation.transformStack([this.toJSON()]);return}if(!this.wrapper.scene.annotationInstance.activeCommandController.acProperties.isTextEditing){if(this.wrapper.removeDiv(),e){let e=this.toJSON();e&&(this.wrapper.scene.annotationInstance.io.eventListenerAnnotation.hideTextStack(e),this.wrapper.scene.annotationInstance.io.eventListenerAnnotation.removeGeometryStack([e]))}this.wrapper.scene.removeATextleaderlineWrapper(this.wrapper),this.wrapper.scene.removeGeometry(this.wrapper)}}}removeByAttachedShape(){this.wrapper.leaderline=void 0,this.wrapper.attachedShape&&(this.wrapper.attachedShape.textLeaderline=void 0,this.wrapper.attachedShape=void 0),this.resetAnchorVec(),this.wrapper.scene.annotationInstance.io.eventListenerAnnotation.transformStack([this.toJSON()])}RemoveLeaderline(){this.wrapper.leaderline=void 0,this.wrapper.attachedShape&&(this.wrapper.attachedShape.textLeaderline=void 0,this.wrapper.attachedShape=void 0),this.resetAnchorVec(),this.wrapper.scene.annotationInstance.io.eventListenerAnnotation.transformStack([this.toJSON()])}removeDiv(){try{this.wrapper.scene.annotationInstance.implementations.app.model.modelViewWrapper.div&&(this.wrapper.txtDiv.divText&&this.wrapper.scene.annotationInstance.implementations.app.model.modelViewWrapper.div.removeChild(this.wrapper.txtDiv.divText),this.wrapper.txtDiv.divTextAnchor&&this.wrapper.scene.annotationInstance.implementations.app.model.modelViewWrapper.div.removeChild(this.wrapper.txtDiv.divTextAnchor))}catch(e){}}resetAnchorVec(){this.wrapper.widthOffset=0,this.wrapper.heightOffset=0,this.wrapper.vUp.isConnected&&(this.wrapper.vecOffset.y+=this.wrapper.height),this.wrapper.vec.x=this.wrapper.vecOffset.x,this.wrapper.vec.y=this.wrapper.vecOffset.y,this.wrapper.updateVecs()}constructor(e){this.wrapper=e}}class eX{outExtent(){this.wrapper.updateScreenVecForPan(),this.wrapper.isInsideExtent&&(this.wrapper.txtDiv.hideTextDiv(),this.wrapper.isInsideExtent=!1)}inExtent(){this.wrapper.isInsideExtent||(this.wrapper.txtDiv.showTextDiv(),this.wrapper.isInsideExtent=!0)}constructor(e){this.wrapper=e}}class eK extends x{renderPost(e){if(this.scaleRuntime=1,this.widthRuntime=(this.wrapper.v1.x-this.wrapper.v0.x)*this.scaleRuntime,this.heightRuntime=Math.abs(this.wrapper.v1.y-this.wrapper.v0.y),this.v0Runtime.x=this.wrapper.vecOffset.x-.5*this.widthRuntime,this.v0Runtime.y=this.wrapper.vUp.vec.y,this.wrapper.isRenderCollapse){this.renderSnippet(e,this.widthRuntime,this.heightRuntime);return}this.wrapper.scene.annotationInstance.renderer.draw.shape.text.roundedRectACTextStoryMapByWidth(e,this.wrapper.styleComponent,this.v0Runtime,this.widthRuntime,this.heightRuntime,3,0,0,this.wrapper.isHoverValue,this.wrapper.isSelectedValue),this.wrapper.scene.annotationInstance.interactionMode===p.An.Drawing&&(this.wrapper.isHover||this.wrapper.isSelected)&&this.renderNodes(e)}renderSnippet(e,t,s){this.wrapper.isHover?(this.wrapper.txtDiv.divText&&this.wrapper.txtDiv.divText.hidden&&(this.wrapper.txtDiv.divText.hidden=!1),this.hasSnippet=!0,this.wrapper.leaderline&&(this.wrapper.findClosestNodeDia(),this.wrapper.leaderline.renderLeaderLine(e)),this.wrapper.scene.annotationInstance.renderer.draw.shape.text.roundedRectACTextStoryMapByWidth(e,this.wrapper.styleComponent,this.v0Runtime,t,s,3,0,0,this.wrapper.isHoverValue,this.wrapper.isSelectedValue)):(this.wrapper.txtDiv.divText&&!this.wrapper.txtDiv.divText.hidden&&(this.wrapper.txtDiv.divText.hidden=!0),this.hasSnippet=!1)}renderLeadline(e){if(this.wrapper.isRenderCollapse){this.renderMarker(e);return}this.wrapper.leaderline&&(this.wrapper.findClosestNodeDia(),this.wrapper.leaderline.renderLeaderLine(e))}renderNodes(e){this.wrapper.vLeft.render(e),this.wrapper.vRight.render(e),this.wrapper.vUp.render(e),this.wrapper.vDown.render(e)}renderMarker(e){if(this.hasSnippet)return;let t=this.wrapper.vec;e.beginPath(),e.arc(t.x,t.y,7,0,6.28),e.closePath();let s=this.wrapper.styleComponent.styleAnchorNode.fillStyle;e.fillStyle="rgba(".concat(s[0],", ").concat(s[1],", ").concat(s[2],", ").concat(s[3],")"),e.fill(),e.lineWidth=this.wrapper.styleComponent.styleAnchorNode.lineWidth,s=this.wrapper.styleComponent.styleAnchorNode.strokeStyle,e.strokeStyle="rgba(".concat(s[0],", ").concat(s[1],", ").concat(s[2],", ").concat(s[3],")"),e.stroke()}constructor(e){super(e),this.zoomLevel=0,this.zoomDifference=0,this.hasSnippet=!1,this.scaleRuntime=0,this.widthRuntime=0,this.heightRuntime=0,this.v0Runtime=new p.h9(0,0,0),this.wrapper=e}}class e${constructor(){this.width=36,this.height=28,this.scale=1,this.fillStyleFirstArray=[0,0,0,0],this.fillStyleSecondArray=[0,0,0,0],this.lineWidth=1,this.shadowColor="rgba(0 ,0 ,0 , 0.5)",this.shadowColorHover="rgba(0 ,0 ,0 , 1.0)",this.shadowBlur=5}}class eQ{constructor(){this.width=36,this.height=28,this.fontSize=9,this.fontColorArray=[0,0,0,0],this.scale=1,this.fillStyleFirstArray=[0,0,0,0],this.fillStyleSecondArray=[0,0,0,0],this.strokeStyleFirstArray=[0,0,0,0],this.lineWidth=1,this.shadowColor="rgba(0 ,0 ,0 , 0.5)",this.shadowColorHover="rgba(0 ,0 ,0 , 1.0)",this.shadowBlur=5}}class eZ{constructor(){this.scale=1,this.fillStyleFirstArray=[0,0,0,0],this.fillStyleSecondArray=[0,0,0,0],this.strokeStyleFirstArray=[0,0,0,0],this.lineWidth=1}}class e0{constructor(){this.fillStyleFirstArray=[0,0,0,0],this.fillStyleSecondArray=[0,0,0,0],this.strokeStyleFirstArray=[0,0,0,0],this.strokeStyleSecondArray=[0,0,0,0],this.lineWidth=1,this.lineDash=[0,0],this.scale=1}}class e1{constructor(){this.strokeStyleFirstArray=[0,0,0,0],this.strokeStyleSecondArray=[0,0,0,0],this.lineWidth=1}}class e2{constructor(){this.fillStyleFirstArray=[0,0,0,0],this.fillStyleSecondArray=[0,0,0,0],this.strokeStyleFirstArray=[0,0,0,0],this.strokeStyleSecondArray=[0,0,0,0],this.lineWidth=1}}class e5{get dash(){return this._dash}set dash(e){this._dash=e}constructor(){this.strokeStyle=[0,0,0,1],this.lineWidth=2,this._dash=[0,0]}}class e3{constructor(){this.fillStyle=[0,0,0,1],this.strokeStyle=[0,0,0,1],this.lineWidth=2,this.radius=5,this.dash=[0,0]}}class e9{constructor(){this.fillStyle=[0,0,0,1],this.strokeStyle=[100,100,100,1],this.lineWidth=2,this.dash=[0,0]}}class e6{constructor(){this.fillStyle=[20,20,20,1],this.strokeStyle=[0,0,0,1],this.lineWidth=2,this.dash=[0,0]}}class e4{constructor(){this.fillStyleFirstArray=[0,0,0,0],this.fillStyleSecondArray=[0,0,0,0],this.strokeStyleFirstArray=[0,0,0,0],this.handleNode=new e9,this.box=new e6,this.anchorNode=new e3,this.leaderline=new e5,this.scale=1}}class e8{constructor(){this.size=8,this.lineWidth=6,this.sizeMid=2,this.lineWidthMid=2}}class e7{constructor(){this.elasticScale=3.5,this.pointBoundOffset=8,this.outlineHoverColorArray=[0,0,0,0],this.outlineHoverColorRGBAString="rgba(255,255,255,1.0)",this.maskColor="#000000",this.isDarkBG=!1,this.opacity=.6,this.opacityHover=.7,this.desaturationValue=-.3,this.timeTransitionA=.015,this.timeTransitionB=.015}}class te{constructor(){this.fillStyleFirstArray=[0,0,0,0],this.strokeStyleFirstArray=[0,0,0,0]}}class tt{constructor(){this.fillStyleFirstArray=[0,0,0,0],this.strokeStyleFirstArray=[0,0,0,0],this.lineWidth=1}}class ts{toJson(){return JSON.parse(JSON.stringify(this))}downloadJson(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"AnnotationTheme.json";new p.QH(this.toJson(),e).dummy()}constructor(){this.rPoint=new e$,this.nPoint=new eQ,this.iPoint=new eZ,this.arrow=new e0,this.polyline=new e1,this.polygon=new e2,this.properties=new e7,this.selection=new te,this.freehand=new tt,this.node=new e8,this.textleaderline=new e4}}class ti extends L{constructor(...e){super(...e),this.textColor=h.BackgroundColor,this.backgroundColor=h.TitleColor}}class tn extends O{updateStyle(){let e=this.geo.scene.annotationInstance.customization.themeCurrent.textleaderline;this.styleBox||(this.styleBox=new e6,this.styleBox.dash=[0,0],this.styleBox.fillStyle=e.box.fillStyle,this.styleBox.lineWidth=e.box.lineWidth,this.styleBox.strokeStyle=e.box.strokeStyle),this.styleAnchorNode||(this.styleAnchorNode=new e3,this.styleAnchorNode.dash=[0,0],this.styleAnchorNode.fillStyle=e.anchorNode.fillStyle,this.styleAnchorNode.lineWidth=e.anchorNode.lineWidth,this.styleAnchorNode.strokeStyle=e.anchorNode.strokeStyle),this.styleHandleNode||(this.styleHandleNode=new e9,this.styleHandleNode.dash=[0,0],this.styleHandleNode.fillStyle=e.handleNode.fillStyle,this.styleHandleNode.lineWidth=e.handleNode.lineWidth,this.styleHandleNode.strokeStyle=e.handleNode.strokeStyle),this.styleLeaderline||(this.styleLeaderline=new e5,this.styleLeaderline.dash=[0,0],this.styleLeaderline.lineWidth=e.leaderline.lineWidth,this.styleLeaderline.strokeStyle=e.leaderline.strokeStyle)}updateStyleCustom(e){let t=!1;return void 0!==e.box&&(this.styleBox.dash=e.box.dash?e.box.dash:this.styleBox.dash,this.styleBox.fillStyle=e.box.fill?e.box.fill:this.styleBox.fillStyle,this.styleBox.lineWidth=e.box.width?e.box.width:this.styleBox.lineWidth,this.styleBox.strokeStyle=e.box.strokeStyle?e.box.strokeStyle:this.styleBox.strokeStyle,t=!0),void 0!==e.anchorNode&&(this.styleAnchorNode.dash=e.anchorNode.dash?e.anchorNode.dash:this.styleAnchorNode.dash,this.styleAnchorNode.fillStyle=e.anchorNode.fill?e.anchorNode.fill:this.styleAnchorNode.fillStyle,this.styleAnchorNode.lineWidth=e.anchorNode.width?e.anchorNode.width:this.styleAnchorNode.lineWidth,this.styleAnchorNode.strokeStyle=e.anchorNode.strokeStyle?e.anchorNode.strokeStyle:this.styleAnchorNode.strokeStyle,t=!0),void 0!==e.handleNode&&(this.styleHandleNode.dash=e.handleNode.dash?e.handleNode.dash:this.styleHandleNode.dash,this.styleHandleNode.fillStyle=e.handleNode.fill?e.handleNode.fill:this.styleHandleNode.fillStyle,this.styleHandleNode.lineWidth=e.handleNode.width?e.handleNode.width:this.styleHandleNode.lineWidth,this.styleHandleNode.strokeStyle=e.handleNode.strokeStyle?e.handleNode.strokeStyle:this.styleHandleNode.strokeStyle,t=!0),void 0!==e.leaderline&&(this.styleLeaderline.dash=e.leaderline.dash?e.leaderline.dash:this.styleLeaderline.dash,this.styleLeaderline.lineWidth=e.leaderline.width?e.leaderline.width:this.styleLeaderline.lineWidth,this.styleLeaderline.strokeStyle=e.leaderline.strokeStyle?e.leaderline.strokeStyle:this.styleLeaderline.strokeStyle,t=!0),this.state.width=e.width||this.state.width,this.tempColorRgba=e.colorRgba||this.tempColorRgba,this.state.scale=e.scale||this.state.scale,void 0!==e.textColor&&(this.state.textColor=e.textColor),void 0!==e.backgroundColor&&(this.state.backgroundColor=e.backgroundColor),e.lineDash&&(this.state.lineTypeId=e.lineDash),this.isCustom=!0,t&&!this.geo.isUnderConstruction&&(this.geo.isTransform=!0),!0}toJson(){if(!this.isCustom)return;let e={box:{dash:this.styleBox.dash,fill:this.styleBox.fillStyle,width:this.styleBox.lineWidth,strokeStyle:this.styleBox.strokeStyle},anchorNode:{dash:this.styleAnchorNode.dash,fill:this.styleAnchorNode.fillStyle,width:this.styleAnchorNode.lineWidth,strokeStyle:this.styleAnchorNode.strokeStyle},handleNode:{dash:this.styleHandleNode.dash,fill:this.styleHandleNode.fillStyle,width:this.styleHandleNode.lineWidth,strokeStyle:this.styleHandleNode.strokeStyle},leaderline:{dash:this.styleLeaderline.dash,width:this.styleLeaderline.lineWidth,strokeStyle:this.styleLeaderline.strokeStyle},width:this.state.width,scale:this.state.scale,colorRgba:this.tempColorRgba};return this.state.backgroundColor!==h.TitleColor&&(e.backgroundColor=this.state.backgroundColor),this.state.textColor!==h.BackgroundColor&&(e.textColor=this.state.textColor),this.state.lineTypeId!==a.Continuous&&(e.lineDash=this.state.lineTypeId),e}constructor(e){super(e),this.state=new ti,this.updateStyle()}}class to{update(e){this.host.scene.annotationInstance.implementations.app.INSPECTION&&(e.font="10px Arial",this.host.collision.isRenderable=!0,this.showStatus(e),this.showVecOffset(e),this.showVecBound(e),this.showLeaderlineInfo(e),this.showLeaderlinePos(e),this.host.collision.render(e))}showLeaderlinePos(e){this.host.vec&&(e.beginPath(),e.arc(this.host.vec.x,this.host.vec.y,6.5,0,6.28),e.closePath(),e.fillStyle="#ff0000",e.fill())}showStatus(e){let t=this.host.v1;e.beginPath(),e.arc(t.x,t.y,5,0,6.28),e.closePath(),e.fillStyle="#ff0000",e.fill();let s="IsTransform: ".concat(this.host.isTransform);e.fillText(s,t.x+10,t.y-10),s=", Zoom: ".concat(this.host.renderer.zoomLevel),e.fillText(s,t.x+100,t.y-10)}ShowVecCenter(e){let t=this.host.vecCenter;e.beginPath(),e.arc(t.x,t.y,5,0,6.28),e.closePath(),e.fillStyle="#fff000",e.fill();let s="".concat(t.x),i="".concat(t.y);e.fillText(s,t.x,t.y+10),e.fillText(i,t.x,t.y+24)}showVecBound(e){let t=this.host.v0;e.beginPath(),e.arc(t.x,t.y,5,0,6.28),e.closePath(),e.fillStyle="#00ff00",e.fill();let s="".concat(t.x),i="".concat(t.y);e.fillText(s,t.x,t.y+10),e.fillText(i,t.x,t.y+24);let n=this.host.v1;e.beginPath(),e.arc(n.x,n.y,5,0,6.28),e.closePath(),e.fillStyle="#00ff00",e.fill(),s="".concat(n.x),i="".concat(n.y),e.fillText(s,n.x,n.y+10),e.fillText(i,n.x,n.y+24)}showVecAnchor(e){let t=this.host.vec;e.beginPath(),e.arc(t.x,t.y,2.5,0,6.28),e.closePath(),e.fillStyle="#ff0000",e.fill();let s="".concat(t.x),i="".concat(t.y);e.fillText(s,t.x,t.y+10),e.fillText(i,t.x,t.y+24)}showVecOffset(e){let t=this.host.vecOffset;e.beginPath(),e.arc(t.x,t.y,2.5,0,6.28),e.closePath(),e.fillStyle="#0000ff",e.fill();let s="".concat(t.x),i="".concat(t.y);e.fillText(s,t.x,t.y+10),e.fillText(i,t.x,t.y+24)}showLeaderlineInfo(e){let t=this.host.v1;e.beginPath(),e.arc(t.x,t.y,2.5,0,6.28),e.closePath(),e.fillStyle="#ff0000",e.fill();let s="".concat(this.host.leaderline);e.fillText(s,t.x,t.y-60),this.host.attachedShape?e.fillText(this.host.attachedShape.type,t.x,t.y-50):e.fillText("None",t.x,t.y-50)}constructor(e){this.host=e}}class tr extends S{static fromSmartDrawing(e,t){let s=t[t.length-1],i=t[0],n=new tr(e,s.x,s.y,170,40,!1);n.leadlineInteraction(i.x,i.y),n.leadlineInteraction(i.x,i.y),n.leaderline,n.isHover=!1,n.interaction.updateSideNodes(),n.interaction.updateConectNodes(),n.txtDiv.updateDiv()}static fromJSON(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=[t.nodes[0].sx,t.nodes[0].sy],o=t.data.content,r=t.data.width?t.data.width:170,a=t.data.height?t.data.height:40,h=new tr(e,n[0],n[1],r,a,s,o);return t.nodes[1]&&h.initLeaderlineOffset(t.nodes[1].sx,t.nodes[1].sy),h.contentHtmltemp=o,t.data.zoom&&h.initZoomLevel(t.data.zoom),h.isUnderConstruction=!0,t.styles&&h.updateStyleCustom(t.styles),h.isUnderConstruction=!1,i?h.id=e.getUUID():h.id=t.id,h.txtDiv.divText&&(h.txtDiv.divText.id="text-editor-".concat(h.id)),h.isHiddenValue=t.isHidden,t.isHidden?h.visibilityValue=0:h.visibilityValue=1,h.computeCenterVec(),h.txtDiv.updateDiv(),h.updateVecs(),s&&e.annotationInstance.io.eventListenerAnnotation.showTextStack(h.toJSON()),h.isSelected=!1,h.isHover=!1,h.isTransform=!1,h.initVecsHistory(),h.initHeightFromJSON(a),h}static mouseLeftClick(e,t){if(void 0!==e.capture)return;e.annotationInstance.activeCommandController.goToACMode();let s=new tr(e,t.x,t.y);s.isSelected=!0,e.Capture=s,s.dummy()}static mouseMove(e){}static ESC(){}emitTransformationStackRightNode(){for(let e=0;e<this.nodes.length;++e)this.nodes[e].type,c.RIGHT}updateVecsBox(){this.leaderline?(this.renderer.zoomDifference,this.vecOffset.x=this.vec.x+this.widthOffset,this.vecOffset.y=this.vec.y+this.heightOffset):(this.vecOffset.x=this.vec.x,this.vecOffset.y=this.vec.y),this.v0.x=this.vecOffset.x-.5*this.width,this.v0.y=this.vecOffset.y-this.height,this.v1.x=this.vecOffset.x+.5*this.width,this.v1.y=this.vecOffset.y,this.interaction.updateSideNodes(),this.interaction.updateConectNodes()}initComponent(){this.io=new ej(this),this.projection=new eX(this),this.interaction=new eY(this),this.styleComponent=new tn(this),this.renderer=new eK(this)}initZoomLevel(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.renderer.zoomLevel=e}remove(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];this.io.remove(e)}initVecsHistory(){this.vecsHistory=[],this.vecsHistory.push((0,p.p$)(this.vecCenter),(0,p.p$)(this.vecCenter),(0,p.p$)(this.vecCenter))}removeByAttachedShape(){this.io.removeByAttachedShape()}removeLeaderline(){this.io.RemoveLeaderline()}removeDiv(){this.io.removeDiv()}hide(){}deepCopy(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.io.deepCopy(e,t,s)}updateScreenVecForPan(){}outExtent(){this.projection.outExtent()}inExtent(){this.projection.inExtent()}updateScreenVec(){}initLeaderlineOffset(e,t){this.widthOffset=e,this.heightOffset=t,this.interaction.leadlineInteraction(e,t),this.updateVecs()}mouseLeftClick(e,t){this.interaction.mouseLeftClick(e,t)}mouseDoubleClick(){this.interaction.mouseDoubleClick()}mouseUp(){this.interaction.mouseUp()}isMouseInside(e,t){return this.interaction.isMouseInside(e,t)}isMouseInsideDiv(e,t){return this.interaction.isMouseInsideDiv(e,t)}translate(e,t){}translateByMouseEventData(e){this.interaction.translateByMouseEventData(e)}leadlineInteraction(e,t){this.interaction.leadlineInteraction(e,t)}toJSON(){return this.io.toJSON()}getLog(){return this.io.getLog()}processingUpdate(e){this.io.processingUpdate(e)}updateVecsHistory(){for(this.vecCenter=this.computeCenterVec(),this.vecsHistory.push((0,p.p$)(this.vecCenter));this.vecsHistory.length>3;)this.vecsHistory.shift()}updateOptimizer(){}update(){}renderLeadline(e){this.update(),this.renderer.renderLeadline(e)}renderPost(e){this.renderer.renderPost(e),this.inspector.update(e)}getNode(){return[this.vec,this.vecOffset]}updateVecs(){this.updateScreenVecForPan(),this.updateVecsBox(),this.interaction.updateSideNodes(),this.interaction.updateConectNodes(),this.txtDiv.updateDiv(),this.updateBoundingBox()}getClosestNodeDia(e,t){return(0,p.Sp)(new p.h9(e,t),this.vUp.vec)<(0,p.Sp)(new p.h9(e,t),this.vDown.vec)?(this.vUp.isConnected=!0,this.vDown.isConnected=!1,this.vUp):(this.vUp.isConnected=!1,this.vDown.isConnected=!0,this.vDown)}findClosestNodeDia(){this.leaderline&&((0,p.Sp)(this.leaderline.v1,this.vUp.vec)<(0,p.Sp)(this.leaderline.v1,this.vDown.vec)?(this.vUp.isConnected=!0,this.vDown.isConnected=!1,this.leaderline.v0.x=this.vUp.vec.x,this.leaderline.v0.y=this.vUp.vec.y,this.leaderline.v0.z=this.vUp.vec.z):(this.vUp.isConnected=!1,this.vDown.isConnected=!0,this.leaderline.v0.x=this.vDown.vec.x,this.leaderline.v0.y=this.vDown.vec.y,this.leaderline.v0.z=this.vDown.vec.z))}computeCenterVec(){return this.vecCenter=(0,p.mI)(this.getVecs()),this.vecCenter}getVecs(){return[this.v0,this.v1,this.vec]}isMoveUpdate(){this.vecsHistory.length<1||((this.vecCenter,this.scene.annotationInstance.activeCommandController.zoomLevelForMoving)?this.isMove=!1:(this.isMove=!0,this.isTransform=!0))}snapForPoint(){let e=this.scene.annotationInstance.geometryCommon.gcmdProcessing.getClosestNodeForSnapping(this.vec.x,this.vec.y,25);if(e){if(this.leaderline){this.attachedShape&&(this.attachedShape.textLeaderline=void 0,this.attachedShape=void 0),e.textLeaderline=this;let t=e.getVecForSnapping();t&&(this.vec.x=this.leaderline.v2.x=t.x,this.vec.y=this.leaderline.v2.y=t.y,this.vec.z=this.leaderline.v2.z=t.z,this.attachedShape=e)}}else this.attachedShape&&(this.attachedShape.textLeaderline=void 0,this.attachedShape=void 0)}initSnapForPointForUndo(){let e=this.scene.annotationInstance.geometryCommon.gcmdProcessing.getClosestNodeForSnapping(this.vec.x,this.vec.y,25);if(void 0!==e){e.textLeaderline=this;let t=e.getVecForSnapping();t&&(this.vec.x=t.x,this.vec.y=t.y,this.vec.z=t.z,this.attachedShape=e,this.isTransform=!0)}}get isSelected(){return this.interaction.IsSelected}set isSelected(e){this.interaction.IsSelected=e}get IsSelectedReaderline(){return this.interaction.IsSelectedReaderline}set IsSelectedReaderline(e){this.interaction.IsSelectedReaderline=e}get isHover(){return this.interaction.IsHover}set isHover(e){this.interaction.IsHover=e}get height(){return this._height}set height(e){if(0===e)return;!this.renderer.hasSnippet&&this.isCollapse&&(e+=20),this._height=e;let t=e+2*this.txtDiv.offsetForTextDiv;this._height=t,this.v0.y=this.v1.y-t}initHeightFromJSON(e){let t=(e-=20)+2*this.txtDiv.offsetForTextDiv;this._height=t,this.v0.y=this.v1.y-t,this.update(),this.scene.annotationInstance.activeCommandController.acProperties.needExecuteOptimizer=!0}updateDivHeight(){this.txtDiv.divText&&this._heightPre!==this.txtDiv.divText.clientHeight&&(this._heightPre=this.txtDiv.divText.clientHeight,this.height=this.txtDiv.divText.clientHeight,this.interaction.updateSideNodes(),this.interaction.updateConectNodes(),this.txtDiv.updateDiv())}updateBoundingBox(){let e=(this.v1.x-this.v0.x)*1,t=Math.abs(this.v1.y-this.v0.y);this.collision.minVec=new p.h9(this.vecOffset.x-.5*e,this.vecOffset.y-t),this.collision.maxVec=new p.h9(this.vecOffset.x+.5*e,this.vecOffset.y)}set isCollapse(e){e?(this.isRenderCollapse=!0,this.txtDiv.divText&&!this.txtDiv.divText.hidden&&(this.txtDiv.divText.hidden=!0)):(this.isRenderCollapse=!1,this.txtDiv.divText&&this.txtDiv.divText.hidden&&(this.txtDiv.divText.hidden=!1))}get isCollapse(){return this.isRenderCollapse}fromJSON(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=[e.nodes[0].sx,e.nodes[0].sy],n=e.data.content,o=e.data.width?e.data.width:170,r=e.data.height?e.data.height:40,a=i[0],h=i[1],c=new tr(this.scene,a,h,o,r,t,n);return e.nodes[1]&&c.initLeaderlineOffset(e.nodes[1].sx,e.nodes[1].sy),c.contentHtmltemp=n,e.data.zoom&&c.initZoomLevel(e.data.zoom),c.isUnderConstruction=!0,e.styles&&c.updateStyleCustom(e.styles),c.isUnderConstruction=!1,s?c.id=this.scene.getUUID():c.id=e.id,c.txtDiv.divText&&(c.txtDiv.divText.id="text-editor-".concat(c.id)),c.isHiddenValue=e.isHidden,e.isHidden?c.visibilityValue=0:c.visibilityValue=1,c.computeCenterVec(),c.txtDiv.updateDiv(),c.updateVecs(),t&&this.scene.annotationInstance.io.eventListenerAnnotation.showTextStack(c.toJSON()),c.isSelected=!1,c.isHover=!1,c.isTransform=!1,c.initVecsHistory(),c.initHeightFromJSON(r),c}constructor(e,t,s,i=170,n=40,o=!1,r="Start typing here."){if(super(e),this.widthOffset=0,this.heightOffset=0,this.widthMin=80,this.offDiv=10,this.isSelectedReaderlineByClick=!1,this.enableDrag=!0,this.nodeSelected=void 0,this.leaderline=void 0,this.nodeTargetLeaderLine=void 0,this.offsetForTextEditor=20,this.lineWidthForCheck=5,this.mouseX=0,this.mouseY=0,this.numToggleTheme=0,this.attachedShape=void 0,this.isRenderCollapse=!1,this.inspector=new to(this),this.isUndo=o,this.type=p.zq.TEXT_LEADERLINE,this.vec=new p.h9(t,s),this.vecOffset=new p.h9(this.vec.x,this.vec.y),this.v0=new p.h9(this.vec.x-.5*this.width,this.vec.y-this.height),this.v1=new p.h9(this.vec.x+.5*this.width,this.vec.y),this.initComponent(),this.initZoomLevel(),this.computeCenterVec(),this.txtDiv=new eF(this),this.txtDiv.divText&&(this._heightPre=this.txtDiv.divText.clientHeight),this.width=i,this.height=n,this.vLeft=new eU(this,this.v0.x,this.v0.y+.5*this.height,c.LEFT),this.vRight=new eU(this,this.v1.x,this.v0.y+.5*this.height,c.RIGHT),this.vUp=new eq(this,this.v0.x+.5*this.width,this.v0.y,c.DIAMOND),this.vDown=new eq(this,this.v0.x+.5*this.width,this.v0.y+this.height,c.DIAMOND),this.nodes=[this.vLeft,this.vRight,this.vUp,this.vDown],this.trajectoryVecs=[],this.initVecsHistory(),this.visTrajector=!0,this.isDrop=!1,this.isDrag=!1,this.isSelectedValue=!1,this.isLeave=!0,this.isHoverValue=!1,this.isGeoPos=!0,this.isUnderConstruction=!1,this.collision.offset=1,this.updateVecs(),this.updateBoundingBox(),this.scene.addATextleaderlineWrapper(this),!this.isUndo){this.scene.annotationInstance.io.eventListenerAnnotation.addGeometryStack(this.toJSON()),this.txtDiv.hideTextDiv(),this.txtDiv.showTextDiv(),this.txtDiv.focusOnTextDiv();return}}}class ta extends x{renderPost(e){this.timer.update(),this.host.vecs.length<2||(this.host.isFreehandDrawing?this.host.scene.annotationInstance.renderer.draw.shape.freeHand.freeHandbyVecs(e,this.host.vecs,this.host.scene.annotationInstance.activeCommandController.activeColorController.activeColor,this.host.scene.annotationInstance.renderer.imageAnnoApp.customization.themeCurrent.freehand.lineWidth*this.host.styleComponent.renderStyle.scaleGlobal*this.host.styleComponent.renderStyle.scaleLocal,this.host.isClosed):this.host.remove())}constructor(e){super(e),this.host=e}}class th extends O{updateStyle(){b.updateRenderStyleFH(this.renderStyle,this.geo.scene.annotationInstance.customization.themeCurrent),b.updateRenderStyleFH(this.renderStyleNode,this.geo.scene.annotationInstance.customization.themeCurrent)}constructor(e){super(e),this.updateStyle(),this.geo.styleComponent.updateColor()}}class tc extends S{static cancel(){void 0!==tc.construction&&tc.construction.remove(),tc.construction=void 0}static mouseDown(e,t){e.annotationInstance.geometryCommon.gcmdSelecting.deSelectAllObjects(),tc.isTooltipRenderable=!1}static mouseDrag(e){tc.isTooltipRenderable=!1,tc.construction&&tc.construction.addVecs(e.x,e.y)}static mouseUp(e,t){void 0===tc.construction||tc.construction.vecs.length<2||(tc.construction.computeVector(),tc.construction.isFreehandDrawing=!1,tc.construction=void 0,e.annotationInstance.activeCommandController.goToACMode())}static mouseMove(e,t,s){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:p.hO.None;void 0===tc.construction&&void 0===e.annotationInstance.geometryCommon.gcmdProcessing.findAtPoint(t)&&(tc.construction=new tc(e,s,i)),tc.vecTooltip[0]=t.x,tc.vecTooltip[1]=t.y}initComponent(){this.styleComponent=new th(this),this.renderer=new ta(this)}init(){this.scene.addAFreehandSmartDrawing(this)}addVecs(e,t){this.vecs.push(new p.h9(e,t))}checkDotProduct(e){let t=[];t.push(e[0]);for(let s=0;s<e.length-5;++s){let i=(0,p.lu)(e[s],e[s+1]);i=(0,p.Fv)(i);let n=(0,p.lu)(e[s],e[s+2]);n=(0,p.Fv)(n);let o=(0,p.lu)(e[s],e[s+3]);n=(0,p.Fv)(o);let r=(0,p.lu)(e[s],e[s+4]);r=(0,p.Fv)(r);let a=(0,p.lu)(e[s],e[s+5]);a=(0,p.Fv)(a);let h=(0,p.nI)(i,n),c=(0,p.nI)(i,o),l=(0,p.nI)(i,o);(isNaN(h)||isNaN(c)||isNaN(l))&&t.push(e[s])}return t.push(e[e.length-1]),t}divVecs(e){return e}getPtByVs(e){let t=e.length;for(;t--;)new k(this.scene,e[t].x,e[t].y).dummy()}async computeVector(){let e=this.vecs;if(this.dotProductProcess(e),this.modelType,p.hO.DeepLearning,this.typeFreehand===p.iu.SmartDrawing)e=this.checkDotProduct(e),e=this.divVecs(e),this.getPtByVs(e);else{this.optimizer,p.g.DouglasPeucker;let t=(0,p.$z)(e);if(10>(0,p.Sp)(e[0],e[e.length-1])&&(e.pop(),t.pop()),e.length<2)return;if(4<e.length&&e.length<15&&!(0,p.AR)(t)){eA.getCircleByVecs(this.scene,e);return}if(3<e.length&&e.length<8){X.getRectByVecs(this.scene,e);return}M.getPolygonbyVecs(this.scene,e),this.remove()}}dotProductProcess(e){let t=(0,p.Lg)(e);(t=(0,p.aj)(t,500)).push(.1*e.length),tc.dotArrayForTrainSimplify.push(t);let s=[];for(let t=0;t<e.length;++t)s.push(e[t].x,e[t].y);tc.dotVecArrayForTrainSimplify.push(s),t=(0,p.Lg)(e),(t=(0,p.aj)(t,500)).push(.1*e.length),tc.dotArrayForTrainOrigin.push(t),s=[];for(let t=0;t<e.length;++t)s.push(e[t].x,e[t].y);tc.dotVecArrayForTrainOrigin.push(s)}predictDrawingShape(e){let t=(0,p.aj)(e,501),s=this.scene.annotationInstance.implementations.app.addon.smartDrawing.PredictByLogisticRegression(t);return[this.scene.annotationInstance.implementations.app.addon.smartDrawing.PredictByMultiClassification(t),s]}getShapeFromPrediction(e,t){switch(e){case"CIRCLE":eA.getCircleByVecs(this.scene,t);break;case"TRI-GON":M.getPolygonbyVecs(this.scene,t);break;case"ARROW_SINGLE":eH.fromSmartDrawing(this.scene,t,p.zq.ARROW_SINGLE);break;case"ARROW_DOUBLE":eH.fromSmartDrawing(this.scene,t,p.zq.ARROW_DOUBLE);break;case"RECTANGLE":X.getRectByVecs(this.scene,t);break;case"TEXT_LEADERLINE":tr.fromSmartDrawing(this.scene,t);break;case"CURVE":eE.getCurveByVecs(this.scene,t)}}getLog(){return""}isMouseInside(e,t){return!1}translateByMouseEventData(e){}translate(e,t){}hide(){}remove(){this.scene.removeGeometry(this),this.scene.removeAFreehandSmartDrawing(this)}toJSON(){}renderPost(e){tc.isTooltipRenderable,this.vecs.length<2||(this.isFreehandDrawing?this.scene.annotationInstance.renderer.draw.shape.freeHand.freeHandbyVecs(e,this.vecs,this.scene.annotationInstance.activeCommandController.activeColorController.activeColor,this.scene.annotationInstance.renderer.imageAnnoApp.customization.themeCurrent.freehand.lineWidth*this.styleComponent.renderStyle.scaleGlobal*this.styleComponent.renderStyle.scaleLocal,this.isClosed):this.remove())}constructor(e,t,s=p.hO.None){super(e),this.vecs=[],this.modelType=s,this.typeFreehand=t,this.direction=0,this.isFreehandDrawing=!0,this.isClosed=tc.isClose,this.optimizer=p.g.DouglasPeucker;let i=this.scene.annotationInstance.customization.themeCurrent.freehand.strokeStyleFirstArray;this.col="rgba(".concat(i[0],", ").concat(i[1],", ").concat(i[2],", 0.5}"),this.initComponent(),tc.construction=this,this.init()}}tc.isClose=!1,tc.dotArrayForTrainOrigin=[],tc.dotVecArrayForTrainOrigin=[],tc.dotArrayForTrainSimplify=[],tc.dotVecArrayForTrainSimplify=[],tc.isTooltipRenderable=!1,tc.vecTooltip=[0,0];class tl extends x{renderPost(e){if(this.timer.update(),!(this.host.vecs.length<2)){if(this.host.isFreehandDrawing){let t=[];for(let e=0;e<this.host.vecs.length;++e)t.push(new p.h9(this.host.vecs[e].x-this.host.scene.annotationInstance.scene.paramsEditing.croppingMaskParams.x,this.host.vecs[e].y-this.host.scene.annotationInstance.scene.paramsEditing.croppingMaskParams.y));this.host.scene.annotationInstance.renderer.draw.shape.freeHand.freeHandbyVecs(e,t,this.host.scene.annotationInstance.activeCommandController.activeColorController.activeColor,this.host.scene.annotationInstance.renderer.imageAnnoApp.customization.themeCurrent.freehand.lineWidth*this.host.styleComponent.renderStyle.scaleGlobal*this.host.styleComponent.renderStyle.scaleLocal,this.host.isClosed)}else this.host.remove()}}constructor(e){super(e),this.host=e,this.host.styleComponent.updateColor()}}class tp extends O{updateStyle(){b.updateRenderStyleFH(this.renderStyle,this.geo.scene.annotationInstance.customization.themeCurrent),b.updateRenderStyleFH(this.renderStyleNode,this.geo.scene.annotationInstance.customization.themeCurrent)}updateStyleByFHType(e){e===p.iu.Polygon?(b.updateRenderStyleFHPolygon(this.renderStyle,this.geo.scene.annotationInstance.customization.themeCurrent),b.updateRenderStyleFHPolygonNode(this.renderStyleNode,this.geo.scene.annotationInstance.customization.themeCurrent)):e===p.iu.PolylineBending&&(b.updateRenderStyleFHPolyline(this.renderStyle,this.geo.scene.annotationInstance.customization.themeCurrent),b.updateRenderStyleFHPolylineNode(this.renderStyleNode,this.geo.scene.annotationInstance.customization.themeCurrent))}constructor(e){super(e),this.renderStyle=new b,this.renderStyleNode=new b,this.updateStyle()}}class td extends S{static cancel(){void 0!==td.construction&&td.construction.remove(),td.construction=void 0}static mouseDown(e,t,s){e.annotationInstance.geometryCommon.gcmdSelecting.deSelectAllObjects(),td.isTooltipRenderable=!1}static mouseDrag(e,t,s){void 0===td.construction&&this.mouseMove(e,t,s),td.isTooltipRenderable=!1,td.construction&&td.construction.addVecs(t.x,t.y)}static mouseUp(e,t){void 0===td.construction||td.construction.vecs.length<2||(td.construction.computeVector(),td.construction.isFreehandDrawing=!1,e.annotationInstance.activeCommandController.goToACMode(),td.construction=void 0)}static mouseMove(e,t,s){void 0===td.geo&&void 0===e.annotationInstance.geometryCommon.gcmdProcessing.findAtPoint(t)&&(td.construction=new td(e,s),td.construction.styleComponent.updateStyleByFHType(s)),td.vecTooltip[0]=t.x,td.vecTooltip[1]=t.y}initComponent(){this.styleComponent=new tp(this),this.renderer=new tl(this)}init(){this.scene.addAFreehand(this)}addVecs(e,t){this.vecs.push(new p.h9(e,t))}checkDotProduct(e){let t=[];t.push(e[0]);for(let s=0;s<e.length-5;++s){let i=(0,p.lu)(e[s],e[s+1]);i=(0,p.Fv)(i);let n=(0,p.lu)(e[s],e[s+2]);n=(0,p.Fv)(n);let o=(0,p.lu)(e[s],e[s+3]);n=(0,p.Fv)(o);let r=(0,p.lu)(e[s],e[s+4]);r=(0,p.Fv)(r);let a=(0,p.lu)(e[s],e[s+5]);a=(0,p.Fv)(a);let h=(0,p.nI)(i,n),c=(0,p.nI)(i,o),l=(0,p.nI)(i,o);(isNaN(h)||isNaN(c)||isNaN(l))&&t.push(e[s])}return t.push(e[e.length-1]),t}divVecs(e){return e}getPtByVs(e){let t=e.length;for(;t--;)new k(this.scene,e[t].x,e[t].y).dummy()}computeVector(){let e=this.vecs;if(this.typeFreehand===p.iu.SmartDrawing)e=this.checkDotProduct(e),e=this.divVecs(e),this.getPtByVs(e);else{if(this.optimizer===p.g.DouglasPeucker?e=p.mL.simplifyPath(e,2):this.optimizer===p.g.Regular&&(e=(0,p.z1)(e,30)),e.length<2)return;this.typeFreehand===p.iu.CurveClosed&&eE.getCurveByVecs(this.scene,e,!0),this.typeFreehand===p.iu.Curve&&eE.getCurveByVecs(this.scene,e),this.typeFreehand===p.iu.PolylineBending&&es.getPolyline(this.scene,e),this.typeFreehand===p.iu.Polyline&&D.getPolylineByVecs(this.scene,e),this.typeFreehand===p.iu.PolylineGon&&M.getPolygonbyVecs(this.scene,e),this.typeFreehand===p.iu.PolygonGraph&&eV.getPolygonbyVecs(this.scene,e),this.remove()}}getLog(){return""}isMouseInside(e,t){return!1}translateByMouseEventData(e){}translate(e,t){}hide(){}remove(){td.geo=void 0,this.scene.removeGeometry(this),this.scene.removeAFreehand(this)}toJSON(){}renderPost(e){this.renderer.renderPost(e)}constructor(e,t){super(e),this.vecs=[],this.optimizer=p.g.Regular,this.typeFreehand=t,this.typeFreehand===p.iu.PolylineGon||this.typeFreehand===p.iu.Polygon||this.typeFreehand===p.iu.PolygonGraph?this.isClosed=!0:this.isClosed=!1,this.direction=0,this.isFreehandDrawing=!0,this.optimizer=p.g.DouglasPeucker,this.initComponent(),td.geo=this,this.init()}}td.isClose=!1,td.isTooltipRenderable=!1,td.vecTooltip=[0,0];class tm extends x{renderPost(e){this.host.isRenderable&&this.host.img&&(this.timer.update(),e.save(),e.translate(this.host.vec.x,this.host.vec.y),e.rotate(this.host.angle/180),this.t>.6?this.host.isHoverValue||this.host.isSelected&&this.host.type===p.zq.POINT_ICON?(this.host.scene.annotationInstance.renderer.draw.shape.point.pointIcon(e,this.host.styleComponent.renderStyle,0,0,this.host.widthRender,this.host.heightRender,this.host.img,!0,this.host.isGrayColor,this.host.visibilityValue,!0,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tOver)),this.tOver+=this.host.scene.annotationInstance.renderer.dt,this.tDown1=0,this.host.isLeave=!0,this.renderBoundary(e),this.renderControlPoint(e),this.renderCP(e),this.host.needShadowBound&&this.renderShadow(e)):(this.host.scene.annotationInstance.renderer.draw.shape.point.pointIcon(e,this.host.styleComponent.renderStyle,0,0,this.host.widthRender,this.host.heightRender,this.host.img,!1,this.host.isGrayColor,this.host.visibilityValue,!1),this.tOver=0):this.host.scene.annotationInstance.renderer.draw.shape.point.pointIcon(e,this.host.styleComponent.renderStyle,0,0,this.host.widthRender,this.host.heightRender,this.host.img,!0,this.host.isGrayColor,this.host.visibilityValue,!0,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.t)),e.restore())}renderIcon(e){}renderBoundary(e){let t=[];for(let e=0;e<this.host.arrayCP.length;++e)t.push(this.host.arrayCP[e].vec);e.beginPath();let s=this.host.scene.annotationInstance.customization.themeCurrent.nPoint.fillStyleFirstArray;e.strokeStyle="rgba(".concat(s[0],", ").concat(s[1],", ").concat(s[2],", ").concat(s[3],")"),e.lineWidth=2,this.host.scene.annotationInstance.renderer.draw.shape.area.roundedRect(e,this.host.styleComponent.renderStyle,t,0,0),e.closePath(),e.stroke()}renderCP(e){e.fillStyle="#ffffff";let t=this.host.scene.annotationInstance.customization.themeCurrent.nPoint.fillStyleFirstArray;e.strokeStyle="rgba(".concat(t[0],", ").concat(t[1],", ").concat(t[2],", ").concat(t[3],")"),e.beginPath(),e.arc(0,0,2.5,0,2*Math.PI),e.closePath(),e.fill(),e.stroke()}renderControlPoint(e){for(let t=0;t<this.host.arrayCP.length;++t)this.host.arrayCP[t].renderPost(this.host.scene,e)}renderShadow(e){for(let t=0;t<this.host.sizes.length;++t){let s=(0,p.Ux)(this.host.img.width,this.host.img.height,this.host.sizes[t]),i=0-.5*s[0],n=0-.5*s[1];e.globalAlpha=1,e.lineDashOffset=-this.t,e.beginPath(),e.lineWidth=.5,e.strokeStyle="#ffffff",e.setLineDash([2,2]),e.rect(i,n,s[0],s[1]),e.closePath(),e.stroke(),e.globalAlpha=1,e.lineDashOffset=-this.t-4,e.beginPath(),e.lineWidth=.5,e.strokeStyle="#000000",e.setLineDash([2,2]),e.rect(i,n,s[0],s[1]),e.closePath(),e.stroke(),e.setLineDash([0,0])}}constructor(e){super(e),this.host=e}}class tu{renderPost(e,t){t.lineWidth=this.strokeWith,t.fillStyle="#ffffff";let s=e.annotationInstance.customization.themeCurrent.nPoint.fillStyleFirstArray;t.strokeStyle="rgba(".concat(s[0],", ").concat(s[1],", ").concat(s[2],", ").concat(s[3],")"),t.beginPath(),t.arc(this.vec.x,this.vec.y,this.r,0,2*Math.PI),t.closePath(),t.fill(),t.stroke()}constructor(e,t,s,i){this.r=4,this.strokeWith=2,this.vec=new p.h9(t,s,i),this.index=e}}class tg extends O{updateStyle(){b.updateRenderStyleRPoint(this.renderStyle,this.geo.scene.annotationInstance.customization.themeCurrent)}constructor(e){super(e),this.updateStyle()}}class tv extends A{static fromJSON(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=[t.nodes[0].sx,t.nodes[0].sy],o=new tv(e,n[0],n[1],0,s,t.data.idBase64);return o.type=p.zq[t.type],o.isHiddenValue=t.isHidden,t.isHidden?o.visibilityValue=0:o.visibilityValue=1,i?o.id=e.getUUID():o.id=t.id,o.heightRender=t.data.height,o.widthRender=t.data.width,o.img.src=e.annotationInstance.renderer.draw.image.listBase64.get(t.data.idBase64),o.isRenderable=!0,o.initVecsHistory(),o}static MouseRightClick(e){}static mouseMiddleClick(e){}static mouseLeftClick(e,t){void 0===e.capture&&e.annotationInstance.renderer.draw.image.activeBase64ID&&(new tv(e,t.x,t.y,0).dummy(),e.annotationInstance.activeCommandController.acProperties.pressShift||e.annotationInstance.activeCommandController.goToACMode())}static mouseDrag(e){}initComponent(){this.styleComponent=new tg(this),this.renderer=new tm(this)}InitIcon(){if(this.hasPopupValue&&this.appendDiv(),!(this.idBase64.length<1))return!1;this.idBase64=this.scene.annotationInstance.renderer.draw.image.activeBase64ID,this.img=new Image,this.img.src=this.scene.annotationInstance.renderer.draw.image.activeBase64ID,this.isRenderable=!0,this.isUnderConstruction=!1;let e=(0,p.yH)(this.img.width,this.img.height,72);return this.widthRender=e[0],this.heightRender=e[1],this.midHeightImg=this.widthRender[0],this.midWidthImg=this.widthRender[1],this.xOffset=0,this.yOffset=0,this.arrayCP=[],this.arrayCP.push(new tu(0,0-this.midWidthImg-this.xOffset,0-this.midHeightImg-this.yOffset,0)),this.arrayCP.push(new tu(1,0+this.midWidthImg+this.xOffset,0-this.midHeightImg-this.yOffset,0)),this.arrayCP.push(new tu(2,0+this.midWidthImg+this.xOffset,0+this.midHeightImg+this.yOffset,0)),this.arrayCP.push(new tu(3,0-this.midWidthImg-this.xOffset,0+this.midHeightImg+this.yOffset,0)),this.sizes=[16,32,48,72],this.computeDistanceForSnap(),!0}computeDistanceForSnap(){this.sizesDis=[];for(let e=0;e<this.sizes.length;++e){let t=(0,p.yH)(this.img.width,this.img.height,this.sizes[e]),s=0-.5*t[0],i=0-.5*t[1],n=(0,p.Sp)(new p.h9(0,0),new p.h9(s,i));this.sizesDis.push(n)}}getParentType(){return"APointIconWrapper"}appendDiv(){this.divHeight=150,this.divWidth=100,this.div=document.createElement("div"),this.div.id="dt_icon_".concat(this.id.toString()),this.div.style.height=this.divHeight+"px",this.div.style.width=this.divWidth+"px",this.div.style.top=(this.vec.y-.5*this.divHeight).toString()+"px",this.div.style.left=(this.vec.x+50).toString()+"px",this.div.style.position="absolute",this.div.style.background="red",this.div.style.zIndex="999",this.div.style.visibility="hidden"}translateDiv(){this.div.style.top=(this.vec.y-.5*this.divHeight).toString()+"px",this.div.style.left=(this.vec.x+50).toString()+"px"}isMouseInside(e,t){if(this.isRemove||!this.isRenderable||this.isHiddenValue)return!1;let s=new p.h9(e,t);this.needRotation=!1;for(let e=0;e<this.arrayCP.length;++e){let t=(0,p.Sp)(s,new p.h9(this.arrayCP[e].vec.x+this.vec.x,this.arrayCP[e].vec.y+this.vec.y));if(t<this.arrayCP[e].r+3)return this.indexControPointSelected=this.arrayCP[e].index,this.needRotation=!1,!0;this.arrayCP[0].r+3<t&&t<this.arrayCP[0].r+13&&(this.needRotation=!0)}return this.indexControPointSelected=-1,!!(0,p.X0)(s,[new p.h9(this.arrayCP[0].vec.x+this.vec.x,this.arrayCP[0].vec.y+this.vec.y),new p.h9(this.arrayCP[1].vec.x+this.vec.x,this.arrayCP[1].vec.y+this.vec.y),new p.h9(this.arrayCP[2].vec.x+this.vec.x,this.arrayCP[2].vec.y+this.vec.y),new p.h9(this.arrayCP[3].vec.x+this.vec.x,this.arrayCP[3].vec.y+this.vec.y)])||!!this.needRotation}deepCopy(e,t){let s=new tv(this.scene,e,t,this.vec.z,!0,this.idBase64,this.path,this.type,this.r);return s.type=this.type,s.isHiddenValue=this.isHiddenValue,s.id=this.scene.getUUID(),s.widthRender=this.widthRender,s.heightRender=this.heightRender,s.emitAddStack(),s}translate(e,t){}translateByMouseEventData(e){if(this.isRemove||!this.isRenderable||this.isHiddenValue||this.scene.annotationInstance.activeCommandController.acProperties.pressESC)return;let t=e.x-e.preX,s=e.y-e.preY;if(this.needRotation&&this.scene.annotationInstance.activeCommandController.acProperties.pressShift)this.angle+=t+s;else{if(this.indexControPointSelected>-1){this.needEmitResizeTransform=!0,this.scene.annotationInstance.activeCommandController.acProperties.pressShift?this.translateControlPointForFreeform(t,s):(this.translateControlPointSnap(e),this.needShadowBound=!0);return}this.needShadowBound=!1,this.vec.x+=t,this.vec.y+=s,this.isDrag=!0,this.textLeaderline&&(this.textLeaderline.translateByMouseEventData(e),this.textLeaderline.leaderline&&(this.textLeaderline.leaderline.v2.x=this.vec.x,this.textLeaderline.leaderline.v2.y=this.vec.y))}}get isSelected(){return this.isSelectedValue}set isSelected(e){this.isSelectedValue=e,this.scene.annotationInstance.io.eventListenerAnnotation.selectionStack(this.toJSON())}get isHover(){return this.isHoverValue}set isHover(e){this.isHoverValue=e,this.isHoverValue&&!this.isHoverPre?this.scene.annotationInstance.io.eventListenerAnnotation.hoverStack(this.toJSON()):!this.isHoverValue&&this.isHoverPre&&this.scene.annotationInstance.io.eventListenerAnnotation.hoverStack(this.toJSON()),this.isHoverPre=this.isHoverValue,e||(this.needEmitHoverPost=!0,this.hidePopUpSummary())}translateControlPointSnap(e){let t=(0,p.Sp)(this.vec,new p.h9(e.x,e.y));for(let e=0;e<this.sizesDis.length;++e)if(t<this.sizesDis[e]){let t=(0,p.yH)(this.img.width,this.img.height,this.sizes[e]);this.widthRender=t[0],this.heightRender=t[1],this.arrayCP[0].vec.x=-(.5*t[0]),this.arrayCP[0].vec.y=-(.5*t[1]),this.arrayCP[1].vec.x=.5*+t[0],this.arrayCP[1].vec.y=-(.5*t[1]),this.arrayCP[2].vec.x=.5*+t[0],this.arrayCP[2].vec.y=.5*+t[1],this.arrayCP[3].vec.x=-(.5*t[0]),this.arrayCP[3].vec.y=.5*+t[1];break}}translateControlPointForFreeform(e,t){0===this.indexControPointSelected?(this.arrayCP[0].vec.x+=e,this.arrayCP[0].vec.y+=t,this.arrayCP[1].vec.x-=e,this.arrayCP[1].vec.y+=t,this.arrayCP[2].vec.x-=e,this.arrayCP[2].vec.y-=t,this.arrayCP[3].vec.x+=e,this.arrayCP[3].vec.y-=t):1===this.indexControPointSelected?(this.arrayCP[0].vec.x-=e,this.arrayCP[0].vec.y+=t,this.arrayCP[1].vec.x+=e,this.arrayCP[1].vec.y+=t,this.arrayCP[2].vec.x+=e,this.arrayCP[2].vec.y-=t,this.arrayCP[3].vec.x-=e,this.arrayCP[3].vec.y-=t):2===this.indexControPointSelected?(this.arrayCP[0].vec.x-=e,this.arrayCP[0].vec.y-=t,this.arrayCP[1].vec.x+=e,this.arrayCP[1].vec.y-=t,this.arrayCP[2].vec.x+=e,this.arrayCP[2].vec.y+=t,this.arrayCP[3].vec.x-=e,this.arrayCP[3].vec.y+=t):3===this.indexControPointSelected&&(this.arrayCP[0].vec.x+=e,this.arrayCP[0].vec.y-=t,this.arrayCP[1].vec.x-=e,this.arrayCP[1].vec.y-=t,this.arrayCP[2].vec.x-=e,this.arrayCP[2].vec.y+=t,this.arrayCP[3].vec.x+=e,this.arrayCP[3].vec.y+=t),this.widthRender=this.arrayCP[1].vec.x-this.arrayCP[0].vec.x,this.heightRender=this.arrayCP[3].vec.y-this.arrayCP[0].vec.y}remove(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];if(this.isSelectable=!1,this.isRenderable=!1,this.hasPopupValue&&this.hidePopUpSummary(),this.textLeaderline&&(this.textLeaderline.removeByAttachedShape(),this.textLeaderline=void 0),this.isSelectable=!1,this.isRenderable=!1,this.isRemove=!0,e){let e=this.toJSON();e&&this.scene.annotationInstance.io.eventListenerAnnotation.removeGeometryStack([e])}this.scene.removeBasePoint(this),this.scene.removeIPoint(this),this.scene.removeGeometry(this)}toJSON(){}mouseUp(){if(this.needEmitResizeTransform){let e=this.toJSON();e&&this.scene.annotationInstance.io.eventListenerAnnotation.transformStack([e])}this.needEmitResizeTransform=!1}renderPost(e){this.renderer.renderPost(e)}constructor(e,t=0,s=0,i=0,n=!1,o="",r="",a=p.zq.POINT_ICON,h=5,c=p.cg.Round){if(super(e,t,s,i,a),this.widthRender=0,this.heightRender=0,this.indexControPointSelected=-1,this.xOffset=-3,this.yOffset=-3,this.arrayCP=[],this.needRotation=!1,this.angle=0,this.needShadowBound=!1,this.needEmitResizeTransform=!1,this.sizes=[],this.sizesDis=[],this.path=r,this.isUndo=n,this.isPointMid=!1,this.hasPopupValue=!1,this.isRenderable=!1,this.idBase64=o,this.initComponent(),this.InitIcon()){if(e.addIPoint(this),this.isUndo)return;e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(this.toJSON())}}}class ty{isMouseInside(e,t){return!1}getLog(){return""}hide(){}constructor(e){this.geo=e}}class tC extends x{renderPost(e){if(this.host.inspector.update(e),this.interpolateColor.update(),this.host.isCollapse||this.host.scaleForRender<.01||void 0===this.host.scene.annotationInstance.customization.themeCurrent.nPoint.SVG)return;let t=this.host.scene.annotationInstance.renderer.draw.shape.pointSVG,s=this.host.scene.annotationInstance.renderer.draw.shape.point,i=this.host.scene.annotationInstance.geometryCommon.gcmdSupporting.toScreenVecOnCropping(this.host.vec);this.host.isDrag?(s.shadowNPoint(e,this.host.styleComponent.renderStyle,i.x,i.y,this.host.scaleForRender*this.host.styleComponent.renderStyle.scaleGlobal*this.host.styleComponent.renderStyle.scaleLocal,this.host.isSelected,this.host.isHover),this.host.scene.annotationInstance.implementations.app.param.environment===p.qA.AGSM?(s.pointNumberedOverBoundingByCircle(e,this.host.styleComponent.renderStyle,i.x,i.y,this.host.scaleForRender*this.host.styleComponent.renderStyle.scaleGlobal*this.host.styleComponent.renderStyle.scaleLocal,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tOver),!0,!0,this.host.isGrayColor,this.host.visibility),s.pointNumberedDragByCircle(e,this.host.styleComponent.renderStyle,i.x,i.y,this.host.scaleForRender*this.host.styleComponent.renderStyle.scaleGlobal*this.host.styleComponent.renderStyle.scaleLocal,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tDown2),!1,!1,this.host.isGrayColor,this.host.visibility,this.host.isHover,this.host.isSelected)):t.pointSVGNormalFill(e,this.host.scene.annotationInstance.customization.themeCurrent.nPoint.SVG.path2D,this.host.styleComponent.renderStyle,i.x,i.y,this.host.scaleForRender*this.host.styleComponent.renderStyle.scaleGlobal*this.host.styleComponent.renderStyle.scaleLocal,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tDown2),!1,!1,this.host.isGrayColor,this.host.visibilityValue,this.host.isPinValue,this.host.isHoverValue,this.host.isSelectedValue,!0),this.tUp+=.015,this.tDown2=0):(this.host.isSelectedValue?(s.shadowNPoint(e,this.host.styleComponent.renderStyle,i.x,i.y,this.host.scaleForRender*this.host.styleComponent.renderStyle.scaleGlobal*this.host.styleComponent.renderStyle.scaleLocal,this.host.isSelected,this.host.isHover),this.host.scene.annotationInstance.implementations.app.param.environment===p.qA.AGSM?s.pointNumberedOverBoundingByCircleSelected(e,this.host.styleComponent.renderStyle,i.x,i.y,this.host.scaleForRender*this.host.styleComponent.renderStyle.scaleGlobal*this.host.styleComponent.renderStyle.scaleLocal,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tOver),!0,!0,this.host.isGrayColor,this.host.visibilityValue):t.pointSVGNormalFill(e,this.host.scene.annotationInstance.customization.themeCurrent.nPoint.SVG.path2D,this.host.styleComponent.renderStyle,i.x,i.y,this.host.scaleForRender*this.host.styleComponent.renderStyle.scaleGlobal*this.host.styleComponent.renderStyle.scaleLocal,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tDown2),!1,!1,this.host.isGrayColor,this.host.visibilityValue,this.host.isPinValue,this.host.isHoverValue,this.host.isSelectedValue,!0),this.tOver+=.015,this.tDown1=0,this.host.isHoverValue?this.tOverPopupSummary+=this.host.scene.annotationInstance.renderer.dt:this.tOverPopupSummary=0,this.host.isLeave=!0):this.host.isHoverValue?(s.shadowNPointLight(e,this.host.styleComponent.renderStyle,i.x,i.y,this.host.scaleForRender*this.host.styleComponent.renderStyle.scaleGlobal*this.host.styleComponent.renderStyle.scaleLocal,this.host.isSelected,this.host.isHover),this.host.scene.annotationInstance.implementations.app.param.environment===p.qA.AGSM?s.pointNumberedOverBoundingByCircle(e,this.host.styleComponent.renderStyle,i.x,i.y,this.host.scaleForRender*this.host.styleComponent.renderStyle.scaleGlobal*this.host.styleComponent.renderStyle.scaleLocal,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tOver),!0,!0,this.host.isGrayColor,this.host.visibility):t.pointSVGNormalFill(e,this.host.scene.annotationInstance.customization.themeCurrent.nPoint.SVG.path2D,this.host.styleComponent.renderStyle,i.x,i.y,this.host.scaleForRender*this.host.styleComponent.renderStyle.scaleGlobal*this.host.styleComponent.renderStyle.scaleLocal,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tDown2),!1,!1,this.host.isGrayColor,this.host.visibilityValue,this.host.isPinValue,this.host.isHoverValue,this.host.isSelectedValue,!0),this.tOver+=.015,this.tOverPopupSummary+=this.host.scene.annotationInstance.renderer.dt,this.tDown1=0,this.host.isLeave=!0):this.host.isLeave&&!this.host.isDrag?(this.host.scene.annotationInstance.implementations.app.param.environment,p.qA.AGSM,this.tDown1+=.015,this.tOver=this.tOverPopupSummary=0,this.tDown1>.15&&(this.host.isLeave=!1)):this.host.isDrag||(this.host.scene.annotationInstance.implementations.app.param.environment,p.qA.AGSM,s.pointNumberedOverBoundingByCircle(e,this.host.styleComponent.renderStyle,i.x,i.y,this.host.scaleForRender*this.host.styleComponent.renderStyle.scaleGlobal*this.host.styleComponent.renderStyle.scaleLocal,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tDown1),!1,!1,this.host.isGrayColor,this.host.visibilityValue),this.tDown1+=this.host.scene.annotationInstance.renderer.dt,this.tOver=this.tOverPopupSummary=0),this.host.scene.annotationInstance.implementations.app.param.environment===p.qA.AGSM?s.pointNumberedDragByCircle(e,this.host.styleComponent.renderStyle,i.x,i.y,this.host.scaleForRender*this.host.styleComponent.renderStyle.scaleGlobal*this.host.styleComponent.renderStyle.scaleLocal,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tDown2),!1,!1,this.host.isGrayColor,this.host.visibility,this.host.isHover,this.host.isSelected):t.pointSVGNormalFill(e,this.host.scene.annotationInstance.customization.themeCurrent.nPoint.SVG.path2D,this.host.styleComponent.renderStyle,i.x,i.y,this.host.scaleForRender*this.host.styleComponent.renderStyle.scaleGlobal*this.host.styleComponent.renderStyle.scaleLocal,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tDown2),!1,!1,this.host.isGrayColor,this.host.visibilityValue,this.host.isPinValue,this.host.isHoverValue,this.host.isSelectedValue),this.tUp=0,this.tDown2+=.5*this.host.scene.annotationInstance.renderer.dt,this.tDown2>.15&&(this.host.isDrop=!1)),this.DrawingText(e,i.x,i.y),this.host.hasPopup&&this.host.isMove&&this.host.updateDivPos(),this.host.t+=this.host.scene.annotationInstance.renderer.dt,this.host.scene.annotationInstance.implementations.app.param.environment===p.qA.AGSM?this.renderNPointCircleOffScreen(this.host.scene.annotationInstance.renderer.ctxOffscreen,i.x,i.y,this.host.scaleForRender*this.host.styleComponent.renderStyle.scaleGlobal*this.host.styleComponent.renderStyle.scaleLocal):this.offScreenRender(i.x,i.y)}DrawingText(e,t,s){let i=this.geo.styleComponent.renderStyle.scaleLocal*this.geo.styleComponent.renderStyle.scaleGlobal,n="".concat(this.geo.scene.annotationInstance.renderer.imageAnnoApp.customization.themeCurrent.nPoint.fontSize*i,"px ").concat(this.geo.scene.annotationInstance.renderer.imageAnnoApp.customization.themeCurrent.nPoint.fontFamily);e.font=n,e.textAlign="center",e.fillStyle=this.host.styleComponent.textColor,this.host.scene.annotationInstance.implementations.app.param.environment===p.qA.AGSM?e.fillText(this.host.getIndex().toString(),t,s-20*i*.5):e.fillText(this.host.getIndex().toString(),t,s-28*i*.5)}offScreenRender(e,t){let s=(0,p.nP)();tS(this.host.scene.annotationInstance.renderer.ctxOffscreen,[e,t],s.path2D,this.geo.hashColor,this.geo.scene.annotationInstance.activeCommandController.scaleGlobal*this.geo.styleComponent.renderStyle.scaleLocal,-13.14,-28)}renderNPointCircleOffScreen(e,t,s,i){let n=this.host.scene.annotationInstance.customization.themeCurrent.nPoint.height*i;e.fillStyle=this.geo.hashColor,e.beginPath(),e.arc(t,s-.5*n,.5*n,0,2*Math.PI),e.closePath(),e.fill()}constructor(e){super(e),this.host=e}}let tS=function(e,t,s,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:-8,r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:-32;e.fillStyle=i,e.save(),e.translate(t[0]+o*n,t[1]+r*n),e.scale(n,n),e.fill(s),e.restore()};var tA=s(59321);class tf extends O{updateStyle(){this.isCustom||(this.state.themeColorId=h.AccentColor1,this.isCustom=!0,b.updateRenderStyleNPoint(this.renderStyle,this.geo.scene.annotationInstance.customization.themeCurrent)),this.updateTextColor()}updateColor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;this.isCustom=!0,void 0===e&&(e=this.geo.scene.annotationInstance.activeCommandController.activeColorController.activeColor),b.updateRenderColorNPoint(this.renderStyle,this.geo.scene.annotationInstance.customization.themeCurrent,e),this.tempColorRgba=e,this.updateTextColor()}updateStyleCustom(e){let t=!1;return e.size&&(this.geo.size=e.size.toUpperCase(),t=!0),e.width&&(this.state.width=e.width),void 0!==e.color&&(this.state.themeColorId=e.color),e.colorRgba.length>0&&(this.tempColorRgba=e.colorRgba,b.updateRenderColorRPointCustom(this.renderStyle,this.geo.scene.annotationInstance.customization.themeCurrent,e.colorRgba)),e.scale&&(this.renderStyle.scaleLocal=e.scale,this.state.scale=e.scale),this.isCustom=!0,t&&!this.geo.isUnderConstruction&&(this.geo.isTransform=!0),this.updateTextColor(),!0}toJson(){if(!this.isCustom)return;let e={width:this.state.width,scale:this.renderStyle.scaleLocal,colorRgba:this.tempColorRgba,number:this.geo.getIndex()};return this.renderStyle.size!==p.$u.MEDIUM&&(e.size=this.renderStyle.size.toLowerCase()),this.state.themeColorId!==h.AccentColor1&&(e.color=this.state.themeColorId),e}isSameStyle(e){if(e.colorRgba.length===this.tempColorRgba.length){for(let t=0;t<e.colorRgba.length;t++)if(e.colorRgba[t]!==this.tempColorRgba[t])return!1}return!0}updateTextColor(){this.textColor=(0,tA.XV)(this.renderStyle.colorFill)}constructor(e){super(e),this.textColor="#000",this.updateStyle(),this.updateColor()}}class tP extends F{translateByMouseEventData(e){}translate(e,t){}constructor(e){super(e),this.geo=e}}class tx extends A{static FindAtPoint(e,t,s){for(let i=e.listNPoint.length-1;i>=0;--i)if(e.listNPoint.length[i].isSelectable&&e.listNPoint.length[i].IsMouseInside(t,s))return e.listNPoint.length[i]}static GetLengthSelection(e){let t=e.listNPoint.length,s=0;for(;t--;)e.listNPoint[t].isSelected&&(s+=1);return s}static RemoveAllCapturedGeo(e){let t=e.listNPoint;for(let s=0;s<t.length;++s)!0===e.listNPoint[s].isSelectedValue&&e.listNPoint[s].remove()}static DeSelecteCaptureObjects(e){for(let t=0;t<e.listNPoint.length;++t)e.listNPoint[t].isSelectedValue=!1}static MoveSelectedGeo(e,t){for(let s=0;s<e.listNPoint.length;++s)!0!==e.listNPoint[s].isSelectedValue||e.listNPoint[s].isHoverValue||e.listNPoint[s].translateByMouseEventData(t),!0===e.listNPoint[s].isHoverValue&&e.listNPoint[s].translateByMouseEventData(t)}static FromJSON(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=[t.nodes[0].sx,t.nodes[0].sy],o=new tx(e,n[0],n[1],0,s);return o.type=p.zq[t.type],i?o.id=e.getUUID():o.id=t.id,o.isHiddenValue=t.isHidden,t.isHidden?o.visibilityValue=0:o.visibilityValue=1,t.styles&&o.updateStyleCustom(t.styles),o.initVecsHistory(),o}static MouseRightClick(e){}static MouseMiddleClick(e){}static mouseLeftClick(e,t){void 0===e.capture&&(new tx(e,t.x,t.y,0).dummy(),e.annotationInstance.activeCommandController.acProperties.pressShift||e.annotationInstance.activeCommandController.goToACMode())}InitComponent(){this.styleComponent=new tf(this),this.renderer=new tC(this),this.transformation=new tP(this),this.interaction=new ty(this)}init(){this.isGeoPos=!0,this.edges=[],this.isPointMid=!1,this.t=0}isMouseInside(e,t){return!this.isRemove&&!!this.isRenderable&&!this.isHiddenValue&&!this.isCollapse&&this.scene.annotationInstance.geometryCommon.gcmdProcessing.isMouseInsideByOffScreenNumberPoint(e-this.scene.annotationInstance.renderer.imageAnnoApp.scene.paramsEditing.croppingMaskParams.x,t-this.scene.annotationInstance.renderer.imageAnnoApp.scene.paramsEditing.croppingMaskParams.y,this._hashColorRGB)}isMouseInsideWithTolerance(e,t,s){return!this.isRemove&&!!this.isRenderable&&!this.isHiddenValue&&!this.isCollapse&&this.distance(e,t+11*this.scaleForRender)<=this.r*this.scaleForRender+12*this.scaleForRender+s}getParentType(){return"ANNOTATION.POINT_NUMBERED"}remove(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];if(this.isSelectable=!1,this.isRenderable=!1,this.hasPopupValue&&this.hidePopUpSummary(),e){let e=this.toJSON();e&&this.scene.annotationInstance.io.eventListenerAnnotation.removeGeometryStack([e])}this.textLeaderline&&(this.textLeaderline.removeByAttachedShape(),this.textLeaderline=void 0),this.scene.removeBasePoint(this),this.scene.removeNPoint(this),this.scene.removeGeometry(this)}getIndex(){return this.scene.listNPoint.indexOf(this)+1}deepCopy(e,t){return new tx(this.scene,e,t,this.vec.z,!1,this.type,this.r)}get isSelected(){return this.isSelectedValue}set isSelected(e){this.isSelectedValue=e,this.scene.annotationInstance.io.eventListenerAnnotation.selectionStack(this.toJSON())}get isHover(){return this.isHoverValue}set isHover(e){this.isHoverValue=e,this.isHoverValue&&!this.isHoverPre?this.scene.annotationInstance.io.eventListenerAnnotation.hoverStack(this.toJSON()):!this.isHoverValue&&this.isHoverPre&&this.scene.annotationInstance.io.eventListenerAnnotation.hoverStack(this.toJSON()),this.isHoverPre=this.isHoverValue,e||(this.needEmitHoverPost=!0,this.hidePopUpSummary())}mouseLeftClick(){this.scene.annotationInstance.geometryCommon.gcmdProcessing.removeAllPopup(),this.showPopupSummary()}updateDivPos(){this.popup&&(this.popup.style.top=this.vec.y-31*this.scene.annotationInstance.customization.themeCurrent.nPoint.scale+"px",this.popup.style.left=this.vec.x-17*this.scene.annotationInstance.customization.themeCurrent.nPoint.scale+"px")}renderPost(e){this.renderer.renderPost(e),this.scene.annotationInstance.implementations.app.INSPECTION&&this.collision.render(e)}toJSON(){if(this.type===p.zq.ANODE||this.type===p.zq.ANODE_CIRCLE||this.type===p.zq.AMIDPOINT||this.type===p.zq.AN_GON||this.type===p.zq.ANODE_RECT)return;let e=new g(this.id,this.type,this.isSelectedValue,this.isHoverValue,this.isHiddenValue);e.pushNode(this.getNode());let t=this.styleComponent.toJson();return t&&(e.styles=t),e}get numberIndex(){return this._numberIndex}set numberIndex(e){this._numberIndex=e}updateBoundingBox(){this.collision.minVec=new p.h9(this.vec.x-16,this.vec.y-30),this.collision.maxVec=new p.h9(this.vec.x+16,this.vec.y+2)}showPopupSummary(){!this.scene.annotationInstance.activeCommandController.needPopup()||this.hasPopupValue||this.popup||this.isGhost||(this.hasPopupValue=!0,this.popup=document.createElement("div"),this.popup.id="pa-"+this.id,this.popup.style.position="absolute",this.popup.style.pointerEvents="none",this.scene.annotationInstance.implementations.app.model.modelViewWrapper.div.appendChild(this.popup),this.popup.style.height=34*this.scene.annotationInstance.customization.themeCurrent.nPoint.scale+"px",this.popup.style.width=34*this.scene.annotationInstance.customization.themeCurrent.nPoint.scale+"px",this.popup.style.top=this.vec.y-31*this.scene.annotationInstance.customization.themeCurrent.nPoint.scale+"px",this.popup.style.left=this.vec.x-17*this.scene.annotationInstance.customization.themeCurrent.nPoint.scale+"px",this.showPopupStackTimer&&clearTimeout(this.showPopupStackTimer),this.showPopupStackTimer=setTimeout(()=>{this.popup&&this.scene.annotationInstance.io.eventListenerAnnotation.showPopupStack(this.toJSON())},this.timePopupDelay))}updatePopup(){this.hasPopupValue&&void 0!==this.popup&&(this.hasGhostPopup?(this.popup.style.top=this.vec.y-this.scene.annotationInstance.customization.themeCurrent.nPoint.height-this.ghostPopupOffset+"px",this.popup.style.left=this.vec.x+"px"):(this.popup.style.top=this.vec.y-31*this.scene.annotationInstance.customization.themeCurrent.nPoint.scale+"px",this.popup.style.left=this.vec.x-17*this.scene.annotationInstance.customization.themeCurrent.nPoint.scale+"px"))}hidePopUpSummary(){if(this.popup&&this.popup.parentNode&&this.scene.annotationInstance.activeCommandController.acProperties.insideMap){if(this.renderer.tOverPopupSummary=0,this.popup.parentNode.removeChild(this.popup),this.type===p.zq.CNODE){let e=new g(this.id,this.type,this.isSelectedValue,this.isHoverValue,this.isHiddenValue);e.pushNode(this.getNode()),this.scene.annotationInstance.io.eventListenerAnnotation.hidePopupStack(e)}else this.scene.annotationInstance.io.eventListenerAnnotation.hidePopupStack(this.toJSON());this.hasPopupPre=!1,this.popup=void 0,this.hasPopupValue=!1}}constructor(e,t=0,s=0,i=0,n=!1,o=p.zq.POINT_NUMBERED,r=5,a="white",h="black",c=p.cg.Round){super(e,t,s,i,o),this.numberIndexNeeded=!0,this.svgPath=new Path2D("M26 2a2 2 0 00-2-2H2a2 2 0 00-2 2v17a2 2 0 002 2h6.757l4.276 6.33L17.31 21H24a2 2 0 002-2V2z"),this._numberIndex=-1,this._hashColorRGB=[0,0,0,0],this.type=o,this.isUndo=n,this.numberIndex=this.scene.listNPoint.length+1;let l=this.hashColor.split("(")[1].split(")")[0].split(",");if(this._hashColorRGB=[+l[0],+l[1],+l[2]],this.InitComponent(),e.addNPoint(this),this.isUndo)return;e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(this.toJSON())}}class tw{isMouseInside(e,t){return!this.geo.isRemove&&!!this.geo.isRenderable&&!this.geo.isHiddenValue&&!this.geo.isCollapse&&(this.geo.scene.annotationInstance.implementations.app.model.appCoreWrapper.browserUtility.isMobile?15>(0,p.Sp)(new p.h9(e,t),new p.h9(this.geo.vec.x,this.geo.vec.y-(this.geo.collision.maxVec.y-this.geo.collision.minVec.y)*.5)):(0,p.mp)(new p.h9(e,t),this.geo.collision.minVec,this.geo.collision.maxVec))}getLog(){return""}hide(){}updateDivPos(){if(this.geo.popup)switch(this.geo.renderer.pointRenderType){case p.oW.RpointA:this.geo.popup.style.top=this.geo.vec.y-32+"px",this.geo.popup.style.left=this.geo.vec.x-10+"px";break;case p.oW.Image:this.geo.popup.style.top=this.geo.vec.y+"px",this.geo.popup.style.left=this.geo.vec.x+.5*this.geo.styleComponent.img.width+1+"px"}}showPopupSummary(){if(this.geo.scene.annotationInstance.activeCommandController.needPopup()&&!this.geo.hasPopup&&!this.geo.isGhost){switch(this.geo.hasPopup=!0,this.geo.popup=document.createElement("div"),this.geo.popup.id="pa-"+this.geo.id,this.geo.popup.style.position="absolute",this.geo.popup.style.pointerEvents="none",this.geo.scene.annotationInstance.implementations.app.model.modelViewWrapper.div.appendChild(this.geo.popup),this.geo.renderer.pointRenderType){case p.oW.RpointA:1===this.geo.scene.annotationInstance.customization.themeCurrent.nPoint.scale?(this.geo.popup.style.height="33px",this.geo.popup.style.width="18px",this.geo.popup.style.top=this.geo.vec.y-32+"px",this.geo.popup.style.left=this.geo.vec.x-10+"px"):(this.geo.popup.style.height=32*this.geo.scene.annotationInstance.customization.themeCurrent.nPoint.scale+"px",this.geo.popup.style.width=18*this.geo.scene.annotationInstance.customization.themeCurrent.nPoint.scale+"px",this.geo.popup.style.top=this.geo.vec.y-32*this.geo.scene.annotationInstance.customization.themeCurrent.nPoint.scale+"px",this.geo.popup.style.left=this.geo.vec.x-10*this.geo.scene.annotationInstance.customization.themeCurrent.nPoint.scale+1+"px");break;case p.oW.Image:this.geo.popup.style.top=this.geo.vec.y+"px",this.geo.popup.style.left=this.geo.vec.x+.5*this.geo.styleComponent.img.width+1+"px"}this.showPopupStackTimer&&clearTimeout(this.showPopupStackTimer),this.showPopupStackTimer=setTimeout(()=>{this.geo.popup&&this.geo.scene.annotationInstance.io.eventListenerAnnotation.showPopupStack(this.geo.toJSON())},100)}}updatePopup(){if(this.geo.hasPopup&&void 0!==this.geo.popup)switch(this.geo.renderer.pointRenderType){case p.oW.RpointA:this.geo.hasGhostPopup?(this.geo.popup.style.top=this.geo.vec.y-this.geo.scene.annotationInstance.customization.themeCurrent.nPoint.height-this.geo.ghostPopupOffset+"px",this.geo.popup.style.left=this.geo.vec.x+"px"):1===this.geo.scene.annotationInstance.customization.themeCurrent.nPoint.scale?(this.geo.popup.style.top=this.geo.vec.y-32+"px",this.geo.popup.style.left=this.geo.vec.x-10+"px"):(this.geo.popup.style.top=this.geo.vec.y-32*this.geo.scene.annotationInstance.customization.themeCurrent.nPoint.scale+"px",this.geo.popup.style.left=this.geo.vec.x-10*this.geo.scene.annotationInstance.customization.themeCurrent.nPoint.scale+1+"px");break;case p.oW.Image:this.geo.popup.style.top=this.geo.vec.y+"px",this.geo.popup.style.left=this.geo.vec.x+.5*this.geo.styleComponent.img.width+1+"px"}}constructor(e){this.geo=e}}class tI extends x{renderPost(e){if(this.host.inspector.update(e),this.interpolateColor.update(),this.host.scaleForRender=1,this.host.isCollapse||this.host.scaleForRender<.01)return;let t=this.host.scene.annotationInstance.renderer.draw.shape.point;this.host.isDrag?(t.pointRegularDragBySVGPath(e,this.host.styleComponent.renderStyle,this.host.vec.x,this.host.vec.y,this.host.scaleForRender*this.host.scene.annotationInstance.activeCommandController.scaleGlobal,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tUp),!0,!0,this.host.isGrayColor,this.host.visibilityValue,this.host.isPinValue,this.host.isHoverValue,this.host.isSelectedValue),this.tUp+=.015,this.tDown2=0):(this.host.isSelectedValue?(t.shadowRPoint(e,this.host.styleComponent.renderStyle,this.host.vec.x,this.host.vec.y,this.host.isSelected,this.host.isHover),t.pointRegularOverBoundingBySVGPathSelected(e,this.host.styleComponent.renderStyle,this.host.vec.x,this.host.vec.y,this.host.scaleForRender*this.host.scene.annotationInstance.activeCommandController.scaleGlobal,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tOver),!0,!0,this.host.isGrayColor,this.host.visibilityValue,this.host.isPinValue),this.tOver+=.015,this.tDown1=0,this.host.isHoverValue?this.tOverPopupSummary+=this.host.scene.annotationInstance.renderer.dt:this.tOverPopupSummary=0,this.host.isLeave=!0):this.host.isHoverValue?(t.shadowRPointLight(e,this.host.styleComponent.renderStyle,this.host.vec.x,this.host.vec.y,this.host.scaleForRender*this.host.scene.annotationInstance.activeCommandController.scaleGlobal,this.host.isSelected,this.host.isHover),t.pointRegularOverBoundingBySVGPath(e,this.host.styleComponent.renderStyle,this.host.vec.x,this.host.vec.y,this.host.scaleForRender*this.host.scene.annotationInstance.activeCommandController.scaleGlobal,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tOver),!0,!0,this.host.isGrayColor,this.host.visibilityValue,this.host.isPinValue),this.tOver+=.015,this.tOverPopupSummary+=this.host.scene.annotationInstance.renderer.dt,this.tDown1=0,this.host.isLeave=!0):this.host.isLeave&&!this.host.isDrag?(t.pointRegularOverBoundingBySVGPath(e,this.host.styleComponent.renderStyle,this.host.vec.x,this.host.vec.y,this.host.scaleForRender*this.host.scene.annotationInstance.activeCommandController.scaleGlobal,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tDown1),!1,!0,this.host.isGrayColor,this.host.visibilityValue,this.host.isPinValue),this.tDown1+=this.host.scene.annotationInstance.renderer.dt,this.tOver=this.tOverPopupSummary=0,this.tDown1>.15&&(this.host.isLeave=!1)):this.host.isDrag||(t.pointRegularOverBoundingBySVGPath(e,this.host.styleComponent.renderStyle,this.host.vec.x,this.host.vec.y,this.host.scaleForRender*this.host.scene.annotationInstance.activeCommandController.scaleGlobal,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tDown1),!1,!1,this.host.isGrayColor,this.host.visibilityValue,this.host.isPinValue),this.tDown1+=this.host.scene.annotationInstance.renderer.dt,this.tOver=this.tOverPopupSummary=0),t.pointRegularDragBySVGPath(e,this.host.styleComponent.renderStyle,this.host.vec.x,this.host.vec.y,this.host.scaleForRender*this.host.scene.annotationInstance.activeCommandController.scaleGlobal,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tDown2),!1,!1,this.host.isGrayColor,this.host.visibilityValue,this.host.isPinValue,this.host.isHoverValue,this.host.isSelectedValue),this.tUp=0,this.tDown2+=.5*this.host.scene.annotationInstance.renderer.dt),this.host.hasPopup&&this.host.isMove&&this.host.updateDivPos(),this.t+=this.host.scene.annotationInstance.renderer.dt,this.offScreenRender()}offScreenRender(){this.host.scene.annotationInstance.renderer.offscreen.rPointOffscreen(this.host.scene.annotationInstance.renderer.ctxOffscreen,this.host.hashColor,this.host.vec,this.host.scaleForRender)}constructor(e){super(e),this.host=e}}class tR extends tI{renderPost(e){if(this.host.inspector.update(e),this.interpolateColor.update(),!this.host.isCollapse&&!(this.host.scaleForRender<.01)){switch(this.host.hasPopup&&this.host.isMove&&this.host.updateDivPos(),this.pointRenderType){case p.oW.RpointA:this.renderPointA(e);break;case p.oW.Image:this.renderPointIcon(e)}this.t+=this.host.scene.annotationInstance.renderer.dt,this.offScreenRender()}}renderPointA(e){let t=this.host.scene.annotationInstance.renderer.draw.shape.pointGeneric,s=this.host.scene.annotationInstance.renderer.draw.shape.point,i=this.host.scene.annotationInstance.geometryCommon.gcmdSupporting.toScreenVecOnCropping(this.host.vec),n=this.host.styleComponent.renderStyle.scaleGlobal*this.host.styleComponent.renderStyle.scaleLocal;this.geo.collision.updateByScale(n),this.host.isDrag?(s.shadowRPoint(e,this.host.styleComponent.renderStyle,i.x,i.y,this.host.isSelected,this.host.isHover),t.pointGenericOverBoundingSelected(e,this.pointRenderType,this.host.styleComponent.renderStyle,i.x,i.y,n,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tOver),!0,!0,this.host.isGrayColor,this.host.visibilityValue,this.host.isPinValue),t.pointGenericDrag(e,this.pointRenderType,this.host.styleComponent.renderStyle,i.x,i.y,n,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tUp),!0,!0,this.host.isGrayColor,this.host.visibilityValue,this.host.isPinValue,this.host.isHoverValue,this.host.isSelectedValue),this.tUp+=.015,this.tDown2=0):(this.host.isSelectedValue?(s.shadowRPoint(e,this.host.styleComponent.renderStyle,i.x,i.y,this.host.isSelected,this.host.isHover),t.pointGenericOverBoundingSelected(e,this.pointRenderType,this.host.styleComponent.renderStyle,i.x,i.y,n,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tOver),!0,!0,this.host.isGrayColor,this.host.visibilityValue,this.host.isPinValue),this.tOver+=.015,this.tDown1=0,this.host.isHoverValue?this.tOverPopupSummary+=this.host.scene.annotationInstance.renderer.dt:this.tOverPopupSummary=0,this.host.isLeave=!0):this.host.isHoverValue?(s.shadowRPointLight(e,this.host.styleComponent.renderStyle,i.x,i.y,n,this.host.isSelected,this.host.isHover),t.pointGenericOverBounding(e,this.pointRenderType,this.host.styleComponent.renderStyle,i.x,i.y,n,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tOver),!0,!0,this.host.isGrayColor,this.host.visibilityValue,this.host.isPinValue),this.tOver+=.015,this.tOverPopupSummary+=this.host.scene.annotationInstance.renderer.dt,this.tDown1=0,this.host.isLeave=!0):this.host.isLeave&&!this.host.isDrag?(t.pointGenericOverBounding(e,this.pointRenderType,this.host.styleComponent.renderStyle,i.x,i.y,n,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tDown1),!1,!0,this.host.isGrayColor,this.host.visibilityValue,this.host.isPinValue),this.tDown1+=this.host.scene.annotationInstance.renderer.dt,this.tOver=this.tOverPopupSummary=0,this.tDown1>.15&&(this.host.isLeave=!1)):this.host.isDrag||(t.pointGenericOverBounding(e,this.pointRenderType,this.host.styleComponent.renderStyle,i.x,i.y,n,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tDown1),!1,!1,this.host.isGrayColor,this.host.visibilityValue,this.host.isPinValue),this.tDown1+=this.host.scene.annotationInstance.renderer.dt,this.tOver=this.tOverPopupSummary=0),t.pointGenericDrag(e,this.pointRenderType,this.host.styleComponent.renderStyle,i.x,i.y,n,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tDown2),!1,!1,this.host.isGrayColor,this.host.visibilityValue,this.host.isPinValue,this.host.isHoverValue,this.host.isSelectedValue),this.tUp=0,this.tDown2+=.5*this.host.scene.annotationInstance.renderer.dt)}renderPointIcon(e){let t=this.host.scene.annotationInstance.renderer.draw.shape.pointGeneric,s=this.host.scene.annotationInstance.renderer.draw.shape.point,i=this.host.styleComponent.img.width*this.host.scene.annotationInstance.customization.themeCurrent.rPoint.scale,n=this.host.styleComponent.img.height*this.host.scene.annotationInstance.customization.themeCurrent.rPoint.scale;this.renderImg(e,this.host.styleComponent.img,this.host.vec.x-.5*i,this.host.vec.y-n,i,n,this.host.isHover,this.host.isSelectedValue),this.host.isDrag?(t.pointGenericDrag(e,this.pointRenderType,this.host.styleComponent.renderStyle,this.host.vec.x,this.host.vec.y,this.host.scaleForRender,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tUp),!0,!0,this.host.isGrayColor,this.host.visibilityValue,this.host.isPinValue,this.host.isHoverValue,this.host.isSelectedValue),this.tUp+=.015,this.tDown2=0):(this.host.isSelectedValue?(s.shadowRPoint(e,this.host.styleComponent.renderStyle,this.host.vec.x,this.host.vec.y,this.host.isSelected,this.host.isHover),this.tOver+=.015,this.tDown1=0,this.host.isHoverValue?this.tOverPopupSummary+=this.host.scene.annotationInstance.renderer.dt:this.tOverPopupSummary=0,this.host.isLeave=!0):this.host.isHoverValue?(s.shadowRPointLight(e,this.host.styleComponent.renderStyle,this.host.vec.x,this.host.vec.y,this.host.scaleForRender,this.host.isSelected,this.host.isHover),this.tOver+=.015,this.tOverPopupSummary+=this.host.scene.annotationInstance.renderer.dt,this.tDown1=0,this.host.isLeave=!0):this.host.isLeave&&!this.host.isDrag?(this.tDown1+=this.host.scene.annotationInstance.renderer.dt,this.tOver=this.tOverPopupSummary=0,this.tDown1>.15&&(this.host.isLeave=!1)):this.host.isDrag||(this.tDown1+=this.host.scene.annotationInstance.renderer.dt,this.tOver=this.tOverPopupSummary=0),t.pointGenericDrag(e,this.pointRenderType,this.host.styleComponent.renderStyle,this.host.vec.x,this.host.vec.y,this.host.scaleForRender,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tDown2),!1,!1,this.host.isGrayColor,this.host.visibilityValue,this.host.isPinValue,this.host.isHoverValue,this.host.isSelectedValue),this.tUp=0,this.tDown2+=.5*this.host.scene.annotationInstance.renderer.dt)}renderImg(e,t,s,i,n,o,r,a){r||a||(e.globalAlpha=this.interpolateColor.opacity),e.drawImage(t,s,i,n,o),e.globalAlpha=1}offScreenRender(){switch(this.pointRenderType){case p.oW.RpointA:this.host.scene.annotationInstance.renderer.offscreen.rPointOffscreen(this.host.scene.annotationInstance.renderer.ctxOffscreen,this.host.hashColor,this.host.vec,this.host.scaleForRender);break;case p.oW.Image:this.host.scene.annotationInstance.renderer.ctxOffscreen.fillStyle=this.host.hashColor,this.host.scene.annotationInstance.renderer.ctxOffscreen.beginPath(),this.host.scene.annotationInstance.renderer.ctxOffscreen.rect(this.host.collision.minVec.x,this.host.collision.minVec.y,this.host.collision.maxVec.x-this.host.collision.minVec.x,this.host.collision.maxVec.y-this.host.collision.minVec.y),this.host.scene.annotationInstance.renderer.ctxOffscreen.closePath(),this.host.scene.annotationInstance.renderer.ctxOffscreen.fill()}}constructor(e){super(e),this.host=e,this.pointRenderType=p.oW.RpointA}}class tb extends O{updateStyle(){this.isCustom||(this.state.themeColorId=h.AccentColor1,this.isCustom=!0,this.url=this.geo.scene.annotationInstance.customization.themeCurrent.rPoint.URL,b.updateRenderStyleRPoint(this.renderStyle,this.geo.scene.annotationInstance.customization.themeCurrent))}updateColor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;this.isCustom=!0,void 0===e&&(e=this.geo.scene.annotationInstance.activeCommandController.activeColorController.activeColor),b.updateRenderColorRPointCustom(this.renderStyle,this.geo.scene.annotationInstance.customization.themeCurrent,e),this.tempColorRgba=e}updateStyleCustom(e){let t=!1;return e.size&&(this.geo.size=e.size.toUpperCase(),this.renderStyle.size=this.geo.size,t=!0),e.url&&this.url!==e.url&&(this.url=e.url,this.img=new Image,this.img.src=this.url,this.img.onload=()=>{e.size?(this.geo.size=e.size.toUpperCase(),this.renderStyle.size=this.geo.size):this.geo.size=p.$u.MEDIUM,e.url!==this.defaultURL?this.geo.renderer.pointRenderType=p.oW.Image:this.geo.renderer.pointRenderType=p.oW.RpointA,t=!0}),e.width&&(this.state.width=e.width),void 0!==e.color&&(this.state.themeColorId=e.color),e.colorRgba.length>0&&(this.tempColorRgba=e.colorRgba,b.updateRenderColorRPointCustom(this.renderStyle,this.geo.scene.annotationInstance.customization.themeCurrent,e.colorRgba),this.updateColor(e.colorRgba)),e.scale&&(this.renderStyle.scaleLocal=e.scale,this.state.scale=e.scale),"string"==typeof e.symbol&&(this.symbol=e.symbol),this.isCustom=!0,t&&!this.geo.isUnderConstruction&&(this.geo.isTransform=!0),!0}toJson(){if(!this.isCustom)return;let e={width:this.state.width,scale:this.renderStyle.scaleLocal,colorRgba:this.tempColorRgba,url:this.url};return this.renderStyle.size!==p.$u.MEDIUM&&(e.size=this.renderStyle.size.toLowerCase()),this.url!==this.defaultURL&&(e.symbolType="image"),this.symbol&&(e.symbol=this.symbol),this.state.themeColorId!==h.AccentColor1&&(e.color=this.state.themeColorId),e}isSameStyle(e){if(e.size&&e.size!==this.renderStyle.size.toLowerCase())return!1;if(e.colorRgba.length===this.tempColorRgba.length){for(let t=0;t<e.colorRgba.length;t++)if(e.colorRgba[t]!==this.tempColorRgba[t])return!1}return this.url===e.url}constructor(e){super(e),this.img=new Image,this.defaultURL="".concat(this.geo.scene.annotationInstance.implementations.app.CONFIG.config.BASE_URL,"/static/storymaps-xgraphics/images/theme-assets/common/unnumbered-pin.svg"),this.updateStyle(),this.updateColor()}}class tL extends F{translateByMouseEventData(e){this.geo.isDrag=!0,this.geo.vec.x+=e.x-e.preX,this.geo.vec.y+=e.y-e.preY,this.geo.updatePostTransformation()}translate(e,t){}constructor(e){super(e),this.geo=e}}(r=l||(l={}))[r.LARGE=1.2]="LARGE",r[r.MEDIUM=1]="MEDIUM",r[r.SMALL=.832]="SMALL";class tO extends A{static findAtPoint(e,t,s){for(let i=e.listRPoint.length-1;i>=0;--i)if(e.listRPoint[i].isSelectable&&e.listRPoint[i].isMouseInside(t,s))return e.listRPoint[i]}static getLengthSelection(e){let t=e.listRPoint.length,s=0;for(;t--;)e.listRPoint[t].isSelected&&(s+=1);return s}static removeAllCapturedGeo(e){let t=e.listRPoint;for(let s=0;s<t.length;++s)!0===e.listRPoint[s].isSelectedValue&&e.listRPoint[s].remove()}static deSelecteCaptureObjects(e){for(let t=0;t<e.listRPoint.length;++t)e.listRPoint[t].isSelectedValue=!1}static moveSelectedGeo(e,t){for(let s=0;s<e.listRPoint.length;++s)!0!==e.listRPoint[s].isSelectedValue||e.listRPoint[s].isHoverValue||e.listRPoint[s].translateByMouseEventData(t),!0===e.listRPoint[s].isHoverValue&&e.listRPoint[s].translateByMouseEventData(t)}static fromJSON(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=[t.nodes[0].sx,t.nodes[0].sy],o=new tO(e,n[0],n[1],0,s);return t.styles&&o.updateStyleCustom(t.styles),o.type=p.zq[t.type],o.isHiddenValue=t.isHidden,i?o.id=e.getUUID():o.id=t.id,t.isHidden?o.visibilityValue=0:o.visibilityValue=1,t.data.scale&&o.initScale(t.data.scale),t.data.url&&o.updateIcon(t.data.url),o.initVecsHistory(),o}static mouseRightClick(e){}static mouseMiddleClick(e){}static mouseLeftClick(e,t){void 0===e.capture&&(new tO(e,t.x,t.y,0).dummy(),e.annotationInstance.activeCommandController.acProperties.pressShift||e.annotationInstance.activeCommandController.goToACMode())}static onMouseMove(e){}static mouseDrag(e){}static mouseUp(e){}initComponent(){this.styleComponent=new tb(this),this.renderer=new tR(this),this.transformation=new tL(this),this.interaction=new tw(this)}init(){this.isGeoPos=!0,this.edges=[],this.isPointMid=!1}getParentType(){return"ANNOTATION_POINT_REGULAR"}renderPost(e){!isNaN(this.vec.x)&&(this.renderer.renderPost(e),this.scene.annotationInstance.implementations.app.INSPECTION&&this.collision.render(e))}isMouseInside(e,t){return this.interaction.isMouseInside(e,t)}isMouseInsideWithTolerance(e,t,s){return!this.isRemove&&!!this.isRenderable&&!this.isHiddenValue&&!this.isCollapse&&this.distance(e,t+11*this.scaleForRender)<=this.r*this.scaleForRender+12*this.scaleForRender+s}getLog(){return this.interaction.getLog()}hide(){this.interaction.hide()}get isSelected(){return this.isSelectedValue}set isSelected(e){this.isSelectedValue=e,this.scene.annotationInstance.io.eventListenerAnnotation.selectionStack(this.toJSON())}get isHover(){return this.isHoverValue}set isHover(e){this.isHoverValue=e,this.isHoverValue&&!this.isHoverPre?this.scene.annotationInstance.io.eventListenerAnnotation.hoverStack(this.toJSON()):!this.isHoverValue&&this.isHoverPre&&this.scene.annotationInstance.io.eventListenerAnnotation.hoverStack(this.toJSON()),this.isHoverPre=this.isHoverValue,e||(this.needEmitHoverPost=!0,this.hidePopUpSummary())}get isPin(){return this.isPinValue}set isPin(e){this.isPinValue=e}translateByMouseEventData(e){this.isMovableValue&&!this.isRemove&&this.isRenderable&&!this.isHiddenValue&&(this.transformation.translateByMouseEventData(e),this.textLeaderline&&(this.textLeaderline.translateByMouseEventData(e),this.textLeaderline&&this.textLeaderline.leaderline&&(this.textLeaderline.leaderline.v2.x=this.vec.x,this.textLeaderline.leaderline.v2.y=this.vec.y)))}translate(e,t){this.transformation.translate(e,t)}updateDivPos(){this.interaction.updateDivPos()}showPopupSummary(){this.interaction.showPopupSummary()}updatePopup(){this.interaction.updatePopup()}updateIcon(e){this.renderer.pointRenderType=p.oW.Image,this.styleComponent.renderStyle.url=e}removeIcon(){this.renderer.pointRenderType=p.oW.RpointA}remove(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];if(this.isRenderable&&!this.isHiddenValue){if(this.isRemove=!0,this.isSelectable=!1,this.isRenderable=!1,this.hasPopupValue&&this.hidePopUpSummary(),!this.isGhost&&e){let e=this.toJSON();e&&this.scene.annotationInstance.io.eventListenerAnnotation.removeGeometryStack([e])}this.textLeaderline&&(this.textLeaderline.removeByAttachedShape(),this.textLeaderline=void 0),this.scene.removeBasePoint(this),this.scene.removeRPoint(this),this.scene.removeGeometry(this)}}deepCopy(e,t){return new tO(this.scene,e,t,this.vec.z,!1,this.type,this.r)}mouseLeftClick(){this.isGhost||(this.scene.annotationInstance.geometryCommon.gcmdProcessing.removeAllPopup(),this.showPopupSummary())}updateBoundingBox(){this.scaleForRender=this.iconSize*this.scene.annotationInstance.customization.themeCurrent.rPoint.scale;let e=this.scaleForRender,t=23*e*.65;this.collision.minVec=new p.h9(this.vec.x-t+-4,this.vec.y-32*e-2),this.collision.maxVec=new p.h9(this.vec.x+t+-4,this.vec.y+1)}get size(){return this.sizeValue}set size(e){if(this.sizeValue=e,this.styleComponent.img){let t=[];switch(e){case p.$u.LARGE:this.iconSize=1.2,this.styleComponent.renderStyle.size=p.$u.LARGE,t=this.styleComponent.img.width>this.styleComponent.img.height?(0,p.kC)(this.styleComponent.img.width,this.styleComponent.img.height,40):(0,p.Ux)(this.styleComponent.img.width,this.styleComponent.img.height,40),this.styleComponent.img.width=t[0],this.styleComponent.img.height=t[1];break;case p.$u.MEDIUM:this.iconSize=1,this.styleComponent.renderStyle.size=p.$u.MEDIUM,t=this.styleComponent.img.width>this.styleComponent.img.height?(0,p.kC)(this.styleComponent.img.width,this.styleComponent.img.height,32):(0,p.Ux)(this.styleComponent.img.width,this.styleComponent.img.height,32),this.styleComponent.img.width=t[0],this.styleComponent.img.height=t[1];break;case p.$u.SMALL:this.iconSize=.832,this.styleComponent.renderStyle.size=p.$u.SMALL,t=this.styleComponent.img.width>this.styleComponent.img.height?(0,p.kC)(this.styleComponent.img.width,this.styleComponent.img.height,28):(0,p.Ux)(this.styleComponent.img.width,this.styleComponent.img.height,28),this.styleComponent.img.width=t[0],this.styleComponent.img.height=t[1]}}if(this.renderType!==p.oW.Image)switch(e){case p.$u.LARGE:this.iconSize=1.2,this.styleComponent.renderStyle.size=p.$u.LARGE;break;case p.$u.MEDIUM:this.iconSize=1,this.styleComponent.renderStyle.size=p.$u.MEDIUM;break;case p.$u.SMALL:this.iconSize=.832,this.styleComponent.renderStyle.size=p.$u.SMALL}this.updateBoundingBox()}get renderType(){return this.renderer.pointRenderType}set renderType(e){this.renderer.pointRenderType=e}constructor(e,t=0,s=0,i=0,n=!1,o=p.zq.POINT_REGULAR,r=5,a="white",h="black",c=p.cg.Round){super(e,t,s,i,o),this.iconSize=1,this.isUndo=n,this.scaleForRender=1,this.initComponent(),this.updateBoundingBox(),e.addRPoint(this),this.isUndo||e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(this.toJSON())}}class tV extends el{mouseLeftClick(e){k.mouseLeftClick(this.acs.imageAnnoApp.scene,e)}mouseMiddleClick(e){k.mouseMiddleClick(e)}mouseRightClick(e){k.mouseRightClick(e)}mouseMove(e){}mouseDrag(e){}constructor(e){super(e)}}class tN extends tV{mouseLeftClick(e){tO.mouseLeftClick(this.acs.imageAnnoApp.scene,e)}constructor(e){super(e)}}class tk extends tV{mouseLeftClick(e){tx.mouseLeftClick(this.acs.imageAnnoApp.scene,e)}constructor(e){super(e)}}class tE extends tV{mouseLeftClick(e){tv.mouseLeftClick(this.acs.imageAnnoApp.scene,e)}constructor(e){super(e)}}class tT extends el{mouseDown(e){eH.mouseDown(this.acs.imageAnnoApp.scene,e,p.zq.ARROW_SINGLE)}mouseLeftClick(e){eH.mouseLeftClick(this.acs.imageAnnoApp.scene,e,p.zq.ARROW_SINGLE)}mouseMove(e){eH.mouseMove(this.acs.imageAnnoApp.scene,e,p.zq.ARROW_SINGLE)}mouseUp(e){eH.mouseUp(e)}keydown(e){("Escape"===e.key||81===e.keyCode||13===e.keyCode)&&eH.cancel()}constructor(e){super(e)}}class tD extends tT{mouseDown(e){eH.mouseDown(this.acs.imageAnnoApp.scene,e,p.zq.ARROW_DOUBLE)}mouseLeftClick(e){eH.mouseLeftClick(this.acs.imageAnnoApp.scene,e,p.zq.ARROW_DOUBLE)}mouseMove(e){void 0!==eH.condition.v0&&eH.drawShadow(this.acs.imageAnnoApp.scene,e,p.zq.ARROW_DOUBLE)}constructor(e){super(e)}}class tz extends el{mouseDown(e){eE.mouseDown(this.acs.imageAnnoApp.scene,e)}mouseLeftClick(e){eE.mouseLeftClick(this.acs.imageAnnoApp.scene,e)}mouseDoubleClick(e){eE.mouseDoubleClick(this.acs.imageAnnoApp.scene,e)}mouseMove(e){eE.mouseMove(e)}keydown(e){27===e.keyCode&&eE.cancel(),(81===e.keyCode||13===e.keyCode)&&eE.doneByKeyboard(this.acs.imageAnnoApp.scene)}undo(){eE.undo(this.acs.m)}constructor(e){super(e)}}class tM extends tz{mouseLeftClick(e){eE.mouseLeftClick(this.acs.imageAnnoApp.scene,e,!0)}mouseDoubleClick(e){eE.mouseDoubleClick(this.acs.imageAnnoApp.scene,e,!0)}mouseDown(e){eE.mouseDown(this.acs.imageAnnoApp.scene,e,!0)}mouseMove(e){eE.mouseMove(e)}constructor(e){super(e)}}class tG extends el{mouseDown(e){td.mouseDown(this.acs.imageAnnoApp.scene,e,p.iu.Polyline)}mouseDrag(e){td.mouseDrag(this.acs.imageAnnoApp.scene,e,p.iu.Polyline)}mouseUp(e){td.mouseUp(this.acs.imageAnnoApp.scene,e)}keydown(e){27===e.keyCode&&td.cancel()}mouseMove(e){td.mouseMove(this.acs.imageAnnoApp.scene,e,p.iu.Polyline)}constructor(e){super(e)}}class tW extends el{mouseDown(e){td.mouseDown(this.acs.imageAnnoApp.scene,e,p.iu.PolylineBending)}mouseDrag(e){td.mouseDrag(this.acs.imageAnnoApp.scene,e,p.iu.PolylineBending)}mouseUp(e){td.mouseUp(this.acs.imageAnnoApp.scene,e)}keydown(e){27===e.keyCode&&td.cancel()}mouseMove(e){td.mouseMove(this.acs.imageAnnoApp.scene,e,p.iu.PolylineBending)}cancel(){td.cancel()}constructor(e){super(e)}}class tB extends el{mouseDown(e){td.mouseDown(this.acs.imageAnnoApp.scene,e,p.iu.Polygon)}mouseDrag(e){td.mouseDrag(this.acs.imageAnnoApp.scene,e,p.iu.Polygon)}mouseUp(e){td.mouseUp(this.acs.imageAnnoApp.scene,e)}keydown(e){27===e.keyCode&&td.cancel()}mouseMove(e){td.mouseMove(this.acs.imageAnnoApp.scene,e,p.iu.Polygon)}constructor(e){super(e)}}class tH extends el{mouseDown(e){td.mouseDown(this.acs.imageAnnoApp.scene,e,p.iu.PolygonGraph)}mouseDrag(e){td.mouseDrag(this.acs.imageAnnoApp.scene,e,p.iu.PolygonGraph)}mouseUp(e){td.mouseUp(this.acs.imageAnnoApp.scene,e)}keydown(e){27===e.keyCode&&td.cancel()}mouseMove(e){td.mouseMove(this.acs.imageAnnoApp.scene,e,p.iu.PolygonGraph)}cancel(){td.cancel()}constructor(e){super(e)}}class tF extends tG{mouseDown(e){td.mouseDown(this.acs.imageAnnoApp.scene,e,p.iu.Curve)}mouseMove(e){td.mouseMove(this.acs.imageAnnoApp.scene,e,p.iu.Curve)}constructor(e){super(e)}}class t_ extends tG{mouseDown(e){td.mouseDown(this.acs.imageAnnoApp.scene,e,p.iu.CurveClosed)}mouseMove(e){td.mouseMove(this.acs.imageAnnoApp.scene,e,p.iu.CurveClosed)}constructor(e){super(e)}}class tU extends el{mouseDown(e){X.mouseDown(this.acs.imageAnnoApp.scene,e)}mouseLeftClick(e){let t=128*this.acs.scaleGlobal;X.onMouseLeftClick(this.acs.imageAnnoApp.scene,e,t,t)}mouseMiddleClick(e){}mouseRightClick(e){X.onMouseRightClick(e)}mouseMove(e){X.onMouseMove(this.acs.imageAnnoApp.scene,e)}mouseDrag(e){X.onMouseDrag(this.acs.imageAnnoApp.scene,e)}mouseUp(e){X.onMouseUp(this.acs.imageAnnoApp.scene,e)}keydown(e){("Escape"===e.key||81===e.keyCode||13===e.keyCode)&&X.cancel()}cancel(){X.cancel()}constructor(e){super(e)}}class tq extends el{mouseDown(e){U.mouseDown(this.acs.imageAnnoApp.scene,e)}mouseLeftClick(e){let t=128*this.acs.scaleGlobal;U.onMouseLeftClick(this.acs.imageAnnoApp.scene,e,t,t)}mouseMiddleClick(e){}mouseRightClick(e){U.onMouseRightClick(e)}mouseMove(e){}mouseDrag(e){U.onMouseDrag(this.acs.imageAnnoApp.scene,e)}mouseUp(e){U.onMouseUp(this.acs.imageAnnoApp.scene,e)}keydown(e){27===e.keyCode&&U.cancel()}cancel(){U.cancel()}constructor(e){super(e)}}class tJ extends el{mouseDown(e){eA.getCircleByArea(this.acs.imageAnnoApp.scene,5e5,e.x,e.y)}mouseLeftClick(e){eA.construction&&(eA.construction.isSelected=!1,eA.construction=void 0),this.acs.imageAnnoApp.activeCommandController.goToACMode()}mouseMiddleClick(e){}mouseRightClick(e){eA.onMouseRightClick(e)}mouseMove(e){eA.onMouseMove(e)}mouseDrag(e){}keydown(e){27===e.keyCode&&eA.cancel()}constructor(e){super(e)}}class tY extends el{mouseDown(e){eA.getCircleByCircumference(this.acs.imageAnnoApp.scene,500,e.x,e.y)}mouseLeftClick(e){eA.construction&&(eA.construction.isSelected=!1,eA.construction=void 0),this.acs.imageAnnoApp.activeCommandController.goToACMode()}mouseMiddleClick(e){}mouseRightClick(e){eA.onMouseRightClick(e)}mouseMove(e){eA.onMouseMove(e)}mouseDrag(e){}keydown(e){27===e.keyCode&&eA.cancel()}constructor(e){super(e)}}class tj extends el{mouseLeftClick(e){D.mouseLeftClick(this.acs.imageAnnoApp.scene,e)}mouseMove(e){D.mouseMove(e)}mouseDoubleClick(e){D.mouseDoubleClick(this.acs.imageAnnoApp.scene,e)}mouseDown(e){D.mouseDown(this.acs.imageAnnoApp.scene,e)}keydown(e){27===e.keyCode&&D.cancel(this.acs.imageAnnoApp.scene),(81===e.keyCode||13===e.keyCode)&&D.doneByKeyboard(this.acs.imageAnnoApp.scene)}undo(){D.undo(this.acs.imageAnnoApp.scene,this.acs.m)}constructor(e){super(e)}}class tX extends el{mouseLeftClick(e){es.mouseLeftClick(this.acs.imageAnnoApp.scene,e)}mouseMove(e){es.mouseMove(this.acs.imageAnnoApp.scene,e)}mouseDoubleClick(e){es.mouseDoubleClick(this.acs.imageAnnoApp.scene,e)}mouseDown(e){es.mouseDown(this.acs.imageAnnoApp.scene,e)}keydown(e){27===e.keyCode&&es.cancel(this.acs.imageAnnoApp.scene),(81===e.keyCode||13===e.keyCode)&&es.doneByKeyboard(this.acs.imageAnnoApp.scene)}undo(){es.undo(this.acs.imageAnnoApp.scene,this.acs.m)}constructor(e){super(e)}}class tK extends el{mouseLeftClick(e){D.mouseLeftClick(this.acs.imageAnnoApp.scene,e,!0)}mouseMove(e){D.mouseMove(e)}mouseDoubleClick(e){D.mouseDoubleClick(this.acs.imageAnnoApp.scene,e)}mouseDown(e){D.mouseDown(this.acs.imageAnnoApp.scene,e,!0)}keydown(e){27===e.keyCode&&D.cancel(this.acs.imageAnnoApp.scene),(81===e.keyCode||13===e.keyCode)&&D.doneByKeyboard(this.acs.imageAnnoApp.scene)}undo(){D.undo(this.acs.imageAnnoApp.scene,this.acs.m)}constructor(e){super(e)}}class t$ extends el{mouseLeftClick(e){M.mouseLeftClick(this.acs.imageAnnoApp.scene,e)}mouseMove(e){M.mouseMove(e)}mouseDoubleClick(e){M.mouseDoubleClick(this.acs.imageAnnoApp.scene,e)}mouseDown(e){M.mouseDown(this.acs.imageAnnoApp.scene,e)}keydown(e){27===e.keyCode&&M.cancel(this.acs.imageAnnoApp.scene),(81===e.keyCode||13===e.keyCode)&&M.doneByKeyboard(this.acs.imageAnnoApp.scene)}undo(){M.undo(this.acs.imageAnnoApp.scene,this.acs.m)}constructor(e){super(e)}}class tQ extends el{mouseLeftClick(e){eV.mouseLeftClick(this.acs.imageAnnoApp.scene,e)}mouseMove(e){eV.mouseMove(this.acs.imageAnnoApp.scene,e)}mouseDoubleClick(e){eV.mouseDoubleClick(this.acs.imageAnnoApp.scene,e)}mouseDown(e){eV.mouseDown(this.acs.imageAnnoApp.scene,e)}keydown(e){27===e.keyCode&&eV.cancel(this.acs.imageAnnoApp.scene),(81===e.keyCode||13===e.keyCode)&&eV.doneByKeyboard(this.acs.imageAnnoApp.scene)}undo(){eV.undo(this.acs.imageAnnoApp.scene,this.acs.m)}constructor(e){super(e)}}class tZ extends el{}class t0 extends el{mouseLeftClick(e){M.mouseLeftClick(this.acs.imageAnnoApp.scene,e,!0)}mouseMove(e){M.mouseMove(e)}mouseDoubleClick(e){M.mouseDoubleClick(this.acs.imageAnnoApp.scene,e)}mouseDown(e){M.mouseDown(this.acs.imageAnnoApp.scene,e)}keydown(e){27===e.keyCode&&M.cancel(this.acs.imageAnnoApp.scene),(81===e.keyCode||13===e.keyCode)&&M.doneByKeyboard(this.acs.imageAnnoApp.scene)}undo(){M.undo(this.acs.imageAnnoApp.scene,this.acs.m)}constructor(e){super(e)}}class t1 extends el{mouseLeftClick(e){this.acs.imageAnnoApp.activeCommandController.IsTextEditing=!0,tr.mouseLeftClick(this.acs.imageAnnoApp.scene,e)}mouseMove(e){tr.mouseMove(e)}constructor(e){super(e)}}class t2 extends el{mouseDown(e){tc.mouseDown(this.acs.imageAnnoApp.scene,e)}mouseDrag(e){tc.mouseDrag(e)}mouseUp(e){tc.mouseUp(this.acs.imageAnnoApp.scene,e)}keydown(e){27===e.keyCode&&tc.cancel()}mouseMove(e){tc.mouseMove(this.acs.imageAnnoApp.scene,e,p.iu.Polyline)}constructor(e){super(e)}}class t5 extends t2{mouseDown(e){tc.mouseDown(this.acs.imageAnnoApp.scene,e)}mouseDrag(e){tc.mouseDrag(e)}mouseUp(e){tc.mouseUp(this.acs.imageAnnoApp.scene,e)}keydown(e){27===e.keyCode&&tc.cancel()}mouseMove(e){tc.mouseMove(this.acs.imageAnnoApp.scene,e,p.iu.Polyline,p.hO.DeepLearning)}constructor(e){super(e)}}class t3 extends el{mouseDown(e){eP.mouseDown(this.acs.imageAnnoApp.scene,e,p.zq.CN_STAR)}mouseLeftClick(e){eP.mouseLeftClick(this.acs.imageAnnoApp.scene,e,p.zq.CN_STAR)}mouseMove(e){eP.mouseMove(e)}keydown(e){27===e.keyCode&&eP.cancel()}constructor(e){super(e)}}class t9{set optimizerPoint(e){this._optimizerPoint=e,this.activeCommandController.imageAnnoApp.renderer.optimizer.typePoint=e}get optimizerPoint(){return this._optimizerPoint}set optimizerTextleaderline(e){this._optimizerTextleaderline=e,this.activeCommandController.imageAnnoApp.renderer.optimizer.typeTextleaderline=e}get optimizerTextleaderline(){return this._optimizerTextleaderline}set pressCtrlKey(e){this._pressCtrlKey=e,!1===e&&this.activeCommandController.imageAnnoApp.geometryCommon.gcmdProcessing.polygonGraphResetForSplit()}get toleranceSnapping(){return this.activeCommandController.imageAnnoApp.renderer.objectSnapping.toleranceSnapping}get pressCtrlKey(){return this._pressCtrlKey}set isPanning(e){this._isPanning=e}get isPanning(){return this._isPanning}set isZooming(e){this._isZooming=e,e||(this.needExecuteOptimizer=!0)}get isZooming(){return this._isZooming}get mapScale(){return 1}set needExecuteOptimizer(e){this._needExecuteOptimizer=e}get needExecuteOptimizer(){return this._needExecuteOptimizer}set extentChanging(e){this.activeCommandController.shiftRenderLoop(!e),this._extentChanging=e}get extentChanging(){return this._extentChanging}get zoom(){}constructor(e){this.unit=p.fb.Kilometer,this.unitEnumInt=0,this.shiftDTMode=0,this.isHiddenLog=!0,this.isTextEditing=!1,this.insideMap=!1,this.needPostACMode=!0,this.isMarkupEnv=!0,this.isReturn=!1,this.isShortCutActive=!0,this.showUnit=!1,this.showTooltip=!0,this.showActiveCommandChain=!0,this.isDrawing=!1,this.isSmartSelectionWhenDrawing=!1,this.snap=!1,this.hasMultiSel=!1,this.activateCollsion=!1,this.activateMapScale=!1,this.isDragging=!1,this.isUp=!1,this.isViewChanging=!1,this.isDown=!1,this.isClick=!1,this.clickMenu=!1,this.showTooltipPoint=!1,this.hasHovering=!1,this.isActivateSnapping=!1,this.needDuplicateByAlt=!1,this.deselectNeeded=!0,this.needrePositionTextLeaderLine=!0,this.needHideTextLeaderLine=!0,this.needCollisionDetection=!0,this.pressKey=!1,this.pressShift=!1,this.pressESC=!1,this.pressAltKey=!1,this.accentColor=!1,this.isScaleDynamicRender=!0,this.isActiveCluster=!1,this._needExecuteOptimizer=!1,this._optimizerTextleaderline=p.Nv.None,this._optimizerPoint=p.xX.None,this._pressCtrlKey=!1,this._isPanning=!1,this._isZooming=!1,this._extentChanging=!1,this.activeCommandController=e}}class t6{reset(){}updateActiveCursorByUp(e){this.activeCursor.default()}updateActiveCursorByMove(e){this.updateActiveCursor(e)}updateActiveCursorByDrag(e){if(this.ac.imageAnnoApp.scene.capture&&(this.ac.imageAnnoApp.scene.capture.type===p.zq.ANODE_RECT||this.ac.imageAnnoApp.scene.capture.type===p.zq.ANODE_CIRCLE||this.ac.imageAnnoApp.scene.capture.type===p.zq.RECTANGLE||this.ac.imageAnnoApp.scene.capture.type===p.zq.CIRCLE)){e.updateActiveCursor();return}this.setActiveCursorDrag()}setActiveCursorDrag(){this.activeCursor.dragging()}setActiveCursorHovering(){this.activeCursor.hovering()}updateActiveCursor(e){if(e===p.uA.TEXT){this.activeCursor.texting();return}e===p.uA.SELECT||e===p.uA.NONE||e===p.uA.SELECT_LASSO||e===p.uA.SELECT_RECT?(this.ac.acProperties.hasHovering&&this.ac.imageAnnoApp.implementations.app.model.appCoreWrapper.appControllerStatus.mode===p.An.Drawing||this.activeCursor.default(),this.ac.imageAnnoApp.implementations.app.model.appCoreWrapper.appControllerStatus.mode===p.An.Drawing&&this.activeCursorForText()):this.activeCursor.creating()}activeCursorForText(){for(let e=0;e<this.ac.imageAnnoApp.scene.listATextleaderlineWrapper.length;++e)this.ac.imageAnnoApp.scene.listATextleaderlineWrapper[e].isMouseInsideDiv(this.ac.m.x,this.ac.m.y)&&this.activeCursor.texting()}initActiveCursor(){this.activeCursor=new p.$b(this.ac.imageAnnoApp.implementations.app.model.modelViewWrapper.div)}setActiveCursor(e){switch(e){case p.CF.EWresize:this.activeCursor.set_ew_resize();break;case p.CF.NSresize:this.activeCursor.set_ns_resize();break;case p.CF.NESWresize:this.activeCursor.set_nesw_resize();break;case p.CF.NWSEresize:this.activeCursor.set_nwse_resize();break;case p.CF.Pointer:this.activeCursor.hovering()}}constructor(e){this.ac=e,this.initActiveCursor()}}class t4{setActiveColor(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];this.activeColor=(0,p.rW)(e),this.activeColor.length<3&&this.activeColor.push(1),this.updateColorSelGeometries(this.activeColor),this.ac.imageAnnoApp.scene.capture&&t&&this.checkChanges()}getActiveColor(){return(0,p.iC)(this.activeColor[0],this.activeColor[1],this.activeColor[2])}updateColorSelGeometries(e){this.ac.imageAnnoApp.geometryCommon.gcmdProcessing.updateColorStyle(e)}constructor(e){this.activeColor=[41,78,241,1],this.checkChanges=(0,p.Ds)(()=>{this.ac.imageAnnoApp.scene.captureScene()}),this.ac=e}}class t8{push(e){this.list.push(e),this.list.length>this.numLins&&this.list.shift()}render(e){e.textAlign=p.PH.Left,e.fillStyle="#000000",e.font="10px Arial";let t=this.list.length;for(;t--;)e.fillText("log: ".concat(this.list[t]),.2*e.canvas.width,100+30*(this.list.length-t))}constructor(e){this.numLins=10,this.list=[],this.ac=e}}class t7{setActiveColor(e){}setScaleGlobal(e){e>.5&&(this.scaleGlobal=e,this.imageAnnoApp.graphicsCoreWrapper.renderForce())}setActiveCommand(e){if(e=this.remapActiveCommandVersion(e),p.uA.SMARTDRAWING_DEEPLEARNING,this.acProperties.pressShift=!1,this.imageAnnoApp.implementations.app.model.appCoreWrapper.appControllerStatus.mode!==p.An.Drawing){this.activeCommand=this.commands[e];return}e===p.uA.SELECT||e===p.uA.NONE?this.acProperties.isDrawing=!1:this.acProperties.isDrawing=!0,this.cancelAC(),this.activeCommand=this.commands[e],this.type=e,this.activeMouseCursor.updateActiveCursorByUp(this.type),this.type===p.uA.POINT_REGULAR||this.type===p.uA.POINT_ICON||this.type===p.uA.POINT_NUMBERED||this.type===p.uA.LINE?this.acProperties.showTooltipPoint=!0:this.acProperties.showTooltipPoint=!1}goToACMode(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.postACMode;this.acProperties.needPostACMode&&(this.setActiveCommand(e),this.imageAnnoApp.io.eventListenerAnnotation.shiftCAMode(e))}set zoomLevelForMoving(e){this._zoomLevelForMoving=2+Math.floor(e/4)}get zoomLevelForMoving(){return this._zoomLevelForMoving}get postACMode(){return this._postACMode}set postACMode(e){this._postACMode=e}get IsTouchEvent(){return this._isTouchEvent}set IsTouchEvent(e){this._isTouchEvent=e}set IsTextEditing(e){this.acProperties.isTextEditing=e}get IsTextEditing(){return this.acProperties.isTextEditing}resizeCanvas(e,t){}cancelAC(){this.acProperties.pressShift=!1,this.imageAnnoApp.implementations.app.model.appCoreWrapper.appControllerStatus.mode!==p.An.ObserveViewer&&(es.cancel(this.imageAnnoApp.scene),M.cancel(this.imageAnnoApp.scene),D.cancel(this.imageAnnoApp.scene))}getCircleFromVoice(){}getRectangleFromVoice(){X.getRectangleFromVoice(this.imageAnnoApp.scene)}reUndoProcessing(e){this.imageAnnoApp.geometryCommon.gcmdProcessing.reUndoProcessing(e)}reUndoProcessingStorymaps(e){this.imageAnnoApp.geometryCommon.gcmdProcessing.reUndoProcessingStorymaps(e)}repopulateGeometries(e){this.imageAnnoApp.geometryCommon.gcmdProcessing.repopulateGeometries(e)}base64DumpIcon(e,t,s){this.base64Processing(e,t,s)}removeSelShape(){this.imageAnnoApp.geometryCommon.gcmdProcessing.removeAllCapturedGeoGroup()}base64Processing(e,t,s){e===p.Us.AddIconBase64&&void 0!==s&&this.imageAnnoApp.renderer.draw.image.addBase64(t,s),e===p.Us.SelectIconBase64&&this.imageAnnoApp.renderer.draw.image.activeBase64(t)}mousePostProcess(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sanpValue;return this.acProperties.snap&&(e.x=Math.floor(e.x/t)*t,e.y=Math.floor(e.y/t)*t),e}processingUpdate(e,t){this.imageAnnoApp.geometryCommon.gcmdProcessing.processingUpdate(e,t)}removeByIDs(e){this.imageAnnoApp.geometryCommon.gcmdProcessing.removeByIDs(e)}removeAllShapes(){this.imageAnnoApp.geometryCommon.gcmdSelecting.selectAllObjects(),this.imageAnnoApp.geometryCommon.gcmdProcessing.removeAllGeo(),this.imageAnnoApp.geometryCommon.gcmdProcessing.removeAll()}updateProjection(e){if(this.imageAnnoApp.implementations.app.model.imageWrapper.img){let t=this.imageAnnoApp.implementations.app.model.imageWrapper.projectionToImageSpace(e.x,e.y);e.x=t[0],e.y=t[1],e.x+=this.imageAnnoApp.scene.paramsEditing.croppingMaskParams.x,e.y+=this.imageAnnoApp.scene.paramsEditing.croppingMaskParams.y}}commonEvent(e){return this.updateProjection(e),this.mNoSnap=e.deepCopy(),e=this.mousePostProcess(e),this.imageAnnoApp.apiWrapper.environment.logCommon(e.x,e.y),this.m=e,e}hide(e){this.imageAnnoApp.geometryCommon.gcmdProcessing.hide(e)}unhide(e){this.imageAnnoApp.geometryCommon.gcmdProcessing.unhide(e)}setupPolylineConstraintLength(e){this.imageAnnoApp.geometryCommon.gcmdProcessing.setupPolylineConstraintLength(e)}setupPolylineConstraintLengthPercentage(e){this.imageAnnoApp.geometryCommon.gcmdProcessing.setupPolylineConstraintLengthPercentage(e)}disableExcept(e){this.imageAnnoApp.geometryCommon.gcmdProcessing.disableExcept(e)}highlight(e){this.imageAnnoApp.geometryCommon.gcmdProcessing.highlight(e)}downloadShapes(){this.imageAnnoApp.implementations.app.model.ioWrapper.download()}downloadTheme(){this.imageAnnoApp.customization.downloadTheme()}pause(){this.imageAnnoApp.implementations.app.pause()}resume(){this.imageAnnoApp.implementations.app.resume()}needPopup(){return!this.acProperties.isMarkupEnv}remapActiveCommandVersion(e){return e}shiftRenderLoop(e){if(!e&&this.imageAnnoApp.scene.listATextleaderlineWrapper.length>0){this.imageAnnoApp.graphicsCoreWrapper.canvasWrapper.aCanvas.IsRenderSkip=!1;return}this.imageAnnoApp.graphicsCoreWrapper.canvasWrapper.aCanvas.IsRenderSkip=!0}activecommandIconPoint(){this.setActiveCommand(p.uA.POINT_ICON)}setScaleGraphics(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],s=!(arguments.length>2)||void 0===arguments[2]||arguments[2],i=this.imageAnnoApp.geometryCommon.gcmdProcessing.hasMultiSel();if(i&&i.length>0)for(let s=0;s<i.length;++s)t?i[s].setScaleLocal(e):e+i[s].styleComponent.renderStyle.scaleLocal>.5&&i[s].setScaleLocal(e+i[s].styleComponent.renderStyle.scaleLocal);else t?this.imageAnnoApp.activeCommandController.setScaleGlobal(e):this.imageAnnoApp.activeCommandController.setScaleGlobal(e+this.imageAnnoApp.activeCommandController.scaleGlobal);s&&this.imageAnnoApp.scene.captureScene(),this.activeCommand.acs.imageAnnoApp.graphicsCoreWrapper.renderForce()}constructor(e){this.sanpValue=10,this.type=p.uA.NONE,this.activeBase64img="",this.scaleGlobal=1,this._isTouchEvent=!1,this._zoomLevelForMoving=2,this.acProperties=new t9(this),this.imageAnnoApp=e,this.commands={[p.uA.POINT_REGULAR]:new tN(this),[p.uA.POINT_NUMBERED]:new tk(this),[p.uA.POINT_ICON]:new tE(this),[p.uA.ARROW_SINGLE]:new tT(this),[p.uA.ARROW_DOUBLE]:new tD(this),[p.uA.CURVE_OPEN]:new tz(this),[p.uA.CURVE_CLOSE]:new tM(this),[p.uA.POLYLINE]:new tj(this),[p.uA.POLYLINE_CONSTRAINT]:new tK(this),[p.uA.POLYLINE_BENDING]:new tX(this),[p.uA.POLYGON]:new t$(this),[p.uA.POLYGON_GRAPH]:new tQ(this),[p.uA.POLYGON_CONSTRAINT]:new t0(this),[p.uA.POLYGON_MULTIPLE]:new tZ(this),[p.uA.TEXT_LEADERLINE]:new t1(this),[p.uA.FREEHAND_POLYLINE]:new tG(this),[p.uA.FREEHAND_POLYLINE_BENDING]:new tW(this),[p.uA.FREEHAND_POLYGON]:new tB(this),[p.uA.FREEHAND_POLYGON_GRAPH]:new tH(this),[p.uA.FREEHAND_CURVE]:new tF(this),[p.uA.FREEHAND_CURVE_CLOSED]:new t_(this),[p.uA.SMARTDRAWING]:new t2(this),[p.uA.SMARTDRAWING_DEEPLEARNING]:new t5(this),[p.uA.NONE]:new ep(this),[p.uA.SELECT]:new em(this),[p.uA.REMOVE]:new ed(this),[p.uA.SELECT_RECT]:new eu(this),[p.uA.SELECT_LASSO]:new eg(this),[p.uA.RECTANGLE]:new tU(this),[p.uA.STAR]:new t3(this),[p.uA.CIRCLE]:new tq(this),[p.uA.CIRCLE_CONSTRAINT_AREA]:new tJ(this),[p.uA.CIRCLE_CONSTRAINT_CIRCUMFERENCE]:new tY(this)},this.m=new d.$E,this.mNoSnap=this.m.deepCopy(),this.activeCommand=new ep(this),this.screenLog=new t8(this),this.postACMode=p.uA.SELECT,this.activeMouseCursor=new t6(this),this.activeColorController=new t4(this),this.setActiveCommand(p.uA.SELECT)}}class se{downloadImag(){let e=document.createElement("a");e.download="filename.png",e.href=this.gcmd.annotationInstance.graphicsCoreWrapper.canvasWrapper.aCanvas.canvas.toDataURL("image/jpeg"),e.click()}computeBoundaryFromGeos(e){let t=[];for(let s=0;s<e.length;++s){let i=e[s].getBoundary();for(let e=0;e<i.length;++e)t.push(i[e])}return(0,p.HP)(t)}pasteSelGeoInPlace(e,t){let s=this.gcmd.annotationInstance.scene.copyPasteGeo.length;if(0!==s){if(1===s){this.gcmd.annotationInstance.scene.copyPasteGeo[0].deepCopy(this.gcmd.annotationInstance.scene.copyPasteGeo[0].vec.x+e,this.gcmd.annotationInstance.scene.copyPasteGeo[0].vec.y+t);return}for(;s--;)if(this.gcmd.annotationInstance.scene.copyPasteGeo[s]){let i=this.gcmd.annotationInstance.scene.copyPasteGeo[s];i.isSelectedValue=!1;let n=this.gcmd.annotationInstance.scene.copyPasteGeo[s].deepCopy(i.v.x+e,i.v.y+t);n&&(n.isSelected=!0,n.isHover=!0)}this.gcmd.annotationInstance.activeCommandController.setActiveCommand(p.uA.NONE)}}pasteSelGeo(e,t){let s=this.gcmd.annotationInstance.scene.copyPasteGeo.length;if(0===s)return;if(1===s){this.gcmd.annotationInstance.scene.copyPasteGeo[0].deepCopy(e,t);return}let i=(0,p.hW)();for(;s--;)i.Add(this.gcmd.annotationInstance.scene.copyPasteGeo[s].v);for(s=this.gcmd.annotationInstance.scene.copyPasteGeo.length,i.x=e-i.x/s,i.y=t-i.y/s;s--;)if(this.gcmd.annotationInstance.scene.copyPasteGeo[s]){let e=this.gcmd.annotationInstance.scene.copyPasteGeo[s];e.isSelectedValue=!1;let t=this.gcmd.annotationInstance.scene.copyPasteGeo[s].deepCopy(e.v.x+i.x,e.v.y+i.y);t&&(t.isSelected=!0)}this.gcmd.gcmdSelecting.deSelectCaptureObjects()}getCanvas(){return this.gcmd.annotationInstance.graphicsCoreWrapper.canvasWrapper.aCanvas.ctx.canvas}constructor(e){this.gcmd=e}}class st{get width(){return+this.gcmd.annotationInstance.implementations.app.model.modelViewWrapper.divHost.style.width.split("px")[0]}get height(){return+this.gcmd.annotationInstance.implementations.app.model.modelViewWrapper.divHost.style.height.split("px")[0]}rightClickOnHoverGeo(e){let t=this.gcmd.annotationInstance.scene.geometryList.length;for(;t--;)if(this.gcmd.annotationInstance.scene.geometryList[t].isHover)return this.gcmd.annotationInstance.scene.geometryList[t].mouseRightClick(e),!0;return!1}updatePopup(){}moveSelectedGeoPreSmartVersionBetweenGeometryAndNodes(e){}moveSelectedGeo(e){for(let t=0;t<this.gcmd.annotationInstance.scene.geometryList.length;++t)if(this.gcmd.annotationInstance.scene.geometryList[t].isCapturedValue||this.gcmd.annotationInstance.scene.geometryList[t].isSelected&&this.gcmd.annotationInstance.scene.geometryList[t].type!==p.zq.CNODE&&this.gcmd.annotationInstance.scene.geometryList[t].type!==p.zq.CNODE_CIRCLE){let s=this.gcmd.annotationInstance.scene.geometryList[t].findClosestNode(e.x,e.y);null!=s?(s.translateByMouseEventData(e),this.gcmd.annotationInstance.scene.Capture=s):this.gcmd.annotationInstance.scene.geometryList[t].translateByMouseEventData(e)}}moveMidPoint(e){}removeAllGeo(){let e=A.list.length;if(0===e)return;for(;e--;)A.list[e].remove();let t=this.gcmd.annotationInstance.scene.geometryList.length;if(0!==t)for(;t--;)this.gcmd.annotationInstance.scene.geometryList[t].remove()}resetTranformation(){let e=this.gcmd.annotationInstance.scene.geometryList.length;if(0!==e)for(;e--;)this.gcmd.annotationInstance.scene.geometryList[e].isTransform=!1}checkAttachedTextleaderline(e){return e.type===p.zq.POLYGON_GRAPH||e.type===p.zq.POLYLINE_BENDING?e.checkAttachedTextleaderline():e.type===p.zq.RECTANGLE?e.checkAttachedTextleaderline():e.type===p.zq.CIRCLE?e.CheckAttachedTextleaderline():!(e.textLeaderline&&e.textLeaderline.leaderline&&(0,p.Sp)(e.textLeaderline.leaderline.v2,e.vec)>5)||(e.textLeaderline.attachedShape=void 0,e.textLeaderline=void 0,!1)}processSelectionViewerMode(){let e=this.gcmd.annotationInstance.scene.geometryList.length;if(this.gcmd.annotationInstance.scene.capture)for(;e--;)this.gcmd.annotationInstance.scene.capture===this.gcmd.annotationInstance.scene.geometryList[e]?this.gcmd.annotationInstance.scene.geometryList[e].isSelectedValue=!0:this.gcmd.annotationInstance.scene.geometryList[e].isSelectedValue=!1;else for(;e--;)this.gcmd.annotationInstance.scene.geometryList[e].isSelectedValue=!1}polygonGraphResetForSplit(){let e=this.gcmd.annotationInstance.scene.listAPolygonGraphWrapper.length;for(;e--;)this.gcmd.annotationInstance.scene.listAPolygonGraphWrapper[e].polygonGraphResetForSplit()}copySelGeo(){this.gcmd.annotationInstance.scene.copyPasteGeo=[];let e=this.gcmd.annotationInstance.scene.geometryList.length;for(;e--;)(this.gcmd.annotationInstance.scene.geometryList[e].isSelected||this.gcmd.annotationInstance.scene.geometryList[e].isHoverValue)&&this.gcmd.annotationInstance.scene.copyPasteGeo.push(this.gcmd.annotationInstance.scene.geometryList[e]);this.gcmd.annotationInstance.activeCommandController.setActiveCommand(p.uA.NONE)}toMapConvertGeoDis(e,t,s){let i=this.gcmd.gcmdSupporting.toMap(e+s/1,t);return[i[0],i[1]][0]-e}setCaptureHovered(e){e!==this.gcmd.annotationInstance.scene.captureHovered&&(this.gcmd.annotationInstance.scene.captureHovered=e)}getHashColor(e){for(;;){let t=(0,p.kt)();if(!this.gcmd.annotationInstance.scene.listHashColor[t])return this.gcmd.annotationInstance.scene.listHashColor[t]=e,t}}getShapeByHashCol(e){return this.gcmd.annotationInstance.scene.listHashColor[e]}isMouseInsideByOffScreenNumberPoint(e,t,s){let i=this.pickColorsOffscreen(e,t,3,3);return!!(30>(0,p.Sm)(i[0],i[1],i[2],s[0],s[1],s[2])||30>(0,p.Sm)(i[4],i[5],i[6],s[0],s[1],s[2])||30>(0,p.Sm)(i[8],i[9],i[10],s[0],s[1],s[2])||30>(0,p.Sm)(i[12],i[13],i[14],s[0],s[1],s[2])||30>(0,p.Sm)(i[16],i[17],i[18],s[0],s[1],s[2])||30>(0,p.Sm)(i[20],i[21],i[22],s[0],s[1],s[2])||30>(0,p.Sm)(i[24],i[25],i[26],s[0],s[1],s[2])||30>(0,p.Sm)(i[28],i[29],i[30],s[0],s[1],s[2])||30>(0,p.Sm)(i[32],i[33],i[34],s[0],s[1],s[2]))}isMouseInsideByOffScreen(e,t,s){let i=this.pickColorOffscreen(e,t);return!!this.getShapeByHashCol(i)&&i===s}getClosestNodeForSnapping(e,t,s){let i=new p.h9(e,t),n=this.gcmd.annotationInstance.scene.listBasePoint.length,o=-1;for(;n--;){if(this.gcmd.annotationInstance.scene.listBasePoint[n].isCollapse)continue;if(this.gcmd.annotationInstance.scene.listBasePoint[n].type===p.zq.AMIDPOINT){let e=this.gcmd.annotationInstance.scene.listBasePoint[n];if(e.aEdges[0]&&e.aEdges[0].pGraph.type===p.zq.POLYLINE_BENDING)continue}let e=(0,p.Sp)(this.gcmd.annotationInstance.scene.listBasePoint[n].vec,i);e<s&&(s=e,o=n)}for(n=this.gcmd.annotationInstance.scene.listARectangleWrapper.length;n--;){let e=this.gcmd.annotationInstance.scene.listARectangleWrapper[n];if(e.updateLeaderlineSnap(i,s),e.vecSelectedSnapping){if(5>(0,p.Sp)(e.vecSelectedSnapping,i))return e;e.vecSelectedSnapping=void 0}}for(n=this.gcmd.annotationInstance.scene.listACircleWrapperr.length;n--;){let e=this.gcmd.annotationInstance.scene.listACircleWrapperr[n];if(e.updateLeaderlineSnap(i,s),e.vecSelectedSnapping){if(5>(0,p.Sp)(e.vecSelectedSnapping,i))return e;e.vecSelectedSnapping=void 0}}if(o>-1)return this.gcmd.annotationInstance.scene.listBasePoint[o];for(n=this.gcmd.annotationInstance.scene.listAPolygonGraphWrapper.length;n--;){let e=this.gcmd.annotationInstance.scene.listAPolygonGraphWrapper[n].getclosestNode(i,s);if(e)return e}}pickColorsOffscreen(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return this.gcmd.annotationInstance.renderer.ctxOffscreen.getImageData(e,t,s,i).data}pickColorOffscreen(e,t){let s=this.pickColorsOffscreen(e,t);return"rgb(".concat(s[0],",").concat(s[1],",").concat(s[2],")")}getSelGeo(){let e=[],t=this.gcmd.annotationInstance.scene.geometryList.length;for(;t--;)this.gcmd.annotationInstance.scene.geometryList[t].isSelected&&e.push(this.gcmd.annotationInstance.scene.geometryList[t]);return e}getGeoById(e){let t=this.gcmd.annotationInstance.scene.geometryList.length;for(;t--;)if(this.gcmd.annotationInstance.scene.geometryList[t].id===e)return this.gcmd.annotationInstance.scene.geometryList[t]}getRPointtById(e){let t=this.gcmd.annotationInstance.scene.listRPoint.length;for(;t--;)if(this.gcmd.annotationInstance.scene.listRPoint[t].id===e)return this.gcmd.annotationInstance.scene.listRPoint[t]}updateIconPoint(e,t){let s=this.getRPointtById(e);s&&(s.updateIcon(t),this.gcmd.gcmdSupporting.renderForce())}duplicateByDragging(){if(this.gcmd.annotationInstance.scene.Capture){let e=this.gcmd.annotationInstance.scene.Capture.deepCopy(this.gcmd.annotationInstance.scene.Capture.vec.x,this.gcmd.annotationInstance.scene.Capture.vec.y);this.gcmd.annotationInstance.scene.Capture.isHover=!1,this.gcmd.annotationInstance.scene.Capture.isSelected=!1,e&&(e.isHover=!0,this.gcmd.annotationInstance.scene.Capture=e)}let e=this.hasMultiSel();if(void 0!==e)for(let t of e){t.isSelected=!1,t.isHover=!1;let e=t.deepCopy(t.vec.x,t.vec.y);e&&(e.isSelected=!0,e.isHover=!0)}}getSelectedGeoIDs(){let e=[];for(let t=0;t<this.gcmd.annotationInstance.scene.geometryList.length;++t)this.gcmd.annotationInstance.scene.geometryList[t].type!==p.zq.ANODE_RECT&&this.gcmd.annotationInstance.scene.geometryList[t].type!==p.zq.ANODE_CIRCLE&&this.gcmd.annotationInstance.scene.geometryList[t].isSelectedValue&&e.push(this.gcmd.annotationInstance.scene.geometryList[t].id);return e}processingUpdate(e,t){let s=this.getGeoById(e);s&&s.type===p.zq.TEXT_LEADERLINE&&s.processingUpdate(t)}removeByIDs(e){let t=[];JSON.parse(e).forEach(e=>{let s=this.getGeoById(e);if(s){let e=s.toJSON();e&&(t.push(e),s.remove(!1))}}),this.gcmd.annotationInstance.io.eventListenerAnnotation.removeGeometryStack(t),this.gcmd.gcmdSupporting.renderForce()}removeBeforeDump(){this.gcmd.gcmdSelecting.deSelectAllObjects(),this.removeAllCapturedGeo();let e=this.gcmd.annotationInstance.scene.listATextleaderlineWrapper.length;for(;e--;)this.gcmd.annotationInstance.scene.listATextleaderlineWrapper[e]&&this.gcmd.annotationInstance.scene.listATextleaderlineWrapper[e].removeDiv();this.removeAllDiv(),this.resetGeometryList()}reUndoProcessing(e){this.removeBeforeDump(),e.forEach(e=>{this.getGeoByIOGeometry(e,!0)}),this.initConnectionTextleaderlines(),this.gcmd.annotationInstance.activeCommandController.acProperties.needExecuteOptimizer=!0,this.gcmd.gcmdSupporting.renderForce()}reUndoProcessingStorymaps(e){this.removeBeforeDump(),e.forEach(e=>{this.getGeoByIOGeometry(e,!0)}),this.initConnectionTextleaderlines(),this.gcmd.annotationInstance.activeCommandController.acProperties.needExecuteOptimizer=!0,this.gcmd.gcmdSupporting.renderForce()}hide(e){let t=e.length;for(;t--;)for(let s=0;s<this.gcmd.annotationInstance.scene.geometryList.length;++s)this.gcmd.annotationInstance.scene.geometryList[s].id===e[t]&&(this.gcmd.annotationInstance.scene.geometryList[s].isRenderable=!1,this.gcmd.annotationInstance.scene.geometryList[s].isHidden=!0,this.gcmd.annotationInstance.scene.geometryList[s].visibility=0)}unhide(e){let t=e.length;for(;t--;)for(let s=0;s<this.gcmd.annotationInstance.scene.geometryList.length;++s)this.gcmd.annotationInstance.scene.geometryList[s].id===e[t]&&(this.gcmd.annotationInstance.scene.geometryList[s].isRenderable=!0,this.gcmd.annotationInstance.scene.geometryList[s].isHidden=!1,this.gcmd.annotationInstance.scene.geometryList[s].visibility=1)}setupPolylineConstraintLength(e){this.gcmd.annotationInstance.scene.capture&&this.gcmd.annotationInstance.scene.capture.type===p.zq.POLYLINE&&(this.gcmd.annotationInstance.scene.capture.constraintTargetDistance=(e+1)*50)}setupPolylineConstraintLengthPercentage(e){this.gcmd.annotationInstance.scene.capture&&this.gcmd.annotationInstance.scene.capture.type===p.zq.POLYLINE&&(this.gcmd.annotationInstance.scene.capture.constraintTargetDistancePercentage=e)}disableExcept(e){let t=[];for(let s=0;s<e.length;++s)t.push(this.getGeoById(e[s]));for(let e=0;e<t.length;++e)for(let s=0;s<this.gcmd.annotationInstance.scene.geometryList.length;++s)this.gcmd.annotationInstance.scene.geometryList[s]===t[e]?this.gcmd.annotationInstance.scene.geometryList[s].disable=!1:this.gcmd.annotationInstance.scene.geometryList[s].disable=!0}highlight(e){this.gcmd.annotationInstance.renderer.needFocus=!0;for(let t=0;t<this.gcmd.annotationInstance.scene.geometryList.length;++t)this.gcmd.annotationInstance.scene.geometryList[t].id===e?(this.gcmd.annotationInstance.scene.geometryList[t].isSelected=!0,this.gcmd.annotationInstance.scene.geometryList[t].isHover=!0):(this.gcmd.annotationInstance.scene.geometryList[t].isSelected=!1,this.gcmd.annotationInstance.scene.geometryList[t].isHover=!1)}autoSnappingTracker(e){return this.gcmd.annotationInstance.renderer.objectSnapping.autoSnappingTracker(e,!1)}autoSnapping(e){return this.gcmd.annotationInstance.renderer.objectSnapping.autoSnappingTracker(e,!0)}getPosBySnapping(e,t,s){let i=15,n=new p.h9(e,t),o=new p.h9(e,t),r=this.gcmd.annotationInstance.scene.geometryList.length;for(;r--;){let e=this.gcmd.annotationInstance.scene.geometryList[r].needSnapping(o);e[0]&&e[1]&&e[0]>0&&e[0]<i&&(i=e[0],n=e[1])}return i<s&&(e=n.x,t=n.y),[e,t]}repopulateGeometries(e){for(let t in this.removeAll(),e)if(e[t]){let s=e[t];this.getGeoByIOGeometry(s,!1,!0)}this.initConnectionTextleaderlines(),this.gcmd.gcmdSupporting.renderForce()}removeAll(e){let t=this.gcmd.annotationInstance.scene.listATextleaderlineWrapper.length;for(;t--;)this.gcmd.annotationInstance.scene.listATextleaderlineWrapper[t]&&this.gcmd.annotationInstance.scene.listATextleaderlineWrapper[t].removeDiv();for(t=this.gcmd.annotationInstance.scene.geometryList.length;t--;)this.gcmd.annotationInstance.scene.geometryList[t]&&this.gcmd.annotationInstance.scene.geometryList[t].remove(e);this.removeAllDiv(),this.resetGeometryList(),this.gcmd.gcmdSupporting.renderForce()}removeAllDiv(){for(let e=0;e<this.gcmd.annotationInstance.implementations.app.model.modelViewWrapper.div.childElementCount;++e)this.gcmd.annotationInstance.implementations.app.model.modelViewWrapper.div.lastChild&&this.gcmd.annotationInstance.implementations.app.model.modelViewWrapper.div.lastChild instanceof HTMLDivElement&&this.gcmd.annotationInstance.implementations.app.model.modelViewWrapper.div.lastChild.remove()}removeAllPopup(){for(let e=0;e<this.gcmd.annotationInstance.implementations.app.model.modelViewWrapper.div.childElementCount;++e)this.gcmd.annotationInstance.implementations.app.model.modelViewWrapper.div.lastChild&&this.gcmd.annotationInstance.implementations.app.model.modelViewWrapper.div.lastChild instanceof HTMLDivElement&&this.gcmd.annotationInstance.implementations.app.model.modelViewWrapper.div.lastChild.id.includes("pa")&&this.gcmd.annotationInstance.implementations.app.model.modelViewWrapper.div.lastChild.remove();for(let e=0;e<this.gcmd.annotationInstance.scene.geometryList.length;++e)this.gcmd.annotationInstance.scene.geometryList[e].hasPopup&&this.gcmd.annotationInstance.scene.geometryList[e].hidePopUpSummary()}initConnectionTextleaderlines(){let e=this.gcmd.annotationInstance.scene.listATextleaderlineWrapper.length;for(;e--;)void 0!==this.gcmd.annotationInstance.scene.listATextleaderlineWrapper[e].leaderline&&this.gcmd.annotationInstance.scene.listATextleaderlineWrapper[e].initSnapForPointForUndo()}resetGeometryList(){this.gcmd.annotationInstance.scene.geometryList=[],this.gcmd.annotationInstance.scene.listATextleaderlineWrapper=[],this.gcmd.annotationInstance.scene.listBasePoint=[],this.gcmd.annotationInstance.scene.listAPoint=[],this.gcmd.annotationInstance.scene.listAArrow=[],this.gcmd.annotationInstance.scene.listIPoint=[],this.gcmd.annotationInstance.scene.listRPoint=[],this.gcmd.annotationInstance.scene.listNPoint=[],this.gcmd.annotationInstance.scene.listACircleWrapperr=[],this.gcmd.annotationInstance.scene.listARectangleWrapper=[],this.gcmd.annotationInstance.scene.listAPolylineWrapper=[],this.gcmd.annotationInstance.scene.listAPolygonGraphWrapper=[],this.gcmd.annotationInstance.scene.listAPolygonWrapper=[],this.gcmd.annotationInstance.scene.listAPolylineGraphWrapper=[],this.gcmd.annotationInstance.scene.listACurve=[],this.gcmd.annotationInstance.scene.listALog=[]}removeCapturedTextLeaderline(){let e=this.gcmd.annotationInstance.scene.listATextleaderlineWrapper.length;for(;e--;)this.gcmd.annotationInstance.scene.listATextleaderlineWrapper[e].isSelected&&this.gcmd.annotationInstance.scene.listATextleaderlineWrapper[e].remove();this.gcmd.gcmdSupporting.renderForce()}DumpByIGeometriesFromImageDataModel(e){for(let t=0;t<e.length;++t)this.getGeoByIOGeometry(e[t],!0)}DumpByIGeometries(e){for(let t=0;t<e.length;++t)this.getGeoByIOGeometry(e[t],!0)}getGeoByIOGeometry(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];void 0!==e&&(e.type===p.zq.POINT_REGULAR?tO.fromJSON(this.gcmd.annotationInstance.scene,e,t,s):e.type===p.zq.POINT_NUMBERED?tx.FromJSON(this.gcmd.annotationInstance.scene,e,t,s):e.type===p.zq.CIRCLE?U.fromJSON(this.gcmd.annotationInstance.scene,e,t,s):e.type===p.zq.RECTANGLE?X.fromJSON(this.gcmd.annotationInstance.scene,e,t,s):e.type===p.zq.POLYLINE?D.fromJSON(this.gcmd.annotationInstance.scene,e,t,s):e.type===p.zq.POLYLINE_BENDING?es.fromJSON(this.gcmd.annotationInstance.scene,e,t,s):e.type===p.zq.POLYGON?M.fromJSON(this.gcmd.annotationInstance.scene,e,t,s):e.type===p.zq.POLYGON_GRAPH?eV.fromJSON(this.gcmd.annotationInstance.scene,e,t,s):e.type===p.zq.POINT_ICON?tv.fromJSON(this.gcmd.annotationInstance.scene,e,t,s):e.type===p.zq.ARROW_SINGLE?eH.fromJSON(this.gcmd.annotationInstance.scene,e,t,s,!0):e.type===p.zq.ARROW_DOUBLE?eH.fromJSON(this.gcmd.annotationInstance.scene,e,t,s,!1):e.type===p.zq.CURVE_OPEN?eE.fromJSON(this.gcmd.annotationInstance.scene,e,t,s):e.type===p.zq.CURVE_CLOSE?eE.fromJSON(this.gcmd.annotationInstance.scene,e,t,s,!0):e.type===p.zq.TEXT_LEADERLINE&&tr.fromJSON(this.gcmd.annotationInstance.scene,e,t,s))}hasMultiSel(){let e=this.gcmd.annotationInstance.scene.geometryList.length,t=[];for(;e--;)!this.gcmd.annotationInstance.scene.geometryList[e].isUnderConstruction&&this.gcmd.annotationInstance.scene.geometryList[e].isSelectedValue&&t.push(this.gcmd.annotationInstance.scene.geometryList[e]);if(t)return this.gcmd.annotationInstance.scene.captureMultiple=t,t;this.gcmd.annotationInstance.scene.captureMultiple=void 0}updateStyleCustom(e){let t=[];for(let s=0;s<e.length;++s)for(let i=0;i<this.gcmd.annotationInstance.scene.geometryList.length;++i){let n=this.gcmd.annotationInstance.scene.geometryList[i];if(n.id===e[s].id&&n.updateStyleCustom(e[s].style)){let e=n.toJSON();e&&t.push(e)}}t.length>0&&this.gcmd.annotationInstance.io.eventListenerAnnotation.transformStack(t),this.gcmd.gcmdSupporting.renderForce()}setSizeRPoint(e){for(let t=0;t<this.gcmd.annotationInstance.scene.listRPoint.length;++t)this.gcmd.annotationInstance.scene.listRPoint[t].size=e;this.gcmd.annotationInstance.geometryCommon.gcmdSupporting.renderForce()}setRenderTypePoint(e){if(p.oW.hasOwnProperty(e))for(let t=0;t<this.gcmd.annotationInstance.scene.listRPoint.length;++t)this.gcmd.annotationInstance.scene.listRPoint[t].renderer.pointRenderType=e,this.gcmd.annotationInstance.scene.listRPoint[t].styleComponent.renderStyle.url="";else if("string"==typeof e)for(let t=0;t<this.gcmd.annotationInstance.scene.listRPoint.length;++t)this.gcmd.annotationInstance.scene.listRPoint[t].renderer.pointRenderType=p.oW.Image,this.gcmd.annotationInstance.scene.listRPoint[t].styleComponent.renderStyle.url=e;this.gcmd.annotationInstance.geometryCommon.gcmdSupporting.renderForce()}findAtPointFromAPoint(e){for(let t=this.gcmd.annotationInstance.scene.listBasePoint.length-1;t>=0;--t)if(this.gcmd.annotationInstance.scene.listBasePoint[t].isSelectable&&this.gcmd.annotationInstance.scene.listBasePoint[t].isMouseInside(e.x,e.y))return this.gcmd.annotationInstance.scene.listBasePoint[t]}findAtPointFromPolygonGraph(e){for(let e=this.gcmd.annotationInstance.scene.listAPolygonGraphWrapper.length-1;e>=0;--e)if(this.gcmd.annotationInstance.scene.listAPolygonGraphWrapper[e].isSelectable){if(void 0!==this.gcmd.annotationInstance.scene.listAPolygonGraphWrapper[e].getVecForSnapping())return this.gcmd.annotationInstance.scene.listAPolygonGraphWrapper[e];this.gcmd.annotationInstance.scene.listAPolygonGraphWrapper[e].graphCore.selVec=void 0,this.gcmd.annotationInstance.scene.listAPolygonGraphWrapper[e].graphCore.selectedVec=void 0,this.gcmd.annotationInstance.scene.listAPolygonGraphWrapper[e].graphCore.selVecForTextLeaderline=void 0}}findAtPointByTouch(e){let t=[];for(let s=this.gcmd.annotationInstance.scene.geometryList.length-1;s>=0;--s)this.gcmd.annotationInstance.scene.geometryList[s].type===p.zq.POINT_REGULAR?(this.gcmd.annotationInstance.scene.geometryList[s].isSelectable&&this.gcmd.annotationInstance.scene.geometryList[s].isHoverValue||this.gcmd.annotationInstance.scene.geometryList[s].isMouseInside(e.x,e.y))&&t.push(this.gcmd.annotationInstance.scene.geometryList[s]):this.gcmd.annotationInstance.scene.geometryList[s].isSelectable&&this.gcmd.annotationInstance.scene.geometryList[s].isMouseInside(e.x,e.y)&&t.push(this.gcmd.annotationInstance.scene.geometryList[s]);let s=[];for(let t=0;t<this.gcmd.annotationInstance.scene.listNPoint.length;++t)this.gcmd.annotationInstance.scene.listNPoint[t].isMouseInsideWithTolerance(e.x,e.y,50)&&s.push(this.gcmd.annotationInstance.scene.listNPoint[t]);for(let t=0;t<this.gcmd.annotationInstance.scene.listRPoint.length;++t)this.gcmd.annotationInstance.scene.listRPoint[t].isMouseInsideWithTolerance(e.x,e.y,50)&&s.push(this.gcmd.annotationInstance.scene.listRPoint[t]);if(s.length>0){let i=-1,n=Number.MAX_SAFE_INTEGER;for(let o=0;o<s.length;++o){let r=s[o].distance(e.x,e.y+11*s[o].scaleForRender);r<n&&(n=r,i=o),t=[s[i]]}}let i=!1;if(t.length>1)for(let e=0;e<t.length;++e)(t[e].type===p.zq.CIRCLE||t[e].type===p.zq.RECTANGLE||t[e].type===p.zq.POLYLINE||t[e].type===p.zq.POLYGON||t[e].type===p.zq.POLYGON_GRAPH||t[e].type===p.zq.CN_GON||t[e].type===p.zq.CN_STAR)&&(i=!0);let n=[];if(i){for(let e=0;e<t.length;++e)n.push(Math.abs(t[e].getArea()));return t[(0,p.Cv)(n)]}for(let s=0;s<t.length;++s)if(t[s].isSelectable&&t[s].isMouseInside(e.x,e.y))return t[s]}findAtPoint(e){let t=[];for(let s=this.gcmd.annotationInstance.scene.geometryList.length-1;s>=0;--s)if(this.gcmd.annotationInstance.scene.geometryList[s].type===p.zq.POINT_REGULAR){if(this.gcmd.annotationInstance.scene.geometryList[s].isSelectable&&this.gcmd.annotationInstance.scene.geometryList[s].isHoverValue||this.gcmd.annotationInstance.scene.geometryList[s].isMouseInside(e.x,e.y)){if(this.gcmd.annotationInstance.scene.geometryList[s].type!==p.zq.POLYGON&&this.gcmd.annotationInstance.scene.geometryList[s].type!==p.zq.POLYGON_GRAPH&&this.gcmd.annotationInstance.scene.geometryList[s].type!==p.zq.CIRCLE&&this.gcmd.annotationInstance.scene.geometryList[s].type!==p.zq.CCURVE_CLOSED&&this.gcmd.annotationInstance.scene.geometryList[s].type!==p.zq.RECTANGLE&&this.gcmd.annotationInstance.scene.geometryList[s].type!==p.zq.CN_GON&&this.gcmd.annotationInstance.scene.geometryList[s].type!==p.zq.CN_STAR&&this.gcmd.annotationInstance.scene.geometryList[s].type!==p.zq.POLYGON_MULTIPLE)return this.gcmd.annotationInstance.scene.geometryList[s];t.push(this.gcmd.annotationInstance.scene.geometryList[s])}}else if(this.gcmd.annotationInstance.scene.geometryList[s].isSelectable&&this.gcmd.annotationInstance.scene.geometryList[s].isMouseInside(e.x,e.y)){if(this.gcmd.annotationInstance.scene.geometryList[s].type!==p.zq.POLYGON&&this.gcmd.annotationInstance.scene.geometryList[s].type!==p.zq.POLYGON_GRAPH&&this.gcmd.annotationInstance.scene.geometryList[s].type!==p.zq.CIRCLE&&this.gcmd.annotationInstance.scene.geometryList[s].type!==p.zq.CCURVE_CLOSED&&this.gcmd.annotationInstance.scene.geometryList[s].type!==p.zq.RECTANGLE&&this.gcmd.annotationInstance.scene.geometryList[s].type!==p.zq.CN_GON&&this.gcmd.annotationInstance.scene.geometryList[s].type!==p.zq.CN_STAR&&this.gcmd.annotationInstance.scene.geometryList[s].type!==p.zq.POLYGON_MULTIPLE)return this.gcmd.annotationInstance.scene.geometryList[s];t.push(this.gcmd.annotationInstance.scene.geometryList[s])}let s=!1;if(t.length>1)for(let e=0;e<t.length;++e)(t[e].type===p.zq.CIRCLE||t[e].type===p.zq.RECTANGLE||t[e].type===p.zq.POLYLINE||t[e].type===p.zq.POLYGON||t[e].type===p.zq.POLYGON_GRAPH||t[e].type===p.zq.CN_GON||t[e].type===p.zq.CN_STAR)&&(s=!0);let i=[];if(s){for(let e=0;e<t.length;++e)i.push(Math.abs(t[e].getArea()));return t[(0,p.Cv)(i)]}for(let s=0;s<t.length;++s)if(t[s].isSelectable&&t[s].isMouseInside(e.x,e.y))return t[s]}hasSelectedOvered(){let e=this.gcmd.annotationInstance.scene.geometryList.length;for(;e--;)if(this.gcmd.annotationInstance.scene.geometryList[e].isSelected||this.gcmd.annotationInstance.scene.geometryList[e].isHoverValue)return!0;return!1}doneDragging(){let e=this.gcmd.annotationInstance.scene.geometryList.length;for(;e--;)!0===this.gcmd.annotationInstance.scene.geometryList[e].isDrag&&(this.gcmd.annotationInstance.scene.geometryList[e].isDrag=!1)}removeAllCapturedGeo(){this.gcmd.gcmdSupporting.renderForce();let e=this.gcmd.annotationInstance.scene.listBasePoint.length;for(;e--;)this.gcmd.annotationInstance.scene.listBasePoint[e]&&!0===this.gcmd.annotationInstance.scene.listBasePoint[e].isSelected&&this.gcmd.annotationInstance.scene.listBasePoint[e].remove();let t=this.gcmd.annotationInstance.scene.geometryList.length;if(0!==t){for(;t--;)void 0!==this.gcmd.annotationInstance.scene.geometryList[t]&&null!==this.gcmd.annotationInstance.scene.geometryList[t]&&!0===this.gcmd.annotationInstance.scene.geometryList[t].isSelected&&(this.gcmd.annotationInstance.scene.geometryList[t].type,p.zq.CLINE,this.gcmd.annotationInstance.scene.geometryList[t].remove());for(let e of this.gcmd.annotationInstance.scene.geometryList)!0===e.isSelected&&(e.isSelected=!1)}}reorderNumberedPoints(e){for(let e=0;e<this.gcmd.annotationInstance.scene.listNPoint.length;++e)this.gcmd.annotationInstance.scene.listNPoint[e].numberIndexNeeded=!0;let t=[],s=1;for(;e.length;){let i=e[0];e.shift();for(let e=0;e<this.gcmd.annotationInstance.scene.listNPoint.length;++e)this.gcmd.annotationInstance.scene.listNPoint[e].numberIndexNeeded&&this.gcmd.annotationInstance.scene.listNPoint[e].id===i&&(this.gcmd.annotationInstance.scene.listNPoint[e].numberIndexNeeded=!1,this.gcmd.annotationInstance.scene.listNPoint[e].numberIndex=s++,t.push(this.gcmd.annotationInstance.scene.listNPoint[e]))}this.gcmd.annotationInstance.scene.listNPoint=t}removeAllCapturedGeoGroup(){if(this.gcmd.annotationInstance.scene.capture){if(this.gcmd.annotationInstance.scene.capture.type&&this.gcmd.annotationInstance.scene.capture.type===p.zq.POLYGON_GRAPH&&this.gcmd.annotationInstance.scene.capture.graphCore.selVec){this.gcmd.annotationInstance.scene.capture.remove(!1);return}if(this.gcmd.annotationInstance.scene.capture.type&&this.gcmd.annotationInstance.scene.capture.type===p.zq.ANODE){this.gcmd.annotationInstance.scene.capture.remove();return}}let e=this.hasMultiSel();if(this.gcmd.annotationInstance.scene.capture&&this.gcmd.annotationInstance.scene.capture.type===p.zq.TEXT_LEADERLINE){let e=this.gcmd.annotationInstance.scene.capture;if(e.isSelectedReaderlineByClick&&e.leaderline){e.IsSelectedReaderline&&e.removeLeaderline();return}}let t=[];e&&e.forEach(e=>{if(e.type===p.zq.POLYGON_GRAPH){if(e.graphCore.selVec)e.remove(!1);else{let s=e.toJSON();s&&(t.push(s),e.remove(!1))}}else{let s=e.toJSON();s&&(t.push(s),e.remove(!1))}}),this.gcmd.annotationInstance.io.eventListenerAnnotation.removeGeometryStack(t),this.gcmd.gcmdSupporting.renderForce()}transformStack(){if(this.gcmd.annotationInstance.implementations.app.model.appCoreWrapper.appControllerStatus.mode!==p.An.Drawing||this.gcmd.annotationInstance.activeCommandController.acProperties.isPanning)return;let e=[],t=[],s=this.gcmd.annotationInstance.scene.geometryList.length;for(;s--;){let i=this.gcmd.annotationInstance.scene.geometryList[s];if(i.isSelected||i.isCapturedValue||i.isTransform){if(i.isUnderConstruction)continue;if(i.isTransform){if(i.type===p.zq.TEXT_LEADERLINE){if(i.attachedShape){let e=i.toJSON();e&&(t.push(e),i.isTransform=!1)}else{let s=i.toJSON();s&&(e.push(s),t.push(s),i.isTransform=!1)}}else{let s=i.toJSON();s&&(e.push(s),t.push(s)),i.isTransform=!1}}if(i.updateVecsHistory(),i.type===p.zq.ALINE){let t=i.toJSON();t&&e.push(t)}}}if(this.gcmd.annotationInstance.renderer.blackhole&&this.gcmd.annotationInstance.renderer.blackhole.isActive&&(0,p.Sp)(this.gcmd.annotationInstance.renderer.blackhole.v,new p.h9(this.gcmd.annotationInstance.activeCommandController.m.x,this.gcmd.annotationInstance.activeCommandController.m.y,0))<this.gcmd.annotationInstance.renderer.blackhole.radius){this.gcmd.annotationInstance.renderer.blackhole.removeSelectedShapesByBlackhole(e);return}for(t.length>0&&this.gcmd.annotationInstance.io.eventListenerAnnotation.transformStack(t),s=this.gcmd.annotationInstance.scene.geometryList.length;s--;)this.gcmd.annotationInstance.scene.geometryList[s].isTransform=!1}undo(){this.gcmd.annotationInstance.scene.undo()}redo(){this.gcmd.annotationInstance.scene.redo()}emitSelections(){let e=this.gcmd.gcmdSelecting.getCapturedGeometries();this.gcmd.annotationInstance.io.emitAction("select-shapes@".concat(JSON.stringify(e)))}updateColorStyle(e){for(let t=0;t<this.gcmd.annotationInstance.scene.geometryList.length;++t)this.gcmd.annotationInstance.scene.geometryList[t].isSelected&&this.gcmd.annotationInstance.scene.geometryList[t].updateColor(e);this.gcmd.annotationInstance.graphicsCoreWrapper.renderForce()}constructor(e){this.gcmd=e}}st.capture=void 0,st.captureMultiple=void 0,st.captureHovered=void 0,st.captureForEasing=void 0,st.list=[],st.copyPasteGeo=[],st.listHashColor={};class ss{selecteObjectsByVecs(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];let t=this.gcmd.annotationInstance.scene.geometryList.length,s=[];for(;t--;)this.gcmd.annotationInstance.scene.geometryList[t].type!==p.zq.CBLACKHOLE&&this.gcmd.annotationInstance.scene.geometryList[t].type!==p.zq.CNODE&&this.gcmd.annotationInstance.scene.geometryList[t].type!==p.zq.ANODE&&this.gcmd.annotationInstance.scene.geometryList[t].type!==p.zq.ANODE_CIRCLE&&this.gcmd.annotationInstance.scene.geometryList[t].type!==p.zq.AMIDPOINT&&this.gcmd.annotationInstance.scene.geometryList[t].type!==p.zq.ANODE_RECT&&this.gcmd.annotationInstance.scene.geometryList[t].type!==p.zq.AN_GON&&this.gcmd.annotationInstance.scene.geometryList[t].type!==p.zq.ANODE_TEXT&&this.gcmd.annotationInstance.scene.geometryList[t].isSelectedByWindow(e)&&(this.gcmd.annotationInstance.scene.geometryList[t].isSelectedValue=!0,s.push(this.gcmd.annotationInstance.scene.geometryList[t].id));this.gcmd.annotationInstance.io.eventListenerAnnotation.selectionsStackByID(s)}deSelectCaptureObjects(){let e=this.gcmd.annotationInstance.scene.geometryList.length;for(;e--;)!this.gcmd.annotationInstance.scene.geometryList[e].isCapturedValue&&(this.gcmd.annotationInstance.scene.geometryList[e].type===p.zq.TEXT?this.gcmd.annotationInstance.scene.geometryList[e].isEditiable=!1:this.gcmd.annotationInstance.scene.geometryList[e].isSelected&&(this.gcmd.annotationInstance.scene.geometryList[e].isSelected=!1,this.gcmd.annotationInstance.scene.geometryList[e].isHover=!1));this.gcmd.annotationInstance.scene.Capture=void 0}deSelectAllObjects(){let e=this.gcmd.annotationInstance.scene.geometryList.length;for(;e--;)this.gcmd.annotationInstance.scene.geometryList[e].isCaptured=!1,this.gcmd.annotationInstance.scene.geometryList[e].isSelected=!1,this.gcmd.annotationInstance.scene.geometryList[e].isHover=!1;this.gcmd.annotationInstance.scene.Capture=void 0}selectAllObjects(){let e=this.gcmd.annotationInstance.scene.geometryList.length;for(;e--;)this.gcmd.annotationInstance.scene.geometryList[e].type!==p.zq.APOINT&&this.gcmd.annotationInstance.scene.geometryList[e].type!==p.zq.AMIDPOINT&&this.gcmd.annotationInstance.scene.geometryList[e].type!==p.zq.ANODE&&this.gcmd.annotationInstance.scene.geometryList[e].type!==p.zq.ANODE_CIRCLE&&this.gcmd.annotationInstance.scene.geometryList[e].type!==p.zq.ANODE_NGON&&this.gcmd.annotationInstance.scene.geometryList[e].type!==p.zq.ANODE_RECT&&this.gcmd.annotationInstance.scene.geometryList[e].type!==p.zq.ANODE_TEXT&&this.gcmd.annotationInstance.scene.geometryList[e].type!==p.zq.CBLACKHOLE&&this.gcmd.annotationInstance.scene.geometryList[e].type!==p.zq.CNODE&&this.gcmd.annotationInstance.scene.geometryList[e].type!==p.zq.CNODE_RECT&&(this.gcmd.annotationInstance.scene.geometryList[e].isSelected||(this.gcmd.annotationInstance.scene.geometryList[e].isSelected=!0))}getAllGeometries(){let e;let t=[];for(let s=0;s<this.gcmd.annotationInstance.scene.geometryList.length;++s)(e=this.gcmd.annotationInstance.scene.geometryList[s].toJSON())&&t.push(e);return t}getCapturedGeometries(){let e;let t=[];for(let s=0;s<this.gcmd.annotationInstance.scene.geometryList.length;++s)this.gcmd.annotationInstance.scene.geometryList[s].isSelected&&(e=this.gcmd.annotationInstance.scene.geometryList[s].toJSON())&&t.push(e);return t}cancelActiveCommand(){(this.gcmd.annotationInstance.activeCommandController.type===p.uA.RECTANGLE||this.gcmd.annotationInstance.activeCommandController.type===p.uA.CIRCLE||this.gcmd.annotationInstance.activeCommandController.type===p.uA.FREEHAND_POLYLINE_BENDING||this.gcmd.annotationInstance.activeCommandController.type===p.uA.FREEHAND_POLYGON_GRAPH)&&this.gcmd.annotationInstance.activeCommandController.activeCommand.cancel()}constructor(e){this.gcmd=e}}class si{updateStyle(){let e=this.gcmd.annotationInstance.scene.geometryList.length;for(;e--;)this.gcmd.annotationInstance.scene.geometryList[e].styleComponent.updateStyle();this.renderForce()}renderForce(){this.gcmd.annotationInstance.graphicsCoreWrapper.renderForce(),this.gcmd.annotationInstance.activeCommandController.acProperties.needExecuteOptimizer=!0}checkBoundIntersection(e,t,s){return!!(0,p.c8)(e,t,s)}pushThemeJSON(e){this.gcmd.annotationInstance.customization.themeRenderStyle.pushThemeJSON(e)}toScreen(e,t){return[e,t]}toMap(e,t){return[e,t]}updateCanvasSize(e){this.gcmd.annotationInstance.graphicsCoreWrapper.canvasWrapper.aCanvas.canvasView.style.background="rgba(255, 0, 0, 0.2)",this.gcmd.annotationInstance.graphicsCoreWrapper.canvasWrapper.aCanvas.resizeCanvas(300,500),this.gcmd.annotationInstance.graphicsCoreWrapper.canvasWrapper.aCanvas.divHost.style.width="300px",this.gcmd.annotationInstance.graphicsCoreWrapper.canvasWrapper.aCanvas.divHost.style.height="500px"}toScreenVecOnCropping(e){return{x:e.x-this.gcmd.annotationInstance.scene.paramsEditing.croppingMaskParams.x,y:e.y-this.gcmd.annotationInstance.scene.paramsEditing.croppingMaskParams.y}}toScreenVecsOnCropping(e){let t=[];for(let s=0;s<e.length;++s){let i=this.toScreenVecOnCropping(e[s]);t.push(new p.h9(i.x,i.y))}return t}constructor(e){this.gcmd=e}}class sn{constructor(e){this.annotationInstance=e,this.gcmdSupporting=new si(this),this.gcmdProcessing=new st(this),this.gcmdSelecting=new ss(this),this.gcmdAProcessing=new se(this)}}class so{initAddon(e){}constructor(e){this.apiWrapper=e}}class sr{logCommon(e,t){}toggleClusteringPoint(e){e?this.setOptimizerClusteringPoint(p.xX.Collision):this.setOptimizerClusteringPoint(p.xX.None)}setOptimizerClusteringPoint(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:p.xX.None;this.apiWrapper.annotationInstance.activeCommandController.acProperties.optimizerPoint=e,this.apiWrapper.annotationInstance.activeCommandController.acProperties.needExecuteOptimizer=!0,this.apiWrapper.annotationInstance.geometryCommon.gcmdSupporting.renderForce()}toggleDebuggerMode(){this.toggleInspector()}shiftDash(){this.apiWrapper.annotationInstance.scene.capture&&(0===this.apiWrapper.annotationInstance.scene.capture.styleComponent.renderStyle.dash.length?this.apiWrapper.annotationInstance.scene.capture.setDash([4,4]):this.apiWrapper.annotationInstance.scene.capture.setDash([]))}toggleInspector(){this.apiWrapper.annotationInstance.implementations.app.INSPECTION=!this.apiWrapper.annotationInstance.implementations.app.INSPECTION,this.apiWrapper.annotationInstance.activeCommandController.acProperties.isHiddenLog=!this.apiWrapper.annotationInstance.implementations.app.INSPECTION}shiftOptimizerTextleaderline(){void 0!==this.apiWrapper.annotationInstance.implementations.imageAnnoApp&&(this._optimizerTextleaderline++,this._optimizerTextleaderline%3==0?this.apiWrapper.annotationInstance.implementations.imageAnnoApp.activeCommandController.acProperties.optimizerTextleaderline=p.Nv.None:this._optimizerTextleaderline%3==1?this.apiWrapper.annotationInstance.implementations.imageAnnoApp.activeCommandController.acProperties.optimizerTextleaderline=p.Nv.Zoom:this._optimizerTextleaderline%3==2&&(this.apiWrapper.annotationInstance.implementations.imageAnnoApp.activeCommandController.acProperties.optimizerTextleaderline=p.Nv.Collision))}shiftActiveCluster(){void 0!==this.apiWrapper.annotationInstance.implementations.imageAnnoApp&&(this._optimizerPoint++,this._optimizerPoint%2==0?this.apiWrapper.annotationInstance.implementations.imageAnnoApp.activeCommandController.acProperties.optimizerPoint=p.xX.None:this.apiWrapper.annotationInstance.implementations.imageAnnoApp.activeCommandController.acProperties.optimizerPoint=p.xX.Collision)}shiftScaleForRPoint(){this._scalePoint++,this._scalePoint%3==0?this.apiWrapper.annotationInstance.geometryCommon.gcmdProcessing.setSizeRPoint(p.$u.SMALL):this._scalePoint%3==1?this.apiWrapper.annotationInstance.geometryCommon.gcmdProcessing.setSizeRPoint(p.$u.MEDIUM):this._scalePoint%3==2&&this.apiWrapper.annotationInstance.geometryCommon.gcmdProcessing.setSizeRPoint(p.$u.LARGE)}shiftRenderShapeForRPoint(){this._renderTypePoint++,this._renderTypePoint%3==0?this.apiWrapper.annotationInstance.geometryCommon.gcmdProcessing.setRenderTypePoint(p.oW.RpointA):this._renderTypePoint%3==1?this.apiWrapper.annotationInstance.geometryCommon.gcmdProcessing.setRenderTypePoint(p.oW.RpointB):this._renderTypePoint%3==2&&this.shiftIcon()}shiftIcon(){this._iconPoint++,this._iconPoint%5==0?this.apiWrapper.annotationInstance.geometryCommon.gcmdProcessing.setRenderTypePoint("/static/storymaps-website-common/images/browsers/chrome.png"):this._iconPoint%5==1?this.apiWrapper.annotationInstance.geometryCommon.gcmdProcessing.setRenderTypePoint("/static/images/story-maps-logo.png"):this._iconPoint%5==2?this.apiWrapper.annotationInstance.geometryCommon.gcmdProcessing.setRenderTypePoint("/static/storymaps-xgraphics/images/item-browser"):this._iconPoint%5==3?this.apiWrapper.annotationInstance.geometryCommon.gcmdProcessing.setRenderTypePoint("/static/storymaps-xgraphics/images/item-browser"):this._iconPoint%5==4&&this.apiWrapper.annotationInstance.geometryCommon.gcmdProcessing.setRenderTypePoint("/static/storymaps-website-common/images/browsers/safari.png")}updateIconPoint(e){this.apiWrapper.annotationInstance.geometryCommon.gcmdProcessing.updateIconPoint(e.id,e.url)}shiftScaleDynamicRender(){void 0!==this.apiWrapper.annotationInstance.implementations.imageAnnoApp&&(this.apiWrapper.annotationInstance.implementations.imageAnnoApp.activeCommandController.acProperties.isScaleDynamicRender=!this.apiWrapper.annotationInstance.implementations.imageAnnoApp.activeCommandController.acProperties.isScaleDynamicRender)}shiftLog(){this.apiWrapper.annotationInstance.activeCommandController.acProperties.isHiddenLog=!this.apiWrapper.annotationInstance.activeCommandController.acProperties.isHiddenLog}bindFromDisplay(){}shiftMapfilter(){}toggleMapfilter(e){}toggleActiveCommandChain(e){"true"===e?this.apiWrapper.annotationInstance.activeCommandController.acProperties.showActiveCommandChain=!0:"false"===e&&(this.apiWrapper.annotationInstance.activeCommandController.acProperties.showActiveCommandChain=!1)}toggleDrawingTooltips(e){"true"===e?this.apiWrapper.annotationInstance.activeCommandController.acProperties.showTooltip=!0:"false"===e&&(this.apiWrapper.annotationInstance.activeCommandController.acProperties.showTooltip=!1)}toggleGrid(e){}toggleBorderFeaturePolygon(){}shiftGrid(){}shiftMeasure(){}toggleMeasure(e){}togglTooltip(e){}togglActiveCommandChain(e){}shiftSnapping(){this.apiWrapper.annotationInstance.activeCommandController.acProperties.isActivateSnapping=!this.apiWrapper.annotationInstance.activeCommandController.acProperties.isActivateSnapping}shiftUnitDisplay(){for(let e of(this.apiWrapper.annotationInstance.activeCommandController.acProperties.showUnit=!this.apiWrapper.annotationInstance.activeCommandController.acProperties.showUnit,this.apiWrapper.annotationInstance.scene.listALog))e.isShow=this.apiWrapper.annotationInstance.activeCommandController.acProperties.showUnit}shiftUnit(){this.apiWrapper.annotationInstance.activeCommandController.acProperties.unitEnumInt++,0===this.apiWrapper.annotationInstance.activeCommandController.acProperties.unitEnumInt?this.apiWrapper.annotationInstance.activeCommandController.acProperties.unit=p.fb.Kilometer:1===this.apiWrapper.annotationInstance.activeCommandController.acProperties.unitEnumInt?this.apiWrapper.annotationInstance.activeCommandController.acProperties.unit=p.fb.Meter:2===this.apiWrapper.annotationInstance.activeCommandController.acProperties.unitEnumInt&&(this.apiWrapper.annotationInstance.activeCommandController.acProperties.unit=p.fb.Mile),this.apiWrapper.annotationInstance.activeCommandController.acProperties.unitEnumInt>2&&(this.apiWrapper.annotationInstance.activeCommandController.acProperties.unitEnumInt=0)}toggleCollisionDetection(){this.apiWrapper.annotationInstance.activeCommandController.acProperties.needCollisionDetection=!this.apiWrapper.annotationInstance.activeCommandController.acProperties.needCollisionDetection}activateOffScreen(){this.apiWrapper.annotationInstance.graphicsCoreWrapper.canvasWrapper.aCanvasOffScreen.appendDiv()}deactivateOffScreen(){try{this.apiWrapper.annotationInstance.graphicsCoreWrapper.canvasWrapper.aCanvasOffScreen.removeDiv()}catch(e){}}shiftBlackholeRender(){}shiftBlackholePos(){this.apiWrapper.annotationInstance.renderer.blackhole.smartEvasion=!this.apiWrapper.annotationInstance.renderer.blackhole.smartEvasion}constructor(e){this._optimizerTextleaderline=0,this._optimizerPoint=0,this._scalePoint=0,this._renderTypePoint=0,this._iconPoint=0,this.apiWrapper=e}}class sa{constructor(e){this.annotationInstance=e,this.addon=new so(this),this.environment=new sr(this)}}class sh{initIcon(e){for(let t in e.iconBase64){let s=new Image;s.src=e.iconBase64[t],this.icons[t]=s}}addIcon(e){this.icons[e]||(this.icons[e]=this.addIconAsset(e))}getIconByURL(e){return this.icons[e]}removeIconAsset(e){delete this.icons[e]}addIconAsset(e){let t=new Image;return t.crossOrigin="Anonymous",t.onload=()=>{},t.src=e,t}constructor(e,t){this.icons={},this.tempImageID=void 0,this.customization=e,this.initIcon(t)}}class sc{shiftEnvironment(e){e===p.qA.AGSM?this.updateRPointPath((0,p.VT)()):this.updateRPointPath((0,p.KF)())}updateRPointPath(e){this.customization.themeCurrent.rPoint.SVG.path2D=e.path2D;let t=36,s=28;this.customization.annotationInstance.implementations.app.param.environment===p.qA.AGSM&&(t=32,s=30),this.customization.themeCurrent.rPoint.width=t,this.customization.themeCurrent.rPoint.height=s;for(let e=0;e<this.customization.annotationInstance.scene.listRPoint.length;++e)this.customization.annotationInstance.scene.listRPoint[e].styleComponent.renderStyle.width=t,this.customization.annotationInstance.scene.listRPoint[e].styleComponent.renderStyle.height=s}updateNPointPath(e){this.customization.themeCurrent.nPoint.SVG.path2D=e}async pushThemeJSON(e){if(!this.isDone){this.queueTheme=e;return}await this.computeTheme(e)}async computeTheme(e){if(this.isDone=!1,this.customization.themeCurrent=new ts,this.updateThemeBGType(e.mode),this.updateThemeInteraction(e),this.updateMaskColor(e.properties.maskColor),this.updateSelection(e.graphics.line.colorRgba,e.graphics.polygon.fill),this.buildPropertiesData(e),this.customization.themeCurrent=this.buildThemeDataShape(e.graphics),await this.buildThemeDataAsync(e.graphics),this.isDone=!0,this.queueTheme){let e=this.queueTheme;this.queueTheme=void 0,this.computeTheme(e)}}buildPropertiesData(e){this.customization.themeCurrent.properties.elasticScale=e.properties.elasticScale,this.customization.themeCurrent.properties.desaturationValue=e.properties.desaturationValue,this.customization.themeCurrent.properties.timeTransitionA=e.properties.timeTransitionA,this.customization.themeCurrent.properties.timeTransitionB=e.properties.timeTransitionB}buildThemeDataShape(e){let t=this.customization.themeCurrent;return t.node.size=.5*e.node.sizeNode,t.node.lineWidth=2,t.node.sizeMid=.5*e.node.sizeNodeMid,t.node.lineWidthMid=2,t.polyline.strokeStyleFirstArray=[e.line.colorRgba[0],e.line.colorRgba[1],e.line.colorRgba[2],e.line.colorRgba[3]],t.polyline.strokeStyleSecondArray=[e.line.colorRgba[0],e.line.colorRgba[1],e.line.colorRgba[2],t.properties.opacity],t.polyline.lineWidth=e.line.width,t.arrow.fillStyleFirstArray=[e.arrow.colorRgba[0],e.arrow.colorRgba[1],e.arrow.colorRgba[2],e.arrow.colorRgba[3]],t.arrow.fillStyleSecondArray=[e.arrow.colorRgba[0],e.arrow.colorRgba[1],e.arrow.colorRgba[2],t.properties.opacity+.5],t.arrow.strokeStyleFirstArray=[e.arrow.colorRgba[0],e.arrow.colorRgba[1],e.arrow.colorRgba[2],e.arrow.colorRgba[3]],t.arrow.strokeStyleSecondArray=[e.arrow.colorRgba[0],e.arrow.colorRgba[1],e.arrow.colorRgba[2],t.properties.opacity],t.arrow.lineWidth=e.arrow.width,t.arrow.scale=e.arrow.scale,t.polygon.fillStyleFirstArray=[e.polygon.fill[0],e.polygon.fill[1],e.polygon.fill[2],e.polygon.fill[3]],t.polygon.fillStyleSecondArray=[e.polygon.fill[0],e.polygon.fill[1],e.polygon.fill[2],t.properties.opacity-.2],t.polygon.strokeStyleFirstArray=[e.polygon.colorRgba[0],e.polygon.colorRgba[1],e.polygon.colorRgba[2],e.polygon.colorRgba[3]],t.polygon.strokeStyleSecondArray=[e.polygon.colorRgba[0],e.polygon.colorRgba[1],e.polygon.colorRgba[2],t.properties.opacity-.2],t.polygon.lineWidth=e.polygon.width,t.freehand.fillStyleFirstArray=[e.polygon.fill[0],e.polygon.fill[1],e.polygon.fill[2],t.properties.opacity],t.freehand.strokeStyleFirstArray=[e.polygon.colorRgba[0],e.polygon.colorRgba[1],e.polygon.colorRgba[2],t.properties.opacity],t.freehand.lineWidth=e.polygon.width,t.textleaderline.scale=e.textLeaderline.scale,t.textleaderline.box.dash=e.textLeaderline.box.dash,t.textleaderline.box.lineWidth=e.textLeaderline.box.width,t.textleaderline.box.fillStyle=e.textLeaderline.box.fill,t.textleaderline.box.strokeStyle=e.textLeaderline.box.strokeStyle,t.textleaderline.handleNode.dash=e.textLeaderline.handleNode.dash,t.textleaderline.handleNode.lineWidth=e.textLeaderline.handleNode.width,t.textleaderline.handleNode.fillStyle=e.textLeaderline.handleNode.fill,t.textleaderline.handleNode.strokeStyle=e.textLeaderline.handleNode.strokeStyle,t.textleaderline.leaderline.dash=e.textLeaderline.leaderline.dash,t.textleaderline.leaderline.lineWidth=e.textLeaderline.leaderline.width,t.textleaderline.leaderline.strokeStyle=e.textLeaderline.leaderline.strokeStyle,t.textleaderline.anchorNode.dash=e.textLeaderline.anchorNode.dash,t.textleaderline.anchorNode.lineWidth=e.textLeaderline.anchorNode.width,t.textleaderline.anchorNode.fillStyle=e.textLeaderline.anchorNode.fill,t.textleaderline.anchorNode.strokeStyle=e.textLeaderline.anchorNode.strokeStyle,t.iPoint.scale=e.iconPoint.scale,t.rPoint.URL=e.regularPoint.url,t.rPoint.fillStyleFirstArray=e.regularPoint.colorRgba,t.rPoint.shadowBlur=e.regularPoint.shadowBlur,t.rPoint.shadowColor=e.regularPoint.shadowColor,t.rPoint.shadowColorHover=e.regularPoint.shadowColorHover,t.rPoint.scale=e.regularPoint.scale,t.rPoint.fillStyleSecondArray=[e.regularPoint.colorRgba[0],e.regularPoint.colorRgba[1],e.regularPoint.colorRgba[2],t.properties.opacity],t.nPoint.URL=e.numberedPoint.url,t.nPoint.shadowBlur=e.numberedPoint.shadowBlur,t.nPoint.shadowColor=e.numberedPoint.shadowColor,t.nPoint.shadowColorHover=e.numberedPoint.shadowColorHover,t.nPoint.fillStyleSecondArray=[e.numberedPoint.colorRgba[0],e.numberedPoint.colorRgba[1],e.numberedPoint.colorRgba[2],t.properties.opacity+.1],t.nPoint.fillStyleFirstArray=[e.numberedPoint.colorRgba[0],e.numberedPoint.colorRgba[1],e.numberedPoint.colorRgba[2],e.numberedPoint.colorRgba[3]],t.nPoint.fontColorArray=[e.numberedPoint.fontColor[0],e.numberedPoint.fontColor[1],e.numberedPoint.fontColor[2],e.numberedPoint.fontColor[3]],t.nPoint.fontSize=e.numberedPoint.fontSize,t.nPoint.fontFamily=e.numberedPoint.fontFamily,t.nPoint.scale=e.numberedPoint.scale,t}async buildThemeDataAsync(e){let t=this.customization.themeCurrent;t.rPoint.SVG={type:"path",height:28,width:36,path2D:this.defaultRPoint.path2D};let s=28;t.rPoint.SVG.height=s,t.rPoint.height=s;let i=36;t.rPoint.SVG.width=i,t.rPoint.width=i;let n={type:"path",width:36,height:28,path:[],path2D:this.defaultNPoint.path2D};return t.nPoint.SVG=n,s=28,t.nPoint.SVG.height=s,t.nPoint.height=s,i=36,t.nPoint.SVG.width=i,t.nPoint.width=i,this.customization.annotationInstance.geometryCommon.gcmdSupporting.updateStyle(),t}updateThemeBGType(e){"dark"===e?this.customization.themeCurrent.properties.isDarkBG=!0:this.customization.themeCurrent.properties.isDarkBG=!1}updateMaskColor(e){this.customization.themeCurrent.properties.maskColor="rgba(".concat(e[0],", ").concat(e[1],", ").concat(e[2],", ").concat(e[3],")"),this.customization.annotationInstance.graphicsCoreWrapper.canvasWrapper.aCanvasMask.maskColor=this.customization.themeCurrent.properties.maskColor}updateThemeInteraction(e){this.customization.themeCurrent.properties.outlineHoverColorArray=e.properties.outlineHoverColor,this.customization.themeCurrent.properties.outlineHoverColorRGBAString="rgba(".concat(e.properties.outlineHoverColor[0],", ").concat(e.properties.outlineHoverColor[1],", ").concat(e.properties.outlineHoverColor[2],", ").concat(e.properties.outlineHoverColor[3],")")}updateSelection(e,t){this.customization.themeCurrent.selection.strokeStyleFirstArray=e,this.customization.themeCurrent.selection.fillStyleFirstArray=t}constructor(e,t){this.shiftTheme=1,this.shiftThemeNumberLayerOrdering=0,this.numLayer=-1,this.isDone=!1,this.queueTheme=void 0,this.customization=e,this.customization.annotationInstance.implementations.app.param.environment===p.qA.AGSM?this.defaultRPoint=(0,p.VT)():this.defaultRPoint=(0,p.KF)(),this.defaultNPoint=(0,p.nP)(),this.computeTheme(t)}}class sl{constructor(e){this.key="",this.hasShift=!1,this.hasControl=!1,this.ac=p.uA.NONE,this.key=e.key.toUpperCase(),this.hasShift=e.shift,this.hasControl=e.control}}class sp{pushThemeJSON(e){if(e.shortcut)for(let t=0;t<e.shortcut.length;++t)Object.keys(e.shortcut[t]).forEach(s=>{let i=e.shortcut[t][s];if("select"===s&&""!==i.key){let e=new sl(i);e.ac=p.uA.SELECT,this.shortcutCommands[i.key.toUpperCase()]=e;return}if("selectRect"===s&&""!==i.key){let e=new sl(i);e.ac=p.uA.SELECT_RECT,this.shortcutCommands[i.key.toUpperCase()]=e;return}if("undo"===s&&""!==i.key){let e=new sl(i);e.ac=p.uA.UNDO,this.shortcutCommands[i.key.toUpperCase()]=e;return}if("redo"===s&&""!==i.key){let e=new sl(i);e.ac=p.uA.REDO,this.shortcutCommands[i.key.toUpperCase()]=e;return}if("rPoint"===s&&""!==i.key){let e=new sl(i);e.ac=p.uA.POINT_REGULAR,this.shortcutCommands[i.key.toUpperCase()]=e;return}if("nPoint"===s&&""!==i.key){let e=new sl(i);e.ac=p.uA.POINT_NUMBERED,this.shortcutCommands[i.key.toUpperCase()]=e;return}if("polyline"===s&&""!==i.key){let e=new sl(i);e.ac=p.uA.POLYLINE_BENDING,this.shortcutCommands[i.key.toUpperCase()]=e;return}if("freehandPolyline"===s&&""!==i.key){let e=new sl(i);e.ac=p.uA.FREEHAND_POLYLINE_BENDING,this.shortcutCommands[i.key.toUpperCase()]=e;return}if("polygon"===s&&""!==i.key){let e=new sl(i);e.ac=p.uA.POLYGON_GRAPH,this.shortcutCommands[i.key.toUpperCase()]=e;return}if("freehandPolygon"===s&&""!==i.key){let e=new sl(i);e.ac=p.uA.FREEHAND_POLYGON_GRAPH,this.shortcutCommands[i.key.toUpperCase()]=e;return}if("textleaderline"===s&&""!==i.key){let e=new sl(i);e.ac=p.uA.TEXT_LEADERLINE,this.shortcutCommands[i.key.toUpperCase()]=e;return}if("singleArrow"===s&&""!==i.key){let e=new sl(i);e.ac=p.uA.ARROW_SINGLE,this.shortcutCommands[i.key.toUpperCase()]=e;return}if("doubleArrrow"===s&&""!==i.key){let e=new sl(i);e.ac=p.uA.ARROW_DOUBLE,this.shortcutCommands[i.key.toUpperCase()]=e;return}})}constructor(e,t){this.shortcutCommands={},this.customization=e,t?this.pushThemeJSON(t):this.pushThemeJSON(this.customization.annotationInstance.implementations.app.model.assets.theme)}}class sd{downloadTheme(){return this.themeCurrent.downloadJson()}constructor(e,t){this.annotationInstance=e,t||(t=this.annotationInstance.implementations.app.model.assets.theme),this.iconAsset=new sh(this,t),this.themeRenderStyle=new sc(this,t),this.shortcut=new sp(this,t)}}class sm{initPre(){this.canvasView=document.createElement("canvas"),this.canvasView.id=this.id,this.canvasView.style.width="100%",this.canvasView.style.height="100%",this.canvasView.style.zIndex=this.zIndex,this.canvasView.style.position="absolute",this.canvasView.style.pointerEvents="none",this.ctxView=this.canvasView.getContext("2d"),this.ctxView.globalCompositeOperation="source-over",this.divHost.appendChild(this.canvasView),this.canvas=document.createElement("canvas"),this.canvas.id=this.id,this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.zIndex=this.zIndex,this.canvas.style.position="absolute",this.canvas.style.pointerEvents="none",this.ctx=this.canvas.getContext("2d"),this.ctx.globalCompositeOperation="source-over",this.deltaTime=new su,this.canvasLoopController=new sg(100),this.canvasLoopController.level=4,this.init(),this.loop()}init(){}loop(){if(!this.isActive)return;let e=performance.now();if(this.deltaTime.updateFPS(),this.canvasLoopController.level>3){if(6===this.canvasLoopController.level)requestAnimationFrame(()=>{this.loop()}),this.clear(),this.render();else if(5===this.canvasLoopController.level)this.isViewChanging,requestAnimationFrame(()=>{this.loop()}),this.clear(),this.render();else if(4===this.canvasLoopController.level){if(this.isViewChanging,requestAnimationFrame(()=>{this.loop()}),this.canvasLoopController.stop)return;this.clear(),this.render(),this.canvasLoopController.timerForStop()}}else 1===this.canvasLoopController.level&&this.isViewChanging?this.clear():(this.clear(),this.render());let t=performance.now();this.log="level:  ".concat(this.canvasLoopController.level,", total frames: ").concat(this.loopNum++," (FPS: ").concat(this.deltaTime.frameRate.toFixed(0),"), a loop took: ").concat((t-e).toFixed(2)," ms to execute."),this.logOut()}set log(e){this._log=e}get log(){return this._log}initOffscreen(e){this.canvasOffScreen=e}resize(e,t){this.canvas.width=e,this.canvas.height=t}clear(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctxView.clearRect(0,0,this.canvas.width,this.canvas.height),this.canvasOffScreen&&this.canvasOffScreen.clear()}setLevel1(){this.canvasLoopController.level=1,this.loop()}setLevel2(){this.canvasLoopController.level=2,this.loop()}setLevel3(){this.canvasLoopController.level=3,this.loop()}renderSetLevel4(){this.canvasLoopController.stop=!0}setLevel4(){this.canvasLoopController.reset(),setTimeout(()=>{this.canvasLoopController.level=4,this.loop()},500)}setLevel5(){this.canvasLoopController.reset(),setTimeout(()=>{this.canvasLoopController.level=5,this.loop()},500)}setLevel6(){this.canvasLoopController.reset(),setTimeout(()=>{this.canvasLoopController.level=6,this.loop()},500)}constructor(e,t="canvas"){this.id="canvas",this.zIndex="1",this.loopNum=0,this.needRenderloop=!0,this.pause=!1,this.frameRate=60,this.isLoop=!0,this.isViewChanging=!1,this.isActive=!1,this.divHost=e,this.id=t,this.initPre()}}class su{updateFPS(){this.now=window.performance.now(),this.msLoop=this.now-this.last,this.last=this.now,this.delta=this.delta+Math.min(1,this.msLoop/1e3),this.delta>this.frameRate&&(this.delta=this.delta-this.frameRate),this.delta=(Date.now()-this.timeLastRender)/1e3,this.timeLastRender=Date.now(),this.frameRate=1/this.delta}get dt(){return this.delta}constructor(){this.last=0}}class sg{get stop(){return this._stop}set stop(e){this.numRender=0,this._stop=e}timerForStop(){this.numRender++,this.numRender>this.numStopFrame&&(this.numRender=0,this.stop=!0)}reset(){this._level=-1}get level(){return this._level}set level(e){this._level=e}constructor(e){this._level=-1,this._stop=!1,this.numRender=0,this.numStopFrame=e}}class sv{init(){this.canvas=document.createElement("canvas"),this.canvas.id="OffScreen",this.canvas.style.zIndex="90",this.canvas.style.position="absolute",this.offScreenCtx=this.canvas.getContext("2d"),this.canvas.width=this.hostCanvas.width,this.canvas.height=this.hostCanvas.height}resizeCanvas(e,t){this.offScreenCtx.canvas.width=e,this.offScreenCtx.canvas.height=t}clear(){this.offScreenCtx.clearRect(0,0,this.offScreenCtx.canvas.width,this.offScreenCtx.canvas.height)}constructor(e){sv.instance=this,this.hostCanvas=e,this.init()}}class sy extends sm{get frameSkip(){return this._frameSkip}set frameSkip(e){this._frameSkip=e}initPost(e){this.isActive=e,this.ctx.lineCap=p.cg.Round}set imageSmoothingEnabled(e){this.ctx.imageSmoothingEnabled=e,this.ctxView.imageSmoothingEnabled=e}getImageData(){return this.ctx.getImageData(0,0,this.ctx.canvas.width,this.ctx.canvas.height)}render(){if(this.clearPost(),this.time+=.001,!this.isActive){this.canvasWrapper.aCanvasOffScreen.clear(),this.ctxView.clearRect(0,0,this.ctxView.canvas.width,this.ctxView.canvas.height);return}this.canvasWrapper.aCanvasOffScreen.clear(),this.canvasWrapper.graphicsCoreWrapper.rendererWrapper.render(this.ctx),this.ctxView.clearRect(0,0,this.ctxView.canvas.width,this.ctxView.canvas.height),0!==this.canvas.width&&0!==this.canvas.height?this.ctxView.drawImage(this.canvas,0,0):(this.isLoop=!1,this.isActive=!1,this.canvasLoopController.stop=!0)}clear(){}clearPost(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctxView.clearRect(0,0,this.canvas.width,this.canvas.height),this.canvasOffScreen&&this.canvasOffScreen.clear()}resizeCanvas(e,t){this.ctx.canvas.width=e,this.ctx.canvas.height=t,this.ctxView.canvas.width=e,this.ctxView.canvas.height=t}destroy(){this.setLevel1(),this.isLoop=!1,this.isActive=!1,this.canvasLoopController.stop=!0,this.loop=()=>{},this.render=()=>{},this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas)}logOut(){}get IsRenderSkip(){return this._isRenderSkip}set IsRenderSkip(e){this._isRenderSkip=e}doPause(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.isActive=!1,this.canvasWrapper.aCanvasOffScreen.clear(),this.ctxView.clearRect(0,0,this.ctxView.canvas.width,this.ctxView.canvas.height),e>0&&setTimeout(()=>{this.doResume()},e)}doResume(){this.isActive=!0,this.isLoop=!0,this.canvasWrapper.renderForce(),this.loop()}constructor(e,t=60){super(e.graphicsCoreWrapper.imageAnnoApp.implementations.app.model.modelViewWrapper.div,"AnnotationImageTool"),this.then=0,this.interval=0,this.last=0,this.asyncSafeGuard=0,this.time=0,this._frameSkip=3,this.canvasWrapper=e,this.xOff=0,this.yOff=0,this.xOffCurrent=0,this.yOffCurrent=0,this.xOffPre=0,this.yOffPre=0,this.anchor=new p.h9(0,0,0),this.timeLastRender=0,this.delta=0,this.frameVisTimer=.05,this.dropRate=30,this.IsRenderSkip=!0,this.isLoop=!0,this.frameRate=t,this.deltaTime.frameRate=t,this.setLevel6(),this.frameSkip=3}}class sC{init(){this.canvas=document.createElement("canvas"),this.canvas.id="AnnotationImageToolMask",this.canvas.style.zIndex="1",this.canvas.style.position="absolute",this.canvas.style.pointerEvents="none",this.ctx=this.canvas.getContext("2d"),this.canvasWrapper.graphicsCoreWrapper.imageAnnoApp.implementations.app.model.modelViewWrapper.div.appendChild(this.canvas),this.ctx.globalCompositeOperation="source-over",this.canvas.width=1,this.canvas.height=1,this.renderMask()}get maskColor(){return this._maskColor}set maskColor(e){this._maskColor=e,this.renderMask()}get width(){return this._width}set width(e){this._width=e,this.renderMask()}resizeCanvas(e,t){this.canvas.width=e,this.canvas.height=t,this.renderMask()}renderMask(){this.isActive&&(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.lineWidth=0,this.ctx.strokeStyle=this._maskColor,this.ctx.fillStyle=this._maskColor,this.ctx.beginPath(),this.ctx.rect(0,0,this._width,this.canvas.height),this.ctx.rect(this.canvas.width-this._width,0,this.canvas.width,this.canvas.height),this.ctx.closePath(),this.ctx.fill())}constructor(e){this.isActive=!0,this.canvasWrapper=e,this._maskColor="#000000",this.canvasWrapper.graphicsCoreWrapper.imageAnnoApp.implementations.app.model.appCoreWrapper.appProperties.isStandalone,this._width=0,this.init()}}class sS extends sv{appendDiv(){this.canvasWrapper.graphicsCoreWrapper.imageAnnoApp.implementations.app.model.modelViewWrapper.div.appendChild(this.canvas)}removeDiv(){this.canvasWrapper.graphicsCoreWrapper.imageAnnoApp.implementations.app.model.modelViewWrapper.div.removeChild(this.canvas)}getOffscreenRenderer(){return this.offScreenCtx}clear(){this.offScreenCtx.clearRect(0,0,this.canvas.width,this.canvas.height)}getColorByPos(e,t){if(!this.isActive)return"";let s=this.offScreenCtx.getImageData(e,t,1,1).data;return"rgb(".concat(s[0],",").concat(s[1],",").concat(s[2],")")}constructor(e){super(e.aCanvas.canvas),this.isActive=!0,this.canvasWrapper=e,this.canvas.id="AnnotationOffScreen",this.offScreenCtx.imageSmoothingEnabled=!1}}class sA{pause(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.aCanvas.doPause(e)}resume(){this.aCanvas.doResume()}destroy(){this.aCanvas.destroy(),this.isActive=!1}renderForce(){this.aCanvas.canvasLoopController.stop=!1}resizeCanvas(e,t){this.aCanvas.resizeCanvas(e,t),this.aCanvasOffScreen&&(this.aCanvasOffScreen.canvas.width=e,this.aCanvasOffScreen.canvas.height=t,this.aCanvasOffScreen.canvas.style.width=this.aCanvas.canvas.style.width,this.aCanvasOffScreen.canvas.style.height=this.aCanvas.canvas.style.height)}set isActive(e){this.aCanvas.isActive=e,this.aCanvasOffScreen.isActive=e,this.aCanvasMask.isActive=e,e&&this.aCanvas.loop()}constructor(e,t){this.graphicsCoreWrapper=e,this.aCanvas=new sy(this),this.aCanvas.setLevel4(),this.aCanvasOffScreen=new sS(this),this.aCanvasMask=new sC(this),this.aCanvas.initPost(t)}}class sf{resizeCanvas(e,t){this.graphicsCoreWrapper.canvasWrapper.resizeCanvas(e,t)}render(e){this.graphicsCoreWrapper.imageAnnoApp.implementations.render(e)}constructor(e){this.graphicsCoreWrapper=e}}class sP{initPost(){this.rendererWrapper=new sf(this)}pause(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.canvasWrapper.pause(e)}resume(){this.canvasWrapper.resume()}resizeCanvas(e,t){this.canvasWrapper.resizeCanvas(e,t)}renderForce(){this.canvasWrapper.renderForce()}destroy(){this.canvasWrapper.destroy()}constructor(e,t){this.scaleScreenByRatioImageSize=1,this.imageAnnoApp=e,this.canvasWrapper=new sA(this,t)}}class sx{init(){this.numOfCommand=0}shiftCAMode(e){this.log;let t="set-drawing-mode@"+e.toString();this.io.emitAction(t)}shiftOptionStack(e,t){let s="".concat(e).concat("@").concat(t);this.io.emitAction(s)}modificationStack(e){if(this.log,!e)return}addGeometryStack(e){if(this.log,!e)return;let t="add@"+JSON.stringify(e);this.numOfCommand++,this.io.emitAction(t),this.io.imageAnnoApp.scene.captureScene()}selectionStack(e){if(this.log,e){if(e.isSelected){let t="select".concat("@").concat(JSON.stringify([e.id]));if(this.io.imageAnnoApp.activeCommandController.acProperties.pressShift&&this.io.imageAnnoApp.implementations.app.APP===p.BQ.AnnotationMap){let e=this.io.imageAnnoApp.geometryCommon.gcmdProcessing.getSelectedGeoIDs();if(e.length){this.selectionsStackByID(e);return}}this.io.imageAnnoApp.implementations.app.model.appCoreWrapper.appProperties.compileMode!==p.ct.Production&&this.numOfCommand++,this.io.emitAction(t)}else{let t="deselect".concat("@").concat(JSON.stringify([e.id]));this.numOfCommand++,this.io.emitAction(t)}}}selectionsStackByID(e){this.log;let t="select".concat("@").concat(JSON.stringify(e));this.numOfCommand++,this.io.emitAction(t)}hideStack(e){if(this.log,e){if(e.isHidden){let t="hide@"+e.id;this.numOfCommand++,this.io.emitAction(t)}else{let t="show@"+e.id;this.numOfCommand++,this.io.emitAction(t)}}}hoverStack(e){if(this.log,e){if(e.isOver){let t="enter@"+e.id;this.numOfCommand++,this.io.emitAction(t)}else{let t="leave@"+e.id;this.numOfCommand++,this.io.emitAction(t)}}}hoverPostStack(e){if(this.log,e&&e.isOver){let t="enterPost@"+e.id;this.numOfCommand++,this.io.emitAction(t)}}updateStack(e){if(this.log,!e)return;let t="update@"+JSON.stringify({id:e.id,content:e.data.content});this.numOfCommand++,this.io.emitAction(t)}showPopupStack(e){if(this.log,!e)return;let t="showPopup@"+JSON.parse(JSON.stringify(e)).id;this.numOfCommand++,this.io.emitAction(t)}hidePopupStack(e){if(this.log,!e)return;let t="hidePopup@"+JSON.parse(JSON.stringify(e)).id;this.numOfCommand++,this.io.emitAction(t)}showTextStack(e){if(this.log,!e)return;let t="showText@"+JSON.parse(JSON.stringify(e)).id;this.numOfCommand++,this.io.emitAction(t)}hideTextStack(e){if(this.log,!e)return;let t="hideText@"+JSON.parse(JSON.stringify(e)).id;this.numOfCommand++,this.io.emitAction(t)}startEditingText(e){if(this.log,!e)return;let t="startEditingText@"+e.id;this.numOfCommand++,this.io.emitAction(t)}endEditingText(e){if(this.log,!e)return;let t="endEditingText@"+e.id;this.numOfCommand++,this.io.emitAction(t)}initGhostStack(e){if(this.log,!e)return;let t="add@"+JSON.stringify(e);this.numOfCommand++,this.io.emitAction(t)}showGhostPopupStack(e){if(this.log,!e)return;let t="showGhostPopup@"+JSON.stringify({id:"ghost",mapping:e.data.content});this.numOfCommand++,this.io.emitAction(t)}hideGhostPopupStack(){this.log,this.io.emitAction("hideGhostPopup")}removeGeometryStack(e){if(this.log,!e)return;let t="remove@",s=[];e.forEach(e=>{s.push(e.id)}),this.numOfCommand++,t+=JSON.stringify(s),this.io.emitAction(t),this.io.imageAnnoApp.scene.captureScene()}transformStack(e){if(this.log,!e)return;let t="transform@"+JSON.stringify(e);this.numOfCommand++,this.io.emitAction(t),this.io.imageAnnoApp.scene.captureScene()}pointerOutStack(){this.log;let e=p.Us.PointerOut;this.io.emitAction(e)}getActionString(e,t){return"".concat(e).concat("@").concat("string"==typeof t?t:JSON.stringify(t))}addBase64Stack(e,t){this.io.emitAction("addBase64".concat("@"+e+"@"+t))}base64Stack(e,t){this.io.emitAction("addBase64".concat("@"+e+"@"+t))}selectBase64(e){let t="selectBase64".concat("@").concat(e);this.io.emitAction(t)}constructor(e){this.log=!1,this.io=e,this.init()}}var sw=s(47567);class sI{pushActionTyped(e){switch(e.type){case p.Us.Style:this.io.imageAnnoApp.geometryCommon.gcmdProcessing.updateStyleCustom(e.payload);break;case p.Us.ClusteringPoint:this.io.imageAnnoApp.apiWrapper.environment.toggleClusteringPoint(e.payload);break;case p.Us.Hover:case p.Us.Unhover:this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce()}}pushAction(e){"string"==typeof e?this.doAction(e):"object"==typeof e&&this.pushActionTyped(e)}doAction(e){let t=e.indexOf(sw._),s=t<0?[e]:[e.substring(0,t),e.substring(t+1,e.length)],i=s[1],n=this.io.imageAnnoApp.scene.geometryList,o=this.io.imageAnnoApp.scene.geometryList.length;switch(s[0]){case"style":let r=JSON.parse(s[1]);this.io.imageAnnoApp.geometryCommon.gcmdProcessing.updateStyleCustom(r);break;case p.Us.SetDrawingMode:let a=s[1];this.io.imageAnnoApp.activeCommandController.setActiveCommand(this.io.mappingCommand(a)),this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case p.Us.ActiveColorId:this.io.imageAnnoApp.activeCommandController.setActiveColor(s[1]);break;case p.Us.ToggleMapfilter:this.io.imageAnnoApp.apiWrapper.environment.toggleMapfilter(i),this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case"sliderValue":case"sizeBrush":case"setSketchColor":case"typeBrush":break;case"sizeCanvas":let h=JSON.parse(JSON.stringify(s[1]));this.io.imageAnnoApp.geometryCommon.gcmdSupporting.updateCanvasSize(h);break;case p.Us.ToggleQuickActions:this.io.imageAnnoApp.apiWrapper.environment.toggleActiveCommandChain(i),this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case p.Us.Undo:this.io.imageAnnoApp.geometryCommon.gcmdProcessing.undo(),this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case p.Us.Redo:this.io.imageAnnoApp.geometryCommon.gcmdProcessing.redo(),this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case p.Us.ChangeTheme:this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case p.Us.ToggleDrawingTooltips:this.io.imageAnnoApp.apiWrapper.environment.toggleDrawingTooltips(i),this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case p.Us.ToggleGrid:this.io.imageAnnoApp.apiWrapper.environment.toggleGrid(i),this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case p.Us.ToggleMeasure:this.io.imageAnnoApp.apiWrapper.environment.toggleMeasure(i),this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case p.Us.ShiftUnit:this.io.imageAnnoApp.apiWrapper.environment.shiftUnit(),this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case p.Us.DumpIconsBase64s:let c=JSON.parse(s[1]);Object.keys(c).forEach(e=>{this.io.imageAnnoApp&&this.io.imageAnnoApp.activeCommandController.base64Processing("addBase64",e,c[e])}),this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case p.Us.AddIconBase64:let l=JSON.parse(s[1]);Object.keys(l).forEach(e=>{this.io.imageAnnoApp.activeCommandController.base64Processing(s[0],e,l[e])}),this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case p.Us.SelectIconBase64:this.io.imageAnnoApp.activeCommandController.base64Processing(s[0],s[1]),this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case p.Us.InclusiveSelect:for(;o--;)if(n[o].id===i){n[o].isSelected=!0;break}this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case p.Us.InclusiveDeselect:for(;o--;)if(n[o].id===i){n[o].isSelected=!1;break}this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case p.Us.ExclusiveSelect:for(;o--;)n[o].id===i?n[o].isSelected=!0:n[o].isSelected&&(n[o].isSelected=!1);this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case p.Us.ExclusiveDeselect:for(;o--;)n[o].id!==i&&n[o].isSelected&&(n[o].isSelected=!1);this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case p.Us.Remove:this.io.imageAnnoApp.geometryCommon.gcmdProcessing.removeByIDs(s[1]),this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case p.Us.RemoveSelected:this.io.imageAnnoApp.geometryCommon.gcmdProcessing.removeAllCapturedGeoGroup(),this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case p.Us.Update:this.io.imageAnnoApp.activeCommandController.processingUpdate(JSON.parse(s[1]).id,s[1]),this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case p.Us.ReorderNumberedPoints:this.io.imageAnnoApp.geometryCommon.gcmdProcessing.reorderNumberedPoints(JSON.parse(i)),this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case p.Us.ReorderNumberedTourPoints:case p.Us.Unhighlight:case p.Us.Hover:case p.Us.Unhover:this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case p.Us.Enter:for(;o--;)n[o].id===i?(n[o].isHover=!0,n[o].isHiddenValue?(n[o].renderer.tOver=0,n[o].visibility=.2):n[o].visibility=1):n[o].isHover&&(n[o].isHover=!1,n[o].isHiddenValue?n[o].visibility=0:n[o].visibility=1);this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case p.Us.Leave:for(;o--;)n[o].isHover=!1,n[o].isHiddenValue&&(n[o].visibility=0);this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case p.Us.Show:this.io.imageAnnoApp.activeCommandController.unhide(JSON.parse(s[1])),this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case p.Us.Hide:this.io.imageAnnoApp.activeCommandController.hide(JSON.parse(s[1])),this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case p.Us.HidePopup:for(;o--;)n[o].id===i&&n[o].hidePopUpSummary();this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case p.Us.ShowPopup:for(;o--;)n[o].id===i&&n[o].showPopupSummary();this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case p.Us.Dump:this.io.imageAnnoApp.geometryCommon.gcmdSelecting.deSelectAllObjects(),this.io.imageAnnoApp.geometryCommon.gcmdProcessing.removeAllCapturedGeo();let d=new Map,m=JSON.parse(i);Object.keys(m).forEach(e=>{d.set(e,this.convertShapeToIOGeometry(m[e]))}),this.io.imageAnnoApp.activeCommandController.reUndoProcessingStorymaps(d),this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case p.Us.InitGhost:let u=JSON.parse(s[1]),g=[],v=u.POLYGON_MULTIPLE;if(v)for(let e=0;e<v.length;++e){let t=this.convertShapeToIOGeometry(v[e]);g.push(t)}this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case p.Us.EnterGhost:case p.Us.LeaveGhost:case p.Us.AddGhost:case p.Us.RemoveGhost:this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case p.Us.PolylineConstraintLength:this.io.imageAnnoApp.activeCommandController.setupPolylineConstraintLength(parseFloat(i)),this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case p.Us.PolylineConstraintLengthPercentage:this.io.imageAnnoApp.activeCommandController.setupPolylineConstraintLengthPercentage(parseFloat(i)),this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case p.Us.DisableExcept:let y=JSON.parse(s[1]);this.io.imageAnnoApp.activeCommandController.disableExcept(y),this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case p.Us.Highlight:this.io.imageAnnoApp.activeCommandController.highlight(s[1]),this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce()}}getProjectedBoundingVec(e){let t=Number.MAX_SAFE_INTEGER,s=Number.MAX_SAFE_INTEGER,i=Number.MIN_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER;return Object.keys(e).forEach(o=>{for(let r=0;r<e[o];++r)t>e[o][r].proX&&(t=e[o][r].proX),s>e[o][r].proY&&(s=e[o][r].proY),i<e[o][r].proX&&(i=e[o][r].proX),n<e[o][r].proY&&(n=e[o][r].proY)}),[t,s,i,n]}convertShapeToIOGeometry(e){let t=this.io.mappingCommand(e.type),s=new g(e.id,p.zq[t],!1,!1,e.isHidden);return s.pushNode(e.nodes.map(e=>(0,p.Qi)(e.sx,e.sy,e.long,e.lat,e.ele,e.proX,e.proY,e.proZ))),void 0!==e.data&&(s.data=e.data),void 0!==e.styles&&(s.styles=e.styles),s}constructor(e){this.io=e}}class sR{mappingCommand(e){return e===p.uA.SMARTDRAWING?e=p.uA.SMARTDRAWING_DEEPLEARNING:e===p.uA.POLYGON?e=p.uA.POLYGON_GRAPH:e===p.uA.POLYGON_GRAPH?e=p.uA.POLYGON:e===p.uA.FREEHAND_POLYGON&&(e=p.uA.FREEHAND_POLYGON_GRAPH),e}emitAction(e){this.imageAnnoApp.implementations.app.INSPECTION&&(e.split("@")[0],e.split("@")[0],e.split("@")[0]),this.imageAnnoApp.implementations.app.model.ioWrapper.emitAction.emitAction(e)}constructor(e){this.imageAnnoApp=e,this.stateProcessingAnnotation=new sI(this),this.eventListenerAnnotation=new sx(this)}}class sb{renderPost(e){if(!this.host.scene.capture||!this.host.scene.capture.isGhost){if(this.host.stopRender){this.host.tInit=0,this.host.tLeave=0,this.host.t=0,this.host.isActive=!1;return}if(this.host.v.x=.5*e.canvas.width,this.host.smartEvasion?this.host.scene.annotationInstance.activeCommandController.m.y<.5*e.canvas.height?this.host.v.y=e.canvas.height-50:this.host.v.y=50:this.host.v.y=e.canvas.height-50,e.lineWidth=2,e.fillStyle="rgba(0,0,0,0.5)",e.strokeStyle=p.$C.White,0<this.host.tInit&&this.host.tInit<1){let t=this.host.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.host.t);if(0<this.host.t){e.beginPath(),e.arc(this.host.v.x,this.host.v.y,t*this.host.radius,0,12.56636),e.closePath(),e.fill(),e.stroke();let s=t*this.host.sizeTrash;e.drawImage(this.host.imgTrash,this.host.v.x-.5*s,this.host.v.y-.5*s,s,s),this.host.isShow=!0}else this.host.isShow=!1;this.host.t+=.005}else if(0<this.host.tLeave&&this.host.tLeave<1){let t=this.host.scene.annotationInstance.renderer.numericalMotion.easeInElastic(this.host.tLeave),s=this.host.radius-t*this.host.radius;if(0<s){if(this.host.isShow){e.beginPath(),e.arc(this.host.v.x,this.host.v.y,s,0,12.56636),e.closePath(),e.fill(),e.stroke();let i=this.host.sizeTrash-t*this.host.sizeTrash;e.drawImage(this.host.imgTrash,this.host.v.x-.5*i,this.host.v.y-.5*i,i,i),this.host.t=-.2,t<.5&&this.host.removeGeo()}.2<this.host.tLeave&&(this.host.isShow=!1,this.host.exceptionByLeaderline=!1)}}}}constructor(e){this.host=e}}class sL{updateTime(){if(this.host.scene.annotationInstance.activeCommandController.acProperties.isDragging){if(void 0===this.host.scene.Capture)this.host.tInit=-1.01;else{if(this.host.scene.Capture.type===p.zq.APOINT||this.host.scene.Capture.type===p.zq.AMIDPOINT||this.host.scene.Capture.type===p.zq.ANODE||this.host.scene.Capture.type===p.zq.POLYGON_GRAPH&&this.host.scene.Capture.isSelectedNode){this.host.isActive=!1;return}this.host.isActive=!0,this.host.tInit=.01}this.host.exceptionByLeaderline?this.host.tLeave+=.0025:this.host.tLeave=0}else this.host.stopRender?this.host.tInit+=.015:this.host.tInit=1.1;this.host.scene.Capture&&this.host.scene.annotationInstance.activeCommandController.acProperties.isUp&&(this.host.tLeave+=.0025)}constructor(e){this.host=e}}class sO{updateTime(){this.timer.updateTime()}render(e){this.updateTime(),this.isInside(),this.isActive&&this.renderer.renderPost(e)}isInside(){this.isActive&&((0,p.CV)([this.v.x,this.v.y,this.v.z],[this.scene.annotationInstance.activeCommandController.m.x,this.scene.annotationInstance.activeCommandController.m.y,0])<this.distanceForDetection?(this.radius=48,this.sizeTrash=48,this.hover=!0,this.hoverPre!==this.hover&&(this.hoverPre=this.hover,this.t=.3)):(this.radius=24,this.sizeTrash=24,this.hover=!1,this.hoverPre!==this.hover&&(this.hoverPre=this.hover,this.t=0)))}removeSelectedShapesByBlackhole(e){if(this.scene.capture&&this.scene.capture.isGhost)return;let t=this.scene.annotationInstance.scene.geometryList.length,s=[];for(;t--;){let i=this.scene.annotationInstance.scene.geometryList[t];if(i.isSelected||i.isHoverValue||i.isCapturedValue){if(i.isUnderConstruction)continue;if(i.type===p.zq.TEXT_LEADERLINE){if(i.leaderline){if(42>(0,p.Sp)(i.leaderline.v2,this.v)){i.removeLeaderline();let t=[];for(let s=0;s<e.length;++s)e[s].id!==i.id&&t.push(e[s]);e=t}else s.push(i)}else s.push(i)}else s.push(i)}}for(let e=0;e<s.length;++e)s[e].remove(!1);e.length>0&&this.scene.annotationInstance.io.eventListenerAnnotation.removeGeometryStack(e)}removeGeo(){if(this.scene.capture&&this.scene.capture.isGhost||!this.hover||!this.scene.Capture||!this.scene.annotationInstance.activeCommandController.acProperties.isUp)return;if(this.scene.Capture.type===p.zq.TEXT_LEADERLINE){let e=this.scene.Capture;if(e.leaderline&&e.leaderline.isMouseInside(this.scene.annotationInstance.activeCommandController.m.x,this.scene.annotationInstance.activeCommandController.m.y)){42>(0,p.Sp)(this.v,e.leaderline.v2)&&e.removeLeaderline(),this.scene.Capture=void 0,this.tInit=-1.01,this.tLeave=.01,this.scene.annotationInstance.activeCommandController.acProperties.isDragging=!0,this.exceptionByLeaderline=!0;return}this.removeForce&&(this.scene.Capture=void 0,this.stopRender=!0)}else this.removeForce&&(this.scene.Capture=void 0,this.stopRender=!0);let e=this.scene.geometryList.length;if(0!==e)for(;e--;)this.scene.geometryList[e]&&!0===this.scene.geometryList[e].isSelected&&this.removeForce&&(this.scene.Capture=void 0,this.stopRender=!0)}constructor(e){this.isActive=!1,this.radius=24,this.t=0,this.tInit=0,this.tLeave=0,this.needRender=!1,this.hasCapture=!1,this.isUp=!1,this.isShow=!1,this.hover=!1,this.hoverPre=!1,this.distanceForDetection=120,this.sizeTrash=24,this.stopRender=!1,this.exceptionByLeaderline=!1,this.offX=-1,this.smartEvasion=!0,this.removeForce=!0,this.scene=e,this.removeForce=!0,this.renderer=new sb(this),this.timer=new sL(this),this.v=new p.h9(0,0),this.imgTrash=new Image,this.imgTrash.src="".concat(this.scene.annotationInstance.implementations.app.CONFIG.config.BASE_URL,"/static/storymaps-xgraphics/images/theme-assets/common/trash-24.svg")}}class sV{updateGhostSnappingVec(e){e?this.vecGhostSnapping=e:this.vecGhostSnapping=void 0}render(e){if(this.vecGhostSnapping){let t=this.objectSnapping.renderer.imageAnnoApp.scene.paramsEditing.croppingMaskParams.x,s=this.objectSnapping.renderer.imageAnnoApp.scene.paramsEditing.croppingMaskParams.y;this.tOver+=.015,this.objectSnapping.renderer.draw.shape.snapping.circleBG(e,this.vecGhostSnapping.x-t,this.vecGhostSnapping.y-s,this.objectSnapping.toleranceSnapping,this.objectSnapping.renderer.numericalMotion.easeOutElastic2(this.tOver)),this.renderGhostGeo(e,t,s)}else this.tOver=0}renderGhostGeo(e,t,s){if(this.objectSnapping.renderer.imageAnnoApp.scene.capture&&this.vecGhostSnapping&&this.objectSnapping.renderer.imageAnnoApp.scene.capture.type!==p.zq.POINT_REGULAR){if(this.objectSnapping.renderer.imageAnnoApp.scene.capture.type!==p.zq.POINT_NUMBERED){if(this.objectSnapping.renderer.imageAnnoApp.scene.capture.type===p.zq.ANODE||this.objectSnapping.renderer.imageAnnoApp.scene.capture.type===p.zq.AMIDPOINT){let i=this.objectSnapping.renderer.imageAnnoApp.scene.capture;if(i.aEdges[0]&&i.aEdges[0].pGraph.type===p.zq.POLYLINE_BENDING){let n=i.aEdges[0].pGraph,o=this.getVecFromAPolylineGraph(n);this.objectSnapping.renderer.draw.shape.line.polylineByVecGhost(e,n.styleComponent.renderStyle,o,[t,s],!1,!1,.5);return}if(i.edges[0]&&i.edges[0].type===p.zq.ARROW_DOUBLE||i.edges[0].type===p.zq.ARROW_SINGLE){let n=i.edges[0],o=this.getVecFromArrow(n),r=this.computeVertex(o,[t,s]),a=this.computeWeight(n.getVecs(),.5),h=this.computeControlPoint(r,a);this.drawSpline(e,n.getVecs(),r,h,n);return}}else if(this.objectSnapping.renderer.imageAnnoApp.scene.capture.type===p.zq.POLYGON_GRAPH){let i=this.objectSnapping.renderer.imageAnnoApp.scene.capture,n=this.getVecFromAPolygonGraph(i,[t,s]);this.objectSnapping.renderer.draw.shape.area.polygonByVecGhost(e,i.styleComponent.renderStyle,n,!1,!1,.1);return}else if(this.objectSnapping.renderer.imageAnnoApp.scene.capture.type===p.zq.TEXT_LEADERLINE){let t=this.objectSnapping.renderer.imageAnnoApp.scene.capture;if(t.leaderline&&t.IsSelectedReaderline){let s=new p.h9(t.leaderline.v1Render.x,this.vecGhostSnapping.y),i=this.vecGhostSnapping;this.objectSnapping.renderer.draw.shape.text.renderLeaderLine(e,t.styleComponent,t.vecOffset,s,i,t.renderer.t,t.leaderline.isUpperDia,t.leaderline.isHover,t.isSelectedValue)}return}}}}getVecFromAPolylineGraph(e){let t=e.getVecs(),s=[];if(this.vecGhostSnapping)for(let e=0;e<t.length;++e)(0,p.Sp)(t[e],this.vecGhostSnapping)<this.objectSnapping.toleranceSnapping?s.push(this.vecGhostSnapping):s.push(t[e]);return s}getVecFromAPolygonGraph(e,t){let s=e.getVecs(),i=[];if(this.vecGhostSnapping)for(let e=0;e<s.length;++e)(0,p.Sp)(s[e],this.vecGhostSnapping)<this.objectSnapping.toleranceSnapping?i.push(new p.h9(this.vecGhostSnapping.x-t[0],this.vecGhostSnapping.y-t[1],0)):i.push(new p.h9(s[e].x-t[0],s[e].y-t[1],0));return i}getVecFromArrow(e){let t=e.getVecs(),s=[];if(this.vecGhostSnapping)for(let e=0;e<t.length;++e)(0,p.Sp)(t[e],this.vecGhostSnapping)<this.objectSnapping.toleranceSnapping?s.push(this.vecGhostSnapping):s.push(t[e]);return s}computeVertex(e,t){let s=[];for(let i of e)s.push(i.x-t[0],i.y-t[1]);return s}computeWeight(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=[];for(let i=0;i<e.length;++i)s.push(t);return s}computeControlPoint(e,t){let s=[...e],i=[];for(let e=0;e<s.length-4;e+=2)i=i.concat(eE.getControlPoints(s[e],s[e+1],s[e+2],s[e+3],s[e+4],s[e+5],t[e]));return i}drawSpline(e,t,s,i,n){let o=s.length,r=this.objectSnapping.renderer.draw.shape.curve;r.curveQuadraticArrow(e,n.styleComponent.renderStyle,s[0],s[1],i[0],i[1],s[2],s[3],!0,t,!1,.5,this.objectSnapping.renderer.numericalMotion.easeOutElastic2(this.tOver),!1,n.styleComponent.state.themeColorId,!1),r.curveQuadraticArrow(e,n.styleComponent.renderStyle,s[o-2],s[o-1],i[2*o-10],i[2*o-9],s[o-4],s[o-3],!0,t,!1,.5,this.objectSnapping.renderer.numericalMotion.easeOutElastic2(this.tOver),!1,n.styleComponent.state.themeColorId,!1),r.cArrowByTranslation(e,n.styleComponent.renderStyle,new p.h9(s[4],s[5]),new p.h9(i[2],i[3]),s[4],s[5],n.arrowScale,n.scaleForRender,n.isHoverValue,n.isGrayColor,n.visibilityValue,1,n.isSelectedValue,n.styleComponent.state.themeColorId),n.type===p.zq.ARROW_DOUBLE&&r.cArrowByTranslation(e,n.styleComponent.renderStyle,new p.h9(s[0],s[1]),new p.h9(i[0],i[1]),s[0],s[1],n.arrowScale,n.scaleForRender,!1,n.isGrayColor,n.visibilityValue,1,n.isSelectedValue,n.styleComponent.state.themeColorId)}checkMidPtPolylineBending(){if(this.objectSnapping.renderer.imageAnnoApp.scene.capture&&this.objectSnapping.renderer.imageAnnoApp.scene.capture.type===p.zq.ANODE){let e=this.objectSnapping.renderer.imageAnnoApp.scene.capture;e.aEdges[0]&&e.aEdges[0].pGraph.updateMidVec()}}checkLeaderlineOffset(){if(this.objectSnapping.renderer.imageAnnoApp.scene.capture&&this.objectSnapping.renderer.imageAnnoApp.scene.capture.type===p.zq.TEXT_LEADERLINE){let e=this.objectSnapping.renderer.imageAnnoApp.scene.capture;if(e&&e.leaderline&&this.objectSnapping.aGhostSnapping.vecGhostSnapping){let t=e.leaderline.v2.x-this.objectSnapping.aGhostSnapping.vecGhostSnapping.x,s=e.leaderline.v2.y-this.objectSnapping.aGhostSnapping.vecGhostSnapping.y;e.widthOffset+=t,e.heightOffset+=s}}}constructor(e){this.isHover=!1,this.vecGhostSnapping=void 0,this.objectSnapping=e,this.t=0,this.tOver=0,this.tOverPopupSummary=0,this.tDown1=0,this.tDown2=0,this.tUp=0}}class sN{updateGhostSnappingVec(e){this.objectSnapping.aGhostSnapping.updateGhostSnappingVec(e)}isSnappingToCircle(e){if(!this.objectSnapping.renderer.imageAnnoApp.scene.capture||this.objectSnapping.renderer.imageAnnoApp.scene.capture.textLeaderline)return!1;for(let t=0;t<this.objectSnapping.renderer.imageAnnoApp.scene.listACircleWrapperr.length;++t){let s=this.objectSnapping.renderer.imageAnnoApp.scene.listACircleWrapperr[t].isMouseInsideSnapFrom(e);if(s&&s!==e)return this.updateGhostSnappingVec(s),!0}return!1}isSnappingToRectangle(e){if(!this.objectSnapping.renderer.imageAnnoApp.scene.capture||this.objectSnapping.renderer.imageAnnoApp.scene.capture.textLeaderline)return!1;for(let t=0;t<this.objectSnapping.renderer.imageAnnoApp.scene.listARectangleWrapper.length;++t){let s=this.objectSnapping.renderer.imageAnnoApp.scene.listARectangleWrapper[t].isMouseInsideSnapFrom(e);if(s&&s!==e)return this.updateGhostSnappingVec(s),!0}return!1}donotSnapForCircle(e){return!!this.objectSnapping.renderer.imageAnnoApp.scene.capture&&this.objectSnapping.renderer.imageAnnoApp.scene.capture.type===p.zq.CIRCLE}donotSnapForCircleRect(e){return this.objectSnapping.renderer.imageAnnoApp.scene.listBasePoint[e].type===p.zq.ANODE_CIRCLE||this.objectSnapping.renderer.imageAnnoApp.scene.listBasePoint[e].type===p.zq.ANODE_RECT}isSnappingItself(e){let t=this.objectSnapping.renderer.imageAnnoApp.scene.capture,s=this.objectSnapping.renderer.imageAnnoApp.scene.listBasePoint[e];return!!t&&!!s&&(t.type===p.zq.ANODE||t.type===p.zq.AMIDPOINT)&&(s.type===p.zq.ANODE||s.type===p.zq.AMIDPOINT)&&t.edges.length>0&&s.edges.length>0&&t.edges[0]===s.edges[0]}isAllowSnappingPointToPoint(e){let t=this.objectSnapping.renderer.imageAnnoApp.scene.capture;return!t||t.type!==p.zq.POINT_NUMBERED&&t.type!==p.zq.POINT_REGULAR||!this.objectSnapping.renderer.imageAnnoApp.scene.listBasePoint[e]||this.objectSnapping.renderer.imageAnnoApp.scene.listBasePoint[e]===t||this.objectSnapping.renderer.imageAnnoApp.scene.listBasePoint[e].type!==p.zq.POINT_NUMBERED&&this.objectSnapping.renderer.imageAnnoApp.scene.listBasePoint[e].type!==p.zq.POINT_REGULAR}isAllowSnappingNodeToNodeInSameShape(e){if(this.objectSnapping.renderer.imageAnnoApp.scene.capture&&(this.objectSnapping.renderer.imageAnnoApp.scene.capture.type===p.zq.ANODE||this.objectSnapping.renderer.imageAnnoApp.scene.capture.type===p.zq.AMIDPOINT)){let t=this.objectSnapping.renderer.imageAnnoApp.scene.capture;if(t.edges[0]){let s=t.edges[0].getVecs();for(let t=0;t<s.length;++t)if(this.objectSnapping.renderer.imageAnnoApp.scene.listBasePoint[e]&&this.objectSnapping.renderer.imageAnnoApp.scene.listBasePoint[e].vec===s[t])return!1}else if(t.aEdges[0]){let s=t.aEdges[0].pGraph.getVecs();for(let t=0;t<s.length;++t)if(this.objectSnapping.renderer.imageAnnoApp.scene.listBasePoint[e]&&this.objectSnapping.renderer.imageAnnoApp.scene.listBasePoint[e].vec===s[t])return!1}}return!0}isAllowMidNodePolylineBending(e){if(this.objectSnapping.renderer.imageAnnoApp.scene.listBasePoint[e].type===p.zq.AMIDPOINT){let t=this.objectSnapping.renderer.imageAnnoApp.scene.listBasePoint[e];if(t.aEdges[0]&&t.aEdges[0].pGraph.type===p.zq.POLYLINE_BENDING)return!0}return!1}constructor(e){this.objectSnapping=e}}class sk{updateGhostSnappingVec(e){this.aGhostSnapping.updateGhostSnappingVec(e)}render(e){this.aGhostSnapping.render(e)}autoSnappingTracker(e,t){return this.renderer.imageAnnoApp.interactionMode===p.An.Drawing&&!!e&&!!this.renderer.imageAnnoApp.activeCommandController.acProperties.isActivateSnapping&&((this.frameValue++%10==0||t)&&this.updateSnapping(e,t),!1)}updateSnapping(e,t){let s=this.renderer.imageAnnoApp.scene.capture;if(s&&(s.type===p.zq.ANODE_RECT||s.type===p.zq.ANODE_CIRCLE)||s&&(s.type===p.zq.ARROW_SINGLE||s.type===p.zq.ARROW_DOUBLE)||s&&s.type===p.zq.TEXT_LEADERLINE&&(!s.IsSelectedReaderline||void 0===s.leaderline))return!1;if(this.renderer.imageAnnoApp.scene.capture&&this.renderer.imageAnnoApp.scene.capture.type===p.zq.POLYGON_GRAPH){let t=this.renderer.imageAnnoApp.scene.capture.getVecForSnapping();t&&(e=t)}let i=this.toleranceSnapping,n=-1,o=this.renderer.imageAnnoApp.scene.listBasePoint.length;for(;o--;){let t=this.renderer.imageAnnoApp.scene.listBasePoint[o];if(t.vec.x&&s!==t){if(t.isCollapse||this.snappingProcessor.isAllowMidNodePolylineBending(o))continue;let s=(0,p.Sp)(t.vec,e);s<i&&(i=s,n=o)}}if(this.snappingProcessor.donotSnapForCircle(n))return!1;if(-1===n){if(t){let t=!1;for(let i=0;i<this.renderer.imageAnnoApp.scene.listAPolygonGraphWrapper.length;++i){let n=this.renderer.imageAnnoApp.scene.listAPolygonGraphWrapper[i];if(n!==s){let i=n.findClosestVec(e);i&&(0,p.Sp)(i,e)<this.toleranceSnapping&&(e.x=i.x,e.y=i.y,t=!0,n.updatePostTransformation(),s&&s.aEdges&&s.aEdges[0]&&s.aEdges[0].pGraph.updatePostTransformation())}n.graphCore.selVec=void 0,n.graphCore.selectedVec=void 0,n.graphCore.selVecForTextLeaderline=void 0,n.graphCore.selMidVec=void 0}if(t)return!0}else for(let t=0;t<this.renderer.imageAnnoApp.scene.listAPolygonGraphWrapper.length;++t){let i=this.renderer.imageAnnoApp.scene.listAPolygonGraphWrapper[t];if(i!==s){let t=i.findClosestVec(e);if(t&&(0,p.Sp)(t,e)<this.toleranceSnapping){let e=new p.h9(t.x,t.y);return this.updateGhostSnappingVec(e),!0}}this.updateGhostSnappingVec(void 0)}}if(this.snappingProcessor.isSnappingItself(n)||!this.snappingProcessor.isAllowSnappingPointToPoint(n)||!this.snappingProcessor.isAllowSnappingNodeToNodeInSameShape(n))return!1;if(this.snappingProcessor.isSnappingToRectangle(e)||this.snappingProcessor.isSnappingToCircle(e))return t&&(this.aGhostSnapping.checkLeaderlineOffset(),this.aGhostSnapping.vecGhostSnapping&&(e.x=this.aGhostSnapping.vecGhostSnapping.x,e.y=this.aGhostSnapping.vecGhostSnapping.y,this.aGhostSnapping.checkMidPtPolylineBending())),!0;if(i<this.toleranceSnapping&&this.renderer.imageAnnoApp.scene.listBasePoint[n].vec.x){if(this.snappingProcessor.donotSnapForCircleRect(n))return!1;if(t){let t=this.renderer.imageAnnoApp.scene.listBasePoint[n].vec.x-e.x,i=this.renderer.imageAnnoApp.scene.listBasePoint[n].vec.y-e.y;s&&s.type===p.zq.TEXT_LEADERLINE&&(s.widthOffset-=t,s.heightOffset-=i),e.x=this.renderer.imageAnnoApp.scene.listBasePoint[n].vec.x,e.y=this.renderer.imageAnnoApp.scene.listBasePoint[n].vec.y,this.aGhostSnapping.checkMidPtPolylineBending()}else{let e=this.renderer.imageAnnoApp.scene.listBasePoint[n].vec.x,t=this.renderer.imageAnnoApp.scene.listBasePoint[n].vec.y,s=new p.h9(e,t);this.updateGhostSnappingVec(s)}}else this.updateGhostSnappingVec(void 0);return!1}constructor(e){this.toleranceSnapping=19,this.frameValue=0,this.renderer=e,this.snappingProcessor=new sN(this),this.aGhostSnapping=new sV(this)}}class sE{update(){}constructor(e){this.optimizer=e}}class sT extends sE{update(){(this.renderer.imageAnnoApp.activeCommandController.acProperties.isZooming||this.needUpdateComputeCollision)&&(this.collisionDetectionCompute(),this.needUpdateComputeCollision=!1),(this.needOptimization||!this.isDoneOptimization)&&this.updatePos()}updatePos(){for(let e=0;e<this.renderer.imageAnnoApp.scene.listATextleaderlineWrapper.length;++e)this.renderer.imageAnnoApp.scene.listATextleaderlineWrapper[e].collision.update()}collisionDetectionCompute(){for(let e=0;e<this.renderer.imageAnnoApp.scene.listATextleaderlineWrapper.length;++e)this.renderer.imageAnnoApp.scene.listATextleaderlineWrapper[e].collision.neighborShapes=[];this.renderer.imageAnnoApp.activeCommandController.acProperties.needHideTextLeaderLine&&this.collisionDetection(this.renderer.imageAnnoApp.scene.listATextleaderlineWrapper)}reposition(){this.renderer.imageAnnoApp.activeCommandController.acProperties.needrePositionTextLeaderLine}collisionDetection(e){if(e[0]&&!e[0].scene.annotationInstance.activeCommandController.acProperties.needCollisionDetection)return;let t=!0;for(let s=0;s<e.length-1;++s){let i=[e[s].collision.minVec,e[s].collision.maxVec];for(let n=s+1;n<e.length;++n){let o=[e[n].collision.minVec,e[n].collision.maxVec];(0,p.Y4)(i,o)&&(e[s].collision.neighborShapes.push(e[n]),e[n].collision.neighborShapes.push(e[s]),this.needOptimization=!0,t=!1)}}this.isDoneOptimization=t,t&&(this.needOptimization=!1)}constructor(e){super(e),this.needUpdateComputeCollision=!1,this.needOptimization=!1,this.isDoneOptimization=!0,this.renderer=e.optimizer.renderer}}class sD extends sE{update(){this.optimizerTextleaderlineByCollision()}optimizerTextleaderlineByCollision(){for(let e=0;e<this.optimizer.optimizer.renderer.imageAnnoApp.scene.listATextleaderlineWrapper.length;++e){let t=this.optimizer.optimizer.renderer.imageAnnoApp.scene.listATextleaderlineWrapper[e];t.collision.isCollided=!1,t.collision.numOrder=-1,t.isCollapse=!1}let e=0;for(let t=0;t<this.optimizer.optimizer.renderer.imageAnnoApp.scene.listATextleaderlineWrapper.length;++t){let s=this.optimizer.optimizer.renderer.imageAnnoApp.scene.listATextleaderlineWrapper[t];for(let t=0;t<this.optimizer.optimizer.renderer.imageAnnoApp.scene.listATextleaderlineWrapper.length;++t){let i=this.optimizer.optimizer.renderer.imageAnnoApp.scene.listATextleaderlineWrapper[t];i!==s&&(0,p.Y4)([s.collision.minVec,s.collision.maxVec],[i.collision.minVec,i.collision.maxVec])&&(s.collision.isCollided=!0,s.collision.numOrder=e++,s.isCollapse=!0)}}}optimizerTextleaderlineByCollisionCostBased(){for(let e=0;e<this.optimizer.optimizer.renderer.imageAnnoApp.scene.listATextleaderlineWrapper.length;++e){let t=this.optimizer.optimizer.renderer.imageAnnoApp.scene.listATextleaderlineWrapper[e];t.collision.isCollided=!1,t.collision.numOrder=-1,t.isCollapse=!1}let e=0;for(let t=0;t<this.optimizer.optimizer.renderer.imageAnnoApp.scene.listATextleaderlineWrapper.length;++t){let s=this.optimizer.optimizer.renderer.imageAnnoApp.scene.listATextleaderlineWrapper[t];if(!s.isCapturedValue)for(let t=0;t<this.optimizer.optimizer.renderer.imageAnnoApp.scene.listATextleaderlineWrapper.length;++t){let i=this.optimizer.optimizer.renderer.imageAnnoApp.scene.listATextleaderlineWrapper[t];if(i!==s&&(0,p.Y4)([s.collision.minVec,s.collision.maxVec],[i.collision.minVec,i.collision.maxVec])){s.collision.isCollided=!0,s.collision.numOrder=e++,s.isCollapse=!0;break}}}}constructor(e){super(e)}}class sz extends sE{update(){this.optimizerTextleaderlineByNone()}optimizerTextleaderlineByNone(){for(let e=0;e<this.optimizer.optimizer.renderer.imageAnnoApp.scene.listATextleaderlineWrapper.length;++e){let t=this.optimizer.optimizer.renderer.imageAnnoApp.scene.listATextleaderlineWrapper[e];t.isRenderCollapse=!1,t.txtDiv.divText&&t.txtDiv.divText.hidden&&(t.txtDiv.divText.hidden=!1)}}constructor(e){super(e)}}class sM extends sE{update(){this.optimizerTextleaderlineByZoom()}optimizerTextleaderlineByZoom(){}constructor(e){super(e)}}class sG{get type(){return this._type}set type(e){switch(this._type=e,this.optimizer.renderer.imageAnnoApp.implementations.app.PRODUCTION,e){case p.Nv.Zoom:this.activeOptimizer=new sM(this);return;case p.Nv.Collision:this.activeOptimizer=new sD(this);return;case p.Nv.Agent:this.activeOptimizer=new sT(this);return;default:this.activeOptimizer=new sz(this);return}}update(){this.activeOptimizer.update()}constructor(e,t){this.optimizer=e,this.type=t}}class sW{mouseClick(e,t){return!1}mouseMove(e,t){}update(){}render(e){}constructor(e){this.optimizer=e}}class sB{update(){this.updatePoints(),this.listNPoint=this.buildConnectivity(this.listNPoint),this.listRPoint=this.buildConnectivity(this.listRPoint),this.initGeometry();let e=this.buildGraph(this.listNPoint),t=this.buildGraph(this.listRPoint);if(e&&t){this.addClusterByGeometries(e,p.zq.POINT_NUMBERED),this.addClusterByGeometries(t,p.zq.POINT_REGULAR),this.postUpdateCollisionBasedonGraph();let s=this.needDecompose();s.length>0&&(this.splitClusters(s),this.postMergeCluster())}}initGeometry(){this.optimizer.renderer.initGeometry()}addClusterByGeometries(e,t){this.optimizer.renderer.addClusterByGeometries(e,t)}updatePoints(){this.listNPoint=[],this.listRPoint=[];for(let e=0;e<this.optimizer.optimizer.optimizer.renderer.imageAnnoApp.scene.listNPoint.length;++e)if(!this.optimizer.optimizer.optimizer.renderer.imageAnnoApp.scene.listNPoint[e].isHidden&&this.optimizer.optimizer.optimizer.renderer.imageAnnoApp.scene.listNPoint[e].isRenderable){let t=this.optimizer.optimizer.optimizer.renderer.imageAnnoApp.scene.listNPoint[e];t.collision.reset(),this.listNPoint.push(t)}for(let e=0;e<this.optimizer.optimizer.optimizer.renderer.imageAnnoApp.scene.listRPoint.length;++e)if(!this.optimizer.optimizer.optimizer.renderer.imageAnnoApp.scene.listRPoint[e].isHidden&&this.optimizer.optimizer.optimizer.renderer.imageAnnoApp.scene.listRPoint[e].isRenderable){let t=this.optimizer.optimizer.optimizer.renderer.imageAnnoApp.scene.listRPoint[e];t.collision.reset(),this.listRPoint.push(t)}}buildConnectivity(e){for(let t=0;t<e.length;++t){let s=e[t];for(let i=t+1;i<e.length;++i){let t=e[i];!t.isCollapse&&t!==s&&(0,p.Y4)([s.collision.minVec,s.collision.maxVec],[t.collision.minVec,t.collision.maxVec])&&(s.collision.isCollided=!0,s.isCollapse=!0,s.numVisit=0,s.collision.neighborShapes.push(t),t.collision.isCollided=!0,t.isCollapse=!0,t.numVisit=0,t.collision.neighborShapes.push(s))}}return e}buildGraph(e){let t=[];for(let s=0;s<e.length;++s){let i;let n=[],o=[e[s]];o[0].collision.isVisited=!0,n.push(o[0]);let r=0;for(;void 0!==(i=o.shift());){for(let e=0;e<i.collision.neighborShapes.length;++e)i.collision.neighborShapes[e].collision.isVisited||(i.collision.neighborShapes[e].collision.isVisited=!0,o.push(i.collision.neighborShapes[e]),n.push(i.collision.neighborShapes[e]));if(r++>1e3)return}n.length>1&&t.push(n)}return t}postUpdateCollisionBasedonGraph(){for(let e=0;e<this.optimizer.renderer.clustersNPoint.length;++e)this.updateByQueue(this.optimizer.renderer.clustersNPoint[e],this.listNPoint);for(let e=0;e<this.optimizer.renderer.clustersRPoint.length;++e)this.updateByQueue(this.optimizer.renderer.clustersRPoint[e],this.listNPoint)}updateByQueue(e,t){let s=0,i=[...t];for(;i.length;){let n=i.shift();if(n){if(n.numVisit>100){n.numVisit=0;break}if(0===i.length&&t.length<s++)break;n.collision.isCollided||((0,p.Y4)([n.collision.minVec,n.collision.maxVec],[e.minVec,e.maxVec])?(n.collision.isCollided=!0,n.isCollapse=!0,n.numVisit=0,e.addPost(n)):(n.numVisit++,i.push(n)))}}}needDecompose(){let e=[];for(let t=0;t<this.optimizer.renderer.clustersNPoint.length;++t)this.optimizer.renderer.clustersNPoint[t].needDecompose()&&e.push(this.optimizer.renderer.clustersNPoint[t]);for(let t=0;t<this.optimizer.renderer.clustersRPoint.length;++t)this.optimizer.renderer.clustersRPoint[t].needDecompose()&&e.push(this.optimizer.renderer.clustersRPoint[t]);return e}splitClusters(e){for(let t=0;t<e.length;++t)e[t].split()}postMergeCluster(){this.postMergeClusterCompute(this.optimizer.renderer.clustersNPoint),this.postMergeClusterCompute(this.optimizer.renderer.clustersRPoint)}postMergeClusterCompute(e){for(let t=0;t<e.length-1;++t){let s=e[t];for(let i=t+1;i<e.length;++i){let t=e[i];!t.isVisited&&(0,p.Sp)(s.vec,t.vec)<s.r1+20&&(t.isVisited=!0,s.merge(t))}}}constructor(e){this.listRPoint=[],this.listNPoint=[],this.optimizer=e}}class sH{mouseClick(e,t){this.m.x=e,this.m.y=t;for(let e=0;e<this.optimizer.renderer.clustersNPoint.length;++e)if(this.optimizer.renderer.clustersNPoint[e].isInside(this.m))return!0;for(let e=0;e<this.optimizer.renderer.clustersRPoint.length;++e)if(this.optimizer.renderer.clustersRPoint[e].isInside(this.m))return!0;return!1}mouseMove(e,t){this.m.x=e,this.m.y=t;for(let e=0;e<this.optimizer.renderer.clustersNPoint.length;++e)this.optimizer.renderer.clustersNPoint[e].isInside(this.m);for(let e=0;e<this.optimizer.renderer.clustersRPoint.length;++e)this.optimizer.renderer.clustersRPoint[e].isInside(this.m)}constructor(e){this.m=new p.h9(0,0),this.optimizer=e}}class sF{isInside(e){return(0,p.Sp)(this.vec,e)<this.r1?(this.isHover=!0,this.geometries[0].scene.annotationInstance.activeCommandController.activeMouseCursor.setActiveCursorHovering(),this.geometries[0].scene.annotationInstance.renderer.needFocus=!0,this.geometries[0].scene.annotationInstance.activeCommandController.acProperties.hasHovering=!0,!0):(this.isHover=!1,!1)}addPost(e){if(!this.geometries.includes(e)){this.geometries.push(e),this.vec=new p.h9(0,0,0);for(let e=0;e<this.geometries.length;++e)this.vec.x+=this.geometries[e].vec.x,this.vec.y+=this.geometries[e].vec.y,this.updateBoundingBox(this.geometries[e].vec);this.vec.x/=this.geometries.length,this.vec.y/=this.geometries.length,this.minVec=new p.h9(this.vec.x-this.r1,this.vec.y-this.r1,0),this.maxVec=new p.h9(this.vec.x+this.r1,this.vec.y+this.r1,0)}}needDecompose(){return this.boundingBoxMax.x-this.boundingBoxMin.x>this.gridResolution||this.boundingBoxMax.y-this.boundingBoxMin.y>this.gridResolution}split(){this.deepRemove();let e=(this.boundingBoxMax.x-this.boundingBoxMin.x)/this.gridResolution<1?1:(this.boundingBoxMax.x-this.boundingBoxMin.x)/this.gridResolution,t=(this.boundingBoxMax.y-this.boundingBoxMin.y)/this.gridResolution<1?1:(this.boundingBoxMax.y-this.boundingBoxMin.y)/this.gridResolution,s=this.buildGrid(e,t);this.buildSubCluster(s,e,t)}merge(e){this.geometries.concat(e.geometries),this.vec=new p.h9(0,0,0);for(let e=0;e<this.geometries.length;++e)this.vec.x+=this.geometries[e].vec.x,this.vec.y+=this.geometries[e].vec.y,this.updateBoundingBox(this.geometries[e].vec);this.vec.x/=this.geometries.length,this.vec.y/=this.geometries.length,this.minVec=new p.h9(this.vec.x-this.r1,this.vec.y-this.r1,0),this.maxVec=new p.h9(this.vec.x+this.r1,this.vec.y+this.r1,0),e.deepRemove()}deepRemove(){this.renderer.removeCluster(this)}buildGrid(e,t){this.tempGeoGridList=[];let s=[];for(let i=0;i<t;++i){let t=this.boundingBoxMin.y+i*this.gridResolution,n=[];for(let i=0;i<e;++i){let e=this.boundingBoxMin.x+i*this.gridResolution;s.push(new p.h9(e,t));let o=[];n.push(o)}this.tempGeoGridList.push(n)}return this.tempVecGridList=s,s}buildSubCluster(e,t,s){for(let e=0;e<this.geometries.length;++e)this.getCellAtPoint(this.geometries[e].vec,t,s).push(this.geometries[e]);for(let e=0;e<this.tempGeoGridList.length;++e)for(let t=0;t<this.tempGeoGridList[e].length;++t)this.tempGeoGridList[e][t]&&(1===this.tempGeoGridList[e][t].length?this.tempGeoGridList[e][t][0].collision.reset():this.tempGeoGridList[e][t].length>1&&(this.tempGeoGridList[e][t][0].type===p.zq.POINT_NUMBERED?this.renderer.clustersNPoint.push(new sF(this.renderer,this.tempGeoGridList[e][t],this.tempGeoGridList[e][t][0].type)):this.tempGeoGridList[e][t][0].type===p.zq.POINT_REGULAR&&this.renderer.clustersRPoint.push(new sF(this.renderer,this.tempGeoGridList[e][t],this.tempGeoGridList[e][t][0].type))))}getCellAtPoint(e,t,s){let i=new p.h9(e.x-this.boundingBoxMin.x,e.y-this.boundingBoxMin.y),n=Math.round(i.x/this.gridResolution),o=Math.round(i.y/this.gridResolution);return n>=t&&(n=t-1),o>=s&&(o=s-1),n<0&&(n=0),o<0&&(o=0),n=Math.round(n),o=Math.round(o),this.tempGeoGridList[o][n]}draw(e,t){if(this.updateTimer(),t.optimizer.optimizer.optimizer.renderer.imageAnnoApp.activeCommandController.acProperties.extentChanging){this.vec=new p.h9(0,0,0),this.boundingBoxMin=new p.h9(Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER),this.boundingBoxMax=new p.h9(Number.MIN_SAFE_INTEGER,Number.MIN_SAFE_INTEGER,Number.MIN_SAFE_INTEGER);for(let e=0;e<this.geometries.length;++e)this.vec.x+=this.geometries[e].vec.x,this.vec.y+=this.geometries[e].vec.y,this.updateBoundingBox(this.geometries[e].vec);this.vec.x/=this.geometries.length,this.vec.y/=this.geometries.length,this.minVec=new p.h9(this.vec.x-this.r1,this.vec.y-this.r1,0),this.maxVec=new p.h9(this.vec.x+this.r1,this.vec.y+this.r1,0)}if(t.optimizer.optimizer.optimizer.renderer.draw.shape.cluster.drawingPresetClustering(e,this.geometries,this.vec,this.r0,this.r1,this.isHover,this.t),t.optimizer.optimizer.optimizer.renderer.imageAnnoApp.implementations.app.INSPECTION&&(e.beginPath(),e.rect(this.minVec.x,this.minVec.y,this.maxVec.x-this.minVec.x,this.maxVec.y-this.minVec.y),e.closePath(),e.fillStyle="rgba(0, 0, 0, 0.3)",e.fill(),e.lineWidth=.5,e.beginPath(),e.rect(this.boundingBoxMin.x,this.boundingBoxMin.y,this.boundingBoxMax.x-this.boundingBoxMin.x,this.boundingBoxMax.y-this.boundingBoxMin.y),e.closePath(),e.stroke(),this.tempVecGridList.length>0))for(let t=0;t<this.tempVecGridList.length;++t)e.beginPath(),e.rect(this.tempVecGridList[t].x,this.tempVecGridList[t].y,this.gridResolution,this.gridResolution),e.closePath(),e.stroke()}updateTimer(){this.geometries[0].scene.annotationInstance.activeCommandController.acProperties.hasHovering?(this.t-=this.geometries[0].scene.annotationInstance.customization.themeCurrent.properties.timeTransitionA,this.t=this.t<.4?.4:this.t):(this.t+=this.geometries[0].scene.annotationInstance.customization.themeCurrent.properties.timeTransitionB,this.t=this.t>1?1:this.t)}updateBoundingBox(e){this.boundingBoxMin.x=e.x<this.boundingBoxMin.x?e.x:this.boundingBoxMin.x,this.boundingBoxMin.y=e.y<this.boundingBoxMin.y?e.y:this.boundingBoxMin.y,this.boundingBoxMax.x=e.x>this.boundingBoxMax.x?e.x:this.boundingBoxMax.x,this.boundingBoxMax.y=e.y>this.boundingBoxMax.y?e.y:this.boundingBoxMax.y}constructor(e,t,s){this.r0=16,this.r1=24,this.isHover=!1,this.isVisited=!1,this.boundingBoxMin=new p.h9(Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER),this.boundingBoxMax=new p.h9(Number.MIN_SAFE_INTEGER,Number.MIN_SAFE_INTEGER,Number.MIN_SAFE_INTEGER),this.vec=new p.h9(0,0,0),this.t=1,this.gridResolution=85,this.tempVecGridList=[],this.tempGeoGridList=[],this.renderer=e,this.geometries=t,this.type=s;for(let e=0;e<this.geometries.length;++e)this.vec.x+=this.geometries[e].vec.x,this.vec.y+=this.geometries[e].vec.y,this.updateBoundingBox(this.geometries[e].vec);this.vec.x/=this.geometries.length,this.vec.y/=this.geometries.length,this.minVec=new p.h9(this.vec.x-this.r1,this.vec.y-this.r1,0),this.maxVec=new p.h9(this.vec.x+this.r1,this.vec.y+this.r1,0)}}class s_{initGeometry(){this.clustersNPoint=[],this.clustersRPoint=[]}addClusterByGeometries(e,t){if(t===p.zq.POINT_NUMBERED)for(let s=0;s<e.length;++s)this.clustersNPoint.push(new sF(this,e[s],t));else if(t===p.zq.POINT_REGULAR)for(let s=0;s<e.length;++s)this.clustersRPoint.push(new sF(this,e[s],t))}removeCluster(e){e.geometries[0].type===p.zq.POINT_NUMBERED?this.clustersNPoint.splice(this.clustersNPoint.indexOf(e),1):e.geometries[0].type===p.zq.POINT_REGULAR&&this.clustersRPoint.splice(this.clustersRPoint.indexOf(e),1)}render(e){if(this.clustersNPoint.length>0)for(let t=0;t<this.clustersNPoint.length;++t)this.clustersNPoint[t].draw(e,this);if(this.clustersRPoint.length>0)for(let t=0;t<this.clustersRPoint.length;++t)this.clustersRPoint[t].draw(e,this)}constructor(e){this.clustersNPoint=[],this.clustersRPoint=[],this.optimizer=e}}class sU extends sW{mouseClick(e,t){return!!this.interaction.mouseClick(e,t)}mouseMove(e,t){this.interaction.mouseMove(e,t)}render(e){this.renderer.render(e)}update(){this.graph.update()}constructor(e){super(e),this.interaction=new sH(this),this.graph=new sB(this),this.renderer=new s_(this)}}class sq{update(){this.initGrid()}initGrid(){this.cells=[];let e=this.optimizer.optimizer.optimizer.renderer.ctx.canvas.width,t=this.optimizer.optimizer.optimizer.renderer.ctx.canvas.height;this.xInterval=e/(this.rx-1),this.yInterval=t/(this.ry-1);for(let e=0;e<this.ry;e++){let t=[];for(let s=0;s<this.rx;s++)t.push(new sJ(this,s,e));this.cells.push(t)}for(let e=0;e<this.optimizer.optimizer.optimizer.renderer.imageAnnoApp.scene.listNPoint.length;++e){let t=this.optimizer.optimizer.optimizer.renderer.imageAnnoApp.scene.listNPoint[e];this.getCellAtPoint(t.vec).add(t)}for(let e=0;e<this.ry;++e)for(let t=0;t<this.rx;++t)this.cells[e][t].geometries.length<2&&(this.cells[e][t].isRenderable=!1)}getCellAtPoint(e){let t=Math.round(e.x/this.xInterval),s=Math.round(e.y/this.yInterval);return t>=this.rx&&(t=this.rx-1),s>=this.ry&&(s=this.ry-1),t<0&&(t=0),s<0&&(s=0),this.cells[s][t]}render(e){for(let t=0;t<this.cells.length;t++)for(let s=0;s<this.cells[t].length;s++)this.cells[t][s].draw(e)}constructor(e){this.listRPoint=[],this.listNPoint=[],this.rx=15,this.ry=8,this.xInterval=0,this.yInterval=0,this.cells=[],this.optimizer=e}}class sJ{add(e){e.isRenderable=!1,this.geometries.push(e),this.vecRender=new p.h9(0,0,0);for(let e=0;e<this.geometries.length;++e)this.vecRender.x+=this.geometries[e].vec.x,this.vecRender.y+=this.geometries[e].vec.y;this.vecRender.x/=this.geometries.length,this.vecRender.y/=this.geometries.length}get isRenderable(){return this.isRenderableValue}set isRenderable(e){if(!e){for(let e=0;e<this.geometries.length;++e)this.geometries[e].isRenderable=!0;this.geometries=[]}this.isRenderableValue=e}draw(e){if(this.isRenderable){if(this.grid.optimizer.optimizer.optimizer.renderer.imageAnnoApp.activeCommandController.acProperties.extentChanging){this.vecRender=new p.h9(0,0,0);for(let e=0;e<this.geometries.length;++e)this.vecRender.x+=this.geometries[e].vec.x,this.vecRender.y+=this.geometries[e].vec.y;this.vecRender.x/=this.geometries.length,this.vecRender.y/=this.geometries.length}e.beginPath(),e.arc(this.vecRender.x,this.vecRender.y,5,0,2*Math.PI),e.closePath(),e.stroke(),this.grid.optimizer.optimizer.optimizer.renderer.draw.shape.cluster.drawingPresetClustering(e,this.geometries,this.vecRender,this.r0,this.r1,this.isHover)}}constructor(e,t,s){this.r0=16,this.r1=24,this.isHover=!1,this.geometries=[],this.isRenderableValue=!0,this.grid=e,this.xI=t,this.yI=s,this.vec=new p.h9(t*this.grid.xInterval,s*this.grid.yInterval),this.geometries=[]}}class sY{mouseClick(e,t){this.m.x=e,this.m.y=t;for(let e=0;e<this.optimizer.renderer.pointClusters.length;++e)if(this.optimizer.renderer.pointClusters[e].isInside(this.m))return!0;return!1}mouseMove(e,t){this.m.x=e,this.m.y=t;for(let e=0;e<this.optimizer.renderer.pointClusters.length;++e)this.optimizer.renderer.pointClusters[e].isInside(this.m)}constructor(e){this.m=new p.h9(0,0),this.optimizer=e}}class sj{initGeometry(){this.pointClusters=[]}pushGeometry(e,t){for(let s=0;s<e.length;++s)this.pointClusters.push(new sX(e[s],t))}render(e){this.optimizer.grid.render(e)}constructor(e){this.pointClusters=[],this.optimizer=e}}class sX{isInside(e){return(0,p.Sp)(this.vec,e)<this.r1+2?(this.isHover=!0,!0):(this.isHover=!1,!1)}draw(e,t){if(t.optimizer.optimizer.optimizer.renderer.imageAnnoApp.activeCommandController.acProperties.extentChanging){this.vec=new p.h9(0,0,0);for(let e=0;e<this.geometries.length;++e)this.vec.x+=this.geometries[e].vec.x,this.vec.y+=this.geometries[e].vec.y;this.vec.x/=this.geometries.length,this.vec.y/=this.geometries.length}t.optimizer.optimizer.optimizer.renderer.draw.shape.cluster.drawingPresetClustering(e,this.geometries,this.vec,this.r0,this.r1,this.isHover)}constructor(e,t){this.r0=16,this.r1=24,this.isHover=!1,this.vec=new p.h9(0,0,0),this.geometries=e,this.type=t;for(let e=0;e<this.geometries.length;++e)this.vec.x+=this.geometries[e].vec.x,this.vec.y+=this.geometries[e].vec.y;this.vec.x/=this.geometries.length,this.vec.y/=this.geometries.length}}class sK extends sW{mouseClick(e,t){return!!this.interaction.mouseClick(e,t)}mouseMove(e,t){this.interaction.mouseMove(e,t)}render(e){this.renderer.render(e)}update(){this.grid.update()}constructor(e){super(e),this.interaction=new sY(this),this.grid=new sq(this),this.renderer=new sj(this)}}class s$ extends sW{update(){this.optimizerTextleaderlineByNone()}optimizerTextleaderlineByNone(){for(let e=0;e<this.optimizer.optimizer.renderer.imageAnnoApp.scene.listNPoint.length;++e)this.optimizer.optimizer.renderer.imageAnnoApp.scene.listNPoint[e].collision.reset();for(let e=0;e<this.optimizer.optimizer.renderer.imageAnnoApp.scene.listRPoint.length;++e)this.optimizer.optimizer.renderer.imageAnnoApp.scene.listRPoint[e].collision.reset()}constructor(e){super(e)}}class sQ extends sW{update(){this.optimizerTextleaderlineByZoom()}optimizerTextleaderlineByZoom(){}constructor(e){super(e)}}class sZ{get type(){return this._type}set type(e){switch(this._type=e,this.optimizer.renderer.imageAnnoApp.implementations.app.PRODUCTION,e){case p.xX.Zoom:this.activeOptimizer=new sQ(this);return;case p.xX.Grid:this.activeOptimizer=new sK(this);return;case p.xX.Collision:this.activeOptimizer=new sU(this);return;case p.xX.Agent:return;default:this.activeOptimizer=new s$(this);return}}update(){this.activeOptimizer.update()}render(e){this.activeOptimizer&&this.activeOptimizer.render(e)}mouseClick(e,t){return!!(this.activeOptimizer&&this.activeOptimizer.mouseClick(e,t))}mouseMove(e,t){this.activeOptimizer&&this.activeOptimizer.mouseMove(e,t)}constructor(e,t){this.optimizer=e,this.type=t}}class s0{get typeTextleaderline(){return this.textleaderlineOptimizer.type}set typeTextleaderline(e){this.textleaderlineOptimizer.type=e}get typePoint(){return this.pointOptimizer.type}set typePoint(e){this.pointOptimizer.type=e}init(){this.pointOptimizer=new sZ(this,this.renderer.imageAnnoApp.activeCommandController.acProperties.optimizerPoint),this.textleaderlineOptimizer=new sG(this,this.renderer.imageAnnoApp.activeCommandController.acProperties.optimizerTextleaderline)}update(){!this.renderer.imageAnnoApp.activeCommandController.acProperties.isPanning&&(this.renderer.imageAnnoApp.activeCommandController.acProperties.needExecuteOptimizer||++this.initForceTimer<30)&&(this.pointOptimizer.update(),this.textleaderlineOptimizer.update(),this.renderer.imageAnnoApp.activeCommandController.acProperties.needExecuteOptimizer=!1)}render(e){this.pointOptimizer.render(e)}mouseClick(e,t){return!!this.pointOptimizer.mouseClick(e,t)}mouseMove(e,t){this.pointOptimizer.mouseMove(e,t)}constructor(e){this.initForceTimer=0,this.renderer=e,this.init()}}class s1{renderEnv(e){for(this.renderer.objectSnapping.render(e),eP.construction&&eP.construction.renderPost(e),this.index=this.renderer.imageAnnoApp.scene.listACircleWrapperr.length;this.index--;)this.renderer.imageAnnoApp.scene.listACircleWrapperr[this.index].render(e);for(this.index=this.renderer.imageAnnoApp.scene.listAPolygonGraphWrapper.length;this.index--;)this.renderer.imageAnnoApp.scene.listAPolygonGraphWrapper[this.index].render(e);for(this.index=this.renderer.imageAnnoApp.scene.listARectangleWrapper.length;this.index--;)this.renderer.imageAnnoApp.scene.listARectangleWrapper[this.index].render(e);for(this.index=this.renderer.imageAnnoApp.scene.listAPolylineGraphWrapper.length;this.index--;)this.renderer.imageAnnoApp.scene.listAPolylineGraphWrapper[this.index].render(e);for(this.renderer.imageAnnoApp.scene.listAPolylineGraphShadow&&this.renderer.imageAnnoApp.scene.listAPolylineGraphShadow.render(e),this.index=this.renderer.imageAnnoApp.scene.listAFreehandSmartDrawing.length;this.index--;)this.renderer.imageAnnoApp.scene.listAFreehandSmartDrawing[this.index].render(e);for(this.index=this.renderer.imageAnnoApp.scene.listAFreehand.length;this.index--;)this.renderer.imageAnnoApp.scene.listAFreehand[this.index].render(e);for(this.index=this.renderer.imageAnnoApp.scene.listAPolylineWrapper.length;this.index--;)this.renderer.imageAnnoApp.scene.listAPolylineWrapper[this.index].render(e);for(this.index=this.renderer.imageAnnoApp.scene.listACurve.length;this.index--;)this.renderer.imageAnnoApp.scene.listACurve[this.index].render(e);for(this.index=this.renderer.imageAnnoApp.scene.listAArrow.length;this.index--;)this.renderer.imageAnnoApp.scene.listAArrow[this.index].render(e);for(eH.condition.geo&&eH.condition.geo.render(e),this.index=this.renderer.imageAnnoApp.scene.listATextleaderlineWrapper.length;this.index--;)this.renderer.imageAnnoApp.scene.listATextleaderlineWrapper[this.index].renderLeadline(e);for(this.index=this.renderer.imageAnnoApp.scene.listAPolygonGraphWrapper.length;this.index--;)this.renderer.imageAnnoApp.scene.listAPolygonGraphWrapper[this.index].renderPostNodes(e);for(this.index=this.renderer.imageAnnoApp.scene.listAPoint.length;this.index--;)this.renderer.imageAnnoApp.scene.listAPoint[this.index].render(e);for(this.index=this.renderer.imageAnnoApp.scene.listRPoint.length;this.index--;)this.renderer.imageAnnoApp.scene.listRPoint[this.index].render(e);for(this.index=this.renderer.imageAnnoApp.scene.listIPoint.length;this.index--;)this.renderer.imageAnnoApp.scene.listIPoint[this.index].render(e);for(this.index=this.renderer.imageAnnoApp.scene.listNPoint.length;this.index--;)this.renderer.imageAnnoApp.scene.listNPoint[this.index].render(e);for(this.renderer.optimizer.render(e),this.index=this.renderer.imageAnnoApp.scene.listATextleaderlineWrapper.length;this.index--;)this.renderer.imageAnnoApp.scene.listATextleaderlineWrapper[this.index].render(e);if(this.renderer.imageAnnoApp.implementations.app.INSPECTION){if(e.fillStyle="#000000",e.font="10px Arial",this.renderer.imageAnnoApp.scene.capture){let t=this.renderer.imageAnnoApp.scene.capture.vec,s=this.renderer.imageAnnoApp.scene.capture.type;e.fillText("".concat(s),t.x,t.y+10)}let t=this.renderer.imageAnnoApp.scene.geometryList.length,s=this.renderer.imageAnnoApp.scene.listAPoint.length,i=this.renderer.imageAnnoApp.scene.Capture?this.renderer.imageAnnoApp.scene.Capture.type:void 0,n=this.renderer.imageAnnoApp.activeCommandController.acProperties.mapScale,o=this.renderer.debugText,r=this.renderer.imageAnnoApp.implementations.app.model.appCoreWrapper.browserUtility.isMobile;e.fillText("num of geo: ".concat(t),.5*this.renderer.imageAnnoApp.graphicsCoreWrapper.canvasWrapper.aCanvas.ctx.canvas.width-150,30),e.fillText("num of aPoint(node): ".concat(s),.5*this.renderer.imageAnnoApp.graphicsCoreWrapper.canvasWrapper.aCanvas.ctx.canvas.width-150,50),e.fillText("capture: ".concat(i),.5*this.renderer.imageAnnoApp.graphicsCoreWrapper.canvasWrapper.aCanvas.ctx.canvas.width+0,30),e.fillText("map scale: ".concat(n),.5*this.renderer.imageAnnoApp.graphicsCoreWrapper.canvasWrapper.aCanvas.ctx.canvas.width+150+0,30),e.fillText("debug: ".concat(o),.5*this.renderer.imageAnnoApp.graphicsCoreWrapper.canvasWrapper.aCanvas.ctx.canvas.width,60),e.fillText("isMobile: ".concat(r),.5*this.renderer.imageAnnoApp.graphicsCoreWrapper.canvasWrapper.aCanvas.ctx.canvas.width,90),this.renderer.imageAnnoApp.activeCommandController.screenLog.render(e)}}constructor(e){this.index=0,this.renderer=e}}class s2{getImgDataFromHTMLImg(e,t){e.crossOrigin="anonymous",this.ctxTemp.drawImage(e,50,50)}ellipseOffScreen(e,t,s,i,n,o,r,a){arguments.length>8&&void 0!==arguments[8]&&arguments[8],e.beginPath(),e.ellipse(i,n,o,r,0,0,2*Math.PI,!1),e.closePath(),e.fillStyle=s,a&&e.fill(),this.polygonEndOffScreen(e,t,s)}polygonEndOffScreen(e,t,s){e.lineWidth=t.lineWidth,e.strokeStyle=s,e.stroke()}rectangleOffScreen(e,t,s){e.beginPath(),e.moveTo(s[0].x,s[0].y);for(let t=1;t<s.length;++t)e.lineTo(s[t].x,s[t].y);e.fillStyle=t,e.closePath(),e.fill()}curveQuadraticArrowOffScreen(e,t,s,i,n,o,r,a,h){e.lineWidth=t.lineWidth+10,e.strokeStyle=s,e.beginPath(),e.moveTo(i,n),e.quadraticCurveTo(o,r,a,h),e.stroke(),e.closePath()}curveBezierOffScreen(e,t,s,i,n,o,r,a,h,c,l){e.lineWidth=t.lineWidth+10,e.strokeStyle=s,e.beginPath(),e.moveTo(i,n),e.bezierCurveTo(o,r,a,h,c,l),e.stroke(),e.closePath()}polygonOffScreen(e,t,s){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;e.fillStyle=t,e.strokeStyle=t,e.lineWidth=i,e.beginPath(),e.moveTo(s[0].x,s[0].y);for(let t=1;t<s.length;++t)e.lineTo(s[t].x,s[t].y);e.closePath(),e.stroke(),e.fill()}PolygonOffScreenByVecs(e,t,s){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;e.fillStyle=t,e.strokeStyle=t,e.lineWidth=i,e.beginPath(),e.moveTo(s[0].x,s[0].y);for(let t=1;t<s.length;++t)e.lineTo(s[t].x,s[t].y);e.closePath(),e.stroke(),e.fill()}polygonOffScreenByVecsOfVecs(e,t,s){for(let i=1;i<s.length;++i)this.PolygonOffScreenByVecs(e,t,s[i])}rPointOffscreen(e,t,s,i){{let n=s.x-.5*this.renderer.imageAnnoApp.customization.themeCurrent.rPoint.width,o=s.y-this.renderer.imageAnnoApp.customization.themeCurrent.rPoint.height;e.beginPath(),e.fillStyle=t,e.rect(n-this.renderer.imageAnnoApp.scene.paramsEditing.croppingMaskParams.x+(.5*this.renderer.imageAnnoApp.customization.themeCurrent.rPoint.width-.5*this.renderer.imageAnnoApp.customization.themeCurrent.rPoint.width*i),o-this.renderer.imageAnnoApp.scene.paramsEditing.croppingMaskParams.y+(this.renderer.imageAnnoApp.customization.themeCurrent.rPoint.height-this.renderer.imageAnnoApp.customization.themeCurrent.rPoint.height*i),this.renderer.imageAnnoApp.customization.themeCurrent.rPoint.width*i,this.renderer.imageAnnoApp.customization.themeCurrent.rPoint.height*i),e.closePath(),e.fill()}}pointRegularDragOffscreen(e,t,s,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,o=!(arguments.length>5)||void 0===arguments[5]||arguments[5];if(!this.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG)return;let r=this.renderer.imageAnnoApp.customization.themeCurrent.properties.pointBoundOffset;o?r*=n:r-=r*n,e.beginPath(),e.fillStyle=t,e.rect(s,i,this.renderer.imageAnnoApp.customization.themeCurrent.rPoint.width,this.renderer.imageAnnoApp.customization.themeCurrent.rPoint.height),e.closePath(),e.fill()}constructor(e){this.renderer=e,this.canvas=document.createElement("canvas"),this.canvas.style.background="#000000",this.canvas.style.position="absolute";let t=this.canvas.getContext("2d");t&&(this.ctxTemp=t)}}class s5{addBase64(e,t){this.listBase64.has(e)||(this.listBase64.set(e,t),this.draw.renderer.imageAnnoApp.io.eventListenerAnnotation.addBase64Stack(e,t))}activeBase64(e){this.listBase64.has(e)&&(this.activeBase64ID=e,this.draw.renderer.imageAnnoApp.activeCommandController.activeBase64img=this.listBase64.get(e),this.draw.renderer.imageAnnoApp.io.eventListenerAnnotation.selectBase64(e))}constructor(e){this.listBase64=new Map,this.activeBase64ID="",this.draw=e}}class s3{polygonEnd(e,t,s,i){e.lineWidth=t.lineWidth*t.scaleLocal*t.scaleGlobal,this.shape.draw.renderer.needFocus&&!s?e.strokeStyle=t.colorInterpolatedString:e.strokeStyle=t.colorStroke,i&&(e.strokeStyle=t.colorStroke),e.setLineDash(t.dash),e.stroke(),e.setLineDash([])}polygonHoverEnd(e,t,s,i,n,o){e.lineWidth=t.lineWidth*t.scaleGlobal*t.scaleLocal*n*this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.elasticScale,e.strokeStyle=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.outlineHoverColorRGBAString,e.closePath(),e.setLineDash(t.dash),e.stroke(),e.setLineDash([0,0])}polygonHover(e,t,s,i,n){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,r=!(arguments.length>6)||void 0===arguments[6]||arguments[6],a=arguments.length>7?arguments[7]:void 0;for(e.beginPath(),e.moveTo(s[0].x,s[0].y),this.index=1;this.index<s.length;++this.index)e.lineTo(s[this.index].x,s[this.index].y);this.polygonHoverEnd(e,t,r,a,o,n)}ellipse(e,t,s,i,n,o,r,a,h){arguments.length>9&&void 0!==arguments[9]&&arguments[9],e.beginPath(),e.ellipse(s,i,n,o,0,0,2*Math.PI,!1),e.closePath(),e.fillStyle=t.colorFill,this.shape.draw.renderer.needFocus,e.fillStyle=t.colorInterpolatedString,h&&(e.fillStyle=t.colorInterpolatedString),this.polygonEnd(e,t,a,h)}ellipseLocalTint(e,t,s,i,n,o,r,a,h){arguments.length>9&&void 0!==arguments[9]&&arguments[9],e.beginPath(),e.ellipse(s,i,n,o,0,0,2*Math.PI,!1),e.closePath();let c=e.createRadialGradient(s,i,0,s,i,o);c.addColorStop(0,"rgba(".concat(127.5,", ").concat(127.5,", ").concat(127.5,", 0.9)")),c.addColorStop(1,"rgba(".concat(127.5,", ").concat(127.5,", ").concat(127.5,", 0.0)")),e.fillStyle=c,e.fill()}ellipseHover(e,t,s,i,n,o,r,a){let h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:1,c=!(arguments.length>9)||void 0===arguments[9]||arguments[9],l=arguments.length>10?arguments[10]:void 0;e.beginPath(),e.ellipse(s,i,n,o,0,0,2*Math.PI,!1),e.closePath(),this.polygonHoverEnd(e,t,c,l,h,a)}roundedRect(e,t,s,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;e.lineWidth=t.lineWidth*t.scaleGlobal*t.scaleLocal,e.strokeStyle=t.colorStroke,e.beginPath(),e.moveTo(s[0].x+n+i,s[0].y),e.lineTo(s[1].x-n-i,s[1].y),e.arcTo(s[1].x-n,s[1].y,s[1].x-n,s[1].y+i,i),e.lineTo(s[2].x-n,s[2].y-i),e.arcTo(s[2].x-n,s[2].y,s[2].x-n-i,s[2].y,i),e.lineTo(s[3].x+n+i,s[3].y),e.arcTo(s[3].x+n,s[3].y,s[3].x+n,s[3].y-i,i),e.lineTo(s[0].x+n,s[0].y+i),e.arcTo(s[0].x+n,s[0].y,s[0].x+n+i,s[0].y,i),e.setLineDash(t.dash),e.stroke(),e.setLineDash([])}rectangle(e,t,s,i,n,o,r){for(e.beginPath(),e.moveTo(s[0].x,s[0].y),this.index=1;this.index<s.length;++this.index)e.lineTo(s[this.index].x,s[this.index].y);e.closePath(),e.fillStyle=t.colorFill,n&&(this.shape.draw.renderer.needFocus,e.fillStyle=t.colorInterpolatedString,r&&(e.fillStyle=t.colorInterpolatedString)),this.polygonEnd(e,t,o,r)}rectangleHover(e,t,s,i,n){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,r=!(arguments.length>6)||void 0===arguments[6]||arguments[6],a=arguments.length>7?arguments[7]:void 0;for(e.beginPath(),e.moveTo(s[0].x,s[0].y),this.index=1;this.index<s.length;++this.index)e.lineTo(s[this.index].x,s[this.index].y);this.polygonHoverEnd(e,t,r,a,o,n)}polygon(e,t,s,i,n,o,r,a,h){for(e.beginPath(),e.moveTo(s[0].x,s[0].y),this.index=1;this.index<s.length;++this.index)e.lineTo(s[this.index].x,s[this.index].y);for(e.closePath(),this.shape.draw.renderer.needFocus,e.fillStyle=t.colorInterpolatedString,h&&(e.fillStyle=t.colorInterpolatedString),e.beginPath(),e.moveTo(s[0].x,s[0].y),this.index=1;this.index<s.length;++this.index)e.lineTo(s[this.index].x,s[this.index].y);e.lineWidth=t.lineWidth*t.scaleGlobal*t.scaleLocal,this.shape.draw.renderer.needFocus&&!a?e.strokeStyle=t.colorInterpolatedString:e.strokeStyle=t.colorStroke,h&&(e.strokeStyle=t.colorStroke),e.setLineDash(t.dash),i?(e.stroke(),e.closePath()):(e.closePath(),e.stroke()),e.setLineDash([])}polygonByVecGhost(e,t,s,i,n,o){for(e.beginPath(),e.moveTo(s[0].x,s[0].y),this.index=1;this.index<s.length;++this.index)e.lineTo(s[this.index].x,s[this.index].y);for(e.fillStyle=t.colorFill,e.closePath(),e.beginPath(),e.moveTo(s[0].x,s[0].y),this.index=1;this.index<s.length;++this.index)e.lineTo(s[this.index].x,s[this.index].y);e.lineTo(s[0].x,s[0].y),e.lineWidth=t.lineWidth*t.scaleGlobal*t.scaleLocal,e.strokeStyle=t.colorStroke,i?(e.stroke(),e.closePath()):(e.closePath(),e.stroke())}constructor(e){this.index=0,this.shape=e}}class s9{constructor(e){this.drawingPresetClustering=function(e,t,s,i,n,o){let r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,a=t[0].styleComponent.renderStyle.colorFillHover.split(","),h="rgba(".concat(+a[0].split("(")[1],", ").concat(+a[1],", ").concat(+a[2],", ").concat((+a[3].split(")")[0]-.1)*r,")"),c=t[0].styleComponent.renderStyle.colorInterpolatedString;if(o)for(let i=0;i<t.length;++i)e.lineWidth=.6,e.strokeStyle=t[0].styleComponent.renderStyle.colorFill,e.beginPath(),e.moveTo(s.x,s.y),e.lineTo(t[i].vec.x,t[i].vec.y),e.closePath(),e.stroke(),e.lineWidth=1,e.strokeStyle="rgba(255, 255, 255, 1)",e.fillStyle=t[0].styleComponent.renderStyle.colorFill,e.beginPath(),e.arc(t[i].vec.x,t[i].vec.y,4,0,2*Math.PI),e.closePath(),e.fill(),e.stroke();o?(e.fillStyle=t[0].styleComponent.renderStyle.colorFill,e.beginPath(),e.arc(s.x,s.y,1.5,0,2*Math.PI),e.closePath(),e.fill()):(e.beginPath(),e.arc(s.x,s.y,n,0,2*Math.PI),e.closePath(),e.fillStyle=h,e.fill(),e.beginPath(),e.arc(s.x,s.y,i,0,2*Math.PI),e.closePath(),e.fillStyle=c,e.fill(),e.fillStyle="rgba(255, 255, 255, 1)",e.font="bold 11px Arial",e.textAlign="center",e.fillText("".concat(t.length),s.x,s.y+4))},this.shape=e}}class s6{cArrowByTranslation(e,t,s,i,n,o,r,a,c,l,d){arguments.length>11&&void 0!==arguments[11]&&arguments[11];let m=arguments.length>12?arguments[12]:void 0,u=arguments.length>13?arguments[13]:void 0,g=(0,p.vQ)((0,p.p$)(s),(0,p.p$)(i));e.save(),e.translate(n,o),e.rotate(-(g*Math.PI/180));let v=7.5*this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.arrow.scale*a,y=-12*this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.arrow.scale*a;e.beginPath(),e.moveTo(0,0),e.lineTo(-(y*r),-v*r),e.lineTo(-(y*r),v*r),e.closePath(),e.lineWidth=t.lineWidth*t.scaleGlobal*t.scaleLocal,this.shape.draw.renderer.needFocus&&!c?e.fillStyle=t.colorFillHover:e.fillStyle=t.colorFill,e.strokeStyle=t.colorInterpolatedString,m&&(e.fillStyle=t.colorFill,e.strokeStyle=t.colorInterpolatedString),c&&u===h.BackgroundColor&&(50>+t.colorStroke.split(",")[1]?e.strokeStyle="rgba(255, 255, 255, 0.5)":e.strokeStyle="rgba(0, 0, 0, 0.5)"),e.stroke(),e.fill(),e.restore()}curveQuadraticArrow(e,t,s,i,n,o,r,a,h,c,l,p){arguments.length>12&&void 0!==arguments[12]&&arguments[12];let d=arguments.length>13?arguments[13]:void 0,m=(arguments.length>14&&arguments[14],arguments.length>15&&void 0!==arguments[15]&&arguments[15],arguments.length>16&&void 0!==arguments[16]?arguments[16]:0);arguments.length>17&&void 0!==arguments[17]&&arguments[17],e.lineDashOffset=m,e.setLineDash(t.dash),e.lineWidth=t.lineWidth*t.scaleGlobal*t.scaleLocal,e.beginPath(),e.moveTo(r,a),e.quadraticCurveTo(n,o,s,i),this.shape.draw.renderer.needFocus,e.strokeStyle=t.colorInterpolatedString,d&&(e.fillStyle=t.colorFill,e.strokeStyle=t.colorInterpolatedString),e.stroke(),e.setLineDash([])}arrowByVecNode(e,t,s,i,n,o){let r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,a=!(arguments.length>7)||void 0===arguments[7]||arguments[7],h=arguments.length>8?arguments[8]:void 0;for(this.index=0;this.index<s.length;++this.index)this.shape.node.node(e,t,s[this.index].x,s[this.index].y,i);this.shape.area.polygonHoverEnd(e,t,a,h,r,o)}curveQuadratic(e,t,s,i,n,o,r,a){arguments.length>8&&void 0!==arguments[8]&&arguments[8];let h=arguments.length>9?arguments[9]:void 0;e.lineWidth=t.lineWidth*t.scaleGlobal*t.scaleLocal,this.shape.draw.renderer.needFocus,e.strokeStyle=t.colorInterpolatedString,h&&(e.strokeStyle=t.colorInterpolatedString),e.beginPath(),e.moveTo(s,i),e.quadraticCurveTo(n,o,r,a),e.stroke()}edgeCurveQuadraticHover(e,t,s,i,n,o,r,a){let h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:1;arguments.length>9&&arguments[9],arguments.length>10&&arguments[10],e.lineWidth=h*t.lineWidth*t.scaleGlobal*t.scaleLocal*this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.elasticScale,e.strokeStyle=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.outlineHoverColorRGBAString,e.beginPath(),e.moveTo(s,i),e.quadraticCurveTo(n,o,r,a),e.stroke()}curveBezier(e,t,s,i,n,o,r,a,h,c,l,p){e.lineWidth=t.lineWidth*t.scaleGlobal*t.scaleLocal,this.shape.draw.renderer.needFocus&&!l?e.fillStyle=t.colorFillHover:e.fillStyle=t.colorFill,e.strokeStyle=t.colorInterpolatedString,p&&(e.fillStyle=t.colorFill,e.strokeStyle=t.colorInterpolatedString),e.beginPath(),e.moveTo(s,i),e.bezierCurveTo(n,o,r,a,h,c),e.stroke()}curveBezierClose(e,t,s,i,n,o,r,a,h,c){e.lineWidth=t.lineWidth*t.scaleGlobal*t.scaleLocal,e.strokeStyle=t.colorInterpolatedString,e.beginPath(),e.moveTo(s,i),e.bezierCurveTo(n,o,r,a,h,c),e.stroke()}curveBezierHoverPolyline(e,t,s,i,n,o,r,a,h,c,l){arguments.length>11&&void 0!==arguments[11]&&arguments[11],e.lineWidth=l*t.lineWidth*t.scaleGlobal*t.scaleLocal*this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.elasticScale,e.strokeStyle=t.colorInterpolatedString,e.beginPath(),e.moveTo(s,i),e.bezierCurveTo(n,o,r,a,h,c),e.stroke()}curveBezierClosed(e,t,s,i,n,o,r,a,h,c,l,p){e.lineWidth=t.lineWidth*t.scaleGlobal*t.scaleLocal,this.shape.draw.renderer.needFocus&&!l?e.fillStyle=t.colorFillHover:e.fillStyle=t.colorFill,e.strokeStyle=t.colorInterpolatedString,p&&(e.fillStyle=t.colorFill,e.strokeStyle=t.colorInterpolatedString),e.beginPath(),e.moveTo(s,i),e.bezierCurveTo(n,o,r,a,h,c),e.stroke()}curveBezierClosedHoverPolygon(e,t,s,i,n,o,r,a,h,c,l){e.lineWidth=l*t.lineWidth*t.scaleGlobal*t.scaleLocal*this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.elasticScale,e.strokeStyle=t.colorInterpolatedString,e.beginPath(),e.moveTo(s,i),e.bezierCurveTo(n,o,r,a,h,c),e.stroke()}curveBezierClosedFill(e,t,s,i,n,o,r,a,h,c){e.strokeStyle=t.colorInterpolatedString,e.lineWidth=t.lineWidth*t.scaleGlobal*t.scaleLocal,e.bezierCurveTo(n,o,r,a,h,c)}curveQuadraticHoverPolyline(e,t,s,i,n,o,r,a,h){e.lineWidth=h*t.lineWidth*t.scaleGlobal*t.scaleLocal*this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.elasticScale,e.strokeStyle=t.colorInterpolatedString,e.beginPath(),e.moveTo(s,i),e.quadraticCurveTo(n,o,r,a),e.stroke()}drawControlLine(e,t,s,i,n,o){e.lineWidth=1*t.scaleGlobal*t.scaleLocal,this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.isDarkBG,e.strokeStyle=t.colorStroke,e.beginPath(),e.moveTo(s,i),e.lineTo(n,o),e.closePath(),e.stroke(),e.restore()}constructor(e){this.index=0,this.shape=e}}class s4{freeHandbyVecs(e,t,s,i){arguments.length>4&&void 0!==arguments[4]&&arguments[4],e.globalCompositeOperation=p.ew.Screen;let n="rgba(".concat(s[0],",").concat(s[1],",").concat(s[2],",",.35,")");for(e.fillStyle=n,e.strokeStyle=n,e.lineWidth=i,e.beginPath(),e.moveTo(t[0].x,t[0].y),this.index=1;this.index<t.length;++this.index)e.lineTo(t[this.index].x,t[this.index].y);for(e.stroke(),this.index=0;this.index<t.length;++this.index)e.beginPath(),e.arc(t[this.index].x,t[this.index].y,1,0,2*Math.PI,!1),e.closePath(),e.stroke();e.globalCompositeOperation=p.ew.SourceOver}constructor(e){this.index=0,this.shape=e}}class s8{line(e,t,s,i,n,o,r){let a=t.lineWidth;r&&(a=this.shape.draw.renderer.numericalMotion.scale(a)),e.beginPath(),e.moveTo(s,i),e.lineTo(n,o),e.closePath(),e.lineWidth=a,e.strokeStyle=t.colorStroke,e.stroke()}lineTrajectory(e,t,s){for(e.globalAlpha=1,e.globalCompositeOperation=p.ew.Screen,this.index=1;this.index<s.length-2;this.index+=2)e.beginPath(),e.moveTo(s[this.index+1].x,s[this.index+1].y),e.lineTo(s[this.index].x,s[this.index].y),e.lineWidth=.15*t.lineWidth*t.scaleGlobal*t.scaleLocal,e.strokeStyle=t.colorStroke,e.stroke(),e.closePath();e.globalCompositeOperation=p.ew.SourceOver}polyline(e,t,s,i,n,o,r){for(e.lineWidth=t.lineWidth*t.scaleGlobal*t.scaleLocal,this.shape.draw.renderer.needFocus&&!o?e.strokeStyle=t.colorStrokeHover:e.strokeStyle=t.colorStroke,r&&(e.strokeStyle=t.colorStroke),e.beginPath(),e.moveTo(s[0].x,s[0].y),this.index=1;this.index<s.length;++this.index)e.lineTo(s[this.index].x,s[this.index].y);e.stroke(),e.closePath()}polylineHover(e,t,s,i,n){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;for(arguments.length>6&&void 0!==arguments[6]&&arguments[6],e.lineWidth=o*t.lineWidth*t.scaleGlobal*t.scaleLocal*this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.elasticScale,e.strokeStyle=t.colorStrokeHover,e.beginPath(),e.moveTo(s[0].x,s[0].y),this.index=1;this.index<s.length;++this.index)e.lineTo(s[this.index].x,s[this.index].y);e.stroke(),e.setLineDash(t.dash),e.closePath(),e.setLineDash([0,0])}edgePolylineHover(e,t,s,i,n,o){let r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;arguments.length>7&&arguments[7],arguments.length>8&&arguments[8],e.lineWidth=r*t.lineWidth*t.scaleGlobal*t.scaleLocal*this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.elasticScale,e.strokeStyle=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.outlineHoverColorRGBAString,e.beginPath(),e.moveTo(s,i),e.lineTo(n,o),e.closePath(),e.setLineDash(t.dash),e.stroke(),e.setLineDash([0,0])}shadowMidPointForBending(e,t,s){e.lineWidth=t.lineWidth*t.scaleGlobal*t.scaleLocal,e.strokeStyle=t.colorStroke,e.fillStyle=t.colorFill,e.beginPath(),e.arc(s.x,s.y,this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.node.sizeMid,0,6.28),e.closePath(),e.setLineDash(t.dash),e.stroke(),e.setLineDash([0,0])}polylineByVecGhost(e,t,s,i,n,o,r){e.lineWidth=t.lineWidth*t.scaleGlobal*t.scaleLocal,e.strokeStyle=t.colorStroke,e.fillStyle=t.colorFill,e.beginPath(),e.moveTo(s[0].x-i[0],s[0].y-i[1]);for(let t=1;t<s.length;++t)e.lineTo(s[t].x-i[0],s[t].y-i[1]);e.stroke()}polylineShadow(e,t,s,i,n){e.lineWidth=t.lineWidth*t.scaleGlobal*t.scaleLocal,e.strokeStyle=t.colorStroke,e.fillStyle=t.colorFill,e.beginPath(),e.moveTo(s[0].x,s[0].y);for(let t=1;t<s.length;++t)e.lineTo(s[t].x,s[t].y);e.lineTo(i.x,i.y),e.stroke(),n===p.zq.POLYGON_GRAPH&&e.fill()}polygonShadow(e,t,s,i,n){e.lineWidth=t.lineWidth*t.scaleGlobal*t.scaleLocal,e.strokeStyle=t.colorStroke,e.fillStyle=t.colorFill,e.beginPath(),e.moveTo(s[0].x,s[0].y);for(let t=1;t<s.length;++t)e.lineTo(s[t].x,s[t].y);e.lineTo(i.x,i.y),e.closePath(),e.stroke()}lineDim(e,t,s,i,n,o,r){let a=(0,p.vQ)((0,p.p$)(new p.h9(s,i)),(0,p.p$)(new p.h9(n,o)));e.translate(s+(n-s)*.5,i+(o-i)*.5),e.rotate(-a*Math.PI/180),this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.isDarkBG?e.fillStyle=p.$C.White:e.fillStyle=p.$C.Black,e.textBaseline="bottom",e.textAlign="center",e.fillText(r.toFixed(2).toString()+"",0,-10),e.setTransform(1,0,0,1,0,0)}constructor(e){this.index=0,this.shape=e}}class s7{nGon(e,t,s,i){e.globalAlpha=1,e.beginPath(),e.moveTo(t[0].x,t[0].y);for(let s=1;s<t.length;++s)e.lineTo(t[s].x,t[s].y);e.closePath(),e.beginPath(),e.moveTo(t[0].x,t[0].y);for(let s=1;s<t.length;++s)e.lineTo(t[s].x,t[s].y);e.closePath(),e.stroke()}nStar(e,t,s,i){e.globalAlpha=1,e.beginPath(),e.moveTo(t[0].vec.x,t[0].vec.y);for(let s=1;s<t.length;++s)e.lineTo(t[s].vec.x,t[s].vec.y);let n=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.polygon.fillStyleFirstArray;e.fillStyle="rgba(".concat(n[0],",").concat(n[1],",").concat(n[2],",").concat(n[3],")"),e.closePath(),e.fill(),e.beginPath(),e.moveTo(t[0].vec.x,t[0].vec.y);for(let s=1;s<t.length;++s)e.lineTo(t[s].vec.x,t[s].vec.y);e.closePath(),e.stroke()}constructor(e){this.shape=e}}class ie{nodeMidHover(e,t,s,i,n,o){let r=arguments.length>6&&void 0!==arguments[6]&&arguments[6];r?(e.lineWidth=t.lineWidth,e.fillStyle=t.colorFill,e.strokeStyle=t.colorStroke,e.beginPath(),o<.1?e.arc(s,i,(Math.abs(this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.node.sizeMid)+3)*n,0,2*Math.PI,!1):e.arc(s,i,Math.abs(this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.node.sizeMid+3)*n*o,0,2*Math.PI,!1)):(e.lineWidth=t.lineWidth,e.fillStyle=t.colorStroke,e.strokeStyle=t.colorStrokeHover,e.beginPath(),o<.1?e.arc(s,i,(Math.abs(this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.node.sizeMid)+1)*n,0,2*Math.PI,!1):e.arc(s,i,Math.abs(this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.node.sizeMid)*n*o,0,2*Math.PI,!1)),e.closePath(),e.fill(),e.stroke()}nodeMidHoverForArrow(e,t,s,i,n,o){let r=arguments.length>6&&void 0!==arguments[6]&&arguments[6],a=arguments.length>7?arguments[7]:void 0;if(e.beginPath(),e.lineWidth=t.lineWidth,r){e.fillStyle=t.colorFill,n<.1?e.arc(s,i,o,0,2*Math.PI,!1):e.arc(s,i,o*n,0,2*Math.PI,!1),e.fill(),e.closePath();return}e.fillStyle=t.colorStroke,e.strokeStyle=t.colorStrokeHover,a===h.BackgroundColor&&(50>+t.colorStroke.split(",")[1]?e.strokeStyle="rgba(255, 255, 255, 0.5)":e.strokeStyle="rgba(0, 0, 0, 0.5)"),n<.1?e.arc(s,i,o,0,2*Math.PI,!1):e.arc(s,i,o*n,0,2*Math.PI,!1),e.closePath(),e.fill(),e.stroke()}nodeMidStart(e,t,s,i,n){e.lineWidth=t.lineWidth,e.fillStyle=t.colorStroke,e.beginPath(),n<.1?e.arc(s,i,Math.abs(this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.node.sizeMid),0,2*Math.PI,!1):e.arc(s,i,Math.abs(this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.node.sizeMid*n),0,2*Math.PI,!1),e.closePath(),e.fill()}nodeHover(e,t,s,i,n,o){e.lineWidth=t.lineWidth,e.strokeStyle=t.colorStroke,e.fillStyle=t.colorFill,e.beginPath(),e.arc(s,i,(Math.abs(this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.node.size)+1)*n,0,2*Math.PI,!1),e.closePath(),e.fill(),e.stroke()}node(e,t,s,i,n){e.lineWidth=t.lineWidth,e.strokeStyle=t.colorStroke,e.fillStyle=t.colorFill,e.beginPath(),e.arc(s,i,(this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.node.size+1)*n,0,2*Math.PI,!1),e.closePath(),e.fill(),e.stroke()}nodeSelected(e,t,s,i,n){e.lineWidth=t.lineWidth,e.strokeStyle=t.colorStroke,e.fillStyle=t.colorFill,e.beginPath(),e.arc(s,i,(this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.node.size+2)*n,0,2*Math.PI,!1),e.closePath(),e.fill(),e.stroke()}nodeStart(e,t,s,i,n,o,r){e.lineWidth=t.lineWidth,e.fillStyle=t.colorFill,e.strokeStyle=t.colorStroke,r===h.BackgroundColor&&(50>+t.colorStroke.split(",")[1]?e.strokeStyle="rgba(255, 255, 255, 0.5)":e.strokeStyle="rgba(0, 0, 0, 0.5)"),e.beginPath(),o<.1?e.arc(s,i,Math.abs(this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.node.size+1)*n,0,2*Math.PI,!1):e.arc(s,i,Math.abs(this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.node.size+1)*n*o,0,2*Math.PI,!1),e.fill(),e.stroke()}constructor(e){this.shape=e}}class it{pointRegularOverBoundingBySVGPath(e,t,s,i,n){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,r=!(arguments.length>6)||void 0===arguments[6]||arguments[6],a=arguments.length>7&&void 0!==arguments[7]&&arguments[7];arguments.length>8&&arguments[8],arguments.length>9&&arguments[9],arguments.length>10&&arguments[10];let h=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.pointBoundOffset;if(this.shape.draw.renderer.hasAni||(r=!1),r?h*=o:h-=h*o,a){e.lineWidth=.5+o*t.lineWidth*t.scaleGlobal*t.scaleLocal*this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.elasticScale;let r=s-.5*this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.width+6,a=i-this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.height+0;if(this.shape.draw.renderer.imageAnnoApp.implementations.app.model.appCoreWrapper.browserUtility.type===p.Aq.Edge){this.pointRegularOverBoundingBySVGPathEdgeSupport(e,t,r,a);return}let h=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.width,c=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.height,l=.25*h;e.save(),e.translate(r+(l-l*n)*1.25,a+(c-c*n)),e.scale(n,n),e.strokeStyle=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.outlineHoverColorRGBAString,this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG&&e.stroke(this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG.path2D),e.restore()}}pointRegularOverBoundingBySVGPathSelected(e,t,s,i,n){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,r=!(arguments.length>6)||void 0===arguments[6]||arguments[6],a=arguments.length>7&&void 0!==arguments[7]&&arguments[7];arguments.length>8&&arguments[8],arguments.length>9&&arguments[9],arguments.length>10&&arguments[10];let h=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.pointBoundOffset;if(this.shape.draw.renderer.hasAni||(r=!1),r?h*=o:h-=h*o,a){e.lineWidth=.5+o*t.lineWidth*t.scaleGlobal*t.scaleLocal*this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.elasticScale;let n=s-.5*this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.width+6,r=i-this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.height+0;if(this.shape.draw.renderer.imageAnnoApp.implementations.app.model.appCoreWrapper.browserUtility.type===p.Aq.Edge){this.pointRegularOverBoundingBySVGPathEdgeSupport(e,t,n,r);return}e.save(),e.translate(n-1.5,r-1.75),e.scale(1.2,1.125),e.strokeStyle=t.colorInterpolatedString,this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG&&e.stroke(this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG.path2D),e.restore(),e.save(),e.translate(n,r),e.strokeStyle=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.outlineHoverColorRGBAString,this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG&&e.stroke(this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG.path2D),e.restore()}}pointRegularDragBySVGPath(e,t,s,i,n){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,r=!(arguments.length>6)||void 0===arguments[6]||arguments[6],a=arguments.length>7&&void 0!==arguments[7]&&arguments[7],h=(arguments.length>8&&arguments[8],arguments.length>9&&arguments[9],arguments.length>10&&arguments[10],arguments.length>11?arguments[11]:void 0),c=arguments.length>12?arguments[12]:void 0,l=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.pointBoundOffset;if(this.shape.draw.renderer.hasAni||(r=!1,o=1),r?l*=o:l-=l*o,i-=1.8*l,a){let e=2.5*l;e<0&&(e=0)}if(this.shape.draw.renderer.imageAnnoApp.implementations.app.model.appCoreWrapper.browserUtility.type===p.Aq.Edge){this.pointRagularSVGRenderEdgeSupport(e,t,s-.5*this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.width+6,i-this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.height+0,h,c);return}this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG&&this.pointRagularSVGRender(e,t,s-.5*this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.width+6,i-this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.height+0,n,h,c)}pointRagularSVGRender(e,t,s,i,n,o,r){let a=arguments.length>7&&void 0!==arguments[7]&&arguments[7],h=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.width,c=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.height;this.shape.draw.renderer.needFocus,e.fillStyle=t.colorInterpolatedString,r&&(e.fillStyle=t.colorInterpolatedString);let l=.25*h;e.save(),e.translate(s+(l-l*n)*1.25,i+(c-c*n)),e.scale(n,n),e.strokeStyle=t.colorStroke,e.fill(this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG.path2D,"evenodd"),e.lineWidth=0,a&&e.stroke(this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG.path2D),e.restore()}pointRegularDragGhost(e,t,s,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,o=!(arguments.length>5)||void 0===arguments[5]||arguments[5],r=arguments.length>6&&void 0!==arguments[6]&&arguments[6],a=(arguments.length>7&&arguments[7],arguments.length>8?arguments[8]:void 0),h=arguments.length>9?arguments[9]:void 0;if(!this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG)return;let c=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.pointBoundOffset;if(o?c*=n:c-=c*n,e.fillStyle=(0,p.Wo)(p.$C.Black,.3),e.beginPath(),o?e.ellipse(s,i,7,2.5,0,0,2*Math.PI,!1):e.ellipse(s,i+2,4,2,0,0,2*Math.PI,!1),e.closePath(),e.fill(),i-=1.8*c,r){let n=2.5*c;n<0&&(n=0),e.strokeStyle=t.colorStroke,e.lineWidth=t.lineWidth*t.scaleGlobal*t.scaleLocal,e.beginPath(),e.arc(s,i-.5*this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.height,n,0,2*Math.PI,!1),e.closePath(),e.fill(),e.stroke()}this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG&&(e.save(),e.translate(s-.5*this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.width,i-this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.height),e.beginPath(),Object.keys(this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG.path).map(t=>{let s=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG.path[t];if(s){let i=t.split(" ")[1];"M"===i?e.moveTo(s[0],s[1]):"C"===i?e.bezierCurveTo(s[0],s[1],s[2],s[3],s[4],s[5]):"L"===i&&e.lineTo(s[0],s[1])}return 0}),h||(e.fillStyle=(0,p.Z3)("#888888",a-.8)),e.closePath(),e.fill(),e.restore())}pointNumberedOverBoundingByCircleSelected(e,t,s,i,n){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,r=!(arguments.length>6)||void 0===arguments[6]||arguments[6],a=arguments.length>7&&void 0!==arguments[7]&&arguments[7];arguments.length>8&&arguments[8],arguments.length>9&&arguments[9];let h=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.nPoint.height,c=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.pointBoundOffset;if(r?c*=o:c-=c*o,e.fillStyle=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.outlineHoverColorRGBAString,a){let r=h*n*.5+.75*o*this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.elasticScale;r<0&&(r=0),e.beginPath(),e.arc(s,i-h*n*.5,r,0,2*Math.PI,!1),e.closePath(),e.fill(),e.strokeStyle=t.colorFill,e.lineWidth=2.5,e.beginPath(),e.arc(s,i-h*n*.5,r+1,0,2*Math.PI,!1),e.closePath(),e.stroke()}}pointNumberedOverBoundingByCircle(e,t,s,i,n){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,r=!(arguments.length>6)||void 0===arguments[6]||arguments[6],a=arguments.length>7&&void 0!==arguments[7]&&arguments[7];arguments.length>8&&arguments[8],arguments.length>9&&arguments[9];let h=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.nPoint.height,c=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.pointBoundOffset;if(r?c*=o:c-=c*o,e.fillStyle=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.outlineHoverColorRGBAString,a){let t=h*n*.5+.75*o*this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.elasticScale;t<0&&(t=0),e.beginPath(),e.arc(s,i-h*n*.5,t,0,2*Math.PI,!1),e.closePath(),e.fill()}}pointNumberedDragByCircle(e,t,s,i,n){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,r=!(arguments.length>6)||void 0===arguments[6]||arguments[6],a=arguments.length>7&&void 0!==arguments[7]&&arguments[7],h=(arguments.length>8&&arguments[8],arguments.length>9&&arguments[9],arguments.length>10&&arguments[10],arguments.length>11?arguments[11]:void 0),c=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.nPoint.height*n,l=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.nPoint.scale;this.shape.draw.renderer.hasAni||(r=!1,o=1);let p=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.pointBoundOffset;if(r?p*=o:p-=p*o,i-=1.8*p,e.strokeStyle=t.colorStroke,e.fillStyle=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.outlineHoverColorRGBAString,a){let t=3.5*l*p;t<0&&(t=0),e.beginPath(),e.arc(s,i-.5*c,t,0,2*Math.PI,!1),e.closePath(),e.fill()}this.shape.draw.renderer.needFocus,e.fillStyle=t.colorInterpolatedString,h&&(e.fillStyle=t.colorInterpolatedString),e.beginPath(),e.arc(s,i-.5*c,.5*c,0,2*Math.PI),e.closePath(),e.fill()}pointNumberedDragByCircleGhost(e,t,s,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,o=!(arguments.length>5)||void 0===arguments[5]||arguments[5],r=arguments.length>6&&void 0!==arguments[6]&&arguments[6],a=(arguments.length>7&&arguments[7],arguments.length>8&&arguments[8],arguments.length>9?arguments[9]:void 0),h=arguments.length>10?arguments[10]:void 0,c=arguments.length>11?arguments[11]:void 0,l=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.nPoint.height;this.shape.draw.renderer.hasAni||(o=!1,n=1);let d=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.pointBoundOffset;if(o?d*=n:d-=d*n,e.fillStyle=(0,p.Wo)(p.$C.Black,.3),o&&(e.beginPath(),e.ellipse(s,i,7,2.5,0,0,2*Math.PI,!1),e.closePath(),e.fill()),i-=1.8*d,e.strokeStyle=t.colorStroke,e.fillStyle=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.outlineHoverColorRGBAString,r){let t=2.5*this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.nPoint.scale*d;t<0&&(t=0),e.beginPath(),e.arc(s,i-.5*l+2,t,0,2*Math.PI,!1),e.closePath(),e.fill()}this.shape.draw.renderer.needFocus,e.fillStyle=t.colorInterpolatedString,c&&(e.fillStyle=t.colorInterpolatedString),e.beginPath(),e.arc(s,i-.5*l+2,.5*l,0,2*Math.PI),e.closePath(),e.fill();let m="".concat(this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.nPoint.fontSize,"px ").concat(this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.nPoint.fontFamily);e.font=m;let u=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.nPoint.fontColorArray;h||c?e.fillStyle="rgba(".concat(u[0],", ").concat(u[1],", ").concat(u[2],", ").concat(u[3],")"):e.fillStyle="rgba(".concat(u[0],", ").concat(u[1],", ").concat(u[2],", ").concat(u[3]-.3,")"),e.textAlign="center",e.fillText(a.toString(),s,i-.5*l+6)}pointIcon(e,t,s,i,n,o,r,a,h,c){arguments.length>10&&void 0!==arguments[10]&&arguments[10];let l=arguments.length>11&&void 0!==arguments[11]?arguments[11]:1;e.globalAlpha=c,e.fillStyle=t.colorFill;let p=10*l,d=.5*n+p,m=.5*o+p,u=.5*d,g=.5*m;e.drawImage(r,s-u,i-g,d,m)}centerPoint(e,t,s){e.beginPath(),e.arc(t,s,1,0,2*Math.PI,!1),e.closePath(),e.fillStyle="black",e.fill()}centerPointCircle(e,t,s){e.lineWidth=1,e.strokeStyle="#001c1b",e.beginPath(),e.moveTo(t,s-4.5),e.lineTo(t,s+4.5),e.moveTo(t-4.5,s),e.lineTo(t+4.5,s),e.stroke()}pointRagularSVGRenderEdgeSupport(e,t,s,i,n,o){if(arguments.length>6&&void 0!==arguments[6]&&arguments[6],e.save(),e.translate(s,i),this.shape.draw.renderer.needFocus,e.fillStyle=t.colorInterpolatedString,o&&(e.fillStyle=t.colorInterpolatedString),e.strokeStyle=t.colorStroke,e.lineWidth=0,this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG&&this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG.path){let t=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG.path;e.beginPath(),Object.keys(t).map(s=>{let i=t[s];if(i){let t=s.split(" ")[1];"M"===t?e.moveTo(i[0],i[1]):"C"===t?e.bezierCurveTo(i[0],i[1],i[2],i[3],i[4],i[5]):"L"===t&&e.lineTo(i[0],i[1])}return 0}),e.closePath(),e.fill()}e.restore()}pointRegularOverBoundingBySVGPathEdgeSupport(e,t,s,i){e.save(),e.translate(s,i),e.strokeStyle=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.outlineHoverColorRGBAString;let n=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG.path;e.beginPath(),Object.keys(n).map(t=>{let s=n[t];if(s){let i=t.split(" ")[1];"M"===i?e.moveTo(s[0],s[1]):"C"===i?e.bezierCurveTo(s[0],s[1],s[2],s[3],s[4],s[5]):"L"===i&&e.lineTo(s[0],s[1])}return 0}),e.closePath(),e.stroke(),e.restore()}shadowRPoint(e,t,s,i,n,o){this.shape.draw.renderer.imageAnnoApp.implementations.app.model.appCoreWrapper.browserUtility.type!==p.Aq.Safari&&this.shape.draw.renderer.imageAnnoApp.implementations.app.model.appCoreWrapper.browserUtility.type!==p.Aq.Edge&&(e.beginPath(),e.ellipse(s,i+5,10,2.5,0,0,2*Math.PI,!1),e.closePath(),n||o?e.fillStyle=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.shadowColorHover:e.fillStyle=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.shadowColor,e.filter="blur(".concat(this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.shadowBlur,"px)"),e.fill(),e.filter="none")}shadowRPointLight(e,t,s,i,n,o,r){this.shape.draw.renderer.imageAnnoApp.implementations.app.model.appCoreWrapper.browserUtility.type!==p.Aq.Safari&&this.shape.draw.renderer.imageAnnoApp.implementations.app.model.appCoreWrapper.browserUtility.type!==p.Aq.Edge&&(e.beginPath(),e.ellipse(s,i+5,10,2.5,0,0,2*Math.PI,!1),e.closePath(),e.fillStyle=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.shadowColor,e.filter="blur(".concat(this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.shadowBlur,"px)"),e.fill(),e.filter="none")}shadowNPoint(e,t,s,i,n,o,r){this.shape.draw.renderer.imageAnnoApp.implementations.app.model.appCoreWrapper.browserUtility.type!==p.Aq.Safari&&this.shape.draw.renderer.imageAnnoApp.implementations.app.model.appCoreWrapper.browserUtility.type!==p.Aq.Edge&&(e.beginPath(),e.ellipse(s,i+5,10*n,2.5,0,0,2*Math.PI,!1),e.closePath(),o||r?e.fillStyle=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.nPoint.shadowColorHover:e.fillStyle=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.nPoint.shadowColor,e.filter="blur(".concat(this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.nPoint.shadowBlur,"px)"),e.fill(),e.filter="none")}shadowNPointLight(e,t,s,i,n,o,r){this.shape.draw.renderer.imageAnnoApp.implementations.app.model.appCoreWrapper.browserUtility.type!==p.Aq.Safari&&this.shape.draw.renderer.imageAnnoApp.implementations.app.model.appCoreWrapper.browserUtility.type!==p.Aq.Edge&&(e.beginPath(),e.ellipse(s,i+5,10*n,2.5,0,0,2*Math.PI,!1),e.closePath(),e.fillStyle=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.nPoint.shadowColor,e.filter="blur(".concat(this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.nPoint.shadowBlur,"px)"),e.fill(),e.filter="none")}constructor(e){this.shape=e}}class is{pointGenericDrag(e,t,s,i,n,o){let r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,a=!(arguments.length>7)||void 0===arguments[7]||arguments[7],h=arguments.length>8&&void 0!==arguments[8]&&arguments[8],c=(arguments.length>9&&arguments[9],arguments.length>10&&arguments[10],arguments.length>11&&arguments[11],arguments.length>12?arguments[12]:void 0),l=arguments.length>13?arguments[13]:void 0,d=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.pointBoundOffset;if(this.shape.draw.renderer.hasAni||(a=!1,r=1),a?d*=r:d-=d*r,n-=1.8*d,h){let e=2.5*d;e<0&&(e=0)}if(this.shape.draw.renderer.imageAnnoApp.implementations.app.model.appCoreWrapper.browserUtility.type===p.Aq.Edge){this.pointRegularSVGRenderEdgeSupport(e,t,s,i-.25*s.width*o,n-s.height+0,c,l);return}this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG&&this.pointRegularSVGRender(e,t,s,i,n,o,c,l)}pointRegularSVGRender(e,t,s,i,n,o,r,a){let h=arguments.length>8&&void 0!==arguments[8]&&arguments[8],c=s.width,l=s.height,d=.25*c*o;switch(this.shape.draw.renderer.needFocus,e.fillStyle=s.colorInterpolatedString,a&&(e.fillStyle=s.colorInterpolatedString),e.save(),e.translate(i-d,n-l*o),e.scale(o,o),e.strokeStyle=s.colorStroke,t){case p.oW.RpointA:e.fill(this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG.path2D,"evenodd"),e.lineWidth=0,h&&e.stroke(this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG.path2D);break;case p.oW.Image:this.getIconByURL(s.url)&&this.pointIcon(e,s,0,0,32,32,this.getIconByURL(s.url),!1,!1,1,r,a)}e.restore()}pointIcon(e,t,s,i,n,o,r,a,h,c){let l=arguments.length>10&&void 0!==arguments[10]&&arguments[10],p=arguments.length>11&&void 0!==arguments[11]&&arguments[11];arguments.length>12&&void 0!==arguments[12]&&arguments[12],arguments.length>13&&void 0!==arguments[13]&&arguments[13],e.globalAlpha=c,e.fillStyle=t.colorFill,l||p||(e.globalAlpha=t.interpolationNum),e.drawImage(r,s,i,n,o),e.globalAlpha=1}pointIconHover(e,t,s,i,n,o,r,a,h,c){arguments.length>10&&void 0!==arguments[10]&&arguments[10],arguments.length>11&&void 0!==arguments[11]&&arguments[11],e.lineWidth=.75,e.beginPath(),e.rect(s-1,i-1,n+2,o+2),e.closePath(),e.strokeStyle=p.$C.Black,e.stroke(),e.beginPath(),e.rect(s,i,n,o),e.closePath(),e.strokeStyle=p.$C.White,e.stroke()}pointIconSelected(e,t,s,i,n,o,r,a,h,c){arguments.length>10&&void 0!==arguments[10]&&arguments[10],arguments.length>11&&void 0!==arguments[11]&&arguments[11],t.size===p.$u.SMALL?(e.lineWidth=.75,e.beginPath(),e.rect(s-5,i-12,n+10,o+12),e.closePath(),e.strokeStyle=p.$C.Black,e.stroke(),e.beginPath(),e.rect(s-4,i-11,n+8,o+10)):(e.lineWidth=.5,e.beginPath(),e.rect(s-3,i-7,n+6,o+8),e.closePath(),e.strokeStyle=p.$C.Black,e.stroke(),e.beginPath(),e.rect(s-2,i-6,n+4,o+6)),e.closePath(),e.strokeStyle=p.$C.White,e.stroke()}pointGenericOverBoundingSelected(e,t,s,i,n,o){let r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,a=!(arguments.length>7)||void 0===arguments[7]||arguments[7],h=arguments.length>8&&void 0!==arguments[8]&&arguments[8];arguments.length>9&&arguments[9],arguments.length>10&&arguments[10],arguments.length>11&&arguments[11];let c=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.pointBoundOffset,l=s.height;if(this.shape.draw.renderer.hasAni||(a=!1),a?c*=r:c-=c*r,h){e.lineWidth=.5+r*s.lineWidth*this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.elasticScale;let a=i-.25*s.width*o,h=n-s.height*o;if(this.shape.draw.renderer.imageAnnoApp.implementations.app.model.appCoreWrapper.browserUtility.type===p.Aq.Edge){this.pointRegularOverBoundingBySVGPathEdgeSupport(e,s,a,h);return}if(e.save(),e.translate(a,n-l*o),e.scale(o,o),e.lineWidth=5,e.strokeStyle=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.outlineHoverColorRGBAString,this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG)switch(t){case p.oW.RpointA:e.stroke(this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG.path2D);break;case p.oW.Image:this.pointIconSelected(e,s,a,h,32,32,this.getIconByURL(s.url),!1,!1,1)}e.restore()}}pointGenericOverBounding(e,t,s,i,n,o){let r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,a=!(arguments.length>7)||void 0===arguments[7]||arguments[7],h=arguments.length>8&&void 0!==arguments[8]&&arguments[8];arguments.length>9&&arguments[9],arguments.length>10&&arguments[10],arguments.length>11&&arguments[11];let c=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.pointBoundOffset;if(this.shape.draw.renderer.hasAni||(a=!1),a?c*=r:c-=c*r,h){e.lineWidth=.5+r*s.lineWidth*this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.elasticScale*2;let a=i-.25*s.width*o,h=n-s.height+0;if(this.shape.draw.renderer.imageAnnoApp.implementations.app.model.appCoreWrapper.browserUtility.type===p.Aq.Edge){this.pointRegularOverBoundingBySVGPathEdgeSupport(e,s,a,h);return}let c=s.width,l=s.height,d=.25*c*o;switch(e.save(),e.translate(i-d,n-l*o),e.scale(o,o),e.strokeStyle=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.outlineHoverColorRGBAString,t){case p.oW.RpointA:this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG&&e.stroke(this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG.path2D);break;case p.oW.Image:this.pointIconHover(e,s,0,0,32,32,this.getIconByURL(s.url),!1,!1,1)}e.restore()}}pointRegularSVGRenderEdgeSupport(e,t,s,i,n,o,r){switch(arguments.length>7&&void 0!==arguments[7]&&arguments[7],e.save(),e.translate(i,n),this.shape.draw.renderer.needFocus,e.fillStyle=s.colorInterpolatedString,r&&(e.fillStyle=s.colorInterpolatedString),e.strokeStyle=s.colorStroke,e.lineWidth=0,t){case p.oW.RpointA:if(this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG&&this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG.path){let t=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG.path;e.beginPath(),Object.keys(t).map(s=>{let i=t[s];if(i){let t=s.split(" ")[1];"M"===t?e.moveTo(i[0],i[1]):"C"===t?e.bezierCurveTo(i[0],i[1],i[2],i[3],i[4],i[5]):"L"===t&&e.lineTo(i[0],i[1])}return 0}),e.closePath(),e.fill()}case p.oW.Image:}e.restore()}pointRegularOverBoundingBySVGPathEdgeSupport(e,t,s,i){e.save(),e.translate(s,i),e.strokeStyle=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.outlineHoverColorRGBAString;let n=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG.path;e.beginPath(),Object.keys(n).map(t=>{let s=n[t];if(s){let i=t.split(" ")[1];"M"===i?e.moveTo(s[0],s[1]):"C"===i?e.bezierCurveTo(s[0],s[1],s[2],s[3],s[4],s[5]):"L"===i&&e.lineTo(s[0],s[1])}return 0}),e.closePath(),e.stroke(),e.restore()}getIconByURL(e){return this.shape.draw.renderer.imageAnnoApp.customization.iconAsset.getIconByURL(e)}constructor(e){this.shape=e}}class ii{pointSVGNormalFill(e,t,s,i,n,o){arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]&&arguments[7],arguments.length>8&&void 0!==arguments[8]&&arguments[8],arguments.length>9&&arguments[9],arguments.length>10&&arguments[10],arguments.length>11&&arguments[11];let r=arguments.length>12?arguments[12]:void 0,a=arguments.length>13?arguments[13]:void 0,h=arguments.length>14&&void 0!==arguments[14]&&arguments[14];this.pointSVGRender(e,t,s,i,n,o,r,a,h)}pointSVGRender(e,t,s,i,n,o,r,a){let h=arguments.length>8&&void 0!==arguments[8]&&arguments[8],c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:1,l=s.width,p=s.height,d=.365*l*o;this.shape.draw.renderer.needFocus,e.fillStyle=s.colorInterpolatedString,a&&(e.fillStyle=s.colorInterpolatedString),e.save(),e.translate(i-d,n-p*o),e.scale(o,o),e.strokeStyle=s.colorStroke,h&&(e.lineWidth=4*c,e.strokeStyle="#ffffff",e.stroke(t)),e.fill(t,"evenodd"),e.restore()}pointIcon(e,t,s,i,n,o,r,a,h,c){let l=arguments.length>10&&void 0!==arguments[10]&&arguments[10],p=arguments.length>11&&void 0!==arguments[11]&&arguments[11];arguments.length>12&&void 0!==arguments[12]&&arguments[12],arguments.length>13&&void 0!==arguments[13]&&arguments[13],e.globalAlpha=c,e.fillStyle=t.colorFill,l||p||(e.globalAlpha=t.interpolationNum),e.drawImage(r,s,i,n,o),e.globalAlpha=1}pointIconHover(e,t,s,i,n,o,r,a,h,c){arguments.length>10&&void 0!==arguments[10]&&arguments[10],arguments.length>11&&void 0!==arguments[11]&&arguments[11],e.lineWidth=.75,e.beginPath(),e.rect(s-1,i-1,n+2,o+2),e.closePath(),e.strokeStyle=p.$C.Black,e.stroke(),e.beginPath(),e.rect(s,i,n,o),e.closePath(),e.strokeStyle=p.$C.White,e.stroke()}pointIconSelected(e,t,s,i,n,o,r,a,h,c){arguments.length>10&&void 0!==arguments[10]&&arguments[10],arguments.length>11&&void 0!==arguments[11]&&arguments[11],t.size===p.$u.SMALL?(e.lineWidth=.75,e.beginPath(),e.rect(s-5,i-12,n+10,o+12),e.closePath(),e.strokeStyle=p.$C.Black,e.stroke(),e.beginPath(),e.rect(s-4,i-11,n+8,o+10)):(e.lineWidth=.5,e.beginPath(),e.rect(s-3,i-7,n+6,o+8),e.closePath(),e.strokeStyle=p.$C.Black,e.stroke(),e.beginPath(),e.rect(s-2,i-6,n+4,o+6)),e.closePath(),e.strokeStyle=p.$C.White,e.stroke()}pointGenericOverBoundingSelected(e,t,s,i,n,o){let r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,a=!(arguments.length>7)||void 0===arguments[7]||arguments[7],h=arguments.length>8&&void 0!==arguments[8]&&arguments[8];arguments.length>9&&arguments[9],arguments.length>10&&arguments[10],arguments.length>11&&arguments[11];let c=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.pointBoundOffset,l=s.width,d=s.height,m=.5*l*o;if(this.shape.draw.renderer.hasAni||(a=!1),a?c*=r:c-=c*r,h){if(e.lineWidth=.5+r*s.lineWidth*s.scaleGlobal*s.scaleLocal*this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.elasticScale,e.save(),e.translate(i-m,n-d*o),e.scale(o,o),e.lineWidth=7,e.strokeStyle=s.colorInterpolatedString,this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG||(e.lineWidth=3,e.strokeStyle=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.outlineHoverColorRGBAString,this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG))switch(t){case p.oW.RpointA:e.stroke(this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG.path2D);break;case p.oW.Image:this.pointIconSelected(e,s,0,0,32,32,this.getIconByURL(s.url),!1,!1,1)}e.restore()}}pointGenericOverBounding(e,t,s,i,n,o){let r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,a=!(arguments.length>7)||void 0===arguments[7]||arguments[7],h=arguments.length>8&&void 0!==arguments[8]&&arguments[8];arguments.length>9&&arguments[9],arguments.length>10&&arguments[10],arguments.length>11&&arguments[11];let c=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.pointBoundOffset;if(this.shape.draw.renderer.hasAni||(a=!1),a?c*=r:c-=c*r,h){e.lineWidth=.5+r*s.lineWidth*s.scaleGlobal*s.scaleLocal*this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.elasticScale*2;let a=s.width,h=s.height,c=.5*a*o;switch(e.save(),e.translate(i-c,n-h*o),e.scale(o,o),e.strokeStyle=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.outlineHoverColorRGBAString,t){case p.oW.RpointA:this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG&&e.stroke(this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG.path2D);break;case p.oW.Image:this.pointIconHover(e,s,0,0,32,32,this.getIconByURL(s.url),!1,!1,1)}e.restore()}}pointNumberedOverBoundingByCircle(e,t,s,i,n,o){let r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,a=!(arguments.length>7)||void 0===arguments[7]||arguments[7],h=arguments.length>8&&void 0!==arguments[8]&&arguments[8];arguments.length>9&&arguments[9],arguments.length>10&&arguments[10];let c=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.nPoint.height,l=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.pointBoundOffset;if(a?l*=r:l-=l*r,e.fillStyle=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.outlineHoverColorRGBAString,h){let s=c*o*.5+.75*r*this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.elasticScale;s<0&&(s=0),e.fill(t)}}getIconByURL(e){return this.shape.draw.renderer.imageAnnoApp.customization.iconAsset.getIconByURL(e)}constructor(e){this.shape=e}}class io{edgePolylineLineTo(e,t,s,i,n,o){arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]&&arguments[7],arguments.length>8&&void 0!==arguments[8]&&arguments[8],arguments.length>9&&void 0!==arguments[9]&&arguments[9],arguments.length>10&&arguments[10],arguments.length>11&&arguments[11],e.lineTo(s,i),e.lineTo(n,o)}edgePolyline(e,t,s,i,n,o){arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]&&arguments[7],arguments.length>8&&void 0!==arguments[8]&&arguments[8],arguments.length>9&&void 0!==arguments[9]&&arguments[9],arguments.length>10&&arguments[10],arguments.length>11&&arguments[11],e.moveTo(s,i),e.lineTo(n,o)}curveQuadratic(e,t,s,i,n,o,r,a){arguments.length>8&&void 0!==arguments[8]&&arguments[8],arguments.length>9&&arguments[9],e.moveTo(s,i),e.quadraticCurveTo(n,o,r,a)}constructor(e){this.shape=e}}class ir{selectionLasso(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2];let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;e.globalCompositeOperation=p.ew.ColorDodge,e.lineWidth=1,e.lineDashOffset=-s;let i=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.selection.strokeStyleFirstArray;e.strokeStyle="rgba(".concat(i[0],", ").concat(i[1],", ").concat(i[2],", 0.9)"),i=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.selection.fillStyleFirstArray,e.fillStyle="rgba(".concat(i[0],", ").concat(i[1],", ").concat(i[2],", 0.3)"),e.setLineDash([4,4]),e.beginPath(),e.setLineDash([5,4]),e.moveTo(t[0].x,t[0].y);for(let s=1;s<t.length;++s)e.lineTo(t[s].x,t[s].y);e.closePath(),e.fill(),e.stroke(),e.setLineDash([]),e.globalCompositeOperation=p.ew.SourceOver}selection(e,t,s){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;e.globalCompositeOperation=p.ew.ColorDodge,e.lineWidth=1,e.lineDashOffset=-n;let o=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.selection.strokeStyleFirstArray;e.strokeStyle="rgba(".concat(o[0],", ").concat(o[1],", ").concat(o[2],", 0.9)"),o=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.selection.fillStyleFirstArray,e.fillStyle="rgba(".concat(o[0],", ").concat(o[1],", ").concat(o[2],", 0.3)"),i?e.setLineDash([4,4]):e.setLineDash([5,4]),e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(t.x,s.y),e.lineTo(s.x,s.y),e.lineTo(s.x,t.y),e.closePath(),e.fill(),e.stroke(),e.setLineDash([]),e.globalCompositeOperation=p.ew.SourceOver}constructor(e){this.shape=e}}class ia{circleBG(e,t,s,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,o=this.shape.draw.renderer.imageAnnoApp.activeCommandController.activeColorController.activeColor;e.strokeStyle="rgba(".concat(o[0],", ").concat(o[1],", ").concat(o[2],", 0.9)"),e.fillStyle="rgba(".concat(o[0],", ").concat(o[1],", ").concat(o[2],", 0.3)");let r=i+1*n;r<0&&(r=0),e.beginPath(),e.arc(t,s,r,0,2*Math.PI,!1),e.closePath(),e.fill()}constructor(e){this.shape=e}}class ih{roundedRectACTextStoryMapByWidth(e,t,s,i,n,o){arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]&&arguments[7];let r=arguments.length>8?arguments[8]:void 0,a=arguments.length>9?arguments[9]:void 0;e.beginPath(),e.rect(s.x,s.y,i,n),e.closePath();let c=t.styleBox.fillStyle;e.fillStyle="rgba(".concat(c[0],", ").concat(c[1],", ").concat(c[2],", 1)"),a&&(e.fillStyle="rgba(".concat(c[0],", ").concat(c[1],", ").concat(c[2],", 1)")),t.state.textColor===h.BackgroundColor||t.state.textColor===h.TitleColor?(e.shadowBlur=15,e.shadowColor="rgba(0,0,0,0.05)",e.fill(),e.shadowBlur=0):(this.shape.draw.renderer.imageAnnoApp.implementations.app.param.interactionMode===p.An.Drawing&&(e.strokeStyle="rgba(".concat(t.styleLeaderline.strokeStyle[0],", ").concat(t.styleLeaderline.strokeStyle[1],", ").concat(t.styleLeaderline.strokeStyle[2],", 1)"),(a||r)&&(e.lineWidth=t.styleBox.lineWidth,e.setLineDash([4,4]),e.stroke())),e.setLineDash([]))}renderNodeDia(e,t,s,i,n,o){e.beginPath(),e.moveTo(s+n,i),e.lineTo(s,i+o),e.lineTo(s-n,i),e.lineTo(s,i-o),e.closePath(),e.lineWidth=t.styleHandleNode.lineWidth,e.strokeStyle="rgba(".concat(t.styleHandleNode.strokeStyle[0],", ").concat(t.styleHandleNode.strokeStyle[1],", ").concat(t.styleHandleNode.strokeStyle[2],", ").concat(t.styleHandleNode.strokeStyle[3],")"),e.fillStyle="rgba(".concat(t.styleHandleNode.fillStyle[0],", ").concat(t.styleHandleNode.fillStyle[1],", ").concat(t.styleHandleNode.fillStyle[2],", ").concat(t.styleHandleNode.fillStyle[3],")"),e.fill(),e.stroke()}renderLeaderLine(e,t,s,i,n,o,r,a,h){let c=t.styleLeaderline.strokeStyle,l="rgba(".concat(c[0],", ").concat(c[1],", ").concat(c[2],", ").concat(c[3],")");e.lineDashOffset=0,e.beginPath(),e.moveTo(s.x,s.y),e.lineTo(i.x,i.y),e.lineTo(n.x,n.y),e.setLineDash(t.styleLeaderline.dash),this.needResetDash=!0,e.strokeStyle=l,e.lineWidth=t.styleLeaderline.lineWidth,e.stroke(),e.setLineDash([]),(a||h)&&(e.beginPath(),e.arc(n.x,n.y,7,0,6.28),e.closePath(),e.strokeStyle="rgba(".concat(t.styleAnchorNode.strokeStyle[0],", ").concat(t.styleAnchorNode.strokeStyle[1],", ").concat(t.styleAnchorNode.strokeStyle[2],", ").concat(t.styleAnchorNode.strokeStyle[3],")"),e.fillStyle="rgba(".concat(t.styleAnchorNode.fillStyle[0],", ").concat(t.styleAnchorNode.fillStyle[1],", ").concat(t.styleAnchorNode.fillStyle[2],", ").concat(t.styleAnchorNode.fillStyle[3],")"),e.lineWidth=t.styleAnchorNode.lineWidth,e.fill(),e.stroke())}constructor(e){this.needResetDash=!1,this.shape=e}}class ic{constructor(e){this.draw=e,this.point=new it(this),this.pointGeneric=new is(this),this.pointSVG=new ii(this),this.node=new ie(this),this.cluster=new s9(this),this.line=new s8(this),this.ngon=new s7(this),this.area=new s3(this),this.text=new ih(this),this.curve=new s6(this),this.polyline=new io(this),this.selection=new ir(this),this.freeHand=new s4(this),this.snapping=new ia(this)}}class il{init(){this.shape=new ic(this),this.image=new s5(this)}constructor(e){this.renderer=e,this.init()}}class ip{initPost(){this.canvasOff(),this.bindContextForOffscreen(),this.optimizer=new s0(this)}get needFocus(){return this._needFocus}set needFocus(e){this._needFocus=!1}get dt(){return this.imageAnnoApp.graphicsCoreWrapper.canvasWrapper.aCanvas.deltaTime.dt}bindContextForOffscreen(){this.ctxOffscreen=this.imageAnnoApp.graphicsCoreWrapper.canvasWrapper.aCanvasOffScreen.offScreenCtx}development(){}canvasOff(){this.xOff=0,this.yOff=0,this.xOffCurrent=0,this.yOffCurrent=0,this.xOffPre=0,this.yOffPre=0,this.zoomFactor=0,this.zoomFactorPre=0,this.zoomFactorCurrent=0,this.anchor=new p.h9(0,0,0)}saveDrawingGeometries(){let e=new Map;for(this.index=this.imageAnnoApp.scene.geometryList.length;this.index--;){let t=this.imageAnnoApp.scene.geometryList[this.index].toJSON();void 0!==t&&e.set(this.imageAnnoApp.scene.geometryList[this.index].id,t)}return e}Init(){}render(e){this.updatePre(),this.renderPre(e),console.log("rendering..."),this.env.renderEnv(e),this.renderPost(e),this.updatePost()}get updateProjectionForce(){return this._updateProjectionForce}set updateProjectionForce(e){this._updateProjectionForce=e,this.t=0}destroy(){}updateMouseHover(e){let t=!1;for(this.index=this.imageAnnoApp.scene.geometryList.length;this.index--;)this.imageAnnoApp.scene.geometryList[this.index].isSelectedValue&&(t=!0),this.imageAnnoApp.scene.geometryList[this.index].isMouseInside(e.x,e.y)?(this.imageAnnoApp.scene.geometryList[this.index].isHover=!0,this.imageAnnoApp.geometryCommon.gcmdProcessing.setCaptureHovered(this.imageAnnoApp.scene.geometryList[this.index]),t=!0):this.imageAnnoApp.scene.geometryList[this.index].isHover=!1;t||this.imageAnnoApp.geometryCommon.gcmdProcessing.setCaptureHovered(void 0),this.imageAnnoApp.renderer.needFocus=t,this.imageAnnoApp.activeCommandController.acProperties.hasHovering=t}updatePre(){if(this.imageAnnoApp.scene.reset(),this.xOff=this.xOffCurrent-this.xOffPre,this.yOff=this.yOffCurrent-this.yOffPre,this.zoomFactor=this.zoomFactorCurrent-this.zoomFactorPre,this.t+=.01,this.index=this.imageAnnoApp.scene.listBasePoint.length,this.updateProjectionForce){if(this.imageAnnoApp.activeCommandController.acProperties.isPanning=!0,this.frameUpdateValue++%2==0)for(;this.index--;)this.imageAnnoApp.scene.listBasePoint[this.index].update(!0);this.t>.5&&(this.imageAnnoApp.activeCommandController.acProperties.isPanning=!1,this.updateProjectionForce=!1)}else if(this.imageAnnoApp.activeCommandController.acProperties.isPanning||this.imageAnnoApp.activeCommandController.acProperties.isZooming)for(;this.index--;)this.imageAnnoApp.scene.listBasePoint[this.index].update();else if(this.frameUpdateValue++%3==0)for(;this.index--;)this.imageAnnoApp.scene.listBasePoint[this.index].update();this.optimizer.update()}updatePost(){this.xOffPre=this.xOffCurrent,this.yOffPre=this.yOffCurrent,this.zoomFactorPre=this.zoomFactorCurrent}renderPre(e){this.blackhole&&this.blackhole.render(e)}renderPost(e){for(this.imageAnnoApp.implementations.app.model.appCoreWrapper.appProperties.compileMode,p.ct.Production,this.index=this.imageAnnoApp.scene.listALog.length;this.index--;)this.imageAnnoApp.scene.listALog[this.index].render(e);this.renderCroppingArea(e),this.selection.render(e)}renderCroppingArea(e){this.imageAnnoApp.scene.paramsEditing.renderCroppingArea(e)}constructor(e,t,s=60){this.debugText=0,this.isFetchTheme=!1,this.unHover=!1,this.hasAni=!1,this.frameValue=0,this.frameUpdateValue=0,this.frameSkipValue=2,this._updateProjectionForce=!0,this._needFocus=!1,this.index=0,this.imageAnnoApp=e,this.numericalMotion=new p.aX,this.t=0,this.hasAni=t,this.frameRate=s,this.needBlackhole=!1,this.env=new s1(this),this.objectSnapping=new sk(this),this.draw=new il(this),this.offscreen=new s2(this),this.imageAnnoApp.implementations.app.model.appCoreWrapper.appProperties.compileMode!==p.ct.Production&&this.development(),this.selection=new en(this.imageAnnoApp.scene),this.needBlackhole&&(this.blackhole=new sO(this.imageAnnoApp.scene))}}class id{constructor(e,t,s,i){this.geometry=[],this.activeColor="#000000",this.globalScale=1,this.isModifiedImage=!0,this.geometry=e,this.isModifiedImage=t,this.activeColor=s,this.globalScale=i}}class im extends p.i${pushAdapter(e,t,s,i){this.push(new id(e,t,s,i))}push(e){this.currentIndex<this.history.length-1&&this.history.splice(this.currentIndex+1,this.history.length),this.history.push(e),this.currentIndex=this.history.length-1}undo(){if(0!==this.currentIndex)return this.currentIndex--,this.history[this.currentIndex]}redo(){return this.currentIndex++,this.currentIndex=this.currentIndex<this.history.length?this.currentIndex:this.history.length-1,this.history[this.currentIndex]}constructor(){super(),this.history=[]}}class iu{isInsideCropShape(e,t){if(this.croppingMaskParams.shape===p.oU.Circle){let s=this.scene.annotationInstance.implementations.app.model.imageWrapper.projectionToImageSpace(e,t);return 0===this.ctx.getImageData(s[0],s[1],1,1).data[3]}return!0}updateDataCropping(e){let t=document.createElement("canvas");t.style.width="100%",t.style.height="100%",this.ctx=t.getContext("2d"),t.width=e.width,t.height=e.height,this.croppingMaskParams=e,this.scene.annotationInstance.geometryCommon.gcmdSupporting.renderForce(),this.drawOffscreen(this.ctx)}updateBGStyle(){this.croppingMaskParams.isCropGraphics}toggleCropGraphics(){this.croppingMaskParams.isCropGraphics=!this.croppingMaskParams.isCropGraphics}renderCroppingArea(e){this.croppingMaskParams.isCropGraphics&&(0,p.EW)(e,this.croppingMaskParams.shape,0,0,this.croppingMaskParams.width,this.croppingMaskParams.height,!1),this.updateBGStyle()}drawOffscreen(e){if(this.croppingMaskParams.shape===p.oU.Circle){let t=.5*this.croppingMaskParams.width,s=.5*this.croppingMaskParams.height;e.beginPath(),e.rect(-1,-1,e.canvas.width+1,e.canvas.height+1),e.ellipse(t,s,t,s,0,0,2*Math.PI),e.closePath(),e.fill("evenodd")}else e.beginPath(),e.rect(0,0,e.canvas.width,this.croppingMaskParams.y),e.rect(0,this.croppingMaskParams.y+this.croppingMaskParams.height,e.canvas.width,e.canvas.height),e.rect(0,0,this.croppingMaskParams.x,e.canvas.height),e.rect(this.croppingMaskParams.x+this.croppingMaskParams.width,0,e.canvas.width,e.canvas.height),e.closePath(),e.fill()}constructor(e){this.scene=e}}class ig{undo(){let e=this.sceneManager.undo();void 0===e?this.annotationInstance.geometryCommon.gcmdProcessing.removeBeforeDump():(this.annotationInstance.activeCommandController.setScaleGlobal(e.globalScale),this.annotationInstance.activeCommandController.reUndoProcessing(e.geometry),e.isModifiedImage!==this.useModifiedImage&&(e.isModifiedImage?this.annotationInstance.implementations.app.model.imageWrapper.toCroppedImg():this.annotationInstance.implementations.app.model.imageWrapper.toOriginalImg()),this.useModifiedImage=e.isModifiedImage,this.annotationInstance.implementations.app.api.emitDataToExpressImageData(),this.emitUndoRedoHistory()),this.annotationInstance.renderer.needFocus=!1}redo(){let e=this.sceneManager.redo();void 0!==e&&(this.annotationInstance.activeCommandController.setScaleGlobal(e.globalScale),this.annotationInstance.activeCommandController.reUndoProcessing(e.geometry),e.isModifiedImage!==this.useModifiedImage&&(e.isModifiedImage?this.annotationInstance.implementations.app.model.imageWrapper.toCroppedImg():this.annotationInstance.implementations.app.model.imageWrapper.toOriginalImg()),this.useModifiedImage=e.isModifiedImage,this.emitUndoRedoHistory()),this.annotationInstance.renderer.needFocus=!1}captureScene(){let e=[];for(let t=0;t<this.geometryList.length;++t){let s=this.geometryList[t].toJSON();s&&e.push(s)}this.useModifiedImage=this.annotationInstance.implementations.app.model.imageWrapper.useModifiedImage;let t=this.annotationInstance.activeCommandController;this.sceneManager.pushAdapter(e,this.useModifiedImage,t.activeColorController.getActiveColor(),t.scaleGlobal),this.emitUndoRedoHistory()}emitUndoRedoHistory(){let e=this.sceneManager.getCurrentState();this.annotationInstance.io.emitAction("history@".concat(JSON.stringify(e)))}addGeometry(e){this.geometryList.push(e)}removeGeometry(e){this.geometryList.splice(this.geometryList.indexOf(e),1)}addBasePoint(e){this.listBasePoint.push(e)}removeBasePoint(e){this.listBasePoint.splice(this.listBasePoint.indexOf(e),1)}addAPoint(e){this.listAPoint.push(e)}removeAPoint(e){this.listAPoint.splice(this.listAPoint.indexOf(e),1)}addRPoint(e){this.listRPoint.push(e)}removeRPoint(e){this.listRPoint.splice(this.listRPoint.indexOf(e),1)}addNPoint(e){this.listNPoint.push(e)}removeNPoint(e){this.listNPoint.splice(this.listNPoint.indexOf(e),1)}addIPoint(e){this.listIPoint.push(e)}removeIPoint(e){this.listIPoint.splice(this.listIPoint.indexOf(e),1)}addARectangleWrapper(e){this.listARectangleWrapper.push(e)}removeARectangleWrapper(e){this.listARectangleWrapper.splice(this.listARectangleWrapper.indexOf(e),1)}addACircleWrapper(e){this.listACircleWrapperr.push(e)}removeACircle(e){this.listACircleWrapperr.splice(this.listACircleWrapperr.indexOf(e),1)}addAArrow(e){this.listAArrow.push(e)}removeAArrow(e){this.listAArrow.splice(this.listAArrow.indexOf(e),1)}addACurve(e){this.listACurve.push(e)}removeACurve(e){this.listACurve.splice(this.listACurve.indexOf(e),1)}addAFreehand(e){this.listAFreehand.push(e)}removeAFreehand(e){this.listAFreehand.splice(this.listAFreehand.indexOf(e),1)}addAFreehandSmartDrawing(e){this.listAFreehandSmartDrawing.push(e)}removeAFreehandSmartDrawing(e){this.listAFreehandSmartDrawing.splice(this.listAFreehandSmartDrawing.indexOf(e),1)}addAPolylineGraphWrapper(e){this.listAPolylineGraphWrapper.push(e)}removeAPolylineGraphWrapper(e){this.listAPolylineGraphWrapper.splice(this.listAPolylineGraphWrapper.indexOf(e),1)}addAPolylineWrapper(e){this.listAPolylineWrapper.push(e)}removeAPolylineWrapper(e){this.listAPolylineWrapper.splice(this.listAPolylineWrapper.indexOf(e),1)}addAPolygonWrapper(e){this.listAPolygonWrapper.push(e)}removeAPolygonWrapper(e){this.listAPolygonWrapper.splice(this.listAPolygonWrapper.indexOf(e),1)}addAPolygonGraphWrapper(e){this.listAPolygonGraphWrapper.push(e)}removeAPolygonGraphWrapper(e){this.listAPolygonGraphWrapper.splice(this.listAPolygonGraphWrapper.indexOf(e),1)}addANGonWrapper(e){this.listANGonWrapper.push(e)}removeANGonWrapper(e){this.listANGonWrapper.splice(this.listANGonWrapper.indexOf(e),1)}addATextleaderlineWrapper(e){this.listATextleaderlineWrapper.push(e)}removeATextleaderlineWrapper(e){this.listATextleaderlineWrapper.splice(this.listATextleaderlineWrapper.indexOf(e),1)}addALog(e){this.listALog.push(e)}removeALog(e){this.listALog.splice(this.listALog.indexOf(e),1)}getUUID(){return(0,p.Fs)()}getHashColor(e){for(;;){let t=(0,p.kt)();if(!this.listHashColor[t])return this.listHashColor[t]=e,t}}get Capture(){return this.capture}set Capture(e){this.annotationInstance.implementations.app.INSPECTION&&(void 0===e?this.annotationInstance.activeCommandController.screenLog.push("undefined"):this.annotationInstance.activeCommandController.screenLog.push(e.type)),void 0!==this.capture&&(this.capture.isCapturedValue=!1),this.preCapture=this.capture,this.preCapture&&(this.preCapture.isCapturedValue=!1),this.capture=e,this.capture&&(this.annotationInstance.geometryCommon.gcmdProcessing.checkAttachedTextleaderline(this.capture),this.capture.isCapturedValue=!0,this.capture.updateVecsHistory())}reset(){}destroy(){this.annotationInstance.geometryCommon.gcmdProcessing.removeAll()}constructor(e){this.geometryList=[],this.listBasePoint=[],this.listAPoint=[],this.listRPoint=[],this.listNPoint=[],this.listIPoint=[],this.listARectangleWrapper=[],this.listACircleWrapperr=[],this.listAPolylineWrapper=[],this.listAPolygonWrapper=[],this.listANGonWrapper=[],this.listAPolygonGraphWrapper=[],this.listAPolylineGraphWrapper=[],this.listAPolylineGraphShadow=void 0,this.listAArrow=[],this.listACurve=[],this.listAFreehand=[],this.listAFreehandSmartDrawing=[],this.listATextleaderlineWrapper=[],this.listALog=[],this.listHashColor={},this.copyPasteGeo=[],this.preCapture=void 0,this.capture=void 0,this.capturePT=void 0,this.captureMultiple=void 0,this.captureHovered=void 0,this.captureForEasing=void 0,this.captureText=void 0,this.useModifiedImage=!0,this.annotationInstance=e,this.sceneManager=new im,this.paramsEditing=new iu(this)}}class iv{initPost(){this.graphicsCoreWrapper.initPost(),this.graphicsCoreWrapper.canvasWrapper.aCanvas.imageSmoothingEnabled=!0,this.renderer.initPost()}resize(e,t){this.graphicsCoreWrapper.resizeCanvas(e,t)}destroy(){this.renderer.destroy(),this.graphicsCoreWrapper.destroy()}mouseEventController(e){this.activeCommandController.activeCommand.mouseEventController(e)}pushAction(e){this.io.stateProcessingAnnotation.pushAction(e)}constructor(e,t,s,i){this.implementations=e,this.interactionMode=this.implementations.app.model.appCoreWrapper.appControllerStatus.mode,this.apiWrapper=new sa(this),this.graphicsCoreWrapper=new sP(this,s),this.scene=new ig(this),this.renderer=new ip(this,t),this.io=new sR(this),this.geometryCommon=new sn(this),this.activeCommandController=new t7(this),this.customization=new sd(this,i),this.renderer.ctx=this.graphicsCoreWrapper.canvasWrapper.aCanvas.ctx,this.renderer.ctxOffscreen=this.graphicsCoreWrapper.canvasWrapper.aCanvasOffScreen.offScreenCtx,this.interactionMode}}class iy{initAnnotationCanvasInstance(e,t,s){this.imageAnnoApp=new iv(this,e,t,s)}initAnnotationSVGInstance(e,t,s){}set isViewChanging(e){this.imageAnnoApp&&(this.imageAnnoApp.activeCommandController.acProperties.isViewChanging=e)}set isTouchEvent(e){this.imageAnnoApp&&(this.imageAnnoApp.activeCommandController.IsTouchEvent=e)}set isCustomAPI(e){!e&&this.imageAnnoApp&&this.imageAnnoApp.graphicsCoreWrapper.canvasWrapper.aCanvasMask&&(this.imageAnnoApp.graphicsCoreWrapper.canvasWrapper.aCanvasMask.width=0)}updateExtentSVG(){}pushTheme(e){this.imageAnnoApp&&this.imageAnnoApp.geometryCommon.gcmdSupporting.pushThemeJSON(e)}initPost(){this.imageAnnoApp&&this.imageAnnoApp.initPost()}resize(e,t){this.imageAnnoApp&&this.imageAnnoApp.resize(e,t)}Pause(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.imageAnnoApp&&this.imageAnnoApp.graphicsCoreWrapper.pause(e)}resume(){this.imageAnnoApp&&this.imageAnnoApp.graphicsCoreWrapper.resume()}mouseEventController(e){this.updateEventLog(e),this.imageAnnoApp&&this.imageAnnoApp.mouseEventController(e),this.sketch&&this.sketch.mouseEventController(e)}keyboardEventController(e){this.updateEventLog(e),this.imageAnnoApp&&this.imageAnnoApp.activeCommandController.activeCommand.keyboardEventController(e)}keyboardEventControllerFromDocument(e){this.updateEventLog(e),this.imageAnnoApp&&this.imageAnnoApp.activeCommandController.activeCommand.keyboardEventControllerFromDocument(e)}touchEventController(e){this.updateEventLog(e),this.imageAnnoApp&&this.imageAnnoApp.activeCommandController.activeCommand.touchEventController(e)}render(e){this.imageAnnoApp&&this.imageAnnoApp.renderer.render(e)}destroy(){this.imageAnnoApp&&this.imageAnnoApp.destroy(),this.sketch&&this.sketch.destroy()}pushAction(e){this.imageAnnoApp&&this.imageAnnoApp.pushAction(e),this.sketch&&this.sketch.pushAction(e)}updateEventLog(e){this.imageAnnoApp&&this.imageAnnoApp.activeCommandController.acProperties.isHiddenLog}constructor(e,t){this.divHost=t,this.app=e}}}}]);