"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[86487],{89136:function(e,t,r){r.d(t,{Y:function(){return i},h:function(){return n}});var a=r(72659),l=r(81449);function n(e,t){return{...u(e,t),readResourcePaths:[]}}function i(e,t,r){let l=(0,a.mN)(e.itemUrl);return{...u(e,t),messages:[],writtenProperties:[],blockedRelativeUrls:[],verifyItemRelativeUrls:l?{rootPath:l.path,writtenUrls:[]}:null,resources:r?{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}:null}}function u(e,t){return{origin:t,url:(0,a.mN)(e.itemUrl),portal:e.portal||l.Z.getDefault(),portalItem:e}}},86487:function(e,t,r){r.d(t,{load:function(){return m}});var a=r(94605),l=r(96922),n=r(3770),i=r(79155),u=r(22065),o=r(27761),s=r(81449),p=r(89136),y=r(41704),c=r(63332),d=r(64598),f=r(62709);async function m(e,t){let r=e.instance.portalItem;if(r?.id)return await r.load(t),function(e){let t=e.instance.portalItem;if(!t?.type||!e.supportedTypes.includes(t.type))throw new a.Z("portal:invalid-layer-item-type","Invalid layer item type '${type}', expected '${expectedType}'",{type:t?.type,expectedType:e.supportedTypes.join(", ")})}(e),e.validateItem&&e.validateItem(r),w(e,t)}async function w(e,t){let r=e.instance,a=r.portalItem;if(!a)return;let{url:l,title:n}=a,u=(0,p.h)(a,"portal-item");if("group"===r.type)return h(r,u,e);l&&"media"!==r.type&&r.read({url:l},u);let o=new i.L,s=await S(e,o,t);return s&&r.read(s,u),r.resourceReferences={portalItem:a,paths:u.readResourcePaths??[]},"subtype-group"!==r.type&&r.read({title:n},u),(0,d.y)(r,u)}async function h(e,t,r){let l=e.portalItem;if(!e.sourceIsPortalItem)return;let{title:n,type:i}=l;if("Group Layer"===i){if(!(0,c._$)(l,"Map"))throw new a.Z("portal:invalid-layer-item-typekeyword","'Group Layer' item without 'Map' type keyword is not supported");return I(e)}return e.read({title:n},t),b(e,r)}async function I(e){let t=e.portalItem,r=await t.fetchData("json");if(!r)return;let a=(0,p.h)(t,"web-map");e.read(r,a),await (0,u.k)(e,r,{context:a}),e.resourceReferences={portalItem:t,paths:a.readResourcePaths??[]}}async function b(e,t){let r;let{portalItem:l}=e;if(!l)return;let n=l.type,u=t.layerModuleTypeMap;switch(n){case"Feature Service":case"Feature Collection":r=u.FeatureLayer;break;case"Stream Service":r=u.StreamLayer;break;case"Scene Service":r=u.SceneLayer;break;default:throw new a.Z("portal:unsupported-item-type-as-group",`The item type '${n}' is not supported as a 'IGroupLayer'`)}let o=new i.L,[s,p]=await Promise.all([r(),S(t,o)]),c=()=>s;if("Feature Service"===n){let t=y.uE(p)?.customParameters;p=l.url?await (0,y.$O)(p,l.url,o):{},c=await k(p,u)||c;let r=await P(l.url,{customParameters:t,loadContext:o});return await T(e,c,p,r)}return"Scene Service"===n&&l.url&&(p=await (0,y.CD)(l,p,o)),(0,y.Q4)(p)>0?await T(e,c,p):await g(e,c)}async function g(e,t){let{portalItem:r}=e;if(!r?.url)return;let a=await (0,f.T)(r.url);a&&T(e,t,{layers:a.layers?.map(y.bS),tables:a.tables?.map(y.bS)})}async function T(e,t,r,a){let l=r.layers||[],n=r.tables||[];if("Feature Collection"===e.portalItem?.type?(l.forEach((e,t)=>{e.id=t,"Table"===e?.layerDefinition?.type&&n.push(e)}),l=l.filter(e=>"Table"!==e?.layerDefinition?.type)):(l.reverse(),n.reverse()),l.forEach(l=>{let n=a?.(l);if(n||!a){let a=v(e,t(l),r,l,n);e.add(a)}}),n.length){let t=await o.T.FeatureLayer();n.forEach(l=>{let n=a?.(l);if(n||!a){let a=v(e,t,r,l,n);e.tables.add(a)}})}}function v(e,t,r,a,l){let n=e.portalItem,i={portalItem:n.clone(),layerId:a.id};null!=a.url&&(i.url=a.url);let u=new t(i);if("sourceJSON"in u&&(u.sourceJSON=l),"subtype-group"!==u.type&&"catalog"!==u.type&&(u.sublayerTitleMode="service-name"),"Feature Collection"===n.type){let e={origin:"portal-item",portal:n.portal||s.Z.getDefault()};u.read(a,e);let t=r.showLegend;null!=t&&u.read({showLegend:t},e)}return u}async function S(e,t,r){if(!1===e.supportsData)return;let a=e.instance,l=a.portalItem;if(!l)return;let n=null;try{n=await l.fetchData("json",r)}catch(e){}if("stream"!==a.type&&"layerId"in a){let e=null,r=await L(l,n,t);if((n?.layers||n?.tables)&&r>0){if(null==a.layerId){let e=(0,y.ZC)(a.type),t=e?(0,y.r9)(n,e)[0]:(0,y.uE)(n);t&&(a.layerId=t.id)}e=function(e,t){let{layerId:r}=t,a=e.layers?.find(e=>e.id===r)||e.tables?.find(e=>e.id===r);return a&&function(e,t){let r="layerType"in e&&e.layerType,{type:a}=t;return!("feature"===a&&r&&"ArcGISFeatureLayer"!==e.layerType||"catalog"===a&&!r||"oriented-imagery"===a&&!r||"subtype-group"===a&&!r)}(a,t)?a:null}(n,a),"OrientedImageryLayer"===e?.layerType&&"oriented-imagery"===a.type&&a.supportedSourceTypes.add("Feature Layer"),e&&null!=n.showLegend&&(e.showLegend=n.showLegend)}return r>1&&"sublayerTitleMode"in a&&"service-name"!==a.sublayerTitleMode&&(a.sublayerTitleMode="item-title-and-service-name"),e}return n}async function L(e,t,r){if(t?.layers&&t?.tables)return(0,y.Q4)(t);let a=(0,l.Qc)(e.url);if(!a)return 1;let n=await r.fetchServiceMetadata(a.url.path,{customParameters:y.uE(t)?.customParameters}).catch(()=>null);return(t?.layers?.length??n?.layers?.length??0)+(t?.tables?.length??n?.tables?.length??0)}async function P(e,t){let{layersJSON:r}=await (0,n.V)(e,t);if(!r)return null;let a=[...r.layers,...r.tables];return e=>a.find(t=>t.id===e.id)}async function k(e,t){let{layers:r}=e;if(!r?.length)return;let a=new Set,l=[];for(let{layerType:e}of r){let r=e??"ArcGISFeatureLayer";if(a.has(r))continue;a.add(r);let n=t[(0,y.qT)(r)];l.push(n())}let n=await Promise.all(l),i=new Map;return Array.from(a).forEach((e,t)=>{i.set(e,n[t])}),({layerType:e})=>i.get(e??"ArcGISFeatureLayer")}}}]);