"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[85281],{85281:function(e,t,s){s.r(t),s.d(t,{AppDrawingBlock:function(){return B},Solution:function(){return A}});var i,o,n,h,r=s(8483);class l{Init(){let e=document.createElement("canvas");if(e){this.canvas=e,this.canvas.width=this.div.clientWidth,this.canvas.height=this.div.clientHeight,this.div.append(this.canvas);let t=this.canvas.getContext("2d");t&&(this.ctx=t,this.isActive=!0)}}LoopInit(){this.translation[0]=.5*this.ctx.canvas.width,this.translation[1]=.5*this.ctx.canvas.height,this.deltaTime=new r.gk,this.canvasLoopController=new r.NI(60),this.SetLevel4(),this.Loop()}Loop(){let e=performance.now();if(this.deltaTime.UpdateFPS(),this.canvasLoopController.level>3){if(6===this.canvasLoopController.level)requestAnimationFrame(()=>{this.Loop()}),this.RenderPre(this.ctx);else if(5===this.canvasLoopController.level)this.isViewChanging,requestAnimationFrame(()=>{this.Loop()}),this.RenderPre(this.ctx);else if(4===this.canvasLoopController.level){if(this.isViewChanging,requestAnimationFrame(()=>{this.Loop()}),this.canvasLoopController.stop)return;this.RenderPre(this.ctx),this.canvasLoopController.TimerForStop()}}else 1===this.canvasLoopController.level&&this.isViewChanging||this.RenderPre(this.ctx);let t=performance.now();this.log="level:  ".concat(this.canvasLoopController.level,", total frames: ").concat(this.loopNum++," (FPS: ").concat(this.deltaTime.frameRate.toFixed(0),"), a loop took: ").concat((t-e).toFixed(2)," ms to execute.")}SetLevel1(){this.canvasLoopController.level=1,this.Loop()}SetLevel2(){this.canvasLoopController.level=2,this.Loop()}SetLevel3(){this.canvasLoopController.level=3,this.Loop()}RenderSetLevel4(){this.canvasLoopController.stop=!0}SetLevel4(){this.canvasLoopController.Reset(),setTimeout(()=>{this.canvasLoopController.level=4,this.Loop()},500)}SetLevel5(){this.canvasLoopController.Reset(),setTimeout(()=>{this.canvasLoopController.level=5,this.Loop()},500)}SetLevel6(){this.canvasLoopController.Reset(),setTimeout(()=>{this.canvasLoopController.level=6,this.Loop()},500)}Clear(e){this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height)}Zoom(e){e.wheel<0?this.zoom+=.09*this.zoom:(console.log("out",this.zoom),this.zoom-=.09*this.zoom)}RemapByZoom(e){return e.x=(e.xs-this.translation[0])/this.zoom,e.y=(e.ys-this.translation[1])/this.zoom,e}Pan(e){if(!this.ablePan)return;let t=e.xs-e.preXs,s=e.ys-e.preYs;this.translation[0]+=t,this.translation[1]+=s}RenderForce(){this.canvasLoopController.stop=!1}RenderPre(e){this.isActive&&(this.Clear(this.ctx),this.ctx.save(),this.ctx.translate(this.translation[0],this.translation[1]),this.ctx.scale(this.zoom,this.zoom),this.Render(e),this.ctx.restore())}Render(e){}constructor(e,t){this.isActive=!1,this.zoom=1,this.translation=[0,0],this.translationZoom=[0,0],this.isViewChanging=!1,this.loopNum=0,this.needRenderloop=!0,this.ablePan=!0,this.pause=!1,this.core=e,this.div=t,this.Init(),this.LoopInit()}}(i=n||(n={})).LEFT="LEFT",i.MIDDLE="MIDDLE",i.RIGHT="RIGHT",i.WHEEL="WHEEL",i.DRAG="DRAG",i.DRAG_LEFT="DRAG_LEFT",i.DRAG_MIDDLE="DRAG_MIDDLE",i.DRAG_RIGHT="DRAG_RIGHT",i.MOVE="MOVE",i.DOUBLE="DOUBLE",i.UP="UP",i.DOWN="DOWN",i.DOWN_MIDDLE="DOWN_MIDDLE",i.DOWN_RIGHT="DOWN_RIGHT";class a{DeepCopy(){let e=new a;return e.x=this.x,e.y=this.y,e.z=this.z,e.preX=this.preX,e.preY=this.preY,e.preZ=this.preZ,e.xs=this.x,e.ys=this.y,e.preXs=this.preXs,e.preYs=this.preYs,e.pressedAlt=this.pressedAlt,e.pressedShift=this.pressedShift,e.pressedCtrl=this.pressedCtrl,e.isDoubleClick=this.isDoubleClick,e.isDown=this.isDown,e.isMove=this.isMove,e.wheel=this.wheel,e.preWheel=this.preWheel,e.yGLPicking=this.yGLPicking,e.CLICK_TYPE=this.CLICK_TYPE,e.command=this.command,e.native=this.native,e}constructor(){this.x=-1,this.y=-1,this.z=-1,this.preX=-1,this.preY=-1,this.preZ=-1,this.xs=-1,this.ys=-1,this.preXs=-1,this.preYs=-1,this.CLICK_TYPE="MOVE",this.isDown=!1,this.isDoubleClick=!1,this.isMove=!1,this.pressedShift=!1,this.pressedAlt=!1,this.pressedCtrl=!1,this.wheel=0,this.preWheel=0,this.isActive=!0}}class c{InitNativeMouseEvent(e){e.onclick=e=>{this.prevent=!1,this.timer=setTimeout(()=>{this.prevent||this.MouseClick(e),this.prevent=!1},this.delay)},e.ondblclick=e=>{clearTimeout(this.timer),this.prevent=!0,this.MouseDoubleClick(e)},e.onmousedown=e=>{this.MouseDown(e)},e.onmouseup=e=>{this.MouseUp(e)},e.onmousemove=e=>{this.MouseMove(e)},e.addEventListener("wheel",e=>this.MouseWheel(e,e.deltaY))}MouseDown(e){this.click=!0,this.down=!0;let t=this.CommonEventBuilder(e);t.CLICK_TYPE=n.DOWN,t.isDown=!0,this.MouseEvenEmitting(t)}MouseClick(e){if(!this.click)return;let t=this.CommonEventBuilder(e);0===e.button?t.CLICK_TYPE=n.LEFT:1===e.button?t.CLICK_TYPE=n.MIDDLE:2===e.button&&(t.CLICK_TYPE=n.RIGHT),this.MouseEvenEmitting(t)}MouseDoubleClick(e){let t=this.CommonEventBuilder(e);t.CLICK_TYPE=n.DOUBLE,this.MouseEvenEmitting(t)}MouseDrag(e){this.click=!1,this.prevent=!0;let t=this.CommonEventBuilder(e);t.CLICK_TYPE=n.DRAG,t.isDown=!0,1===e.buttons?t.CLICK_TYPE=n.DRAG:4===e.buttons?t.CLICK_TYPE=n.DRAG_MIDDLE:2===e.buttons&&(t.CLICK_TYPE=n.DRAG_RIGHT),this.MouseEvenEmitting(t)}MouseMove(e){if(this.down){this.MouseDrag(e);return}let t=this.CommonEventBuilder(e);t.CLICK_TYPE=n.MOVE,t.isDown=!0,this.prevent=!0,this.MouseEvenEmitting(t)}MouseUp(e){this.down=!1,this.click=!0;let t=this.CommonEventBuilder(e);t.CLICK_TYPE=n.UP,t.isDown=!1,this.MouseEvenEmitting(t)}MouseWheel(e,t){let s=this.CommonEventBuilder(e);s.wheel=t,s.CLICK_TYPE=n.WHEEL,this.MouseEvenEmitting(s)}CommonEventBuilder(e){let t=new a;return t.preXs=this.mouseEventDataPre.xs,t.preYs=this.mouseEventDataPre.ys,t.preX=this.mouseEventDataPre.x,t.preY=this.mouseEventDataPre.y,t.pressedShift=e.shiftKey,t.pressedAlt=e.altKey,t.pressedCtrl=e.ctrlKey,t.xs=e.offsetX,t.ys=e.offsetY,t.preWheel=this.mouseEventDataPre.wheel,t.wheel=0,t.native=e,t=this.ioWrapper.core.canvas.RemapByZoom(t),this.mouseEventDataPre=t,this.e=t,t}get stopPropagation(){return this._stopPropagation}set stopPropagation(e){e?this._stopPropagation=e:setTimeout(()=>{this._stopPropagation=e},500)}MouseEvenEmitting(e){this.MouseEventEmittingForViewController(e),this._stopPropagation||this.MouseEventEmittingForModel(e)}MouseEventEmittingForViewController(e){this.mouseInteractionUI&&this.mouseInteractionUI.MouseInteractionMenu(e)}MouseEventEmittingForModel(e){this.ioWrapper.core.activeCommandController.MouseEventController(e)}constructor(e){this.mouseEventDataPre=new a,this.isEnable=!0,this.clickCount=0,this.click=!1,this.prevent=!1,this.delay=250,this.down=!1,this._stopPropagation=!1,this.ioWrapper=e}}class u{InitEventListener(e){this.mouseInteraction.InitNativeMouseEvent(e),this.Resize()}Resize(){window.addEventListener("resize",e=>this.ReSizeWindow(e))}ReSizeWindow(e){}constructor(e){this.core=e,this.mouseInteraction=new c(this)}}class d{MouseEventController(e){let t=e.DeepCopy();if(t.x=e.xs,t.y=e.ys,this.core.nUI.MouseInteractionMenu(t),!this.core.nUI.stopPropagation){if(this.core.canvas.RenderForce(),this.core.nBlock.implementations.MouseEventController(e),e.CLICK_TYPE===r.uh.LEFT){this.MouseLeftClickPre(e);return}if(e.CLICK_TYPE===r.uh.MIDDLE){this.MouseMiddleClickPre(e);return}if(e.CLICK_TYPE===r.uh.DOWN_RIGHT){this.MouseRightClickPre(e);return}if(e.CLICK_TYPE===r.uh.DOUBLE){this.MouseDoubleClickPre(e);return}if(e.CLICK_TYPE===r.uh.MOVE){this.MouseMovePre(e);return}else if(e.CLICK_TYPE===r.uh.DRAG){this.MouseDragPre(e);return}else if(e.CLICK_TYPE===r.uh.DOWN){this.MouseDownPre(e);return}else if(e.CLICK_TYPE===r.uh.WHEEL){this.MouseWheelPre(e);return}else if(e.CLICK_TYPE===r.uh.UP){this.MouseUpPre(e);return}}}MouseDown(e){}MouseDownPre(e){this.MouseDown(e)}MouseLeftClick(e){}MouseLeftClickPre(e){this.MouseLeftClick(e)}MouseMiddleClick(e){}MouseMiddleClickPre(e){this.MouseMiddleClick(e)}MouseRightClick(e){}MouseRightClickPre(e){this.MouseRightClick(e)}MouseUp(e){}MouseUpPre(e){this.MouseUp(e)}MouseDoubleClick(e){}MouseDoubleClickPre(e){this.MouseDoubleClick(e)}MouseMove(e){}MouseMovePre(e){this.MouseMove(e)}MouseDrag(e){}MouseDragPre(e){this.mouse.x=e.x,this.mouse.y=e.y,this.core.canvas.Pan(e),this.MouseDrag(e)}MouseWheel(e){}MouseWheelPre(e){this.core.canvas.Zoom(e),this.MouseWheel(e)}pushActionFromPulldown(e){e.split("@")[0]}constructor(e){this.mouse=new r.h9(0,0),this.core=e}}class C{InitCanvas(e){this.canvas=new l(this,e)}InitPulldown(){this.nUI=new r.Fc(this.nBlock.div),this.BindingActiveCommandController()}InitPost(){this.ioWrapper.InitEventListener(this.nBlock.div)}BindingActiveCommandController(){this.nUI.BindingActiveCommandController("NDrawingBlock",e=>this.Commander(e))}Resize(e,t){this.nUI.Resize(e,t)}Commander(e){this.activeCommandController.pushActionFromPulldown(e)}constructor(e,t){this.nBlock=e,this.InitPulldown(),this.InitCanvas(t),this.activeCommandController=new d(this),this.ioWrapper=new u(this)}}class m{OnRender(e){this.Update(e),this.Render(e)}Update(e){}Render(e){r.gi.GridLineOrigin(e,10,10,50,50);for(let t=0;t<this.implementation.scene.listBlocks.length;++t)this.implementation.scene.listBlocks[t].Render(e);this.implementation.scene.drawingGraph.Render(e),e.fillStyle="#00ff00",e.beginPath(),e.arc(this.activeCommandController.mouse.x,this.activeCommandController.mouse.y,2,0,2*Math.PI),e.closePath(),e.fill()}constructor(e){this.implementation=e,this.activeCommandController=this.implementation.activeCommandController}}class p{Pick(e){for(let t=0;t<this.implementation.scene.listBlocks.length;++t)if(this.implementation.scene.listBlocks[t].IsInside(e))return this.implementation.scene.listBlocks[t]}constructor(e){this.implementation=e}}class v{RenderPre(e){this.Render(e)}Translation(e){}constructor(e){this.scene=e}}class M extends v{Render(e){e.fillStyle=this.col,e.beginPath(),e.fillRect(this.v.x,this.v.y,this.width,this.height),e.closePath(),e.fill()}Translation(e){this.v.x+=e.x-e.preX,this.v.y+=e.y-e.preY}IsInside(e){return!!r.h9.IsInsideOfVecWithHeight(e,this.v,this.width,this.height)}constructor(e,t,s){super(e),this.width=50,this.height=25,this.col="#ff0000",this.v=new r.h9(t-.5*this.width,s-.5*this.height,0),this.scene.Add(this)}}class E{MouseEventController(e){if(this.ac.mouse.x=e.x,this.ac.mouse.y=e.y,e.CLICK_TYPE===n.LEFT){this.MouseLeftClickPre(e);return}if(e.CLICK_TYPE===n.MIDDLE){this.MouseMiddleClickPre(e);return}if(e.CLICK_TYPE===n.DOWN_RIGHT){this.MouseRightClickPre(e);return}if(e.CLICK_TYPE===n.DOUBLE){this.MouseDoubleClickPre(e);return}if(e.CLICK_TYPE===n.MOVE){this.MouseMovePre(e);return}if(e.CLICK_TYPE===n.DRAG){this.MouseDragPre(e);return}if(e.CLICK_TYPE===n.DOWN){this.MouseDownPre(e);return}else if(e.CLICK_TYPE===n.WHEEL){this.MouseWheelPre(e);return}else if(e.CLICK_TYPE===n.UP){this.MouseUpPre(e);return}}MouseDown(e){}MouseDownPre(e){let t=this.ac.implementation.geometryCommon.Pick(this.ac.mouse);t&&(this.ac.ablePan=!1,this.ac.capture=t),this.MouseDown(e)}MouseLeftClick(e){}MouseLeftClickPre(e){this.MouseLeftClick(e)}MouseMiddleClick(e){}MouseMiddleClickPre(e){this.MouseMiddleClick(e)}MouseRightClick(e){}MouseRightClickPre(e){this.MouseRightClick(e)}MouseUp(e){}MouseUpPre(e){this.ac.ablePan=!0,this.ac.capture=void 0,this.MouseUp(e)}MouseDoubleClick(e){}MouseDoubleClickPre(e){this.MouseDoubleClick(e)}MouseMove(e){}MouseMovePre(e){this.MouseMove(e)}MouseDrag(e){}MouseDragPre(e){this.ac.capture&&this.ac.capture.Translation(e),this.MouseDrag(e)}MouseWheel(e){}MouseWheelPre(e){this.MouseWheel(e)}constructor(e){this.ac=e}}class P extends E{constructor(e){super(e)}}class L extends E{MouseLeftClick(e){new M(this.ac.implementation.scene,e.x,e.y)}constructor(e){super(e)}}class g extends E{MouseEventController(e){this.ac.implementation.scene.drawingGraph.ac.MouseEventController(e)}constructor(e){super(e)}}(o=h||(h={})).SELECT="SELECT",o.REMOVE="REMOVE",o.RECT="RECT",o.DRAWING_BLOCK="DRAWING_BLOCK";class I{SetActiveCommand(e){this.activeCommand=this.commands[e]}get ablePan(){return this._ablePan}set ablePan(e){this.implementation.implementations.nBlock.core.canvas.ablePan=e,this._ablePan=e}constructor(e){this.commands={},this.mouse=new r.h9(0,0),this.capture=void 0,this._ablePan=!1,this.implementation=e,this.commands={SELECT:new P(this),RECT:new L(this),DRAWING_BLOCK:new g(this)},this.SetActiveCommand("DRAWING_BLOCK")}}class D{Init(){let e=document.createElement("button");e.type="button",e.innerText="select",e.onclick=()=>{this.implementation.activeCommandController.SetActiveCommand(h.SELECT)},this.div.append(e),(e=document.createElement("button")).type="button",e.innerText="point",e.onclick=()=>{this.implementation.activeCommandController.SetActiveCommand(h.RECT)},this.div.append(e)}constructor(e){this.implementation=e,this.divHost=e.implementations.nBlock.hostDiv;let t=document.createElement("div");t&&(this.div=t,this.divHost.insertBefore(this.div,e.implementations.nBlock.div),e.implementations.nBlock.div.style.height="90%",this.Init())}}class w{Render(e){this.renderer.Render(e)}Translation(){}constructor(e,t,s){this.renderer=new k(this),this.n0=e,this.n1=t}}class k{Render(e){let t=.5*Math.abs(this.edge.n1.v.x-this.edge.n0.v.x),s=.5*Math.abs(this.edge.n1.v.y-this.edge.n0.v.y),i=t>s?t:s;e.lineWidth=2,e.beginPath(),e.moveTo(this.edge.n0.v.x,this.edge.n0.v.y),e.bezierCurveTo(this.edge.n0.v.x+i,this.edge.n0.v.y,this.edge.n1.v.x-i,this.edge.n1.v.y,this.edge.n1.v.x,this.edge.n1.v.y),e.stroke()}constructor(e){this.edge=e}}class f{Render(e){this.renderer.Render(e)}Translation(e){this.v.x+=e.x-e.preX,this.v.y+=e.y-e.preY}IsInside(e){return!!r.h9.IsInsideOfVecWithHeight(e,this.v,this.width,this.height)}constructor(e,t,s){this.type="",this.edgeIn=[],this.edgeOut=[],this.width=50,this.height=25,this.type=s,this.renderer=new R(this),this.v=new r.h9(e-.5*this.width,t-.5*this.height,0)}}class R{Render(e){e.fillStyle=this.fillStyle,e.beginPath(),e.fillRect(this.node.v.x,this.node.v.y,this.node.width,this.node.height),e.closePath(),e.fill()}constructor(e){this.fillStyle="#ff0000",this.node=e}}class T{AddNode(e,t,s){this.nodes.push(new f(e,t,s)),this.nodes.length>1&&this.AddEdge(this.nodes[this.nodes.length-2],this.nodes[this.nodes.length-1],"d")}AddEdge(e,t,s){this.edges.push(new w(e,t,s))}Render(e){let t=0;for(t=this.nodes.length;t--;)this.nodes[t].Render(e);for(t=this.edges.length;t--;)this.edges[t].Render(e)}Pick(e){return this.utility.Pick(e)}constructor(e){this.nodes=[],this.edges=[],this.drawingGraph=e,this.utility=new _(this)}}class _{Pick(e){for(let t=0;t<this.graph.nodes.length;++t)if(this.graph.nodes[t].IsInside(e))return this.graph.nodes[t]}constructor(e){this.graph=e}}class y{MouseEventController(e){if(this.mouse.x=e.x,this.mouse.y=e.y,e.CLICK_TYPE===n.LEFT){this.MouseLeftClickPre(e);return}if(e.CLICK_TYPE===n.MIDDLE){this.MouseMiddleClickPre(e);return}if(e.CLICK_TYPE===n.DOWN_RIGHT){this.MouseRightClickPre(e);return}if(e.CLICK_TYPE===n.DOUBLE){this.MouseDoubleClickPre(e);return}if(e.CLICK_TYPE===n.MOVE){this.MouseMovePre(e);return}if(e.CLICK_TYPE===n.DRAG){this.MouseDragPre(e);return}if(e.CLICK_TYPE===n.DOWN){this.MouseDownPre(e);return}else if(e.CLICK_TYPE===n.WHEEL){this.MouseWheelPre(e);return}else if(e.CLICK_TYPE===n.UP){this.MouseUpPre(e);return}}MouseDown(e){}MouseDownPre(e){let t=this.dbGraph.graph.Pick(this.mouse);t&&(this.dbGraph.scene.blockImplementation.activeCommandController.ablePan=!1,this.capture=t),this.MouseDown(e)}MouseLeftClick(e){}MouseLeftClickPre(e){this.dbGraph.graph.AddNode(e.x,e.y,"type"),this.MouseLeftClick(e)}MouseMiddleClick(e){}MouseMiddleClickPre(e){this.MouseMiddleClick(e)}MouseRightClick(e){}MouseRightClickPre(e){this.MouseRightClick(e)}MouseUp(e){}MouseUpPre(e){this.dbGraph.scene.blockImplementation.activeCommandController.ablePan=!0,this.capture=void 0,this.MouseUp(e)}MouseDoubleClick(e){}MouseDoubleClickPre(e){this.MouseDoubleClick(e)}MouseMove(e){}MouseMovePre(e){this.MouseMove(e)}MouseDrag(e){}MouseDragPre(e){this.capture&&this.capture.Translation(e),this.MouseDrag(e)}MouseWheel(e){}MouseWheelPre(e){this.MouseWheel(e)}constructor(e){this.mouse=new r.h9(0,0,0),this.capture=void 0,this.dbGraph=e}}class x{Render(e){this.graph.Render(e)}constructor(e){this.scene=e,this.ac=new y(this),this.graph=new T(this)}}class b{InitDrawingGraph(){this.drawingGraph=new x(this)}Add(e){this.listBlocks.push(e)}constructor(e){this.listBlocks=[],this.blockImplementation=e,this.InitDrawingGraph()}}class Y{Init(){this.activeCommandController=new I(this),this.geometryCommon=new p(this),this.scene=new b(this),this.renderer=new m(this),this.view=new D(this)}MouseEventController(e){this.activeCommandController.activeCommand.MouseEventController(e)}Render(e){this.renderer.OnRender(e)}constructor(e){this.implementations=e,this.Init()}}class W{MouseEventController(e){this.implementation.MouseEventController(e)}Render(e){this.implementation.Render(e)}constructor(e){this.nBlock=e,this.implementation=new Y(this)}}class K{static Init(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"SandBox";new K(e)}Init(){let e=document.getElementById(this.id);if(!e)return;this.hostDiv=e;let t=document.createElement("div");t&&(this.div=t,this.div.style.width="100%",this.div.style.height="100%",this.div.style.background="#dddddd",this.hostDiv.append(this.div)),this.core=new C(this,t),this.implementations=new W(this)}InitPost(){this.core.InitPost(),this.core.canvas.Render=e=>this.implementations.Render(e)}constructor(e="SandBox"){this.id=e,this.Init(),this.InitPost(),window.app=this}}class B{static Init(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"SandBox";new B(e,1)}Init(){switch(this.version){case 1:case 2:this.appV1=new K(this.id)}}constructor(e="SandBox",t=1){this.version=1,this.id=e,this.version=t,this.Init()}}class A{destroy(){if(this.divHost)try{for(;this.divHost.firstChild;)this.divHost.removeChild(this.divHost.firstChild)}catch(e){console.error("Error in destroy method:",e)}else console.warn("divHost is undefined in destroy method")}constructor(e,t=0){this.divHost=document.getElementById(e);let s=document.createElement("div");s.id="ngl3d",s.style.width="100%",s.style.height="100%",this.divHost.appendChild(s),B.Init(s.id)}}}}]);