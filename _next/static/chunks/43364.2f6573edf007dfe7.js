"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[43364],{49443:function(e,t,i){var s,r;i.d(t,{Y:function(){return s}}),(r=s||(s={}))[r.KILOBYTES=1024]="KILOBYTES",r[r.MEGABYTES=1048576]="MEGABYTES",r[r.GIGABYTES=1073741824]="GIGABYTES"},57812:function(e,t,i){i.d(t,{z:function(){return r}});var s=i(85515);class r{constructor(e,t){this._storage=new s.WJ,this.id="",this.name="",this.size=0,this._storage.maxSize=e,this._storage.register(this),t&&this._storage.registerRemoveFunc("",t)}destroy(){this._storage.deregister(this),this._storage.destroy()}put(e,t,i=1){this._storage.put(this,e,t,i,1)}pop(e){return this._storage.pop(this,e)}get(e){return this._storage.get(this,e)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}resetHitRate(){}}},85515:function(e,t,i){i.d(t,{WJ:function(){return n},Xq:function(){return a}});var s,r,l=i(35313);(s=r||(r={}))[s.ALL=0]="ALL",s[s.SOME=1]="SOME";class a{constructor(e,t,i){this.name=e,this._storage=t,this.id=o+++":",this.size=0,this.maxSize=-1,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),i&&(this._storage.registerRemoveFunc(this.id,i),this._removeFunc=!0)}destroy(){this._storage.clear(this),this._removeFunc&&this._storage.deregisterRemoveFunc(this.id),this._storage.deregister(this),this._storage=null}get hitRate(){return this._hit/(this._hit+this._miss)}get storageSize(){return this._storage.size}getSize(e){return this._storage.getSize(this,e)}resetHitRate(){this._hit=this._miss=0}put(e,t,i,s=0){this._storage.put(this,e,t,i,s)}pop(e){let t=this._storage.pop(this,e);return void 0===t?++this._miss:++this._hit,t}get(e){let t=this._storage.get(this,e);return void 0===t?++this._miss:++this._hit,t}peek(e){return this._storage.peek(this,e)}updateSize(e,t,i){this._storage.updateSize(this,e,t,i)}clear(){this._storage.clear(this)}clearAll(){this._storage.clearAll()}get performanceInfo(){return this._storage.performanceInfo}resetStats(){this._storage.resetStats()}}class n{get size(){return this._size}constructor(e=10485760){this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new l.Z,this._users=new l.Z}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(e){this._users.push(e)}deregister(e){this._users.removeUnordered(e)}registerRemoveFunc(e,t){this._removeFuncs.push([e,t])}deregisterRemoveFunc(e){this._removeFuncs.filterInPlace(t=>t[0]!==e)}get maxSize(){return this._maxSize}set maxSize(e){this._maxSize=Math.max(e,-1),this._checkSize()}getSize(e,t){let i=this._db.get(e.id+t);return i?.size??0}put(e,t,i,s,l){t=e.id+t;let a=this._db.get(t);return(a&&(this._size-=a.size,e.size-=a.size,this._db.delete(t),a.entry!==i&&this._notifyRemove(t,a.entry,a.size,r.ALL)),s>this._maxSize)?void this._notifyRemove(t,i,s,r.ALL):void 0===i?void console.warn("Refusing to cache undefined entry "):!s||s<0?(console.warn(`Refusing to cache entry with size ${s} for key ${t}`),void this._notifyRemove(t,i,0,r.ALL)):void(this._db.set(t,new h(i,s,1+Math.max(l,-4)- -3)),this._size+=s,e.size+=s,this._checkSize())}updateSize(e,t,i,s){t=e.id+t;let l=this._db.get(t);if(l&&l.entry===i){for(this._size-=l.size,e.size-=l.size;s>this._maxSize;){let e=this._notifyRemove(t,i,s,r.SOME);if(!(null!=e&&e>0))return void this._db.delete(t);s=e}l.size=s,this._size+=s,e.size+=s,this._checkSize()}}pop(e,t){t=e.id+t;let i=this._db.get(t);if(i)return this._size-=i.size,e.size-=i.size,this._db.delete(t),++this._hit,i.entry;++this._miss}get(e,t){t=e.id+t;let i=this._db.get(t);if(void 0!==i)return this._db.delete(t),i.lives=i.lifetime,this._db.set(t,i),++this._hit,i.entry;++this._miss}peek(e,t){let i=this._db.get(e.id+t);return i?++this._hit:++this._miss,i?.entry}get performanceInfo(){let e={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},t={},i=[];this._db.forEach((e,s)=>{let r=e.lifetime;i[r]=(i[r]||0)+e.size,this._users.forAll(i=>{let{id:r,name:l}=i;if(s.startsWith(r)){let i=t[l]||0;t[l]=i+e.size}})});let s={};this._users.forAll(e=>{let i=e.name;if("hitRate"in e&&"number"==typeof e.hitRate&&!isNaN(e.hitRate)&&e.hitRate>0){let r=t[i]||0;t[i]=r,s[i]=Math.round(100*e.hitRate)+"%"}else s[i]="0%"});let r=Object.keys(t);r.sort((e,i)=>t[i]-t[e]),r.forEach(i=>e[i]=Math.round(t[i]/1048576)+"MB / "+s[i]);for(let t=i.length-1;t>=0;--t){let s=i[t];s&&(e["Priority "+(t+-3-1)]=Math.round(s/this._size*100)+"%")}return e}resetStats(){this._hit=this._miss=0,this._users.forAll(e=>e.resetHitRate())}clear(e){let t=e.id;this._db.forEach((e,i)=>{i.startsWith(t)&&(this._size-=e.size,this._db.delete(i),this._notifyRemove(i,e.entry,e.size,r.ALL))}),e.size=0}clearAll(){this._db.forEach((e,t)=>this._notifyRemove(t,e.entry,e.size,r.ALL)),this._users.forAll(e=>e.size=0),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(e,t,i,s){let r;return this._removeFuncs.some(l=>{if(e.startsWith(l[0])){let e=l[1](t,s,i);return"number"==typeof e&&(r=e),!0}return!1}),r}_checkSize(){this._users.forAll(e=>this._checkSizeLimits(e)),this._checkSizeLimits()}_checkSizeLimits(e){let t=e??this;if(t.maxSize<0||t.size<=t.maxSize)return;let i=e?.id,s=!0;for(;s;)for(let[r,l]of(s=!1,this._db))if(0===l.lifetime&&(!i||r.startsWith(i))){if(this._purgeItem(r,l,e),t.size<=.9*t.maxSize)return;s||=this._db.has(r)}for(let[s,r]of this._db)if((!i||s.startsWith(i))&&(this._purgeItem(s,r,e),t.size<=.9*t.maxSize))return}_purgeItem(e,t,i=this._users.find(t=>e.startsWith(t.id))){if(this._db.delete(e),t.lives<=1){this._size-=t.size,i&&(i.size-=t.size);let s=this._notifyRemove(e,t.entry,t.size,r.SOME);null!=s&&s>0&&(this._size+=s,i&&(i.size+=s),t.lives=t.lifetime,t.size=s,this._db.set(e,t))}else--t.lives,this._db.set(e,t)}}let o=0;class h{constructor(e,t,i){this.entry=e,this.size=t,this.lifetime=i,this.lives=i}}},92145:function(e,t,i){i.d(t,{q:function(){return o}});var s=i(78628),r=i(1662),l=i(65223),a=i(31124),n=i(28707);class o{constructor(e,t,i,s,r={}){this._mainMethod=t,this._transferLists=i,this._listeners=[],this._promise=(0,n.bA)(e,{...r,schedule:s}).then(e=>{if(void 0===this._thread)for(let t of(this._thread=e,this._promise=null,r.hasInitialize&&this.broadcast({},"initialize"),this._listeners))this._connectListener(t);else e.close()}),this._promise.catch(t=>l.Z.getLogger("esri.core.workers.WorkerHandle").error(`Failed to initialize ${e} worker: ${t}`))}on(e,t){let i={removed:!1,eventName:e,callback:t,threadHandle:null};return this._listeners.push(i),this._connectListener(i),(0,r.kB)(()=>{i.removed=!0,(0,s.Od)(this._listeners,i),this._thread&&null!=i.threadHandle&&i.threadHandle.remove()})}destroy(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null,this._listeners.length=0,this._transferLists={}}invoke(e,t){return this.invokeMethod(this._mainMethod,e,t)}invokeMethod(e,t,i){if(this._thread){let s=this._transferLists[e],r=s?s(t):[];return this._thread.invoke(e,t,{transferList:r,signal:i})}return this._promise?this._promise.then(()=>((0,a.k_)(i),this.invokeMethod(e,t,i))):Promise.reject(null)}broadcast(e,t){return this._thread?Promise.all(this._thread.broadcast(t,e)).then(()=>{}):this._promise?this._promise.then(()=>this.broadcast(e,t)):Promise.reject()}get promise(){return this._promise}_connectListener(e){this._thread&&this._thread.on(e.eventName,e.callback).then(t=>{e.removed||(e.threadHandle=t)})}}},44746:function(e,t,i){i.r(t),i.d(t,{default:function(){return L}});var s=i(86641),r=i(54748),l=i(94605),a=i(36152),n=i(28541),o=i(31124),h=i(72659),u=i(89312);i(37180),i(65223),i(3457);var c=i(37647),d=i(64186),p=i(46341),f=i(37109),m=i(90254),_=i(53002),v=i(59727),y=i(15346),g=i(78298);class b{constructor(e,t,i,s){this._hasNoDataValues=null,this._minValue=null,this._maxValue=null,"pixelData"in e?(this.values=e.pixelData,this.width=e.width,this.height=e.height,this.noDataValue=e.noDataValue):(this.values=e,this.width=t,this.height=i,this.noDataValue=s)}get hasNoDataValues(){if(null==this._hasNoDataValues){let e=this.noDataValue;this._hasNoDataValues=this.values.includes(e)}return this._hasNoDataValues}get minValue(){return this._ensureBounds(),this._minValue}get maxValue(){return this._ensureBounds(),this._maxValue}_ensureBounds(){if(null!=this._minValue)return;let{noDataValue:e,values:t}=this,i=1/0,s=-1/0,r=!0;for(let l of t)l===e?this._hasNoDataValues=!0:(i=l<i?l:i,s=l>s?l:s,r=!1);r?(this._minValue=0,this._maxValue=0):(this._minValue=i,this._maxValue=s>-3e38?s:0)}}var w=i(92145);class z extends w.q{constructor(e=null){super("LercWorker","_decode",{_decode:e=>[e.buffer]},e,{strategy:"dedicated"}),this.schedule=e,this.ref=0}decode(e,t,i){return e&&0!==e.byteLength?this.invoke({buffer:e,options:t},i):Promise.resolve(null)}release(){--this.ref<=0&&(S.forEach((e,t)=>{e===this&&S.delete(t)}),this.destroy())}}let S=new Map,x=class extends(0,m.Z)((0,_.Y)((0,v.q)((0,y.I)((0,n.R)(f.Z))))){constructor(...e){super(...e),this.capabilities={operations:{supportsTileMap:!1}},this.copyright=null,this.heightModelInfo=null,this.path=null,this.minScale=void 0,this.maxScale=void 0,this.opacity=1,this.operationalLayerType="ArcGISTiledElevationServiceLayer",this.sourceJSON=null,this.type="elevation",this.url=null,this.version=null,this._lercDecoder=function(e=null){let t=S.get(e);return t||(null!=e?(t=new z(t=>e.immediate.schedule(t)),S.set(e,t)):(t=new z,S.set(null,t))),++t.ref,t}()}normalizeCtorArgs(e,t){return"string"==typeof e?{url:e,...t}:e}destroy(){this._lercDecoder=(0,a.RY)(this._lercDecoder)}readCapabilities(e,t){let i=t.capabilities&&t.capabilities.split(",").map(e=>e.toLowerCase().trim());return i?{operations:{supportsTileMap:i.includes("tilemap")}}:{operations:{supportsTileMap:!1}}}readVersion(e,t){let i=t.currentVersion;return i||(i=9.3),i}load(e){let t=null!=e?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Image Service"],supportsData:!1,validateItem:e=>{if(e.typeKeywords){for(let t=0;t<e.typeKeywords.length;t++)if("elevation 3d layer"===e.typeKeywords[t].toLowerCase())return!0}throw new l.Z("portal:invalid-layer-item-type","Invalid layer item type '${type}', expected '${expectedType}' ",{type:"Image Service",expectedType:"Image Service Elevation 3D Layer"})}},e).catch(o.r9).then(()=>this._fetchImageService(t))),Promise.resolve(this)}fetchTile(e,t,i,s){let l=null!=(s=s||{signal:null}).signal?s.signal:s.signal=(new AbortController).signal,a={responseType:"array-buffer",signal:l},n={noDataValue:s.noDataValue,returnFileInfo:!0};return this.load().then(()=>this._fetchTileAvailability(e,t,i,s)).then(()=>(0,r.Z)(this.getTileUrl(e,t,i),a)).then(e=>this._lercDecoder.decode(e.data,n,l)).then(e=>new b(e))}getTileUrl(e,t,i){let s=!this.capabilities.operations.supportsTileMap&&this.supportsBlankTile,r=(0,h.B7)({...this.parsedUrl.query,blankTile:!s&&null});return`${this.parsedUrl.path}/tile/${e}/${t}/${i}${r?"?"+r:""}`}async queryElevation(e,t){let{ElevationQuery:s}=await i.e(43109).then(i.bind(i,43109));return(0,o.k_)(t),(new s).query(this,e,t)}async createElevationSampler(e,t){let{ElevationQuery:s}=await i.e(43109).then(i.bind(i,43109));return(0,o.k_)(t),(new s).createSampler(this,e,t)}_fetchTileAvailability(e,t,i,s){return this.tilemapCache?this.tilemapCache.fetchAvailability(e,t,i,s):Promise.resolve("unknown")}async _fetchImageService(e){if(this.sourceJSON)return this.sourceJSON;let t={query:{f:"json",...this.parsedUrl.query},responseType:"json",signal:e},i=await (0,r.Z)(this.parsedUrl.path,t);i.ssl&&(this.url=this.url?.replace(/^http:/i,"https:")),this.sourceJSON=i.data,this.read(i.data,{origin:"service",url:this.parsedUrl})}get hasOverriddenFetchTile(){return!this.fetchTile[I]}};(0,s._)([(0,u.Cb)({readOnly:!0})],x.prototype,"capabilities",void 0),(0,s._)([(0,c.r)("service","capabilities",["capabilities"])],x.prototype,"readCapabilities",null),(0,s._)([(0,u.Cb)({json:{read:{source:"copyrightText"}}})],x.prototype,"copyright",void 0),(0,s._)([(0,u.Cb)({readOnly:!0,type:p.Z})],x.prototype,"heightModelInfo",void 0),(0,s._)([(0,u.Cb)({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],x.prototype,"path",void 0),(0,s._)([(0,u.Cb)({type:["show","hide"]})],x.prototype,"listMode",void 0),(0,s._)([(0,u.Cb)({json:{read:!1,write:!1,origins:{service:{read:!1,write:!1},"portal-item":{read:!1,write:!1},"web-document":{read:!1,write:!1}}},readOnly:!0})],x.prototype,"minScale",void 0),(0,s._)([(0,u.Cb)({json:{read:!1,write:!1,origins:{service:{read:!1,write:!1},"portal-item":{read:!1,write:!1},"web-document":{read:!1,write:!1}}},readOnly:!0})],x.prototype,"maxScale",void 0),(0,s._)([(0,u.Cb)({json:{read:!1,write:!1,origins:{"web-document":{read:!1,write:!1}}}})],x.prototype,"opacity",void 0),(0,s._)([(0,u.Cb)({type:["ArcGISTiledElevationServiceLayer"]})],x.prototype,"operationalLayerType",void 0),(0,s._)([(0,u.Cb)()],x.prototype,"sourceJSON",void 0),(0,s._)([(0,u.Cb)({json:{read:!1},value:"elevation",readOnly:!0})],x.prototype,"type",void 0),(0,s._)([(0,u.Cb)(g.HQ)],x.prototype,"url",void 0),(0,s._)([(0,u.Cb)()],x.prototype,"version",void 0),(0,s._)([(0,c.r)("version",["currentVersion"])],x.prototype,"readVersion",null),x=(0,s._)([(0,d.j)("esri.layers.ElevationLayer")],x);let I=Symbol("default-fetch-tile");x.prototype.fetchTile[I]=!0;let L=x},90254:function(e,t,i){i.d(t,{Z:function(){return c}});var s=i(86641);i(55066);var r=i(89312);i(37180),i(65223),i(3457);var l=i(37647),a=i(64186),n=i(62903),o=i(3443),h=i(23787),u=i(36502);let c=e=>{let t=class extends e{constructor(){super(...arguments),this.copyright=null,this.minScale=0,this.maxScale=0,this.spatialReference=null,this.tileInfo=null,this.tilemapCache=null}destroy(){this.tilemapCache?.destroy?.()}readMinScale(e,t){return null!=t.minLOD&&null!=t.maxLOD?e:0}readMaxScale(e,t){return null!=t.minLOD&&null!=t.maxLOD?e:0}get supportsBlankTile(){return this.version>=10.2}readTilemapCache(e,t,i){let s=t.capabilities?.includes("Tilemap"),{minLOD:r,maxLOD:l,minScale:a,maxScale:u}=t;if(null==r&&null==l&&0!==a&&0!==u){let e=e=>Math.round(1e4*e)/1e4;for(let i of(a=e(a||t.tileInfo.lods[0].scale),u=e(u||t.tileInfo.lods[t.tileInfo.lods.length-1].scale),t.tileInfo.lods)){let t=e(i.scale);r=t>=a?i.level:r,l=t>=u?i.level:l}}if(s)return new h.y({layer:this,minLOD:r,maxLOD:l});if(t.tileInfo){let e=new n.Z;return e.read(t.tileInfo,i),new o.Z(e,r,l)}return null}};return(0,s._)([(0,r.Cb)({json:{read:{source:"copyrightText"}}})],t.prototype,"copyright",void 0),(0,s._)([(0,r.Cb)()],t.prototype,"minScale",void 0),(0,s._)([(0,l.r)("service","minScale")],t.prototype,"readMinScale",null),(0,s._)([(0,r.Cb)()],t.prototype,"maxScale",void 0),(0,s._)([(0,l.r)("service","maxScale")],t.prototype,"readMaxScale",null),(0,s._)([(0,r.Cb)({type:u.Z})],t.prototype,"spatialReference",void 0),(0,s._)([(0,r.Cb)({readOnly:!0})],t.prototype,"supportsBlankTile",null),(0,s._)([(0,r.Cb)({type:n.Z})],t.prototype,"tileInfo",void 0),(0,s._)([(0,r.Cb)()],t.prototype,"tilemapCache",void 0),(0,s._)([(0,l.r)("service","tilemapCache",["capabilities","tileInfo"])],t.prototype,"readTilemapCache",null),(0,s._)([(0,r.Cb)()],t.prototype,"version",void 0),t=(0,s._)([(0,a.j)("esri.layers.mixins.ArcGISCachedService")],t)}},3443:function(e,t,i){i.d(t,{Z:function(){return l}});var s=i(94605),r=i(31124);class l{constructor(e,t=0,i=e.lods[e.lods.length-1].level){this.tileInfo=e,this.minLOD=t,this.maxLOD=i,e.lodAt(t)||(this.minLOD=e.lods[0].level),e.lodAt(i)||(this.maxLOD=e.lods[e.lods.length-1].level)}get effectiveMinLOD(){return this.minLOD??this.tileInfo.lods[0].level}get effectiveMaxLOD(){return this.maxLOD??this.tileInfo.lods[this.tileInfo.lods.length-1].level}getAvailability(e,t,i){let s=this.tileInfo?.lodAt(e);return!s||e<this.minLOD||e>this.maxLOD?"unavailable":s.cols&&s.rows?i>=s.cols[0]&&i<=s.cols[1]&&t>=s.rows[0]&&t<=s.rows[1]?"unknown":"unavailable":"unknown"}async fetchAvailability(e,t,i,l){await (0,r.Yn)(l);let a=this.getAvailability(e,t,i);if("unavailable"===a)throw new s.Z("tile-map:tile-unavailable","Tile is not available",{level:e,row:t,col:i});return a}async fetchAvailabilityUpsample(e,t,i,s,l){await (0,r.Yn)(l),s.level=e,s.row=t,s.col=i;let a=this.tileInfo;return a.updateTileInfo(s),this.fetchAvailability(e,t,i,l).catch(e=>{if((0,r.D_)(e))throw e;if(a.upsampleTile(s))return this.fetchAvailabilityUpsample(s.level,s.row,s.col,s,l);throw e})}}},23787:function(e,t,i){i.d(t,{y:function(){return S}});var s,r=i(86641),l=i(54748),a=i(94761),n=i(49443),o=i(94605),h=i(1662);i(37180);var u=i(57812),c=i(35313),d=i(31124),p=i(20128),f=i(93417),m=i(72659),_=i(89312);i(65223),i(3457);var v=i(64186),y=i(49176),g=i(61764),b=i(13677);class w{constructor(e){!function(e){if(!e?.location)throw new o.Z("tilemap:missing-location","Location missing from tilemap response");if(!1===e.valid)throw new o.Z("tilemap:invalid","Tilemap response was marked as invalid");if(!e.data)throw new o.Z("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(e.data))throw new o.Z("tilemap:data-mismatch","Data must be an array of numbers");if(e.data.length!==e.location.width*e.location.height)throw new o.Z("tilemap:data-mismatch","Number of data items does not match width/height of tilemap")}(e);let{location:t,data:i}=e;this.location=Object.freeze((0,g.d9)(t));let s=this.location.width,r=this.location.height,l=!0,a=!0,n=function(e,t=!1){return e<=b.c8?t?Array(e).fill(0):Array(e):new Uint32Array(e)}(Math.ceil(s*r/32)),h=0;for(let e=0;e<i.length;e++){let t=e%32;i[e]?(a=!1,n[h]|=1<<t):l=!1,31===t&&++h}a?(this._availability="unavailable",this.byteSize=40):l?(this._availability="available",this.byteSize=40):(this._availability=n,this.byteSize=40+(0,b.Xw)(n))}getAvailability(e,t){if("unavailable"===this._availability||"available"===this._availability)return this._availability;let i=(e-this.location.top)*this.location.width+(t-this.location.left),s=i>>5,r=this._availability;return s<0||s>r.length?"unknown":r[s]&1<<i%32?"available":"unavailable"}static fromDefinition(e,t){let i=e.service.request||l.Z,{row:s,col:r,width:a,height:n}=e,h={query:{f:"json"}};return t=t?{...h,...t}:h,i(function(e){let t;if(e.service.tileServers?.length){let i=e.service.tileServers;t=`${i&&i.length?i[e.row%i.length]:e.service.url}/tilemap/${e.level}/${e.row}/${e.col}/${e.width}/${e.height}`}else t=`${e.service.url}/tilemap/${e.level}/${e.row}/${e.col}/${e.width}/${e.height}`;let i=e.service.query;return i&&(t=`${t}?${i}`),t}(e),t).then(e=>e.data).catch(e=>{if(422===e?.details?.httpStatus)return{location:{top:s,left:r,width:a,height:n},valid:!0,data:Array(a*n).fill(0)};throw e}).then(e=>{if(e.location&&(e.location.top!==s||e.location.left!==r||e.location.width!==a||e.location.height!==n))throw new o.Z("tilemap:location-mismatch","Tilemap response for different location than requested",{response:e,definition:{top:s,left:r,width:a,height:n}});return w.fromJSON(e)})}static fromJSON(e){return Object.freeze(new w(e))}}function z(e){return`${e.level}/${e.row}/${e.col}/${e.width}/${e.height}`}let S=s=class extends a.Z{constructor(e){super(e),this._pendingTilemapRequests={},this.request=l.Z,this.size=32,this._prefetchingEnabled=!0}initialize(){this._tilemapCache=new u.z(2*n.Y.MEGABYTES),this.addHandles((0,p.YP)(()=>{let{layer:e}=this;return[e?.parsedUrl,e?.tileServers,e?.apiKey,e?.customParameters]},()=>this._initializeTilemapDefinition(),p.nn))}get effectiveMinLOD(){return this.minLOD??this.layer.tileInfo.lods[0].level}get effectiveMaxLOD(){return this.maxLOD??this.layer.tileInfo.lods[this.layer.tileInfo.lods.length-1].level}getAvailability(e,t,i){if(!this.layer.tileInfo.lodAt(e)||e<this.effectiveMinLOD||e>this.effectiveMaxLOD)return"unavailable";let s=this._tilemapFromCache(e,t,i,this._tmpTilemapDefinition);return s?s.getAvailability(t,i):"unknown"}fetchAvailability(e,t,i,s){return!this.layer.tileInfo.lodAt(e)||e<this.effectiveMinLOD||e>this.effectiveMaxLOD?Promise.reject(new o.Z("tile-map:tile-unavailable","Tile is not available",{level:e,row:t,col:i})):this._fetchTilemap(e,t,i,s).catch(e=>e).then(s=>{if(s instanceof w){let r=s.getAvailability(t,i);if("unavailable"===r)throw new o.Z("tile-map:tile-unavailable","Tile is not available",{level:e,row:t,col:i});return r}if((0,d.D_)(s))throw s;return"unknown"})}fetchAvailabilityUpsample(e,t,i,s,r){s.level=e,s.row=t,s.col=i;let l=this.layer.tileInfo;l.updateTileInfo(s);let a=this.fetchAvailability(e,t,i,r).catch(e=>{if((0,d.D_)(e))throw e;if(l.upsampleTile(s))return this.fetchAvailabilityUpsample(s.level,s.row,s.col,s,r);throw e});return this._fetchAvailabilityUpsamplePrefetch(s.id,e,t,i,r,a),a}async _fetchAvailabilityUpsamplePrefetch(e,t,i,r,l,a){if(!this._prefetchingEnabled||null==e)return;let n=`prefetch-${e}`;if(this.hasHandles(n))return;let o=new AbortController;a.then(()=>o.abort(),()=>o.abort());let u=!1,c=(0,h.kB)(()=>{u||(u=!0,o.abort())});if(this.addHandles(c,n),await (0,f.MU)(10,o.signal).catch(()=>{}),u||(u=!0,this.removeHandles(n)),(0,d.Hc)(o))return;let p=new y.f(e,t,i,r),m={...l,signal:o.signal},_=this.layer.tileInfo;for(let e=0;s._prefetches.length<s._maxPrefetch&&_.upsampleTile(p);++e){let e=this.fetchAvailability(p.level,p.row,p.col,m);s._prefetches.push(e);let t=()=>{s._prefetches.removeUnordered(e)};e.then(t,t)}}_fetchTilemap(e,t,i,s){if(!this.layer.tileInfo.lodAt(e)||e<this.effectiveMinLOD||e>this.effectiveMaxLOD)return Promise.reject(new o.Z("tilemap-cache:level-unavailable",`Level ${e} is unavailable in the service`));let r=this._tmpTilemapDefinition,l=this._tilemapFromCache(e,t,i,r);if(l)return Promise.resolve(l);let a=s?.signal;return s={...s,signal:null},new Promise((e,t)=>{(0,d.fu)(a,()=>t((0,d.zE)()));let i=z(r),l=this._pendingTilemapRequests[i];if(!l){l=w.fromDefinition(r,s).then(e=>(this._tilemapCache.put(i,e,e.byteSize),e));let e=()=>{delete this._pendingTilemapRequests[i]};this._pendingTilemapRequests[i]=l,l.then(e,e)}l.then(e,t)})}_initializeTilemapDefinition(){if(!this.layer.parsedUrl)return;let{parsedUrl:e,apiKey:t,customParameters:i}=this.layer;this._tilemapCache.clear(),this._tmpTilemapDefinition={service:{url:e.path,query:(0,m.B7)({...e.query,...i,token:t??e.query?.token}),tileServers:this.layer.tileServers,request:this.request},width:this.size,height:this.size,level:0,row:0,col:0}}_tilemapFromCache(e,t,i,s){s.level=e,s.row=t-t%this.size,s.col=i-i%this.size;let r=z(s);return this._tilemapCache.get(r)}get test(){}};S._maxPrefetch=4,S._prefetches=new c.Z({initialSize:s._maxPrefetch}),(0,r._)([(0,_.Cb)({constructOnly:!0})],S.prototype,"layer",void 0),(0,r._)([(0,_.Cb)({constructOnly:!0})],S.prototype,"minLOD",void 0),(0,r._)([(0,_.Cb)({constructOnly:!0})],S.prototype,"maxLOD",void 0),(0,r._)([(0,_.Cb)({constructOnly:!0})],S.prototype,"request",void 0),(0,r._)([(0,_.Cb)({constructOnly:!0})],S.prototype,"size",void 0),S=s=(0,r._)([(0,v.j)("esri.layers.support.TilemapCache")],S)},49078:function(e,t,i){i.d(t,{a:function(){return l}});var s=i(9266),r=i(9397);let l={unknown:1,inches:(0,s.En)(1,"meters","inches"),feet:(0,s.En)(1,"meters","feet"),"us-feet":(0,s.En)(1,"meters","us-feet"),yards:(0,s.En)(1,"meters","yards"),miles:(0,s.En)(1,"meters","miles"),"nautical-miles":(0,s.En)(1,"meters","nautical-miles"),millimeters:(0,s.En)(1,"meters","millimeters"),centimeters:(0,s.En)(1,"meters","centimeters"),decimeters:(0,s.En)(1,"meters","decimeters"),meters:(0,s.En)(1,"meters","meters"),kilometers:(0,s.En)(1,"meters","kilometers"),"decimal-degrees":1/(0,s.ty)(1,"meters",r.sv.radius)}},81961:function(e,t,i){i.d(t,{Z:function(){return b}});var s,r,l=i(86641),a=i(740),n=i(689),o=i(36152),h=i(89312);i(37180),i(65223),i(3457);var u=i(37647),c=i(64186),d=i(50713),p=i(67009);let f=s=class extends n.wq{constructor(e){super(e)}async collectRequiredFields(e,t){return(0,p.io)(e,t,this.expression)}clone(){return new s({expression:this.expression,title:this.title})}equals(e){return this.expression===e.expression&&this.title===e.title}};(0,l._)([(0,h.Cb)({type:String,json:{write:!0}})],f.prototype,"expression",void 0),(0,l._)([(0,h.Cb)({type:String,json:{write:!0}})],f.prototype,"title",void 0);let m=f=s=(0,l._)([(0,c.j)("esri.symbols.support.FeatureExpressionInfo")],f);var _=i(65321);let v=(0,a.w)()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),y=new a.X({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"}),g=r=class extends n.wq{constructor(e){super(e),this.offset=null}readFeatureExpressionInfo(e,t){return null!=e?e:t.featureExpression&&0===t.featureExpression.value?{expression:"0"}:void 0}writeFeatureExpressionInfo(e,t,i,s){t[i]=e.write({},s),"0"===e.expression&&(t.featureExpression={value:0})}get mode(){let{offset:e,featureExpressionInfo:t}=this;return this._isOverridden("mode")?this._get("mode"):null!=e||t?"relative-to-ground":"on-the-ground"}set mode(e){this._override("mode",e)}set unit(e){this._set("unit",e)}write(e,t){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(e,t):null}clone(){return new r({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}equals(e){return this.mode===e.mode&&this.offset===e.offset&&this.unit===e.unit&&(0,o._W)(this.featureExpressionInfo,e.featureExpressionInfo)}};(0,l._)([(0,h.Cb)({type:m,json:{write:!0}})],g.prototype,"featureExpressionInfo",void 0),(0,l._)([(0,u.r)("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],g.prototype,"readFeatureExpressionInfo",null),(0,l._)([(0,d.c)("featureExpressionInfo",{featureExpressionInfo:{type:m},"featureExpression.value":{type:[0]}})],g.prototype,"writeFeatureExpressionInfo",null),(0,l._)([(0,h.Cb)({type:v.apiValues,nonNullable:!0,json:{type:v.jsonValues,read:v.read,write:{writer:v.write,isRequired:!0}}})],g.prototype,"mode",null),(0,l._)([(0,h.Cb)({type:Number,json:{write:!0}})],g.prototype,"offset",void 0),(0,l._)([(0,h.Cb)({type:_.f9,json:{type:String,read:y.read,write:y.write}})],g.prototype,"unit",null);let b=g=r=(0,l._)([(0,c.j)("esri.symbols.support.ElevationInfo")],g)},65321:function(e,t,i){i.d(t,{Z7:function(){return r},f9:function(){return l}});var s=i(49078);function r(e){return 1/(s.a[e]||1)}let l=function(){let e=Object.keys(s.a);return e.sort(),e}()}}]);