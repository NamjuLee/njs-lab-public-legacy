"use strict";(self.webpackChunkNJS_Lab=self.webpackChunkNJS_Lab||[]).push([[24140],{24140:(t,i,s)=>{s.r(i),s.d(i,{Demo21AppD3USTopoVis:()=>m,Solution:()=>S});var e=s(23928),h=s(48167),o=s(26067),a=s(35522),n=s(48967),r=s(458);class d{constructor(t){this.id=void 0,this.USTopoSVG=void 0,this.width=void 0,this.height=void 0,this.d3Selection=void 0,this.d3GeoPathGenerator=void 0,this.d3projection=void 0,this.topoUSARaw=void 0,this.geoJsonBase=void 0,this.USTopoSVG=t,this.id=this.USTopoSVG.divHost.id,this.width=this.USTopoSVG.properties.widthVis-this.USTopoSVG.margin.left-this.USTopoSVG.margin.right,this.height=this.USTopoSVG.properties.heightVis-this.USTopoSVG.margin.top-this.USTopoSVG.margin.bottom,this.Init()}async Init(){this.InitProjection(),this.InitSVG(),this.InitBase().then((()=>{this.DrawMapSVG()})),this.InitRefer()}InitRefer(){const t=document.createElement("div");t.textContent="Reference: https://observablehq.com/@d3/choropleth",t.style.marginLeft="10px",t.style.marginTop="10px",this.USTopoSVG.divHost.append(t)}InitProjection(){const t=.5*this.width,i=.5*this.height;this.d3projection=(0,a.Z)().scale(1e3).translate([t,i]),this.d3GeoPathGenerator=(0,n.Z)().projection(this.d3projection).pointRadius(4)}InitSVG(){this.d3Selection=(0,o.Ys)("#".concat(this.id)).append("svg").attr("width",this.width+this.USTopoSVG.margin.left+this.USTopoSVG.margin.right).attr("height",this.height+this.USTopoSVG.margin.top+this.USTopoSVG.margin.bottom).style("position","absolute").append("g").attr("transform","translate("+this.USTopoSVG.margin.left+","+this.USTopoSVG.margin.top+")")}async InitBase(){return r.G7.URL("https://gist.githubusercontent.com/mbostock/4090846/raw/d534aba169207548a8a3d670c9c2cc719ff05c47/us.json").then((t=>{this.topoUSARaw=JSON.parse(t),this.geoJsonBase=(0,h.zL)(this.topoUSARaw,this.topoUSARaw.objects.counties);for(let s=0;s<this.geoJsonBase.features.length;++s){const t=this.geoJsonBase.features[s],e=this.USTopoSVG.dataClass.data[t.id],h=this.USTopoSVG.sleID;try{if(e[h]){const t=r.$H.Remap(+e[h],this.USTopoSVG.dataClass.min,this.USTopoSVG.dataClass.max,0,600);this.geoJsonBase.features[s].properties.data=t}else this.geoJsonBase.features[s].properties.data=0}catch(i){this.geoJsonBase.features[s].properties.data=0}Math.random()<.5?this.geoJsonBase.features[s].properties.visited=!0:this.geoJsonBase.features[s].properties.visited=!1}return this.geoJsonBase}))}DrawMapSVG(){this.d3Selection.selectAll("path").data(this.geoJsonBase.features).enter().append("path").attr("d",this.d3GeoPathGenerator).style("stroke","#fff").style("stroke-width",".25").style("fill",(t=>{const i=t.properties.data;return"rgb(0, 0, ".concat(i,")")})).on("mouseover",(function(t){null!==o.Ba6.currentTarget&&(0,o.Ys)(o.Ba6.currentTarget).style("fill",(function(t){const i=t.properties.data;return"rgb(0, 0, ".concat(i+i,")")}))})).on("mousemove",((t,i)=>{this.USTopoSVG.UpdateLegend(t)})).on("click",(function(t,i){null!==o.Ba6.currentTarget&&(0,o.Ys)(o.Ba6.currentTarget).style("fill",(function(t){const i=t.properties.data;return"rgb(0, 0, ".concat(i,")")}))})).on("mouseleave",(()=>{null!==o.Ba6.currentTarget&&(0,o.Ys)(o.Ba6.currentTarget).style("fill",(function(t){const i=t.properties.data;return"rgb(0, 0, ".concat(i,")")}))}))}}class c{constructor(t,i){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:670,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:400,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:250,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:150;this.USTopoSVG=void 0,this.hostDiv=void 0,this.div=void 0,this.divTitle=void 0,this.divInspection=void 0,this.canvas=void 0,this.ctx=void 0,this.width=250,this.height=300,this.vec=new r.h9(0,0),this.isCaptured=!1,this.histData=[],this.binNum=20,this.binIndexSel=-1,this.valSel=-1,this.xStandardDeviation=0,this.USTopoSVG=t,this.hostDiv=i,this.vec.x=s,this.vec.y=e,this.width=h,this.height=o,this.InitDiv(),this.Render()}InitDiv(){const t=document.createElement("div");if(t){this.div=t,this.hostDiv.append(this.div),this.div.style.position="absolute",this.div.style.background="rgba(255, 255, 255, 1.0)",this.div.style.pointerEvents="none",this.div.style.top="".concat(this.vec.y,"px"),this.div.style.left="".concat(this.vec.x,"px"),this.div.style.width="".concat(this.width,"px"),this.div.style.height="".concat(this.height,"px"),this.div.style.border="".concat(2,"px"),this.div.style.borderColor="#000000";const i=document.createElement("div");i&&(this.divTitle=i,this.div.append(this.divTitle),this.divTitle.style.margin="5px",this.divTitle.textContent="Unemployment rate (%)"),this.InitCanvas();const s=document.createElement("div");s&&(this.divInspection=s,this.div.append(this.divInspection),this.divInspection.style.margin="5px",this.divInspection.textContent="Move your mouse to inspect the data")}}UpdateLegend(t,i){const s=t.id,e=this.USTopoSVG.dataClass.data[s];try{const t=e[3]+","+e[4]+", value:"+e[i];this.valSel=e[i],this.binIndexSel=r.cb.GetIndexByDataForHistDataFromNumeric(this.histData,e[i]),this.divInspection.textContent=t}catch(h){const t="";this.divInspection.textContent=t}}InitCanvas(){const t=document.createElement("canvas");if(t){this.canvas=t,this.canvas.style.pointerEvents="none",this.canvas.height=50,this.canvas.width=this.width-10,this.canvas.style.margin="5px";const i=this.canvas.getContext("2d");i&&(this.ctx=i,this.div.append(this.canvas),this.histData=r.cb.GetDataForHistDataFromNumeric(this.USTopoSVG.dataClass.dataSelArray,this.binNum),this.xStandardDeviation=r.cb.StandardDeviation(this.USTopoSVG.dataClass.dataSelArray))}}IsInside(t,i){return!(this.vec.x>t||this.vec.x+this.width<t)&&!(this.vec.y>i||this.vec.y+this.height<i)}MouseDown(t){this.IsInside(t.x,t.y)?this.isCaptured=!0:this.isCaptured=!1}MouseUp(t){this.isCaptured=!0}MouseMove(t){this.IsInside(t.x,t.y)?(this.isCaptured=!0,this.div.style.background="rgba(255, 255, 255, 1.0)"):(this.div.style.background="rgba(230, 230, 230, 0.0)",this.isCaptured=!1)}MouseDrag(t){if(!this.isCaptured)return;let i=t.x-t.preX,s=t.y-t.preY;if(this.div.style.top&&this.div.style.left){let t=parseFloat(this.div.style.top),e=parseFloat(this.div.style.left);if(t&&e){const h=e*i,o=t*s;this.vec.x=h,this.vec.y=o,this.div.style.top="".concat(this.vec.y,"px"),this.div.style.left="".concat(this.vec.x,"px")}}}Render(){requestAnimationFrame((()=>{this.Render()})),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.beginPath(),this.ctx.rect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.closePath(),this.ctx.fillStyle="rgba(0, 0, 0, 0)",this.ctx.fill();const t=this.ctx.canvas.width/this.binNum+1;let i=Number.MIN_SAFE_INTEGER;for(let e=0;e<this.histData.length;++e){const t=this.histData[e].length;i<t&&(i=t)}for(let e=0;e<this.histData.length;++e){const s=this.histData[e].length;this.binIndexSel===e&&this.binIndexSel>0?this.ctx.fillStyle="#0000ff":this.ctx.fillStyle="#0000aa",this.ctx.beginPath();const h=r.$H.Remap(s,0,i,this.ctx.canvas.height-3,5);this.ctx.rect(e*t,h,t-5,this.ctx.canvas.height),this.ctx.closePath(),this.ctx.fill()}let s=r.$H.Remap(this.xStandardDeviation,this.USTopoSVG.dataClass.min,this.USTopoSVG.dataClass.max,5,this.ctx.canvas.width);this.ctx.setLineDash([2,4]),this.ctx.strokeStyle="#000000",this.ctx.beginPath(),this.ctx.moveTo(s,0),this.ctx.lineTo(s,this.ctx.canvas.height),this.ctx.closePath(),this.ctx.lineWidth=1,this.ctx.stroke(),this.ctx.setLineDash([0,0]),s=r.$H.Remap(this.valSel,this.USTopoSVG.dataClass.min,this.USTopoSVG.dataClass.max,5,this.ctx.canvas.width),this.ctx.setLineDash([3,3]),this.ctx.beginPath(),this.ctx.moveTo(s,0),this.ctx.lineTo(s,this.ctx.canvas.height),this.ctx.closePath(),this.ctx.strokeStyle="#0000ff",this.ctx.lineWidth=1.5,this.ctx.stroke(),this.ctx.setLineDash([0,0])}}class l{constructor(t){this.USTopoSVG=void 0,this.dataRaw=void 0,this.data={},this.index=void 0,this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER,this.dataSelArray=[],this.USTopoSVG=t}async Init(t){return fetch("njslabSandboxStatic/data/dataUSUnemployed.csv").then((t=>t.text())).then((i=>{const s=[],e=i.split("\r\n");this.index=e[4].split(",");for(let h=6;h<e.length;++h){const i=e[h].split(",");s.push(i);const o=+i[t];o&&(this.dataSelArray.push(o),o<this.min&&(this.min=o),o>this.max&&(this.max=o))}this.dataRaw=s;for(let t=0;t<s.length;++t){const i=s[t][1]+s[t][2];this.data[i]=s[t]}return this.dataRaw})).catch((t=>{console.log(t)}))}}var p=s(58193);class v{constructor(t){this.divHost=void 0,this.listShapes=void 0,this.width=800,this.height=500,this.margin=void 0,this.x=void 0,this.y=void 0,this.properties=void 0,this.mp=[0,0],this.geoGenerator=void 0,this.projection=void 0,this.ctx=void 0,this.id=void 0,this.geojson=void 0,this.color=void 0,this.dataClass=void 0,this.sleID=void 0,this.d3Implementation=void 0,this.legend=void 0,this.divHost=t,this.properties={widthVis:800,heightVis:500,labelX:"string",labelY:"string",minX:0,maxX:500,minY:0,maxY:500},this.margin=new r.yA,this.margin.bottom=5,this.margin.left=5,this.margin.right=5,this.margin.top=5,this.listShapes={},this.color=(0,e.Z)().range(["rgb(213,222,217)","rgb(69,173,168)","rgb(84,36,55)","rgb(217,91,67)"]),this.sleID=10,this.Init()}async Init(){this.InitData().then((()=>{this.d3Implementation=new d(this),this.InitCanvas(),this.legend=new c(this,this.divHost)}))}async InitData(){return this.dataClass=new l(this),await this.dataClass.Init(this.sleID)}UpdateLegend(t){this.legend&&this.legend.UpdateLegend(t,this.sleID)}InitCanvas(){const t=document.createElement("canvas");t.style.pointerEvents="none",t.style.position="absolute",t.width=1e3,t.height=1e3,this.divHost.append(t);const i=t.getContext("2d");this.id=this.divHost.id,i&&(this.ctx=i,this.Update())}MouseDown(t){this.legend&&this.legend.MouseDown(t)}MouseUp(t){this.legend&&this.legend.MouseUp(t)}MouseMove(t){this.mp[0]=t.x,this.mp[1]=t.y,this.legend&&this.legend.MouseMove(t)}MouseDrag(t){this.legend.MouseDrag(t)}arcToCoordinates(t,i){let s=0,e=0;return i.map((i=>[(s+=i[0])*t.transform.scale[0]+t.transform.translate[0],(e+=i[1])*t.transform.scale[1]+t.transform.translate[1]]))}Update(){requestAnimationFrame((()=>{this.Update()})),this.ctx.clearRect(0,0,1500,1500);let t=(0,p.Z)();this.ctx.beginPath(),this.ctx.strokeStyle="#eee",this.d3Implementation.d3GeoPathGenerator(t()),this.ctx.strokeStyle="#bbbbbb",this.ctx.stroke(),this.ctx.lineWidth=.5,this.ctx.strokeStyle="#333",this.ctx.beginPath(),this.ctx.stroke(),this.ctx.globalCompositeOperation=r.kz.SCREEN;this.d3Implementation.d3projection([this.mp[0],this.mp[1]]);this.ctx.beginPath(),this.ctx.arc(this.mp[0],this.mp[1],25,0,6.28),this.ctx.closePath(),this.ctx.fillStyle="rgba(255, 255, 255, 0.25)",this.ctx.fill(),this.ctx.globalCompositeOperation=r.kz.SOURCE_OVER}}class g{constructor(t){this.USTopoSVG=void 0,this.divHost=void 0;const i=document.getElementById(t);i&&(this.divHost=i,this.InitApp())}InitApp(){console.log("ddsdd"),this.USTopoSVG=new v(this.divHost)}}class m{static Init(t){new m(t).Dummy()}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"SandBox";this.implementation=void 0,this.implementation=new g(t)}Dummy(){}}class S{constructor(t){this.divHost=void 0,this.divHost=document.getElementById(t),m.Init(t)}destroy(){if(this.divHost)try{for(;this.divHost.firstChild;)this.divHost.removeChild(this.divHost.firstChild)}catch(t){console.error("Error in destroy method:",t)}else console.warn("divHost is undefined in destroy method")}}}}]);
//# sourceMappingURL=24140.8f6b150e.chunk.js.map