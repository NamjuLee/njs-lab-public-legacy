"use strict";(self.webpackChunkNJS_Lab=self.webpackChunkNJS_Lab||[]).push([[62605],{62605:(t,e,i)=>{i.r(e),i.d(e,{Solution:()=>y});var s=i(5483),o=i.n(s);class n{constructor(t){var e=this;this.map=void 0,this.center=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-99.292649,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:39.043903;e.map.setCenter({lat:i,lng:t})},this.toMap=(t,e)=>{const i=this.map.unproject({x:t,y:e});return[i.lng,i.lat]},this.toScreen=(t,e)=>{const i=this.map.project([t,e]);return[i.x,i.y]},this.mouseDown=t=>{},this.mouseUp=t=>{},this.mouseMove=t=>{},this.mouseClick=t=>{},this.mouseDClick=t=>{},this.initMap(t)}initMap(t){o().accessToken="pk.eyJ1IjoiZGVzaWduanUiLCJhIjoiY2xhNGU0YWo4MDlhYzNwdHBwenVvang4eiJ9.P3sX4l_3KjdPeRRbVS1VVg",this.map=new(o().Map)({container:t,zoom:5,center:[-71.093161,42.358871],style:"mapbox://styles/mapbox/dark-v10"}),this.map.dragRotate.disable(),this.map.on("mousemove",(t=>{this.mouseMove(t)})),this.map.on("click",(t=>{this.mouseClick(t)})),this.map.on("mousedown",(t=>{this.mouseDown(t)})),this.map.on("dblclick",(t=>{this.mouseDClick(t)})),this.map.on("mouseup",(t=>{this.mouseUp(t)}));let e=document.getElementsByClassName("mapboxgl-canvas")[0];e.style.position="absolute",e=document.getElementsByClassName("mapboxgl-control-container")[0],e.style.display="none"}}var a=i(69175);class r{constructor(){this.renderer={type:"FeatureCollection",name:"ready-polygon-editor",features:[]},this.id="scene-polygon-editor",this.hoveredPolygonId=null,this.source=void 0,this.map=void 0,this.initScene=()=>{this.source={type:"geojson",data:this.getDataScene(),generateId:!0},this.map.addSource(this.renderer.name,this.source),this.map.addLayer({id:this.id,type:"fill",source:this.renderer.name,layout:{},paint:{"fill-color":["get","color"],"fill-opacity":["case",["boolean",["feature-state","hover"],!1],.8,.4]}}),this.map.addLayer({id:"outline",type:"line",source:this.renderer.name,layout:{},paint:{"line-color":"#000","line-width":1}}),this.map.on("click",this.id,(t=>{})),this.map.on("mousemove",this.id,(t=>{t.features.length>0&&(null!==this.hoveredPolygonId&&this.map.setFeatureState({source:this.renderer.name,id:this.hoveredPolygonId},{hover:!1}),this.hoveredPolygonId=t.features[0].id,this.map.setFeatureState({source:this.renderer.name,id:this.hoveredPolygonId},{hover:!0}))})),this.map.on("mouseleave",this.id,(()=>{null!==this.hoveredPolygonId&&this.map.setFeatureState({source:this.renderer.name,id:this.hoveredPolygonId},{hover:!1}),this.hoveredPolygonId=null}))},this.pushFeature=t=>{this.renderer.features.push(t)},this.updateRenderer=()=>{this.map.getSource(this.renderer.name).setData(this.getDataScene())},this.updateZoom=t=>{const e=a.VWR(t);this.map.fitBounds(e,{padding:20})}}removePolygon(t){const e=this.renderer.features.map(((e,i)=>e.properties.uuid===t?i:-1));for(let i=e.length-1;i>-1;--i)-1!==e[i]&&this.renderer.features.splice(e[i],1);this.updateRenderer()}getDataScene(){return JSON.parse(JSON.stringify(this.renderer))}}var h=i(55913);class d{constructor(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};this.divHost=void 0,this.div=void 0,this.divBtn=void 0,this.divViz=void 0,this.divBtnSplit=void 0,this.divLayerName=void 0,this.divHost=t,this.div=document.createElement("div"),this.divHost.appendChild(this.div),this.div.style.width="200px",this.div.style.height="40px",this.div.style.background="black",this.div.style.fontSize="12px",this.div.style.margin="3px",this.div.style.zIndex="5",this.div.style.position="relative",this.div.style.display="flex",this.divBtn=document.createElement("div"),this.divBtn.style.width="38px",this.divBtn.style.height="38px",this.divBtn.style.background="black",this.divBtn.style.padding="10px",this.divBtn.style.margin="1px",this.divBtn.textContent="X",this.divBtn.onclick=()=>e(),this.div.appendChild(this.divBtn),this.divViz=document.createElement("div"),this.divViz.style.width="38px",this.divViz.style.height="38px",this.divViz.style.background="black",this.divViz.style.padding="10px",this.divViz.style.margin="1px",this.divViz.textContent="V",this.divViz.onclick=()=>s(),this.div.appendChild(this.divViz),i&&this.appendSplit(o),this.divLayerName=document.createElement("div"),this.divLayerName.style.width="100%",this.divLayerName.style.height="40px",this.divLayerName.style.color="black",this.div.appendChild(this.divLayerName)}appendSplit(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:()=>{};this.divBtnSplit=document.createElement("div"),this.divBtnSplit.style.width="38px",this.divBtnSplit.style.height="38px",this.divBtnSplit.style.background="black",this.divBtnSplit.style.padding="10px",this.divBtnSplit.style.margin="1px",this.divBtnSplit.textContent="S",this.divBtnSplit.onclick=()=>t(),this.div.appendChild(this.divBtnSplit)}destroy(){this.div.removeChild(this.divLayerName),this.div.removeChild(this.divBtn),this.divHost.removeChild(this.div)}}class l{constructor(t,e){this.data={name:"untitled",type:"FeatureCollection",features:[]},this.layer=void 0,this.scene=void 0,this.uuid=void 0,this.color=void 0,this.isVisible=!0,this.conditionSplit={needSplit:!1,isMultiFeature:!1,isMultiPolygon:!1},this.toggleVisibility=()=>{this.isVisible=!this.isVisible,this.isVisible?this.addScene():this.removeScene()},this.split=()=>{this.conditionSplit.isMultiFeature&&c(this.data).forEach((t=>{new l(this.scene,JSON.stringify(t))})),!this.conditionSplit.isMultiFeature&&this.conditionSplit.isMultiPolygon&&u(this.data).forEach((t=>{new l(this.scene,JSON.stringify(t))})),this.destroy()},this.destroy=()=>{this.removeScene(),this.layer.destroy()},this.scene=t,this.data=JSON.parse(e),console.log(this.data);const i=[],s=[];this.data.features.map((t=>{console.log(t.geometry.coordinates);const e=a.yue(t.geometry.coordinates);console.log(e),i.push(e),s.push(t.geometry.coordinates)})),this.data=m(this.data),this.uuid=(0,h.Fs)(),this.color=(0,h.QB)(),this.conditionSplit=p(this.data),this.layer=new d(t.map.getCanvas().parentElement,this.destroy,this.conditionSplit.needSplit,this.toggleVisibility,this.split),this.layer.div.style.background=this.color,this.data.name=this.data.name?this.data.name:"untitled",this.layer.divLayerName.textContent=this.data.name,this.addScene(),this.zoomIn()}addScene(){for(let t=0;t<this.data.features.length;++t){const e=this.data.features[t];e.properties.uuid=this.uuid,e.properties.color=this.color,this.scene.pushFeature(e)}this.scene.updateRenderer()}removeScene(){this.scene.removePolygon(this.uuid)}zoomIn(){this.scene.updateZoom(this.data)}}const p=t=>{const e=t.features.length>1,i=t.features[0].geometry.coordinates.length>1;return{isMultiFeature:e,isMultiPolygon:i,needSplit:e||i}},c=t=>{const e=[];for(let i=0;i<t.features.length;++i){const s={features:[{geometry:{coordinates:t.features[i].geometry.coordinates,type:t.features[i].geometry.type},type:t.features[i].type,properties:t.features[i].properties}],type:t.type,name:"".concat(t.name,"_").concat(i)};e.push(s)}return e},u=t=>{const e=[];for(let i=0;i<t.features.length;++i){const s=t.features[i].geometry.coordinates;for(let o=0;o<s.length;++o){const n={features:[{geometry:{coordinates:[s[o]],type:t.features[i].geometry.type},type:t.features[i].type,properties:t.features[i].properties}],type:t.type,name:"".concat(t.name,"_").concat(o)};e.push(n)}}return e},m=t=>{if(t.features.length<2)return;let e=t.features[0];for(let i=1;i<t.features.length;i++)e=a.G0j(e,t.features[i]);return t.features=[e],t},v=t=>{var e=(t=>{let e=[];for(let i=0;i<t.length;i++)e.push(t.charCodeAt(i));return new Uint8Array(e)})(JSON.stringify(t,null,4)),i=new Blob([e],{type:"esri/drawingTool"});let s=URL.createObjectURL(i);var o=document.createElement("a");o.setAttribute("href",s),o.setAttribute("download","scene.json");var n=document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,0,null),o.dispatchEvent(n)};class y{constructor(t){this.divHost=void 0,this.mapboxWrapper=void 0,this.scene=void 0,this.importData=t=>{new l(this.scene,t.result)},this.mouseDown=t=>{},this.mouseUp=t=>{},this.mouseDrag=t=>{},this.mouseClick=t=>{},this.mouseMove=t=>{},this.divHost=document.getElementById(t),this.divHost.style.position="relative",this.divHost.ondrop=t=>{t.preventDefault();const e=t.dataTransfer.files[0],i=new FileReader;i.onload=t=>{this.importData(t.target)},i.readAsText(e)},this.divHost.ondragover=()=>!1,this.divHost.ondragend=()=>!1,this.mapboxWrapper=new n(this.divHost.id),this.scene=new r,this.scene.map=this.mapboxWrapper.map,this.mapboxWrapper.mouseDown=this.mouseDown,this.mapboxWrapper.mouseUp=this.mouseUp,this.mapboxWrapper.mouseClick=this.mouseClick,this.mapboxWrapper.mouseMove=this.mouseMove,setTimeout((()=>{this.mapboxWrapper.map.on("load",(()=>{this.scene.initScene()}))}),100);const e=document.createElement("div");e.style.position="absolute",this.divHost.appendChild(e);const i=document.createElement("div");i.style.width="200px",i.style.height="20px",i.style.background="rgba(0, 0, 0, 0.8)",i.style.zIndex="10",i.textContent="DOWNLOAD by polygon",i.onclick=()=>{const t=this.scene.getDataScene();v(t)},e.appendChild(i);const s=document.createElement("div");s.style.width="200px",s.style.height="20px",s.style.background="rgba(0, 0, 0, 0.8)",s.style.zIndex="10",s.textContent="DOWNLOAD by feature",s.onclick=()=>{const t=this.scene.getDataScene();v(g(t))},e.appendChild(s)}keyDown(t){}destroy(){for(;this.divHost.lastElementChild;)this.divHost.removeChild(this.divHost.lastElementChild)}}const g=t=>{const e=[];for(let s=0;s<t.features.length;++s)e.push(t.features[s].geometry.coordinates);const i={features:[{geometry:{coordinates:e,type:"MultiPolygon"},type:t.features[0].type,properties:t.features[0].properties}],type:t.type,name:"".concat(t.name)};return JSON.parse(JSON.stringify(i))}}}]);
//# sourceMappingURL=62605.ba648c79.chunk.js.map