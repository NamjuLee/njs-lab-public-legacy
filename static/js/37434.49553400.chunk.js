"use strict";(self.webpackChunkNJS_Lab=self.webpackChunkNJS_Lab||[]).push([[37434],{37434:(t,i,e)=>{e.r(i),e.d(i,{Solution:()=>g});var s=e(55913);class h{constructor(t){this.img=void 0,this.rx=20,this.ry=20,this.rz=2,this.scaleArrow=.5,this.app=void 0,this.hostDiv=void 0,this.divMenu=void 0,this.divText=void 0,this.app=t,this.hostDiv=this.app.divMenu,this.initUI()}initUI(){const t=document.createElement("div");this.divMenu=t,this.hostDiv.appendChild(t),t.style.display="block",t.style.position="absolute",t.style.top="0px";const i=document.createElement("input");i.value="https://raw.githubusercontent.com/NamjuLee/data/master/img/heightMap/Heightmap_01.png",i.addEventListener("keydown",(t=>{"Enter"===t.code&&this.loadImg(i.value)})),t.appendChild(i);const e=o("rx",10,30);e.slider.defaultValue="20",t.appendChild(e.div),e.slider.oninput=()=>{const t=parseInt(e.slider.value);this.rx=t,this.update()};const s=o("ry",10,30);s.slider.defaultValue="20",t.appendChild(s.div),s.slider.oninput=()=>{const t=parseInt(s.slider.value);this.ry=t,this.update()};const h=o("rz",0,50);h.slider.defaultValue="20",t.appendChild(h.div),h.slider.oninput=()=>{const t=parseInt(h.slider.value);this.rz=.1*t,this.update()};const r=o("arrow",5,10);r.slider.defaultValue="5",t.appendChild(r.div),r.slider.oninput=()=>{const t=parseInt(r.slider.value);this.scaleArrow=.1*t,this.update()};const l=n();l.defaultChecked=!0,l.onchange=t=>{const i=t.target.checked;this.app.renderer.surfaceMesh.visible=i},t.appendChild(l);const a=document.createElement("button");a.textContent="Click here to download CSV",a.style.background="#333",a.onclick=()=>{this.app.tMap.pMap.toCSV()},t.appendChild(a),this.divText=document.createElement("div"),this.divText.textContent="",t.appendChild(this.divText)}loadImg(t){(0,s.t4)(t).then((t=>{this.img&&this.divMenu.removeChild(this.img),t.onload=i=>{this.divMenu.appendChild(t),this.img=t,this.update()}}))}update(){this.app.init(this.img)}destroy(){this.hostDiv.removeChild(this.divMenu)}}const o=(t,i,e)=>{const s=document.createElement("div");s.style.display="flex";const h=document.createElement("input");h.type="range",h.min="".concat(i),h.max="".concat(e);const o=document.createElement("div");return o.textContent=t,o.style.color="#aaa",s.appendChild(h),s.appendChild(o),{div:s,slider:h,text:o}},n=()=>{const t=document.createElement("input");return t.type="checkbox",t};class r{constructor(){this.pixelList=[],this.minV=void 0,this.maxV=void 0,this.rx=10,this.ry=10,this.rz=2,this.intervalX=void 0,this.intervalY=void 0,this.selPixel=void 0}init(t,i,e,s){this.minV=t,this.maxV=i,this.rx=e,this.ry=s,this.pixelList=[];const h=this.minV.x,o=this.minV.y;this.intervalX=(this.maxV.x-this.minV.x)/(this.rx-1),this.intervalY=(this.maxV.y-this.minV.y)/(this.ry-1);for(let n=0;n<this.ry;n++)for(let t=0;t<this.rx;t++){const i=h+t*this.intervalX,e=o+n*this.intervalY;let s=new l(this,-1*i,e,0);s.id=this.pixelList.length,s.xi=t,s.yi=n,this.pixelList.push(s)}this.initGridNeighbor()}getPixel(t,i){return this.pixelList[t+i*this.rx]}initGridNeighbor(){for(let t=0;t<this.ry;++t)for(let i=0;i<this.rx;++i){let e=i+t*this.rx,s=this.pixelList[e];i>0&&s.nPix.push(this.pixelList[e-1]),i<this.rx-1&&s.nPix.push(this.pixelList[e+1]),t>0&&s.nPix.push(this.pixelList[e-this.rx]),t<this.ry-1&&s.nPix.push(this.pixelList[e+this.rx]),i>0&&t<this.ry-1&&s.nPix.push(this.pixelList[e+this.rx-1]),i>0&&t>0&&s.nPix.push(this.pixelList[e-this.rx-1]),i<this.rx-1&&t<this.ry-1&&s.nPix.push(this.pixelList[e+this.rx+1]),i<this.rx-1&&t>0&&s.nPix.push(this.pixelList[e-this.rx+1])}}updateImage(t){const i=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});i.drawImage(t,0,0,t.width,t.height,0,0,this.rx,this.ry);const e=i.getImageData(0,0,this.rx,this.ry);for(let s=0;s<this.ry;++s)for(let t=0;t<this.rx;++t){let i=4*t+s*e.width*4,h=t+s*this.rx;this.pixelList[h].color=[e.data[i],e.data[i+1],e.data[i+2],e.data[i+3]],this.pixelList[h].vec.z=p(e.data[i]/255,e.data[i+1]/255,e.data[i+2]/255)*this.rz}}picking(t,i,e){const s=new a(t,i,e);let h=Number.MAX_VALUE,o=-1;for(let n=0;n<this.pixelList.length;++n){const t=c(this.pixelList[n].vec,s);h>t&&(h=t,o=n),this.pixelList[n].hover=!1}return this.selPixel=void 0,o>-1&&(this.pixelList[o].hover=!0,this.selPixel=this.pixelList[o]),this.selPixel}render(t){this.pixelList.forEach((i=>{i.render(t)})),this.selPixel&&this.selPixel.render(t)}onClick(t,i,e){return this.picking(t,i,e)}toCSV(){const t=[["id","location(lat, lon)","elevation","slope"]];for(let e=0;e<this.pixelList.length;++e){const i=this.pixelList[e];t.push([i.id,"".concat(i.vec.y,",").concat(i.vec.x),"".concat(i.vec.z),"".concat(i.slope)])}var i;!function(t,i,e){var s=new Blob([t],{type:e}),h=URL.createObjectURL(s),o=document.createElement("a");o.href=h,o.setAttribute("download",i),o.click()}((i=t,i.map((t=>t.map(String).map((t=>t.replaceAll('"','""'))).map((t=>'"'.concat(t,'"'))).join(","))).join("\r\n")),"terrainSlopeAnalysis.csv","text/csv;charset=utf-8;")}}class l{constructor(t,i,e,s){this.id=0,this.slope=[],this.nPixString=[],this.xi=void 0,this.yi=void 0,this.pMap=void 0,this.vec=void 0,this.hover=!1,this.nPix=[],this.color=[],this.mesh=void 0,this.arrow=[],this.pMap=t,this.vec=new a(i,e,s)}onClick(){}render(t){const i=this.pMap.intervalX,e=this.pMap.intervalY;if(t.beginPath(),t.rect(this.vec.x-.5*i,this.vec.y-.5*e,i,e),t.closePath(),t.stroke(),this.hover?(t.fillStyle="#555",t.fill()):(t.fillStyle="rgba(".concat(this.color[0],", ").concat(this.color[1],", ").concat(this.color[2],", ").concat(this.color[3],")"),t.fill()),t.beginPath(),t.arc(this.vec.x,this.vec.y,this.vec.r,0,2*Math.PI),t.closePath(),this.hover?t.fillStyle="#999":t.fillStyle="#333",t.fill(),this.hover){for(let i=0;i<this.nPix.length;++i)t.beginPath(),t.moveTo(this.vec.x,this.vec.y),t.lineTo(this.nPix[i].vec.x,this.nPix[i].vec.y),t.closePath(),t.stroke();t.strokeText("x: ".concat(this.xi,", y: ").concat(this.yi),this.vec.x,this.vec.y)}}}class a{constructor(t,i,e){this.x=0,this.y=0,this.z=0,this.r=3,this.x=t,this.y=i,this.z=e}}const c=(t,i)=>Math.sqrt(d(t,i)),d=(t,i)=>(t.x-i.x)*(t.x-i.x)+(t.y-i.y)*(t.y-i.y)+(t.z-i.z)*(t.z-i.z),p=(t,i,e)=>.2126*t+.7152*i+.0722*e;var v=e(17760),u=e(98925);class m{constructor(t){this.canvas=void 0,this.hostDiv=void 0,this.ctx=void 0,this.t=0,this.camera=void 0,this.scene=void 0,this.renderer=void 0,this.controls=void 0,this.requestFrame=void 0,this.loop=()=>{this.requestFrame=requestAnimationFrame(this.loop),this.controls.update(),this.update(this.scene),this.renderer.render(this.scene,this.camera),this.t+=.01},this.hostDiv=document.getElementById(t),this.initCanvas()}initCanvas(){v.Tme.DEFAULT_UP.set(0,0,1),this.scene=new v.xsS,this.scene.castShadow=!0,this.renderer=new v.CP7({antialias:!0,alpha:!0}),this.renderer.setPixelRatio(this.hostDiv.clientWidth/this.hostDiv.clientHeight),this.renderer.domElement.id="Three",this.renderer.domElement.style.position="absolute",this.renderer.shadowMap.enabled=!0,this.renderer.setSize(this.hostDiv.clientWidth,this.hostDiv.clientHeight),this.hostDiv.appendChild(this.renderer.domElement),this.camera=new v.cPb(30,this.hostDiv.clientWidth/this.hostDiv.clientHeight,1,5e3),this.controls=new u.OrbitControls(this.camera,this.renderer.domElement),this.camera.position.set(0,0,0),this.controls.update(),this.canvas=this.renderer.domElement,this.init()}init(){this.eventBind()}eventBind(){this.renderer.domElement.onmousedown=t=>this.mouseDown(t),this.renderer.domElement.onmouseup=t=>this.mouseUp(t),this.renderer.domElement.onmousemove=t=>this.mouseMove(t),this.renderer.domElement.addEventListener("click",(t=>this.mouseClick(t))),window.addEventListener("resize",(()=>this.onWindowResize()))}onWindowResize(){this.camera.aspect=this.hostDiv.clientWidth/this.hostDiv.clientHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.hostDiv.clientWidth,this.hostDiv.clientHeight)}start(){this.loop()}mouseDown(t){}mouseUp(t){}mouseClick(t){}mouseDClick(t){}mouseMove(t){}mouseDrag(t){}update(t){}destroy(){for(window.removeEventListener("resize",(()=>this.onWindowResize())),cancelAnimationFrame(this.requestFrame),this.requestFrame=void 0;this.hostDiv.lastChild;)this.hostDiv.removeChild(this.hostDiv.lastChild)}}class x extends m{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"main"),this.canvas=void 0,this.pointLight=void 0,this.rayCaster=new v.iMs,this.mouse2=new v.FM8,this.mouse3=void 0,this.sphere=void 0,this.surfaceMesh=void 0,this.preSelection=void 0,this.meshList=[],this.arrowList=[],this.buildMeshByImg=t=>{const i=t.rx,e=t.ry,s=[];for(let l=0;l<e;++l)for(let e=0;e<i;++e){const i=t.getPixel(e,l);s.push(i.vec.x,i.vec.y,i.vec.z)}const h=[];for(let l=0;l<e-1;++l)for(let t=0;t<i-1;++t){let e=t+l*i;h.push(e,e+i,e+1),h.push(e+1,e+i,e+i+1)}const o=new v.RSm({vertexColors:!0,flatShading:!1}),n=new v.u9r;n.setIndex(h),n.setAttribute("position",new v.a$l(s,3)),n.computeVertexNormals(),n.computeBoundingBox();const r=new v.Kj0(n,o);this.surfaceMesh=r,this.meshList.push(r),this.scene.add(r)},this.pointLight=new v.cek(16777215,.75),this.pointLight.position.x=80,this.pointLight.position.z=80,this.scene.add(this.pointLight),this.canvas=document.createElement("canvas"),this.hostDiv.append(this.canvas),this.renderer.setClearColor(0,0),this.scene.background=null,this.camera.position.set(0,-80,80);const t=new v.vBJ({color:65280}),i=new v.xo$(.05,50,50),e=new v.Kj0(i,t);e.translateX(1),this.sphere=e,this.scene.add(e),this.start()}reset(){this.scene.remove(...this.meshList),this.meshList=[],this.scene.remove(...this.arrowList),this.arrowList=[],this.preSelection=void 0}buildPoint(t){for(let i=0;i<t.pixelList.length;++i){const e=t.pixelList[i].vec,s=t.pixelList[i].color,h=new v.xo$(.15,8,8),o=new v.vBJ({color:new v.Ilk(s[0]/255,s[1]/255,s[2]/255)}),n=new v.Kj0(h,o);n.userData.pixel=t.pixelList[i],t.pixelList[i].mesh=n,this.meshList.push(n),n.position.set(e.x,e.y,e.z),this.scene.add(n)}}mouseClick(t){const i=y(t,this.meshList,this.renderer,this.camera,this.rayCaster,this.mouse2);if(i){if(this.preSelection){const t=this.preSelection.material;t.color&&t.color.setRGB(this.preSelection.userData.pixel.color[0]/255,this.preSelection.userData.pixel.color[1]/255,this.preSelection.userData.pixel.color[2]/255)}this.mouse3=new v.Pa4(i.mouse3.x,i.mouse3.y,i.mouse3.z),this.sphere.position.set(this.mouse3.x,this.mouse3.y,this.mouse3.z),this.onClickBind(this.mouse3.x,this.mouse3.y,this.mouse3.z);const t=i.mesh[0].object,e=t.material;return e.color&&e.color.setHex(16711680),void(this.preSelection=t)}this.mouse3=void 0}onClickBind(t,i,e){}buildArrow(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.25;const e=.0075;for(let s=0;s<t.pixelList.length;++s){const h=t.pixelList[s],o=new v.Pa4(h.vec.x,h.vec.y,h.vec.z+e);h.arrow=[];for(let t=0;t<h.nPix.length;++t){const s=h.nPix[t],n=new v.Pa4(s.vec.x-h.vec.x,s.vec.y-h.vec.y,s.vec.z+e-h.vec.z+e);n.normalize();const r=n.z,l=r<=0?Math.abs(r):0,a=0,c=r>0?Math.abs(r):0;h.slope.push("id:".concat(s.id,"; value:").concat(r));const d=new v.tGC(n,o,i,new v.Ilk(l,a,c));h.arrow.push(d),this.arrowList.push(d),this.scene.add(d)}}}}const y=(t,i,e,s,h,o)=>{o.x=t.offsetX/e.domElement.clientWidth*2-1,o.y=-t.offsetY/e.domElement.clientHeight*2+1,h.setFromCamera(o,s);const n=h.intersectObjects([...i]);if(n.length>0)return{mesh:n,mouse3:new v.Pa4(n[0].point.x,n[0].point.y,n[0].point.z)}};class g{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"main";this.controller=void 0,this.renderer=void 0,this.canvas=void 0,this.divMain=void 0,this.divMenu=void 0,this.tMap=void 0;const i=document.getElementById(t);this.divMain=i;const e=document.createElement("div");this.divMenu=e,e.style.height="50px",e.style.position="absolute",e.style.backgroundColor="#f00",e.style.zIndex="1",i.append(e),this.controller=new h(this);const s=document.createElement("div");s.id="pMap",s.style.width="100%",s.style.height="100%",i.append(s),this.renderer=new x(s.id),this.tMap=new w(this),this.controller.loadImg("https://raw.githubusercontent.com/NamjuLee/data/master/img/heightMap/Heightmap_03.jpg")}init(t){this.tMap.init(t)}destroy(){this.renderer.destroy();try{for(;void 0!==this.divMain&&void 0!==this.divMain.lastElementChild;)this.divMain.removeChild(this.divMain.lastElementChild)}catch(t){}}}class w{constructor(t){this.solution=void 0,this.pMap=void 0,this.solution=t}init(t){this.pMap=new r,this.pMap.rx=this.solution.controller.rx,this.pMap.ry=this.solution.controller.ry,this.pMap.rz=this.solution.controller.rz,this.pMap.init(new a(10,10,0),new a(-10,-10,0),this.pMap.rx,this.pMap.ry),this.solution.renderer.reset(),this.pMap.updateImage(t),this.solution.renderer.buildPoint(this.pMap),this.solution.renderer.buildMeshByImg(this.pMap),this.solution.renderer.buildArrow(this.pMap,this.solution.controller.scaleArrow),this.solution.renderer.onClickBind=(t,i,e)=>{const s=this.pMap.onClick(t,i,e);s.onClick(),this.solution.controller.divText.textContent="Elevation: ".concat(s.vec.z,", Col: ").concat(s.color)}}}}}]);
//# sourceMappingURL=37434.49553400.chunk.js.map