"use strict";(self.webpackChunkNJS_Lab=self.webpackChunkNJS_Lab||[]).push([[60944],{89739:(t,i,e)=>{e.d(i,{Du:()=>s});const s=(t,i,e)=>{const s=document.createElement("div");s.style.display="flex";const n=document.createElement("input");n.type="range",n.min="".concat(i),n.max="".concat(e);const o=document.createElement("div");return o.textContent=t,o.style.color="#aaa",s.appendChild(n),s.appendChild(o),{div:s,slider:n,text:o}}},60944:(t,i,e)=>{e.r(i),e.d(i,{Solution:()=>m});const s=new Float32Array([0,.5,0,-.5,-.5,0,.5,-.5,0]);class n{constructor(t){this.solution=void 0,this.canvas=void 0,this.ctx=void 0,this.device=void 0,this.format=void 0,this.size=void 0,this.commandEncoder=void 0,this.view=void 0,this.renderPassDescriptor=void 0,this.passEncoder=void 0,this.uniformBuffer=void 0,this.requestAni=void 0,this.loop=()=>{this.solution.scene.render(),this.requestAni=requestAnimationFrame(this.loop)},this.solution=t,this.canvas=t.canvas}async initWebGPU(){if(!navigator.gpu)throw new Error("Not Support WebGPU");const t=await navigator.gpu.requestAdapter({powerPreference:"high-performance"});if(!t)throw new Error("No Adapter Found");const i=await t.requestDevice();this.ctx=this.canvas.getContext("webgpu");const e=navigator.gpu.getPreferredCanvasFormat?navigator.gpu.getPreferredCanvasFormat():this.ctx.getPreferredFormat(t);window.devicePixelRatio;this.canvas.width=this.canvas.clientWidth,this.canvas.height=this.canvas.clientHeight,this.ctx.configure({device:i,format:e,alphaMode:"opaque"}),this.size={width:this.canvas.width,height:this.canvas.height},this.device=i,this.format=e,this.loop()}draw(t){void 0!==t&&(this.solution.camera.update(),this.commandEncoder=this.device.createCommandEncoder(),this.view=this.ctx.getCurrentTexture().createView(),this.renderPassDescriptor={colorAttachments:[{view:this.view,clearValue:{r:0,g:0,b:0,a:1},loadOp:"clear",storeOp:"store"}]},this.passEncoder=this.commandEncoder.beginRenderPass(this.renderPassDescriptor),this.passEncoder.setPipeline(t.pipeline),this.passEncoder.setBindGroup(0,t.uniformGroup),this.passEncoder.setVertexBuffer(0,t.vertexBuffer),this.passEncoder.draw(3),this.passEncoder.end(),this.device.queue.submit([this.commandEncoder.finish()]))}destroy(){this.device.destroy(),cancelAnimationFrame(this.requestAni)}}var o=e(88679);class r{constructor(){this.pipeline=void 0}}class a extends r{constructor(t){super(),this.scene=void 0,this.vertex=new Float32Array([0,.1,0,-.5,-.5,0,.5,-.5,0]),this.vertexCount=3,this.position=o.al(0,0,0),this.scene=t,this.position[0]=.5;const i=Math.random();this.vertex[1]+=i,this.initPipeline(this.scene.solution.renderer.device,this.scene.solution.renderer.format)}async initPipeline(t,i){const e=await t.createRenderPipelineAsync({label:"Basic Pipline",layout:"auto",vertex:{module:t.createShaderModule({code:"\n@vertex\nfn main(@location(0) position : vec3<f32>) -> @builtin(position) vec4<f32> {\n    return vec4<f32>(position, 1.0);\n}\n"}),entryPoint:"main",buffers:[{arrayStride:12,attributes:[{shaderLocation:0,offset:0,format:"float32x3"}]}]},fragment:{module:t.createShaderModule({code:"\n@group(0) @binding(0) var<uniform> color : vec4<f32>;\n\n@fragment\nfn main() -> @location(0) vec4<f32> {\n    return color;\n}"}),entryPoint:"main",targets:[{format:i}]},primitive:{topology:"triangle-list"}}),s=t.createBuffer({label:"GPUBuffer store vertex",size:this.vertex.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST});t.queue.writeBuffer(s,0,this.vertex);const n=t.createBuffer({label:"GPUBuffer store rgba color",size:16,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});t.queue.writeBuffer(n,0,new Float32Array([1,0,0,1]));const o=t.createBindGroup({label:"Uniform Group with colorBuffer",layout:e.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:n}}]});this.pipeline={pipeline:e,vertexBuffer:s,colorBuffer:n,uniformGroup:o},this.scene.geometries.push(this)}}class h{constructor(t){this.solution=void 0,this.geometries=[],this.index=0,this.solution=t}init(){this.geometries.push(new a(this))}render(){for(this.index=0;this.index<this.geometries.length;++this.index)this.solution.renderer.draw(this.geometries[this.index].pipeline);console.log("rendering...",this.geometries.length)}}class c{constructor(t){this.solution=void 0,this.solution=t,this.appendEvent()}appendEvent(){this.solution.divHost.addEventListener("mousedown",(t=>{console.log(t),this.solution.controller.addTri()}))}}class d{constructor(t){this.solution=void 0,this.solution=t}addTri(){new a(this.solution.scene)}}var v=e(89739);class u{constructor(t){this.divHost=void 0,this.solution=void 0,this.divColor=void 0,this.divRange=void 0,this.solution=t,this.divHost=t.divHost,this.divColor=document.createElement("input"),this.divColor.type="color",this.divColor.defaultValue="#ff0000",this.divHost.appendChild(this.divColor),this.divRange=(0,v.Du)("size",0,100),this.divHost.appendChild(this.divRange.div),this.appendEvent()}appendEvent(){this.divColor.addEventListener("input",(t=>{const i=t.target.value;i.slice(1,3),i.slice(3,5),i.slice(5,7)})),this.divRange.slider.addEventListener("input",(t=>{const i=+t.target.value;console.log(i),s[0]=0,s[3]=-.01*i-.5,s[6]=.5+.01*i})),window.addEventListener("resize",(()=>{this.solution.canvas.width=this.solution.divHost.clientWidth,this.solution.canvas.height=this.solution.divHost.clientHeight}))}}var l=e(39880);const p=e(27089);class f{constructor(t){this.solution=void 0,this.canvas=void 0,this.modelMatrix=void 0,this.mvpMatrix=void 0,this.vMatrix=void 0,this.vpMatrix=void 0,this.rotation=o.al(0,0,0),this.translation=o.al(0,0,0),this.camera=void 0,this.vp=void 0,this.solution=t,this.canvas=t.canvas,this.modelMatrix=l.Ue(),this.mvpMatrix=l.Ue(),this.vMatrix=l.Ue(),this.vpMatrix=l.Ue(),this.vp=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[2,2,4],e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0,0],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[0,1,0];const n=l.Ue(),o=l.Ue(),r=l.Ue();return l.G3(o,2*Math.PI/5,t,.1,100),l.zB(n,i,e,s),l.Jp(r,o,n),{viewMatrix:n,projectionMatrix:o,viewProjectionMatrix:r,cameraOption:{eye:i,center:e,zoomMax:100,zoomSpeed:2}}}(this.canvas.width/this.canvas.height),this.vpMatrix=this.vp.viewProjectionMatrix,this.camera=p(this.canvas,this.vp.cameraOption)}update(){const t=this.vp.projectionMatrix;this.vMatrix=this.camera.matrix,l.Jp(this.vpMatrix,t,this.vMatrix),function(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0,0],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1];const n=l.Ue(),o=l.Ue(),r=l.Ue(),a=l.Ue(),h=l.Ue();l.vc(a,i),l.aC(n,e[0]),l.gT(o,e[1]),l.QO(r,e[2]),l.xJ(h,s),l.Jp(t,n,h),l.Jp(t,o,t),l.Jp(t,r,t),l.Jp(t,a,t)}(this.modelMatrix,this.translation,this.rotation),l.Jp(this.mvpMatrix,this.vpMatrix,this.modelMatrix)}}class m{constructor(t){this.divHost=void 0,this.canvas=void 0,this.scene=void 0,this.renderer=void 0,this.camera=void 0,this.ui=void 0,this.eventListener=void 0,this.controller=void 0,this.init=async()=>{this.camera=new f(this),this.scene=new h(this),this.ui=new u(this),this.eventListener=new c(this),this.controller=new d(this),this.renderer=new n(this),await this.initRenderer(),this.scene.init(),this.initPost()},this.initRenderer=async()=>this.renderer.initWebGPU(),this.divHost=document.getElementById(t),this.divHost.style.position="relative",this.canvas=document.createElement("canvas"),this.divHost.appendChild(this.canvas),this.canvas.width=this.divHost.clientWidth,this.canvas.height=this.divHost.clientHeight,this.canvas.style.background="rgba(0,0,0,0)",this.init()}initPost(){}destroy(){for(this.renderer.destroy();this.divHost.lastElementChild;)this.divHost.removeChild(this.divHost.lastElementChild)}}},88679:(t,i,e)=>{e.d(i,{$X:()=>a,EU:()=>x,Fv:()=>d,IH:()=>r,Ue:()=>n,VC:()=>p,al:()=>o,fF:()=>u,jI:()=>g,kC:()=>v,kK:()=>l,lM:()=>f,lu:()=>w,od:()=>h,tk:()=>c,uD:()=>m});var s=e(50907);function n(){var t=new s.WT(3);return s.WT!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function o(t,i,e){var n=new s.WT(3);return n[0]=t,n[1]=i,n[2]=e,n}function r(t,i,e){return t[0]=i[0]+e[0],t[1]=i[1]+e[1],t[2]=i[2]+e[2],t}function a(t,i,e){return t[0]=i[0]-e[0],t[1]=i[1]-e[1],t[2]=i[2]-e[2],t}function h(t,i,e,s){return t[0]=i[0]+e[0]*s,t[1]=i[1]+e[1]*s,t[2]=i[2]+e[2]*s,t}function c(t,i){return t[0]=-i[0],t[1]=-i[1],t[2]=-i[2],t}function d(t,i){var e=i[0],s=i[1],n=i[2],o=e*e+s*s+n*n;return o>0&&(o=1/Math.sqrt(o)),t[0]=i[0]*o,t[1]=i[1]*o,t[2]=i[2]*o,t}function v(t,i,e){var s=i[0],n=i[1],o=i[2],r=e[0],a=e[1],h=e[2];return t[0]=n*h-o*a,t[1]=o*r-s*h,t[2]=s*a-n*r,t}function u(t,i,e){var s=i[0],n=i[1],o=i[2],r=e[3]*s+e[7]*n+e[11]*o+e[15];return r=r||1,t[0]=(e[0]*s+e[4]*n+e[8]*o+e[12])/r,t[1]=(e[1]*s+e[5]*n+e[9]*o+e[13])/r,t[2]=(e[2]*s+e[6]*n+e[10]*o+e[14])/r,t}function l(t,i,e){var s=i[0],n=i[1],o=i[2];return t[0]=s*e[0]+n*e[3]+o*e[6],t[1]=s*e[1]+n*e[4]+o*e[7],t[2]=s*e[2]+n*e[5]+o*e[8],t}function p(t,i,e){var s=e[0],n=e[1],o=e[2],r=e[3],a=i[0],h=i[1],c=i[2],d=n*c-o*h,v=o*a-s*c,u=s*h-n*a,l=n*u-o*v,p=o*d-s*u,f=s*v-n*d,m=2*r;return d*=m,v*=m,u*=m,l*=2,p*=2,f*=2,t[0]=a+d+l,t[1]=h+v+p,t[2]=c+u+f,t}function f(t,i,e,s){var n=[],o=[];return n[0]=i[0]-e[0],n[1]=i[1]-e[1],n[2]=i[2]-e[2],o[0]=n[0],o[1]=n[1]*Math.cos(s)-n[2]*Math.sin(s),o[2]=n[1]*Math.sin(s)+n[2]*Math.cos(s),t[0]=o[0]+e[0],t[1]=o[1]+e[1],t[2]=o[2]+e[2],t}function m(t,i,e,s){var n=[],o=[];return n[0]=i[0]-e[0],n[1]=i[1]-e[1],n[2]=i[2]-e[2],o[0]=n[2]*Math.sin(s)+n[0]*Math.cos(s),o[1]=n[1],o[2]=n[2]*Math.cos(s)-n[0]*Math.sin(s),t[0]=o[0]+e[0],t[1]=o[1]+e[1],t[2]=o[2]+e[2],t}function g(t,i,e,s){var n=[],o=[];return n[0]=i[0]-e[0],n[1]=i[1]-e[1],n[2]=i[2]-e[2],o[0]=n[0]*Math.cos(s)-n[1]*Math.sin(s),o[1]=n[0]*Math.sin(s)+n[1]*Math.cos(s),o[2]=n[2],t[0]=o[0]+e[0],t[1]=o[1]+e[1],t[2]=o[2]+e[2],t}function x(t,i){var e=t[0],s=t[1],n=t[2],o=i[0],r=i[1],a=i[2],h=Math.sqrt(e*e+s*s+n*n)*Math.sqrt(o*o+r*r+a*a),c=h&&function(t,i){return t[0]*i[0]+t[1]*i[1]+t[2]*i[2]}(t,i)/h;return Math.acos(Math.min(Math.max(c,-1),1))}var w=a;!function(){var t=n()}()}}]);
//# sourceMappingURL=60944.1e8bd636.chunk.js.map