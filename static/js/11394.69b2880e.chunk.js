"use strict";(self.webpackChunkNJS_Lab=self.webpackChunkNJS_Lab||[]).push([[11394],{11394:(t,e,i)=>{i.r(e),i.d(e,{Renderer:()=>p,Solution:()=>f});const s=(t,e,i,s,l,o,n,d)=>{let a=l*s*(o-2)*(o-2);h(t,e,i,a,1+6*a,o,n,d)},h=(t,e,i,s,h,o,n,a)=>{let r=1/h;for(let c=0;c<n;c++){for(let t=1;t<o-1;t++)for(let h=1;h<o-1;h++)e[l(h,t,o)]=(i[l(h,t,o)]+s*(e[l(h+1,t,o)]+e[l(h-1,t,o)]+e[l(h,t+1,o)]+e[l(h,t-1,o)]))*r;d(t,e,o,a)}},l=(t,e,i)=>t+e*i,o=(t,e,i,s,o,n,a)=>{for(let h=1;h<o-1;h++)for(let n=1;n<o-1;n++)s[l(n,h,o)]=-.5*(t[l(n+1,h,o)]-t[l(n-1,h,o)]+e[l(n,h+1,o)]-e[l(n,h-1,o)])/o,i[l(n,h,o)]=0;d(0,s,o,a),d(0,i,o,a),h(0,i,s,1,6,o,n,a);for(let h=1;h<o-1;h++)for(let s=1;s<o-1;s++)t[l(s,h,o)]-=.5*(i[l(s+1,h,o)]-i[l(s-1,h,o)])*o,e[l(s,h,o)]-=.5*(i[l(s,h+1,o)]-i[l(s,h-1,o)])*o;d(1,t,o,a),d(2,e,o,a)},n=(t,e,i,s,h,o,n,a)=>{let r,c,u,m,f,p,y,v,g,x,C,N,M,E,w,L,S=o*(n-2),b=o*(n-2),V=n-2;for(L=1,E=1;L<n-1;L++,E++)for(w=1,M=1;w<n-1;w++,M++){g=S*s[l(w,L,n)],x=b*h[l(w,L,n)],C=M-g,N=E-x,C<.5&&(C=.5),C>V+.5&&(C=V+.5),r=Math.floor(C),c=r+1,N<.5&&(N=.5),N>V+.5&&(N=V+.5),u=Math.floor(N),m=u+1,p=C-r,f=1-p,v=N-u,y=1-v;let t=r,o=c,d=u,a=m;e[l(w,L,n)]=f*(y*i[l(t,d,n)]+v*i[l(t,a,n)])+p*(y*i[l(o,d,n)]+v*i[l(o,a,n)])}d(t,e,n,a)},d=(t,e,i,s)=>{for(let h=1;h<i-1;h++)e[l(h,0,i)]=2===t?-e[l(h,1,i)]:e[l(h,1,i)],e[l(h,i-1,i)]=2===t?-e[l(h,i-2,i)]:e[l(h,i-2,i)];for(let h=1;h<i-1;h++)e[l(0,h,i)]=1===t?-e[l(1,h,i)]:e[l(1,h,i)],e[l(i-1,h,i)]=1===t?-e[l(i-2,h,i)]:e[l(i-2,h,i)];e[l(0,0,i)]=.5*(e[l(1,0,i)]+e[l(0,1,i)]),e[l(0,i-1,i)]=.5*(e[l(1,i-1,i)]+e[l(0,i-2,i)]),e[l(i-1,0,i)]=.5*(e[l(i-2,0,i)]+e[l(i-1,1,i)]),e[l(i-1,i-1,i)]=.5*(e[l(i-2,i-1,i)]+e[l(i-1,i-2,i)]),e[l(Math.floor(.5*i),0,i)]=0,e[l(Math.floor(.5*i),1,i)]=0,e[l(Math.floor(.5*i),2,i)]=0,e[l(Math.floor(.5*i),3,i)]=0,e[l(Math.floor(.5*i),4,i)]=0,e[l(Math.floor(.5*i),5,i)]=0,e[l(Math.floor(.5*i),6,i)]=0,e[l(Math.floor(.5*i),7,i)]=0,e[l(Math.floor(.5*i),i-1,i)]=0,e[l(Math.floor(.5*i),i-2,i)]=0,e[l(Math.floor(.5*i),i-3,i)]=0,e[l(Math.floor(.5*i),i-4,i)]=0,e[l(Math.floor(.5*i),i-5,i)]=0,e[l(Math.floor(.5*i),i-6,i)]=0,e[l(Math.floor(.5*i),i-7,i)]=0,e[l(Math.floor(.5*i),i-8,i)]=0;for(let h=0;h<s.length;++h)e[l(s[h][0],s[h][1],i)]=0};var a=i(87968);class r{constructor(t,e,i){this.N=100,this.iter=16,this.SCALE=4,this.t=0,this.visScale=.01,this.dt=void 0,this.diff=void 0,this.visc=void 0,this.s=void 0,this.density=void 0,this.Vx=void 0,this.Vy=void 0,this.Vx0=void 0,this.Vy0=void 0,this.cellFixed=[],this.dt=t,this.diff=e,this.visc=i,this.s=new Float32Array(this.N*this.N).fill(0),this.density=new Float32Array(this.N*this.N).fill(.01),this.Vx=new Float32Array(this.N*this.N).fill(0),this.Vx0=new Float32Array(this.N*this.N).fill(0),this.Vy=new Float32Array(this.N*this.N).fill(0),this.Vy0=new Float32Array(this.N*this.N).fill(0)}step(){let t=this.visc,e=this.diff,i=this.dt,h=this.Vx,l=this.Vy,d=this.Vx0,a=this.Vy0,r=this.s,c=this.density;s(1,d,h,t,i,this.N,this.iter,this.cellFixed),s(2,a,l,t,i,this.N,this.iter,this.cellFixed),o(d,a,h,l,this.N,this.iter,this.cellFixed),n(1,h,d,d,a,i,this.N,this.cellFixed),n(2,l,a,d,a,i,this.N,this.cellFixed),o(h,l,d,a,this.N,this.iter,this.cellFixed),s(0,r,c,e,i,this.N,this.iter,this.cellFixed),n(0,c,r,h,l,i,this.N,this.cellFixed)}addDensity(t,e,i){let s=l(t,e,this.N);this.density[s]+=i}addVelocity(t,e,i,s){let h=l(t,e,this.N);this.Vx[h]+=i,this.Vy[h]+=s}renderD(t){for(let e=0;e<this.N;e++)for(let i=0;i<this.N;i++){let s=e*this.SCALE,h=i*this.SCALE,o=this.density[l(e,i,this.N)];if(0===o)t.fillStyle="rgb(255, 255, 255)";else{const e=(0,a.getFalseColor)(o*this.visScale);t.fillStyle="rgb(".concat(e[0],", ").concat(e[1],",").concat(e[2],")")}t.beginPath(),t.rect(s,h,this.SCALE,this.SCALE),t.fill(),t.lineWidth=.2,t.strokeStyle="#ff0000"}}renderV(t){for(let e=0;e<this.N;e++)for(let i=0;i<this.N;i++){let s=e*this.SCALE,h=i*this.SCALE,o=this.Vx[l(e,i,this.N)],n=this.Vy[l(e,i,this.N)];Math.abs(o)<.1&&Math.abs(n)<=.1||(t.lineWidth=2,t.beginPath(),t.moveTo(s,h),t.lineTo(s+o*this.SCALE,h+n*this.SCALE),t.stroke())}}}var c=i(55913);class u{constructor(t,e){let i;this.divText=void 0,this.mouse=void 0,this.pts=void 0,this.fluid=void 0,this.t=0,this.vecs=[],this.emmiters=[],this.xx=1,this.yy=1,this.img=void 0,this.activated=!1,this.showVec=!1,this.url="",this.init(),this.initUI(e),i="https://raw.githubusercontent.com/NamjuLee/data/master/img/Boston_02.jpg",this.importImg("https://raw.githubusercontent.com/NamjuLee/data/master/img/Boston_02.jpg")}importImg(t){this.url=t,(0,c.t4)(t).then((t=>{this.img=t,t.onload=()=>{const t=document.createElement("canvas").getContext("2d");if(t){t.drawImage(this.img,0,0,this.fluid.N,this.fluid.N);const e=t.getImageData(0,0,this.fluid.N,this.fluid.N);if(e)for(let t=0;t<this.fluid.N;++t)for(let i=0;i<this.fluid.N;++i){e.data[4*(i+this.fluid.N*t)]<200&&this.fluid.cellFixed.push([i,t])}}},this.init()}))}initUI(t){((t,e)=>{let i=document.createElement("div");i.style.position="absolute",t.appendChild(i);let s=document.createElement("button");s.textContent="Reset",s.style.width="60px",s.style.height="20px",s.onclick=()=>{e.init()},i.appendChild(s);let h=document.createElement("div"),l=document.createElement("input");l.value="https://raw.githubusercontent.com/NamjuLee/data/master/img/building%20footprint.jpg",l.addEventListener("keydown",(t=>{"Enter"===t.code&&e.importImg(l.value)})),h.appendChild(l),i.appendChild(h);let o=document.createElement("div");o.innerHTML="time",o.style.height="50px",o.style.width="100px",i.appendChild(o);let n=document.createElement("input");n.type="range",n.min="0.0001",n.max="0.7",n.step="0.0001",n.oninput=()=>{const t=+n.value;e.fluid.dt=t},o.appendChild(n);let d=document.createElement("div");d.innerHTML="Vis Scale",d.style.height="50px",d.style.width="100px",i.appendChild(d);let a=document.createElement("input");a.type="range",a.min="0.000001",a.max="0.8",a.step="0.00001",a.oninput=()=>{const t=+a.value;e.fluid.visScale=t},d.appendChild(a);const r=document.createElement("div");r.innerHTML="Viscosity",r.style.height="50px",r.style.width="100px",i.appendChild(r);const c=document.createElement("input");c.type="range",c.min="0.000000",c.max="0.0001",c.step="0.0000001",c.oninput=()=>{const t=+c.value;e.fluid.visc=t},r.appendChild(c);const u=document.createElement("div");u.innerHTML="rotation",u.style.height="50px",u.style.width="100px",i.appendChild(u);const m=document.createElement("input");m.type="range",m.min="0.000000",m.max="360",m.step="0.0000001",m.oninput=()=>{const t=+m.value;e.rotation(t)},u.appendChild(m);const f=document.createElement("div");f.innerHTML="rotation",f.style.height="50px",f.style.width="100px",e.divText=f,i.appendChild(f);const p=document.createElement("div");p.innerHTML="Show Vec",p.style.height="50px",p.style.width="100px",i.appendChild(p);const y=document.createElement("input");y.type="checkbox",y.onchange=()=>{e.showVec=!e.showVec},p.appendChild(y);const v=document.createElement("button");v.innerHTML="Json",v.style.height="20px",v.style.width="50px",v.onclick=()=>{e.toJson()},i.appendChild(v);const g=document.createElement("button");g.innerHTML="obj",g.style.height="20px",g.style.width="50px",g.onclick=()=>{e.toObj()},i.appendChild(g);const x=document.createElement("button");x.innerHTML="png",x.style.height="20px",x.style.width="50px",x.onclick=()=>{e.toPng()},i.appendChild(x);const C=document.createElement("div");C.innerHTML="Ref:<br>Fluid Simulation <br>By Daniel Shiffman",C.style.height="50px",C.style.width="300px",C.style.fontSize="14px",i.appendChild(C)})(t,this),this.emmiters.push([Math.floor(.5*this.fluid.N),Math.floor(.5*this.fluid.N)])}init(){this.fluid=new r(.02,0,1e-7),this.emmiters=[],this.emmiters.push([Math.floor(.5*this.fluid.N),Math.floor(.5*this.fluid.N)]),this.activated=!0}render(t){this.activated&&this.RenderIndependentCanvas(t)}RenderIndependentCanvas(t){for(let e=0;e<this.emmiters.length;++e){let t=this.emmiters[e][0],i=this.emmiters[e][1];for(let e=-1;e<=1;e++)for(let s=-1;s<=1;s++)this.fluid.addDensity(t+e,i+s,5*Math.random())}for(let e=0;e<this.emmiters.length;++e){let t=this.emmiters[e][0],i=this.emmiters[e][1];for(let e=0;e<2;e++)this.fluid.addVelocity(t,i,this.xx,this.yy)}this.fluid.step(),this.fluid.renderD(t),this.showVec&&this.fluid.renderV(t)}mouseClick(t,e){const i=Math.floor(t/this.fluid.SCALE),s=Math.floor(e/this.fluid.SCALE);this.emmiters.push([i,s])}mouseDrag(t,e){const i=Math.floor(t/this.fluid.SCALE),s=Math.floor(e/this.fluid.SCALE);this.fluid.cellFixed.push([i,s])}rotation(t){const e=t*Math.PI/180;this.xx=Math.cos(e),this.yy=Math.sin(e)}mouseMove(t,e){const i=Math.floor(t/this.fluid.SCALE),s=Math.floor(e/this.fluid.SCALE),h=this.fluid.density[i+s*this.fluid.N];h&&(this.divText.innerHTML="".concat(h))}toJson(){const t=[];for(let e=0;e<this.fluid.N;e++)for(let i=0;i<this.fluid.N;i++){let s=this.fluid.density[l(e,i,this.fluid.N)],h=e*this.fluid.SCALE,o=i*this.fluid.SCALE;t.push({x:h,y:o,density:s})}m(JSON.stringify(t))}toPng(){}toObj(){}}const m=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"download";const i=document.createElement("a");i.href="data:application/json;charset=utf-8,"+encodeURIComponent(t),i.download="".concat(e),i.click()};class f{constructor(t){this.divHost=void 0,this.renderer=void 0,this.divHost=document.getElementById(t),this.divHost.style.display="flex",this.divHost.style.alignItems="center";const e=document.createElement("div");e.style.marginLeft="auto",e.style.marginRight="auto",e.style.backgroundColor="rgba(0,0,0,0.1)",e.style.width="100%",e.style.height="600px",e.style.display="flex",this.divHost.appendChild(e);const i=document.createElement("div");i.style.marginLeft="auto",i.style.marginRight="auto",i.style.width="200px",i.style.height="600px",i.style.marginLeft="50px",e.appendChild(i);const s=document.createElement("div");s.style.marginLeft="auto",s.style.marginRight="auto",s.style.width="100%",s.style.height="600px",e.appendChild(s),this.renderer=new p(s,i)}destroy(){for(;this.divHost.lastElementChild;)this.divHost.removeChild(this.divHost.lastElementChild)}}class p extends c.bb{constructor(t,e){super(t),this.fluidSystem=void 0,this.canvas.style.position="relative",this.canvas.style.width="100%",this.canvas.style.height="100%",this.fluidSystem=new u(t,e),this.start()}render(t){this.fluidSystem.render(t)}mouseClick(t,e){this.fluidSystem.mouseClick(t,e)}mouseDrag(t,e){this.fluidSystem.mouseDrag(t,e)}mouseMove(t,e){this.fluidSystem.mouseMove(t,e)}}}}]);
//# sourceMappingURL=11394.69b2880e.chunk.js.map