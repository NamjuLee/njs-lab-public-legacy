"use strict";(self.webpackChunkNJS_Lab=self.webpackChunkNJS_Lab||[]).push([[98031],{98031:(e,t,i)=>{i.r(t),i.d(t,{Solution:()=>n});const r=new Float32Array([0,.5,0,-.5,-.5,0,.5,-.5,0]);class n{constructor(e){this.divHost=void 0,this.canvas=void 0,this.ctx=void 0,this.device=void 0,this.format=void 0,this.size=void 0,this.pipelineObj=void 0,this.divHost=document.getElementById(e),this.canvas=document.createElement("canvas"),this.divHost.appendChild(this.canvas),this.initWebGPU()}async initWebGPU(){if(!navigator.gpu)throw new Error("Not Support WebGPU");const e=await navigator.gpu.requestAdapter({powerPreference:"high-performance"});if(!e)throw new Error("No Adapter Found");const t=await e.requestDevice();this.ctx=this.canvas.getContext("webgpu");const i=navigator.gpu.getPreferredCanvasFormat?navigator.gpu.getPreferredCanvasFormat():this.ctx.getPreferredFormat(e);window.devicePixelRatio;this.canvas.width=this.divHost.clientWidth,this.canvas.height=this.divHost.clientHeight,this.ctx.configure({device:t,format:i,alphaMode:"opaque"}),this.size={width:this.canvas.width,height:this.canvas.height},this.device=t,this.format=i,this.initPipeline(this.device,this.format)}destroy(){this.divHost.removeChild(this.canvas)}async initPipeline(e,t){const i=await e.createRenderPipelineAsync({label:"Basic Pipline",layout:"auto",vertex:{module:e.createShaderModule({code:"\n@vertex\nfn main(@location(0) position : vec3<f32>) -> @builtin(position) vec4<f32> {\n    return vec4<f32>(position, 1.0);\n}\n"}),entryPoint:"main",buffers:[{arrayStride:12,attributes:[{shaderLocation:0,offset:0,format:"float32x3"}]}]},fragment:{module:e.createShaderModule({code:"\n@group(0) @binding(0) var<uniform> color : vec4<f32>;\n\n@fragment\nfn main() -> @location(0) vec4<f32> {\n    return color;\n}\n"}),entryPoint:"main",targets:[{format:t}]},primitive:{topology:"triangle-list"}}),n=e.createBuffer({label:"GPUBuffer store vertex",size:r.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST});e.queue.writeBuffer(n,0,r);const s=e.createBuffer({label:"GPUBuffer store rgba color",size:16,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});e.queue.writeBuffer(s,0,new Float32Array([1,1,0,1]));const a=e.createBindGroup({label:"Uniform Group with colorBuffer",layout:i.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:s}}]});this.pipelineObj={pipeline:i,vertexBuffer:n,colorBuffer:s,uniformGroup:a},this.run()}run(){var e,t;this.draw(this.device,this.ctx,this.pipelineObj),null===(e=document.querySelector('input[type="color"]'))||void 0===e||e.addEventListener("input",(e=>{const t=e.target.value,i=+("0x"+t.slice(1,3))/255,r=+("0x"+t.slice(3,5))/255,n=+("0x"+t.slice(5,7))/255;this.device.queue.writeBuffer(this.pipelineObj.colorBuffer,0,new Float32Array([i,r,n,1])),this.draw(this.device,this.ctx,this.pipelineObj)})),null===(t=document.querySelector('input[type="range"]'))||void 0===t||t.addEventListener("input",(e=>{const t=+e.target.value;r[0]=0+t,r[3]=-.5+t,r[6]=.5+t,this.device.queue.writeBuffer(this.pipelineObj.vertexBuffer,0,r),this.draw(this.device,this.ctx,this.pipelineObj)})),window.addEventListener("resize",(()=>{this.canvas.width=this.divHost.clientWidth,this.canvas.height=this.divHost.clientHeight,this.draw(this.device,this.ctx,this.pipelineObj)}))}draw(e,t,i){const r=e.createCommandEncoder(),n={colorAttachments:[{view:t.getCurrentTexture().createView(),clearValue:{r:0,g:0,b:0,a:1},loadOp:"clear",storeOp:"store"}]},s=r.beginRenderPass(n);s.setPipeline(i.pipeline),s.setBindGroup(0,i.uniformGroup),s.setVertexBuffer(0,i.vertexBuffer),s.draw(3),s.end(),e.queue.submit([r.finish()])}}}}]);
//# sourceMappingURL=98031.da163bf3.chunk.js.map