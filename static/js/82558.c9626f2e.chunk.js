"use strict";(self.webpackChunkNJS_Lab=self.webpackChunkNJS_Lab||[]).push([[82558],{82558:(t,e,i)=>{i.r(e),i.d(e,{AppDrawingWrapper:()=>M,Solution:()=>E});var s=i(458);class o{constructor(t,e){this.core=void 0,this.div=void 0,this.canvas=void 0,this.ctx=void 0,this.isActive=!1,this.zoom=1,this.translation=[0,0],this.translationZoom=[0,0],this.deltaTime=void 0,this.canvasLoopController=void 0,this.log=void 0,this.isViewChanging=!1,this.loopNum=0,this.needRenderloop=!0,this.ablePan=!0,this.pause=!1,this.core=t,this.div=e,this.Init(),this.LoopInit()}Init(){const t=document.createElement("canvas");if(t){this.canvas=t,this.canvas.width=this.div.clientWidth,this.canvas.height=this.div.clientHeight,this.div.append(this.canvas);const e=this.canvas.getContext("2d");e&&(this.ctx=e,this.isActive=!0)}}LoopInit(){this.translation[0]=.5*this.ctx.canvas.width,this.translation[1]=.5*this.ctx.canvas.height,this.deltaTime=new s.gk,this.canvasLoopController=new s.NI(60),this.SetLevel4(),this.Loop()}Loop(){let t=performance.now();if(this.deltaTime.UpdateFPS(),this.canvasLoopController.level>3){if(6===this.canvasLoopController.level)requestAnimationFrame((()=>{this.Loop()})),this.RenderPre(this.ctx);else if(5===this.canvasLoopController.level)this.isViewChanging,requestAnimationFrame((()=>{this.Loop()})),this.RenderPre(this.ctx);else if(4===this.canvasLoopController.level){if(this.isViewChanging,requestAnimationFrame((()=>{this.Loop()})),this.canvasLoopController.stop)return;this.RenderPre(this.ctx),this.canvasLoopController.TimerForStop()}}else 1===this.canvasLoopController.level&&this.isViewChanging||this.RenderPre(this.ctx);let e=performance.now();this.log="level:  ".concat(this.canvasLoopController.level,", total frames: ").concat(this.loopNum++," (FPS: ").concat(this.deltaTime.frameRate.toFixed(0),"), a loop took: ").concat((e-t).toFixed(2)," ms to execute.")}SetLevel1(){this.canvasLoopController.level=1,this.Loop()}SetLevel2(){this.canvasLoopController.level=2,this.Loop()}SetLevel3(){this.canvasLoopController.level=3,this.Loop()}RenderSetLevel4(){this.canvasLoopController.stop=!0}SetLevel4(){this.canvasLoopController.Reset(),setTimeout((()=>{this.canvasLoopController.level=4,this.Loop()}),500)}SetLevel5(){this.canvasLoopController.Reset(),setTimeout((()=>{this.canvasLoopController.level=5,this.Loop()}),500)}SetLevel6(){this.canvasLoopController.Reset(),setTimeout((()=>{this.canvasLoopController.level=6,this.Loop()}),500)}Clear(t){this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height)}Zoom(t){t.wheel<0?this.zoom+=.09*this.zoom:(console.log("out",this.zoom),this.zoom-=.09*this.zoom)}RemapByZoom(t){return t.x=(t.xs-this.translation[0])/this.zoom,t.y=(t.ys-this.translation[1])/this.zoom,t}Pan(t){if(!this.ablePan)return;const e=t.xs-t.preXs,i=t.ys-t.preYs;this.translation[0]+=e,this.translation[1]+=i}RenderForce(){this.canvasLoopController.stop=!1}RenderPre(t){this.isActive&&(this.Clear(this.ctx),this.ctx.save(),this.ctx.translate(this.translation[0],this.translation[1]),this.ctx.scale(this.zoom,this.zoom),this.Render(t),this.ctx.restore())}Render(t){}}let n,h;!function(t){t.LEFT="LEFT",t.MIDDLE="MIDDLE",t.RIGHT="RIGHT",t.WHEEL="WHEEL",t.DRAG="DRAG",t.DRAG_LEFT="DRAG_LEFT",t.DRAG_MIDDLE="DRAG_MIDDLE",t.DRAG_RIGHT="DRAG_RIGHT",t.MOVE="MOVE",t.DOUBLE="DOUBLE",t.UP="UP",t.DOWN="DOWN",t.DOWN_MIDDLE="DOWN_MIDDLE",t.DOWN_RIGHT="DOWN_RIGHT"}(n||(n={}));class r{constructor(){this.x=-1,this.y=-1,this.z=-1,this.preX=-1,this.preY=-1,this.preZ=-1,this.xs=-1,this.ys=-1,this.preXs=-1,this.preYs=-1,this.yGLPicking=void 0,this.command=void 0,this.CLICK_TYPE=n.MOVE,this.isDown=!1,this.isDoubleClick=!1,this.isMove=!1,this.pressedShift=!1,this.pressedAlt=!1,this.pressedCtrl=!1,this.wheel=0,this.preWheel=0,this.isActive=!0,this.native=void 0}DeepCopy(){let t=new r;return t.x=this.x,t.y=this.y,t.z=this.z,t.preX=this.preX,t.preY=this.preY,t.preZ=this.preZ,t.xs=this.x,t.ys=this.y,t.preXs=this.preXs,t.preYs=this.preYs,t.pressedAlt=this.pressedAlt,t.pressedShift=this.pressedShift,t.pressedCtrl=this.pressedCtrl,t.isDoubleClick=this.isDoubleClick,t.isDown=this.isDown,t.isMove=this.isMove,t.wheel=this.wheel,t.preWheel=this.preWheel,t.yGLPicking=this.yGLPicking,t.CLICK_TYPE=this.CLICK_TYPE,t.command=this.command,t.native=this.native,t}}class l{constructor(t){this.mouseInteractionUI=void 0,this.mouseEventDataPre=new r,this.isEnable=!0,this.clickCount=0,this.click=!1,this.prevent=!1,this.delay=250,this.timer=void 0,this.down=!1,this.e=void 0,this._stopPropagation=!1,this.ioWrapper=void 0,this.ioWrapper=t}InitNativeMouseEvent(t){t.onclick=t=>{this.prevent=!1,this.timer=setTimeout((()=>{this.prevent||this.MouseClick(t),this.prevent=!1}),this.delay)},t.ondblclick=t=>{clearTimeout(this.timer),this.prevent=!0,this.MouseDoubleClick(t)},t.onmousedown=t=>{this.MouseDown(t)},t.onmouseup=t=>{this.MouseUp(t)},t.onmousemove=t=>{this.MouseMove(t)},t.addEventListener("wheel",(t=>this.MouseWheel(t,t.deltaY)))}MouseDown(t){this.click=!0,this.down=!0;let e=this.CommonEventBuilder(t);e.CLICK_TYPE=n.DOWN,e.isDown=!0,this.MouseEvenEmitting(e)}MouseClick(t){if(!this.click)return;let e=this.CommonEventBuilder(t);0===t.button?e.CLICK_TYPE=n.LEFT:1===t.button?e.CLICK_TYPE=n.MIDDLE:2===t.button&&(e.CLICK_TYPE=n.RIGHT),this.MouseEvenEmitting(e)}MouseDoubleClick(t){let e=this.CommonEventBuilder(t);e.CLICK_TYPE=n.DOUBLE,this.MouseEvenEmitting(e)}MouseDrag(t){this.click=!1,this.prevent=!0;let e=this.CommonEventBuilder(t);e.CLICK_TYPE=n.DRAG,e.isDown=!0,1===t.buttons?e.CLICK_TYPE=n.DRAG:4===t.buttons?e.CLICK_TYPE=n.DRAG_MIDDLE:2===t.buttons&&(e.CLICK_TYPE=n.DRAG_RIGHT),this.MouseEvenEmitting(e)}MouseMove(t){if(this.down)return void this.MouseDrag(t);let e=this.CommonEventBuilder(t);e.CLICK_TYPE=n.MOVE,e.isDown=!0,this.prevent=!0,this.MouseEvenEmitting(e)}MouseUp(t){this.down=!1,this.click=!0;let e=this.CommonEventBuilder(t);e.CLICK_TYPE=n.UP,e.isDown=!1,this.MouseEvenEmitting(e)}MouseWheel(t,e){let i=this.CommonEventBuilder(t);i.wheel=e,i.CLICK_TYPE=n.WHEEL,this.MouseEvenEmitting(i)}CommonEventBuilder(t){let e=new r;return e.preXs=this.mouseEventDataPre.xs,e.preYs=this.mouseEventDataPre.ys,e.preX=this.mouseEventDataPre.x,e.preY=this.mouseEventDataPre.y,e.pressedShift=t.shiftKey,e.pressedAlt=t.altKey,e.pressedCtrl=t.ctrlKey,e.xs=t.offsetX,e.ys=t.offsetY,e.preWheel=this.mouseEventDataPre.wheel,e.wheel=0,e.native=t,e=this.ioWrapper.core.canvas.RemapByZoom(e),this.mouseEventDataPre=e,this.e=e,e}get stopPropagation(){return this._stopPropagation}set stopPropagation(t){t?this._stopPropagation=t:setTimeout((()=>{this._stopPropagation=t}),500)}MouseEvenEmitting(t){this.MouseEventEmittingForViewController(t),this._stopPropagation||this.MouseEventEmittingForModel(t)}MouseEventEmittingForViewController(t){this.mouseInteractionUI&&this.mouseInteractionUI.MouseInteractionMenu(t)}MouseEventEmittingForModel(t){this.ioWrapper.core.activeCommandController.MouseEventController(t)}}class a{constructor(t){this.core=void 0,this.mouseInteraction=void 0,this.core=t,this.mouseInteraction=new l(this)}InitEventListener(t){this.mouseInteraction.InitNativeMouseEvent(t),this.Resize()}Resize(){window.addEventListener("resize",(t=>this.ReSizeWindow(t)))}ReSizeWindow(t){}}class c{constructor(t){this.core=void 0,this.mouse=new s.h9(0,0),this.core=t}MouseEventController(t){const e=t.DeepCopy();e.x=t.xs,e.y=t.ys,this.core.nUI.MouseInteractionMenu(e),this.core.nUI.stopPropagation||(this.core.canvas.RenderForce(),this.core.appDrawing.implementations.MouseEventController(t),t.CLICK_TYPE!==s.uh.LEFT?t.CLICK_TYPE!==s.uh.MIDDLE?t.CLICK_TYPE!==s.uh.DOWN_RIGHT?t.CLICK_TYPE!==s.uh.DOUBLE?t.CLICK_TYPE!==s.uh.MOVE?t.CLICK_TYPE!==s.uh.DRAG?t.CLICK_TYPE!==s.uh.DOWN?t.CLICK_TYPE!==s.uh.WHEEL?t.CLICK_TYPE!==s.uh.UP||this.MouseUpPre(t):this.MouseWheelPre(t):this.MouseDownPre(t):this.MouseDragPre(t):this.MouseMovePre(t):this.MouseDoubleClickPre(t):this.MouseRightClickPre(t):this.MouseMiddleClickPre(t):this.MouseLeftClickPre(t))}MouseDown(t){}MouseDownPre(t){this.MouseDown(t)}MouseLeftClick(t){}MouseLeftClickPre(t){this.MouseLeftClick(t)}MouseMiddleClick(t){}MouseMiddleClickPre(t){this.MouseMiddleClick(t)}MouseRightClick(t){}MouseRightClickPre(t){this.MouseRightClick(t)}MouseUp(t){}MouseUpPre(t){this.MouseUp(t)}MouseDoubleClick(t){}MouseDoubleClickPre(t){this.MouseDoubleClick(t)}MouseMove(t){}MouseMovePre(t){this.MouseMove(t)}MouseDrag(t){}MouseDragPre(t){this.mouse.x=t.x,this.mouse.y=t.y,this.core.canvas.Pan(t),this.MouseDrag(t)}MouseWheel(t){}MouseWheelPre(t){this.core.canvas.Zoom(t),this.MouseWheel(t)}pushActionFromPulldown(t){t.split("@")[0]}}class v{constructor(t,e){this.appDrawing=void 0,this.canvas=void 0,this.nUI=void 0,this.ioWrapper=void 0,this.activeCommandController=void 0,this.appDrawing=t,this.InitPulldown(),this.InitCanvas(e),this.activeCommandController=new c(this),this.ioWrapper=new a(this)}InitCanvas(t){this.canvas=new o(this,t)}InitPulldown(){this.nUI=new s.Fc(this.appDrawing.div),this.BindingActiveCommandController()}InitPost(){this.ioWrapper.InitEventListener(this.appDrawing.div)}BindingActiveCommandController(){this.nUI.BindingActiveCommandController("NDrawingBlock",(t=>this.Commander(t)))}Resize(t,e){this.nUI.Resize(t,e)}Commander(t){console.log({v:t}),this.activeCommandController.pushActionFromPulldown(t)}}class u{constructor(t){this.ac=void 0,this.ac=t}MouseEventController(t){this.ac.mouse.x=t.x,this.ac.mouse.y=t.y,t.CLICK_TYPE!==n.LEFT?t.CLICK_TYPE!==n.MIDDLE?t.CLICK_TYPE!==n.DOWN_RIGHT?t.CLICK_TYPE!==n.DOUBLE?t.CLICK_TYPE!==n.MOVE?t.CLICK_TYPE!==n.DRAG?t.CLICK_TYPE!==n.DOWN?t.CLICK_TYPE!==n.WHEEL?t.CLICK_TYPE!==n.UP||this.MouseUpPre(t):this.MouseWheelPre(t):this.MouseDownPre(t):this.MouseDragPre(t):this.MouseMovePre(t):this.MouseDoubleClickPre(t):this.MouseRightClickPre(t):this.MouseMiddleClickPre(t):this.MouseLeftClickPre(t)}MouseDown(t){}MouseDownPre(t){this.MouseDown(t)}MouseLeftClick(t){}MouseLeftClickPre(t){this.MouseLeftClick(t)}MouseMiddleClick(t){}MouseMiddleClickPre(t){this.MouseMiddleClick(t)}MouseRightClick(t){}MouseRightClickPre(t){this.MouseRightClick(t)}MouseUp(t){}MouseUpPre(t){this.ac.ablePan=!0,this.MouseUp(t)}MouseDoubleClick(t){}MouseDoubleClickPre(t){this.MouseDoubleClick(t)}MouseMove(t){}MouseMovePre(t){this.MouseMove(t)}MouseDrag(t){}MouseDragPre(t){this.MouseDrag(t)}MouseWheel(t){}MouseWheelPre(t){this.MouseWheel(t)}}!function(t){t.SELECT="SELECT",t.REMOVE="REMOVE",t.RECT="RECT",t.DRAWING_BLOCK="DRAWING_BLOCK"}(h||(h={}));class d{constructor(t){this.implementation=void 0,this.commands=void 0,this.activeCommand=void 0,this.mouse=new s.h9(0,0),this._ablePan=!1,this.implementation=t,this.commands={},this.activeCommand=new u(this),this.SetActiveCommand(h.DRAWING_BLOCK)}SetActiveCommand(t){}get ablePan(){return this._ablePan}set ablePan(t){this.implementation.implementations.appDrawing.core.canvas.ablePan=t,this._ablePan=t}}class C{constructor(t){this.implementations=void 0,this.activeCommandController=void 0,this.implementations=t,this.Init()}Init(){this.activeCommandController=new d(this)}MouseEventController(t){this.activeCommandController.activeCommand.MouseEventController(t)}Render(t){t.fillStyle="#00ff00",t.beginPath(),t.arc(this.activeCommandController.mouse.x,this.activeCommandController.mouse.y,2,0,2*Math.PI),t.closePath(),t.fill()}}class m{constructor(t){this.appDrawing=void 0,this.implementation=void 0,this.appDrawing=t,this.implementation=new C(this)}MouseEventController(t){this.implementation.MouseEventController(t)}Render(t){this.implementation.Render(t)}}class p{static Init(){new p(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"SandBox")}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"SandBox";this.id=void 0,this.core=void 0,this.implementations=void 0,this.hostDiv=void 0,this.div=void 0,this.id=t,this.Init(),this.InitPost()}Init(){const t=document.getElementById(this.id);if(!t)return;this.hostDiv=t;const e=document.createElement("div");e&&(this.div=e,this.div.style.width="100%",this.div.style.height="100%",this.hostDiv.append(this.div)),this.core=new v(this,e),this.implementations=new m(this)}InitPost(){this.core.InitPost(),this.core.canvas.Render=t=>this.implementations.Render(t)}}class M{static Init(){new M(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"SandBox",1)}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"SandBox",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.id=void 0,this.app=void 0,this.hostDiv=void 0,this.div=void 0,this.version=1,this.id=t,this.version=e,this.Init()}Init(){if(1===this.version)this.app=new p(this.id)}}class E{constructor(t){this.divHost=void 0,this.divHost=document.getElementById(t);const e=document.createElement("div");e.id="nui-sandbox",e.style.width="100%",e.style.height="100%",this.divHost.appendChild(e),M.Init(e.id)}destroy(){if(this.divHost)try{for(;this.divHost.firstChild;)this.divHost.removeChild(this.divHost.firstChild)}catch(t){console.error("Error in destroy method:",t)}else console.warn("divHost is undefined in destroy method")}}}}]);
//# sourceMappingURL=82558.c9626f2e.chunk.js.map