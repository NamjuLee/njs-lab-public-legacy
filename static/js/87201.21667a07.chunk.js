"use strict";(self.webpackChunkNJS_Lab=self.webpackChunkNJS_Lab||[]).push([[87201],{87201:(e,t,i)=>{i.r(t),i.d(t,{App:()=>S,Renderer:()=>m,Solution:()=>E});class s{constructor(e){this.controller=void 0,this.pos=[0,0],this.mNormalized=new Float32Array([0,0]),this.isDown=!1,this.controller=e}init(){this.appendEvent()}appendEvent(){this.controller.app.renderer.canvas.addEventListener("ondrag",(e=>{}),!1),this.controller.app.renderer.canvas.addEventListener("click",(e=>{}),!1),this.controller.app.renderer.canvas.addEventListener("dblclick",(e=>{}),!1),this.controller.app.renderer.canvas.addEventListener("drag",(e=>{}),!0),this.controller.app.renderer.canvas.addEventListener("mouseup",(e=>{}),!1),this.controller.app.renderer.canvas.addEventListener("mousedown",(e=>{this.isDown=!0,this.pos[0]=e.offsetX,this.pos[1]=e.offsetY}),!1),this.controller.app.renderer.canvas.addEventListener("mouseup",(e=>{this.isDown=!1}),!1),this.controller.app.renderer.canvas.addEventListener("mousemove",(e=>{if(this.isDown){const t=this.pos[0]-e.offsetX,i=this.pos[1]-e.offsetY;this.controller.app.renderer.cameraController.moveCamera(t,i),this.pos[0]=e.offsetX,this.pos[1]=e.offsetY}else{const t=this.controller.app.renderer.canvas.getBoundingClientRect();this.mNormalized[0]=(e.clientX-t.left)/this.controller.app.renderer.canvas.width,this.mNormalized[1]=(e.clientY-t.top)/this.controller.app.renderer.canvas.height}}),!1),this.controller.app.renderer.canvas.addEventListener("wheel",(e=>{this.controller.app.renderer.cameraController.zoomWheel(e.deltaY)}),!1),window.addEventListener("keydown",(e=>{this.controller.keyboard(e)}),!1)}}class r{constructor(e){this.app=void 0,this.eventController=void 0,this.app=e,this.eventController=new s(this)}init(){this.eventController.init()}keyboard(e){"p"===e.key&&this.app.renderer.cameraController.shiftCamera()}}var a=i(39880),o=i(88679),n=i(99874);class h{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[2,2,4],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[0,0,0],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[0,1,0],n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5;this.viewMatrix=a.Ue(),this.projectionMatrix=a.Ue(),this.viewProjectionMatrix=a.Ue(),this.zoomMax=100,this.zoomSpeed=2,this.near=.01,this.far=1e4,this.mvpMatrix=a.Ue(),this.eye=o.al(0,0,0),this.center=o.al(0,0,0),this.up=o.al(0,1,0),this.type="camera",this.respectRatio=void 0,this.width=void 0,this.height=void 0,this.angleXY=Math.PI,this.angleZ=.25*Math.PI,this.distance=1,this.distance=n,this.width=e,this.height=t,this.respectRatio=e/t,this.eye=i,this.center=s,this.up=r}zoom(e){}update(){a.zB(this.viewMatrix,this.eye,this.center,this.up),a.Jp(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix)}}class d extends h{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2&&void 0!==arguments[2]?arguments[2]:[2,2,4],arguments.length>3&&void 0!==arguments[3]?arguments[3]:[0,0,0],arguments.length>4&&void 0!==arguments[4]?arguments[4]:[0,1,0],arguments.length>5&&void 0!==arguments[5]?arguments[5]:3),this.type="CameraPerspective",this.init()}init(){a.G3(this.projectionMatrix,2*Math.PI/5,this.respectRatio,this.near,this.far),this.update()}zoom(e){this.distance+=.01*e}}class c extends h{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0,1],arguments.length>3&&void 0!==arguments[3]?arguments[3]:[0,0,0],arguments.length>4&&void 0!==arguments[4]?arguments[4]:[0,1,0],arguments.length>5&&void 0!==arguments[5]?arguments[5]:300.1),this.type="CameraOrth",this.init()}init(){l(this.projectionMatrix,this.width,this.height,this.near,this.far,this.distance),this.angleXY=0,this.angleZ=0,this.update()}zoom(e){this.distance+=e+50/this.distance,this.distance<1e-6&&(this.distance=1e-6),this.distance>1e5&&(this.distance=1e5),l(this.projectionMatrix,this.width,this.height,this.near,this.far,this.distance)}}const l=(e,t,i,s,r,a)=>(e[0]=2/t*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2/i*a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=-2/(r-s),e[11]=0,e[12]=0,e[13]=0,e[14]=.1,e[15]=1,e);class u{constructor(e){this.solution=void 0,this.canvas=void 0,this.cameraOrth=void 0,this.cameraPerspective=void 0,this.camera=void 0,this.modelMatrix=a.Ue(),this.mvpMatrix=a.Ue(),this.rotation=o.al(0,0,0),this.translation=o.al(0,0,0),this.screen2=n.al(0,0),this.solution=e,this.canvas=e.canvas;const t=o.al(2.6451475620269775,3.130298137664795,2.864337205886841),i=o.al(0,0,0),s=o.al(0,0,1);this.cameraPerspective=new d(this.canvas.width,this.canvas.height,t,i,s),this.camera=this.cameraPerspective,this.arcRotation(0,0),this.cameraOrth=new c(this.canvas.width,this.canvas.height),this.camera=this.cameraOrth,this.update()}update(){this.camera.update(),p(this.modelMatrix,this.translation,this.rotation),a.Jp(this.mvpMatrix,this.camera.viewProjectionMatrix,this.modelMatrix)}rotateZ(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.1;this.rotation[2]+=e,this.update()}translateX(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.1;this.translation[0]+=e,this.update()}get getMatrix(){return this.mvpMatrix}shiftCamera(){this.camera===this.cameraPerspective?this.camera=this.cameraOrth:this.camera=this.cameraPerspective,this.update()}moveCamera(e,t){this.camera===this.cameraPerspective?this.arcRotation(e,t):this.pan(e,t)}arcRotation(e,t){e*=-.01,t*=-.01,this.camera.angleXY+=e,this.camera.angleZ+=t,this.camera.eye[0]=this.camera.center[0]+Math.sin(this.camera.angleXY)*Math.cos(this.camera.angleZ)*this.camera.distance,this.camera.eye[1]=this.camera.center[1]+Math.cos(this.camera.angleXY)*Math.cos(this.camera.angleZ)*this.camera.distance,this.camera.eye[2]=this.camera.center[2]+Math.sin(this.camera.angleZ)*this.camera.distance,this.update()}zoomWheel(e){this.camera===this.cameraPerspective?(this.camera.zoom(e),this.arcRotation(0,0)):this.camera.zoom(e),this.update()}pan(e,t){this.camera.center[0]+=e/this.camera.distance,this.camera.center[1]-=t/this.camera.distance,this.camera.eye[0]+=e/this.camera.distance,this.camera.eye[1]-=t/this.camera.distance,this.update()}}const p=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0,0],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1];const r=a.Ue(),o=a.Ue(),n=a.Ue(),h=a.Ue(),d=a.Ue();a.vc(h,t),a.aC(r,i[0]),a.gT(o,i[1]),a.QO(n,i[2]),a.xJ(d,s),a.Jp(e,r,d),a.Jp(e,o,e),a.Jp(e,n,e),a.Jp(e,h,e)};let f;!function(e){e.PointList="point-list",e.LineList="line-list",e.LineStrip="line-strip",e.TriangleList="triangle-list",e.TriangleStrip="triangle-strip"}(f||(f={}));class v{constructor(e){this.renderer=void 0,this.ctx=void 0,this.device=void 0,this.format=void 0,this.commandEncoder=void 0,this.renderPass=void 0,this.textureView=void 0,this.PrimitiveTopology=f,this.renderPassDescription=void 0,this.depthTexture=void 0,this.renderer=e}async initWebGPU(){if(!navigator.gpu)throw new Error("Not Support WebGPU");const e=await navigator.gpu.requestAdapter({powerPreference:"high-performance"});if(!e)throw new Error("No Adapter Found");const t=await e.requestDevice();this.ctx=this.renderer.canvas.getContext("webgpu"),this.format="bgra8unorm",this.ctx.configure({device:t,format:this.format,alphaMode:"opaque"}),this.device=t,this.textureView=this.ctx.getCurrentTexture().createView(),this.depthTexture=this.device.createTexture({size:[this.ctx.canvas.width,this.ctx.canvas.height,1],format:"depth24plus",usage:GPUTextureUsage.RENDER_ATTACHMENT}),this.renderPassDescription={colorAttachments:[{view:this.textureView,clearValue:{r:0,g:0,b:0,a:1},loadOp:"clear",storeOp:"store"}],depthStencilAttachment:{view:this.depthTexture.createView(),depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store"}}}destroy(){this.device.destroy()}}class m{constructor(e){this.app=void 0,this.canvas=void 0,this.cameraController=void 0,this.webGPU=void 0,this.isAnimation=!0,this.requestAni=void 0,this.loop=()=>{this.isAnimation&&(this.requestAni=requestAnimationFrame(this.loop)),this.drawing()},this.app=e,this.canvas=document.createElement("canvas"),this.canvas.width=this.app.divHost.clientWidth,this.canvas.height=this.app.divHost.clientHeight,this.app.divHost.appendChild(this.canvas),this.webGPU=new v(this)}async init(){await this.webGPU.initWebGPU(),this.cameraController=new u(this),this.requestAni=requestAnimationFrame(this.loop)}drawing(){this.app.scene.render()}destroy(){for(this.webGPU.destroy(),cancelAnimationFrame(this.requestAni);this.app.divHost.lastElementChild;)this.app.divHost.removeChild(this.app.divHost.lastElementChild)}}var g=i(13958),P=i(87968);class w{constructor(){this.streetOSM=[],this.pos=void 0,this.colors=void 0,this.renderLines=(e,t)=>{const i=[],s=[],r=[],a=15478749.591872748,o=4766690.415614613,n=1e-4;let h=0,d=0,c=0;for(let l=0;l<e.length;++l){const u=e[l];for(let e=0;e<u.length;++e)for(let l=0;l<u[e].length-1;++l){const[p,f]=(0,P.MercatorProjection)(u[e][l][0],u[e][l][1]),[v,m]=(0,P.MercatorProjection)(u[e][l+1][0],u[e][l+1][1]);h+=p,d+=f,c+=1;const g=(p-a)*n,w=(f-o)*n,b=(v-a)*n,U=(m-o)*n;i.push(g,w,0),s.push(t[0],t[1],t[2]),i.push(b,U,0),s.push(t[0],t[1],t[2]),l<u[e].length-1&&r.push(Math.floor(i.length/3)-1,Math.floor(i.length/3))}}console.log(i),console.log(h/c,d/c),this.pos=new Float32Array(i.flat()),this.colors=new Float32Array(s.flat())}}async init(){await(0,P.getJSONFromURL)("https://raw.githubusercontent.com/NamjuLee/data/master/Paris/street_osm.geojson").then((e=>{for(let t=0;t<e.features.length;++t)this.streetOSM.push(e.features[t].geometry.coordinates);this.renderLines(this.streetOSM,[0,1,1])}))}}class b{constructor(e){this.scene=void 0,this.webGPU=void 0,this.scene=e,this.webGPU=e.app.renderer.webGPU,this.scene.objects.push(this)}async initPipeline(){}update(){}render(){}}const U=i(18207);class G extends b{constructor(e){super(e),this.isRenderable=!1,this.numberOfVertices=0,this.vertexBuffer=void 0,this.colorBuffer=void 0,this.normalBuffer=void 0,this.uvBuffer=void 0,this.uniformBindGroup=void 0,this.uniformBindGroup1=void 0,this.uniformBindGroup2=void 0,this.uniformBuffer=void 0,this.commandEncoder=void 0,this.textureView=void 0,this.renderPassDescription=void 0,this.pipeline=void 0,this.isAnimation=!1,this.modelMatrix=void 0,this.translation=o.al(0,0,0),this.rotation=o.al(0,0,0),this.mouseBuffer=void 0,this.frameBuffer=void 0,this.t=0,this.resultBuffer=void 0,this.geometry=void 0,this.initPipeline()}async initPipeline(){this.geometry=new w,await this.geometry.init(),console.log(this.geometry),this.numberOfVertices=this.geometry.pos.length/3,this.vertexBuffer=(0,g.pg)(this.webGPU.device,this.geometry.pos),this.colorBuffer=(0,g.pg)(this.webGPU.device,this.geometry.colors);const e=await(0,g.bD)(U);this.pipeline=this.webGPU.device.createRenderPipeline({layout:"auto",vertex:{module:this.webGPU.device.createShaderModule({code:e}),entryPoint:"vs_main",buffers:[{arrayStride:12,attributes:[{shaderLocation:0,format:"float32x3",offset:0}]},{arrayStride:12,attributes:[{shaderLocation:1,format:"float32x3",offset:0}]}]},fragment:{module:this.webGPU.device.createShaderModule({code:e}),entryPoint:"fs_main",targets:[{format:this.webGPU.format}]},primitive:{topology:this.webGPU.PrimitiveTopology.PointList},depthStencil:{format:"depth24plus",depthWriteEnabled:!0,depthCompare:"less"}}),this.modelMatrix=a.Ue(),this.rotation=o.al(0,0,0),this.uniformBuffer=this.webGPU.device.createBuffer({size:64,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),this.mouseBuffer=this.webGPU.device.createBuffer({size:64,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),this.frameBuffer=this.webGPU.device.createBuffer({size:64,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),this.uniformBindGroup=this.webGPU.device.createBindGroup({layout:this.pipeline.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:this.uniformBuffer,offset:0,size:64}}]}),this.uniformBindGroup1=this.webGPU.device.createBindGroup({layout:this.pipeline.getBindGroupLayout(1),entries:[{binding:0,resource:{buffer:this.mouseBuffer}}]}),this.textureView=this.webGPU.ctx.getCurrentTexture().createView();const t=this.webGPU.device.createTexture({size:[this.webGPU.ctx.canvas.width,this.webGPU.ctx.canvas.height,1],format:"depth24plus",usage:GPUTextureUsage.RENDER_ATTACHMENT});this.renderPassDescription={colorAttachments:[{view:this.textureView,clearValue:{r:.2,g:.247,b:.314,a:1},loadValue:{r:0,g:0,b:0,a:1},loadOp:"clear",storeOp:"store"}],depthStencilAttachment:{view:t.createView(),depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store"}},this.isRenderable=!0}async render(){this.isRenderable&&(this.webGPU.device.queue.writeBuffer(this.mouseBuffer,0,new Float32Array([this.scene.app.controller.eventController.mNormalized[0],this.scene.app.controller.eventController.mNormalized[1],this.t])),this.webGPU.device.queue.writeBuffer(this.frameBuffer,0,new Float32Array([this.t,0])),(0,g.zM)(this.modelMatrix,this.translation,this.rotation),a.Jp(this.modelMatrix,this.webGPU.renderer.cameraController.getMatrix,this.modelMatrix),this.webGPU.device.queue.writeBuffer(this.uniformBuffer,0,this.modelMatrix),this.webGPU.renderPass.setPipeline(this.pipeline),this.webGPU.renderPass.setVertexBuffer(0,this.vertexBuffer),this.webGPU.renderPass.setVertexBuffer(1,this.colorBuffer),this.webGPU.renderPass.setBindGroup(0,this.uniformBindGroup),this.webGPU.renderPass.setBindGroup(1,this.uniformBindGroup1),this.webGPU.renderPass.draw(this.numberOfVertices),this.t+=.01)}}class x{constructor(){this.streetOSM=[],this.pos=void 0,this.colors=void 0,this.renderLines=(e,t)=>{const i=[],s=[],r=[],a=15478749.591872748,o=4766690.415614613,n=1e-4;let h=0,d=0,c=0;for(let l=0;l<e.length;++l){const u=e[l];for(let e=0;e<u.length;++e)for(let l=0;l<u[e].length-1;++l){const[p,f]=(0,P.MercatorProjection)(u[e][l][0],u[e][l][1]),[v,m]=(0,P.MercatorProjection)(u[e][l+1][0],u[e][l+1][1]);h+=p,d+=f,c+=1;const g=(p-a)*n,w=(f-o)*n,b=(v-a)*n,U=(m-o)*n;i.push(g,w,0),s.push(t[0],t[1],t[2]),i.push(b,U,0),s.push(t[0],t[1],t[2]),l<u[e].length-1&&r.push(Math.floor(i.length/3)-1,Math.floor(i.length/3))}}console.log(i),console.log(h/c,d/c),this.pos=new Float32Array(i.flat()),this.colors=new Float32Array(s.flat())}}async init(){await(0,P.getJSONFromURL)("https://raw.githubusercontent.com/NamjuLee/data/master/Paris/street_osm.geojson").then((e=>{for(let t=0;t<e.features.length;++t)this.streetOSM.push(e.features[t].geometry.coordinates);this.renderLines(this.streetOSM,[0,1,1])}))}}const B=i(74978);class M extends b{constructor(e){super(e),this.isRenderable=!1,this.numberOfVertices=0,this.vertexBuffer=void 0,this.colorBuffer=void 0,this.normalBuffer=void 0,this.uvBuffer=void 0,this.uniformBindGroup=void 0,this.uniformBindGroup1=void 0,this.uniformBindGroup2=void 0,this.uniformBuffer=void 0,this.commandEncoder=void 0,this.textureView=void 0,this.renderPassDescription=void 0,this.pipeline=void 0,this.isAnimation=!1,this.modelMatrix=void 0,this.translation=o.al(0,0,0),this.rotation=o.al(0,0,0),this.mouseBuffer=void 0,this.frameBuffer=void 0,this.t=0,this.resultBuffer=void 0,this.geometry=void 0,this.initPipeline()}async initPipeline(){this.geometry=new x,await this.geometry.init(),console.log(this.geometry),this.numberOfVertices=this.geometry.pos.length/3,this.vertexBuffer=(0,g.pg)(this.webGPU.device,this.geometry.pos),this.colorBuffer=(0,g.pg)(this.webGPU.device,this.geometry.colors);const e=await(0,g.bD)(B);this.pipeline=this.webGPU.device.createRenderPipeline({layout:"auto",vertex:{module:this.webGPU.device.createShaderModule({code:e}),entryPoint:"vs_main",buffers:[{arrayStride:12,attributes:[{shaderLocation:0,format:"float32x3",offset:0}]},{arrayStride:12,attributes:[{shaderLocation:1,format:"float32x3",offset:0}]}]},fragment:{module:this.webGPU.device.createShaderModule({code:e}),entryPoint:"fs_main",targets:[{format:this.webGPU.format}]},primitive:{topology:this.webGPU.PrimitiveTopology.LineList},depthStencil:{format:"depth24plus",depthWriteEnabled:!0,depthCompare:"less"}}),this.modelMatrix=a.Ue(),this.rotation=o.al(0,0,0),this.uniformBuffer=this.webGPU.device.createBuffer({size:64,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),this.mouseBuffer=this.webGPU.device.createBuffer({size:64,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),this.frameBuffer=this.webGPU.device.createBuffer({size:64,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),this.uniformBindGroup=this.webGPU.device.createBindGroup({layout:this.pipeline.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:this.uniformBuffer,offset:0,size:64}}]}),this.uniformBindGroup1=this.webGPU.device.createBindGroup({layout:this.pipeline.getBindGroupLayout(1),entries:[{binding:0,resource:{buffer:this.mouseBuffer}}]}),this.textureView=this.webGPU.ctx.getCurrentTexture().createView();const t=this.webGPU.device.createTexture({size:[this.webGPU.ctx.canvas.width,this.webGPU.ctx.canvas.height,1],format:"depth24plus",usage:GPUTextureUsage.RENDER_ATTACHMENT});this.renderPassDescription={colorAttachments:[{view:this.textureView,clearValue:{r:.2,g:.247,b:.314,a:1},loadValue:{r:0,g:0,b:0,a:1},loadOp:"clear",storeOp:"store"}],depthStencilAttachment:{view:t.createView(),depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store"}},this.isRenderable=!0}async render(){this.isRenderable&&(this.webGPU.device.queue.writeBuffer(this.mouseBuffer,0,new Float32Array([this.scene.app.controller.eventController.mNormalized[0],this.scene.app.controller.eventController.mNormalized[1],this.t])),this.webGPU.device.queue.writeBuffer(this.frameBuffer,0,new Float32Array([this.t,0])),(0,g.zM)(this.modelMatrix,this.translation,this.rotation),a.Jp(this.modelMatrix,this.webGPU.renderer.cameraController.getMatrix,this.modelMatrix),this.webGPU.device.queue.writeBuffer(this.uniformBuffer,0,this.modelMatrix),this.webGPU.renderPass.setPipeline(this.pipeline),this.webGPU.renderPass.setVertexBuffer(0,this.vertexBuffer),this.webGPU.renderPass.setVertexBuffer(1,this.colorBuffer),this.webGPU.renderPass.setBindGroup(0,this.uniformBindGroup),this.webGPU.renderPass.setBindGroup(1,this.uniformBindGroup1),this.webGPU.renderPass.draw(this.numberOfVertices),this.t+=.01)}}class y extends b{constructor(e){super(e),this.numberOfVertices=0,this.vertexBuffer=void 0,this.normalBuffer=void 0,this.uvBuffer=void 0,this.uniformBindGroup=void 0,this.uniformBuffer=void 0,this.commandEncoder=void 0,this.textureView=void 0,this.renderPassDescription=void 0,this.pipeline=void 0,this.isAnimation=!0,this.modelMatrix=void 0,this.translation=o.al(0,0,0),this.rotation=o.al(0,0,0),this.pos=void 0,this.t=0,this.initPipeline()}async initPipeline(){const e=O(1.5,70,40);this.pos=null===e||void 0===e?void 0:e.vertexData,this.numberOfVertices=(null===e||void 0===e?void 0:e.vertexData).length/3,this.vertexBuffer=(0,g.pg)(this.webGPU.device,null===e||void 0===e?void 0:e.vertexData),this.normalBuffer=(0,g.pg)(this.webGPU.device,null===e||void 0===e?void 0:e.normalData),this.uvBuffer=(0,g.pg)(this.webGPU.device,null===e||void 0===e?void 0:e.uvData);const t=C();this.pipeline=this.webGPU.device.createRenderPipeline({layout:"auto",vertex:{module:this.webGPU.device.createShaderModule({code:t.vertex}),entryPoint:"main",buffers:[{arrayStride:12,attributes:[{shaderLocation:0,format:"float32x3",offset:0}]}]},fragment:{module:this.webGPU.device.createShaderModule({code:t.fragment}),entryPoint:"main",targets:[{format:this.webGPU.format}]},primitive:{topology:this.webGPU.PrimitiveTopology.PointList},depthStencil:{format:"depth24plus",depthWriteEnabled:!0,depthCompare:"less"}}),this.modelMatrix=a.Ue(),this.rotation=o.al(.15*Math.PI,0,0),this.uniformBuffer=this.webGPU.device.createBuffer({size:64,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),this.uniformBindGroup=this.webGPU.device.createBindGroup({layout:this.pipeline.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:this.uniformBuffer,offset:0,size:64}}]}),this.textureView=this.webGPU.ctx.getCurrentTexture().createView();const i=this.webGPU.device.createTexture({size:[this.webGPU.ctx.canvas.width,this.webGPU.ctx.canvas.height,1],format:"depth24plus",usage:GPUTextureUsage.RENDER_ATTACHMENT});this.renderPassDescription={colorAttachments:[{view:this.textureView,clearValue:{r:.2,g:.247,b:.314,a:1},loadOp:"clear",storeOp:"store"}],depthStencilAttachment:{view:i.createView(),depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store"}}}render(){this.isAnimation,this.rotation[1]+=.005,(0,g.zM)(this.modelMatrix,this.translation,this.rotation),a.Jp(this.modelMatrix,this.webGPU.renderer.cameraController.getMatrix,this.modelMatrix),this.webGPU.device.queue.writeBuffer(this.uniformBuffer,0,this.modelMatrix),this.webGPU.renderPass.setPipeline(this.pipeline),this.webGPU.renderPass.setVertexBuffer(0,this.vertexBuffer),this.webGPU.renderPass.setBindGroup(0,this.uniformBindGroup),this.webGPU.renderPass.draw(this.numberOfVertices),this.t+=.01}}const C=()=>({vertex:"\n        struct Uniforms {\n            mvpMatrix : mat4x4<f32>,\n        };\n        @binding(0) @group(0) var<uniform> uniforms : Uniforms;\n        \n        @vertex\n        fn main(@location(0) pos: vec4<f32>) ->  @builtin(position) vec4<f32> {\n            return uniforms.mvpMatrix * pos;     \n        }",fragment:"\n        @fragment\n        fn main() -> @location(0) vec4<f32> {\n            return vec4<f32>(1.0, 1.0, 0.0, 1.0);            \n        }"}),O=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[0,0,0],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;if(t<2||i<2)return;let n,h=[];for(let o=0;o<t;o++){let r=[];for(let a=0;a<i;a++)n=V(e,180*o/(t-1),360*a/(i-1),s),r.push(n);h.push(r)}let d,c,l,u,p,f,v,m,g,P,w,b,U,G,x=[],B=[],M=[];for(let y=0;y<t-1;y++)for(let t=0;t<i-1;t++)g=h[y][t],P=h[y+1][t],w=h[y+1][t+1],b=h[y][t+1],U=o.Ue(),G=o.Ue(),o.$X(U,w,g),o.$X(G,P,b),x.push([g[0],g[1],g[2],P[0],P[1],P[2],b[0],b[1],b[2],P[0],P[1],P[2],w[0],w[1],w[2],b[0],b[1],b[2]]),B.push([g[0]/e,g[1]/e,g[2]/e,P[0]/e,P[1]/e,P[2]/e,b[0]/e,b[1]/e,b[2]/e,P[0]/e,P[1]/e,P[2]/e,w[0]/e,w[1]/e,w[2]/e,b[0]/e,b[1]/e,b[2]/e]),d=r*(.5+Math.atan2(g[0]/e,g[2]/e)/Math.PI/2),c=r*(.5+Math.atan2(P[0]/e,P[2]/e)/Math.PI/2),l=r*(.5+Math.atan2(w[0]/e,w[2]/e)/Math.PI/2),u=r*(.5+Math.atan2(b[0]/e,b[2]/e)/Math.PI/2),p=a*(.5-Math.asin(g[1]/e)/Math.PI),f=a*(.5-Math.asin(P[1]/e)/Math.PI),v=a*(.5-Math.asin(w[1]/e)/Math.PI),m=a*(.5-Math.asin(b[1]/e)/Math.PI),M.push([d,p,c,f,u,m,c,f,l,v,u,m]);return{vertexData:new Float32Array(x.flat()),normalData:new Float32Array(B.flat()),uvData:new Float32Array(M.flat())}},V=function(e,t,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[0,0,0],r=Math.sin(t*Math.PI/180),a=Math.cos(t*Math.PI/180),n=Math.sin(i*Math.PI/180),h=Math.cos(i*Math.PI/180);return o.al(e*r*h+s[0],e*a+s[1],-e*r*n+s[2])};class A{constructor(e){this.app=void 0,this.objects=[],this.independentPipeline=!1,this.t=0,this.app=e}async init(){new y(this),new G(this),new M(this)}render(){this.independentPipeline?this.renderObject():this.renderScene(),this.t+=1}renderObject(){for(let e=0;e<this.objects.length;++e)this.objects[e].update(),this.objects[e].render()}renderScene(){this.app.renderer.webGPU.textureView=this.app.renderer.webGPU.ctx.getCurrentTexture().createView(),this.app.renderer.webGPU.renderPassDescription.colorAttachments[0].view=this.app.renderer.webGPU.textureView,this.app.renderer.webGPU.commandEncoder=this.app.renderer.webGPU.device.createCommandEncoder(),this.app.renderer.webGPU.renderPass=this.app.renderer.webGPU.commandEncoder.beginRenderPass(this.app.renderer.webGPU.renderPassDescription);for(let e=0;e<this.objects.length;++e)this.objects[e].update(),this.objects[e].render();this.t,this.app.renderer.webGPU.renderPass.end(),this.app.renderer.webGPU.device.queue.submit([this.app.renderer.webGPU.commandEncoder.finish()])}}class S{constructor(e){this.divHost=void 0,this.controller=void 0,this.renderer=void 0,this.scene=void 0,this.divHost=document.getElementById(e),this.renderer=new m(this),this.controller=new r(this),this.scene=new A(this),this.init()}async init(){this.controller.init(),await this.renderer.init(),await this.scene.init()}destroy(){for(this.renderer.destroy();this.divHost.lastElementChild;)this.divHost.removeChild(this.divHost.lastElementChild)}}class E{constructor(e){this.app=void 0,this.app=new S(e)}destroy(){this.app.destroy()}}},13958:(e,t,i)=>{i.d(t,{bD:()=>r,pg:()=>o,zM:()=>a});var s=i(39880);const r=async e=>fetch("".concat(e)).then((e=>e.text())).catch((e=>{console.debug(e)})),a=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0,0],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1];const a=s.Ue(),o=s.Ue(),n=s.Ue(),h=s.Ue(),d=s.Ue();s.vc(h,t),s.aC(a,i[0]),s.gT(o,i[1]),s.QO(n,i[2]),s.xJ(d,r),s.Jp(e,a,d),s.Jp(e,o,e),s.Jp(e,n,e),s.Jp(e,h,e)},o=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST;const s=e.createBuffer({size:t.byteLength,usage:i,mappedAtCreation:!0});return new Float32Array(s.getMappedRange()).set(t),s.unmap(),s}},74978:(e,t,i)=>{e.exports=i.p+"static/media/shader.a648953fc7ef088f1417.wgsl"},18207:(e,t,i)=>{e.exports=i.p+"static/media/shader.423f0c004ac30f0dd301.wgsl"}}]);
//# sourceMappingURL=87201.21667a07.chunk.js.map