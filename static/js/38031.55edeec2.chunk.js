"use strict";(self.webpackChunkNJS_Lab=self.webpackChunkNJS_Lab||[]).push([[38031],{38031:(t,i,e)=>{e.r(i),e.d(i,{Solution:()=>x});var s=e(17760),h=e(98925);class n{constructor(t){this.canvas=void 0,this.hostDiv=void 0,this.ctx=void 0,this.t=0,this.camera=void 0,this.scene=void 0,this.renderer=void 0,this.controls=void 0,this.requestFrame=void 0,this.loop=()=>{this.requestFrame=requestAnimationFrame(this.loop),this.controls.update(),this.update(this.scene),this.renderer.render(this.scene,this.camera),this.t+=.01},this.hostDiv=document.getElementById(t),this.initCanvas()}initCanvas(){s.Tme.DEFAULT_UP.set(0,0,1),this.scene=new s.xsS,this.scene.castShadow=!0,this.renderer=new s.CP7({antialias:!0,alpha:!0}),this.renderer.setPixelRatio(this.hostDiv.clientWidth/this.hostDiv.clientHeight),this.renderer.domElement.id="Three",this.renderer.domElement.style.position="absolute",this.renderer.shadowMap.enabled=!0,this.renderer.setSize(this.hostDiv.clientWidth,this.hostDiv.clientHeight),this.hostDiv.appendChild(this.renderer.domElement),this.camera=new s.cPb(30,this.hostDiv.clientWidth/this.hostDiv.clientHeight,1,5e3),this.controls=new h.OrbitControls(this.camera,this.renderer.domElement),this.camera.position.set(0,0,0),this.controls.update(),this.canvas=this.renderer.domElement,this.init()}init(){this.eventBind()}eventBind(){this.renderer.domElement.onmousedown=t=>this.mouseDown(t),this.renderer.domElement.onmouseup=t=>this.mouseUp(t),this.renderer.domElement.onmousemove=t=>this.mouseMove(t),this.renderer.domElement.addEventListener("click",(t=>this.mouseClick(t))),window.addEventListener("resize",(()=>this.onWindowResize()))}onWindowResize(){this.camera.aspect=this.hostDiv.clientWidth/this.hostDiv.clientHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.hostDiv.clientWidth,this.hostDiv.clientHeight)}start(){this.loop()}mouseDown(t){}mouseUp(t){}mouseClick(t){}mouseDClick(t){}mouseMove(t){}mouseDrag(t){}update(t){}destroy(){for(window.removeEventListener("resize",(()=>this.onWindowResize())),cancelAnimationFrame(this.requestFrame),this.requestFrame=void 0;this.hostDiv.lastChild;)this.hostDiv.removeChild(this.hostDiv.lastChild)}}var o=e(55913);class r{constructor(t){this.img=void 0,this.rx=20,this.ry=20,this.size=1,this.app=void 0,this.hostDiv=void 0,this.divMenu=void 0,this.divText=void 0,this.app=t,this.hostDiv=this.app.divMenu,this.initUI()}initUI(){const t=document.createElement("div");this.divMenu=t,this.hostDiv.appendChild(t),t.style.display="block",t.style.position="absolute",t.style.top="0px";const i=document.createElement("input");i.value="https://raw.githubusercontent.com/NamjuLee/data/master/img/heightMap/Heightmap_02.jpg",i.addEventListener("keydown",(t=>{"Enter"===t.code&&this.loadImg(i.value)})),t.appendChild(i);const e=l("rx",10,30);e.slider.defaultValue="20",t.appendChild(e.div),e.slider.oninput=()=>{const t=parseInt(e.slider.value);this.rx=t,this.update()};const s=l("ry",10,30);s.slider.defaultValue="20",t.appendChild(s.div),s.slider.oninput=()=>{const t=parseInt(s.slider.value);this.ry=t,this.update()};const h=l("rz",0,50);h.slider.defaultValue="10",t.appendChild(h.div),h.slider.oninput=()=>{const t=parseInt(h.slider.value);this.size=.1*t,this.update()},this.divText=document.createElement("div"),this.divText.textContent="",t.appendChild(this.divText)}loadImg(t){(0,o.t4)(t).then((t=>{this.img&&this.divMenu.removeChild(this.img),t.onload=i=>{this.divMenu.appendChild(t),this.img=t,this.update()}}))}update(){this.app.init(this.img)}destroy(){this.hostDiv.removeChild(this.divMenu)}}const l=(t,i,e)=>{const s=document.createElement("div");s.style.display="flex";const h=document.createElement("input");h.type="range",h.min="".concat(i),h.max="".concat(e);const n=document.createElement("div");return n.textContent=t,n.style.color="#aaa",s.appendChild(h),s.appendChild(n),{div:s,slider:h,text:n}};class a{constructor(){this.pixelList=[],this.minV=void 0,this.maxV=void 0,this.rx=10,this.ry=10,this.rz=2,this.intervalX=void 0,this.intervalY=void 0,this.selPixel=void 0}init(t,i,e,s){this.minV=t,this.maxV=i,this.rx=e,this.ry=s,this.pixelList=[];const h=this.minV.x,n=this.minV.y;this.intervalX=(this.maxV.x-this.minV.x)/(this.rx-1),this.intervalY=(this.maxV.y-this.minV.y)/(this.ry-1);for(let o=0;o<this.ry;o++)for(let t=0;t<this.rx;t++){const i=h+t*this.intervalX,e=n+o*this.intervalY;let s=new d(this,-1*i,e,0);s.xi=t,s.yi=o,this.pixelList.push(s)}this.initGridNeighbor()}initGridNeighbor(){for(let t=0;t<this.ry;++t)for(let i=0;i<this.rx;++i){let e=i+t*this.rx,s=this.pixelList[e];i>0&&s.nPix.push(this.pixelList[e-1]),i<this.rx-1&&s.nPix.push(this.pixelList[e+1]),t>0&&s.nPix.push(this.pixelList[e-this.rx]),t<this.ry-1&&s.nPix.push(this.pixelList[e+this.rx]),i>0&&t<this.ry-1&&s.nPix.push(this.pixelList[e+this.rx-1]),i>0&&t>0&&s.nPix.push(this.pixelList[e-this.rx-1]),i<this.rx-1&&t<this.ry-1&&s.nPix.push(this.pixelList[e+this.rx+1]),i<this.rx-1&&t>0&&s.nPix.push(this.pixelList[e-this.rx+1])}}updateImage(t){const i=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});i.drawImage(t,0,0,t.width,t.height,0,0,this.rx,this.ry);const e=i.getImageData(0,0,this.rx,this.ry);for(let s=0;s<this.ry;++s)for(let t=0;t<this.rx;++t){let i=4*t+s*e.width*4,h=t+s*this.rx;this.pixelList[h].color=[e.data[i],e.data[i+1],e.data[i+2],e.data[i+3]],this.pixelList[h].vec.z=m(e.data[i]/255,e.data[i+1]/255,e.data[i+2]/255)*this.rz}}picking(t,i,e){const s=new c(t,i,e);let h=Number.MAX_VALUE,n=-1;for(let o=0;o<this.pixelList.length;++o){const t=p(this.pixelList[o].vec,s);h>t&&(h=t,n=o),this.pixelList[o].hover=!1}return this.selPixel=void 0,n>-1&&(this.pixelList[n].hover=!0,this.selPixel=this.pixelList[n]),this.selPixel}render(t){this.pixelList.forEach((i=>{i.render(t)})),this.selPixel&&this.selPixel.render(t)}onClick(t,i,e){return this.picking(t,i,e)}}class d{constructor(t,i,e,s){this.xi=void 0,this.yi=void 0,this.pMap=void 0,this.vec=void 0,this.hover=!1,this.nPix=[],this.color=[],this.mesh=void 0,this.pMap=t,this.vec=new c(i,e,s)}render(t){const i=this.pMap.intervalX,e=this.pMap.intervalY;if(t.beginPath(),t.rect(this.vec.x-.5*i,this.vec.y-.5*e,i,e),t.closePath(),t.stroke(),this.hover?(t.fillStyle="#555",t.fill()):(t.fillStyle="rgba(".concat(this.color[0],", ").concat(this.color[1],", ").concat(this.color[2],", ").concat(this.color[3],")"),t.fill()),t.beginPath(),t.arc(this.vec.x,this.vec.y,this.vec.r,0,2*Math.PI),t.closePath(),this.hover?t.fillStyle="#999":t.fillStyle="#333",t.fill(),this.hover){for(let i=0;i<this.nPix.length;++i)t.beginPath(),t.moveTo(this.vec.x,this.vec.y),t.lineTo(this.nPix[i].vec.x,this.nPix[i].vec.y),t.closePath(),t.stroke();t.strokeText("x: ".concat(this.xi,", y: ").concat(this.yi),this.vec.x,this.vec.y)}}}class c{constructor(t,i,e){this.x=0,this.y=0,this.z=0,this.r=3,this.x=t,this.y=i,this.z=e}}const p=(t,i)=>Math.sqrt(v(t,i)),v=(t,i)=>(t.x-i.x)*(t.x-i.x)+(t.y-i.y)*(t.y-i.y)+(t.z-i.z)*(t.z-i.z),m=(t,i,e)=>.2126*t+.7152*i+.0722*e;class x{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"main";this.controller=void 0,this.renderer=void 0,this.pMap=void 0,this.canvas=void 0,this.divMain=void 0,this.divMenu=void 0;const i=document.getElementById(t);this.divMain=i;const e=document.createElement("div");this.divMenu=e,e.style.height="50px",e.style.position="absolute",e.style.backgroundColor="#f00",e.style.zIndex="1",i.append(e),this.controller=new r(this);const s=document.createElement("div");s.id="pMap",s.style.width="100%",s.style.height="100%",i.append(s),this.renderer=new u(s.id),this.controller.loadImg("https://upload.wikimedia.org/wikipedia/commons/5/57/Heightmap.png")}init(t){this.pMap=new a,this.pMap.rx=this.controller.rx,this.pMap.ry=this.controller.ry,this.pMap.rz=this.controller.size,this.pMap.init(new c(10,10,0),new c(-10,-10,0),this.controller.rx,this.controller.ry),this.pMap.updateImage(t),this.renderer.updatePoint(this.pMap),this.renderer.onClickBind=(t,i,e)=>{const s=this.pMap.onClick(t,i,e);this.controller.divText.textContent="Elevation: ".concat(s.vec.z,", Col: ").concat(s.color)}}destroy(){this.renderer.destroy();try{for(;void 0!==this.divMain&&void 0!==this.divMain.lastElementChild;)this.divMain.removeChild(this.divMain.lastElementChild)}catch(t){}}}class u extends n{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"main"),this.canvas=void 0,this.pointLight=void 0,this.rayCaster=new s.iMs,this.mouse2=new s.FM8,this.m=void 0,this.sphere=void 0,this.preSelection=void 0,this.meshList=[],this.pointLight=new s.cek(16777215,.75),this.pointLight.position.x=80,this.pointLight.position.z=80,this.scene.add(this.pointLight),this.canvas=document.createElement("canvas"),this.hostDiv.append(this.canvas),this.renderer.setClearColor(0,0),this.scene.background=null,this.camera.position.set(0,-80,80);const t=new s.vBJ({color:65280}),i=new s.xo$(.05,50,50),e=new s.Kj0(i,t);e.translateX(1),this.sphere=e,this.scene.add(e),this.start()}updatePoint(t){this.scene.remove(...this.meshList),this.preSelection=void 0,this.meshList=[];for(let i=0;i<t.pixelList.length;++i){const e=t.pixelList[i].vec,h=t.pixelList[i].color,n=new s.xo$(.25,8,8),o=new s.vBJ({color:new s.Ilk(h[0]/255,h[1]/255,h[2]/255)}),r=new s.Kj0(n,o);r.userData.pixel=t.pixelList[i],t.pixelList[i].mesh=r,this.meshList.push(r),r.position.set(e.x,e.y,e.z),this.scene.add(r)}}mouseClick(t){const i=y(t,this.meshList,this.renderer,this.camera,this.rayCaster,this.mouse2);if(i){if(this.preSelection){this.preSelection.material.color.setRGB(this.preSelection.userData.pixel.color[0]/255,this.preSelection.userData.pixel.color[1]/255,this.preSelection.userData.pixel.color[2]/255)}this.m=new s.Pa4(i.mouse3.x,i.mouse3.y,i.mouse3.z),this.sphere.position.set(this.m.x,this.m.y,this.m.z),this.onClickBind(this.m.x,this.m.y,this.m.z);const t=i.mesh[0].object;return t.material.color.setHex(16711680),void(this.preSelection=t)}this.m=void 0}onClickBind(t,i,e){}}const y=(t,i,e,h,n,o)=>{o.x=t.offsetX/e.domElement.clientWidth*2-1,o.y=-t.offsetY/e.domElement.clientHeight*2+1,n.setFromCamera(o,h);const r=n.intersectObjects([...i]);if(r.length>0)return{mesh:r,mouse3:new s.Pa4(r[0].point.x,r[0].point.y,r[0].point.z)}}}}]);
//# sourceMappingURL=38031.55edeec2.chunk.js.map