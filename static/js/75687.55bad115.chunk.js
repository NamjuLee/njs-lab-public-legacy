"use strict";(self.webpackChunkNJS_Lab=self.webpackChunkNJS_Lab||[]).push([[75687],{75687:(e,t,i)=>{i.r(t),i.d(t,{App:()=>w,Solution:()=>b});class s{constructor(e){this.app=void 0,this.pos=[0,0],this.isDown=!1,this.app=e}init(){this.appendEvent()}appendEvent(){this.app.renderer.canvas.addEventListener("ondrag",(e=>{}),!1),this.app.renderer.canvas.addEventListener("click",(e=>{}),!1),this.app.renderer.canvas.addEventListener("dblclick",(e=>{}),!1),this.app.renderer.canvas.addEventListener("drag",(e=>{}),!0),this.app.renderer.canvas.addEventListener("mouseup",(e=>{}),!1),this.app.renderer.canvas.addEventListener("mousedown",(e=>{this.isDown=!0,this.pos[0]=e.offsetX,this.pos[1]=e.offsetY}),!1),this.app.renderer.canvas.addEventListener("mouseup",(e=>{this.isDown=!1}),!1),this.app.renderer.canvas.addEventListener("mousemove",(e=>{if(this.isDown){const t=this.pos[0]-e.offsetX,i=this.pos[1]-e.offsetY;this.app.renderer.cameraController.arcRotation(t,i),this.pos[0]=e.offsetX,this.pos[1]=e.offsetY}}),!1),this.app.renderer.canvas.addEventListener("wheel",(e=>{this.app.renderer.cameraController.zoomWheel(e.deltaY)}),!1)}}var r=i(39880),a=i(88679),n=i(99874);class o{constructor(e){this.solution=void 0,this.canvas=void 0,this.camera=void 0,this.modelMatrix=r.Ue(),this.mvpMatrix=r.Ue(),this.rotation=a.al(0,0,0),this.translation=a.al(0,0,0),this.screen2=n.al(0,0),this.angleXY=2.5,this.angleZ=.6,this.distance=5,this.solution=e,this.canvas=e.canvas;const t=a.al(2.6451475620269775,-3.130298137664795,2.864337205886841),i=a.al(0,0,0),s=a.al(0,0,1);this.camera=new h(this.canvas.width/this.canvas.height,t,i,s),this.update()}zoomWheel(e){this.distance+=.01*e,this.arcRotation(0,0)}update(){this.camera.update(),d(this.modelMatrix,this.translation,this.rotation),r.Jp(this.mvpMatrix,this.camera.viewProjectionMatrix,this.modelMatrix)}rotateZ(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.1;this.rotation[2]+=e,this.update()}translateX(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.1;this.translation[0]+=e,this.update()}get getMatrix(){return this.mvpMatrix}arcRotation(e,t){e*=.01,t*=.01,this.angleXY-=e,this.angleZ-=t,this.camera.eye[0]=this.camera.center[0]+Math.sin(this.angleXY)*Math.cos(this.angleZ)*this.distance,this.camera.eye[1]=this.camera.center[1]+Math.cos(this.angleXY)*Math.cos(this.angleZ)*this.distance,this.camera.eye[2]=this.camera.center[2]+Math.sin(this.angleZ)*this.distance,this.update()}}class h{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[2,2,4],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0,0],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[0,1,0];this.viewMatrix=r.Ue(),this.projectionMatrix=r.Ue(),this.viewProjectionMatrix=r.Ue(),this.zoomMax=100,this.zoomSpeed=2,this.near=.01,this.far=1e4,this.mvpMatrix=r.Ue(),this.eye=a.al(2.6451475620269775,-3.130298137664795,2.864337205886841),this.center=a.al(0,0,0),this.up=a.al(0,1,0),this.eye=t,this.center=i,this.up=s,r.G3(this.projectionMatrix,2*Math.PI/5,e,this.near,this.far),this.update()}update(){r.zB(this.viewMatrix,this.eye,this.center,this.up),r.Jp(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix)}}const d=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0,0],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1];const a=r.Ue(),n=r.Ue(),o=r.Ue(),h=r.Ue(),d=r.Ue();r.vc(h,t),r.aC(a,i[0]),r.gT(n,i[1]),r.QO(o,i[2]),r.xJ(d,s),r.Jp(e,a,d),r.Jp(e,n,e),r.Jp(e,o,e),r.Jp(e,h,e)};let c;!function(e){e.PointList="point-list",e.LineList="line-list",e.LineStrip="line-strip",e.TriangleList="triangle-list",e.TriangleStrip="triangle-strip"}(c||(c={}));class p{constructor(e){this.renderer=void 0,this.ctx=void 0,this.device=void 0,this.format=void 0,this.commandEncoder=void 0,this.PrimitiveTopology=c,this.renderer=e}async initWebGPU(){if(!navigator.gpu)throw new Error("Not Support WebGPU");const e=await navigator.gpu.requestAdapter({powerPreference:"high-performance"});if(!e)throw new Error("No Adapter Found");const t=await e.requestDevice();this.ctx=this.renderer.canvas.getContext("webgpu"),this.format="bgra8unorm",this.ctx.configure({device:t,format:this.format,alphaMode:"opaque"}),this.device=t}destroy(){this.device.destroy()}}class l{constructor(e){this.app=void 0,this.canvas=void 0,this.cameraController=void 0,this.webGPU=void 0,this.isAnimation=!0,this.requestAni=void 0,this.loop=()=>{this.isAnimation&&(this.requestAni=requestAnimationFrame(this.loop)),this.drawing()},this.app=e,this.canvas=document.createElement("canvas"),this.canvas.width=this.app.divHost.clientWidth,this.canvas.height=this.app.divHost.clientHeight,this.app.divHost.appendChild(this.canvas),this.canvas.addEventListener("resize",(()=>{})),this.webGPU=new p(this)}async init(){await this.webGPU.initWebGPU(),this.cameraController=new o(this),this.requestAni=requestAnimationFrame(this.loop)}drawing(){this.app.scene.render()}destroy(){for(this.webGPU.destroy(),cancelAnimationFrame(this.requestAni);this.app.divHost.lastElementChild;)this.app.divHost.removeChild(this.app.divHost.lastElementChild)}}class u{constructor(e){this.scene=void 0,this.webGPU=void 0,this.scene=e,this.webGPU=e.app.renderer.webGPU,this.scene.objects.push(this)}async initPipeline(){}update(){}render(){}}const v=i(84802);class f extends u{constructor(e){super(e),this.buffer=void 0,this.bufferLayout=void 0,this.uniformBuffer=void 0,this.pipeline=void 0,this.bindGroup=void 0,this.t=0,this.isRenderable=!1;const t=new Float32Array([0,0,1.5,1,0,0,0,-1.5,-1.5,0,1,0,0,1.5,-1.5,0,0,1]),i=GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST,s={size:t.byteLength,usage:i,mappedAtCreation:!0};this.buffer=this.webGPU.device.createBuffer(s),new Float32Array(this.buffer.getMappedRange()).set(t),this.buffer.unmap(),this.bufferLayout={arrayStride:24,attributes:[{shaderLocation:0,format:"float32x3",offset:0},{shaderLocation:1,format:"float32x3",offset:12}]},this.initPipeline()}async initPipeline(){this.uniformBuffer=this.webGPU.device.createBuffer({size:192,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});const e=this.webGPU.device.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{}}]});this.bindGroup=this.webGPU.device.createBindGroup({layout:e,entries:[{binding:0,resource:{buffer:this.uniformBuffer}}]});const t=this.webGPU.device.createPipelineLayout({bindGroupLayouts:[e]}),i=await(async e=>fetch("".concat(e)).then((e=>e.text())).catch((e=>{console.debug(e)})))(v);this.pipeline=this.webGPU.device.createRenderPipeline({vertex:{module:this.webGPU.device.createShaderModule({code:i}),entryPoint:"vs_main",buffers:[this.bufferLayout]},fragment:{module:this.webGPU.device.createShaderModule({code:i}),entryPoint:"fs_main",targets:[{format:this.webGPU.format}]},primitive:{topology:"triangle-list"},layout:t}),this.isRenderable=!0}render(){if(!this.isRenderable)return;this.t+=.01,this.t,Math.PI;let e=r.Ue();const t=Math.PI/4,i=this.webGPU.renderer.canvas.width/this.webGPU.renderer.canvas.height;r.G3(e,t,i,.1,10);let s=r.Ue();const n=a.al(-2,0,2),o=a.al(0,0,0),h=a.al(0,0,1);r.zB(s,n,o,h);const d=r.Ue();r.Iu(d,d,[Math.sin(this.t),0,0]);e=this.webGPU.renderer.cameraController.camera.projectionMatrix,s=this.webGPU.renderer.cameraController.camera.viewMatrix,this.webGPU.device.queue.writeBuffer(this.uniformBuffer,0,d),this.webGPU.device.queue.writeBuffer(this.uniformBuffer,64,s),this.webGPU.device.queue.writeBuffer(this.uniformBuffer,128,e);const c=this.webGPU.device.createCommandEncoder(),p=this.webGPU.ctx.getCurrentTexture().createView(),l=c.beginRenderPass({colorAttachments:[{view:p,clearValue:{r:0,g:0,b:0,a:1},loadOp:"clear",storeOp:"store"}]});l.setPipeline(this.pipeline),l.setVertexBuffer(0,this.buffer),l.setBindGroup(0,this.bindGroup),l.draw(3,1,0,0),l.end(),this.webGPU.device.queue.submit([c.finish()])}}class m{constructor(e){this.app=void 0,this.objects=[],this.t=0,this.app=e}async init(){new f(this)}render(){for(let e=0;e<this.objects.length;++e)this.objects[e].update(),this.objects[e].render();this.t,this.t+=.1}}class w{constructor(e){this.divHost=void 0,this.controller=void 0,this.renderer=void 0,this.scene=void 0,this.divHost=document.getElementById(e),this.renderer=new l(this),this.controller=new s(this),this.scene=new m(this),this.init()}async init(){this.controller.init(),await this.renderer.init(),await this.scene.init()}destroy(){for(this.renderer.destroy();this.divHost.lastElementChild;)this.divHost.removeChild(this.divHost.lastElementChild)}}class b{constructor(e){this.app=void 0,this.app=new w(e)}destroy(){this.app.destroy()}}},84802:(e,t,i)=>{e.exports=i.p+"static/media/shaders.e990e63b41897d82dc9c.wgsl"}}]);
//# sourceMappingURL=75687.55bad115.chunk.js.map