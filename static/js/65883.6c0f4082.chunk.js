"use strict";(self.webpackChunkNJS_Lab=self.webpackChunkNJS_Lab||[]).push([[65883],{54078:(t,e,i)=>{i.d(e,{B:()=>o});var s=i(458);class o{constructor(t){this.gl=void 0,this.program=void 0,this.fragmentShader=void 0,this.vertexShader=void 0,this.matrixLocation=void 0,this.posBuffer=void 0,this.colBuffer=void 0,this.vertexs=void 0,this.posLocAtt=void 0,this.colLocAtt=void 0,this.matLoc=void 0,this.colLoc=void 0,this.cVecLoc=void 0,this.mouseLoc=void 0,this.timeGL=void 0,this.vShader=void 0,this.fShader=void 0,this.v="\n    attribute vec2 a_position;\n    attribute vec4 a_color;\n    \n    varying vec4 f_color;\n\n    void main() {\n\n        vec2 mouse_distance = vec2(0,0) - (a_position.xy /vec2(2,2));\n        float red = 1.0 - length(mouse_distance);\n        f_color = vec4(a_position, 0, 1.0);\n    \n        // float dis = distance(vec2(a_position.xy), vec2(0,0));\n\n        // f_color = vec4(dis * 0.6, 0,0,1);\n        gl_Position = vec4( a_position, 0, 1);\n    }\n    ",this.f="\n    precision highp float;\n\n    varying vec4 f_color;\n    \n    void main() {\n        vec2 mouse_distance = vec2(0,0) - (f_color.xy /vec2(5,5));\n\n        float col =  length(mouse_distance*5.);\n        float val = 1.0 - length(mouse_distance*8.);\n        \n        gl_FragColor = vec4(0.19,0.19,0.19, col);\n\n    }\n    ",this.positionAttribLocation=void 0,this.colorAttribLocation=void 0,this.translation=void 0,this.color=void 0,this.colArray=void 0,this.gl=t,this.color=[Math.random(),Math.random(),Math.random(),1],this.InitShader()}InitShader(){let t=s.Ui.CreateShader(this.gl,this.gl.VERTEX_SHADER,this.v),e=s.Ui.CreateShader(this.gl,this.gl.FRAGMENT_SHADER,this.f);if(t&&e){this.vShader=t,this.fShader=e;let i=s.Ui.CreateProgram(this.gl,t,e);i&&(this.program=i)}}Render(t){let e=[.1,0,0,1];this.vertexs=new Float32Array([-1,-1,1,1,1,1,-1,1,e[0],e[1],e[2],e[3],1,-1,e[0],e[1],e[2],e[3],-1,1,1,1,1,1,1,-1,e[0],e[1],e[2],e[3],1,1,e[0],e[1],e[2],e[3]]),this.posBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.posBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(this.vertexs),t.STATIC_DRAW),this.posLocAtt=this.gl.getAttribLocation(this.program,"a_position");let i=t.FLOAT,s=6*Float32Array.BYTES_PER_ELEMENT,o=0;t.vertexAttribPointer(this.posLocAtt,2,i,!1,s,o),t.enableVertexAttribArray(this.posLocAtt),t.useProgram(this.program);let n=t.TRIANGLES;o=0;t.drawArrays(n,o,6)}}},65883:(t,e,i)=>{i.r(e),i.d(e,{MercatorProjection:()=>m,Solution:()=>v});var s=i(17760),o=i(55913),n=i(54078),r=i(87968),h=i(12554);class a{constructor(t){this.solution=void 0,this.streetOSM=[],this.routesTreated=[],this.routesControl=[],this.zones30=[],this.zones15=[],this.routesMain=[],this.meshTwitter=void 0,this.meshStreetOSM=void 0,this.meshNode=void 0,this.meshTreated=void 0,this.meshControl=void 0,this.meshMainStreet=void 0,this.meshZones30=void 0,this.meshPolygon=void 0,this.polygonRingID={},this.polygonRings=void 0,this.yearForPolygonMesh=void 0,this.selectedYear=2009,this.renderMultiPolygon=(t,e,i)=>{const o=[],n=[];for(let r=0;r<e.length;++r){const h=e[r];for(let e=0;e<h.length;++e){const r=h[e];if(1===r.length){const e=r[0],h=[];for(let t=0;t<e.length;++t){const[i,o]=this.solution.projectionToMercator(e[t][0],e[t][1]);n.push(i,0,o),h.push(new s.FM8(i,o))}let a=new s.oa8(new s.bnF(h)),l=new s.vBJ({side:s.ehD,color:new s.Ilk(i[0],i[1],i[2]),transparent:!0,opacity:.3}),c=new s.Kj0(a,l);t.add(c),o.push(c),c.rotateOnAxis(new s.Pa4(1,0,0),.5*Math.PI)}}}return o},this.renderPoints=(t,e)=>{const i=new s.u9r,o=new s.UY4({vertexColors:!0,size:.5}),n=[],r=[];for(let s=0;s<t.length;++s){const i=t[s];for(let t=0;t<i.length;++t)for(let s=0;s<i[t].length;++s){const[o,h]=this.solution.projectionToMercator(i[t][s][0],i[t][s][1]);n.push(o,0,h),r.push(e[0],e[1],e[2])}}i.setAttribute("position",new s.a$l(n,3)),i.setAttribute("color",new s.a$l(r,3)),i.computeBoundingSphere();const h=new s.woe(i,o);return this.solution.scene.add(h),h},this.solution=t,(0,r.getJSONFromURL)("https://raw.githubusercontent.com/NamjuLee/data/master/Paris/street_osm.geojson").then((t=>{for(let i=0;i<t.features.length;++i)this.streetOSM.push(t.features[i].geometry.coordinates);let e=[0,1,1];this.solution.PARAM.colorSOMStreet&&(e=(0,r.hexToRGBANormalized)("#"+this.solution.PARAM.colorSOMStreet),this.solution.ui.isActive_streetOSM=!0),this.meshStreetOSM=this.LineSeg(this.streetOSM,e,-.01),this.solution.start()})),(0,r.getJSONFromURL)("https://raw.githubusercontent.com/NamjuLee/data/master/Paris/Paris-main-st.geojson").then((t=>{for(let i=0;i<t.features.length;++i)this.routesMain.push(t.features[i].geometry.coordinates);let e=[0,1,1];this.solution.PARAM.colorMainStreet&&(e=(0,r.hexToRGBANormalized)("#"+this.solution.PARAM.colorMainStreet),this.solution.ui.isActiveMainStreet=!0),this.meshMainStreet=this.LineSeg(this.routesMain,e)})),(0,r.getJSONFromURL)("https://raw.githubusercontent.com/NamjuLee/data/master/Paris/treated-st.geojson").then((t=>{for(let i=0;i<t.features.length;++i)this.routesTreated.push(t.features[i].geometry.coordinates);let e=[0,1,1];this.solution.PARAM.colorTreatedStreet&&(e=(0,r.hexToRGBANormalized)("#"+this.solution.PARAM.colorTreatedStreet),this.solution.ui.isActive_treated_st=!0),this.meshTreated=this.LineSeg(this.routesTreated,e)})),(0,r.getJSONFromURL)("https://raw.githubusercontent.com/NamjuLee/data/master/Paris/control-st.geojson").then((t=>{for(let i=0;i<t.features.length;++i)this.routesControl.push(t.features[i].geometry.coordinates);let e=[0,1,1];this.solution.PARAM.colorControlStreet&&(e=(0,r.hexToRGBANormalized)("#"+this.solution.PARAM.colorControlStreet),this.solution.ui.isActive_control_st=!0),this.meshControl=this.LineSeg(this.routesControl,e)})),(0,r.getJSONFromURL)("https://raw.githubusercontent.com/NamjuLee/data/master/Paris/zones-30.geojson").then((t=>{for(let i=0;i<t.features.length;++i)this.zones30.push(t.features[i].geometry.coordinates);let e=[0,1,1];this.solution.PARAM.colorZones30&&(e=(0,r.hexToRGBANormalized)("#"+this.solution.PARAM.colorZones30),this.solution.ui.isActive_zones_30=!0),this.meshZones30=this.renderMultiPolygon(this.solution.scene,this.zones30,e)}));let e="https://raw.githubusercontent.com/NamjuLee/data/master/Paris/zones_15_innerouter_byyr_rings.json";h.xf.urlZone&&(e=h.xf.urlZone),(0,r.getJSONFromURL)(e).then((t=>{let e=[0,1,1];this.solution.PARAM.colorYearPolygon&&(e=(0,r.hexToRGBANormalized)("#"+this.solution.PARAM.colorYearPolygon)),this.solution.PARAM.year&&(this.selectedYear=this.solution.PARAM.year),this.polygonRings=this.renderCustomPolygon(t,e),this.updateYear(this.selectedYear)}))}updateYear(t){if(this.selectedYear=t+1,void 0!==this.yearForPolygonMesh)for(let e=2010;e<2016;++e){this.yearForPolygonMesh[e].forEach((t=>{e<this.selectedYear?t.visible=!0:t.visible=!1}))}}updateColor(t){const e=(0,r.hexToRGBANormalized)(t);if(void 0!==this.meshMainStreet&&this.solution.ui.isActiveMainStreet){let t=this.meshMainStreet.material;t.color.r=e[0],t.color.g=e[1],t.color.b=e[2]}if(void 0!==this.meshStreetOSM&&this.solution.ui.isActive_streetOSM){let t=this.meshStreetOSM.material;t.color.r=e[0],t.color.g=e[1],t.color.b=e[2]}if(void 0!==this.meshTreated&&this.solution.ui.isActive_treated_st){let t=this.meshTreated.material;t.color.r=e[0],t.color.g=e[1],t.color.b=e[2]}if(void 0!==this.meshControl&&this.solution.ui.isActive_control_st){let t=this.meshControl.material;t.color.r=e[0],t.color.g=e[1],t.color.b=e[2]}void 0!==this.meshZones30&&this.solution.ui.isActive_zones_30&&this.meshZones30.forEach((t=>{let i=t.material;i.color.r=e[0],i.color.g=e[1],i.color.b=e[2]})),void 0!==this.solution.dataTwitter&&this.solution.ui.isActive_twitter&&this.solution.dataTwitter.updateColor(e[0],e[1],e[2])}update(){void 0!==this.meshMainStreet&&(this.solution.ui.isActiveMainStreet?this.meshMainStreet.visible=!0:this.meshMainStreet.visible=!1),void 0!==this.meshStreetOSM&&(this.solution.ui.isActive_streetOSM?this.meshStreetOSM.visible=!0:this.meshStreetOSM.visible=!1),void 0!==this.meshTreated&&(this.solution.ui.isActive_treated_st?this.meshTreated.visible=!0:this.meshTreated.visible=!1),void 0!==this.meshControl&&(this.solution.ui.isActive_control_st?this.meshControl.visible=!0:this.meshControl.visible=!1),void 0!==this.meshZones30&&(this.solution.ui.isActive_zones_30?this.meshZones30.forEach((t=>{t.visible=!0})):this.meshZones30.forEach((t=>{t.visible=!1}))),void 0!==this.solution.dataTwitter.mesh&&(this.solution.ui.isActive_twitter?this.solution.dataTwitter.mesh.visible=!0:this.solution.dataTwitter.mesh.visible=!1)}renderCustomPolygon(t,e){const i={};for(const[s,r]of Object.entries(t.yr)){const t=r;t in i?i[t].push(+s):i[t]=[+s]}const o={};this.polygonRingID=i;let n=0;for(const[h,a]of Object.entries(this.polygonRingID)){const i=[];for(let o=0;o<a.length;++o){const h=a[o],l=(t.value_mn_rescale[h],[]);for(let e=0;e<t.outer_ring[h].length;++e){const[i,s]=this.solution.projectionToMercator(t.outer_ring[h][e][0],t.outer_ring[h][e][1]);l.push(new r.Vector3(i,s))}const c=new s.bnF(l);for(let e=0;e<t.inner_rings[h].length;++e){const i=new s.y$t;let[o,n]=this.solution.projectionToMercator(t.inner_rings[h][e][0][0],t.inner_rings[h][e][0][1]);i.moveTo(o,n);for(let s=1;s<t.inner_rings[h][e].length;++s){let[o,n]=this.solution.projectionToMercator(t.inner_rings[h][e][s][0],t.inner_rings[h][e][s][1]);i.lineTo(o,n)}c.holes.push(i)}let d=new s.oa8(c);const u=new s.Ilk(16777215);u.setRGB(e[0],e[1],e[2]);let v=new s.vBJ({side:s.ehD,color:u,transparent:!0,opacity:.85}),m=new s.Kj0(d,v);m.translateY(1e-4*n++),m.visible=!0,this.solution.scene.add(m),m.rotateOnAxis(new s.Pa4(1,0,0),.5*Math.PI),i.push(m)}o[h]=i}this.yearForPolygonMesh=o}LineSeg(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const o=new s.u9r,n=new s.nls;n.color.r=e[0],n.color.g=e[1],n.color.b=e[2];const r=[],h=[],a=[];for(let s=0;s<t.length;++s){const o=t[s];for(let t=0;t<o.length;++t)for(let s=0;s<o[t].length;++s){const[n,l]=this.solution.projectionToMercator(o[t][s][0],o[t][s][1]);r.push(n,i,l),h.push(e[0],e[1],e[2]),s<o[t].length-1&&a.push(Math.floor(r.length/3)-1,Math.floor(r.length/3))}}o.setIndex(a),o.setAttribute("position",new s.a$l(r,3)),o.setAttribute("color",new s.a$l(h,3)),o.computeBoundingSphere();const l=new s.ejS(o,n);return this.solution.scene.add(l),l}}class l{constructor(t){this.solution=void 0,this.active=!1,this.dataRaw=void 0,this.mesh=void 0,this.t=0,this.dataScale=1,this.colorScale=1,this.pos=void 0,this.color="#0ff",this.material=void 0,this.dotG=0,this.dotB=0,this.solution=t;let e="https://raw.githubusercontent.com/NamjuLee/data/master/Paris/real_data_buffersonly.json";h.xf.url&&(e=h.xf.url),h.xf.dotG&&(this.dotG=+h.xf.dotG/255),h.xf.dotB&&(this.dotB=+h.xf.dotB/255),(0,r.getJSONFromURL)(e).then((t=>{this.dataRaw=t,this.initMesh("noNeighbsLog"),this.solution.updateParam()}))}initMesh(t){const e=[],i=[];this.dataRaw.meta["domain_"+t];for(let s=0;s<this.dataRaw.cells.length;++s){const o=this.dataRaw.cells[s],[n,r]=this.solution.projectionToMercator(+o.lon,+o.lat);let h=+o[t];h/=2;const a=[h,h,0];e.push(n,h*this.dataScale,r),i.push(a[0],a[1],a[2])}const o=new s.u9r,n=new s.UY4({vertexColors:!0,size:.5});this.material=n,this.pos=new Float32Array(e),o.setAttribute("position",new s.a$l(this.pos,3)),o.setAttribute("color",new s.a$l(i,3)),o.computeBoundingSphere(),this.mesh=new s.woe(o,n),this.solution.scene.add(this.mesh),this.active=!0}updateColor(t,e,i){this.material.color.setRGB(t,e,i)}updateMesh(t){this.active=!1,this.removeMesh(),this.initMesh(t)}removeMesh(){this.solution.scene.remove(this.mesh)}update(){this.active&&(this.t+=.05,this.updateAnimation())}updateAnimation(){let t=this.mesh.geometry.attributes.position.count;for(let e=0;e<t;e++){let t=this.mesh.geometry.attributes.position,i=t.getX(e),o=t.getZ(e),n=this.pos[3*e+1]*this.dataScale;n*=1+Math.sin(i+n+this.t)*Math.cos(i+n+this.t),n=n<.1?.1:n;let r=new s.Pa4(i,n,o);this.mesh.geometry.attributes.position.setXYZ(e,r.x,r.y,r.z);const h=n/this.colorScale;this.mesh.geometry.attributes.color.setXYZ(e,h,this.dotG,this.dotB)}this.mesh.geometry.attributes.position.needsUpdate=!0,this.mesh.geometry.attributes.color.needsUpdate=!0,this.mesh.geometry.computeVertexNormals()}}class c{constructor(t){this.solution=void 0,this.hostDiv=void 0,this.isActiveMainStreet=!0,this.isActive_streetOSM=!1,this.isActive_treated_st=!1,this.isActive_control_st=!1,this.isActive_zones_30=!1,this.isActive_zones_buffer=!1,this.isActive_twitter=!1,this.year=2010,this.divCameraPos=void 0,this.solution=t,this.hostDiv=t.hostDiv,void 0!==this.solution.PARAM.local_ui?!0===this.solution.PARAM.local_ui&&this.appendUI():this.appendUI()}appendUI(){const t=document.createElement("div");t.style.position="absolute",t.style.margin="5px",this.hostDiv.append(t);const e=document.createElement("dv");e.style.display="flex",e.style.marginBottom="10px",e.textContent="pos target",this.divCameraPos=e,t.append(e);const i=document.createElement("input");t.append(i),i.type="color",i.oninput=()=>{this.solution.drawing.updateColor(i.value)};let s=d("main street");t.append(s.div),s.checkBox.checked=!0,s.checkBox.onchange=()=>{!0===s.checkBox.checked?this.isActiveMainStreet=!0:this.isActiveMainStreet=!1};let o=d("OSM street");t.append(o.div),o.checkBox.onchange=()=>{!0===o.checkBox.checked?this.isActive_streetOSM=!0:this.isActive_streetOSM=!1};let n=d("treated street");t.append(n.div),n.checkBox.onchange=()=>{!0===n.checkBox.checked?this.isActive_treated_st=!0:this.isActive_treated_st=!1};let r=d("control street");t.append(r.div),r.checkBox.onchange=()=>{!0===r.checkBox.checked?this.isActive_control_st=!0:this.isActive_control_st=!1};let h=d("zones 30");t.append(h.div),h.checkBox.onchange=()=>{!0===h.checkBox.checked?this.isActive_zones_30=!0:this.isActive_zones_30=!1};let a=u("Year");a.div.style.marginTop="25px",a.text.textContent="Year: 2019",t.append(a.div),a.slider.oninput=()=>{this.year=+a.slider.value,a.text.textContent="Year: "+a.slider.value,this.solution.drawing.updateYear(+a.slider.value)};let l=d("twitter data");l.div.style.marginTop="25px",t.append(l.div),l.checkBox.onchange=()=>{!0===l.checkBox.checked?this.isActive_twitter=!0:this.isActive_twitter=!1};let c=u("Scale","1","10");c.text.textContent="Scale: 1",t.append(c.div),c.slider.defaultValue="1",c.slider.oninput=()=>{this.year=+c.slider.value,c.text.textContent="Scale: "+c.slider.value,this.solution.dataTwitter.dataScale=+c.slider.value};let v=u("Color","1.","50.");v.text.textContent="Color: 1",t.append(v.div),v.slider.defaultValue="1",v.slider.oninput=()=>{this.year=+v.slider.value,v.text.textContent="Color: "+v.slider.value,this.solution.dataTwitter.colorScale=+v.slider.value};let m=d("Animation");m.checkBox.defaultChecked=!0,t.append(m.div),m.checkBox.onchange=()=>{!0===m.checkBox.checked?this.solution.dataTwitter.active=!0:this.solution.dataTwitter.active=!1,this.solution.dataTwitter.updateAnimation()};const g={noNeighbsLog:"noNeighbsLog",noNeighbsLogDensity:"noNeighbsLogDensity",noNeighbsRaw:"noNeighbsRaw",noNeighbsWins:"noNeighbsWins",noTwtsLog:"noTwtsLog",noTwtsLogDensity:"noTwtsLogDensity",noTwtsRaw:"noTwtsRaw",noTwtsWins:"noTwtsWins",noUsersLog:"noUsersLog",noUsersLogDensity:"noUsersLogDensity",noUsersRaw:"noUsersRaw",noUsersWins:"noUsersWins",treatmentCategory:"treatmentCategory"},p=document.createElement("select");t.append(p);for(let d in g){const t=document.createElement("option");t.value=d,t.textContent=d,p.appendChild(t)}p.onchange=t=>{this.solution.dataTwitter.updateMesh(t.target.value)}}}const d=t=>{const e=document.createElement("div");e.style.display="flex";const i=document.createElement("input");i.type="checkbox";const s=document.createElement("div");return s.textContent=t,s.style.color="#aaa",e.appendChild(i),e.appendChild(s),{div:e,checkBox:i}},u=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"2009",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"2015";const s=document.createElement("div");s.style.display="flex";const o=document.createElement("input");o.type="range",o.min=e,o.max=i;const n=document.createElement("div");return n.textContent=t,n.style.color="#aaa",s.appendChild(o),s.appendChild(n),{div:s,slider:o,text:n}};class v extends o.TF{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"main"),this.drawing=void 0,this.ui=void 0,this.meshAreaGon=void 0,this.meshPolygon2=void 0,this.pts=[],this.dataTwitter=void 0,this.xOFf=-15478803.88731685,this.yOFf=-4766681.448690384,this.scale=.01,this.PARAM=void 0;let t=o.P8.R7.getAllUrlParams();this.PARAM=JSON.parse(JSON.stringify(t)),this.drawing=new a(this),this.dataTwitter=new l(this);const e=new s.cek(16777215,.8);this.camera.add(e),this.scene.add(e);const i=document.createElement("canvas");i.style.position="absolute",i.style.pointerEvents="none",i.style.mixBlendMode="darken",i.width=this.hostDiv.clientWidth,i.height=this.hostDiv.clientHeight,this.hostDiv.appendChild(i);const r=i.getContext("webgl");if(new n.B(r,.5,5).Render(r),this.ui=new c(this),this.PARAM.posCamera){const t=this.PARAM.posCamera.split(",");this.camera.position.set(+t[0],+t[1],+t[2]),this.controls.enablePan=!1,this.controls.enableRotate=!1,this.controls.enableZoom=!1}else this.camera.position.set(0,100,100);if(this.PARAM.posTarget){const t=this.PARAM.posTarget.split(",");this.controls.target.set(+t[0],+t[1],+t[2])}}projectionToMercator(t,e){const[i,s]=m(t,e);return[(i+this.xOFf)*this.scale,(s+this.yOFf)*this.scale*-1]}updateParam(){this.PARAM.scale&&(this.ui.isActive_twitter=!0,this.dataTwitter.dataScale=+this.PARAM.scale),this.PARAM.colorScale&&(this.ui.isActive_twitter=!0,this.dataTwitter.colorScale=+this.PARAM.colorScale),this.PARAM.dataLayer&&(this.ui.isActive_twitter=!0,this.dataTwitter.updateMesh(this.PARAM.dataLayer))}update(t){var e;this.drawing.update(),null===(e=this.dataTwitter)||void 0===e||e.update();const i="Pos: ".concat(this.camera.position.x,", ").concat(this.camera.position.y,", ").concat(this.camera.position.z,"; Target: ").concat(this.controls.target.x,", ").concat(this.controls.target.y,", ").concat(this.controls.target.z);void 0!==this.ui.divCameraPos&&(this.ui.divCameraPos.textContent=i)}}const m=(t,e)=>{const i=30559983.333,s=(t+180)*(i/360),o=e*Math.PI/180;return[s,223-i*Math.log(Math.tan(Math.PI/4+o/2))/(2*Math.PI)*-1]}}}]);
//# sourceMappingURL=65883.6c0f4082.chunk.js.map