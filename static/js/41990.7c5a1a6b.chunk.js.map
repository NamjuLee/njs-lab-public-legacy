{"version":3,"file":"static/js/41990.7c5a1a6b.chunk.js","mappings":"iKAeO,MAAMA,EAITC,YAAYC,EAAUC,GAOlB,GAP8B,KAH3BC,cAAQ,OACRC,WAAK,EAIRC,KAAKF,SAAW,GAKZD,EACAG,KAAKD,MAAQF,MACV,CACHG,KAAKD,MAAQ,GAEb,IAAK,IAAIE,EAAI,EAAGA,EAAIL,EAAUK,IAAK,CAC/B,IAAIC,EAAQC,KAAKC,SAAWD,KAAKE,GAAK,EACtCL,KAAKD,MAAME,GAAK,IAAIK,EAAAA,EAAQH,KAAKI,IAAIL,GAAQC,KAAKK,IAAIN,IACtDF,KAAKD,MAAME,GAAGQ,MAAMN,KAAKC,SAAWJ,KAAKF,SAC7C,CACJ,CAIAE,KAAKD,MAAM,GAAGW,WAClB,CAIOC,UAAUC,GACb,IAAIC,EAAQ,IAAIC,MAAMd,KAAKD,MAAMgB,QAE7BJ,EAAYR,KAAKa,MAAMb,KAAKC,SAAYJ,KAAKD,MAAMgB,QAEvD,IAAK,IAAId,EAAI,EAAGA,EAAID,KAAKD,MAAMgB,OAAQd,IAChBY,EAAMZ,GAArBA,EAAIU,EAAsBX,KAAKD,MAAME,GACzBW,EAAQb,MAAME,GAGlC,OADe,IAAIP,EAAImB,EAE3B,CAGOI,OAAOC,GACV,IAAK,IAAIjB,EAAI,EAAGA,EAAID,KAAKD,MAAMgB,OAAQd,IACnC,GAAIE,KAAKC,SAAWc,EAAG,CACnB,IAAIhB,EAAQC,KAAKC,SAAYD,KAAKE,GAClCL,KAAKD,MAAME,GAAK,IAAIK,EAAAA,EAAQH,KAAKI,IAAIL,GAAQC,KAAKK,IAAIN,IACtDF,KAAKD,MAAME,GAAGQ,MAAMN,KAAKC,SAAWJ,KAAKF,UAK/B,IAANG,GAASD,KAAKD,MAAME,GAAGS,WAC/B,CAER,ECtDG,MAAMS,EAKTxB,YAAYyB,GAAa,KAJlBC,aAAO,OACPC,SAAG,OACHC,YAAM,OACbC,cAAQ,EAEJxB,KAAKqB,QAAUI,SAASC,eAAeN,EAmB3C,CACOO,UACH,KAAO3B,KAAKqB,QAAQO,kBAChB5B,KAAKqB,QAAQQ,YAAY7B,KAAKqB,QAAQO,iBAE9C,EAKG,MAAME,UAAiBC,EAAAA,GAY1BpC,YAAYqC,GACRC,MAAMD,GAAK,KAZfE,MAAgB,EAAM,KACtBhB,EAAc,CAAC,EAAG,GAAE,KAGpBiB,EAAY,EAAI,KAEhBC,eAAS,OACTC,gBAAU,OACVC,YAAM,OACNC,gBAAU,OACVC,eAAS,EAGLxC,KAAKyC,OAAOC,MAAMC,SAAW,WAC7B3C,KAAKyC,OAAOC,MAAME,MAAQ,OAC1B5C,KAAKyC,OAAOC,MAAMG,OAAS,OAM3B7C,KAAKoC,UAAY,EACjBpC,KAAKqC,WAzBE,GA2BPrC,KAAKsC,OAAS,IAAIQ,EAAS9C,KAAKyC,OAAOG,MAAQ,EAAI,GAAI,GAAI,GAAI,IAI/D5C,KAAKuC,WAAa,IAAIQ,EAAW/C,KAAKsC,OADnB,IACyC,KAG5DtC,KAAKwC,UAAY,GAEjBxC,KAAKwC,UAAUQ,KAAK,IAAIF,EAAS9C,KAAKyC,OAAOG,MAAQ,EAAI,IAAK5C,KAAKyC,OAAOI,OAAS,EAAG,IAAK,KAI3F7C,KAAKiD,OACT,CACOC,WAAWC,EAAWC,GAE7B,CACOC,UAAUF,EAAWC,GAExBpD,KAAKkB,EAAE,GAAKiC,EACZnD,KAAKkB,EAAE,GAAKkC,CAChB,CACOE,OAAOC,GACVvD,KAAKmC,GAAK,IACVnC,KAAKwD,OAAOD,EAIhB,CACOC,OAAOD,GAMNvD,KAAKoC,UA/DF,IAgEHpC,KAAKuC,WAAWL,KAAKlC,KAAKwC,UAAWe,GACjCvD,KAAKuC,WAAWkB,iBAAmBzD,KAAKoC,UAAYpC,KAAKqC,aACzDrC,KAAKqC,WAAarC,KAAKoC,WAE3BpC,KAAKoC,cAGLpC,KAAKoC,UAAY,EACjBpC,KAAKuC,WAAWmB,cAChB1D,KAAKuC,WAAWoB,YAChB3D,KAAKuC,WAAWqB,gBAOpB,IAAK,IAAI3D,EAAI,EAAGA,EAAID,KAAKwC,UAAUzB,OAAQd,IACvCD,KAAKwC,UAAUvC,GAAG4D,QAAQN,GAc9BA,EAAIO,YACJP,EAAIQ,IAAI/D,KAAKkB,EAAE,GAAIlB,KAAKkB,EAAE,GAAI,GAAI,EAAa,EAAVf,KAAKE,IAC1CkD,EAAIS,YACJT,EAAIU,OAEJjE,KAAKsC,OAAOuB,QAAQN,EACxB,EAmBJ,MAAMW,EAiBFvE,YAAYwE,EAAc7B,EAAQ8B,EAAKC,GAAe,KAhBtDC,kBAAY,OACZC,cAAQ,OACR5B,cAAQ,OACR6B,OAAC,OACDJ,SAAG,OACHK,gBAAU,OACVC,gBAAU,OACVC,aAAO,OACPC,iBAAW,OACXC,iBAAW,OACXC,eAAS,OAETxC,YAAM,OAENiB,SAAG,EAGCvD,KAAKsC,OAASA,EAGdtC,KAAKsE,aAAe,IAAIhE,EAAAA,EAAQ,EAAG,EAAG,GACtCN,KAAKuE,SAAW,IAAIjE,EAAAA,EAAQ,EAAG,EAAG,GAClCN,KAAK2C,UAAWoC,EAAAA,EAAAA,IAASZ,GACzBnE,KAAKwE,EAAI,EACTxE,KAAKoE,IAAMA,EACXpE,KAAKyE,WAAa,EAClBzE,KAAK0E,WAAa,IAElB1E,KAAK2E,QAAU,EACf3E,KAAK4E,YAAc,EACnB5E,KAAK6E,aAAc,EACnB7E,KAAK8E,WAAY,CACrB,CAOOpB,cACC1D,KAAK0E,WAAa,IAAG1E,KAAK0E,WAAa,GAG3C1E,KAAK2E,QAAU,GAAK3E,KAAKyE,WAAazE,KAAK0E,YAG3C1E,KAAK2E,QAAUxE,KAAK6E,IAAIhF,KAAK2E,QAAS,GAElC3E,KAAK6E,cAAa7E,KAAK2E,SAAW,IAClC3E,KAAK8E,YAAW9E,KAAK2E,SAAW,EACxC,CAIOM,IAAIC,EAAI3B,IAGN,EAAIvD,KAAK2C,SAASQ,GACtBI,EAAId,OAAOG,MAAQ5C,KAAK2C,SAASQ,GACjC,EAAInD,KAAK2C,SAASS,GAClBG,EAAId,OAAOI,OAAS7C,KAAK2C,SAASS,KAEnCpD,KAAK6E,aAAc,GAId7E,KAAK6E,aAAgB7E,KAAK8E,YAC3B9E,KAAKmF,WAAWnF,KAAKoE,IAAIrE,MAAMC,KAAK4E,cACpC5E,KAAK4E,aAAe5E,KAAK4E,YAAc,GAAK5E,KAAKoE,IAAIrE,MAAMgB,OAC3Df,KAAKwD,SAELxD,KAAKwC,UAAU0C,IAOdlF,KAAK6E,aACN7E,KAAK6D,QAAQN,EAErB,CAEO6B,YAAY7B,GACf,IAAI8B,GAAIC,EAAAA,EAAAA,IACJtF,KAAK2C,SAASQ,EACdnD,KAAK2C,SAASS,EACd,EACApD,KAAKsC,OAAOK,SAASQ,EACrBnD,KAAKsC,OAAOK,SAASS,EACrB,GAEAiC,EAAIrF,KAAK0E,aAAY1E,KAAK0E,WAAaW,GAEvCrF,KAAKsC,OAAOiD,SAASvF,KAAK2C,YAAc3C,KAAK8E,UAE7C9E,KAAK8E,WAAY,EAWT9E,KAAK8E,WACb9E,KAAKyE,YAEb,CAGOjC,UAAU0C,GACb,IAAK,IAAIjF,EAAI,EAAGA,EAAIiF,EAAGnE,OAAQd,IAAK,CACtBiF,EAAGjF,GACLsF,SAASvF,KAAK2C,YAClB3C,KAAK6E,aAAc,EAE3B,CACJ,CACOM,WAAWK,GACdxF,KAAKsE,aAAamB,IAAID,EAC1B,CACOhC,SACHxD,KAAKuE,SAASkB,IAAIzF,KAAKsE,cACvBtE,KAAK2C,SAAS8C,IAAIzF,KAAKuE,UACvBvE,KAAKsE,aAAa7D,MAAM,EAC5B,CACOoD,QAAQN,GA2BXA,EAAIO,YACJP,EAAIQ,IAAI/D,KAAK2C,SAASQ,EAAGnD,KAAK2C,SAASS,EAAG,GAAI,EAAa,EAAVjD,KAAKE,IACtDkD,EAAIS,YACJT,EAAIU,MAGR,CACOyB,aACH,OAAO1F,KAAK2E,OAChB,CACOgB,SACH,OAAO3F,KAAKoE,GAChB,CACOwB,UACH,OAAO5F,KAAK6E,WAChB,EAGJ,MAAM/B,EAEFnD,YAAYwD,EAAGC,EAAGyC,EAAGC,GAAI,KADlBnD,cAAQ,OAAEkD,OAAC,OAAEC,OAAC,EAEjB9F,KAAK2C,SAAW,IAAIrC,EAAAA,EAAQ6C,EAAGC,EAAG,GAClCpD,KAAK6F,EAAIA,EACT7F,KAAK8F,EAAIA,CACb,CACOjC,QAAQN,GAKXA,EAAIO,YACJP,EAAIwC,KAAK/F,KAAK2C,SAASQ,EAAGnD,KAAK2C,SAASS,EAAGpD,KAAK6F,EAAG7F,KAAK8F,GACxDvC,EAAIS,YACJT,EAAIU,MACR,CACOsB,SAASS,GACZ,OACIA,EAAK7C,EAAInD,KAAK2C,SAASQ,GACvB6C,EAAK7C,EAAInD,KAAK2C,SAASQ,EAAInD,KAAK6F,GAChCG,EAAK5C,EAAIpD,KAAK2C,SAASS,GACvB4C,EAAK5C,EAAIpD,KAAK2C,SAASS,EAAIpD,KAAK8F,CAMxC,EAiBJ,MAAM/C,EAMFpD,YAAY2C,EAAQpB,EAAG+E,GAAM,KAL7BC,kBAAY,OACZ3D,gBAAU,OACV4D,gBAAU,OACVC,iBAAW,OACX9D,YAAM,EAEFtC,KAAKsC,OAASA,EACdtC,KAAKkG,aAAehF,EACpBlB,KAAKuC,WAAa,IAAIzB,MAAMmF,GAC5BjG,KAAKmG,WAAa,GAClBnG,KAAKoG,YAAc,EAEnB,IAAK,IAAInG,EAAI,EAAGA,EAAID,KAAKuC,WAAWxB,OAAQd,IAAK,CAC7C,IAAI0C,EAAW,IAAIrC,EAAAA,EAAQ,IAAS,KACpCN,KAAKuC,WAAWtC,GAAK,IAAIiE,EACrBvB,EACA3C,KAAKsC,OACL,IAAI5C,EAvWL,IAwWCM,KAAKuC,WAAWxB,OAExB,CACJ,CACOmB,KAAKgD,EAAI3B,GAEZ,IAAK,IAAItD,EAAI,EAAGA,EAAID,KAAKuC,WAAWxB,OAAQd,IAExCD,KAAKuC,WAAWtC,GAAGmF,YAAY7B,GAC/BvD,KAAKuC,WAAWtC,GAAGgF,IAAIC,EAAI3B,EAEnC,CAEOE,gBACH,IAAK,IAAIxD,EAAI,EAAGA,EAAID,KAAKuC,WAAWxB,OAAQd,IACxC,GAAID,KAAKuC,WAAWtC,GAAG6E,UAAW,OAAO,EAE7C,OAAO,CACX,CAEOpB,cACH,IAAK,IAAIzD,EAAI,EAAGA,EAAID,KAAKuC,WAAWxB,OAAQd,IACxCD,KAAKuC,WAAWtC,GAAGyD,aAE3B,CAEOC,YAEH3D,KAAKmG,WAAa,GAGlB,IAAIE,EAAarG,KAAKsG,gBAMtB,IAAK,IAAIrG,EAAI,EAAGA,EAAID,KAAKuC,WAAWxB,OAAQd,IAAK,CAC7C,IAAIsG,GAAgBC,EAAAA,EAAAA,IAChBxG,KAAKuC,WAAWtC,GAAGyF,aACnB,EACAW,EACA,EACA,GAEAI,EAAItG,KAAKa,MAAsB,IAAhBuF,GACnB,IAAK,IAAIG,EAAI,EAAGA,EAAID,EAAGC,IACnB1G,KAAKmG,WAAWnD,KAAKhD,KAAKuC,WAAWtC,GAE7C,CACJ,CAEO2D,eAEH,IAAK,IAAI3D,EAAI,EAAGA,EAAID,KAAKuC,WAAWxB,OAAQd,IAAK,CAE7C,IAAIiB,EAAIf,KAAKa,MAAMb,KAAKC,SAAYJ,KAAKmG,WAAWpF,QAChDsE,EAAIlF,KAAKa,MAAMb,KAAKC,SAAYJ,KAAKmG,WAAWpF,QAEhD4F,EAAM3G,KAAKmG,WAAWjF,GACtB0F,EAAM5G,KAAKmG,WAAWd,GAEtBwB,EAAWF,EAAIhB,SACfmB,EAAWF,EAAIjB,SAEf9E,EAAQgG,EAASlG,UAAUmG,GAE/BjG,EAAMI,OAAOjB,KAAKkG,cAElB,IAAIvD,EAAW,IAAIrC,EAAAA,EAAQ,IAAS,KACpCN,KAAKuC,WAAWtC,GAAK,IAAIiE,EAAOvB,EAAU3C,KAAKsC,OAAQzB,EAAOb,KAAKuC,WAAWxB,OAClF,CACAf,KAAKoG,aACT,CACOW,iBACH,OAAO/G,KAAKoG,WAChB,CAEOE,gBACH,IAAIU,EAAS,EACb,IAAK,IAAI/G,EAAI,EAAGA,EAAID,KAAKuC,WAAWxB,OAAQd,IACpCD,KAAKuC,WAAWtC,GAAGyF,aAAesB,IAClCA,EAAShH,KAAKuC,WAAWtC,GAAGyF,cAGpC,OAAOsB,CACX,E","sources":["njslab/Tools/GAvec/DNA.ts","njslab/Tools/GAvec/index.ts"],"sourcesContent":["import { Vector3 } from '../../../lib'\n\n// Smart Rockets\n// The Nature of Code\n// The Coding Train / Daniel Shiffman\n// https://youtu.be/_of6UVV4HGo\n// https://thecodingtrain.com/more/achive/nature-of-code/9-genetic-algorithms/9.5-fitness-genotype-vs-phenotype.html\n// https://editor.p5js.org/codingtrain/sketches/BOTCxBDbO\n\n// http://natureofcode.com\n\n// Pathfinding w/ Genetic Algorithms\n\n// DNA is an array of vectors\n\nexport class DNA {\n    public maxForce\n    public genes: Vector3[]\n    // lifetime\n    constructor(lifetime, newgenes?) {\n        // The maximum strength of the forces\n        this.maxForce = 0.1;\n\n        //   debugger\n\n        // The genetic sequence\n        if (newgenes) {\n            this.genes = newgenes;\n        } else {\n            this.genes = [];\n            // Constructor (makes a DNA of random PVectors)\n            for (let i = 0; i < lifetime; i++) {\n                let angle = Math.random() * Math.PI * 2;\n                this.genes[i] = new Vector3(Math.cos(angle), Math.sin(angle));\n                this.genes[i].multi(Math.random() * this.maxForce);\n            }\n        }\n\n        // Let's give each Rocket an extra boost of strength for its first frame\n        // console.log(this.genes[0])\n        this.genes[0].normalize();\n    }\n\n    // CROSSOVER\n    // Creates new DNA sequence from two (this & and a partner)\n    public crossover(partner) {\n        let child = new Array(this.genes.length);\n        // Pick a midpoint\n        let crossover = Math.floor(Math.random() * (this.genes.length));\n        // Take \"half\" from one and \"half\" from the other\n        for (let i = 0; i < this.genes.length; i++) {\n            if (i > crossover) child[i] = this.genes[i];\n            else child[i] = partner.genes[i];\n        }\n        let newGenes = new DNA(child);\n        return newGenes;\n    }\n\n    // Based on a mutation probability, picks a new random Vector\n    public mutate(m) {\n        for (let i = 0; i < this.genes.length; i++) {\n            if (Math.random() < m) {\n                let angle = Math.random() * (Math.PI);\n                this.genes[i] = new Vector3(Math.cos(angle), Math.sin(angle));\n                this.genes[i].multi(Math.random() * this.maxForce);\n                //        let angle = random(-0.1,0.1);\n                //        genes[i].rotate(angle);\n                //        let factor = random(0.9,1.1);\n                //        genes[i].mult(factor);\n                if (i === 0) this.genes[i].normalize();\n            }\n        }\n    }\n}\n","// import { NJSCORE, } from '../../../lib'\r\n\r\nimport { RendererCanvas, Vector3, deepCopy, normalize, crossProduct, distanceEuclidean, remap } from '../../../lib'\r\nimport { DNA } from './DNA';\r\n// const getDiv = (text, event) => {\r\n//     const div = document.createElement('div')\r\n//     const txtDiv = document.createElement('span')\r\n//     txtDiv.textContent = text\r\n//     const myInput = document.createElement('input')\r\n//     myInput.oninput = (e) => event(e)\r\n\r\n//     div.append(txtDiv)\r\n//     div.append(myInput)\r\n//     return div\r\n// }\r\n\r\n// https://editor.p5js.org/codingtrain/sketches/BOTCxBDbO\r\n\r\nexport class Solution {\r\n    public divHost: HTMLElement;\r\n    public out: HTMLElement;\r\n    public outHis: HTMLElement;\r\n    renderer: Renderer;\r\n    constructor(id: string) {\r\n        this.divHost = document.getElementById(id)\r\n        // const container = document.createElement('div');\r\n        // container.style.display ='flex'\r\n        // this.divHost.append(container)\r\n\r\n        // const inA = getDiv('A * B + C === Target: ',(e) => {\r\n        //     const val = +e.target.value;\r\n        //     this.compute(val)\r\n        // });\r\n        // container.append(inA)\r\n        // this.out = document.createElement('div');\r\n        // this.out.style.marginTop = '10px'\r\n        // this.divHost.append(this.out)\r\n        // this.outHis = document.createElement('div');\r\n        // this.outHis.style.marginTop = '10px'\r\n        // this.divHost.append(this.outHis)\r\n\r\n        // this.renderer = new Renderer(this.divHost);\r\n\r\n    }\r\n    public destroy() {\r\n        while (this.divHost.lastElementChild) {\r\n            this.divHost.removeChild(this.divHost.lastElementChild);\r\n        }\r\n    }\r\n}\r\n\r\nlet lifetime = 50;\r\n\r\nexport class Renderer extends RendererCanvas {\r\n    live: boolean = false;\r\n    m: number[] = [0, 0]\r\n    // walls: Wall[] = [];\r\n    // sun: Sun;\r\n    t: number = 0.0;\r\n    // lifetime;\r\n    lifecycle;\r\n    recordTime: number;\r\n    target;\r\n    population: Population;\r\n    obstacles\r\n    constructor(div: any) {\r\n        super(div);\r\n        this.canvas.style.position = 'relative';\r\n        this.canvas.style.width = '100%';\r\n        this.canvas.style.height = '100%';\r\n\r\n\r\n        // this.lifetime = 1000;\r\n\r\n        // Initialize variables\r\n        this.lifecycle = 0;\r\n        this.recordTime = lifetime;\r\n\r\n        this.target = new Obstacle(this.canvas.width / 2 - 12, 24, 24, 24);\r\n\r\n        // Create a population with a mutation rate, and population max\r\n        let mutationRate = 0.01;\r\n        this.population = new Population(this.target, mutationRate, 100);\r\n\r\n        // Create the obstacle course\r\n        this.obstacles = [];\r\n        // this.obstacles.push(new Obstacle(100, 300, 500, 10));\r\n        this.obstacles.push(new Obstacle(this.canvas.width / 2 - 100, this.canvas.height / 2, 200, 10));\r\n\r\n\r\n\r\n        this.start();\r\n    }\r\n    public mouseClick(x: number, y: number): void {\r\n        \r\n    }\r\n    public mouseMove(x: number, y: number): void {\r\n        // this.sun.updateDirection(x, y);\r\n        this.m[0] = x;\r\n        this.m[1] = y;\r\n    }\r\n    public render(ctx: CanvasRenderingContext2D): void {\r\n        this.t += 0.01;\r\n        this.update(ctx);\r\n\r\n        // this.walls.forEach((w) => { w.draw(ctx); });\r\n        // this.sun.draw(ctx, this.t);\r\n    }\r\n    public update(ctx: CanvasRenderingContext2D) {\r\n\r\n        // Draw the start and target positions\r\n\r\n\r\n        // If the generation hasn't ended yet\r\n        if (this.lifecycle < lifetime) {\r\n            this.population.live(this.obstacles, ctx);\r\n            if (this.population.targetReached() && this.lifecycle < this.recordTime) {\r\n                this.recordTime = this.lifecycle;\r\n            }\r\n            this.lifecycle++;\r\n            // Otherwise a new generation\r\n        } else {\r\n            this.lifecycle = 0;\r\n            this.population.calcFitness();\r\n            this.population.selection();\r\n            this.population.reproduction();\r\n        }\r\n\r\n\r\n\r\n        // Draw the obstacles\r\n        // console.log()\r\n        for (let i = 0; i < this.obstacles.length; i++) {\r\n            this.obstacles[i].display(ctx);\r\n        }\r\n\r\n        // Display some info\r\n\r\n        // fill(0);\r\n        // noStroke();\r\n        // text(\"Generation #: \" + this.population.getGenerations(), 10, 18);\r\n        // text(\"Cycles left: \" + (this.lifetime - this.lifecycle), 10, 36);\r\n        // text(\"Record cycles: \" + this.recordtime, 10, 54);\r\n\r\n\r\n        // console.log(ctx)\r\n\r\n        ctx.beginPath();\r\n        ctx.arc(this.m[0], this.m[1], 10, 0, Math.PI * 2)\r\n        ctx.closePath();\r\n        ctx.fill()\r\n\r\n        this.target.display(ctx);\r\n    }\r\n}\r\n\r\n\r\n\r\n\r\n\r\n// Smart Rockets\r\n// The Nature of Code\r\n// The Coding Train / Daniel Shiffman\r\n// https://youtu.be/_of6UVV4HGo\r\n// https://thecodingtrain.com/more/achive/nature-of-code/9-genetic-algorithms/9.5-fitness-genotype-vs-phenotype.html\r\n// https://editor.p5js.org/codingtrain/sketches/BOTCxBDbO\r\n\r\n// http://natureofcode.com\r\n\r\n// Rocket class -- this is just like our Boid / Particle class\r\n// the only difference is that it has DNA & fitness\r\n\r\nclass Rocket {\r\n    acceleration\r\n    velocity: Vector3\r\n    position: Vector3\r\n    r\r\n    dna\r\n    finishTime\r\n    recordDist\r\n    fitness\r\n    geneCounter\r\n    hitObstacle\r\n    hitTarget\r\n\r\n    target\r\n\r\n    ctx\r\n\r\n    constructor(pos: Vector3, target, dna, totalRockets) {\r\n        this.target = target;\r\n        // console.log(pos)\r\n        // All of our physics stuff\r\n        this.acceleration = new Vector3(0, 0, 0);\r\n        this.velocity = new Vector3(0, 0, 0);\r\n        this.position = deepCopy(pos)\r\n        this.r = 4;\r\n        this.dna = dna;\r\n        this.finishTime = 0; // We're going to count how long it takes to reach target\r\n        this.recordDist = 10000; // Some high number that will be beat instantly\r\n\r\n        this.fitness = 0;\r\n        this.geneCounter = 0;\r\n        this.hitObstacle = false; // Am I stuck on an obstacle?\r\n        this.hitTarget = false; // Did I reach the target\r\n    }\r\n\r\n    // FITNESS FUNCTION\r\n    // distance = distance from target\r\n    // finish = what order did i finish (first, second, etc. . .)\r\n    // f(distance,finish) =   (1.0f / finish^1.5) * (1.0f / distance^6);\r\n    // a lower finish is rewarded (exponentially) and/or shorter distance to target (exponetially)\r\n    public calcFitness() {\r\n        if (this.recordDist < 1) this.recordDist = 1;\r\n\r\n        // Reward finishing faster and getting close\r\n        this.fitness = 1 / (this.finishTime * this.recordDist);\r\n\r\n        // Make the function exponential\r\n        this.fitness = Math.pow(this.fitness, 4);\r\n\r\n        if (this.hitObstacle) this.fitness *= 0.1; // lose 90% of fitness hitting an obstacle\r\n        if (this.hitTarget) this.fitness *= 2; // twice the fitness for finishing!\r\n    }\r\n\r\n    // Run in relation to all the obstacles\r\n    // If I'm stuck, don't bother updating or checking for intersection\r\n    public run(os, ctx: CanvasRenderingContext2D) {\r\n\r\n\r\n        if ((0 > this.position.x) ||\r\n        (ctx.canvas.width < this.position.x) ||\r\n        (0 > this.position.y) ||\r\n        (ctx.canvas.height < this.position.y)) {\r\n\r\n        this.hitObstacle = true;\r\n    }\r\n\r\n\r\n        if (!this.hitObstacle && !this.hitTarget) {\r\n            this.applyForce(this.dna.genes[this.geneCounter]);\r\n            this.geneCounter = (this.geneCounter + 1) % this.dna.genes.length;\r\n            this.update();\r\n            // If I hit an edge or an obstacle\r\n            this.obstacles(os);\r\n\r\n\r\n\r\n\r\n        }\r\n        // Draw me!\r\n        if (!this.hitObstacle) {\r\n            this.display(ctx);\r\n        }\r\n    }\r\n    // Did I make it to the target?\r\n    public checkTarget(ctx: CanvasRenderingContext2D) {\r\n        let d = distanceEuclidean(\r\n            this.position.x,\r\n            this.position.y,\r\n            0,\r\n            this.target.position.x,\r\n            this.target.position.y,\r\n            0\r\n        );\r\n        if (d < this.recordDist) this.recordDist = d;\r\n\r\n        if (this.target.contains(this.position) && !this.hitTarget) {\r\n\r\n            this.hitTarget = true;\r\n\r\n            // if ((0 > this.position.x) ||\r\n            //     (ctx.canvas.width < this.position.x ) ||\r\n            //     (0 > this.position.y) ||\r\n            //     (ctx.canvas.height < this.position.y) ) {\r\n\r\n            //     this.hitTarget = true;\r\n            // }\r\n\r\n\r\n        } else if (!this.hitTarget) {\r\n            this.finishTime++;\r\n        }\r\n    }\r\n\r\n    // Did I hit an obstacle?\r\n    public obstacles(os) {\r\n        for (let i = 0; i < os.length; i++) {\r\n            let obs = os[i];\r\n            if (obs.contains(this.position)) {\r\n                this.hitObstacle = true;\r\n            }\r\n        }\r\n    }\r\n    public applyForce(f) {\r\n        this.acceleration.add(f);\r\n    }\r\n    public update() {\r\n        this.velocity.add(this.acceleration);\r\n        this.position.add(this.velocity);\r\n        this.acceleration.multi(0);\r\n    }\r\n    public display(ctx: CanvasRenderingContext2D) {\r\n\r\n        // console.log(this.position);\r\n\r\n        //   //background(255,0,0);\r\n        //   let theta = this.velocity.heading() + Math.PI / 2;\r\n        //   fill(200, 100);\r\n        //   stroke(0);\r\n        //   strokeWeight(1);\r\n        //   push();\r\n        //   translate(this.position.x, this.position.y);\r\n        //   rotate(theta);\r\n\r\n        //   // Thrusters\r\n        //   rectMode(CENTER);\r\n        //   fill(0);\r\n        //   rect(-this.r / 2, this.r * 2, this.r / 2, this.r);\r\n        //   rect(this.r / 2, this.r * 2, this.r / 2, this.r);\r\n\r\n        //   // Rocket body\r\n        //   fill(175);\r\n        //   beginShape(TRIANGLES);\r\n        //   vertex(0, -this.r * 2);\r\n        //   vertex(-this.r, this.r * 2);\r\n        //   vertex(this.r, this.r * 2);\r\n        //   endShape();\r\n\r\n        ctx.beginPath()\r\n        ctx.arc(this.position.x, this.position.y, 10, 0, Math.PI * 2)\r\n        ctx.closePath()\r\n        ctx.fill();\r\n\r\n        //   pop();\r\n    }\r\n    public getFitness() {\r\n        return this.fitness;\r\n    }\r\n    public getDNA() {\r\n        return this.dna;\r\n    }\r\n    public stopped() {\r\n        return this.hitObstacle;\r\n    }\r\n}\r\n\r\nclass Obstacle {\r\n    public position; w; h\r\n    constructor(x, y, w, h) {\r\n        this.position = new Vector3(x, y, 0);\r\n        this.w = w;\r\n        this.h = h;\r\n    }\r\n    public display(ctx: CanvasRenderingContext2D) {\r\n        //   stroke(0);\r\n        //   fill(175);\r\n        //   strokeWeight(2);\r\n        //   rectMode(CORNER);\r\n        ctx.beginPath();\r\n        ctx.rect(this.position.x, this.position.y, this.w, this.h);\r\n        ctx.closePath()\r\n        ctx.fill()\r\n    }\r\n    public contains(spot) {\r\n        if (\r\n            spot.x > this.position.x &&\r\n            spot.x < this.position.x + this.w &&\r\n            spot.y > this.position.y &&\r\n            spot.y < this.position.y + this.h\r\n        ) {\r\n            return true;\r\n        } else {\r\n            return false;\r\n        }\r\n    }\r\n}\r\n\r\n// Smart Rockets\r\n// The Nature of Code\r\n// The Coding Train / Daniel Shiffman\r\n// https://youtu.be/_of6UVV4HGo\r\n// https://thecodingtrain.com/more/achive/nature-of-code/9-genetic-algorithms/9.5-fitness-genotype-vs-phenotype.html\r\n// https://editor.p5js.org/codingtrain/sketches/BOTCxBDbO\r\n\r\n// http://natureofcode.com\r\n\r\n// Pathfinding w/ Genetic Algorithms\r\n\r\n// A class to describe a population of \"creatures\"\r\n\r\n// Initialize the population\r\nclass Population {\r\n    mutationRate\r\n    population\r\n    matingPool\r\n    generations\r\n    target\r\n    constructor(target, m, num) {\r\n        this.target = target;\r\n        this.mutationRate = m; // Mutation rate\r\n        this.population = new Array(num); // Array to hold the current population\r\n        this.matingPool = []; // ArrayList which we will use for our \"mating pool\"\r\n        this.generations = 0; // Number of generations\r\n        //make a new set of creatures\r\n        for (let i = 0; i < this.population.length; i++) {\r\n            let position = new Vector3(500 / 2, 500 + 20);\r\n            this.population[i] = new Rocket(\r\n                position, \r\n                this.target,\r\n                new DNA(lifetime),\r\n                this.population.length\r\n            );\r\n        }\r\n    }\r\n    public live(os, ctx: CanvasRenderingContext2D) {\r\n        // For every creature\r\n        for (let i = 0; i < this.population.length; i++) {\r\n            // If it finishes, mark it down as done!\r\n            this.population[i].checkTarget(ctx);\r\n            this.population[i].run(os, ctx);\r\n        }\r\n    }\r\n    // Did anything finish?\r\n    public targetReached() {\r\n        for (let i = 0; i < this.population.length; i++) {\r\n            if (this.population[i].hitTarget) return true;\r\n        }\r\n        return false;\r\n    }\r\n    // Calculate fitness for each creature\r\n    public calcFitness() {\r\n        for (let i = 0; i < this.population.length; i++) {\r\n            this.population[i].calcFitness();\r\n        }\r\n    }\r\n    // Generate a mating pool\r\n    public selection() {\r\n        // Clear the ArrayList\r\n        this.matingPool = [];\r\n\r\n        // Calculate total fitness of whole population\r\n        let maxFitness = this.getMaxFitness();\r\n\r\n        // Calculate fitness for each member of the population (scaled to value between 0 and 1)\r\n        // Based on fitness, each member will get added to the mating pool a certain number of times\r\n        // A higher fitness = more entries to mating pool = more likely to be picked as a parent\r\n        // A lower fitness = fewer entries to mating pool = less likely to be picked as a parent\r\n        for (let i = 0; i < this.population.length; i++) {\r\n            let fitnessNormal = remap(\r\n                this.population[i].getFitness(),\r\n                0,\r\n                maxFitness,\r\n                0,\r\n                1\r\n            );\r\n            let n = Math.floor(fitnessNormal * 100); // Arbitrary multiplier\r\n            for (let j = 0; j < n; j++) {\r\n                this.matingPool.push(this.population[i]);\r\n            }\r\n        }\r\n    }\r\n    // Making the next generation\r\n    public reproduction() {\r\n        // Refill the population with children from the mating pool\r\n        for (let i = 0; i < this.population.length; i++) {\r\n            // Sping the wheel of fortune to pick two parents\r\n            let m = Math.floor(Math.random() * (this.matingPool.length));\r\n            let d = Math.floor(Math.random() * (this.matingPool.length));\r\n            // Pick two parents\r\n            let mom = this.matingPool[m];\r\n            let dad = this.matingPool[d];\r\n            // Get their genes\r\n            let momgenes = mom.getDNA();\r\n            let dadgenes = dad.getDNA();\r\n            // Mate their genes\r\n            let child = momgenes.crossover(dadgenes);\r\n            // Mutate their genes\r\n            child.mutate(this.mutationRate);\r\n            // Fill the new population with the new child\r\n            let position = new Vector3(500 / 2, 500 + 20);\r\n            this.population[i] = new Rocket(position, this.target, child, this.population.length);\r\n        }\r\n        this.generations++;\r\n    }\r\n    public getGenerations() {\r\n        return this.generations;\r\n    }\r\n    // Find highest fitness for the population\r\n    public getMaxFitness() {\r\n        let record = 0;\r\n        for (let i = 0; i < this.population.length; i++) {\r\n            if (this.population[i].getFitness() > record) {\r\n                record = this.population[i].getFitness();\r\n            }\r\n        }\r\n        return record;\r\n    }\r\n}\r\n"],"names":["DNA","constructor","lifetime","newgenes","maxForce","genes","this","i","angle","Math","random","PI","Vector3","cos","sin","multi","normalize","crossover","partner","child","Array","length","floor","mutate","m","Solution","id","divHost","out","outHis","renderer","document","getElementById","destroy","lastElementChild","removeChild","Renderer","RendererCanvas","div","super","live","t","lifecycle","recordTime","target","population","obstacles","canvas","style","position","width","height","Obstacle","Population","push","start","mouseClick","x","y","mouseMove","render","ctx","update","targetReached","calcFitness","selection","reproduction","display","beginPath","arc","closePath","fill","Rocket","pos","dna","totalRockets","acceleration","velocity","r","finishTime","recordDist","fitness","geneCounter","hitObstacle","hitTarget","deepCopy","pow","run","os","applyForce","checkTarget","d","distanceEuclidean","contains","f","add","getFitness","getDNA","stopped","w","h","rect","spot","num","mutationRate","matingPool","generations","maxFitness","getMaxFitness","fitnessNormal","remap","n","j","mom","dad","momgenes","dadgenes","getGenerations","record"],"sourceRoot":""}