"use strict";(self.webpackChunkNJS_Lab=self.webpackChunkNJS_Lab||[]).push([[40184],{40184:(t,r,s)=>{s.r(r),s.d(r,{AppCanvasTemplate:()=>d,Solution:()=>m});class e{constructor(t,r,s){this.x=t,this.y=r,this.z=s}static times(t,r){return new e(t*r.x,t*r.y,t*r.z)}static minus(t,r){return new e(t.x-r.x,t.y-r.y,t.z-r.z)}static plus(t,r){return new e(t.x+r.x,t.y+r.y,t.z+r.z)}static dot(t,r){return t.x*r.x+t.y*r.y+t.z*r.z}static mag(t){return Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z)}static norm(t){var r=e.mag(t),s=0===r?1/0:1/r;return e.times(s,t)}static cross(t,r){return new e(t.y*r.z-t.z*r.y,t.z*r.x-t.x*r.z,t.x*r.y-t.y*r.x)}}class i{constructor(t,r,s){this.r=t,this.g=r,this.b=s}static scale(t,r){return new i(t*r.r,t*r.g,t*r.b)}static plus(t,r){return new i(t.r+r.r,t.g+r.g,t.b+r.b)}static times(t,r){return new i(t.r*r.r,t.g*r.g,t.b*r.b)}static toDrawingColor(t){var r=t=>t>1?1:t;return[Math.floor(255*r(t.r)),Math.floor(255*r(t.g)),Math.floor(255*r(t.b))]}}i.white=new i(1,1,1),i.grey=new i(.5,.5,.5),i.black=new i(.05,.05,.05),i.background=i.black,i.defaultColor=i.black;class n{constructor(t,r){this.pos=t,this.forward=void 0,this.right=void 0,this.up=void 0;var s=new e(0,-1,0);this.forward=e.norm(e.minus(r,this.pos)),this.right=e.times(1.5,e.norm(e.cross(this.forward,s))),this.up=e.times(1.5,e.norm(e.cross(this.forward,this.right)))}}class o{constructor(t){!function(t){const r=document.getElementById(t),s=document.createElement("canvas");s.width=512,s.height=512,r.append(s);const o=s.getContext("2d");(new l).render({things:[new h(new e(0,1,0),0,a.checkerboard),new u(new e(0,1,-.25),1,a.shiny),new u(new e(-6,3,-5),1,a.shiny),new u(new e(-6,8,15),5,a.shiny),new u(new e(-1,.5,1.5),.5,a.shiny)],lights:[{pos:new e(-2,2.5,0),color:new i(1,1,1)},{pos:new e(0,3.5,0),color:new i(.21,.21,.35)}],camera:new n(new e(3,2,4),new e(-1,.5,0))},o,512,512)}(t)}}let a;var c;(c=a||(a={})).shiny={diffuse:function(t){return i.white},specular:function(t){return i.grey},reflect:function(t){return 0},roughness:250},c.checkerboard={diffuse:function(t){return(Math.floor(t.z)+Math.floor(t.x))%2!==0?i.white:i.black},specular:function(t){return i.white},reflect:function(t){return(Math.floor(t.z)+Math.floor(t.x))%2!==0?.1:.7},roughness:150};class u{constructor(t,r,s){this.center=t,this.surface=s,this.radius2=void 0,this.radius2=r*r}intersect(t){var r=e.minus(this.center,t.start),s=e.dot(r,t.dir),i=0;if(s>=0){var n=this.radius2-(e.dot(r,r)-s*s);n>=0&&(i=s-Math.sqrt(n))}return 0===i?null:{thing:this,ray:t,dist:i}}normal(t){return e.norm(e.minus(t,this.center))}}class h{constructor(t,r,s){this.surface=s,this.intersect=void 0,this.normal=void 0,this.normal=function(r){return t},this.intersect=s=>{var i=e.dot(t,s.dir);if(!(i>0))return{thing:this,ray:s,dist:(e.dot(t,s.start)+r)/-i}}}}class l{constructor(){this.maxDepth=100}intersections(t,r){let s,e=1/0;for(let i in r.things){let n=r.things[i].intersect(t);null!=n&&n.dist<e&&(s=n,e=n.dist)}return s}testRay(t,r){const s=this.intersections(t,r);return void 0===s?void 0:s.dist}traceRay(t,r,s){const e=this.intersections(t,r);return void 0===e?i.background:this.shade(e,r,s)}shade(t,r,s){var n=t.ray.dir,o=e.plus(e.times(t.dist,n),t.ray.start),a=t.thing.normal(o),c=e.minus(n,e.times(2,e.times(e.dot(a,n),a))),u=i.plus(i.background,this.getNaturalColor(t.thing,o,a,c,r)),h=s>=this.maxDepth?i.grey:this.getReflectionColor(t.thing,o,a,c,r,s);return i.plus(u,h)}getReflectionColor(t,r,s,e,n,o){return i.scale(t.surface.reflect(r),this.traceRay({start:r,dir:e},n,o+1))}getNaturalColor(t,r,s,n,o){return o.lights.reduce(((a,c)=>{const u=e.minus(c.pos,r),h=e.norm(u),l=this.testRay({start:r,dir:h},o);if(void 0!==l&&l<=e.mag(u))return a;{const o=e.dot(h,s),u=o>0?i.scale(o,c.color):i.defaultColor,l=e.dot(h,e.norm(n)),d=l>0?i.scale(Math.pow(l,t.surface.roughness),c.color):i.defaultColor;return i.plus(a,i.plus(i.times(t.surface.diffuse(r),u),i.times(t.surface.specular(r),d)))}}),i.defaultColor)}render(t,r,s,n){for(var o=(t,r,i)=>e.norm(e.plus(i.forward,e.plus(e.times((t=>(t-s/2)/2/s)(t),i.right),e.times((t=>-(t-n/2)/2/n)(r),i.up)))),a=0;a<n;a++)for(var c=0;c<s;c++){var u=this.traceRay({start:t.camera.pos,dir:o(c,a,t.camera)},t,0),h=i.toDrawingColor(u);r.fillStyle="rgb("+String(h[0])+", "+String(h[1])+", "+String(h[2])+")",r.fillRect(c,a,c+1,a+1)}}}class d{static Init(t){new d(t).Dummy()}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"SandBox";this.implementation=void 0,this.implementation=new o(t),console.log("AppCanvasTemplate 1000")}Dummy(){}}class m{constructor(t){this.divHost=void 0,this.divHost=document.getElementById(t),d.Init(t)}destroy(){if(this.divHost)try{for(;this.divHost.firstChild;)this.divHost.removeChild(this.divHost.firstChild)}catch(t){console.error("Error in destroy method:",t)}else console.warn("divHost is undefined in destroy method")}}}}]);
//# sourceMappingURL=40184.cb4df8b7.chunk.js.map