"use strict";(self.webpackChunkNJS_Lab=self.webpackChunkNJS_Lab||[]).push([[26376],{84638:(i,t,s)=>{s.d(t,{MO:()=>h,TE:()=>o,Y4:()=>e,h9:()=>n});const e=(i,t)=>{const s=i[0].x,e=i[1].x,o=t[0].x,n=t[1].x,h=i[0].y,r=i[1].y,l=t[0].y,c=t[1].y;return s<=n&&e>=o&&h<=c&&r>=l},o=(i,t)=>Math.sqrt((i.x-t.x)*(i.x-t.x)+(i.y-t.y)*(i.y-t.y)+(i.z-t.z)*(i.z-t.z));class n{constructor(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.x=0,this.y=0,this.z=0,this.lon=0,this.lat=0,this.elevation=0,this.d=!0,this.isRenderable=!0,this.x=i,this.y=t,this.z=s}}class h{constructor(i,t){this.vec=void 0,this.id="",this.numVisit=0,this.radius=10,this.isCollapse=!1,this.isHidden=!1,this.isRenderable=!0,this.isSelected=!1,this.isHover=!1,this.collision=void 0,this.vec=new n(i,t,0),this.updateBounding()}updateBounding(){this.collision=new r(this)}render(i){i.beginPath(),i.arc(this.vec.x,this.vec.y,this.radius,0,2*Math.PI),i.closePath(),this.isCollapse?i.fillStyle="#f00":i.fillStyle="#0f0",i.fill(),this.renderBoundingBox(i)}renderBoundingBox(i){i.beginPath(),i.rect(this.collision.minVec.x,this.collision.minVec.y,this.collision.maxVec.x-this.collision.minVec.x,this.collision.maxVec.y-this.collision.minVec.y),i.stroke()}}class r{constructor(i){this.base=void 0,this.isCollided=!1,this.neighborShapes=[],this.minVec=void 0,this.maxVec=void 0,this.isVisited=!1,this.numOrder=-1,this.base=i;const t=this.base.radius;this.minVec=new n(this.base.vec.x-t,this.base.vec.y-t,0),this.maxVec=new n(this.base.vec.x+t,this.base.vec.y+t,0)}Reset(){this.neighborShapes=[],this.numOrder=-1,this.base.numVisit=0,this.base.isCollapse=!1,this.isCollided=!1,this.isVisited=!1}}},26376:(i,t,s)=>{s.r(t),s.d(t,{Renderer:()=>m,Solution:()=>u});var e=s(84638);class o{constructor(i,t){this.renderer=void 0,this.points=void 0,this.r0=16,this.r1=24,this.isHover=!1,this.isVisited=!1,this.boundingBoxMin=new e.h9(Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER),this.boundingBoxMax=new e.h9(Number.MIN_SAFE_INTEGER,Number.MIN_SAFE_INTEGER,Number.MIN_SAFE_INTEGER),this.minVec=void 0,this.maxVec=void 0,this.vec=new e.h9(0,0,0),this.t=1,this.GridResolution=85,this.tempVecGridList=[],this.tempGeoGridList=[],this.renderer=i,this.points=t;for(let s=0;s<this.points.length;++s)this.vec.x+=this.points[s].vec.x,this.vec.y+=this.points[s].vec.y,this.UpdateBoundingBox(this.points[s].vec);this.vec.x/=this.points.length,this.vec.y/=this.points.length,this.minVec=new e.h9(this.vec.x-this.r1,this.vec.y-this.r1,0),this.maxVec=new e.h9(this.vec.x+this.r1,this.vec.y+this.r1,0)}IsInside(i){return(0,e.TE)(this.vec,i)<this.r1?(this.isHover=!0,!0):(this.isHover=!1,!1)}AddPost(i){if(!this.points.includes(i)){this.points.push(i),this.vec=new e.h9(0,0,0);for(let i=0;i<this.points.length;++i)this.vec.x+=this.points[i].vec.x,this.vec.y+=this.points[i].vec.y,this.UpdateBoundingBox(this.points[i].vec);this.vec.x/=this.points.length,this.vec.y/=this.points.length,this.minVec=new e.h9(this.vec.x-this.r1,this.vec.y-this.r1,0),this.maxVec=new e.h9(this.vec.x+this.r1,this.vec.y+this.r1,0)}}NeedDecompose(){return this.boundingBoxMax.x-this.boundingBoxMin.x>this.GridResolution||this.boundingBoxMax.y-this.boundingBoxMin.y>this.GridResolution}Split(){this.DeepRemove();const i=(this.boundingBoxMax.x-this.boundingBoxMin.x)/this.GridResolution<1?1:(this.boundingBoxMax.x-this.boundingBoxMin.x)/this.GridResolution,t=(this.boundingBoxMax.y-this.boundingBoxMin.y)/this.GridResolution<1?1:(this.boundingBoxMax.y-this.boundingBoxMin.y)/this.GridResolution,s=this.buildGrid(i,t);this.BuildSubCluster(s,i,t)}Merge(i){this.points.concat(i.points),this.vec=new e.h9(0,0,0);for(let t=0;t<this.points.length;++t)this.vec.x+=this.points[t].vec.x,this.vec.y+=this.points[t].vec.y,this.UpdateBoundingBox(this.points[t].vec);this.vec.x/=this.points.length,this.vec.y/=this.points.length,this.minVec=new e.h9(this.vec.x-this.r1,this.vec.y-this.r1,0),this.maxVec=new e.h9(this.vec.x+this.r1,this.vec.y+this.r1,0),i.DeepRemove()}DeepRemove(){this.renderer.RemoveCluster(this)}buildGrid(i,t){this.tempGeoGridList=[];let s=[];for(let o=0;o<t;++o){const t=this.boundingBoxMin.y+o*this.GridResolution,n=[];for(let o=0;o<i;++o){const i=this.boundingBoxMin.x+o*this.GridResolution;s.push(new e.h9(i,t));const h=[];n.push(h)}this.tempGeoGridList.push(n)}return this.tempVecGridList=s,s}BuildSubCluster(i,t,s){for(let e=0;e<this.points.length;++e)this.GetCellAtPoint(this.points[e].vec,t,s).push(this.points[e]);for(let e=0;e<this.tempGeoGridList.length;++e)for(let i=0;i<this.tempGeoGridList[e].length;++i)this.tempGeoGridList[e][i]&&(1===this.tempGeoGridList[e][i].length?this.tempGeoGridList[e][i][0].collision.Reset():this.tempGeoGridList[e][i].length>1&&this.renderer.clustersRPoint.push(new o(this.renderer,this.tempGeoGridList[e][i])))}GetCellAtPoint(i,t,s){let o=new e.h9(i.x-this.boundingBoxMin.x,i.y-this.boundingBoxMin.y),n=Math.round(o.x/this.GridResolution),h=Math.round(o.y/this.GridResolution);return n>=t&&(n=t-1),h>=s&&(h=s-1),n<0&&(n=0),h<0&&(h=0),n=Math.round(n),h=Math.round(h),this.tempGeoGridList[h][n]}Draw(i,t,s,o){if(this.UpdateTimeer(),s){this.vec=new e.h9(0,0,0),this.boundingBoxMin=new e.h9(Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER),this.boundingBoxMax=new e.h9(Number.MIN_SAFE_INTEGER,Number.MIN_SAFE_INTEGER,Number.MIN_SAFE_INTEGER);for(let i=0;i<this.points.length;++i)this.vec.x+=this.points[i].vec.x,this.vec.y+=this.points[i].vec.y,this.UpdateBoundingBox(this.points[i].vec);this.vec.x/=this.points.length,this.vec.y/=this.points.length,this.minVec=new e.h9(this.vec.x-this.r1,this.vec.y-this.r1,0),this.maxVec=new e.h9(this.vec.x+this.r1,this.vec.y+this.r1,0)}if(n(i,this.points,this.vec,this.r0,this.r1,this.isHover,this.t),t.optimizer.inspection&&(i.beginPath(),i.rect(this.minVec.x,this.minVec.y,this.maxVec.x-this.minVec.x,this.maxVec.y-this.minVec.y),i.closePath(),i.fillStyle="rgba(0, 0, 0, 0.3)",i.fill(),i.lineWidth=.5,i.beginPath(),i.rect(this.boundingBoxMin.x,this.boundingBoxMin.y,this.boundingBoxMax.x-this.boundingBoxMin.x,this.boundingBoxMax.y-this.boundingBoxMin.y),i.closePath(),i.stroke(),this.tempVecGridList.length>0))for(let e=0;e<this.tempVecGridList.length;++e)i.beginPath(),i.rect(this.tempVecGridList[e].x,this.tempVecGridList[e].y,this.GridResolution,this.GridResolution),i.closePath(),i.stroke()}UpdateTimeer(){this.t-=.1,this.t=this.t<.4?.4:this.t}UpdateBoundingBox(i){this.boundingBoxMin.x=i.x<this.boundingBoxMin.x?i.x:this.boundingBoxMin.x,this.boundingBoxMin.y=i.y<this.boundingBoxMin.y?i.y:this.boundingBoxMin.y,this.boundingBoxMax.x=i.x>this.boundingBoxMax.x?i.x:this.boundingBoxMax.x,this.boundingBoxMax.y=i.y>this.boundingBoxMax.y?i.y:this.boundingBoxMax.y}}const n=function(i,t,s,e,o,n){if(n)for(let h=0;h<t.length;++h)i.lineWidth=.6,i.strokeStyle="#f00",i.beginPath(),i.moveTo(s.x,s.y),i.lineTo(t[h].vec.x,t[h].vec.y),i.closePath(),i.stroke(),i.lineWidth=1,i.strokeStyle="rgba(255, 255, 255, 1)",i.fillStyle="#f00",i.beginPath(),i.arc(t[h].vec.x,t[h].vec.y,4,0,2*Math.PI),i.closePath(),i.fill(),i.stroke();n?(i.fillStyle="#f00",i.beginPath(),i.arc(s.x,s.y,1.5,0,2*Math.PI),i.closePath(),i.fill()):(i.beginPath(),i.arc(s.x,s.y,o,0,2*Math.PI),i.closePath(),i.fillStyle="#f00",i.fill(),i.beginPath(),i.arc(s.x,s.y,e,0,2*Math.PI),i.closePath(),i.fillStyle="#0f0",i.fill(),i.fillStyle="rgba(255, 255, 255, 1)",i.font="bold 11px Arial",i.textAlign="center",i.fillText("".concat(t.length),s.x,s.y+4))};class h{constructor(i){this.clustersRPoint=[],this.optimizer=void 0,this.optimizer=i}InitGeometry(){this.clustersRPoint=[]}addClusterByGeometries(i){for(let t=0;t<i.length;++t)this.clustersRPoint.push(new o(this,i[t]))}RemoveCluster(i){this.clustersRPoint.splice(this.clustersRPoint.indexOf(i),1)}Render(i,t,s){if(this.clustersRPoint.length>0)for(let e=0;e<this.clustersRPoint.length;++e)this.clustersRPoint[e].Draw(i,this,t,s)}}class r{constructor(i){this.optimizer=void 0,this.pointList=[],this.optimizer=i}update(){this.updatePoints(),this.pointList=this.BuildConnectivity(this.pointList),this.initGeometry();const i=this.buildGraph(this.pointList);if(void 0!==i){this.addClusterByGeometries(i),this.PostUpdateCollisionBasedonGraph();const t=this.NeedDecompose();t.length>0&&(this.SplitClusters(t),this.PostMergeCluster())}}initGeometry(){this.optimizer.renderer.InitGeometry()}addClusterByGeometries(i){this.optimizer.renderer.addClusterByGeometries(i)}updatePoints(){this.pointList=[];for(let i=0;i<this.optimizer.points.length;++i)if(!this.optimizer.points[i].isHidden&&this.optimizer.points[i].isRenderable){const t=this.optimizer.points[i];t.collision.Reset(),this.pointList.push(t)}}BuildConnectivity(i){for(let t=0;t<i.length;++t){const s=i[t];for(let o=t+1;o<i.length;++o){const t=i[o];!t.isCollapse&&t!==s&&(0,e.Y4)([s.collision.minVec,s.collision.maxVec],[t.collision.minVec,t.collision.maxVec])&&(s.collision.isCollided=!0,s.isCollapse=!0,s.numVisit=0,s.collision.neighborShapes.push(t),t.collision.isCollided=!0,t.isCollapse=!0,t.numVisit=0,t.collision.neighborShapes.push(s))}}return i}buildGraph(i){let t=[];for(let s=0;s<i.length;++s){let e=[],o=[i[s]];o[0].collision.isVisited=!0,e.push(o[0]);let n,h=0;for(;void 0!==(n=o.shift());){for(let i=0;i<n.collision.neighborShapes.length;++i)n.collision.neighborShapes[i].collision.isVisited||(n.collision.neighborShapes[i].collision.isVisited=!0,o.push(n.collision.neighborShapes[i]),e.push(n.collision.neighborShapes[i]));if(h++>1e3)return void console.debug("fail to optimize")}e.length>1&&t.push(e)}return t}PostUpdateCollisionBasedonGraph(){for(let i=0;i<this.optimizer.renderer.clustersRPoint.length;++i)this.UpdateByQueue(this.optimizer.renderer.clustersRPoint[i],this.pointList)}UpdateByQueue(i,t){let s=0;const o=[...t];for(;o.length;){const n=o.shift();if(n){if(n.numVisit>100){n.numVisit=0;break}if(0===o.length&&t.length<s++)break;n.collision.isCollided||((0,e.Y4)([n.collision.minVec,n.collision.maxVec],[i.minVec,i.maxVec])?(n.collision.isCollided=!0,n.isCollapse=!0,n.numVisit=0,i.AddPost(n)):(n.numVisit++,o.push(n)))}}}NeedDecompose(){const i=[];for(let t=0;t<this.optimizer.renderer.clustersRPoint.length;++t)this.optimizer.renderer.clustersRPoint[t].NeedDecompose()&&i.push(this.optimizer.renderer.clustersRPoint[t]);return i}SplitClusters(i){for(let t=0;t<i.length;++t)i[t].Split()}PostMergeCluster(){this.PostMergeClusterCompute(this.optimizer.renderer.clustersRPoint)}PostMergeClusterCompute(i){for(let t=0;t<i.length-1;++t){const s=i[t];for(let o=t+1;o<i.length;++o){const t=i[o];t.isVisited||(0,e.TE)(s.vec,t.vec)<s.r1+20&&(t.isVisited=!0,s.Merge(t))}}}}class l{constructor(){this.graphClustering=void 0,this.renderer=void 0,this.mv=new e.h9(0,0),this.inspection=!0,this.points=[],this.graphClustering=new r(this),this.renderer=new h(this)}push(i,t,s,o){const n=new e.MO(i,t);n.vec.lon=s,n.vec.lat=o,this.points.push(n),this.update()}mouseInteraction(i,t){}extentChanging(i,t){this.points.forEach((i=>{const s=t(i.vec.lon,i.vec.lat);i.vec.x=s[0],i.vec.y=s[1],i.updateBounding()})),this.update()}update(){this.graphClustering.update()}getCellAtPoint(i){}render(i,t,s,e){this.points.forEach((e=>{if(t){const i=s(e.vec.lon,e.vec.lat);e.vec.x=i[0],e.vec.y=i[1],e.updateBounding()}e.render(i)})),t&&this.update(),this.renderer.Render(i,t,s)}}var c=s(5483),a=s.n(c);class d{constructor(i){var t=this;this.map=void 0,this.div=void 0,this.center=function(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-99.292649,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:39.043903;t.map.setCenter({lat:s,lng:i})},this.toMap=(i,t)=>{const s=this.map.unproject({x:i,y:t});return[s.lng,s.lat]},this.toScreen=(i,t)=>{const s=this.map.project([i,t]);return[s.x,s.y]},this.extentChanging=i=>{},this.mouseDown=i=>{},this.mouseUp=i=>{},this.mouseMove=i=>{},this.mouseClick=i=>{},this.mouseDClick=i=>{},this.initMap(i)}initMap(i){a().accessToken="pk.eyJ1IjoiZGVzaWduanUiLCJhIjoiY2xhNGU0YWo4MDlhYzNwdHBwenVvang4eiJ9.P3sX4l_3KjdPeRRbVS1VVg",this.map=new(a().Map)({container:i,zoom:15,center:[-71.093161,42.358871],style:"mapbox://styles/mapbox/dark-v10"}),this.map.dragRotate.disable(),this.map.on("mousemove",(i=>{this.mouseMove(i)})),this.map.on("click",(i=>{this.mouseClick(i)})),this.map.on("mousedown",(i=>{this.mouseDown(i)})),this.map.on("dblclick",(i=>{this.mouseDClick(i)})),this.map.on("mouseup",(i=>{this.mouseUp(i)})),this.map.on("zoom",(i=>{this.extentChanging(i)})),this.map.on("drag",(i=>{this.extentChanging(i)}));let t=document.getElementsByClassName("mapboxgl-canvas")[0];t.style.position="absolute",t=document.getElementsByClassName("mapboxgl-control-container")[0],t.style.display="none",this.div=t}destroy(){this.div.parentElement.removeChild(this.div)}}var p=s(55913);class u{constructor(i){this.divHost=void 0,this.mapboxWrapper=void 0,this.renderer=void 0,this.mouseDown=i=>{},this.mouseUp=i=>{},this.mouseDrag=i=>{},this.mouseClick=i=>{this.renderer.pts.push([i.lngLat.lng,i.lngLat.lat]);const t=this.mapboxWrapper.toScreen(i.lngLat.lng,i.lngLat.lat);this.renderer.mouseClick(t[0],t[1])},this.mouseMove=i=>{},this.extentChanging=i=>{this.renderer.extentChanging(i)},this.divHost=document.getElementById(i),this.divHost.style.position="relative",this.mapboxWrapper=new d(this.divHost.id),this.mapboxWrapper.mouseDown=this.mouseDown,this.mapboxWrapper.mouseUp=this.mouseUp,this.mapboxWrapper.mouseClick=this.mouseClick,this.mapboxWrapper.mouseMove=this.mouseMove,this.mapboxWrapper.extentChanging=this.extentChanging,setTimeout((()=>{this.renderer=new m(this.divHost,this)}),100)}keyDown(i){}destroy(){for(this.mapboxWrapper.destroy(),this.renderer.destroy();this.divHost.lastElementChild;)this.divHost.removeChild(this.divHost.lastElementChild)}}class m extends p.bb{constructor(i,t){super(i),this.app=void 0,this.time=0,this.pts=[],this.clustering=void 0,this.mouseClick=(i,t)=>{const s=this.app.mapboxWrapper.toMap(i,t);this.clustering.push(i,t,s[0],s[1])},this.extentChanging=i=>{},this.mouseUp=(i,t)=>{},this.mouseDrag=(i,t)=>{},this.app=t,this.canvas.id="mapboxCustom",this.canvas.style.position="absolute",this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.pointerEvents="none",this.pts.push([-71.093161,42.358871]),this.clustering=new l,this.start()}render(i){this.time+=.1,this.clustering.render(i,this.app.mapboxWrapper.map.isMoving()||this.app.mapboxWrapper.map.isZooming(),this.app.mapboxWrapper.toScreen,this.app.mapboxWrapper.toMap)}}}}]);
//# sourceMappingURL=26376.462804f4.chunk.js.map