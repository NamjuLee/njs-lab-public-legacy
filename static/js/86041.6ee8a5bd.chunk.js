"use strict";(self.webpackChunkNJS_Lab=self.webpackChunkNJS_Lab||[]).push([[86041],{86041:(t,e,i)=>{i.r(e),i.d(e,{AppImageEditing:()=>z});var s=i(17874);class a{constructor(t){this.app=void 0,this.app=t}set setTypeImageCompression(t){this.app.core.canvas.typeImageCompression=t}shiftEnvironment(t){this.app.param.environment=t,this.app.core.scene.shiftEnvironment(t),this.app.core.canvas.renderForce()}onClickDestroy(){this.app.core.destroy();try{this.app.ui?this.app.ui.divExpressImageEditingWrapper.parentNode.removeChild(this.app.ui.divExpressImageEditingWrapper):this.app.core.div.parentNode.removeChild(this.app.core.div)}catch(t){console.debug(t)}this.app.emitAction("destroy")}activateEffectEnv(t){this.app.core.activeCommand.activateEffectEnv(t)}deactivateEffectEnv(){this.app.core.activeCommand.deactivateEffectEnv()}onClickPlace(){this.app.core.activeCommand.emitDataToSave(),this.onClickDestroy()}onClickCancel(){this.onClickDestroy()}onClickReset(){}onClickUndo(){this.app.core.scene.undo()}onClickRedo(){this.app.core.scene.redo()}onClickRevertToOriginal(){this.app.core.activeCommand.revertToOriginal()}onClickDownload(){}onClickCapture(){}initEffect(t){this.app.core.activeCommand.updateEffect(t,!1),this.app.core.filter.emitFilterData()}updateEffect(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.app.core.activeCommand.updateEffect(t,e)}getGeometryLength(){return this.app.core.scene.dataGeometries.length}updateCropDOM(){this.app.core.frame.renderer.updateSVG()}getFrameSize(){return this.app.core.frame.frameSize}onClickShiftShape(t){this.app.core.frame.frameShapeType=t,this.app.core.renderer.captureCanvas(),this.app.core.common.captureState()}onClickShiftShapeRatio(t){this.app.core.frame.frameRatioType=t,this.app.core.renderer.initPostSaveImg=!0,this.app.core.renderer.captureCanvas(),this.app.core.common.captureState()}onRotateCropping(t){this.app.core.common.rotationByDegree(t)}onDragRotate(t){this.app.core.common.rotate(t)}onDragZoom(t){this.app.core.common.scale(t)}onZoomLevel(t){this.app.core.common.scaleByLevel(t)}inputImportByURL(t){this.app.core.common.reset(),this.app.core.importImage(t)}initFrame(t,e,i,s,a,r,h,o){this.updateFrame(t,e,i,s,a,r,h,o),this.app.core.filter.update(!1),this.app.core.scene.captureState()}updateFrame(t,e,i,s,a,r,h,o){this.app.core.frame.updateFrame(t,e,i,s,a,r,h,o),this.app.core.canvas.renderForce()}updateFrameParam(t,e,i,s,a,r,h,o){this.app.core.frame.updateFrameParam(t,e,i,s,a,r,h,o),this.app.core.renderer.captureCanvas()}updateGeometries(t){this.app.core.scene.dataGeometries=t}shiftFilterPreset(t){this.app.core.filter.shiftEffectByPreset(t)}setScaleGlobal(t){this.app.core.scene.scaleByRatio=t}getData(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&this.app.core.activeCommand.forceRevertToOriginal(),{ctx:this.getCtx(),ctxFiltered:this.getCtxFiltered(),params:this.getParams(),drawing:this.getDrawing(),effecting:this.getEffecting()}}getEffecting(){return this.app.core.filter.getData()}getDrawing(){return this.app.core.scene.dataGeometries}getParams(){return this.app.core.activeCommand.getParamsCropping()}getImage(){return this.app.core.canvas.capture()}getCtx(){return this.app.core.canvas.captureCtx()}getCtxFiltered(){return this.app.core.canvas.captureCtxFiltered()}updateCoverColor(t){const e=[(0,s.rW)(t)],i=[e[0][0],e[0][1],e[0][2]];let a=(0,s.XL)(i[0],i[1],i[2]),r=[...a];a[0]+=0,a[1]+=-.05,a[1]<0&&(a[1]=0),a[2]+=0,r[0]+=0,r[1]+=0,r[1]<0&&(r[1]=0),r[2]+=-.02;let h=(0,s.wX)(r[0],r[1],r[2]);this.app.core.frame.updateColorBG(h[0],h[1],h[2])}}class r{constructor(t){this.controller=void 0,this.touchPre=[-100,-100],this.touchstart=t=>{this.controller.canvas.core.renderer.t=0;var e=this.controller.canvas.canvas.getBoundingClientRect();const i=t.targetTouches[0].pageX-e.left,s=t.targetTouches[0].pageY-e.top;this.touchPre[0]=i,this.touchPre[1]=s,this.controller.canvas.core.activeCommand.touchStartRotation=!0,this.controller.canvas.core.activeCommand.touchStartScale=!0,this.controller.canvas.core.activeCommand.pointDown(t.targetTouches[0].clientX,t.targetTouches[0].clientY)},this.touchmove=t=>{if(t.targetTouches.length>1)return this.controller.canvas.core.activeCommand.rotationByTouch(t),void this.controller.canvas.core.activeCommand.scaleByTouch(t);this.controller.canvas.core.activeCommand.pointDrag(t.targetTouches[0].clientX,t.targetTouches[0].clientY)},this.touchcancel=t=>{this.controller.canvas.core.activeCommand.touchStartRotation=!1,this.controller.canvas.core.activeCommand.touchStartScale=!1,t.preventDefault()},this.touchend=t=>{this.controller.canvas.core.activeCommand.pointUp(-1,-1)},this.controller=t}}class h{constructor(t){this.controller=void 0,this.mouseDown=t=>{this.controller.canvas.core.activeCommand.pointDown(t.clientX,t.clientY)},this.mouseUp=t=>{this.controller.canvas.core.activeCommand.pointUp(t.clientX,t.clientY)},this.mouseWheel=(t,e)=>{this.controller.canvas.core.activeCommand.zoom(t.deltaY)},this.mouseMove=t=>{this.controller.canvas.core.activeCommand.isDown?this.controller.canvas.core.activeCommand.pointDrag(t.clientX,t.clientY):this.controller.canvas.core.activeCommand.pointMove(t.clientX,t.clientY)},this.controller=t}}class o{constructor(t){this.controller=void 0,this.keyDown=t=>{this.controller.canvas.core.activeCommand.hasShift=t.shiftKey},this.keyUp=t=>{this.controller.canvas.core.activeCommand.hasShift=t.shiftKey},this.controller=t}}class n{constructor(t){this.canvas=void 0,this.touchInteraction=void 0,this.mouseInteraction=void 0,this.keyboardInteraction=void 0,this.resizeWindow=()=>{this.canvas.core.app.api.updateCropDOM(),this.canvas.renderForce()},this.canvas=t,this.touchInteraction=new r(this),this.mouseInteraction=new h(this),this.keyboardInteraction=new o(this)}appendEvent(){const t=this;document.body.addEventListener("keydown",t.keyboardInteraction.keyDown,!1),document.body.addEventListener("keyup",t.keyboardInteraction.keyUp,!1),document.body.addEventListener("mousedown",t.mouseInteraction.mouseDown,!1),document.body.addEventListener("mouseup",t.mouseInteraction.mouseUp,!1),document.body.addEventListener("mousemove",t.mouseInteraction.mouseMove,!1),this.canvas.canvas.addEventListener("wheel",(e=>t.mouseInteraction.mouseWheel(e,e.deltaY)),!1),document.body.addEventListener("touchstart",t.touchInteraction.touchstart,!1),document.body.addEventListener("touchmove",t.touchInteraction.touchmove,!1),document.body.addEventListener("touchcancel",t.touchInteraction.touchcancel,!1),document.body.addEventListener("touchend",t.touchInteraction.touchend,!1),window.addEventListener("resize",t.resizeWindow,!1)}removeEvent(){const t=this;document.body.removeEventListener("keydown",t.keyboardInteraction.keyDown,!1),document.body.removeEventListener("keyup",t.keyboardInteraction.keyUp,!1),document.body.removeEventListener("mousedown",t.mouseInteraction.mouseDown,!1),document.body.removeEventListener("mouseup",t.mouseInteraction.mouseUp,!1),document.body.removeEventListener("mousemove",t.mouseInteraction.mouseMove,!1),document.body.removeEventListener("touchstart",t.touchInteraction.touchstart,!1),document.body.removeEventListener("touchmove",t.touchInteraction.touchmove,!1),document.body.removeEventListener("touchcancel",t.touchInteraction.touchcancel,!1),document.body.removeEventListener("touchend",t.touchInteraction.touchend,!1),window.removeEventListener("resize",t.resizeWindow,!1)}}class c{constructor(t){this.core=void 0,this.eventController=void 0,this.canvas=void 0,this.ctx=void 0,this.isActive=!1,this.log=void 0,this.isViewChanging=!1,this.loopNum=0,this.needRenderloop=!0,this.ablePan=!0,this.canvasOutFiltered=void 0,this.ctxOutFiltered=void 0,this.canvasOut=void 0,this.ctxOut=void 0,this.loopNeeded=!1,this.typeImageCompression=s.__.Png,this.loopNumMax=90,this.needcheckerboardbackground=!1,this.imgOut=void 0,this.core=t,this.loopNeeded=!1,this.eventController=new n(this),this.imgOut=new Image,this.imgOut.crossOrigin="anonymous",this.init(),this.loopInit()}init(){const t=document.createElement("canvas"),e=document.createElement("canvas"),i=document.createElement("canvas");if(t&&e&&i){this.canvas=t,this.canvas.id="editing-view",this.canvas.width=this.core.div.clientWidth,this.canvas.height=this.core.div.clientHeight,this.canvas.style.width="100%",this.canvas.style.height="100%",this.needcheckerboardbackground&&(this.canvas.style.background="repeating-conic-gradient(#cccccc 0% 25%, #ffffff 0% 50%) 50% / 10px 10px"),this.core.div.append(this.canvas),this.canvasOutFiltered=e,this.canvasOutFiltered.style.border="5px",this.ctxOutFiltered=this.canvasOutFiltered.getContext("2d"),this.canvasOut=i,this.ctxOut=this.canvasOut.getContext("2d");const s=this.canvas.getContext("2d");s&&(this.ctx=s,this.isActive=!0,this.initEvent())}}initEvent(){this.eventController.appendEvent()}capture(){return this.imgOut.src=this.canvasOutFiltered.toDataURL("image/".concat(this.typeImageCompression),.8),this.imgOut}captureCtxFiltered(){return this.ctxOutFiltered}captureCtx(){return this.ctxOut}loopInit(){this.needRenderloop=!0,this.loop()}resize(){this.canvas.width=this.core.div.clientWidth,this.canvas.height=this.core.div.clientHeight}loop(){if(this.needRenderloop&&(requestAnimationFrame((()=>{this.loop()})),this.loopNum++<100&&this.loopNum++<this.loopNumMax)){let t=performance.now();this.renderPre(this.ctx);let e=performance.now();this.log="level: , total frames: ".concat(this.loopNum++," (FPS: ), a loop took: ").concat((e-t).toFixed(2)," ms to execute.")}}clear(t){t.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height)}drawBackgroundWhite(t){this.typeImageCompression,s.__.Jpeg}renderForce(){this.loopNum=0}renderPre(t){this.isActive&&(this.clear(t),this.drawBackgroundWhite(t),this.render(t))}render(t){}destroy(){this.needRenderloop=!1,this.loopNum=this.loopNumMax,this.eventController.removeEvent();try{this.core.div.removeChild(this.canvas)}catch(t){}}}class d{constructor(t){this.core=void 0,this.core=t}undo(){console.log("undo")}redo(){console.log("undo")}import(t){this.reset()}reset(){this.core.reset()}updateCursor(){this.core.frame.isHover?-1===this.core.frame.idHover?this.core.activeCommand.activeCursor.dragging():0===this.core.frame.idHover||2===this.core.frame.idHover?this.core.activeCommand.activeCursor.set_nwse_resize():1===this.core.frame.idHover||3===this.core.frame.idHover?this.core.activeCommand.activeCursor.set_nesw_resize():5===this.core.frame.idHover||7===this.core.frame.idHover?this.core.activeCommand.activeCursor.set_ew_resize():4!==this.core.frame.idHover&&6!==this.core.frame.idHover||this.core.activeCommand.activeCursor.set_ns_resize():this.core.activeCommand.activeCursor.default()}updateWidthByInput(t){t<this.core.frame.widthMin?this.core.frame.width=this.core.frame.widthMin:t+this.core.frame.x>this.core.imageWrapper.img.width?this.core.frame.width=this.core.imageWrapper.img.width-this.core.frame.x:this.core.frame.width=t,this.updateSizeByInputPost()}updateHeightByInput(t){t<this.core.frame.heightMin?this.core.frame.height=this.core.frame.heightMin:t+this.core.frame.y>this.core.imageWrapper.img.height?this.core.frame.height=this.core.imageWrapper.img.height-this.core.frame.y:this.core.frame.height=t,this.updateSizeByInputPost()}updateSizeByInputPost(){this.core.frame.update(),this.core.canvas.renderForce(),this.core.canvas.canvasOutFiltered.width=this.core.frame.width,this.core.canvas.canvasOutFiltered.height=this.core.frame.height}offsetByInput(t){0!==this.core.frame.idSelected&&4!==this.core.frame.idSelected&&7!==this.core.frame.idSelected||(t*=-1),this.core.frame.offsetByIDFreeform(this.core.frame.idSelected,t,t)}rotate(t){this.core.activeCommand.rotationRadian=t,this.postUpdate()}rotationByDegree(t){this.core.activeCommand.rotationRadian+=(0,s.Yr)(t),this.postUpdate()}scale(t){this.core.activeCommand.zoomLevel=t,this.postUpdate()}scaleByLevel(t){t=(t=(t+=this.core.activeCommand.zoomLevel)<.75?.75:t)>1.25?1.25:t,this.core.activeCommand.zoomLevel=t,this.postUpdate()}downloadImage(t){const e=document.createElement("a");e.href=t?t.src:this.core.canvas.canvasOutFiltered.toDataURL(),e.download="image.png",document.body.appendChild(e),e.click(),document.body.removeChild(e)}postUpdate(){this.core.filter.numRendered=0,this.core.filter.update(!1,!1),this.core.canvas.renderForce()}captureState(){this.core.scene.captureState()}}class l{constructor(t){this.core=void 0,this.activeCursor=void 0,this.isDown=!1,this.isDrag=!1,this.mousePre=[0,0],this.mouse=[0,0],this.mouseRemapValue=[1,1],this.canvasBounding=void 0,this.zoomLevel=1,this.rotationRadian=0,this.scalePre=1,this.anglePre=0,this.touchStartRotation=!1,this.touchStartScale=!1,this.hasShift=!1,this.clickUI=!1,this.topToleranceForClickUI=-25,this.mouseDragRect=(t,e)=>{this.core.frame.translate(this.mouse[0],this.mouse[1]),this.mousePre[0]=this.mouse[0],this.mousePre[1]=this.mouse[1]},this.mouseDragPan=(t,e)=>{this.pan(this.mouse[0],this.mouse[1])},this.core=t,this.activeCursor=new s.$b}toScreen(t,e){return[t/this.core.activeCommand.mouseRemapValue[0],e/this.core.activeCommand.mouseRemapValue[1]]}mousePostProcess(t,e){this.canvasBounding=this.core.canvas.canvas.getBoundingClientRect(),this.mouseRemapValue[0]=this.core.imageWrapper.img.width/this.canvasBounding.width,this.mouseRemapValue[1]=this.core.imageWrapper.img.height/this.canvasBounding.height,this.mouse[0]=(t-this.canvasBounding.left)*this.core.imageWrapper.img.width/this.canvasBounding.width,this.mouse[1]=(e-this.canvasBounding.top)*this.core.imageWrapper.img.height/this.canvasBounding.height,e-this.canvasBounding.top<this.topToleranceForClickUI?this.clickUI=!0:this.clickUI=!1}pointDown(t,e){this.mousePostProcess(t,e),this.isDown=!0,this.core.frame.isHoverCheck(this.mouse[0],this.mouse[1]),this.core.frame.updateVecPre(),this.mousePre[0]=this.mouse[0],this.mousePre[1]=this.mouse[1],this.core.common.postUpdate()}pointUp(t,e){this.mousePostProcess(t,e),this.isDrag=!1,this.isDown=!1,this.core.frame.mouseUp(),this.core.common.postUpdate(),this.core.frame.isMoved()&&(this.core.common.captureState(),this.core.renderer.captureCanvas())}pointMove(t,e){this.mousePostProcess(t,e),this.core.frame.isHoverCheck(this.mouse[0],this.mouse[1]),this.mousePre[0]=this.mouse[0],this.mousePre[1]=this.mouse[1],this.core.common.updateCursor(),this.core.common.postUpdate()}pointDrag(t,e){this.isDrag=!0,this.mousePostProcess(t,e),this.core.frame.isHover?this.mouseDragRect(this.mouse[0],this.mouse[1]):this.mouseDragPan(this.mouse[0],this.mouse[1]),this.core.common.postUpdate()}zoom(t){}pan(t,e){}revertToOriginal(){this.core.renderer.captureCanvas(),this.core.frame.revertToOriginal(),this.core.canvas.capture()}forceRevertToOriginal(){this.core.renderer.updateCtxForce()}rotationByTouch(t){let e,i;this.core.canvas.renderForce(),t.targetTouches[0].clientY<t.targetTouches[1].clientY?(e=t.targetTouches[0],i=t.targetTouches[1]):(e=t.targetTouches[1],i=t.targetTouches[0]);const s=Math.atan2(i.clientX-e.clientX,i.clientY-e.clientY),a=this.anglePre-s;if(this.touchStartRotation)return this.anglePre=this.rotationRadian,this.touchStartRotation=!1,void(this.anglePre=s);this.rotationRadian+=a,this.anglePre=s}scaleByTouch(t){let e,i;this.core.canvas.renderForce(),t.targetTouches[0].clientY<t.targetTouches[1].clientY?(e=t.targetTouches[0],i=t.targetTouches[1]):(e=t.targetTouches[1],i=t.targetTouches[0]);const s=Math.sqrt((i.clientX-e.clientX)*(i.clientX-e.clientX)+(i.clientY-e.clientY)*(i.clientY-e.clientY));if(this.scalePre>s?this.zoomLevel>.4&&(this.zoomLevel-=.015):this.zoomLevel<2&&(this.zoomLevel+=.015),this.touchStartScale)return this.scalePre=this.zoomLevel,this.touchStartScale=!1,void(this.scalePre=s);this.scalePre=s}getParamsCropping(){return{x:Math.round(this.core.frame.x),y:Math.round(this.core.frame.y),width:Math.round(this.core.frame.width),height:Math.round(this.core.frame.height),scale:this.core.activeCommand.zoomLevel,rotationRadian:this.core.activeCommand.rotationRadian,shape:this.core.frame.frameShapeType,aspectRatio:this.core.frame.frameRatioType}}getParamsFilter(){return this.core.filter.getData()}emitDataToSave(){const t={crop:this.getParamsCropping(),filter:this.getParamsFilter()};this.core.app.emitAction("update@".concat(JSON.stringify(t)))}emitUndoRedoHistory(t){const e="history@".concat(JSON.stringify(t));this.core.app.emitAction(e)}updateEffect(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.core.filter.updateEffect(t,e)}activateEffectEnv(t){"markup"!==t&&this.core.scene.resetState(),this.core.filter.activateEffectEnv(),this.core.frame.renderer.hide=!0,this.core.app.emitAction("ready@filter")}deactivateEffectEnv(){this.core.scene.resetState(),this.core.filter.deactivateEffectEnv(),this.core.frame.renderer.hide=!1,this.core.app.emitAction("ready@crop")}}class m{constructor(t){this.renderer=void 0,this.svgRectControl0=void 0,this.svgRectControl1=void 0,this.svgRectControl2=void 0,this.svgRectControl3=void 0,this.svgRectControl4=void 0,this.svgRectControl5=void 0,this.svgRectControl6=void 0,this.svgRectControl7=void 0,this.svgRectFrame=void 0,this.svgRec=void 0,this.lineX0=void 0,this.lineX1=void 0,this.lineY0=void 0,this.lineY1=void 0,this.renderer=t;this.svgRectFrame=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svgRectFrame.setAttribute("width","".concat(102)),this.svgRectFrame.setAttribute("height","".concat(102)),this.svgRectFrame.setAttribute("fill-opacity","".concat(0)),this.svgRectFrame.style.position="absolute",this.renderer.frame.core.div.appendChild(this.svgRectFrame);const e="#CBDAE2",i=document.createElementNS("http://www.w3.org/2000/svg","rect");i.setAttribute("x","1"),i.setAttribute("y","1"),i.setAttribute("stroke-width","".concat(1)),i.setAttribute("stroke","".concat(e)),this.svgRec=i,this.svgRectFrame.appendChild(i),this.lineX0=document.createElementNS("http://www.w3.org/2000/svg","line"),this.lineX0.setAttribute("stroke-width","".concat(1)),this.lineX0.setAttribute("stroke","".concat(e)),this.svgRectFrame.appendChild(this.lineX0),this.lineX1=document.createElementNS("http://www.w3.org/2000/svg","line"),this.lineX1.setAttribute("stroke-width","".concat(1)),this.lineX1.setAttribute("stroke","".concat(e)),this.svgRectFrame.appendChild(this.lineX1),this.lineY0=document.createElementNS("http://www.w3.org/2000/svg","line"),this.lineY0.setAttribute("stroke-width","".concat(1)),this.lineY0.setAttribute("stroke","".concat(e)),this.svgRectFrame.appendChild(this.lineY0),this.lineY1=document.createElementNS("http://www.w3.org/2000/svg","line"),this.lineY1.setAttribute("stroke-width","".concat(1)),this.lineY1.setAttribute("stroke","".concat(e)),this.svgRectFrame.appendChild(this.lineY1),this.svgRectControl0=(0,s.R4)(),this.renderer.frame.core.div.appendChild(this.svgRectControl0),this.svgRectControl1=(0,s.R4)(),this.renderer.frame.core.div.appendChild(this.svgRectControl1),this.svgRectControl2=(0,s.R4)(),this.renderer.frame.core.div.appendChild(this.svgRectControl2),this.svgRectControl3=(0,s.R4)(),this.renderer.frame.core.div.appendChild(this.svgRectControl3),this.svgRectControl4=(0,s.R4)(8,24),this.renderer.frame.core.div.appendChild(this.svgRectControl4),this.svgRectControl5=(0,s.R4)(24),this.renderer.frame.core.div.appendChild(this.svgRectControl5),this.svgRectControl6=(0,s.R4)(8,24),this.renderer.frame.core.div.appendChild(this.svgRectControl6),this.svgRectControl7=(0,s.R4)(24),this.renderer.frame.core.div.appendChild(this.svgRectControl7)}updatePos(){if(!this.renderer.frame.core.canvas&&!this.renderer.frame.core.canvas.ctx)return;const t=this.renderer.frame.core.canvas.ctx;if(void 0===t.canvas.parentElement)return;if(void 0===t.canvas.parentElement.parentElement)return;const e=t.canvas.getBoundingClientRect(),i=e.height,s=t.canvas.parentElement.parentElement.parentElement.parentElement.getBoundingClientRect().height-i;let a=0;s>0&&(a=.5*s);const r=-29,h=-5+a;this.svgRectControl0.style.left=e.x+r+this.renderer.frame.x*e.width/t.canvas.width+1+"px",this.svgRectControl0.style.top=h+this.renderer.frame.y*e.height/t.canvas.height+"px",this.svgRectControl1.style.left=e.x+r+(this.renderer.frame.x+this.renderer.frame.width)*e.width/t.canvas.width+"px",this.svgRectControl1.style.top=h+this.renderer.frame.y*e.height/t.canvas.height+"px",this.svgRectControl2.style.left=e.x+r+(this.renderer.frame.x+this.renderer.frame.width)*e.width/t.canvas.width+"px",this.svgRectControl2.style.top=h+(this.renderer.frame.y+this.renderer.frame.height)*e.height/t.canvas.height+"px",this.svgRectControl3.style.left=e.x+r+this.renderer.frame.x*e.width/t.canvas.width+1+"px",this.svgRectControl3.style.top=h+(this.renderer.frame.y+this.renderer.frame.height)*e.height/t.canvas.height+"px",this.svgRectControl4.style.left=e.x+r+this.renderer.frame.x*e.width/t.canvas.width+1+"px",this.svgRectControl4.style.top=-8+parseInt(this.svgRectControl0.style.top)+.5*(parseInt(this.svgRectControl2.style.top)-parseInt(this.svgRectControl0.style.top))+"px",this.svgRectControl5.style.left=.5*(parseInt(this.svgRectControl0.style.left)+parseInt(this.svgRectControl2.style.left))-7+"px",this.svgRectControl5.style.top=h+this.renderer.frame.y*e.height/t.canvas.height+"px",this.svgRectControl6.style.left=e.x+r+(this.renderer.frame.x+this.renderer.frame.width)*e.width/t.canvas.width+"px",this.svgRectControl6.style.top=-8+parseInt(this.svgRectControl0.style.top)+.5*(parseInt(this.svgRectControl2.style.top)-parseInt(this.svgRectControl0.style.top))+"px",this.svgRectControl7.style.left=.5*(parseInt(this.svgRectControl0.style.left)+parseInt(this.svgRectControl2.style.left))-7+"px",this.svgRectControl7.style.top=h+(this.renderer.frame.y+this.renderer.frame.height)*e.height/t.canvas.height+"px";this.svgRectFrame.style.left=parseInt(this.svgRectControl0.style.left)+4+"px",this.svgRectFrame.style.top=parseInt(this.svgRectControl0.style.top)+4+1+"px",this.svgRectFrame.style.width=parseInt(this.svgRectControl1.style.left)-parseInt(this.svgRectFrame.style.left)+4+2+"px",this.svgRectFrame.style.height=parseInt(this.svgRectControl2.style.top)-parseInt(this.svgRectFrame.style.top)+4+2+"px",this.svgRec.style.width=parseInt(this.svgRectControl1.style.left)-parseInt(this.svgRectFrame.style.left)+4+"px",this.svgRec.style.height=parseInt(this.svgRectControl2.style.top)-parseInt(this.svgRectFrame.style.top)+4+"px",this.lineX0.setAttribute("x1","1"),this.lineX0.setAttribute("y1","".concat(.33*parseInt(this.svgRectFrame.style.height))),this.lineX0.setAttribute("x2","".concat(parseInt(this.svgRectFrame.style.width))),this.lineX0.setAttribute("y2","".concat(.33*parseInt(this.svgRectFrame.style.height)+1)),this.lineX1.setAttribute("x1","1"),this.lineX1.setAttribute("y1","".concat(.66*parseInt(this.svgRectFrame.style.height))),this.lineX1.setAttribute("x2","".concat(parseInt(this.svgRectFrame.style.width))),this.lineX1.setAttribute("y2","".concat(.66*parseInt(this.svgRectFrame.style.height)+1)),this.lineY0.setAttribute("x1","".concat(.33*parseInt(this.svgRectFrame.style.width))),this.lineY0.setAttribute("y1","1"),this.lineY0.setAttribute("x2","".concat(.33*parseInt(this.svgRectFrame.style.width))),this.lineY0.setAttribute("y2","".concat(parseInt(this.svgRectFrame.style.height)-1)),this.lineY1.setAttribute("x1","".concat(.66*parseInt(this.svgRectFrame.style.width))),this.lineY1.setAttribute("y1","1"),this.lineY1.setAttribute("x2","".concat(.66*parseInt(this.svgRectFrame.style.width))),this.lineY1.setAttribute("y2","".concat(parseInt(this.svgRectFrame.style.height)-1))}set hide(t){const e=!0===t?"none":"block";this.svgRectControl0.style.display=e,this.svgRectControl1.style.display=e,this.svgRectControl2.style.display=e,this.svgRectControl3.style.display=e,this.svgRectControl4.style.display=e,this.svgRectControl5.style.display=e,this.svgRectControl6.style.display=e,this.svgRectControl7.style.display=e,this.svgRec.style.display=e,this.lineX0.style.display=e,this.lineX1.style.display=e,this.lineY0.style.display=e,this.lineY1.style.display=e}}class p{constructor(t){this.frame=void 0,this._opacity=0,this._time=0,this._tSVG=0,this._fillStyleRuntime="",this._fillStyle=[200,200,200,1],this._fillStyleHover=[200,200,200,.5],this._sizePoint=3,this._sizeMidPoint=3,this.rendererSVG=void 0,this.isActive=!1,this.needtoHideSVG=!1,this.frame=t}initPost(){this.isActive||(this.rendererSVG=new m(this),this.needtoHideSVG&&(this.rendererSVG.hide=!1)),this.isActive=!0}get sizePoint(){return this._sizePoint}get sizeMidPoint(){return this._sizeMidPoint}updateColorBG(t,e,i){this._fillStyle[0]=t,this._fillStyle[1]=e,this._fillStyle[2]=i,this._fillStyleHover[0]=t,this._fillStyleHover[1]=e,this._fillStyleHover[2]=i}render(t){this.isActive&&(this.ColorInterpolation(),this.frame.isHover,t.fillStyle=this._fillStyleRuntime,this.trimContextByShape(t,!0),this.renderPost(t),this._time+=.15)}trimContextByShape(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];(0,s.CU)(t,this.frame.frameShapeType,this.frame.x,this.frame.y,this.frame.width,this.frame.height,e)}updateSVG(){this.isActive&&(this._tSVG=0)}renderPost(t){if(this.frame.isHover)for(let e=0;e<this.frame.cpList.length;++e);this._tSVG++<50&&this.rendererSVG.updatePos()}ColorInterpolation(){this.frame.isHover?this._opacity+=.025:this._opacity-=.015,this._opacity>.7&&(this._opacity=.7),this._opacity<.35&&(this._opacity=.35);const t=(0,s.Hq)(this._fillStyle,this._fillStyleHover,this._opacity);this._fillStyleRuntime="rgba(".concat(t[0],", ").concat(t[1],", ").concat(t[2],", ").concat(t[3],")")}updateGeometry(t){}set hide(t){this.isActive&&(this.rendererSVG.hide=t)}}let v;!function(t){t.Endpoint="Endpoint",t.Midpoint="Midpoint"}(v||(v={}));class u{constructor(t,e,i){this.x=void 0,this.y=void 0,this.frame=void 0,this.id=void 0,this.type=void 0,this.frame=t,this.id=e,this.type=i,this.update()}isHoverCheck(t,e){const[i,a]=this.frame.core.activeCommand.toScreen(this.x,this.y),[r,h]=this.frame.core.activeCommand.toScreen(t,e);return(0,s.TE)(i,a,r,h)<this.frame.r?this.id:-1}update(){this.type===v.Endpoint?0===this.id?(this.x=this.frame.x,this.y=this.frame.y):1===this.id?(this.x=this.frame.x+this.frame.width,this.y=this.frame.y):2===this.id?(this.x=this.frame.x+this.frame.width,this.y=this.frame.y+this.frame.height):3===this.id&&(this.x=this.frame.x,this.y=this.frame.y+this.frame.height):this.type===v.Midpoint&&(4===this.id?(this.x=this.frame.x+.5*this.frame.width,this.y=this.frame.y):5===this.id?(this.x=this.frame.x+this.frame.width,this.y=this.frame.y+.5*this.frame.height):6===this.id?(this.x=this.frame.x+.5*this.frame.width,this.y=this.frame.y+this.frame.height):7===this.id&&(this.x=this.frame.x,this.y=this.frame.y+.5*this.frame.height))}render(t){this.type===v.Endpoint?0===this.id?(0,s.hL)(t,this.frame.x,this.frame.y,this.frame.renderer.sizePoint,this.frame.renderer.sizePoint):1===this.id?(0,s.hL)(t,this.frame.x+this.frame.width,this.frame.y,this.frame.renderer.sizePoint,this.frame.renderer.sizePoint):2===this.id?(0,s.hL)(t,this.frame.x+this.frame.width,this.frame.y+this.frame.height,this.frame.renderer.sizePoint,this.frame.renderer.sizePoint):3===this.id&&(0,s.hL)(t,this.frame.x,this.frame.y+this.frame.height,this.frame.renderer.sizePoint,this.frame.renderer.sizePoint):this.type===v.Midpoint&&(4===this.id?(0,s.hL)(t,this.frame.x+.5*this.frame.width,this.frame.y,4*this.frame.renderer.sizeMidPoint,this.frame.renderer.sizeMidPoint):5===this.id?(0,s.hL)(t,this.frame.x+this.frame.width,this.frame.y+.5*this.frame.height,this.frame.renderer.sizeMidPoint,4*this.frame.renderer.sizeMidPoint):6===this.id?(0,s.hL)(t,this.frame.x+.5*this.frame.width,this.frame.y+this.frame.height,4*this.frame.renderer.sizeMidPoint,this.frame.renderer.sizeMidPoint):7===this.id&&(0,s.hL)(t,this.frame.x,this.frame.y+.5*this.frame.height,this.frame.renderer.sizeMidPoint,4*this.frame.renderer.sizeMidPoint))}}class f{constructor(t){this.frame=void 0,this.safeguardForDraggingOutOfExtent=!0,this.frame=t}offsetByIDConstraint(t,e,i){let a,r;e=e<0?0:e,i=i<0?0:i;let h,o=[this.frame.width,this.frame.height];switch(t){case 0:if(a=this.frame.x-e,h=(0,s.kC)(o[0],o[1],o[0]+a),this.frame.y+o[1]-h[1]<-1){if(this.safeguardForDraggingOutOfExtent){if(this.frame.y<1)break;a=1,h=(0,s.kC)(o[0],o[1],o[0]+a),this.frame.x-=1,this.frame.width=h[0],this.frame.y+=o[1]-h[1],this.frame.height=h[1]}break}if(this.frame.widthMin>h[0]||this.frame.heightMin>h[1])break;this.frame.x=e,this.frame.width=h[0],this.frame.y+=o[1]-h[1],this.frame.height=h[1];break;case 1:if(a=e-this.frame.x-this.frame.width,h=(0,s.kC)(o[0],o[1],o[0]+a),this.frame.y+o[1]-h[1]<-1||this.frame.x+h[0]>this.frame.core.canvas.canvas.width){if(this.safeguardForDraggingOutOfExtent){if(this.frame.y<-1||this.frame.x+this.frame.width>this.frame.core.canvas.canvas.width)break;a=1,h=(0,s.kC)(o[0],o[1],o[0]+a),this.frame.y+=o[1]-h[1],this.frame.width=h[0],this.frame.height=h[1]}break}if(this.frame.widthMin>h[0]||this.frame.heightMin>h[1])break;this.frame.y+=o[1]-h[1],this.frame.width=h[0],this.frame.height=h[1];break;case 2:if(a=e-this.frame.x-this.frame.width,h=(0,s.kC)(o[0],o[1],o[0]+a),this.frame.x+h[0]>this.frame.core.canvas.canvas.width||this.frame.y+h[1]>this.frame.core.canvas.canvas.height){if(this.safeguardForDraggingOutOfExtent){if(this.frame.x+this.frame.width>this.frame.core.canvas.canvas.width||this.frame.y+this.frame.height>this.frame.core.canvas.canvas.height)break;a=1,h=(0,s.kC)(o[0],o[1],o[0]+a),this.frame.width=h[0],this.frame.height-=o[1]-h[1]}break}if(this.frame.widthMin>h[0]||this.frame.heightMin>h[1])break;this.frame.width=h[0],this.frame.height-=o[1]-h[1];break;case 3:if(a=this.frame.x-e,h=(0,s.kC)(o[0],o[1],o[0]+a),this.frame.x-a<0||this.frame.y+h[1]>this.frame.core.canvas.canvas.height){if(this.safeguardForDraggingOutOfExtent){if(this.frame.y+this.frame.height+1>this.frame.core.canvas.canvas.height)break;a=1,h=(0,s.kC)(o[0],o[1],o[0]+a),this.frame.x-=h[0]-o[0],this.frame.width=h[0],this.frame.height-=o[1]-h[1]}break}this.frame.widthMin<h[0]&&this.frame.heightMin<h[1]&&(this.frame.x=e,this.frame.width=h[0],this.frame.height-=o[1]-h[1]);break;case 4:if(r=this.frame.y-i,h=(0,s.Ux)(o[0],o[1],o[1]+r),this.frame.x+.5*(o[0]-h[0])<0||this.frame.x+h[0]>this.frame.core.canvas.canvas.width){if(this.safeguardForDraggingOutOfExtent){if(this.frame.x<0||this.frame.x+this.frame.width-1>this.frame.core.canvas.canvas.width)break;r=1,h=(0,s.Ux)(o[0],o[1],o[1]+r),this.frame.x+=.5*(o[0]-h[0]),this.frame.width=h[0],this.frame.y+=-1,this.frame.height+=r}break}this.frame.height+r>=this.frame.heightMin&&(this.frame.x+=.5*(o[0]-h[0]),this.frame.width=h[0],this.frame.y=i,this.frame.height+=r);break;case 5:if(a=e-this.frame.x-this.frame.width,h=(0,s.kC)(o[0],o[1],o[0]+a),this.frame.y+.5*(o[1]-h[1])<0||this.frame.y+h[1]>this.frame.core.canvas.canvas.height){if(this.safeguardForDraggingOutOfExtent){if(this.frame.y<0||this.frame.y+this.frame.height>this.frame.core.canvas.canvas.height||this.frame.x+this.frame.width>this.frame.core.canvas.canvas.width)break;a=1,h=(0,s.kC)(o[0],o[1],o[0]+a),this.frame.y+=.5*(o[1]-h[1]),this.frame.width=h[0],this.frame.height=h[1]}break}this.frame.widthMin<=h[0]&&this.frame.heightMin<=h[1]&&e<=this.frame.core.canvas.canvas.width&&(this.frame.y+=.5*(o[1]-h[1]),this.frame.width=h[0],this.frame.height=h[1]);break;case 6:if(r=i-this.frame.y-this.frame.height,h=(0,s.Ux)(o[0],o[1],o[1]+r),this.frame.x+.5*(o[0]-h[0])<0||this.frame.x+h[0]>this.frame.core.canvas.canvas.width){if(this.safeguardForDraggingOutOfExtent){if(this.frame.x<-1||this.frame.x+this.frame.width>this.frame.core.canvas.canvas.width||this.frame.y+this.frame.height>this.frame.core.canvas.canvas.height)break;r=1,h=(0,s.Ux)(o[0],o[1],o[1]+r),this.frame.x+=.5*(o[0]-h[0]),this.frame.width=h[0],this.frame.height+=r}break}this.frame.height+r>=this.frame.heightMin&&i<=this.frame.core.canvas.canvas.height&&(this.frame.x+=.5*(o[0]-h[0]),this.frame.width=h[0],this.frame.height+=r);break;case 7:if(a=this.frame.x-e,h=(0,s.kC)(o[0],o[1],o[0]+a),this.frame.y+.5*(o[1]-h[1])<0||this.frame.y+h[1]>this.frame.core.canvas.canvas.height){if(this.safeguardForDraggingOutOfExtent){if(this.frame.y<1||this.frame.y+this.frame.height>this.frame.core.canvas.canvas.height)break;a=1,h=(0,s.kC)(o[0],o[1],o[0]+a),this.frame.x-=h[0]-o[0],this.frame.width+=a,this.frame.y+=.5*(o[1]-h[1]),this.frame.height=h[1]}break}this.frame.width+a>=this.frame.widthMin&&this.frame.height>=this.frame.heightMin&&(this.frame.x=e,this.frame.width+=a,this.frame.y+=.5*(o[1]-h[1]),this.frame.height=h[1]);break;default:if(a=e-this.frame.core.activeCommand.mousePre[0],r=i-this.frame.core.activeCommand.mousePre[1],a=this.frame.x+a<0?0:a,r=this.frame.y+r<0?0:r,0===e){this.frame.x=0;break}if(0===i){this.frame.y=0;break}if(this.frame.x+this.frame.width+a>this.frame.core.canvas.canvas.width){this.frame.x+=this.frame.core.canvas.canvas.width-this.frame.x-this.frame.width;break}if(this.frame.y+this.frame.height+r>this.frame.core.canvas.canvas.height){this.frame.y+=this.frame.core.canvas.canvas.height-this.frame.y-this.frame.height;break}this.frame.x+=a,this.frame.y+=r}this.updatePost()}offsetByIDFreeform(t,e,i){if(this.frame.core.activeCommand.hasShift)return void this.offsetByIDConstraint(t,e,i);let s,a;switch(e=e<0?0:e,i=i<0?0:i,t){case 0:s=this.frame.x-e,this.frame.width+s>=this.frame.widthMin&&(this.frame.x=e,this.frame.width+=s),a=this.frame.y-i,this.frame.height+a>=this.frame.heightMin&&(this.frame.y=i,this.frame.height+=a);break;case 1:if(s=e-this.frame.x-this.frame.width,this.frame.width+s>=this.frame.widthMin)if(this.frame.x+this.frame.width+s>this.frame.core.canvas.canvas.width){let t=this.frame.core.canvas.canvas.width-this.frame.x-this.frame.width;this.frame.width+=t}else this.frame.width+=s;a=this.frame.y-i,this.frame.height+a>=this.frame.heightMin&&(this.frame.y=i,this.frame.height+=a);break;case 2:s=e-this.frame.x<this.frame.widthMin?this.frame.widthMin:e-this.frame.x,a=i-this.frame.y<this.frame.heightMin?this.frame.heightMin:i-this.frame.y,s=this.frame.x+s>this.frame.core.canvas.canvas.width?this.frame.core.canvas.canvas.width-this.frame.x:s,a=this.frame.y+a>this.frame.core.canvas.canvas.height?this.frame.core.canvas.canvas.height-this.frame.y:a,this.frame.width=s,this.frame.height=a;break;case 3:s=this.frame.x-e,this.frame.width+s>=this.frame.widthMin&&(this.frame.x=e,this.frame.width+=s),a=i-this.frame.y<this.frame.heightMin?this.frame.heightMin:i-this.frame.y,this.frame.height=this.frame.y+a>this.frame.core.canvas.canvas.height?this.frame.core.canvas.canvas.height-this.frame.y:a;break;case 4:a=this.frame.y-i,this.frame.height+a>=this.frame.heightMin&&(this.frame.y=i,this.frame.height+=a);break;case 5:if(s=e-this.frame.x-this.frame.width,this.frame.width+s>=this.frame.widthMin)if(this.frame.x+this.frame.width+s>this.frame.core.canvas.canvas.width){let t=this.frame.core.canvas.canvas.width-this.frame.x-this.frame.width;this.frame.width+=t}else this.frame.width+=s;break;case 6:a=i-this.frame.y<this.frame.heightMin?this.frame.heightMin:i-this.frame.y,this.frame.height=this.frame.y+a>this.frame.core.canvas.canvas.height?this.frame.core.canvas.canvas.height-this.frame.y:a;break;case 7:s=this.frame.x-e,this.frame.width+s>=this.frame.widthMin&&(this.frame.x=e,this.frame.width+=s);break;default:if(s=e-this.frame.core.activeCommand.mousePre[0],a=i-this.frame.core.activeCommand.mousePre[1],s=this.frame.x+s<0?0:s,a=this.frame.y+a<0?0:a,0===e){this.frame.x=0;break}if(0===i){this.frame.y=0;break}if(this.frame.x+this.frame.width+s>this.frame.core.canvas.canvas.width){this.frame.x+=this.frame.core.canvas.canvas.width-this.frame.x-this.frame.width;break}if(this.frame.y+this.frame.height+a>this.frame.core.canvas.canvas.height){this.frame.y+=this.frame.core.canvas.canvas.height-this.frame.y-this.frame.height;break}this.frame.x+=s,this.frame.y+=a}this.updatePost()}updatePost(){this.updateGuides(),this.frame.update(),this.frame.core.filter.update(!1),this.frame.core.canvas.renderForce()}updateGuides(){this.frame.xOffGuid=this.frame.width/3,this.frame.yOffGuid=this.frame.height/3,this.updateCenterCV()}updateCenterCV(){this.frame.cv[0]=this.frame.x+.5*this.frame.width,this.frame.cv[1]=this.frame.y+.5*this.frame.height}}class g{constructor(t){this.frame=void 0,this.tolerance=2.5,this.frame=t}mouseUp(){this.frame.isHover=!1,-1!==this.frame.idHover&&(this.frame.idSelected=this.frame.idHover),this.checkSizeToOriginal()}isHoverCheck(t,e){for(let i=0;i<this.frame.cpList.length;++i){const s=this.frame.cpList[i].isHoverCheck(t,e);if(-1!==s)return this.frame.isHover=!0,this.frame.idHover=s,!0}return this.frame.x<t&&this.frame.x+this.frame.width>t&&this.frame.y<e&&this.frame.y+this.frame.height>e?(this.frame.idHover=-1,this.frame.isHover=!0,!0):(this.frame.idHover=-1,this.frame.isHover=!1,!1)}checkSizeToOriginal(){return this.frame.width<this.frame.core.imageWrapper.img.width+this.tolerance&&this.frame.width>this.frame.core.imageWrapper.img.width-this.tolerance&&this.frame.height<this.frame.core.imageWrapper.img.height+this.tolerance&&this.frame.height>this.frame.core.imageWrapper.img.height-this.tolerance?(this.frame.x=0,this.frame.y=0,this.frame.width=this.frame.core.imageWrapper.img.width,void(this.frame.height=this.frame.core.imageWrapper.img.height)):this.frame.width<this.frame.core.imageWrapper.img.width+this.tolerance&&this.frame.width>this.frame.core.imageWrapper.img.width-this.tolerance?(this.frame.x=0,void(this.frame.width=this.frame.core.imageWrapper.img.width)):this.frame.height<this.frame.core.imageWrapper.img.height+this.tolerance&&this.frame.height>this.frame.core.imageWrapper.img.height-this.tolerance?(this.frame.y=0,void(this.frame.height=this.frame.core.imageWrapper.img.height)):void 0}}class y{constructor(t){this.renderer=void 0,this.transform=void 0,this.interaction=void 0,this.idHover=-1,this.idSelected=-1,this.isHover=!1,this.x=100,this.y=100,this.width=300,this.height=300,this.scale=1,this.rotation=0,this.xOffGuid=0,this.yOffGuid=0,this.r=19,this.cv=[0,0],this.cvPre=[0,0],this.core=void 0,this.cpList=[],this._widthMin=40,this._heightMin=40,this._frameRatioType=s.Nl.Original,this._frameShapeType=s.oU.Rectangle,this.core=t,this.init()}init(){this.xOffGuid=this.width/3,this.yOffGuid=this.height/3,this.cpList=[new u(this,0,v.Endpoint),new u(this,1,v.Endpoint),new u(this,2,v.Endpoint),new u(this,3,v.Endpoint),new u(this,4,v.Midpoint),new u(this,5,v.Midpoint),new u(this,6,v.Midpoint),new u(this,7,v.Midpoint)],this.interaction=new g(this),this.transform=new f(this),this.renderer=new p(this)}set frameRatioType(t){this._frameRatioType=t,this.setRatio(t)}get frameRatioType(){return this._frameRatioType}get widthMin(){return this._widthMin*this.core.imageWrapper.img.width/this.core.activeCommand.canvasBounding.width}get heightMin(){return this._heightMin*this.core.imageWrapper.img.height/this.core.activeCommand.canvasBounding.height}setRatio(t){let e=this.core.canvas.canvas.width,i=this.core.canvas.canvas.height,a=0;switch(this._frameRatioType){case s.Nl.Square:let t=this.core.canvas.canvas.width>this.core.canvas.canvas.height;t?this.updateFrameByRatio(i,i,t):this.updateFrameByRatio(e,e,t);break;case s.Nl.Fixed_3_2:a=1.5,e/i<a?this.updateFrameByRatio(e,e/a,!1):this.updateFrameByRatio(i*a,i,!0);break;case s.Nl.Fixed_4_3:a=4/3,e/i<a?this.updateFrameByRatio(e,e/a,!1):this.updateFrameByRatio(i*a,i,!0);break;case s.Nl.Fixed_16_9:a=16/9,e/i<a?this.updateFrameByRatio(e,e/a,!1):this.updateFrameByRatio(i*a,i,!0);break;case s.Nl.Original:this.initFrame()}}set frameShapeType(t){this._frameShapeType=t,this.core.canvas.renderForce()}get frameShapeType(){return this._frameShapeType}updateFrameByRatio(t,e,i){i?this.updateFrame(.5*this.core.canvas.canvas.width-.5*t,0,t,e,1,0,this.frameShapeType,this.frameRatioType):this.updateFrame(0,.5*this.core.canvas.canvas.height-.5*e,t,e,1,0,this.frameShapeType,this.frameRatioType)}updateFrameParam(t,e,i,s,a,r,h,o){this.x=t,this.y=e,this.width=i,this.height=s,this.scale=a,this.rotation=r,this.frameShapeType=h,this._frameRatioType=o}updateFrame(t,e,i,s,a,r,h,o){this.updateFrameParam(t,e,i,s,a,r,h,o),this.update()}initFrame(){this._frameRatioType=s.Nl.Original,this._frameShapeType=s.oU.Rectangle,this.width=200,this.height=200,this.core.imageWrapper.img&&(this.width=this.core.imageWrapper.img.width,this.height=this.core.imageWrapper.img.height),this.xOffGuid=this.width/5,this.yOffGuid=this.height/5,this.x=0,this.y=0,this.cv[0]=this.x+.5*this.width,this.cv[1]=this.y+.5*this.height,this.cvPre[0]=this.cv[0],this.cvPre[1]=this.cv[1],this.core.canvas.canvasOutFiltered.width=this.core.frame.width,this.core.canvas.canvasOutFiltered.height=this.core.frame.height,this.update(),this.updateUIWidthHeight(),this.core.renderer.initPostSaveImg=!0,this.renderer.initPost()}revertToOriginal(){this.core.scene.dataGeometries=[],this.core.app.emitAction("update-geometry@[]"),this.core.filter.revertToOriginal(),this.initFrame(),this.update(),this.core.renderer.captureCanvas(),this.core.scene.captureState(),this.core.filter.activate&&this.core.app.emitAction("update-container-size@original")}updateColorBG(t,e,i){this.renderer.updateColorBG(t,e,i)}update(){for(let t=0;t<this.cpList.length;++t)this.cpList[t].update();this.transform.updateGuides(),this.renderer.updateSVG()}isHoverCheck(t,e){return this.interaction.isHoverCheck(t,e)}mouseUp(){return this.idSelected=-1,this.interaction.mouseUp()}isMoved(){return this.cv[0]!==this.cvPre[0]||this.cv[1]!==this.cvPre[1]}offsetByIDFreeform(t,e,i){return this.transform.offsetByIDFreeform(t,e,i)}render(t){this.renderer.render(t)}translate(t,e){if(this._frameRatioType===s.Nl.Freeform)this.offsetByIDFreeform(this.idHover,t,e);else this.transform.offsetByIDConstraint(this.idHover,t,e);this.updateUIWidthHeight()}get frameSize(){return{width:Math.floor(this.width),height:Math.floor(this.height)}}updateUIWidthHeight(){this.update(),this.core.canvas.renderForce()}updateVecPre(){this.cvPre[0]=this.cv[0],this.cvPre[1]=this.cv[1]}}class x{constructor(t){this.core=void 0,this.t=0,this.tUpdateCP=0,this.initPostSaveImg=!0,this.captureNeeded=!1,this.ctxNoFilter=void 0,this.init=!0,this.core=t;const e=document.createElement("canvas");this.ctxNoFilter=e.getContext("2d"),this.updateFrame()}updateFrame(){this.tUpdateCP=0,this.core.frame.update()}render(t){if(this.tUpdateCP++<100&&this.core.frame.update(),this.core.filter.render(t),this.captureNeeded&&this.updateCanvasCapture(),"none"===this.core.canvas.canvas.style.display)return;this.core.scene.renderBelowFrameGeometries(t),this.core.frame.render(t);let e=1-this.t;e<0&&(e=0),t.beginPath();const i=this.core.canvas.eventController.touchInteraction.touchPre[0],s=this.core.canvas.eventController.touchInteraction.touchPre[1];t.arc(i,s,10*e,0,6.28),t.closePath(),t.fillStyle="rgba(255, 255, 255, ".concat(e,")"),t.fill(),t.restore(),this.t+=.025}captureCanvas(){this.captureNeeded=!0}updateCanvasCapture(){this.updateCtxFiltered(),this.updateCtxNoFilter(),this.captureNeeded=!1,this.init&&(this.core.app.emitAction("post-update@"),this.init=!1)}updateCtxForce(){this.core.frame.initFrame(),this.updateCtxFiltered(),this.updateCtxNoFilter()}updateCtxFiltered(){this.core.canvas.canvasOutFiltered.width=this.core.frame.width,this.core.canvas.canvasOutFiltered.height=this.core.frame.height,this.core.canvas.ctxOutFiltered.drawImage(this.core.canvas.canvas,-this.core.frame.x,-this.core.frame.y),this.trimCanvasByShape(this.core.canvas.ctxOutFiltered)}updateCtxNoFilter(){this.ctxNoFilter.canvas.width=this.core.imageWrapper.img.width,this.ctxNoFilter.canvas.height=this.core.imageWrapper.img.height,this.ctxNoFilter.drawImage(this.core.imageWrapper.img,0,0),this.core.canvas.canvasOut.width=this.core.frame.width,this.core.canvas.canvasOut.height=this.core.frame.height,this.core.canvas.ctxOut.drawImage(this.ctxNoFilter.canvas,-this.core.frame.x,-this.core.frame.y),this.trimCanvasByShape(this.core.canvas.ctxOut)}trimCanvasByShape(t){t.globalCompositeOperation="destination-out",t.fillStyle="rgba(255, 255, 255, 1)",(0,s.EW)(t,this.core.frame.frameShapeType,0,0,this.core.frame.width,this.core.frame.height,!1),t.globalCompositeOperation="source-over"}}class C{constructor(t,e){this.core=void 0,this._img=void 0,this.core=t,this._img=e}get img(){return this._img}updateData(){}}var w=i(51703);class E{constructor(t){this.core=void 0,this.dataGeometries=[],this.index=0,this.sceneManager=void 0,this.svgRPoint=void 0,this.svgNPoint=void 0,this.scaleByRatio=1,this.core=t,this.sceneManager=new s.i$,this.svgRPoint=(0,s.KF)(),this.svgNPoint=(0,s.nP)()}resetState(){this.sceneManager.reset(),this.captureState()}shiftEnvironment(t){t===s.qA.AGSM?this.svgRPoint=(0,s.VT)():this.svgRPoint=(0,s.KF)()}captureState(){this.sceneManager.push(this.core.app.api.getData());const t=this.sceneManager.getCurrentState();this.core.activeCommand.emitUndoRedoHistory(t)}undo(){const t=this.sceneManager.undo();if(t&&t.params)return this.core.scene.dataGeometries=t.drawing,this.core.app.api.updateFrame(t.params.x,t.params.y,t.params.width,t.params.height,t.params.scale,t.params.rotation,t.params.shape,t.params.aspectRatio),this.core.app.api.updateEffect(t.effecting,!1),this.core.renderer.captureCanvas(),this.core.filter.activate&&this.core.app.emitAction("update-container-size@"),this.core.filter.emitFilterData(),this.core.activeCommand.emitUndoRedoHistory(this.sceneManager.getCurrentState()),void this.core.activeCommand.emitDataToSave();this.core.filter.emitFilterData()}redo(){const t=this.sceneManager.redo();if(t&&t.params)return this.core.scene.dataGeometries=t.drawing,this.core.app.api.updateFrame(t.params.x,t.params.y,t.params.width,t.params.height,t.params.scale,t.params.rotation,t.params.shape,t.params.aspectRatio),this.core.app.api.updateEffect(t.effecting,!1),this.core.renderer.captureCanvas(),this.core.filter.activate&&this.core.app.emitAction("update-container-size@"),this.core.filter.emitFilterData(),this.core.activeCommand.emitUndoRedoHistory(this.sceneManager.getCurrentState()),void this.core.activeCommand.emitDataToSave();this.core.filter.emitFilterData()}renderBelowFrameGeometries(t){const e=[arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0];if(this.dataGeometries)for(this.index=this.dataGeometries.length;this.index--;){const i=this.dataGeometries[this.index],a=i.styles.width*this.scaleByRatio*i.styles.scale;switch(i.type){case s.zq.POINT_REGULAR:this.core.app.param.environment===s.qA.AGSM?(0,w._y)(t,i.nodes,this.svgRPoint.path2D,i.styles.colorRgba,e,this.scaleByRatio*i.styles.scale,-8,-30):(0,w._y)(t,i.nodes,this.svgRPoint.path2D,i.styles.colorRgba,e,this.scaleByRatio*i.styles.scale,-9,-28);break;case s.zq.POINT_NUMBERED:this.core.app.param.environment===s.qA.AGSM?(0,w.Bm)(t,i.nodes,i.styles.colorRgba,i.styles.number,e,this.scaleByRatio*i.styles.scale,0,0):(0,w.Kz)(t,i.nodes,this.svgNPoint.path2D,i.styles.colorRgba,i.styles.number,e,this.scaleByRatio*i.styles.scale,-13.14,-28);break;case s.zq.POLYLINE_BENDING:(0,w.JV)(t,i.nodes,i.styles.colorRgba,e,a);break;case s.zq.POLYGON_GRAPH:case s.zq.RECTANGLE:(0,w.xG)(t,i.nodes,i.styles.colorRgba,e,a);break;case s.zq.CIRCLE:(0,w.wq)(t,i.nodes,i.styles.colorRgba,e,a);break;case s.zq.ARROW_SINGLE:(0,w.nq)(t,i.nodes,i.styles.colorRgba,e,a);break;case s.zq.ARROW_DOUBLE:(0,w.aK)(t,i.nodes,i.styles.colorRgba,e,a)}}}}class R{constructor(t){this.uiFilter=void 0,this.divText=void 0,this.divHost=void 0,this.inputBlur=void 0,this.inputInter=void 0,this.inputSepia=void 0,this.inputContrast=void 0,this.inputBrightness=void 0,this.inputSaturate=void 0,this.inputHueRotate=void 0,this.divInter=void 0,this.divBlur=void 0,this.divSepia=void 0,this.divContrast=void 0,this.divBrightness=void 0,this.divSaturate=void 0,this.divHueRotates=void 0,this.uiFilter=t,this.divHost=document.createElement("div"),this.divHost.style.display="flex",this.uiFilter.host.appendChild(this.divHost)}appendUI(){const t=document.createElement("div");t.style.background="#ff0000",t.style.width="10px",t.onclick=()=>{console.log(this.uiFilter.controller.imageFilter.getData())},this.divHost.appendChild(t),this.divText=document.createElement("div"),this.divHost.appendChild(this.divText),this.divText.textContent="Filter: normal",this.divText.style.color="#fff",this.divText.style.width="150px",this.divText.style.fontSize="30",this.divText.style.padding="5px";let e,i=F("interpolation",0,1,1,.05);this.inputInter=i.input,this.divInter=document.createElement("div"),this.divInter.textContent="1",i.div.appendChild(this.divInter),this.inputInter.oninput=()=>{this.divInter.textContent=this.inputInter.value,this.uiFilter.controller.updateInterpolation(+this.inputInter.value)},this.divHost.appendChild(i.div),e=F("blur",0,10,0,.1),this.divBlur=document.createElement("div"),this.divBlur.textContent="0",e.div.appendChild(this.divBlur),this.inputBlur=e.input,this.inputBlur.oninput=()=>{this.divBlur.textContent=this.inputBlur.value,this.uiFilter.controller.updateFilterParam("blur",+this.inputBlur.value),this.uiFilter.controller.updateFilter()},this.divHost.appendChild(e.div),e=F("sepia",0,1,0,.05),this.divSepia=document.createElement("div"),this.divSepia.textContent="0",e.div.appendChild(this.divSepia),this.inputSepia=e.input,this.inputSepia.oninput=()=>{this.divSepia.textContent=this.inputSepia.value,this.uiFilter.controller.updateFilterParam("sepia",+this.inputSepia.value),this.uiFilter.controller.updateFilter()},this.divHost.appendChild(e.div),e=F("contrast",0,2,1,.05),this.divContrast=document.createElement("div"),this.divContrast.textContent="0",e.div.appendChild(this.divContrast),this.inputContrast=e.input,this.inputContrast.oninput=()=>{this.divContrast.textContent=this.inputContrast.value,this.uiFilter.controller.updateFilterParam("contrast",+this.inputContrast.value),this.uiFilter.controller.updateFilter()},this.divHost.appendChild(e.div),e=F("brightness",0,2,1,.05),this.divBrightness=document.createElement("div"),this.divBrightness.textContent="0",e.div.appendChild(this.divBrightness),this.inputBrightness=e.input,this.inputBrightness.oninput=()=>{this.divBrightness.textContent=this.inputBrightness.value,this.uiFilter.controller.updateFilterParam("brightness",+this.inputBrightness.value),this.uiFilter.controller.updateFilter()},this.divHost.appendChild(e.div),e=F("saturate",0,2,1,.05),this.divSaturate=document.createElement("div"),this.divSaturate.textContent="0",e.div.appendChild(this.divSaturate),this.inputSaturate=e.input,this.inputSaturate.oninput=()=>{this.divSaturate.textContent=this.inputSaturate.value,this.uiFilter.controller.updateFilterParam("saturate",+this.inputSaturate.value),this.uiFilter.controller.updateFilter()},this.divHost.appendChild(e.div),e=F("hueRotate",-180,180,0,1),this.divHueRotates=document.createElement("div"),this.divHueRotates.textContent="0",e.div.appendChild(this.divHueRotates),this.inputHueRotate=e.input,this.inputHueRotate.oninput=()=>{this.divHueRotates.textContent=this.inputHueRotate.value,this.uiFilter.controller.updateFilterParam("hue-rotate",+this.inputHueRotate.value),this.uiFilter.controller.updateFilter()},this.divHost.appendChild(e.div)}updateUIValue(){this.inputBlur&&(this.inputBlur.value="".concat(this.uiFilter.controller.getFilterParam("blur")),this.divBlur.textContent=this.inputBlur.value),this.inputInter&&(this.inputInter.value="".concat(this.uiFilter.controller.getFilterParam("interpolation")),this.divInter.textContent=this.inputInter.value),this.inputSepia&&(this.inputSepia.value="".concat(this.uiFilter.controller.getFilterParam("sepia")),this.divSepia.textContent=this.inputSepia.value),this.inputContrast&&(this.inputContrast.value="".concat(this.uiFilter.controller.getFilterParam("contrast")),this.divContrast.textContent=this.inputContrast.value),this.inputBrightness&&(this.inputBrightness.value="".concat(this.uiFilter.controller.getFilterParam("brightness")),this.divBrightness.textContent=this.inputBrightness.value),this.inputSaturate&&(this.inputSaturate.value="".concat(this.uiFilter.controller.getFilterParam("saturate")),this.divSaturate.textContent=this.inputSaturate.value),this.inputHueRotate&&(this.inputHueRotate.value="".concat(this.uiFilter.controller.getFilterParam("hue-rotate")),this.divHueRotates.textContent=this.inputHueRotate.value)}}const F=(t,e,i,s,a)=>{let r=document.createElement("div");r.textContent=t,r.style.color="#ffffff",r.style.position="float";let h=document.createElement("input");return h.style.width="80px",h.style.height="3px",h.type="range",h.defaultValue="".concat(s),h.min="".concat(e),h.step="".concat(a),h.max="".concat(i),r.appendChild(h),{div:r,input:h}};class b{constructor(){this.divHost=void 0,this.divLayer=void 0,this.title=void 0,this.numLayer=-1,this.nameLayer="Abstract Layer ",this.fn=void 0,this.divHost=document.createElement("div"),this.divHost.style.backgroundColor="#ffffff",this.divHost.style.backgroundColor="rgba(255, 255, 255, 1)",this.divLayer=document.createElement("div"),this.divLayer.style.border="10px",this.divLayer.style.padding="10px",this.divLayer.style.margin="5px";let t=document.createElement("div");t.style.display="flex",this.divLayer.appendChild(t),this.title=document.createElement("div"),this.title.style.height="28px",this.title.style.width="132px",this.title.style.color="#000",this.title.textContent="".concat(this.nameLayer," ").concat(this.numLayer," "),t.appendChild(this.title);let e=document.createElement("div");e.style.height="28px",e.style.color="#000",e.textContent="X",e.onclick=()=>{this.destroy()},t.appendChild(e)}getData(){}destroy(){}updateLayerNum(t){this.numLayer=t,this.title.textContent="".concat(this.nameLayer," ").concat(this.numLayer," ")}}class I{constructor(t){this.element=void 0,this.color=1,this.divContainer=void 0,this.divInput=void 0,this.divText=void 0,this.updatePost=void 0,this.updatePost=t.updatePost,this.color=t.default,this.element=t.colorElement,this.divContainer=document.createElement("div"),this.divContainer.style.display="flex",t.host.appendChild(this.divContainer),this.divText=document.createElement("div"),this.divText.style.width="45px",this.divText.textContent="".concat(t.colorElement,": ").concat(t.default),this.divText.style.color=t.colorText,this.divContainer.appendChild(this.divText),this.divInput=document.createElement("input"),this.divInput.style.width="100%",this.divInput.style.fontSize="10px",this.divInput.style.height="5px",this.divInput.style.border="0px",this.divInput.style.appearance="none",this.divInput.type="range",this.divInput.value="".concat(t.default),this.divInput.max="".concat(t.max),this.divInput.oninput=()=>{this.divText.textContent="".concat(t.colorElement,": ").concat(this.divInput.value),this.color=+this.divInput.value,this.updatePost()},this.divContainer.appendChild(this.divInput)}updateValue(t){this.color=t,this.divText.textContent="".concat(this.element,": ").concat(t),this.divInput.value="".concat(t)}}class P{constructor(t){this.mode=s.ew.Overlay,this.updatePost=void 0,this.updatePost=t.updatePost;const e=document.createElement("select");t.host.appendChild(e);for(let i in s.ew){let t=document.createElement("option");t.value=s.ew[i],t.textContent=s.ew[i],e.appendChild(t)}e.value=this.mode,e.style.border="0px",e.style.fontSize="10px",e.onchange=t=>{let e=t.target.value;this.mode=e,this.updatePost()}}}class S{constructor(t){this.divHost=void 0,this.divHost=document.createElement("div"),this.divHost.style.backgroundColor="rgba(".concat(t.r,",").concat(t.g,",").concat(t.b,",").concat(t.a,")"),this.divHost.style.width="100%",this.divHost.style.height="20px",this.divHost.style.fontSize="10px",this.divHost.style.marginTop="5px",t.host.appendChild(this.divHost)}updateColor(t){this.divHost.style.backgroundColor="rgba(".concat(t.r,",").concat(t.g,",").concat(t.b,",").concat(t.a,")")}}class k{constructor(t){this.updatePost=void 0,this.divHost=void 0,this.rgba=[],this.updatePost=t.updatePost,this.divHost=document.createElement("input"),this.divHost.style.width="95%",this.divHost.style.fontSize="10px",this.divHost.style.border="0px",this.divHost.style.color="#",this.divHost.type="input",this.divHost.oninput=()=>{let t=(0,s.rW)(this.divHost.value);for(let e=0;e<t.length;++e)if(isNaN(t[e]))return;this.rgba=t,this.updatePost()},t.host.appendChild(this.divHost)}}class H extends b{constructor(t,e,i){super(),this.colorCanvas=void 0,this.hexElement=void 0,this.rElement=void 0,this.gElement=void 0,this.bElement=void 0,this.aElement=void 0,this.modeElement=void 0,this.nameLayer="Plain Layer ",this.numLayer=t,this.title.textContent="".concat(this.nameLayer," ").concat(this.numLayer," "),this.fn=e,this.destroy=i,this.init()}init(){const t=this.divLayer;this.hexElement=new k({host:t,updatePost:()=>{this.rElement.updateValue(this.hexElement.rgba[0]),this.gElement.updateValue(this.hexElement.rgba[1]),this.bElement.updateValue(this.hexElement.rgba[2]),this.update()}}),this.rElement=new I({host:t,colorElement:"r",colorText:"#f00",default:Math.floor(255*Math.random()),max:255,updatePost:()=>{this.update(),this.updateHex()}}),this.gElement=new I({host:t,colorElement:"g",colorText:"#494",default:Math.floor(255*Math.random()),max:255,updatePost:()=>{this.update(),this.updateHex()}}),this.bElement=new I({host:t,colorElement:"b",colorText:"#44a",default:Math.floor(255*Math.random()),max:255,updatePost:()=>{this.update(),this.updateHex()}}),this.aElement=new I({host:t,colorElement:"a",colorText:"#222",default:100,max:100,updatePost:()=>{this.update(),this.updateHex()}}),this.modeElement=new P({host:t,updatePost:()=>{this.update()}}),this.colorCanvas=new S({host:t,r:this.rElement.color,g:this.gElement.color,b:this.bElement.color,a:this.aElement.color}),this.divHost.appendChild(t),this.update(),this.updateHex()}update(){this.colorCanvas.updateColor({r:this.rElement.color,g:this.gElement.color,b:this.bElement.color,a:.01*this.aElement.color}),this.fn(this.getData())}updateHex(){this.hexElement.divHost.value=(0,s.iC)(this.rElement.color,this.gElement.color,this.bElement.color)}getData(){return{bg0:[this.rElement.color,this.gElement.color,this.bElement.color,.01*this.aElement.color],mode:this.modeElement.mode}}}class L extends b{constructor(t,e,i){super(),this.numLayer=-1,this.divHost=void 0,this.fn=void 0,this.hexElement0=void 0,this.rElement0=void 0,this.gElement0=void 0,this.bElement0=void 0,this.aElement0=void 0,this.colorCanvas0=void 0,this.hexElement1=void 0,this.rElement1=void 0,this.gElement1=void 0,this.bElement1=void 0,this.aElement1=void 0,this.colorCanvas1=void 0,this.innerElement=void 0,this.outerElement=void 0,this.modeElement=void 0,this.nameLayer="Radial Gradient Layer ",this.numLayer=t,this.title.textContent="".concat(this.nameLayer," ").concat(this.numLayer," "),this.fn=e,this.destroy=i,this.init()}init(){const t=this.divLayer;let e=document.createElement("div");e.style.color="#000",e.textContent="inner layer ------------------------",t.appendChild(e),this.hexElement0=new k({host:t,updatePost:()=>{this.rElement0.updateValue(this.hexElement0.rgba[0]),this.gElement0.updateValue(this.hexElement0.rgba[1]),this.bElement0.updateValue(this.hexElement0.rgba[2]),this.update()}}),this.rElement0=new I({host:t,colorElement:"r",colorText:"#f00",default:Math.floor(255*Math.random()),max:255,updatePost:()=>{this.update(),this.updateHex()}}),this.gElement0=new I({host:t,colorElement:"g",colorText:"#494",default:Math.floor(255*Math.random()),max:255,updatePost:()=>{this.update(),this.updateHex()}}),this.bElement0=new I({host:t,colorElement:"b",colorText:"#44a",default:Math.floor(255*Math.random()),max:255,updatePost:()=>{this.update(),this.updateHex()}}),this.aElement0=new I({host:t,colorElement:"a",colorText:"#222",default:100,max:100,updatePost:()=>{this.update(),this.updateHex()}}),this.colorCanvas0=new S({host:t,r:this.rElement0.color,g:this.gElement0.color,b:this.bElement0.color,a:this.aElement0.color});let i=document.createElement("div");i.style.color="#000",i.textContent="outer layer ------------------------",t.appendChild(i),this.hexElement1=new k({host:t,updatePost:()=>{this.rElement1.updateValue(this.hexElement1.rgba[0]),this.gElement1.updateValue(this.hexElement1.rgba[1]),this.bElement1.updateValue(this.hexElement1.rgba[2]),this.update()}}),this.rElement1=new I({host:t,colorElement:"r",colorText:"#f00",default:Math.floor(255*Math.random()),max:255,updatePost:()=>{this.update(),this.updateHex()}}),this.gElement1=new I({host:t,colorElement:"g",colorText:"#494",default:Math.floor(255*Math.random()),max:255,updatePost:()=>{this.update(),this.updateHex()}}),this.bElement1=new I({host:t,colorElement:"b",colorText:"#44a",default:Math.floor(255*Math.random()),max:255,updatePost:()=>{this.update(),this.updateHex()}}),this.aElement1=new I({host:t,colorElement:"a",colorText:"#222",default:100,max:100,updatePost:()=>{this.update(),this.updateHex()}}),this.modeElement=new P({host:t,updatePost:()=>{this.update()}}),this.colorCanvas1=new S({host:t,r:this.rElement1.color,g:this.gElement1.color,b:this.bElement1.color,a:this.aElement1.color}),this.innerElement=new I({host:t,colorElement:"a",colorText:"#222",default:0,max:1,updatePost:()=>{this.update(),this.updateHex()}}),this.innerElement.divInput.step="0.025",this.innerElement.divText.style.width="55px",this.outerElement=new I({host:t,colorElement:"a",colorText:"#222",default:1,max:1,updatePost:()=>{this.update(),this.updateHex()}}),this.outerElement.divInput.step="0.025",this.outerElement.divText.style.width="55px",this.divHost.appendChild(t),this.update(),this.updateHex()}update(){this.colorCanvas0.updateColor({r:this.rElement0.color,g:this.gElement0.color,b:this.bElement0.color,a:.01*this.aElement0.color}),this.colorCanvas1.updateColor({r:this.rElement1.color,g:this.gElement1.color,b:this.bElement1.color,a:.01*this.aElement1.color}),this.fn(this.getData())}updateHex(){this.hexElement0.divHost.value=(0,s.iC)(this.rElement0.color,this.gElement0.color,this.bElement0.color),this.hexElement1.divHost.value=(0,s.iC)(this.rElement1.color,this.gElement1.color,this.bElement1.color)}getData(){return{in:this.innerElement.color,out:this.outerElement.color,bg0:[this.rElement0.color,this.gElement0.color,this.bElement0.color,.01*this.aElement0.color],bg1:[this.rElement1.color,this.gElement1.color,this.bElement1.color,.01*this.aElement1.color],mode:this.modeElement.mode}}}let B;!function(t){t.RadialGradientLayer="radialGradientLayer",t.PlainLayer="plainLayer"}(B||(B={}));class M{constructor(t){this.uiFilter=void 0,this.divHost=void 0,this.layers=[],this.isCustom=!1,this.uiFilter=t}appendUI(){this.appendHost(),this.appendButtonAdd()}appendHost(){this.divHost=document.createElement("div"),this.divHost.style.position="absolute",this.divHost.style.top="30px",this.divHost.style.width="160px",this.uiFilter.host.appendChild(this.divHost)}appendButtonAdd(){const t=document.createElement("div");t.style.display="flex",t.style.height="20px",this.divHost.appendChild(t);const e=document.createElement("div");e.style.width="60px",e.style.color="#fff",e.textContent="+ Plain Layer",e.onclick=()=>{this.addLayer(B.PlainLayer)},t.appendChild(e);const i=document.createElement("div");i.style.color="#fff",i.textContent="+ Radial Gradient",i.onclick=()=>{this.addLayer(B.RadialGradientLayer)},t.appendChild(i)}addLayer(t){let e;if(t===B.RadialGradientLayer)e=new L(this.layers.length+1,(t=>{this.updateRendering()}),(()=>{this.removeLayer(e)})),this.divHost.appendChild(e.divHost),this.layers.push(e);else e=new H(this.layers.length+1,(t=>{this.updateRendering()}),(()=>{this.removeLayer(e)})),this.divHost.appendChild(e.divHost),this.layers.push(e);this.updateRendering()}updateRendering(){this.updateStatus(),this.uiFilter.controller.updateFilter()}getData(){const t=[];for(let e=0;e<this.layers.length;++e)t.push(this.layers[e].getData());return t}removeLayer(t){this.layers.splice(this.layers.indexOf(t),1),this.divHost.removeChild(t.divHost),this.updateIndex(),this.updateRendering()}updateIndex(){for(let t=0;t<this.layers.length;++t)this.layers[t].updateLayerNum(t+1)}updateStatus(){0===this.layers.length?this.isCustom=!1:this.isCustom=!0}destroy(){if(this.divHost&&this.divHost.parentNode)try{const t=this.divHost.parentNode;t&&t.removeChild(this.divHost)}catch(t){console.debug(t)}}}class T{constructor(t){this.host=void 0,this.controller=void 0,this.uiEffect=void 0,this.uiTint=void 0,this.num=0,this.debugMode=!1,this.keyEvent=t=>{this.debugMode&&("["===t.key?(this.num-=1/9,this.num<0&&(this.num=0),this.num>1&&(this.num=.99),this.controller.shiftEffect(this.num)):"]"===t.key&&(this.num+=1/9,this.num<0&&(this.num=0),this.num>1&&(this.num=.99),this.controller.shiftEffect(this.num))),"P"===t.key&&t.shiftKey&&this.displayUI()},this.controller=t,this.appendUI()}appendUI(){this.host=document.createElement("div"),this.host.style.zIndex="1",this.host.style.position="absolute",this.host.style.top="0px",this.host.style.left="0px",this.uiEffect=new R(this),this.uiTint=new M(this),document.body.addEventListener("keydown",this.keyEvent),this.appendUIFilter(),this.appendUITint()}displayUI(){this.controller.imageFilter.core.div.appendChild(this.host)}appendUIFilter(){this.controller.activate&&this.uiEffect.appendUI()}appendUITint(){this.controller.activate&&this.uiTint.appendUI()}updateUIValue(){this.uiEffect.updateUIValue()}destroy(){document.body.removeEventListener("keydown",this.keyEvent),this.uiTint.destroy();const t=this.host.parentNode;t&&t.removeChild(this.host)}}class D{constructor(t){this.imageFilter=void 0,this.UIFilter=void 0,this._activate=!1,this.checkChanges=(0,s.Ds)((()=>{this.imageFilter.update()})),this.imageFilter=t,this.UIFilter=new T(this)}get activate(){return this._activate}set activate(t){this._activate=t,t?(this.imageFilter.canvasView.style.display="block",this.imageFilter.core.canvas.canvas.style.display="none",this.UIFilter.appendUI()):(this.imageFilter.canvasView.style.display="none",this.imageFilter.core.canvas.canvas.style.display="block",this.destroy())}updateDivText(t){this.UIFilter&&this.UIFilter.uiEffect.divText&&(this.UIFilter.uiEffect.divText.textContent="Filter: "+t)}destroy(){this.UIFilter&&this.UIFilter.destroy()}updateCustomFilter(t){this.imageFilter.filters=t}shiftEffect(t){this.imageFilter.typePreset=(0,s.g9)(t),this.imageFilter.shiftEffectByPreset(this.imageFilter.typePreset)}getFilterParam(t){void 0===this.imageFilter.filters&&this.imageFilter.reset(!1,!1);for(let e=0;e<this.imageFilter.filters.length;++e)if(t===this.imageFilter.filters[e][0])return this.imageFilter.filters[e][1];if("interpolation"===t)return this.imageFilter.interpolation}updateFilterParam(t,e){for(let i=0;i<this.imageFilter.filters.length;++i)if(t===this.imageFilter.filters[i][0])return void(this.imageFilter.filters[i][1]=e)}updateInterpolation(t){this.imageFilter.interpolation=t,this.updateFilter()}updateFilter(){this.imageFilter.update(!1),this.checkChanges()}}class U{constructor(t){this.core=void 0,this.controller=void 0,this.canvas=void 0,this.ctx=void 0,this.canvasView=void 0,this.ctxView=void 0,this.typePreset="normal",this.numRendered=0,this.interpolation=1,this.filters=[],this.tints=[],this.activate=!1,this.modeDebug=!0,this.core=t,this.reset(!1,!1,!0),this.canvas=document.createElement("canvas"),this.canvas.style.width="100%",this.canvas.style.height="100%",this.ctx=this.canvas.getContext("2d"),this.canvasView=document.createElement("canvas"),this.canvasView.style.width="100%",this.canvasView.style.height="100%",this.canvasView.style.display="none",this.ctxView=this.canvasView.getContext("2d"),this.core.div.appendChild(this.canvasView),this.controller=new D(this)}updateParamsInterpolation(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.interpolation=t,this.update(e)}getData(){void 0===this.filters&&(this.reset(!1,!1,!0),this.numRendered=0,this.update(!1));const t=this.filters.filter(((t,e)=>{let[,i]=t;return s.UU.normal.filters[e][1]!==i}));return{typePreset:this.typePreset,filters:t,tints:[...this.tints],interpolation:this.interpolation}}updateEffect(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.typePreset=t.typePreset,this.filters=t.filters,this.tints=t.tints,this.controller.UIFilter&&this.controller.UIFilter.uiEffect.divText&&(this.controller.UIFilter.updateUIValue(),this.controller.updateDivText(this.typePreset)),this.update(e)}revertToOriginal(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.numRendered=0,this.reset(t,e)}reset(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.typePreset="normal",this.interpolation=1,this.filters={filters:[["blur",0],["sepia",0],["contrast",1],["brightness",1],["saturate",1],["hue-rotate",0]],tints:[]},this.tints=[],i||(this.controller.updateDivText(this.typePreset),this.update(t,e))}shiftEffectByPreset(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.typePreset=t;const i=(0,s.Ry)(t);this.filters=i.filters,this.tints=i.tints,this.controller.updateDivText(this.typePreset),this.update(e)}update(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.numRendered<3||this.activate){this.canvas.width=this.core.imageWrapper.img.width,this.canvas.height=this.core.imageWrapper.img.height;const i=this.core.frame.cv[0]/this.canvas.width,a=this.core.frame.cv[1]/this.canvas.height,r=.5*(this.core.frame.width/this.canvas.width+this.core.frame.height/this.canvas.height);(0,s.lJ)(this.ctx,this.core.imageWrapper.img,this.filters,this.interpolation),this.controller.UIFilter.uiTint.isCustom&&(this.tints=this.controller.UIFilter.uiTint.getData()),(0,s.Wf)(this.ctx,this.tints,i,a,r,this.interpolation),this.core.canvas.renderForce(),this.core.canvas.ctxOutFiltered.drawImage(this.ctx.canvas,-this.core.frame.x,-this.core.frame.y),t&&(this.emitFilterData(),e||this.core.scene.captureState()),this.controller.UIFilter&&this.controller.UIFilter.updateUIValue(),this.core.renderer.captureCanvas(),this.numRendered++}this.core.filter.activate&&(this.core.frame.renderer.hide=!0)}render(t){t.drawImage(this.canvas,0,0),this.renderView()}renderView(){if(!this.controller.activate)return;const t=this.core.app.api.getCtx().canvas;this.canvasView.style.width="100%",this.canvasView.style.height="100%",this.canvasView.width=t.width,this.canvasView.height=t.height,this.ctxView.drawImage(this.canvas,-this.core.frame.x,-this.core.frame.y),this.core.scene.renderBelowFrameGeometries(this.ctxView,this.core.frame.x,this.core.frame.y),this.trimCanvas(this.ctxView)}trimCanvas(t){t.globalCompositeOperation="destination-out",t.fillStyle="rgba(255, 255, 255, 1)",(0,s.EW)(t,this.core.frame.frameShapeType,0,0,t.canvas.width,t.canvas.height,!1),t.globalCompositeOperation="source-over"}destroy(){this.controller.destroy()}emitFilterData(){this.core.app.emitAction("filter@"+JSON.stringify(this.getData()))}activateEffectEnv(){this.activate=!0,this.controller.activate=!0}deactivateEffectEnv(){this.activate=!1,this.controller.activate=!1}}class O{constructor(t){this.app=void 0,this.div=void 0,this.imageWrapper=void 0,this.frame=void 0,this.renderer=void 0,this.scene=void 0,this.filter=void 0,this.canvas=void 0,this.common=void 0,this.activeCommand=void 0,this.ctx=void 0,this.resizeWindow=()=>{this.canvas.renderForce()},this.app=t;const e=document.createElement("div");this.div=e,this.div.id="express-image-cropping",this.div.style.width="100%",this.div.style.height="100%",t.ui?this.app.ui.divContentWrapper.append(this.div):this.app.divHost.append(this.div),this.common=new d(this),this.filter=new U(this),this.initCanvas(),this.initApp()}reset(){}initApp(){this.scene=new E(this),this.frame=new y(this),this.renderer=new x(this),this.activeCommand=new l(this)}initCanvas(){this.canvas=new c(this),this.canvas.render=t=>{this.renderer.render(t)}}importImage(t){const e=new Image;e.crossOrigin="anonymous",e.src=t,e.onload=()=>{this.importImageByImage(e)}}importImageByImage(t){this.imageWrapper=new C(this,t),this.canvas.canvasOutFiltered.width=t.width,this.canvas.canvasOutFiltered.height=t.height,this.canvas.canvas.width=t.width,this.canvas.canvas.height=t.height,this.frame.initFrame(),this.filter.update(!1),this.canvas.renderForce(),this.renderer.captureCanvas(),this.filter.activate||this.app.emitAction("ready@crop")}destroy(){this.canvas.destroy(),this.filter.destroy()}}class A{constructor(t,e){this.app=void 0,this.divExpressImageEditingWrapper=void 0,this.divUIWrapper=void 0,this.divContentWrapper=void 0,this.theme=void 0,this.app=t,this.theme=e;const i=document.createElement("div");i.id="express-image-editing-wrapper",i.style.position="relative",i.style.width="100%",i.style.height="100%",i.style.display="flux",i.style.justifyContent="center",this.divExpressImageEditingWrapper=i,this.app.divHost.append(i);const s=document.createElement("div");s.id="express-image-editing-ui-wrapper",s.style.width="100%",s.style.height=e.top.height,s.style.padding=e.top.padding,s.style.background=e.top.background,s.style.marginBottom=e.top.marginBottom,this.divUIWrapper=s,this.divExpressImageEditingWrapper.append(this.divUIWrapper);const a=document.createElement("p");a.textContent="Image Cropping App V1",a.style.fontSize="12px;",a.style.color="rgba(210, 210, 210)",a.style.top="0px",a.style.left="20px",this.divUIWrapper.append(a);const r=document.createElement("div");r.id="express-image-editing-content-wrapper",this.divContentWrapper=r,this.divExpressImageEditingWrapper.append(this.divContentWrapper),this.Layer0(),this.Layer1()}updateStyle(t,e,i){}initPost(){let t=document.createElement("div");t.style.textAlign="center",t.style.padding="10px",t.textContent="Size";let e=document.createElement("input");e.style.width="50px",e.setAttribute("type","text"),e.setAttribute("min","100"),t.append(e),e.oninput=()=>{Number.parseFloat(e.value)},e=document.createElement("input"),e.style.width="50px",e.setAttribute("type","text"),e.setAttribute("min","100"),t.append(e),e.oninput=()=>{Number.parseFloat(e.value)},this.divUIWrapper.append(t);let i=document.createElement("input");i.type="range",i.min="-3.13",i.max="3.13",i.step="0.01",i.value="0",i.oninput=()=>{this.app.api.onDragRotate(+i.value)},this.divUIWrapper.append(i);let s=document.createElement("input");s.type="range",s.min="0.2",s.max="2",s.step="0.01",s.value="1",s.oninput=()=>{this.app.api.onDragZoom(+s.value)},this.divUIWrapper.append(s);const a=document.createElement("input");a.setAttribute("type","text"),a.setAttribute("value","https://raw.githubusercontent.com/NamjuLee/data/master/img/building%20footprint.png"),this.divUIWrapper.append(a),a.oninput=()=>{this.app.api.inputImportByURL(a.textContent)},a.addEventListener("keyup",(t=>{t.keyCode}));let r=document.createElement("div");r.textContent="Offset: ",r.style.padding="10px";let h=document.createElement("input");h.style.width="30px",h.setAttribute("type","text"),h.setAttribute("min","-50"),h.setAttribute("max","50"),h.setAttribute("value","10"),r.append(h),this.divUIWrapper.append(r),h.addEventListener("keyup",(t=>{13===t.keyCode&&console.log("divInput.value",h.value)}));let o=document.createElement("button");o.textContent="dd",this.divUIWrapper.append(o),o.onclick=()=>{}}Layer0(){let t=this.theme.top.iconFill,e=document.createElement("div");e.style.margin="5px",e.style.marginBottom="20px",this.divUIWrapper.append(e);let i=(0,s.sR)((()=>{this.app.api.onClickPlace()}),'\n            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="'.concat(t,'" viewBox="0 0 20 20">\n            <path d="M8 2a5.53 5.53 0 0 0-3.594 1.342c-.766.66-1.321 1.52-1.464 2.383C1.266 6.095 0 7.555 0 9.318 0 11.366 1.708 13 3.781 13h8.906C14.502 13 16 11.57 16 9.773c0-1.636-1.242-2.969-2.834-3.194C12.923 3.999 10.69 2 8 2zm2.354 5.146a.5.5 0 0 1-.708.708L8.5 6.707V10.5a.5.5 0 0 1-1 0V6.707L6.354 7.854a.5.5 0 1 1-.708-.708l2-2a.5.5 0 0 1 .708 0l2 2z"/>\n            </svg>\n            '));i.style.transform="scale(".concat(1.7,")"),i.style.paddingRight="10px",e.append(i),e.append((0,s.sR)((()=>{this.app.api.onClickCancel()}),'\n                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="'.concat(t,'" viewBox="0 0 20 20">\n                <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM5.354 4.646a.5.5 0 1 0-.708.708L7.293 8l-2.647 2.646a.5.5 0 0 0 .708.708L8 8.707l2.646 2.647a.5.5 0 0 0 .708-.708L8.707 8l2.647-2.646a.5.5 0 0 0-.708-.708L8 7.293 5.354 4.646z"/>\n                </svg>\n                '),1.4)),e.append((0,s.sR)((()=>{this.app.api.onClickReset()}),'\n                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="'.concat(t,'" viewBox="0 0 20 20">\n                <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM4.5 7.5a.5.5 0 0 0 0 1h7a.5.5 0 0 0 0-1h-7z"/>\n                </svg>\n                '),1.4)),e.append((0,s.sR)((()=>{this.app.api.onClickDownload()}),'\n                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="'.concat(t,'" viewBox="0 0 20 20">\n                <path d="M12 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zM8 5a.5.5 0 0 1 .5.5v3.793l1.146-1.147a.5.5 0 0 1 .708.708l-2 2a.5.5 0 0 1-.708 0l-2-2a.5.5 0 1 1 .708-.708L7.5 9.293V5.5A.5.5 0 0 1 8 5z"/>\n                </svg>\n                '),1.4))}Layer1(){let t=document.createElement("div");this.divUIWrapper.append(t);let e=this.theme.top.iconFill;t.append((0,s.sR)((()=>{}),'\n                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="'.concat(e,'" viewBox="0 0 16 16">\n                <path d="M14.082 2.182a.5.5 0 0 1 .103.557L8.528 15.467a.5.5 0 0 1-.917-.007L5.57 10.694.803 8.652a.5.5 0 0 1-.006-.916l12.728-5.657a.5.5 0 0 1 .556.103z"/>\n                </svg>\n                '))),t.append((0,s.sR)((()=>{this.app.api.onClickUndo()}),'\n                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="'.concat(e,'" viewBox="0 0 16 16">\n                <path d="M8 0a8 8 0 1 0 0 16A8 8 0 0 0 8 0zm3.5 7.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H11.5z"/>\n                </svg>\n                '))),t.append((0,s.sR)((()=>{this.app.api.onClickRedo()}),'\n                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="'.concat(e,'" viewBox="0 0 16 16">\n                <path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0zM4.5 7.5a.5.5 0 0 0 0 1h5.793l-2.147 2.146a.5.5 0 0 0 .708.708l3-3a.5.5 0 0 0 0-.708l-3-3a.5.5 0 1 0-.708.708L10.293 7.5H4.5z"/>\n                </svg>\n                ')))}}class z{constructor(t){this.divHost=void 0,this.api=void 0,this.core=void 0,this.ui=void 0,this.param=void 0,this.emitAction=void 0,this.param=t,this.divHost=document.getElementById(t.id),this.param.theme&&(this.ui=new A(this,this.param.theme)),this.core=new O(this),this.api=new a(this)}initByImageDrawingApp(t){this.core.div.style.width=t.implementations.imageAnnoApp.graphicsCoreWrapper.canvasWrapper.aCanvas.canvas.width+"px",this.core.div.style.height=t.implementations.imageAnnoApp.graphicsCoreWrapper.canvasWrapper.aCanvas.canvas.height+"px",this.core.canvas.resize()}initImageByURL(t){this.core.importImage(t)}initImageByImg(t){this.core.importImageByImage(t)}pushCanvasDrawing(t){t&&this.core.div.prepend(t)}pushDrawingData(t){this.api.updateGeometries(t)}setScaleGlobal(t){this.api.setScaleGlobal(t)}getData(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.api.getData(t)}getImage(){return this.api.getImage()}getCanvas(){return this.api.getCtx().canvas}destroy(){this.api.onClickDestroy()}set coverColor(t){this.api.updateCoverColor(t)}}},51703:(t,e,i)=>{i.d(e,{An:()=>r.An,Bm:()=>s.Bm,JV:()=>s.JV,Kz:()=>s.Kz,_y:()=>s._y,aK:()=>s.aK,ld:()=>s.ld,nq:()=>s.nq,wq:()=>s.wq,xG:()=>s.xG,zq:()=>a.zq});var s=i(11548),a=(i(49384),i(6986)),r=(i(64768),i(22970));i(17874)}}]);
//# sourceMappingURL=86041.6ee8a5bd.chunk.js.map