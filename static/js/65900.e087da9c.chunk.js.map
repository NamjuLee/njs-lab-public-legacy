{"version":3,"file":"static/js/65900.e087da9c.chunk.js","mappings":"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","sources":["njslab/Tools/Raytracer/index.ts"],"sourcesContent":["import { RendererCanvas, Vector3, normalize, crossProduct } from '../../../lib'\r\n\r\nexport class Solution {\r\n    public divHost: HTMLElement;\r\n    public renderer: Renderer;\r\n    constructor(id: string) {\r\n        this.divHost = document.getElementById(id)\r\n        // Center align\r\n        this.divHost.style.display = 'flex';\r\n        this.divHost.style.alignItems = 'center';\r\n\r\n        const div = document.createElement('div');\r\n        div.style.marginLeft = 'auto';\r\n        div.style.marginRight = 'auto';\r\n        div.style.backgroundColor = '#555';\r\n        div.style.width = '1000px';\r\n        div.style.height = '600px';\r\n\r\n        this.divHost.appendChild(div);\r\n\r\n        // TODO\r\n        // You code goes here for one time operation\r\n\r\n        this.renderer = new Renderer(div);\r\n\r\n        // console.log(this.renderer);\r\n        // !! you should execute it for rendering\r\n        // this.start();\r\n    }\r\n    public destroy() {\r\n        this.renderer.destroy();\r\n        while (this.divHost.lastElementChild) {\r\n            this.divHost.removeChild(this.divHost.lastElementChild);\r\n        }\r\n    }\r\n}\r\n\r\nexport class Renderer extends RendererCanvas {\r\n\r\n    walls: Wall[] = [];\r\n    sun: Sun;\r\n    t: number = 0.0;\r\n    constructor(div: any) {\r\n        super(div);\r\n        this.canvas.style.position = 'relative';\r\n        this.canvas.style.width = '100%';\r\n        this.canvas.style.height = '100%';\r\n\r\n\r\n        this.sun = new Sun(new Vector3(300, 100, 0));\r\n        this.walls.push(new Wall(100, 200, 400, 500))\r\n        this.walls.push(new Wall(100, 500, 500, 600))\r\n        this.walls.push(new Wall(500, 100, 400, 400))\r\n\r\n        this.start();\r\n    }\r\n    public mouseMove(x: number, y: number): void {\r\n        this.sun.updateDirection(x, y);\r\n    }\r\n    public render(ctx: CanvasRenderingContext2D): void {\r\n        this.t += 0.01;\r\n        this.update(ctx);\r\n\r\n        this.walls.forEach((w) => { w.draw(ctx); });\r\n        this.sun.draw(ctx, this.t);\r\n    }\r\n    public update(ctx: CanvasRenderingContext2D) {\r\n\r\n        const sun = this.sun.getSunLine();\r\n        for (let i = 0; i < this.walls.length; ++i) {\r\n            const p = checkIntersection(sun.p0.x, sun.p0.y, sun.p1.x, sun.p1.y, this.walls[i].p0.x, this.walls[i].p0.y, this.walls[i].p1.x, this.walls[i].p1.y,)\r\n            if (p !== undefined) {\r\n                const ray = reflect(this.sun.rayVec, this.walls[i].nVec)\r\n                ctx.beginPath();\r\n                ctx.moveTo(p.x, p.y);\r\n                ctx.lineTo(p.x + ray.x, p.y + ray.y);\r\n                ctx.closePath();\r\n                ctx.stroke();\r\n            }\r\n\r\n        }\r\n\r\n        const pts = computeInter(sun, this.walls)\r\n\r\n        for (let i = 0; i < pts.length; ++i) {\r\n            const p = pts[i];\r\n            ctx.beginPath();\r\n            ctx.arc(p.x, p.y, 5, 0, Math.PI * 2.);\r\n            ctx.closePath();\r\n            ctx.stroke();\r\n        }\r\n\r\n    }\r\n}\r\n\r\nconst computeInter = (ray, walls) => {\r\n    let pts = []\r\n    let theDis = 10000\r\n    let theP;\r\n    let wallNext;\r\n    let theRay;\r\n\r\n    for (let i = 0; i < walls.length; ++i) {\r\n        const wall = walls[i];\r\n        const p = checkIntersection(ray.p0.x, ray.p0.y, ray.p1.x, ray.p1.y, wall.p0.x, wall.p0.y, wall.p1.x, wall.p1.y);\r\n        if (p !== undefined) {\r\n            const dis = distanceEuclidean(ray.p0.x, ray.p0.y, 0, p.x, p.y, 0);\r\n            if (dis < theDis) {\r\n                theP = p;\r\n                wallNext = wall;\r\n                theDis = dis;\r\n            }\r\n        }\r\n    }\r\n\r\n    if (theP !== undefined) {\r\n        pts.push(theP)\r\n    }\r\n\r\n    return pts\r\n\r\n}\r\n\r\nconst distanceEuclidean = (x0: number, y0: number, z0: number, x1: number, y1: number, z1: number) => {\r\n    return Math.sqrt((x0 - x1) * (x0 - x1) + (y0 - y1) * (y0 - y1) + (z0 - z1) * (z0 - z1));\r\n}\r\n\r\nclass Sun {\r\n    v: Vector3;\r\n    target = new Vector3(0, 0, 0);\r\n    rayVec = new Vector3(0, 0, 0);;\r\n    constructor(v: Vector3) {\r\n        this.v = v;\r\n    }\r\n    draw(ctx: CanvasRenderingContext2D, t: number) {\r\n        ctx.lineWidth = 0.1;\r\n        ctx.beginPath();\r\n        ctx.moveTo(this.v.x, this.v.y);\r\n        ctx.lineTo(this.target.x, this.target.y);\r\n        ctx.stroke();\r\n\r\n        ctx.lineWidth = 0.5;\r\n        ctx.beginPath();\r\n        ctx.moveTo(this.v.x, this.v.y);\r\n        ctx.lineTo(this.v.x + this.rayVec.x * 50, this.v.y + this.rayVec.y * 50);\r\n        ctx.stroke();\r\n\r\n        ctx.fillStyle = '#FDB813'\r\n        ctx.beginPath();\r\n        ctx.arc(this.v.x, this.v.y, Math.sin(9 * t) + 9, 0, Math.PI * 2);\r\n        ctx.fill();\r\n    }\r\n    updateDirection(x: number, y: number) {\r\n        this.target.x = x;\r\n        this.target.y = y;\r\n\r\n        this.rayVec.x = this.v.x + this.target.x;\r\n        this.rayVec.y = this.v.y + this.target.y;\r\n\r\n        this.rayVec.x = this.target.x - this.v.x;\r\n        this.rayVec.y = this.target.y - this.v.y;\r\n\r\n        // this.rayVec = normalize(this.rayVec);\r\n    }\r\n    getSunLine() {\r\n        return {\r\n            p0: this.v,\r\n            p1: new Vector3(this.v.x + this.rayVec.x * 1000, this.v.y + this.rayVec.y * 1000)\r\n        }\r\n    }\r\n}\r\n\r\nclass Wall {\r\n    p0: Vector3;\r\n    p1: Vector3;\r\n    nVec: Vector3;\r\n    constructor(x0, y0, x1, y1) {\r\n        this.p0 = new Vector3(x0, y0);\r\n        this.p1 = new Vector3(x1, y1);\r\n        this.computeNormal();\r\n    }\r\n    draw(ctx: CanvasRenderingContext2D) {\r\n        ctx.lineWidth = 3;\r\n        ctx.beginPath();\r\n        ctx.moveTo(this.p0.x, this.p0.y);\r\n        ctx.lineTo(this.p1.x, this.p1.y);\r\n        ctx.stroke();\r\n    }\r\n    computeNormal() {\r\n        const dir = new Vector3(this.p1.x - this.p0.x, this.p1.y - this.p0.y, 0)\r\n        this.nVec = crossProduct(dir, new Vector3(0, 0, 1));\r\n        this.nVec = normalize(this.nVec);\r\n    }\r\n}\r\n\r\n\r\nconst reflect = (v: Vector3, n: Vector3, strength = 1) => {\r\n    const dot = dotProduct(v, n);\r\n    return new Vector3(\r\n        (2 * dot * n.x - v.x) * -strength,\r\n        (2 * dot * n.y - v.y) * -strength,\r\n        (2 * dot * n.z - v.z) * -strength\r\n    );\r\n}\r\nconst dotProduct = (v1: Vector3, v2: Vector3) => {\r\n    return v1.x * v2.x + v1.y * v2.y + v1.z * v2.z;\r\n}\r\nconst intersect = (ray: Vector3, v0: Vector3, v1: Vector3) => {\r\n    let x = ray.x;\r\n    let y = ray.y;\r\n    let xi = v0.x, yi = v0.y;\r\n    let xj = v1.x, yj = v1.y;\r\n    return ((yi > y) !== (yj > y)) && (x < (xj - xi) * (y - yi) / (yj - yi) + xi);\r\n}\r\nexport const pointOnSegment2D = (px: number, py: number, x0: number, y0: number, x1: number, y1: number) => {\r\n    if (x0 !== x1) {\r\n        if (x0 <= px && px <= x1) { return true; }\r\n        if (x0 >= px && px >= x1) { return true; }\r\n    } else {\r\n        if (y0 <= py && py <= y1) { return true; }\r\n        if (y0 >= py && py >= y1) { return true; }\r\n    }\r\n    return false;\r\n}\r\n\r\nconst checkIntersection = (x1: number, y1: number, x2: number, y2: number, x3: number, y3: number, x4: number, y4: number) => {\r\n    const denom = ((y4 - y3) * (x2 - x1)) - ((x4 - x3) * (y2 - y1));\r\n    const numeA = ((x4 - x3) * (y1 - y3)) - ((y4 - y3) * (x1 - x3));\r\n    const numeB = ((x2 - x1) * (y1 - y3)) - ((y2 - y1) * (x1 - x3));\r\n\r\n    if (denom === 0) {\r\n        if (numeA === 0 && numeB === 0) {\r\n            return undefined // COLINEAR;\r\n        }\r\n        return undefined // PARALLEL;\r\n    }\r\n\r\n    const uA = numeA / denom;\r\n    const uB = numeB / denom;\r\n\r\n    if (uA >= 0 && uA <= 1 && uB >= 0 && uB <= 1) {\r\n        return ({\r\n            x: x1 + (uA * (x2 - x1)),\r\n            y: y1 + (uA * (y2 - y1))\r\n        });\r\n    }\r\n\r\n    return undefined;\r\n}"],"names":["Solution","constructor","id","divHost","renderer","this","document","getElementById","style","display","alignItems","div","createElement","marginLeft","marginRight","backgroundColor","width","height","appendChild","Renderer","destroy","lastElementChild","removeChild","RendererCanvas","super","walls","sun","t","canvas","position","Sun","Vector3","push","Wall","start","mouseMove","x","y","updateDirection","render","ctx","update","forEach","w","draw","getSunLine","i","length","p","checkIntersection","p0","p1","undefined","ray","reflect","rayVec","nVec","beginPath","moveTo","lineTo","closePath","stroke","pts","computeInter","arc","Math","PI","theP","wallNext","theDis","wall","dis","distanceEuclidean","x0","y0","z0","x1","y1","z1","sqrt","v","target","lineWidth","fillStyle","sin","fill","computeNormal","dir","crossProduct","normalize","n","strength","dot","dotProduct","z","v1","v2","pointOnSegment2D","px","py","x2","y2","x3","y3","x4","y4","denom","numeA","numeB","uA","uB"],"sourceRoot":""}