"use strict";(self.webpackChunkNJS_Lab=self.webpackChunkNJS_Lab||[]).push([[10288],{10288:(t,e,i)=>{i.r(e),i.d(e,{Demo530ImageDrawing:()=>M,Solution:()=>C});const s={normal:{filter:{sepia:0,contrast:1,brightness:1,saturate:1,hueRotate:0}},filter1977:{filter:{sepia:.5,contrast:1,brightness:1,saturate:1.4,hueRotate:-30}},aden:{filter:{sepia:.2,contrast:1,brightness:1.5,saturate:1.4,hueRotate:0},tint:{background0:"rgba(125, 105, 24, .1)",blendMode:"multiply"}},amaro:{filter:{sepia:.35,contrast:1.1,brightness:1.2,saturate:1.3,hueRotate:0},tint:{background0:"rgba(125, 105, 24, .2)",blendMode:"overlay"}},ashby:{filter:{sepia:.5,contrast:1.2,brightness:1,saturate:1.8,hueRotate:0},tint:{background0:"rgba(125, 105, 24, .35)",blendMode:"lighten"}},brannan:{filter:{sepia:.4,contrast:1.25,brightness:1.1,saturate:.9,hueRotate:-2}},brooklyn:{filter:{sepia:.25,contrast:1.25,brightness:1.25,saturate:1,hueRotate:5},tint:{background0:"rgba(127, 187, 227, .2)",blendMode:"overlay"}},charmes:{filter:{sepia:.25,contrast:1.25,brightness:1.25,saturate:1.35,hueRotate:-5},tint:{background0:"rgba(125, 105, 24, .25)",blendMode:"darken"}},clarendon:{filter:{sepia:.15,contrast:1.25,brightness:1.25,saturate:1,hueRotate:5},tint:{background0:"rgba(127, 187, 227, .4)",blendMode:"overlay"}},crema:{filter:{sepia:.5,contrast:1.25,brightness:1.15,saturate:.9,hueRotate:-2},tint:{background0:"rgba(125, 105, 24, .2)",blendMode:"multiply"}},dogpatch:{filter:{sepia:.35,contrast:1.1,brightness:1.5,saturate:1,hueRotate:0}},earlybird:{filter:{sepia:.25,contrast:1.25,brightness:1.15,saturate:.9,hueRotate:-5},tint:{background0:"rgba(0, 0, 0, 0)",background1:"rgba(125, 105, 24, .2)",blendMode:"multiply"}},gingham:{filter:{sepia:0,contrast:1.1,brightness:1.1,saturate:1,hueRotate:0},tint:{background0:"rgba(230, 230, 230, 1)",blendMode:"soft-light"}},ginza:{filter:{sepia:.25,contrast:1.15,brightness:1.2,saturate:1.35,hueRotate:-5},tint:{background0:"rgba(125, 105, 24, .15)",blendMode:"darken"}},hefe:{filter:{sepia:.4,contrast:1.5,brightness:1.2,saturate:1.4,hueRotate:-10},tint:{background0:"rgba(0, 0, 0, 0)",background1:"rgba(0, 0, 0, .25)",blendMode:"soft-light"}},helena:{filter:{sepia:.5,contrast:1.05,brightness:1.05,saturate:1.35,hueRotate:0},tint:{background0:"rgba(158, 175, 30, .25)",blendMode:"overlay"}},hudson:{filter:{sepia:.25,contrast:1.2,brightness:1.2,saturate:1.05,hueRotate:-15},tint:{background0:"rgba(0, 0, 0, 0)",background1:"rgba(25, 62, 167, .25)",blendMode:"multiply"}},inkwell:{filter:{sepia:0,contrast:.85,brightness:1.25,saturate:0,hueRotate:0},tint:{background0:"rgba(0, 0, 0, 0)",background1:"rgba(25, 62, 167, .25)",blendMode:"multiply"}},juno:{filter:{sepia:.35,contrast:1.15,brightness:1.15,saturate:1.8,hueRotate:0},tint:{background0:"rgba(127, 187, 227, .2)",blendMode:"overlay"}},kelvin:{filter:{sepia:.15,contrast:1.5,brightness:1.1,saturate:1,hueRotate:-10},tint:{background0:"rgba(128, 78, 15, .25)",background1:"rgba(128, 78, 15, .5)",blendMode:"overlay"}},lark:{filter:{sepia:.25,contrast:1.2,brightness:1.3,saturate:1.25,hueRotate:0}},lofi:{filter:{sepia:0,contrast:1.5,brightness:1,saturate:1.1,hueRotate:0}},maven:{filter:{sepia:.35,contrast:1.05,brightness:1.05,saturate:1.75,hueRotate:0},tint:{background0:"rgba(158, 175, 30, .25)",blendMode:"darken"}},mayfair:{filter:{sepia:0,contrast:1.1,brightness:1.15,saturate:1.1,hueRotate:0},tint:{background0:"rgba(0, 0, 0, 0)",background1:"rgba(175, 105, 24, .4)",blendMode:"multiply"}},moon:{filter:{sepia:.35,contrast:1.4,brightness:.95,saturate:0,hueRotate:0}},nashville:{filter:{sepia:.25,contrast:1.5,brightness:.9,saturate:1,hueRotate:-15},tint:{background0:"rgba(128, 78, 15, .5)",background1:"rgba(128, 78, 15, .65)",blendMode:"screen"}},perpetua:{filter:{sepia:0,contrast:1.1,brightness:1.25,saturate:1.1,hueRotate:0},tint:{background0:"rgba(0, 91, 154, .25)",background1:"rgba(230, 193, 61, .25)",blendMode:"multiply"}},poprocket:{filter:{sepia:.15,contrast:1,brightness:1.2,saturate:1,hueRotate:0},tint:{background0:"rgba(206, 39, 70, .75)",background1:"rgba(0, 0, 0, 0.8)",blendMode:"screen"}},reyes:{filter:{sepia:.75,contrast:.75,brightness:1.12,saturate:1.4,hueRotate:0}},rise:{filter:{sepia:.25,contrast:1.25,brightness:1.2,saturate:.9,hueRotate:0},tint:{background0:"rgba(0, 0, 0, 0)",background1:"rgba(230, 193, 61, .25)",blendMode:"lighten"}},sierra:{filter:{sepia:.25,contrast:1.5,brightness:.9,saturate:1,hueRotate:-15},tint:{background0:"rgba(128, 78, 15, .5)",background1:"rgba(0, 0, 0, .65)",blendMode:"screen"}},skyline:{filter:{sepia:.15,contrast:1.25,brightness:1.25,saturate:1.2,hueRotate:0}},slumber:{filter:{sepia:.35,contrast:1.25,brightness:1,saturate:1.25,hueRotate:0},tint:{background0:"rgba(125, 105, 24, .2)",blendMode:"darken"}},stinson:{filter:{sepia:.35,contrast:1.25,brightness:1.1,saturate:1.25,hueRotate:0},tint:{background0:"rgba(125, 105, 24, .45)",blendMode:"lighten"}},sutro:{filter:{sepia:.4,contrast:1.2,brightness:.9,saturate:1.4,hueRotate:-10},tint:{background0:"rgba(0, 0, 0, 0.1)",background1:"rgba(0, 0, 0, .5)",blendMode:"darken"}},toaster:{filter:{sepia:.25,contrast:1.5,brightness:.95,saturate:1,hueRotate:-15},tint:{background0:"rgba(128, 78, 15, 1.0)",background1:"rgba(0, 0, 0, .25)",blendMode:"screen"}},valencia:{filter:{sepia:.25,contrast:1.1,brightness:1.1,saturate:1,hueRotate:0},tint:{background0:"rgba(230, 193, 61, .1)",blendMode:"lighten"}},vesper:{filter:{sepia:.35,contrast:1.15,brightness:1.2,saturate:1.3,hueRotate:0},tint:{background0:"rgba(125, 105, 24, .25)",blendMode:"overlay"}},walden:{filter:{sepia:.35,contrast:.8,brightness:1.25,saturate:1.4,hueRotate:0},tint:{background0:"rgba(229, 240, 128, .5)",blendMode:"darken"}},willow:{filter:{sepia:.2,contrast:.85,brightness:1.2,saturate:.05,hueRotate:0}},xpro2:{filter:{sepia:.45,contrast:1.12,brightness:1.75,saturate:1.3,hueRotate:-5},tint:{background0:"rgba(0, 91, 154, .35)",background1:"rgba(0, 0, 0, .65)",blendMode:"multiply"}}},o=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"normal",i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";if(t.globalCompositeOperation=e,t.setTransform(t.canvas.width,0,0,t.canvas.height,0,0),i){let e=t.createRadialGradient(.5,.5,.1,.5,.5,.5);e.addColorStop(0,s),e.addColorStop(1,o),t.fillStyle=e}else t.fillStyle=s;return t.fillRect(0,0,t.canvas.width,t.canvas.height),t};class r{constructor(t,e){this.core=void 0,this.div=void 0,this.canvas=void 0,this.ctx=void 0,this.canvasFilter=void 0,this.ctxFilter=void 0,this.isActive=!1,this.log=void 0,this.isViewChanging=!1,this.loopNum=0,this.needRenderloop=!0,this.ablePan=!0,this.mousePre=[0,0],this.canvasOut=void 0,this.ctxOut=void 0,this.loopNeeded=!1,this.isFiltered=!1,this.core=t,this.div=e,this.loopNeeded=!1,this.init(),this.loopInit()}init(){const t=document.createElement("canvas"),e=document.createElement("canvas"),i=document.createElement("canvas");if(t&&e){this.canvas=t,this.canvas.width=this.div.clientWidth,this.canvas.height=this.div.clientHeight,this.div.append(this.canvas),this.canvasOut=e,this.canvasOut.style.border="5px",this.ctxOut=this.canvasOut.getContext("2d"),this.core.app.divHost.append(this.canvasOut),this.canvasFilter=i,this.ctxFilter=this.canvasFilter.getContext("2d"),this.canvasFilter.width=this.div.clientWidth,this.canvasFilter.height=this.div.clientHeight;const s=this.canvas.getContext("2d");s&&(this.ctx=s,this.isActive=!0,this.initEvent())}}initEvent(){this.canvas.addEventListener("keydown",(t=>{})),this.canvas.addEventListener("keyup",(t=>{})),this.canvas.addEventListener("mousedown",(t=>{this.core.controller.mouseInteraction.mouseDown(t)}),!1),this.canvas.addEventListener("mouseup",(t=>{this.core.controller.mouseInteraction.mouseUp(t)}),!1),this.canvas.addEventListener("mousemove",(t=>{this.core.controller.mouseInteraction.mouseMove(t)}),!1),this.canvas.addEventListener("wheel",(t=>this.core.controller.mouseInteraction.mouseWheel(t,t.deltaY)),!1),this.canvas.addEventListener("mouseout",(t=>{this.core.controller.mouseInteraction.mouseOut(t)}),!1),this.canvas.addEventListener("touchstart",(t=>this.core.controller.touchInteraction.touchstart(t)),!1),this.canvas.addEventListener("touchmove",(t=>this.core.controller.touchInteraction.touchmove(t)),!1),this.canvas.addEventListener("touchcancel",(t=>this.core.controller.touchInteraction.touchcancel(t)),!1),this.canvas.addEventListener("touchend",(t=>this.core.controller.touchInteraction.touchend(t)),!1)}capture(){const t=new Image;return t.crossOrigin="anonymous",t.src=this.canvasOut.toDataURL(),t}loopInit(){this.loop()}resize(){this.canvas.width=this.div.clientWidth,this.canvas.height=this.div.clientHeight}loop(){if(requestAnimationFrame((()=>{this.loop()})),this.loopNum++<130){let t=performance.now();this.renderPre(this.ctx);let e=performance.now();this.log="level: , total frames: ".concat(this.loopNum++," (FPS: ), a loop took: ").concat((e-t).toFixed(2)," ms to execute.")}}clear(t){this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height)}renderForce(){this.loopNum=0}renderPre(t){this.isActive&&(this.clear(this.ctx),this.isFiltered&&this.ctx.drawImage(this.canvasFilter,0,0),this.render(t))}render(t){}updateFilter(t){this.ctxFilter.canvas.width=this.core.imageWrapper.img.width,this.ctxFilter.canvas.height=this.core.imageWrapper.img.height;const e=((t,e,i)=>{let r=[];for(let o in s)r.push(o);let a=1/r.length,n=Math.floor(i/a),h=s[r[n]];return function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;t.filter="sepia(".concat(i,") contrast(").concat(s,") brightness(").concat(o,") saturate(").concat(r,") hue-rotate(").concat(a,"deg)"),t.drawImage(e,0,0)}(t,e,h.filter.sepia,h.filter.contrast,h.filter.brightness,h.filter.saturate,h.filter.hueRotate),h.tint&&(h.tint.background1?o(t,h.tint.blendMode,!0,h.tint.background0,h.tint.background1):o(t,h.tint.blendMode,!1,h.tint.background0)),r[n]})(this.ctxFilter,this.core.imageWrapper.img,t);this.ctx.drawImage(this.canvasFilter,0,0),this.core.app.ui.divTextPresest.textContent="Filter: "+e}}class a{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this.ncols=void 0,this.k=void 0,this.minDiff=void 0,this.clusters=void 0,this.ncols=t,i<1&&(i=1),this.k=e,this.minDiff=i,this.init()}init(){let t=c(10),e=[],i=[];for(;e.length<this.k;){let s=Math.floor(t()*this.ncols.length),o=!1;for(let t=0;t<i.length;t++)if(s===i[t]){o=!0;break}if(!o){i.push(s);let t=new n(this.ncols[s]);t.push(this.ncols[s]),e.push(t)}}let s=0;for(;!(s++>1e4);){let t=[];for(let e=0;e<this.k;e++)t.push([]);for(let s=0;s<this.ncols.length;s++){let i=this.ncols[s],o=Number.MAX_VALUE,r=0;for(let t=0;t<this.k;t++){let s=this.euclidean(i,e[t].key);s<o&&(o=s,r=t)}t[r].push(i)}let i=0;for(let s=0;s<this.k;s++){let o=e[s].key,r=this.calculateCenter(t[s],3),a=new n(r);a.values=t[s];let h=this.euclidean(o,r);isNaN(h)||(e[s]=a,i=i>h?i:h)}if(i<this.minDiff)break}this.clusters=e}euclidean(t,e){let i=Math.pow(t.r-e.r,2)+Math.pow(t.g-e.g,2)+Math.pow(t.b-e.b,2);return Math.sqrt(i)}calculateCenter(t,e){let i=new h(0,0,0);for(let s=0;s<t.length;s++)i.r+=t[s].r,i.g+=t[s].g,i.b+=t[s].b;return i.r/=t.length,i.g/=t.length,i.b/=t.length,i}}class n{constructor(t){this.key=void 0,this.values=[],this.key=t}push(t){this.values.push(t)}getKey(){return[this.key.r,this.key.g,this.key.b]}}class h{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.r=0,this.g=0,this.b=0,this.r=t,this.g=e,this.b=i}}const c=t=>(void 0===t&&(t=performance.now()),()=>(t=(9301*t+49297)%233280)/233280);let l,d;!function(t){t.GetImage="GetImage"}(l||(l={})),function(t){t.Canvas="Canvas",t.WebGL2="WebGL2",t.WebGPU="WebGPU",t.WebAssembly="WebAssembly"}(d||(d={}));const u=(t,e,i)=>{t/=255,e/=255,i/=255;let s=Math.max(t,e,i),o=Math.min(t,e,i),r=(s+o)/2,a=(s+o)/2,n=(s+o)/2;if(s===o)r=a=0;else{let h=s-o;switch(a=n>.5?h/(2-s-o):h/(s+o),s){case t:r=(e-i)/h+(e<i?6:0);break;case e:r=(i-t)/h+2;break;case i:r=(t-e)/h+4}r/=6}return[r,a,n]},g=(t,e,i)=>{let s,o,r;if(0===e)s=o=r=i;else{const a=(t,e,i)=>(i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t);let n=i<.5?i*(1+e):i+e-i*e,h=2*i-n;s=a(h,n,t+1/3),o=a(h,n,t),r=a(h,n,t-1/3)}return[Math.max(0,Math.min(Math.round(255*s),255)),Math.max(0,Math.min(Math.round(255*o),255)),Math.max(0,Math.min(Math.round(255*r),255))]};class v{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;this.x=void 0,this.y=void 0,this.width=void 0,this.height=void 0,this.r=5,this._isInside=!1,this.x=t,this.y=e,this.width=i,this.height=s,v.list.push(this)}mouseDown(t,e){console.log("down",t,e)}mouseUp(t,e){console.log("up",t,e)}mouseDrag(t,e){console.log("drag",t,e)}isInside(){}render(t){this._isInside&&(t.beginPath(),t.arc(this.x,this.y,this.r,0,Math.PI),t.closePath(),t.stroke()),t.lineWidth=2,t.strokeStyle="#999",t.beginPath(),t.rect(this.x,this.y,this.width,this.height),t.closePath(),t.stroke()}}v.list=[];class p{constructor(t){this.core=void 0,this.t=0,this.isCapture=!1,this.core=t}render(t){if(this.core.img){switch(t.save(),1){case 0:const e=new DOMMatrix([1,0,0,1,0,0]),i=this.core.img.width,s=this.core.img.height,o=0/this.core.img.width,r=0/this.core.img.height;console.log(o,r),console.log(1-o,1-r),t.setTransform(e.translate(i*o,s*r).rotate(this.core.controller.rotationRadian).scale(this.core.controller.zoomLevel).translate(i*(1-o),s*(1-r))),t.drawImage(this.core.img,-this.core.img.width,-this.core.img.height);break;case 1:t.translate(.5*this.core.img.width,.5*this.core.img.height),t.rotate(this.core.controller.rotationRadian),t.scale(this.core.controller.zoomLevel,this.core.controller.zoomLevel),t.drawImage(this.core.img,.5*-this.core.img.width,.5*-this.core.img.height)}v.list.forEach((e=>{e.render(t)})),t.restore()}this.captureImage();let e=1-this.t;e<0&&(e=0),t.beginPath();const i=this.core.controller.touchInteraction.touchPre[0],s=this.core.controller.touchInteraction.touchPre[1];t.arc(i,s,10*e,0,6.28),t.closePath(),t.fillStyle="rgba(255, 255, 255, ".concat(e,")"),t.fill(),t.restore(),this.t+=.025}captureImage(){this.core.controller.isDrag&&this.updateCanvasCapture(),this.isCapture}updateCanvasCapture(){}}class m{constructor(t,e){this.core=void 0,this.img=void 0,this.core=t,this.img=e}}class b{constructor(t){this.controller=void 0,this.down=!1,this.touchPre=[0,0],this.zoom=1,this.controller=t}touchstart(t){this.controller.core.renderer.t=0;var e=this.controller.core.canvas.canvas.getBoundingClientRect();const i=t.targetTouches[0].pageX-e.left,s=t.targetTouches[0].pageY-e.top;this.touchPre[0]=i,this.touchPre[1]=s,this.controller.touchStartRotation=!0,this.controller.touchStartScale=!0,this.controller.pointDown(i,s),t.preventDefault()}touchmove(t){if(t.targetTouches.length>1)return this.controller.rotationByTouch(t),void this.controller.scaleByTouch(t);var e=this.controller.core.canvas.canvas.getBoundingClientRect();const i=t.targetTouches[0].pageX-e.left,s=t.targetTouches[0].pageY-e.top;this.touchPre[0]=i,this.touchPre[1]=s,this.controller.pointDrag(i,s),t.preventDefault()}touchcancel(t){this.controller.touchStartRotation=!1,this.controller.touchStartScale=!1,t.preventDefault()}touchend(t){this.controller.pointUp(-1,-1),t.preventDefault()}}class f{constructor(t){this.controller=void 0,this.controller=t}mouseDown(t){this.controller.pointDown(t.offsetX,t.offsetY)}mouseUp(t){this.controller.isDrag=!1,this.controller.pointUp(t.offsetX,t.offsetY)}mouseWheel(t,e){this.controller.zoom(t.deltaY)}mouseMove(t){this.controller.isDown?this.controller.pointDrag(t.offsetX,t.offsetY):this.controller.pointMove(t.offsetX,t.offsetY)}mouseOut(t){this.controller.pointOut(t.offsetX,t.offsetY)}}let y;!function(t){t.Default="default",t.Auto="audo",t.Crosshair="CROSSHAIR",t.Move="move",t.Pointer="pointer",t.Text="text",t.Wait="wait",t.Help="help",t.NWResize="nw-resize",t.NEResize="ne-resize",t.NSResize="ns-resize",t.EResize="e-resize"}(y||(y={}));class k{constructor(t){this.div=void 0,this.div=t}default(){this.div?this.div.style.cursor!==y.Default&&(this.div.style.cursor=y.Default):document.body.style.cursor!==y.Default&&(document.body.style.cursor=y.Default)}auto(){this.div?this.div.style.cursor!==y.Auto&&(this.div.style.cursor=y.Auto):document.body.style.cursor!==y.Auto&&(document.body.style.cursor=y.Auto)}creating(){this.div?this.div.style.cursor!==y.Crosshair&&(this.div.style.cursor=y.Crosshair):document.body.style.cursor!==y.Crosshair&&(document.body.style.cursor=y.Crosshair)}dragging(){this.div?this.div.style.cursor!==y.Move&&(this.div.style.cursor=y.Move):document.body.style.cursor!==y.Move&&(document.body.style.cursor=y.Move)}hovering(){this.div?this.div.style.cursor!==y.Pointer&&(this.div.style.cursor=y.Pointer):document.body.style.cursor!==y.Pointer&&(document.body.style.cursor=y.Pointer)}texting(){this.div?this.div.style.cursor!==y.Text&&(this.div.style.cursor=y.Text):document.body.style.cursor!==y.Text&&(document.body.style.cursor=y.Text)}set_e_resize(){this.div?this.div.style.cursor!==y.EResize&&(this.div.style.cursor=y.EResize):document.body.style.cursor!==y.EResize&&(document.body.style.cursor=y.EResize)}set_ne_resize(){this.div?this.div.style.cursor!==y.NEResize&&(this.div.style.cursor=y.NEResize):document.body.style.cursor!==y.NEResize&&(document.body.style.cursor=y.NEResize)}set_ns_resize(){this.div?this.div.style.cursor!==y.NSResize&&(this.div.style.cursor=y.NSResize):document.body.style.cursor!==y.NSResize&&(document.body.style.cursor=y.NSResize)}set_nw_resize(){this.div?this.div.style.cursor!==y.NWResize&&(this.div.style.cursor=y.NWResize):document.body.style.cursor!==y.NWResize&&(document.body.style.cursor=y.NWResize)}}class x{constructor(t){this.core=void 0,this.activeCursor=void 0,this.mouseInteraction=void 0,this.touchInteraction=void 0,this.isDown=!1,this.isDrag=!1,this.mousePre=[0,0],this.zoomLevel=1,this.rotationRadian=0,this.scalePre=1,this.anglePre=0,this.touchStartRotation=!1,this.touchStartScale=!1,this.mouseDragRect=(t,e)=>{this.mousePre[0]=t,this.mousePre[1]=e},this.mouseDragPan=(t,e)=>{this.pan(t,e)},this.core=t,this.activeCursor=new k,this.touchInteraction=new b(this),this.mouseInteraction=new f(this)}import(t){this.reset()}reset(){}rotate(t){this.rotationRadian=t,this.postUpdate()}pointDown(t,e){this.isDown=!0,this.mousePre[0]=t,this.mousePre[1]=e,v.list.forEach((i=>{i.mouseDown(t,e)})),this.postUpdate()}pointUp(t,e){this.isDown=!1,v.list.forEach((i=>{i.mouseUp(t,e)})),this.postUpdate()}pointOut(t,e){this.isDown=!1,this.isDrag=!1,this.postUpdate()}pointMove(t,e){this.mousePre[0]=t,this.mousePre[1]=e,this.postUpdate()}pointDrag(t,e){this.isDrag=!0,v.list.forEach((i=>{i.mouseDrag(t,e)})),this.postUpdate()}zoom(t){t<0?this.zoomLevel+=.19*this.zoomLevel:this.zoomLevel-=.19*this.zoomLevel,this.postUpdate()}pan(t,e){}postUpdate(){this.core.canvas.renderForce()}downloadImage(){const t=document.createElement("a");t.href=this.core.canvas.canvasOut.toDataURL(),t.download="image.png",document.body.appendChild(t),t.click(),document.body.removeChild(t)}rotationByTouch(t){let e,i;this.core.canvas.renderForce(),t.targetTouches[0].clientY<t.targetTouches[1].clientY?(e=t.targetTouches[0],i=t.targetTouches[1]):(e=t.targetTouches[1],i=t.targetTouches[0]);const s=Math.atan2(i.clientX-e.clientX,i.clientY-e.clientY),o=this.anglePre-s;if(this.touchStartRotation)return this.anglePre=this.rotationRadian,this.touchStartRotation=!1,void(this.anglePre=s);this.rotationRadian+=o,this.anglePre=s}scaleByTouch(t){let e,i;this.core.canvas.renderForce(),t.targetTouches[0].clientY<t.targetTouches[1].clientY?(e=t.targetTouches[0],i=t.targetTouches[1]):(e=t.targetTouches[1],i=t.targetTouches[0]);const s=Math.sqrt((i.clientX-e.clientX)*(i.clientX-e.clientX)+(i.clientY-e.clientY)*(i.clientY-e.clientY));if(this.scalePre>s?this.zoomLevel>.4&&(this.zoomLevel-=.015):this.zoomLevel<2&&(this.zoomLevel+=.015),this.touchStartScale)return this.scalePre=this.zoomLevel,this.touchStartScale=!1,void(this.scalePre=s);this.scalePre=s}}class w{constructor(t){this.app=void 0,this.div=void 0,this.imageWrapper=void 0,this.renderer=void 0,this.canvas=void 0,this.controller=void 0,this.ctx=void 0,this.img=void 0,this.app=t,this.initApp(),this.initCanvas(),this.importImage("https://raw.githubusercontent.com/NamjuLee/data/master/img/bg/zoom-James-River-Kayaking.jpg")}initApp(){this.renderer=new p(this),this.controller=new x(this)}initCanvas(){const t=document.createElement("div");t.id="ExpressImageDivCanvas",t.style.overflow="hidden",t.style.textAlign="center",this.div=t,this.app.div.append(this.div),this.canvas=new r(this,t),this.canvas.render=t=>{this.renderer.render(t)}}importImage(t){const e=new Image;e.crossOrigin="anonymous",e.src=t,e.style.pointerEvents="none",this.renderer.isCapture=!1,e.onload=()=>{this.imageWrapper=new m(this,e),this.canvas.canvasOut.width=e.width,this.canvas.canvasOut.height=e.height,this.canvas.canvas.width=e.width,this.canvas.canvas.height=e.height,this.div.style.height=e.height+"px",this.img=e;const t=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const i=[],s=document.createElement("canvas").getContext("2d");s.drawImage(t,0,0,100,100);const o=s.getImageData(0,0,100,100).data;for(let a=0,c=o.length;a<c;a+=4){let t=o[a],e=o[a+1],s=o[a+2];i.push(new h(t,e,s))}let r=new a(i,e,1),n=[];for(let a=0;a<r.clusters.length;a++)n.push(r.clusters[a].getKey());return n}(e),i=[t[0][0],t[0][1],t[0][2]];let s=u(i[0],i[1],i[2]),o=[...s];s[0]+=0,s[1]+=-.05,s[1]<0&&(s[1]=0),s[2]+=0;let r=g(s[0],s[1],s[2]);this.app.div.style.backgroundColor="rgb(".concat(r[0],",").concat(r[1],",").concat(r[2],")"),this.app.ui.updateStyle(r[0],r[1],r[2]),this.app.divHost.style.backgroundColor="rgb(".concat(r[0],",").concat(r[1],",").concat(r[2],")"),o[0]+=0,o[1]+=0,o[1]<0&&(o[1]=0),o[2]+=-.02;g(o[0],o[1],o[2]);this.renderer.isCapture=!0,this.canvas.renderForce()}}}class R{constructor(t){this.expreeImageTool=void 0,this.divUI=void 0,this.divSizeFrameBG=void 0,this.divWidth=void 0,this.divHeight=void 0,this.divTextPresest=void 0,this.expreeImageTool=t;const e=document.createElement("p");e.textContent="Expree Image",e.style.fontSize="12px;",e.style.color="#afafaf",e.style.position="absolute",e.style.top="0px",e.style.left="20px",this.expreeImageTool.divHost.append(e);const i=document.createElement("div");this.divUI=i,this.divUI.style.width="100%",this.divUI.style.height="100px",this.divUI.style.backgroundColor="rgba(0,0,0,0)",this.expreeImageTool.divHost.append(this.divUI)}updateStyle(t,e,i){this.divSizeFrameBG.style.backgroundColor="rgb(".concat(t,",").concat(i,",").concat(e,")")}initPost(){this.divSizeFrameBG=document.createElement("div"),this.divSizeFrameBG.style.textAlign="center",this.divSizeFrameBG.style.backgroundColor="#afafaf",this.divSizeFrameBG.style.padding="10px",this.divSizeFrameBG.textContent="Size ",this.divWidth=document.createElement("input"),this.divWidth.style.width="50px",this.divWidth.setAttribute("type","text"),this.divWidth.setAttribute("min","100"),this.divSizeFrameBG.append(this.divWidth),this.divWidth.oninput=()=>{},this.divHeight=document.createElement("input"),this.divHeight.style.width="50px",this.divHeight.setAttribute("type","text"),this.divHeight.setAttribute("min","100"),this.divSizeFrameBG.append(this.divHeight),this.divHeight.oninput=()=>{},this.divUI.append(this.divSizeFrameBG);let t=document.createElement("button");t.textContent="Reset",this.divUI.append(t),t.onclick=()=>{this.expreeImageTool.core.controller.reset()},t=document.createElement("button"),t.textContent="Rect",this.divUI.append(t),t.onclick=()=>{const t=this.expreeImageTool.core.img.width-100,e=this.expreeImageTool.core.img.height-100;new v(.5*-t,.5*-e,t,e)},t=document.createElement("button"),t.textContent="Download",this.divUI.append(t),t.onclick=()=>{this.expreeImageTool.core.controller.downloadImage()},t=document.createElement("button"),t.textContent="Capture",this.divUI.append(t),t.onclick=()=>{const t=this.expreeImageTool.core.canvas.capture();this.divUI.append(t)};let e=document.createElement("input");e.style.width="500px",e.type="range",e.min="0",e.max="0.99",e.step="0.01",e.value="0",e.oninput=()=>{this.expreeImageTool.core.canvas.updateFilter(+e.value)},this.divUI.append(e),this.divTextPresest=document.createElement("div"),this.divTextPresest.textContent="Filter: normal",this.divTextPresest.style.padding="10px",this.divUI.append(this.divTextPresest);const i=document.createElement("input");i.setAttribute("type","text"),i.setAttribute("value","https://raw.githubusercontent.com/NamjuLee/data/master/img/building%20footprint.png"),this.divUI.append(i),i.oninput=()=>{console.log(i),this.expreeImageTool.core.controller.reset(),this.expreeImageTool.core.importImage(i.textContent)},i.addEventListener("keyup",(t=>{13===t.keyCode&&(t.preventDefault(),this.expreeImageTool.core.controller.reset(),this.expreeImageTool.core.importImage(i.value))}));let s=document.createElement("div");s.textContent="Offset: ",s.style.padding="10px";let o=document.createElement("input");o.style.width="30px",o.setAttribute("type","text"),o.setAttribute("min","-50"),o.setAttribute("max","50"),o.setAttribute("value","10"),s.append(o),this.divUI.append(s),o.addEventListener("keyup",(t=>{13===t.keyCode&&(t.preventDefault(),console.log("divInput.value",o.value))})),t=document.createElement("button"),t.textContent="Rect",this.divUI.append(t),t.onclick=()=>{const t=this.expreeImageTool.core.canvas.capture();this.divUI.append(t)}}}class I{constructor(t){this.core=void 0,this.ui=void 0,this.divHost=void 0,this.div=void 0,this.param=void 0,this.param=t;const e=document.getElementById(this.param.id),i=document.createElement("div");e&&i&&(this.div=i,this.div.id="ExpressImage",this.div.style.padding="50px",this.divHost=e,this.divHost.append(this.div),void 0===this.param.ui&&(this.param.ui=!0),this.param.ui&&(this.ui=new R(this),this.ui.initPost()),this.core=new w(this))}Dummy(){}}class M{static Init(t){new M({id:t,colorCover:"#ff0000"}).Dummy()}constructor(t){this.expreeImageTool=void 0,this.expreeImageTool=new I(t)}Dummy(){}}class C{constructor(t){this.divHost=void 0,this.divHost=document.getElementById(t),M.Init(t)}destroy(){if(this.divHost)try{for(;this.divHost.firstChild;)this.divHost.removeChild(this.divHost.firstChild)}catch(t){console.error("Error in destroy method:",t)}else console.warn("divHost is undefined in destroy method")}}}}]);
//# sourceMappingURL=10288.1c3967e8.chunk.js.map