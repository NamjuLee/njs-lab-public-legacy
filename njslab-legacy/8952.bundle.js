"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[8952],{8952:(e,t,n)=>{n.r(t),n.d(t,{Implementations:()=>ms});var o,i,s,r=n(770),a=n(4527),h=function(e,t){void 0===e&&(e=""),void 0===t&&(t=""),this.content=e,this.font=t},c=function(e,t,n){this.sx=e,this.sy=t,this.sz=n},p=function(){function e(e,t,n,o,i){this.id=e,this.type=t,this.isSelected=n,this.isOver=o,this.isHidden=i,this.nodes=[],this.data={}}return e.prototype.pushNode=function(e){this.nodes=[];for(var t=0;t<e.length;++t)this.nodes.push(new c(e[t].x,e[t].y,e[t].z))},e.prototype.pushData=function(e,t){this.data=new h(e,t)},e}(),l=function(){function e(e){this.neighborShapes=[],this.numOrder=-1,this.offset=-2,this.isVisited=!1,this.isFixed=!1,this.isRenderable=!0,this.colA="rgba(0, 255, 0, 0.3)",this.colB="rgba(255, 0, 0, 0.3)",this.colC="rgba(0, 0, 0, 0.3)",this.cVec=new r.h9(0,0),this.isCollided=!1,this.isCollidable=!0,this.geoCollided=void 0,this.geo=e,this._minVec=new r.h9(e.vec.x-1,e.vec.y-1),this._maxVec=new r.h9(e.vec.x+1,e.vec.y+1)}return e.prototype.reset=function(){this.neighborShapes=[],this.numOrder=-1,this.geo.numVisit=0,this.isCollided=!1,this.isVisited=!1,this.geo.isCollapse=!1},e.prototype.updateBBox=function(){},Object.defineProperty(e.prototype,"minVec",{get:function(){return this._minVec},set:function(e){this._minVec.x=e.x-this.offset,this._minVec.y=e.y-this.offset},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxVec",{get:function(){return this._maxVec},set:function(e){this._maxVec.x=e.x+this.offset,this._maxVec.y=e.y+this.offset},enumerable:!1,configurable:!0}),e.prototype.updateByScale=function(e){this._minVec.x=this.geo.vec.x-this.geo.styleComponent.renderStyle.width*e*.25,this._maxVec.x=this.geo.vec.x+this.geo.styleComponent.renderStyle.width*e*.25,this._minVec.y=this.geo.vec.y-this.geo.styleComponent.renderStyle.height*e},e.prototype.update=function(){this.isFixed||(this.cVec.x=this._minVec.x+.5*(this._maxVec.x-this._minVec.x),this.cVec.y=this._minVec.y+.5*(this._maxVec.y-this._minVec.y))},e.prototype.render=function(e){this.geo.scene.annotationInstance.implementations.app.INSPECTION&&this.isRenderable&&(this.isCollided?e.fillStyle=this.colB:e.fillStyle=this.colA,this.isFixed&&(e.fillStyle=this.colC),e.beginPath(),e.rect(this.minVec.x,this.minVec.y,this.maxVec.x-this.minVec.x,this.maxVec.y-this.minVec.y),e.closePath(),e.fill())},e}(),d=function(){function e(e){this.host=e}return e.prototype.update=function(e){this.host.scene.annotationInstance.implementations.app.INSPECTION&&(e.font="10px Arial",this.showStatus(e))},e.prototype.showStatus=function(e){var t=this.host.vec;e.beginPath(),e.arc(t.x,t.y,5,0,6.28),e.closePath(),e.fillStyle="#ff0000",e.fill();var n="IsTransform: "+this.host.isTransform;e.fillText(n,t.x+10,t.y+10);var o="Type: "+this.host.type;e.fillText(o,t.x+100,t.y+10);var i="scale: "+this.host.scaleMap;e.fillText(i,t.x+10,t.y+25),e.fillStyle="#000000";var s="neighbors: "+this.host.collision.neighborShapes.length;e.fillText(s,t.x+100,t.y+25)},e}(),u=(o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},o(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),y=function(e){function t(t){var n=e.call(this)||this;return n.isFill=!1,n.isGhost=!1,n.isTransformValue=!1,n.needEmitRemoveByBlackhole=!0,n.numVisit=0,n.scaleMap=1,n.scaleForRender=1,n.isRenderCollapse=!1,n.timePopupDelay=100,n.vecSelectedSnapping=void 0,n.disableValue=!1,n.sizeValue=r.$u.MEDIUM,n.textLeaderlineValue=void 0,n.scene=t,n.scene.addGeometry(n),n.vec=(0,r.hW)(),n.id=n.scene.getUUID(),n.hashColor=n.scene.getHashColor(n),n.isRemove=!1,n.isHoverValue=!1,n.isGeoPos=!1,n.isSelectedValue=!1,n.isPinValue=!0,n.isSelectable=!0,n.isRenderable=!1,n.isMovableValue=!0,n.isDraggable=!1,n.isLeave=!1,n.isInsideExtent=!0,n.isHiddenValue=!1,n.isHiddenPre=!1,n.isAniEasing=!1,n.isAniAccel=!1,n.isCapturedValue=!1,n.isMovedValue=!1,n.isUnderConstruction=!0,n.isVisited=!1,n.isGrayColor=!1,n.isDrop=!1,n.isDrag=!1,n.isSelectedValue=!1,n.needEmitHoverPost=!0,n.isHoverValue=!1,n.enableEditValue=!1,n.hasSound=!1,n.vecsHistory=[],n.trajectoryVecs=[],n.zoomDisX=0,n.zoomDisY=0,n.isZoomStart=!0,n.needEmit=!0,n.isUndo=!0,n.ghostPopupOffset=5,n.scaleForRender=1,n.visibilityValue=1,n.needBlackhole=!1,n.inspector=new d(n),n.collision=new l(n),n.initScale(),n}return u(t,e),t.prototype.getNode=function(){var e=[];return e.push(this.vec),e},t.prototype.getArea=function(){return Number.MAX_SAFE_INTEGER},t.prototype.toJSON=function(){var e=new p(this.id,this.type,this.isSelectedValue,this.isHoverValue,this.isHiddenValue);return e.pushNode(this.getNode()),e},t.prototype.isSelectedByWindow=function(e){return(0,r.X0)(this.vec,e)},t.prototype.isSelectedByCrossing=function(e){return(0,r.vD)(this.vec,5,5,e)},t.prototype.isMouseInsideSnapFrom=function(e){},Object.defineProperty(t.prototype,"v",{get:function(){return this.vec},set:function(e){this.vec=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isHidden",{get:function(){return this.isHiddenValue},set:function(e){this.isHiddenPre=this.isHiddenValue,this.isHiddenValue=e,this.scene.annotationInstance.io.eventListenerAnnotation.hideStack(this.toJSON())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this.sizeValue},set:function(e){this.sizeValue=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isMovable",{get:function(){return this.isMovableValue},set:function(e){this.isMovableValue=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isHover",{get:function(){return this.isHoverValue},set:function(e){e||(this.needEmitHoverPost=!0),this.isHoverValue=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"visibility",{get:function(){return this.visibilityValue},set:function(e){this.visibilityValue=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isCollapse",{get:function(){return this.isRenderCollapse},set:function(e){this.isRenderCollapse=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"textLeaderline",{get:function(){return this.textLeaderlineValue},set:function(e){e!==this.textLeaderlineValue&&(e&&this.textLeaderlinePost(e)||(this.textLeaderlineValue&&e&&this.textLeaderlineValue.removeLeaderline(),this.textLeaderlineValue=e))},enumerable:!1,configurable:!0}),t.prototype.updateColor=function(e){this.styleComponent.updateColor(e)},t.prototype.textLeaderlinePost=function(e){return!1},t.prototype.updateLeaderlineSnap=function(e,t){},Object.defineProperty(t.prototype,"isPin",{get:function(){return this.isPinValue},set:function(e){this.isPinValue=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isSelected",{get:function(){return this.isSelectedValue},set:function(e){this.isSelectedValue=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isCaptured",{get:function(){return this.isCapturedValue},set:function(e){this.isCapturedValue=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isEditiable",{get:function(){return this.enableEditValue},set:function(e){this.enableEditValue=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isTransform",{get:function(){return this.isTransformValue},set:function(e){this.isTransformValue=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isMove",{get:function(){return this.isMovedValue},set:function(e){this.isMovedValue=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"disable",{get:function(){return this.disableValue},set:function(e){this.disableValue=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasPopup",{get:function(){return this.hasPopupValue},set:function(e){this.hasPopupValue=e},enumerable:!1,configurable:!0}),t.prototype.getNodePopup=function(){},t.prototype.getBoundary=function(){return[this.vec]},t.prototype.updateActiveCursor=function(){},t.prototype.showPopupSummary=function(){var e=this;if(this.scene.annotationInstance.activeCommandController.needPopup()&&!this.hasPopupValue&&!this.isGhost){if(this.hasPopupValue=!0,this.popup=document.createElement("div"),this.popup.id="pa-"+this.id,this.popup.style.position="absolute",this.popup.style.zIndex="1000",this.popup.style.height="0px",this.popup.style.width="0px",this.popup.style.backgroundColor="red",this.scene.annotationInstance.implementations.app.model.modelViewWrapper.div.appendChild(this.popup),this.type===r.zq.POLYLINE||this.type===r.zq.POLYLINE_BENDING||this.type===r.zq.POLYGON||this.type===r.zq.RECTANGLE||this.type===r.zq.CIRCLE){var t=this.getNodePopup();this.popup.style.top=t.vec.y+"px",this.popup.style.left=t.vec.x+"px"}else this.popup.style.top=this.vec.y+"px",this.popup.style.left=this.vec.x+"px";this.showPopupStackTimer&&clearTimeout(this.showPopupStackTimer),this.showPopupStackTimer=setTimeout((function(){e.popup&&e.scene.annotationInstance.io.eventListenerAnnotation.showPopupStack(e.toJSON())}),this.timePopupDelay)}},t.prototype.getVecs=function(){return[this.vec]},t.prototype.hidePopUpSummary=function(){if(this.popup&&this.popup.parentNode){if(this.renderer.tOverPopupSummary=0,this.popup.parentNode.removeChild(this.popup),this.type===r.zq.CNODE){var e=new p(this.id,this.type,this.isSelectedValue,this.isHoverValue,this.isHiddenValue);e.pushNode(this.getNode()),this.scene.annotationInstance.io.eventListenerAnnotation.hidePopupStack(e)}else this.scene.annotationInstance.io.eventListenerAnnotation.hidePopupStack(this.toJSON());this.hasPopupPre=!1,this.popup=void 0,this.hasPopupValue=!1}},t.prototype.needSnapping=function(e){return[(0,r.Sp)(this.vec,e),this.vec]},t.prototype.getVecForSnapping=function(){return this.vec},t.prototype.move=function(e,t){!this.isRemove&&this.isRenderable&&this.isHiddenValue},t.prototype.activateEasing=function(e,t){},t.prototype.easing=function(){},t.prototype.accelerating=function(){},t.prototype.findClosestNode=function(e,t){},t.prototype.renderPre=function(e){this.styleComponent.renderStyle.scaleGlobal=this.scene.annotationInstance.activeCommandController.scaleGlobal},t.prototype.setDash=function(e){return this.styleComponent.setDash(e)},t.prototype.updateBoundingBox=function(){},t.prototype.mouseDoubleClick=function(){},t.prototype.outExtent=function(){},t.prototype.inExtent=function(){},t.prototype.updateTheme=function(){},t.prototype.updateStyle=function(e){},t.prototype.updateStyleCustom=function(e){return this.styleComponent.updateStyleCustom(e)},t.prototype.initScale=function(e){this.scene.annotationInstance.activeCommandController.acProperties.activateMapScale&&(this.scaleMap=e||this.scene.annotationInstance.activeCommandController.acProperties.mapScale)},t.prototype.setScaleLocal=function(e){this.styleComponent.renderStyle.scaleLocal=e,this.scene.annotationInstance.graphicsCoreWrapper.renderForce()},t.prototype.updateScaleByZoomLevel=function(){if(this.scene.annotationInstance.activeCommandController.acProperties.activateMapScale){var e=this.scaleMap/this.scene.annotationInstance.activeCommandController.acProperties.mapScale;this.scene.annotationInstance.activeCommandController.acProperties.isScaleDynamicRender?this.scaleForRender=e>1?1:e<.05?0:e:this.scaleForRender=1}},t.prototype.render=function(e){this.renderPre(e),Number.isNaN(this.vec.x)?this.outExtent():this.inExtent(),!this.isRemove&&this.isRenderable&&(this.isHiddenValue&&this.visibilityValue<.01||(this.isAniEasing&&this.easing(),this.isAniAccel&&this.accelerating(),this.isUndo&&this.renderer&&(this.renderer.t=1,this.renderer.tDown1=1,this.renderer.tDown2=1),this.needBlackhole&&this.removeByBlackhole(),this.isMoveUpdate(),this.updatePopup(),this.updateHoverPost(),this.scene.annotationInstance.activeCommandController.acProperties.needCollisionDetection,this.renderPost(e)))},t.prototype.updatePopup=function(){if(this.hasPopupValue&&void 0!==this.popup)if(this.hasGhostPopup)this.popup.style.top=this.vec.y-this.scene.annotationInstance.customization.themeCurrent.nPoint.height-this.ghostPopupOffset+"px",this.popup.style.left=this.vec.x+"px";else if(this.type===r.zq.POLYLINE||this.type===r.zq.POLYLINE_BENDING||this.type===r.zq.POLYGON||this.type===r.zq.RECTANGLE||this.type===r.zq.CIRCLE){var e=this.getNodePopup();this.popup.style.top=e.vec.y+"px",this.popup.style.left=e.vec.x+"px"}else this.popup.style.top=this.vec.y+"px",this.popup.style.left=this.vec.x+"px"},t.prototype.updateHoverPost=function(){this.renderer.tOverPopupSummary>.2&&this.needEmitHoverPost&&(this.showPopupSummary(),this.emitHoverPostStack(),this.needEmitHoverPost=!1)},t.prototype.isMoveUpdate=function(){this.type!==r.zq.ANODE&&this.type!==r.zq.ANODE_CIRCLE&&this.type!==r.zq.ANODE_NGON&&this.type!==r.zq.ANODE_RECT&&this.type!==r.zq.ANODE_TEXT&&this.type!==r.zq.AMIDPOINT&&(this.vecsHistory.length<1||((0,r.$5)(this.vecsHistory[this.vecsHistory.length-1],this.vec)?this.isMove=!1:(this.isMove=!0,this.isTransform=!0)))},t.prototype.initVecsHistory=function(){this.vecsHistory=[],this.vecsHistory.push((0,r.p$)(this.vec),(0,r.p$)(this.vec),(0,r.p$)(this.vec))},t.prototype.updateVecsHistory=function(){for(this.vecsHistory.push((0,r.p$)(this.vec));this.vecsHistory.length>3;)this.vecsHistory.shift()},t.prototype.deepCopy=function(e,t,n){void 0===n&&(n=0)},t.prototype.goToBlackhole=function(){},t.prototype.updatePostTransformation=function(){},t.prototype.fromJSON=function(e){},t.prototype.dummy=function(){},t.prototype.removeByBlackhole=function(){(0,r.CV)([this.scene.annotationInstance.renderer.blackhole.v.x,this.scene.annotationInstance.renderer.blackhole.v.y,this.scene.annotationInstance.renderer.blackhole.v.z],[this.vec.x,this.vec.y,this.vec.z])<10&&this.remove(this.needEmitRemoveByBlackhole)},t.prototype.mouseLeftClick=function(e,t){},t.prototype.mouseRightClick=function(e){},t.prototype.mouseUp=function(){},t.prototype.emitAddStack=function(){this.scene.annotationInstance.io.eventListenerAnnotation.addGeometryStack(this.toJSON())},t.prototype.emitHoverPostStack=function(){this.scene.annotationInstance.io.eventListenerAnnotation.hoverPostStack(this.toJSON())},t.list=[],t}((function(){})),m=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),v=function(e){function t(t,n,o,i,s,a){void 0===n&&(n=0),void 0===o&&(o=0),void 0===i&&(i=0),void 0===s&&(s=r.zq.APOINT),void 0===a&&(a=5);var h=e.call(this,t)||this;return h.isLineNetwork=!1,h.vec=new r.h9(n,o,i),h.trajectoryVecs=[],h.edges=[],h.nodes=[],h.r=a,h.rOrigin=a,h.rTarget=a+10,h.weightLeft=0,h.weightRight=0,h.type=s,h.isMid=!1,h.isGeoPos=!0,h.isPointMid=!1,h.isAniUp=!0,h.hasPopupValue=!1,h.scene.addBasePoint(h),h.isUnderConstruction=!1,h.visTrajector=!0,h.collision.isFixed=!0,h.scaleForRender=1,h.updateBoundingBox(),h.initVecsHistory(),h.initScale(),h.init(),h}return m(t,e),t.mouseRightClick=function(e){},t.mouseMiddleClick=function(e){},t.mouseLeftClick=function(e,t,n){},t.onMouseMove=function(e){},t.mouseDrag=function(e){},t.mouseUp=function(e){},t.prototype.init=function(){},t.prototype.update=function(e){void 0===e&&(e=!1),e?this.updatePostTransformation():1===this.scene.annotationInstance.graphicsCoreWrapper.canvasWrapper.aCanvas.canvasLoopController.level&&this.isPinValue&&(this.updateScreenVecForPan(),this.updatePostTransformation())},t.prototype.updateScreenVecForPan=function(){this.updateScaleByZoomLevel()},t.prototype.getParentType=function(){return"APointBase"},t.prototype.distance=function(e,t){return Math.sqrt((this.vec.x-e)*(this.vec.x-e)+(this.vec.y-t)*(this.vec.y-t))},t.prototype.addEdge=function(e){-1===this.edges.indexOf(e)&&this.edges.push(e)},t.prototype.removeEdge=function(e){},t.prototype.activateEasing=function(e,t){this.scene.annotationInstance.scene.capture=void 0,this.tVec=new r.h9(e.x,e.y,0),this.isAniEasing=!0},t.prototype.easing=function(){this.isAniEasing&&(this.vec=(0,r.PD)((0,r.bA)(this.vec,.95),(0,r.bA)(this.tVec,.05)),(0,r.Sp)(this.vec,this.tVec)<1&&(this.isAniEasing=!1))},t.prototype.accelerating=function(){this.vec=(0,r.PD)((0,r.bA)(this.vec,.9),(0,r.bA)(this.tVec,.1)),(0,r.Sp)(this.vec,this.tVec)<1&&(this.isAniEasing=!1),this.renderer.t+=.01},Object.defineProperty(t.prototype,"isPin",{get:function(){return this.isPinValue},set:function(e){this.isPinValue=e},enumerable:!1,configurable:!0}),t.prototype.remove=function(){},t.prototype.move=function(e,t){this.vec.x=e,this.vec.y=t},t.prototype.isMouseInside=function(e,t){return!(this.isRemove||!this.isRenderable||this.isHiddenValue)&&this.distance(e,t)<=this.r*this.scaleForRender+3*this.scaleForRender},t.prototype.deepCopy=function(e,n,o){void 0===e&&(e=this.vec.x),void 0===n&&(n=this.vec.y),void 0===o&&(o=this.vec.z);var i=new t(this.scene,e,n,this.vec.z,this.type,this.r);if(i)return i},Object.defineProperty(t.prototype,"v",{get:function(){return this.vec},set:function(e){this.vec=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isHover",{get:function(){return this.isHoverValue},set:function(e){this.isHoverValue=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isSelected",{get:function(){return this.isSelectedValue},set:function(e){this.isSelectedValue=e},enumerable:!1,configurable:!0}),t.prototype.getLog=function(){return"GUID : "+this.id+"/TYPE : "+this.type.toString()+"/Screen : /SIZE : "+this.r+" pixel/CONNE :"+this.edges.length.toString()+"/IsCap :"+this.isCapturedValue+"/IsSEL : "+this.isSelectedValue+"/IsHid : "+this.isHiddenValue+"/IsDeg : "+this.isDrag+"/isSelable : "+this.isSelectable+"/hasTextLeaderline : "+this.textLeaderline},t.prototype.getLogDOM=function(){return"Geometry ID : "+this.id+'<br>geometry Type : APointBase" <br>position : <br>size : '+this.r+" pixel<br>type : "+this.type+"<br>isSelected : "+this.isSelectedValue+"<br>isSelectable : "+this.isSelectable+"<br>"},t.prototype.goToBlackhole=function(){this.needBlackhole=!0,this.tVec=this.scene.annotationInstance.renderer.blackhole.v,this.isAniAccel=!0},t.prototype.hide=function(){this.isSelectable=!1,this.isRenderable=!1},t.prototype.translateByMouseEventData=function(e){this.isRemove||!this.isRenderable||this.isHiddenValue||this.isGhost||(this.vec.x+=e.x-e.preX,this.vec.y+=e.y-e.preY,this.isDrag=!0,this.textLeaderline&&(this.textLeaderline.translateByMouseEventData(e),this.textLeaderline&&this.textLeaderline.leaderline&&(this.textLeaderline.leaderline.v2.x=this.vec.x,this.textLeaderline.leaderline.v2.y=this.vec.y)),this.updatePostTransformation())},t.prototype.translate=function(e,t){},t.prototype.getNode=function(){var e=[];return e.push(this.vec),e},t.prototype.toJSON=function(){if(!this.isGhost&&this.type!==r.zq.ANODE&&this.type!==r.zq.ANODE_CIRCLE&&this.type!==r.zq.AMIDPOINT&&this.type!==r.zq.AN_GON&&this.type!==r.zq.ANODE_RECT){var e=new p(this.id,this.type,this.isSelectedValue,this.isHoverValue,this.isHiddenValue);this.type===r.zq.POINT_REGULAR&&this.styleComponent.renderStyle.url&&(e.data={url:this.styleComponent.renderStyle.url}),e.pushNode(this.getNode());var t=this.styleComponent.toJson();return t&&(e.styles=t),e}},t.prototype.getIOGeometry=function(){return this.toJSON()},t.prototype.visTrajectory=function(e,t){this.trajectoryVecs.push(t),this.trajectoryVecs.length>6&&this.trajectoryVecs.shift()},t.prototype.outExtent=function(){this.isInsideExtent&&(this.hasPopup&&(this.hidePopUpSummary(),this.hasPopupPre=!0),this.isInsideExtent=!1)},t.prototype.inExtent=function(){this.isInsideExtent||(this.hasPopupPre&&this.showPopupSummary(),this.isInsideExtent=!0)},t.prototype.renderPost=function(e){},t.prototype.updateDivPos=function(){},t.prototype.updatePostTransformation=function(){this.updateBoundingBox()},Object.defineProperty(t.prototype,"disable",{set:function(e){this.disableValue=e,this.disableValue?this.isSelectedValue=!1:this.isSelectedValue=!0},enumerable:!1,configurable:!0}),t}(y),g=function(){function e(e){this.value=0,this.tOpacityA=0,this.tOpacityB=0,this._opacity=1,this.host=e,this.host.styleComponent.renderStyle.colorInterpolated&&this.interpolateColor()}return e.prototype.update=function(){this.interpolateColor(),this.updateVauleNormalized(),this.host.styleComponent.renderStyle.interpolationNum=this._opacity},e.prototype.updateVauleNormalized=function(){this.host.scene.annotationInstance.renderer.needFocus?(this._opacity-=this.value,this._opacity=this._opacity<.4?.4:this._opacity):(this._opacity+=this.value,this._opacity=this._opacity>1?1:this._opacity)},e.prototype.interpolateColor=function(){if(!this.host.scene.annotationInstance.renderer.needFocus||this.host.isHover||this.host.isSelected){if(this.tOpacityA+=this.host.scene.annotationInstance.customization.themeCurrent.properties.timeTransitionA,this.tOpacityB=0,this.value=this.tOpacityA,this.tOpacityA<1){var e=(0,r.Hq)(this.host.styleComponent.renderStyle.colorInterpolated.getArray(),this.host.styleComponent.renderStyle.colorA.getArray(),this.tOpacityA);this.host.styleComponent.renderStyle.colorInterpolated.r=e[0],this.host.styleComponent.renderStyle.colorInterpolated.g=e[1],this.host.styleComponent.renderStyle.colorInterpolated.b=e[2],this.host.styleComponent.renderStyle.colorInterpolated.a=e[3],this.value=this.tOpacityA}}else this.tOpacityA=0,this.tOpacityB+=this.host.scene.annotationInstance.customization.themeCurrent.properties.timeTransitionB,this.value=this.tOpacityB,this.tOpacityB<1&&(e=(0,r.Hq)(this.host.styleComponent.renderStyle.colorInterpolated.getArray(),this.host.styleComponent.renderStyle.colorB.getArray(),this.tOpacityB),this.host.styleComponent.renderStyle.colorInterpolated.r=e[0],this.host.styleComponent.renderStyle.colorInterpolated.g=e[1],this.host.styleComponent.renderStyle.colorInterpolated.b=e[2],this.host.styleComponent.renderStyle.colorInterpolated.a=e[3],this.value=this.tOpacityB)},Object.defineProperty(e.prototype,"opacity",{get:function(){return this._opacity},enumerable:!1,configurable:!0}),e}(),f=function(){function e(e){this.host=e,this.incrementTimePopupSummary=.02}return e.prototype.update=function(){this.host.geo.isDrag?(this.host.tUp+=.5*this.host.geo.scene.annotationInstance.renderer.dt,this.host.tDown2=0):(this.host.geo.isSelectedValue?(this.host.tOver+=this.host.geo.scene.annotationInstance.renderer.dt,this.host.tDown1=0,this.host.geo.isHoverValue?this.host.tOverPopupSummary+=this.incrementTimePopupSummary:this.host.tOverPopupSummary=0,this.host.geo.isLeave=!0):this.host.geo.isHoverValue?(this.host.tOver+=.5*this.host.geo.scene.annotationInstance.renderer.dt,this.host.tOverPopupSummary+=this.incrementTimePopupSummary,this.host.tDown1=0,this.host.geo.isLeave=!0):this.host.geo.isLeave&&!this.host.geo.isDrag?(this.host.tDown1+=this.host.geo.scene.annotationInstance.renderer.dt,this.host.tOver=this.host.tOverPopupSummary=0,this.host.tDown1>.15&&(this.host.geo.isLeave=!1)):this.host.geo.isDrag||(this.host.tDown1+=this.host.geo.scene.annotationInstance.renderer.dt,this.host.tOver=this.host.tOverPopupSummary=0),this.host.tUp=0,this.host.tDown2+=.01),this.host.t+=.01},e.prototype.updatePopupSummery=function(){this.host.geo.isDrag||(this.host.geo.isSelectedValue?this.host.geo.isHoverValue?this.host.tOverPopupSummary+=this.incrementTimePopupSummary:this.host.tOverPopupSummary=0:this.host.geo.isHoverValue?this.host.tOverPopupSummary+=this.incrementTimePopupSummary:this.host.geo.isLeave&&!this.host.geo.isDrag?(this.host.tOverPopupSummary=0,this.host.tDown1>.15&&(this.host.geo.isLeave=!1)):this.host.geo.isDrag||(this.host.tOverPopupSummary=0))},e}(),C=function(){function e(e){this.t=0,this.tOver=0,this.tOverPopupSummary=0,this.tDown1=0,this.tDown2=0,this.tUp=0,this.geo=e,this.timer=new f(this),this.interpolateColor=new g(this.geo),this.geo.isRenderable=!0}return e.prototype.renderPost=function(e){},e}(),S=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),A=function(e){function t(t){var n=e.call(this,t)||this;return n.host=t,n}return S(t,e),t.prototype.renderPost=function(e){if(this.timer.update(),this.host.scaleForRender=this.host.scene.annotationInstance.graphicsCoreWrapper.scaleScreenByRatioImageSize,e.lineCap=r.cg.Butt,this.host.scene.annotationInstance.implementations.app.model.appCoreWrapper.appControllerStatus.mode===r.An.Drawing&&!this.host.isUnderConstruction&&this.host.type!==r.zq.APOINT_PATH){this.host.scene.annotationInstance.activeCommandController.acProperties.pressESC&&this.host.isDrag&&(this.host.isDrag=!1);var t=this.host.scene.annotationInstance.geometryCommon.gcmdSupporting.toScreenVecOnCropping(this.host.vec);this.host.type===r.zq.AMIDPOINT?1<this.tOver||this.host.isHoverValue||this.host.isSelectedValue?this.host.scene.annotationInstance.renderer.draw.shape.node.nodeMidHover(e,this.host.styleComponent.renderStyle,t.x,t.y,this.host.scaleForRender,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(2*this.tOver),this.host.isSelectedSole):this.host.edges[0]&&(this.host.edges[0].type!==r.zq.ARROW_SINGLE&&this.host.edges[0].type!==r.zq.ARROW_DOUBLE||this.host.scene.annotationInstance.renderer.draw.shape.node.nodeMidHoverForArrow(e,this.host.styleComponent.renderStyle,t.x,t.y,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(2*this.tOver),this.geo.scene.annotationInstance.customization.themeCurrent.node.sizeMid*this.host.scaleForRender,this.host.isSelectedSole,this.host.edges[0].styleComponent.state.themeColorId)):1<this.tOver?this.host.isHoverValue||this.host.isSelectedValue?this.host.scene.annotationInstance.renderer.draw.shape.node.nodeHover(e,this.host.styleComponent.renderStyle,t.x,t.y,this.host.scaleForRender,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(2*this.tOver)):this.host.scene.annotationInstance.renderer.draw.shape.node.node(e,this.host.styleComponent.renderStyle,t.x,t.y,this.host.scaleForRender):!this.host.edges[0]||this.host.edges[0].type!==r.zq.ARROW_SINGLE&&this.host.edges[0].type!==r.zq.ARROW_DOUBLE?this.host.scene.annotationInstance.renderer.draw.shape.node.nodeStart(e,this.host.styleComponent.renderStyle,t.x,t.y,this.host.scaleForRender,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(2*this.tOver)):this.host.scene.annotationInstance.renderer.draw.shape.node.nodeStart(e,this.host.styleComponent.renderStyle,t.x,t.y,this.host.scaleForRender,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(2*this.tOver),this.host.edges[0].styleComponent.state.themeColorId),this.host.isSelectedSole&&this.host.type===r.zq.ANODE?(this.host.scene.annotationInstance.renderer.draw.shape.node.nodeSelected(e,this.host.styleComponent.renderStyle,t.x,t.y,this.host.scaleForRender),this.host.tSelectedSole+=.01):this.host.tSelectedSole=0,this.t+=this.host.scene.annotationInstance.renderer.dt}},t}(C);!function(e){e.Small="small",e.Large="large",e.Continuous="continuous"}(i||(i={})),function(e){e.ThemeColor1="themeColor1",e.ThemeColor2="themeColor2",e.ThemeColor3="themeColor3",e.BackgroundColor="backgroundColor",e.TitleColor="titleColor",e.AccentColor1="accentColor1"}(s||(s={}));var P,w=function(){function e(e,t,n,o){void 0===o&&(o=1),this.updateByRGBA(e,t,n,o)}return e.fromHex=function(t,n){void 0===n&&(n=1);var o=(0,r.rW)(t,n);return new e(o[0],o[1],o[2],o[3])},e.fromRGBA=function(t,n,o,i){return void 0===i&&(i=1),new e(t,n,o,i)},e.toHex=function(e){return(0,r.iC)(e.r,e.g,e.b)},e.prototype.updateByRGBA=function(e,t,n,o){void 0===o&&(o=1),this._r=e,this._g=t,this._b=n,this._a=o,this.updateString()},Object.defineProperty(e.prototype,"r",{get:function(){return this._r},set:function(e){this._r=e,this.updateString()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"g",{get:function(){return this._g},set:function(e){this._g=e,this.updateString()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"b",{get:function(){return this._b},set:function(e){this._b=e,this.updateString()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"a",{get:function(){return this._a},set:function(e){this._a=e,this.updateString()},enumerable:!1,configurable:!0}),e.prototype.normaliz=function(){return this.r/=255,this.g/=255,this.b/=255,this},e.prototype.deepCopy=function(){return new e(this._r,this._g,this._b,this._a)},e.prototype.getArray=function(){return[this._r,this._g,this._b,this._a]},e.prototype.toRBGA_String=function(){return this.rgnaStringValue},e.prototype.updateString=function(){this.rgnaStringValue="rgba("+this._r+", "+this._g+", "+this._b+", "+this._a+")"},e}(),x=function(){function e(e){this.width=32,this.height=32,this.scaleLocal=1,this.scaleGlobal=1,this._url=void 0,this._lineCap=r.cg.Round,this._dash=[],this._size=r.$u.MEDIUM,e&&(this.styleComponent=e,this.scaleGlobal=e.geo.scene.annotationInstance.activeCommandController.scaleGlobal),this._colorFillFirst=new w(0,0,0),this._colorFillSecond=new w(0,0,0),this._colorStrokeFirst=new w(0,0,0),this._colorStrokeSecond=new w(0,0,0),this._lineWidth=3}return e.updateRenderStyleRPoint=function(e,t){var n=t.rPoint;e._colorFillFirst.updateByRGBA(n.fillStyleFirstArray[0],n.fillStyleFirstArray[1],n.fillStyleFirstArray[2],n.fillStyleFirstArray[3]),e._colorFillSecond.updateByRGBA(n.fillStyleSecondArray[0],t.rPoint.fillStyleSecondArray[1],t.rPoint.fillStyleSecondArray[2],t.rPoint.fillStyleSecondArray[3]),e._lineWidth=t.rPoint.lineWidth,e.width=t.rPoint.width,e.height=t.rPoint.height,e.initInterpolation(t.properties.desaturationValue)},e.updateRenderColorRPointCustom=function(e,t,n){e._colorFillFirst.updateByRGBA(n[0],n[1],n[2],n[3]),e._colorFillSecond.updateByRGBA(n[0],n[1],n[2],t.properties.opacity),e._lineWidth=t.rPoint.lineWidth,e.width=t.rPoint.width,e.height=t.rPoint.height,e.initInterpolation(t.properties.desaturationValue)},e.updateRenderStyleNPoint=function(e,t){var n=t.nPoint;e._colorFillFirst.updateByRGBA(n.fillStyleFirstArray[0],n.fillStyleFirstArray[1],n.fillStyleFirstArray[2],n.fillStyleFirstArray[3]),e._colorFillSecond.updateByRGBA(n.fillStyleSecondArray[0],n.fillStyleSecondArray[1],n.fillStyleSecondArray[2],n.fillStyleSecondArray[3]),e._lineWidth=t.nPoint.lineWidth,e.width=t.nPoint.width,e.height=t.nPoint.height,e.initInterpolation(t.properties.desaturationValue)},e.updateRenderColorNPoint=function(e,t,n){e._colorFillFirst.updateByRGBA(n[0],n[1],n[2],n[3]),e._colorFillSecond.updateByRGBA(n[0],n[1],n[2],t.properties.opacity+.5),e.initInterpolation(t.properties.desaturationValue)},e.updateRenderStylePolyline=function(e,t){var n=t.polyline;e._colorStrokeFirst.updateByRGBA(n.strokeStyleFirstArray[0],n.strokeStyleFirstArray[1],n.strokeStyleFirstArray[2],n.strokeStyleFirstArray[3]),e._colorStrokeSecond.updateByRGBA(n.strokeStyleSecondArray[0],n.strokeStyleSecondArray[1],n.strokeStyleSecondArray[2],n.strokeStyleSecondArray[3]),e._lineWidth=t.polyline.lineWidth,e.initInterpolationStroke(t.properties.desaturationValue)},e.updateRenderColorPolyline=function(e,t,n){e._colorStrokeFirst.updateByRGBA(n[0],n[1],n[2],n[3]),e._colorStrokeSecond.updateByRGBA(n[0],n[1],n[2],t.properties.opacity+.5),e._lineWidth=t.polyline.lineWidth,e.initInterpolationStroke(t.properties.desaturationValue)},e.updateRenderStylePolylineNode=function(e,t){var n=t.polyline;e._colorStrokeFirst.updateByRGBA(n.strokeStyleFirstArray[0],n.strokeStyleFirstArray[1],n.strokeStyleFirstArray[2],n.strokeStyleFirstArray[3]),e._colorStrokeSecond.updateByRGBA(n.strokeStyleSecondArray[0],n.strokeStyleSecondArray[1],n.strokeStyleSecondArray[2],n.strokeStyleSecondArray[3]),e._lineWidth=t.polyline.lineWidth,t.properties.isDarkBG?e._colorFillFirst.updateByRGBA(0,0,0,1):e._colorFillFirst.updateByRGBA(255,255,255,1),e.initInterpolation(t.properties.desaturationValue)},e.updateRenderColorPolylineNode=function(e,t,n){e._colorStrokeFirst.updateByRGBA(n[0],n[1],n[2],n[3]),e._colorStrokeSecond.updateByRGBA(n[0],n[1],n[2],t.properties.opacity+.5),e._lineWidth=t.polyline.lineWidth,t.properties.isDarkBG?e._colorFillFirst.updateByRGBA(0,0,0,1):e._colorFillFirst.updateByRGBA(255,255,255,1),e.initInterpolation(t.properties.desaturationValue)},e.updateRenderStylePolylineCustom=function(e,t,n){e._colorStrokeFirst.updateByRGBA(n[0],n[1],n[2],n[3]),e._colorStrokeSecond.updateByRGBA(n[0],n[1],n[2],t.properties.opacity),e._lineWidth=t.polyline.lineWidth,e.initInterpolationStroke(t.properties.desaturationValue)},e.updateRenderStylePolylineNodeCustom=function(e,t,n){e._colorStrokeFirst.updateByRGBA(n[0],n[1],n[2],n[3]),e._colorStrokeSecond.updateByRGBA(n[0],n[1],n[2],t.properties.opacity),e._lineWidth=t.polyline.lineWidth,t.properties.isDarkBG?e._colorFillFirst.updateByRGBA(0,0,0,1):e._colorFillFirst.updateByRGBA(255,255,255,1),e.initInterpolation(t.properties.desaturationValue)},e.updateRenderStyleArrow=function(e,t){var n=t.arrow;e._colorFillFirst.updateByRGBA(n.fillStyleFirstArray[0],n.fillStyleFirstArray[1],n.fillStyleFirstArray[2],n.fillStyleFirstArray[3]),e._colorFillSecond.updateByRGBA(n.fillStyleSecondArray[0],n.fillStyleSecondArray[1],n.fillStyleSecondArray[2],n.fillStyleSecondArray[3]),e._colorStrokeFirst.updateByRGBA(n.strokeStyleFirstArray[0],n.strokeStyleFirstArray[1],n.strokeStyleFirstArray[2],n.strokeStyleFirstArray[3]),e._colorStrokeSecond.updateByRGBA(n.strokeStyleSecondArray[0],n.strokeStyleSecondArray[1],n.strokeStyleSecondArray[2],n.strokeStyleSecondArray[3]),e._lineWidth=n.lineWidth,e.initInterpolationStroke(t.properties.desaturationValue)},e.updateRenderStyleArrowNode=function(e,t){var n=t.arrow;e._colorStrokeFirst.updateByRGBA(n.strokeStyleFirstArray[0],n.strokeStyleFirstArray[1],n.strokeStyleFirstArray[2],n.strokeStyleFirstArray[3]),e._colorStrokeSecond.updateByRGBA(n.strokeStyleSecondArray[0],n.strokeStyleSecondArray[1],n.strokeStyleSecondArray[2],n.strokeStyleSecondArray[3]),e._lineWidth=n.lineWidth,t.properties.isDarkBG?e._colorFillFirst.updateByRGBA(0,0,0,1):e._colorFillFirst.updateByRGBA(255,255,255,1),e.initInterpolation(t.properties.desaturationValue)},e.updateRenderStyleArrowCustom=function(e,t,n){var o=n.colorRgba;e._colorFillFirst.updateByRGBA(o[0],o[1],o[2],o[3]),e._colorFillSecond.updateByRGBA(o[0],o[1],o[2],t.properties.opacity+.5),e._colorStrokeFirst.updateByRGBA(o[0],o[1],o[2],o[3]),e._colorStrokeSecond.updateByRGBA(o[0],o[1],o[2],t.properties.opacity),e._lineWidth=n.width,e.initInterpolationStroke(t.properties.desaturationValue)},e.updateRenderColorArrowCustom=function(e,t,n){e._colorFillFirst.updateByRGBA(n[0],n[1],n[2],n[3]),e._colorFillSecond.updateByRGBA(n[0],n[1],n[2],t.properties.opacity+.5),e._colorStrokeFirst.updateByRGBA(n[0],n[1],n[2],n[3]),e._colorStrokeSecond.updateByRGBA(n[0],n[1],n[2],t.properties.opacity),e._lineWidth=t.arrow.lineWidth,e.initInterpolationStroke(t.properties.desaturationValue)},e.updateRenderStyleArrowNodeCustom=function(e,t,n){var o=n.colorRgba;e._colorStrokeFirst.updateByRGBA(o[0],o[1],o[2],o[3]),e._colorStrokeSecond.updateByRGBA(o[0],o[1],o[2],o[3]),e._lineWidth=n.width,t.properties.isDarkBG?e._colorFillFirst.updateByRGBA(0,0,0,1):e._colorFillFirst.updateByRGBA(255,255,255,1),e.initInterpolation(t.properties.desaturationValue)},e.updateRenderColorArrowNodeCustom=function(e,t,n){e._colorStrokeFirst.updateByRGBA(n[0],n[1],n[2],n[3]),e._colorStrokeSecond.updateByRGBA(n[0],n[1],n[2],n[3]),t.properties.isDarkBG?e._colorFillFirst.updateByRGBA(0,0,0,1):e._colorFillFirst.updateByRGBA(255,255,255,1),e.initInterpolation(t.properties.desaturationValue)},e.updateRenderStylePolygon=function(e,t){var n=t.polygon;e._colorFillFirst.updateByRGBA(n.fillStyleFirstArray[0],n.fillStyleFirstArray[1],n.fillStyleFirstArray[2],n.fillStyleFirstArray[3]),e._colorFillSecond.updateByRGBA(n.fillStyleSecondArray[0],n.fillStyleSecondArray[1],n.fillStyleSecondArray[2],n.fillStyleSecondArray[3]),e._colorStrokeFirst.updateByRGBA(n.strokeStyleFirstArray[0],n.strokeStyleFirstArray[1],n.strokeStyleFirstArray[2],n.strokeStyleFirstArray[3]),e._colorStrokeSecond.updateByRGBA(n.strokeStyleSecondArray[0],n.strokeStyleSecondArray[1],n.strokeStyleSecondArray[2],n.strokeStyleSecondArray[3]),e._lineWidth=n.lineWidth,e.initInterpolation(t.properties.desaturationValue)},e.updateRenderColorPolygon=function(e,t,n,o){e._colorFillFirst.updateByRGBA(o[0],o[1],o[2],o[3]),e._colorFillSecond.updateByRGBA(o[0],o[1],o[2],t.properties.opacity+.5),e._colorStrokeFirst.updateByRGBA(n[0],n[1],n[2],n[3]),e._colorStrokeSecond.updateByRGBA(n[0],n[1],n[2],t.properties.opacity+.5),e._lineWidth=t.polygon.lineWidth,e.initInterpolation(t.properties.desaturationValue)},e.updateRenderStylePolygonNode=function(e,t){var n=t.polygon;e._colorStrokeFirst.updateByRGBA(n.strokeStyleFirstArray[0],n.strokeStyleFirstArray[1],n.strokeStyleFirstArray[2],n.strokeStyleFirstArray[3]),e._colorStrokeSecond.updateByRGBA(n.strokeStyleSecondArray[0],n.strokeStyleSecondArray[1],n.strokeStyleSecondArray[2],n.strokeStyleSecondArray[3]),e._lineWidth=n.lineWidth,t.properties.isDarkBG?e._colorFillFirst.updateByRGBA(0,0,0,1):e._colorFillFirst.updateByRGBA(255,255,255,1),e.initInterpolation(t.properties.desaturationValue)},e.updateRenderColorPolygonNode=function(e,t,n){e._colorStrokeFirst.updateByRGBA(n[0],n[1],n[2],n[3]),e._colorStrokeSecond.updateByRGBA(n[0],n[1],n[2],t.properties.opacity+.5),t.properties.isDarkBG?e._colorFillFirst.updateByRGBA(0,0,0,1):e._colorFillFirst.updateByRGBA(255,255,255,1),e.initInterpolation(t.properties.desaturationValue)},e.updateRenderStylePolygonCustom=function(e,t,n,o){var i=t.polygon;e._colorFillFirst.updateByRGBA(o[0],o[1],o[2],o[3]),o[3]-t.properties.opacity>0?e._colorFillSecond.updateByRGBA(o[0],o[1],o[2],o[3]-t.properties.opacity):e._colorFillSecond.updateByRGBA(o[0],o[1],o[2],.3),e._colorStrokeFirst.updateByRGBA(n[0],n[1],n[2],n[3]),e._colorStrokeSecond.updateByRGBA(n[0],n[1],n[2],t.properties.opacity),e._lineWidth=i.lineWidth,e.initInterpolation(t.properties.desaturationValue)},e.updateRenderStylePolygonNodeCustom=function(e,t,n,o){var i=t.polygon;e._colorStrokeFirst.updateByRGBA(n[0],n[1],n[2],n[3]),e._colorStrokeSecond.updateByRGBA(n[0],n[1],n[2],t.properties.opacity),e._lineWidth=i.lineWidth,t.properties.isDarkBG?e._colorFillFirst.updateByRGBA(0,0,0,1):e._colorFillFirst.updateByRGBA(255,255,255,1),e.initInterpolation(t.properties.desaturationValue)},e.updateRenderStyleFH=function(e,t){var n=t.freehand;e._colorFillFirst.updateByRGBA(n.fillStyleFirstArray[0],n.fillStyleFirstArray[1],n.fillStyleFirstArray[2],n.fillStyleFirstArray[3]),e._colorStrokeFirst.updateByRGBA(n.strokeStyleFirstArray[0],n.strokeStyleFirstArray[1],n.strokeStyleFirstArray[2],n.strokeStyleFirstArray[3]),e._lineWidth=n.lineWidth,e.initInterpolation(t.properties.desaturationValue)},e.updateRenderStyleFHPolyline=function(e,t){var n=t.polyline,o=t.properties.opacity;e._colorStrokeFirst.updateByRGBA(n.strokeStyleFirstArray[0],n.strokeStyleFirstArray[1],n.strokeStyleFirstArray[2],o),e._colorStrokeSecond.updateByRGBA(n.strokeStyleSecondArray[0],n.strokeStyleSecondArray[1],n.strokeStyleSecondArray[2],o),e._lineWidth=t.polyline.lineWidth,e.initInterpolation(t.properties.desaturationValue)},e.updateRenderStyleFHPolylineNode=function(e,t){var n=t.polyline,o=t.properties.opacity;e._colorStrokeFirst.updateByRGBA(n.strokeStyleFirstArray[0],n.strokeStyleFirstArray[1],n.strokeStyleFirstArray[2],o),e._colorStrokeSecond.updateByRGBA(n.strokeStyleSecondArray[0],n.strokeStyleSecondArray[1],n.strokeStyleSecondArray[2],o),e._lineWidth=t.polyline.lineWidth,t.properties.isDarkBG?e._colorFillFirst.updateByRGBA(0,0,0,o):e._colorFillFirst.updateByRGBA(255,255,255,o),e.initInterpolation(t.properties.desaturationValue)},e.updateRenderStyleFHPolygon=function(e,t){var n=t.polygon,o=t.properties.opacity;e._colorFillFirst.updateByRGBA(n.fillStyleFirstArray[0],n.fillStyleFirstArray[1],n.fillStyleFirstArray[2],o),e._colorFillSecond.updateByRGBA(n.fillStyleSecondArray[0],n.fillStyleSecondArray[1],n.fillStyleSecondArray[2],o),e._colorStrokeFirst.updateByRGBA(n.strokeStyleFirstArray[0],n.strokeStyleFirstArray[1],n.strokeStyleFirstArray[2],o),e._colorStrokeSecond.updateByRGBA(n.strokeStyleSecondArray[0],n.strokeStyleSecondArray[1],n.strokeStyleSecondArray[2],o),e._lineWidth=n.lineWidth,e.initInterpolation(t.properties.desaturationValue)},e.updateRenderStyleFHPolygonNode=function(e,t){var n=t.polygon,o=t.properties.opacity;e._colorStrokeFirst.updateByRGBA(n.strokeStyleFirstArray[0],n.strokeStyleFirstArray[1],n.strokeStyleFirstArray[2],o),e._colorStrokeSecond.updateByRGBA(n.strokeStyleSecondArray[0],n.strokeStyleSecondArray[1],n.strokeStyleSecondArray[2],o),e._lineWidth=n.lineWidth,t.properties.isDarkBG?e._colorFillFirst.updateByRGBA(0,0,0,o):e._colorFillFirst.updateByRGBA(255,255,255,o),e.initInterpolation(t.properties.desaturationValue)},e.shiftNodeStyle=function(e,t){t._colorFillFirst=e._colorStrokeFirst.deepCopy(),t._colorStrokeFirst=e._colorFillFirst.deepCopy()},e.shiftNodeStyleCustom=function(e,t){t._colorFillFirst=e._colorStrokeFirst.deepCopy(),t._colorStrokeFirst=e._colorFillFirst.deepCopy()},e.deepCopy=function(e,t){t._colorFillFirst=e._colorFillFirst.deepCopy(),t._colorFillSecond=e._colorFillSecond.deepCopy(),t._colorStrokeFirst=e._colorStrokeFirst.deepCopy(),t._colorStrokeSecond=e._colorStrokeSecond.deepCopy(),t._lineCap=e._lineCap,t._lineWidth=e._lineWidth},e.prototype.initInterpolation=function(e){this.colorInterpolated=this._colorFillFirst.deepCopy(),this.colorA=this._colorFillFirst.deepCopy(),this.colorB=this._colorFillSecond.deepCopy();var t=(0,r.AJ)([this.colorB.r,this.colorB.g,this.colorB.b,this.colorB.a],0,e,0);this.colorB.r=t[0],this.colorB.g=t[1],this.colorB.b=t[2],this.colorB.a=t[3]},e.prototype.initInterpolationStroke=function(e){this.colorInterpolated=this._colorStrokeFirst.deepCopy(),this.colorA=this._colorStrokeFirst.deepCopy(),this.colorB=this._colorStrokeSecond.deepCopy();var t=(0,r.AJ)([this.colorB.r,this.colorB.g,this.colorB.b,this.colorB.a],0,e,0);this.colorB.r=t[0],this.colorB.g=t[1],this.colorB.b=t[2],this.colorB.a=t[3]},Object.defineProperty(e.prototype,"colorInterpolatedString",{get:function(){return this.colorInterpolated.toRBGA_String()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"colorFill",{get:function(){return this._colorFillFirst.toRBGA_String()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"colorFillHover",{get:function(){return this._colorFillSecond.toRBGA_String()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"colorStroke",{get:function(){return this._colorStrokeFirst.toRBGA_String()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"colorStrokeHover",{get:function(){return this._colorStrokeSecond.toRBGA_String()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lineWidth",{get:function(){return this._lineWidth},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lineCap",{get:function(){return this._lineCap},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dash",{get:function(){return this._dash},set:function(e){this._dash=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"url",{get:function(){return this._url},set:function(e){this._url=e,this.styleComponent.geo.scene.annotationInstance.customization.iconAsset.addIcon(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._size},set:function(e){this._size=e},enumerable:!1,configurable:!0}),e}(),I=function(){this.scale=1,this.width=2,this.themeColorId=s.TitleColor,this.lineTypeId=i.Continuous},b=function(){function e(e){this.isCustom=!1,this.tempColorRgba=[0,0,0,0],this.tempFillRgba=[0,0,0,0],this.geo=e,this.state=new I,this.renderStyle=new x,this.renderStyleNode=new x}return e.prototype.updateColor=function(e){void 0===e&&(e=void 0)},e.prototype.updateStyle=function(){},e.prototype.updateStyleCustom=function(e){return!1},e.prototype.setDash=function(e){},e.prototype.toJson=function(){},e.prototype.isSameStyle=function(e){return!1},e}(),O=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),R=function(e){function t(t){var n=e.call(this,t)||this;return n.renderStyle=new x,n.renderStyleNode=new x,n.renderStyleOrigin=new x,n.renderStyleOpposite=new x,n.updateStyle(),n}return O(t,e),t.prototype.updateStyle=function(){},t.prototype.updateStyleForNode=function(e){this.renderStyle=e,x.deepCopy(e,this.renderStyleOrigin),x.shiftNodeStyle(e,this.renderStyleOpposite)},t.prototype.shiftNodeStyle=function(e){this.renderStyle=e?this.renderStyleOpposite:this.renderStyleOrigin},t}(b),L=function(){function e(e){this.host=e}return e.prototype.update=function(e){this.host.scene.annotationInstance.implementations.app.INSPECTION&&this.showStatus(e)},e.prototype.show=function(e){var t=this.host.vec;e.beginPath(),e.arc(t.x,t.y,5,0,6.28),e.closePath(),e.fillStyle="#ff0000",e.fill(),e.fillText("0",t.x,t.y-5),t=this.host.vec,e.beginPath(),e.arc(t.x,t.y,5,0,6.28),e.closePath(),e.fillStyle="#ff0000",e.fill(),e.fillText("0",t.x,t.y+10)},e.prototype.showStatus=function(e){var t=this.host.vec;e.beginPath(),e.arc(t.x,t.y,5,0,6.28),e.closePath(),e.fillStyle="#ff0000",e.fill();var n="IsTransform: "+this.host.isTransform;e.fillText(n,t.x+10,t.y+10);var o="Type: "+this.host.type;e.fillText(o,t.x+100,t.y+10)},e}(),V=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),k=function(e){function t(t,n,o,i,s,a,h){void 0===n&&(n=0),void 0===o&&(o=0),void 0===i&&(i=0),void 0===s&&(s=!1),void 0===a&&(a=r.zq.ANODE),void 0===h&&(h=5);var c=e.call(this,t,n,o,i,a)||this;return c.aEdges=[],c.nodeID=-1,c.tSelectedSole=0,c._isSelectedSole=!1,c.initComponent(),c.isUndo=s,c.aEdges=[],c.isConnected=!1,c.inspector=new L(c),c.scene.addAPoint(c),c}return V(t,e),t.computeAllLineNetworkSnap=function(e){for(var t=0;t<e.listAPoint.length-1;++t)for(var n=t+1;n<e.listAPoint.length;++n)(0,r.Sp)(e.listAPoint[t].vec,e.listAPoint[n].vec)<5&&(e.listAPoint[n].vec=e.listAPoint[t].vec)},t.computeLineNetworkSnap=function(e){},t.getVecs=function(e){for(var t=[],n=e.length;n--;)t.push(e[n].vec);return t},t.getIndexFromParent=function(e){var t=e.edges[0];return t.pts[0]===e?0:t.pts[1]===e?1:t.pts[2]===e?2:t.pts[3]===e?3:-1},t.findAtPoint=function(e,t,n){for(var o=e.listAPoint.length-1;o>=0;--o)if(e.listAPoint[o].isSelectable&&e.listAPoint[o].isMouseInside(t,n))return e.listAPoint[o]},t.removeAllCapturedGeo=function(e){for(var t=e.listAPoint,n=0;n<t.length;++n)!0===e.listAPoint[n].isSelectedValue&&e.listAPoint[n].remove()},t.DeSelecteCaptureObjects=function(e){for(var t=0;t<e.listAPoint.length;++t)e.listAPoint[t].isSelectedValue=!1},t.moveSelectedGeo=function(e,t){for(var n=0;n<e.listAPoint.length;++n)!0!==e.listAPoint[n].isSelectedValue||e.listAPoint[n].isHoverValue||e.listAPoint[n].translateByMouseEventData(t),!0===e.listAPoint[n].isHoverValue&&e.listAPoint[n].translateByMouseEventData(t)},t.getNodeFromScreenPos=function(e,n,o,i){void 0===o&&(o=!1),void 0===i&&(i=!1);var s=new t(e,n.x,n.y,n.z,o);return s.vec.w=n.w,s.weightLeft=n.w,s.weightRight=n.w,s.isUnderConstruction=!1,s},t.getNodeFromJSON=function(e,n,o,i){void 0===o&&(o=!1),void 0===i&&(i=!1);var s=new t(e,n.sx,n.sy,0,o);return s.isUnderConstruction=!1,s},t.getNodeFromVec=function(e,n,o,i){return void 0===o&&(o=!1),void 0===i&&(i=!1),t.getNodeFromScreenPos(e,n,o,i)},t.fromJSON=function(e,n,o,i){void 0===o&&(o=!1),void 0===i&&(i=!1),new t(e,n.nodes[0].sx,n.nodes[0].sy,0).type=r.zq[n.type]},t.mouseRightClick=function(e){},t.mouseMiddleClick=function(e){},t.mouseLeftClick=function(e,n){void 0!==e.capture||new t(e,n.x,n.y,0).dummy()},t.prototype.init=function(){this.isPointMid=!1},t.prototype.initComponent=function(){this.styleComponent=new R(this),this.renderer=new A(this)},t.prototype.getParentType=function(){return"APoint"},t.prototype.addEdge=function(e){-1===this.edges.indexOf(e)&&(this.type=r.zq.ANODE,this.edges.push(e),this.edges[0]&&this.styleComponent.updateStyleForNode(this.edges[0].styleComponent.renderStyleNode))},t.prototype.addNode=function(e){-1===this.nodes.indexOf(e)&&(e.type=r.zq.ANODE,this.nodes.push(e))},t.prototype.getSharedNode=function(e){for(var t=0,n=this.edges;t<n.length;t++){var o=n[t],i=(0,r.Sp)(o.p0.vec,e.vec);if(i<.01)return o.p0;if((i=(0,r.Sp)(o.p1.vec,e.vec))<.01)return o.p1}},t.prototype.removeEdge=function(e){this.edges.splice(this.edges.indexOf(e),1)},t.prototype.removeAPolylineEdge=function(e){this.aEdges.splice(this.aEdges.indexOf(e),1)},t.prototype.activateEasing=function(e,t){this.scene.capture=void 0,this.tVec=new r.h9(e.x,e.y,0),this.isAniEasing=!0},t.prototype.makeUnique=function(){for(var e=0,t=this.edges;e<t.length;e++){var n=t[e];n.p0.id===this.id&&(n.p0.vec=new r.h9(this.vec.x,this.vec.y,this.vec.z)),n.p1.id===this.id&&(n.p1.vec=new r.h9(this.vec.x,this.vec.y,this.vec.z))}},t.prototype.easing=function(){this.isAniEasing&&(this.vec=(0,r.PD)((0,r.bA)(this.vec,.95),(0,r.bA)(this.tVec,.05)),(0,r.Sp)(this.vec,this.tVec)<1&&(this.isAniEasing=!1))},t.prototype.accelerating=function(){this.vec=(0,r.PD)((0,r.bA)(this.vec,.9),(0,r.bA)(this.tVec,.1)),(0,r.Sp)(this.vec,this.tVec)<1.5&&(this.isRenderable=!1,this.isAniEasing=!1),this.renderer.t+=.01},t.prototype.move=function(e,t){this.isRemove||!this.isRenderable||this.isHiddenValue||(this.vec.x=e,this.vec.y=t)},t.prototype.add_AEdge=function(e){this.aEdges.push(e),this.aEdges[0]&&this.styleComponent.updateStyleForNode(this.aEdges[0].pGraph.styleComponent.renderStyleNode),this.isConnected=!0},Object.defineProperty(t.prototype,"v",{get:function(){return this.vec},set:function(e){this.vec=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isHover",{get:function(){return this.isHoverValue},set:function(e){this.edges[0]&&this.edges[0].type===r.zq.POLYLINE_BENDING&&this.isMouseInside(this.scene.annotationInstance.activeCommandController.m.x,this.scene.annotationInstance.activeCommandController.m.y)&&this.renderer.tOver>.9&&(this.renderer.tOver=0),this.isHoverValue=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isSelected",{get:function(){return this.isSelectedValue},set:function(e){this.isSelectedValue=e,e||(this.isSelectedSole=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isSelectedSole",{get:function(){return this._isSelectedSole},set:function(e){this._isSelectedSole=e,this.styleComponent.shiftNodeStyle(e)},enumerable:!1,configurable:!0}),t.prototype.showPopupSummary=function(){this.edges[0]&&this.edges[0].showPopupSummary()},t.prototype.hidePopUpSummary=function(){this.edges[0]&&this.edges[0].hidePopUpSummary()},t.prototype.isMouseInside=function(e,t){return!!this.edges[0]&&this.distance(e,t)<=this.r+9*this.scene.annotationInstance.activeCommandController.scaleGlobal&&(this.edges[0].type!==r.zq.CIRCLE&&this.edges[0].type!==r.zq.RECTANGLE||(this.scene.capturePT=this),!0)},t.prototype.mergeTwoEdge=function(){if(this.aEdges.length>1){var e=void 0,t=void 0;if(this.aEdges[0].p0===this?(e=this.aEdges[0].p1,this.aEdges[0].pm.deepRemove()):(e=this.aEdges[0].p0,this.aEdges[0].pm.deepRemove()),this.aEdges[1].p0===this?(t=this.aEdges[1].p1,this.aEdges[1].pm.deepRemove()):(t=this.aEdges[1].p0,this.aEdges[1].pm.deepRemove()),e&&t){e.removeAPolylineEdge(this.aEdges[0]),t.removeAPolylineEdge(this.aEdges[1]);var n=this.aEdges[0].pGraph.addEdge(e,t);this.aEdges[0].pGraph.edges.push(n),n.pGraph.removeEdge(this.aEdges[0]),n.pGraph.removeEdge(this.aEdges[1]),n.pGraph.checkMinPt(),n.pGraph.computeCenterVec(),n.pGraph.initVecsHistory()}}else this.aEdges[0].pm.remove(),this.aEdges[0].pGraph.removeEdge(this.aEdges[0])},t.prototype.remove=function(){if(!this.isRemove){if(this.popup&&this.hidePopUpSummary(),this.aEdges[0]){if(this.type===r.zq.ANODE&&this.aEdges.length>0&&!this.isRemove)return void(this.scene.annotationInstance.activeCommandController.acProperties.pressKey&&this.aEdges[0].pGraph&&(3===this.aEdges[0].pGraph.getVecs().length?(this.aEdges[0].p0!==this&&this.aEdges[0].p0.deepRemove(),this.aEdges[0].p1!==this&&this.aEdges[0].p1.deepRemove(),this.deepRemove(),this.aEdges[0].pGraph.remove(!0),this.aEdges[0].pGraph.deepRemove()):(this.aEdges[0].pGraph.remove(!1),(e=this.aEdges[0].pGraph.toJSON())&&this.scene.annotationInstance.io.eventListenerAnnotation.transformStack([e]))));if(this.type===r.zq.AMIDPOINT&&this.aEdges.length>0&&!this.isRemove)return void(this.scene.annotationInstance.activeCommandController.acProperties.pressKey&&(this.isRemove=!0,this.aEdges[0].pGraph&&(this.aEdges[0].pGraph.remove(),(e=this.aEdges[0].pGraph.toJSON())&&this.scene.annotationInstance.io.eventListenerAnnotation.transformStack([e]))))}if(this.edges[0]){if(this.type===r.zq.ANODE&&this.edges.length>0&&!this.isRemove&&!this.edges[0].isUnderConstruction)return this.isRemove=!0,this.edges[0].remove(),void((e=this.edges[0].toJSON())&&this.scene.annotationInstance.io.eventListenerAnnotation.transformStack([e]));var e;if((this.type===r.zq.ANODE||this.type===r.zq.AMIDPOINT)&&this.edges.length>0&&(this.edges[0].type===r.zq.ARROW_SINGLE||this.edges[0].type===r.zq.ARROW_DOUBLE))return this.isRemove=!0,void(this.edges[0]&&(this.edges[0].remove(),(e=this.edges[0].toJSON())&&this.scene.annotationInstance.io.eventListenerAnnotation.transformStack([e])))}this.deepRemove()}},t.prototype.deepRemove=function(){this.isRemove||(this.textLeaderline&&(this.textLeaderline.removeByAttachedShape(),this.textLeaderline=void 0),this.isSelectable=!1,this.isRenderable=!1,this.isRemove=!0,this.scene.removeBasePoint(this),this.scene.removeAPoint(this),this.scene.removeGeometry(this))},t.prototype.goToBlackhole=function(){this.isSelectable=!1,this.tVec=this.scene.annotationInstance.renderer.blackhole.v,this.isAniAccel=!0},t.prototype.hide=function(){this.isSelectable=!1,this.isRenderable=!1},t.prototype.translateByMouseEventData=function(e){this.type!==r.zq.ANODE_RECT&&this.type!==r.zq.ANODE_CIRCLE&&(this.isRemove||!this.isRenderable||this.isHiddenValue||(this.textLeaderline&&this.textLeaderline.translateByMouseEventData(e),this.aEdges.length>0?this.translateForCurvedPolyline(e):this.type!==r.zq.AMIDPOINT_ALINE?(this.scene.annotationInstance.activeCommandController.acProperties.pressCtrlKey?this.splitPointbyNewVec(e.x,e.y):(this.vec.x=e.x,this.vec.y=e.y,this.isDrag=!0),this.type===r.zq.ANODE&&this.edges[0]&&this.edges[0].type===r.zq.POLYGON||this.edges[0].type!==r.zq.ARROW_SINGLE&&this.edges[0].type!==r.zq.ARROW_DOUBLE&&this.edges[0].type!==r.zq.CURVE_OPEN&&this.edges[0].type!==r.zq.CURVE_CLOSE&&(this.edges[0].type,r.zq.ALINE)):this.translateForLineMidPoint(e)))},t.prototype.translate=function(e,t){},t.prototype.splitPointbyNewVec=function(e,t){for(var n=this.scene.listAPoint,o=0;o<n.length;++o)(0,r.Sp)(n[o].vec,this.vec)<5&&(this.vec=new r.h9(e,t),this.scene.Capture=n[o],this.scene.annotationInstance.activeCommandController.acProperties.pressCtrlKey=!1)},t.prototype.mouseLeftClick=function(){if(this.aEdges.length>0){if(!this.scene.annotationInstance.activeCommandController.acProperties.pressShift)for(var e=this.aEdges[0],t=0;t<e.pGraph.edges.length;++t)e.pGraph.edges[t].p0!==this&&e.pGraph.edges[t].p0.isSelectedSole&&(e.pGraph.edges[t].p0.isSelectedSole=!1),e.pGraph.edges[t].p1!==this&&e.pGraph.edges[t].p1.isSelectedSole&&(e.pGraph.edges[t].p1.isSelectedSole=!1),e.pGraph.edges[t].pm!==this&&e.pGraph.edges[t].pm.isSelectedSole&&(e.pGraph.edges[t].pm.isSelectedSole=!1);return this.isSelectedSole=!this.isSelectedSole,void(this.aEdges[0].pGraph.isSelected=!0)}if(this.edges.length>0){if(this.edges[0].type===r.zq.ARROW_SINGLE||this.edges[0].type===r.zq.ARROW_DOUBLE)return this.isSelected=!1,void(this.edges[0].isSelected=!this.edges[0].isSelected);if(!this.scene.annotationInstance.activeCommandController.acProperties.pressShift)for(e=this.edges[0],t=0;t<e.pts.length;++t)e.pts[t]!==this&&e.pts[t].isSelectedSole&&(e.pts[t].isSelectedSole=!1);return this.isSelectedSole=!this.isSelectedSole,void(this.edges[0].isSelected=!0)}},t.prototype.translateForLineMidPoint=function(e){},t.prototype.splitMidPointbyNewVec=function(e,t){},t.prototype.translateForCurvedPolyline=function(e){if(this.vec.x+=e.x-e.preX,this.vec.y+=e.y-e.preY,this.isDrag=!0,this.type===r.zq.AMIDPOINT)if(this.scene.annotationInstance.activeCommandController.acProperties.pressCtrlKey)this.aEdges[0].checkIsCurved();else{var t=this.aEdges[0].splitEdge(this);t&&(t.isSelected=!1,this.scene.Capture=t)}else for(var n=0;n<this.aEdges.length;++n)this.aEdges[n].moveMidPt(e)},t.prototype.deepCopy=function(e,n,o){if(void 0===e&&(e=this.vec.x),void 0===n&&(n=this.vec.y),void 0===o&&(o=this.vec.z),this.type!==r.zq.AMIDPOINT&&this.type!==r.zq.ANODE)return new t(this.scene,e,n,this.vec.z,!1,this.type,this.r)||void 0},t.prototype.mouseRightClick=function(e){},t.prototype.renderPost=function(e){this.inspector.update(e),this.renderer.renderPost(e)},t.prototype.mouseUp=function(){},t.prototype.textLeaderlinePost=function(e){return!(this.type!==r.zq.ANODE_CIRCLE&&this.type!==r.zq.ANODE_RECT||this.edges[0].type!==r.zq.CIRCLE&&this.edges[0].type!==r.zq.RECTANGLE||(this.edges[0].textLeaderline=e,0))},t.id=0,t}(v),N=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),E=function(e){function t(t){var n=e.call(this,t)||this;return n.host=t,n.initRenderTheme(),n}return N(t,e),t.prototype.initRenderTheme=function(){},t.prototype.renderPost=function(e){(this.host.isConstraint&&this.host.isHoverValue||this.host.isSelected)&&(e.textAlign="center",e.fillStyle="#000000",e.fillText("Total constraint length: "+this.host.constraintTargetDistance+" Mile",this.host.vecs[0].x,this.host.vecs[0].y-10)),this.host.scene.annotationInstance.activeCommandController.acProperties.showUnit&&(this.host.isConstraint||(this.host.type===r.zq.POLYGON?(this.host.isHoverValue||this.host.isUnderConstruction)&&(this.host.dimension.renderLength(e,!0,this.host.vecs),this.host.dimension.renderTotalArea(e,this.host.vecs)):(this.host.isHoverValue||this.host.isUnderConstruction)&&(this.host.dimension.renderLength(e,!1,this.host.vecs),this.host.dimension.renderTotalLength(e,this.host.vecs)))),this.host.isConstraint?this.renderPostGeometryConstraint(e):this.renderPostGeometry(e),this.offscreenRender(),this.host.renderer.t+=this.host.scene.annotationInstance.renderer.dt},t.prototype.renderPostGeometryConstraint=function(e){if(this.host.type===r.zq.POLYLINE){if(this.host.isHoverValue||this.host.isSelectedValue||this.host.isUnderConstruction){e.lineDashOffset=-this.host.renderer.t,e.setLineDash([4,4]),e.strokeStyle=this.host.styleComponent.renderStyle.colorStroke,e.lineWidth=1,e.beginPath(),e.moveTo(this.host.vecs[0].x,this.host.vecs[0].y);for(var t=1;t<this.host.vecs.length;++t)e.lineTo(this.host.vecs[t].x,this.host.vecs[t].y);e.stroke(),e.setLineDash([0,0])}this.host.isConstraint&&(this.host.renderConstraintTargetDistance,this.host.renderConstraintTargetDistancePercentage),this.host.isHoverValue||this.host.isUnderConstruction}else this.host.type===r.zq.POLYGON&&this.host.isConstraint},t.prototype.renderPostGeometry=function(e){this.host.type===r.zq.POLYLINE?this.host.isUnderConstruction?(this.renderPolyline(e),this.host.scene.annotationInstance.implementations.app.model.appCoreWrapper.appControllerStatus.mode===r.An.Drawing&&this.renderMidVec(e)):this.host.isCurvedPolyline||(this.renderPolyline(e),this.host.scene.annotationInstance.implementations.app.model.appCoreWrapper.appControllerStatus.mode===r.An.Drawing&&this.renderMidVec(e)):this.renderPolygon(e,this.host.getVecs())},t.prototype.renderPolyline=function(e){this.host.isHoverValue||this.host.isSelectedValue?(this.host.scene.annotationInstance.renderer.draw.shape.line.polylineHover(e,this.host.styleComponent.renderStyle,this.host.getVecs(),this.host.isGrayColor,this.host.visibilityValue,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tOver),this.host.isHoverValue),this.tOver+=.015,this.tDown1=0,this.host.isLeave=!0,this.host.scene.annotationInstance.renderer.draw.shape.line.polyline(e,this.host.styleComponent.renderStyle,this.host.getVecs(),this.host.isGrayColor,this.host.visibilityValue,this.host.isHoverValue,this.host.isSelectedValue)):(this.tOver=0,this.host.scene.annotationInstance.renderer.draw.shape.line.polyline(e,this.host.styleComponent.renderStyle,this.host.getVecs(),this.host.isGrayColor,this.host.visibilityValue,this.host.isHoverValue,this.host.isSelectedValue))},t.prototype.renderPolygon=function(e,t){this.offscreenRender(),this.host.isHoverValue||this.host.isSelectedValue?(this.host.scene.annotationInstance.renderer.draw.shape.area.polygonHover(e,this.host.styleComponent.renderStyle,t,this.host.isGrayColor,this.host.visibilityValue,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tOver),this.host.isHoverValue,this.host.isSelectedValue),this.tOver+=.01,this.tDown1=0,this.host.isLeave=!0,this.host.scene.annotationInstance.renderer.draw.shape.area.polygon(e,this.host.styleComponent.renderStyle,t,this.host.isUnderConstruction,this.host.isGrayColor,this.host.visibilityValue,this.host.isFill,this.host.isHover,this.host.isSelectedValue)):(this.tOver=0,this.host.scene.annotationInstance.renderer.draw.shape.area.polygon(e,this.host.styleComponent.renderStyle,t,this.host.isUnderConstruction,this.host.isGrayColor,this.host.visibilityValue,this.host.isFill,this.host.isHover,this.host.isSelectedValue))},t.prototype.renderMidVec=function(e){if(this.host.isHoverValue||this.host.isSelectedValue||this.host.isUnderConstruction){this.host.updateMidVec();for(var t=this.host.vecMid.length;t--;)this.host.scene.annotationInstance.renderer.draw.shape.node.nodeMidHover(e,this.host.styleComponent.renderStyleNode,this.host.vecMid[t].x,this.host.vecMid[t].y,this.host.scaleForRender,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tOver))}},t.prototype.offscreenRender=function(){this.host.type===r.zq.POLYGON&&this.offscreenRenderPolygon()},t.prototype.offscreenRenderPolygon=function(){this.host.scene.annotationInstance.renderer.offscreen.polygonOffScreen(this.host.scene.annotationInstance.renderer.ctxOffscreen,this.host.hashColor,this.host.getVecs())},t}(C),_=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),T=function(e){function t(t){var n=e.call(this,t)||this;return n.updateStyle(),n}return _(t,e),t.prototype.updateStyle=function(){if(x.updateRenderStylePolyline(this.renderStyle,this.geo.scene.annotationInstance.customization.themeCurrent),x.updateRenderStylePolylineNode(this.renderStyleNode,this.geo.scene.annotationInstance.customization.themeCurrent),this.geo.pts)for(var e=0;e<this.geo.pts.length;++e)this.geo.pts[e].styleComponent.updateStyleForNode(this.renderStyleNode)},t}(b),D=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),M=function(e){function t(t,n,o,i){void 0===o&&(o=!1),void 0===i&&(i=!1);var s=e.call(this,t)||this;return s.constraintTargetArea=340,s.vecSelected=-1,s.isPan=!1,s.renderConstraintTargetDistancePercentage=!1,s.renderConstraintTargetDistance=!1,s._constraintTargetDistancePercentage=.5,s._constraintTargetDistance=340,s.isFill=!1,s.pts=[],s.isUndo=o,s.isConstraint=i,s.lineWidth=8,s.isUnderConstruction=!0,s.vec=new r.h9(n.vec.x,n.vec.y,n.vec.z),s.isMove=!0,s.initComponent(),s.addPT(n),s.initVecsHistory(),s.initPolyline(),s.scene.annotationInstance.implementations.app.model.ioWrapper.eventInteraction.isEnableZoomByDoubleClick=!1,s}return D(t,e),t.findAtPoint=function(e,t){for(var n=e.listAPolylineWrapper.length-1;n>=0;--n)if(e.listAPolylineWrapper[n].isSelectable&&e.listAPolylineWrapper[n].isMouseInside(t.x,t.y))return e.listAPolylineWrapper[n]},t.getLengthSelection=function(e){for(var t=e.listAPolylineWrapper.length,n=0;t--;)e.listAPolylineWrapper[t].isSelected&&(n+=1);return n},t.computeOver=function(e,n){var o=t.findAtPoint(e,n);void 0!==o&&(o.isHoverValue=!0)},t.fromJSON=function(e,n,o,i){void 0===o&&(o=!1),void 0===i&&(i=!1);var s;s=!!n.data.isConstraint;var a=new t(e,k.getNodeFromJSON(e,n.nodes[0],o),o,s);if(s&&(a.constraintTargetDistance=+n.data.constraintTargetDistance),o){a.isUndo=o;for(var h=1;h<n.nodes.length;++h)a.addPT(k.getNodeFromJSON(e,n.nodes[h],o))}else for(h=1;h<n.nodes.length;++h)a.addPT(k.getNodeFromJSON(e,n.nodes[h]));return a.type=r.zq[n.type],a.id=i?e.getUUID():n.id,a.IsSelectable=!0,a.isUnderConstruction=!1,a.isHover=!1,a.isHiddenValue=n.isHidden,n.isHidden?a.visibilityValue=0:a.visibilityValue=1,a.initVecsHistory(),o||e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(a.toJSON()),a},t.getPolylineByVecs=function(e,n){for(var o=new t(e,new k(e,n[0].x,n[0].y,0)),i=1;i<n.length;++i)o.addPT(new k(e,n[i].x,n[i].y,0));o.computeCenterVec(),o.IsSelectable=!0,o.isUnderConstruction=!1,e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(o.toJSON())},t.drawShadow=function(e,n){void 0===n&&(n=r.zq.ALINE),void 0!==t.construction&&t.construction.pts[t.construction.pts.length-1].move(e.x,e.y)},t.getLine=function(e,n,o){void 0===o&&(o=!1),void 0!==t.construction||(t.construction=new t(e,new k(e,n.x,n.y),!1,o),t.construction.pts[0].isSelectable=!0),t.construction.addPT(new k(e,n.x,n.y))},t.getLineByPt=function(e){},t.undo=function(e,n){if(t.construction){var o=t.construction.pts.length-1;1!==o?(t.construction.removePT(t.construction.pts[--o]),t.construction.pts[o].vec.x=n.x,t.construction.pts[o].vec.y=n.y):t.cancel(e)}},t.done=function(e){void 0!==t.construction&&(t.construction.IsSelectable=!0,t.construction.isUnderConstruction=!0,t.construction.removePT(t.construction.pts[t.construction.pts.length-1]),(0,r.Sp)(t.construction.pts[t.construction.pts.length-1].vec,t.construction.pts[0].vec)<3&&t.construction.removePT(t.construction.pts[t.construction.pts.length-1]),t.construction.computeCenterVec(),t.construction.removePT(t.construction.pts[t.construction.pts.length-1]),t.construction.isUnderConstruction=!1,e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(t.construction.toJSON()),t.construction=void 0,e.annotationInstance.activeCommandController.goToACMode()),e.annotationInstance.implementations.app.model.ioWrapper.eventInteraction.isEnableZoomByDoubleClick=!0},t.doneByKeyboard=function(e){void 0!==t.construction&&(t.construction.IsSelectable=!0,t.construction.removePT(t.construction.pts[t.construction.pts.length-1]),t.construction.isUnderConstruction=!1,t.construction.computeCenterVec(),e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(t.construction.toJSON()),t.construction=void 0,e.annotationInstance.activeCommandController.goToACMode())},t.cancel=function(e){void 0!==t.construction&&(t.construction.needEmit=!1,t.construction.remove(),t.construction=void 0)},t.mouseDown=function(e,n,o){if(void 0===o&&(o=!1),e.annotationInstance.activeCommandController.acProperties.isSmartSelectionWhenDrawing){var i=e.annotationInstance.geometryCommon.gcmdProcessing.findAtPoint(n);t.construction&&(t.getLine(e,n),i&&(t.construction.type=r.zq.POLYGON,t.construction.isClosed=!0,t.construction.removePT(t.construction.pts[t.construction.pts.length-1]),t.construction.removePT(t.construction.pts[t.construction.pts.length-1]),i.isSelectedValue=!1,i.isHoverValue=!1,i.isCapturedValue=!1,i.isSelectable=!1,t.construction.IsSelectable=!0,t.construction.isUnderConstruction=!1,t.construction.computeCenterVec(),t.construction.initVecsHistory(),e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(t.construction.toJSON()),t.construction=void 0))}else t.getLine(e,n,o)},t.mouseLeftClick=function(e,n,o){if(void 0===o&&(o=!1),void 0===e.capture)return void 0!==t.construction&&t.isDone?(t.construction.isSelectedValue=!1,t.construction=void 0,void(t.isDone=!1)):void(void 0===t.construction&&t.getLine(e,n,o))},t.mouseMove=function(e){void 0!==t.construction&&t.drawShadow(e)},t.mouseDoubleClick=function(e,n){void 0!==t.construction&&t.done(e)},t.prototype.initComponent=function(){this.styleComponent=new T(this),this.renderer=new E(this)},t.prototype.initPolyline=function(){this.isCurvedPolyline=!1,this.type=r.zq.POLYLINE,this.scene.addAPolylineWrapper(this)},t.prototype.updateScreenVec=function(){},t.prototype.updatePan=function(){},t.prototype.updateZoom=function(){},t.prototype.getLog=function(){if(this.isRemove||!this.isRenderable||this.isHiddenValue)return"";var e="";return this.type===r.zq.POLYGON?e+="GUID : "+this.id+"/TYPE : "+this.type.toString()+"/Screen : /pos : "+this.pts.length+"/Area : "+this.getArea().toFixed(3).toString()+" m2/IsSEL : "+this.isSelectedValue+"/isSelable : "+this.isSelectable:this.type===r.zq.POLYLINE?e+="GUID : "+this.id+"/TYPE : "+this.type.toString()+"/Screen : /pos : "+this.pts.length+"/length : "+this.getArea().toFixed(3).toString()+" m2/IsSEL : "+this.isSelectedValue+"/isSelable : "+this.isSelectable:e},t.prototype.getLogDOM=function(){return"Geometry ID : "+this.id+"<br>geometry Type : CCircle<br>position : <br>size : "+this.r+" pixel<br>"},t.prototype.isColse=function(){},t.prototype.isMouseInside=function(e,t){return!(this.isRemove||!this.isRenderable||this.isHiddenValue||!0===this.isUnderConstruction||void 0===this.isUnderConstruction||(this.checkDistance(e,t)?(this.isHover=!0,0):(this.isHover=!1,1)))},t.prototype.checkDistance=function(e,t){for(var n=this.pts.length,o=0;o<n;++o)if(o<n-1){if((0,r.xs)(new r.h9(e,t),this.pts[o].vec,this.pts[o+1].vec)<this.lineWidth)return!0}else if(this.type!==r.zq.POLYLINE&&(0,r.xs)(new r.h9(e,t),this.pts[o].vec,this.pts[0].vec)<this.lineWidth)return!0;return!!this.scene.annotationInstance.geometryCommon.gcmdProcessing.isMouseInsideByOffScreen(e,t,this.hashColor)},t.prototype.hasSamePtWtithCapture=function(){for(var e=0;e<this.pts.length;++e)if(this.pts[e]===this.scene.capture)return!0;return!1},t.prototype.translateByMouseEventData=function(e){if(!this.hasSamePtWtithCapture())if(-1===this.vecSelected){if(!this.isRemove&&this.isRenderable&&!this.isHiddenValue){for(var t=e.x-e.preX,n=e.y-e.preY,o=0;o<this.pts.length;++o)if(this.pts[o].vec.x+=t,this.pts[o].vec.y+=n,this.pts[o].textLeaderline){var i=this.pts[o];this.translateForTextLeaderline(e,i)}if(this.isCurvedPolyline&&this.mPts)for(o=0;o<this.mPts.length;++o)this.mPts[o].vec.x+=t,this.mPts[o].vec.y+=n}}else this.pts[this.vecSelected].translateByMouseEventData(e)},t.prototype.translateForTextLeaderline=function(e,t){return!(!t.textLeaderline||(t.textLeaderline.translateByMouseEventData(e),!t.textLeaderline.leaderline)||(t.textLeaderline.leaderline.v2.x=t.vec.x,t.textLeaderline.leaderline.v2.y=t.vec.y,0))},t.prototype.translate=function(e,t){},t.prototype.move=function(e,t){if(!this.isRemove&&this.isRenderable&&!this.isHiddenValue){this.computeCenterVec();for(var n=e-this.vec.x,o=t-this.vec.y,i=0;i<this.pts.length;++i)this.pts[i].vec.x+=n,this.pts[i].vec.y+=o}},t.prototype.remove=function(e){if(void 0===e&&(e=!0),!this.isRemove&&this.isRenderable&&!this.isHiddenValue){for(var t=0;t<this.pts.length;++t)this.pts[t].deepRemove();if(this.isSelectable=!1,this.isRenderable=!1,this.hidePopUpSummary(),e){var n=this.toJSON();n&&this.scene.annotationInstance.io.eventListenerAnnotation.removeGeometryStack([n])}this.scene.removeAPolylineWrapper(this),this.scene.removeGeometry(this)}},t.prototype.hide=function(){},t.prototype.getLength=function(){if(this.pts.length<2)return 0;for(var e=0,t=0;t<this.pts.length-1;++t)e+=0;return Math.abs(e)},t.prototype.findClosestNode=function(e,t){for(var n=0;n<this.pts.length;++n)if(this.pts[n].isMouseInside(e,t))return this.pts[n]},t.prototype.removeByBlackhole=function(){this.computeCenterVec(),(0,r.CV)([this.scene.annotationInstance.renderer.blackhole.v.x,this.scene.annotationInstance.renderer.blackhole.v.y,this.scene.annotationInstance.renderer.blackhole.v.z],[this.vec.x,this.vec.y,this.vec.z])<10&&this.remove(!0)},t.prototype.getArea=function(){this.vecs=[];for(var e=0;e<this.pts.length;++e)this.vecs.push(this.pts[e].vec);return(0,r.$4)(this.vecs)},Object.defineProperty(t.prototype,"constraintTargetDistance",{get:function(){return this._constraintTargetDistance},set:function(e){this.renderConstraintTargetDistance=!0,this.renderConstraintTargetDistancePercentage=!1,this._constraintTargetDistance=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"constraintTargetDistancePercentage",{get:function(){return this._constraintTargetDistancePercentage},set:function(e){this.renderConstraintTargetDistance=!1,this.renderConstraintTargetDistancePercentage=!0,this._constraintTargetDistancePercentage=e<=0?.001:e},enumerable:!1,configurable:!0}),t.prototype.getNodePopup=function(){for(var e=this.pts[0],t=1;t<this.pts.length;++t)this.pts[t].vec.x<e.vec.x&&(e=this.pts[t]);return e},t.prototype.addPT=function(e){this.type===r.zq.POLYLINE?e.type=r.zq.ANODE:this.type===r.zq.POLYGON&&(e.type=r.zq.AN_GON),e.isSelectable=!1,e.addEdge(this),this.pts.push(e)},t.prototype.toJSON=function(){var e=new p(this.id,this.type,this.isSelectedValue,this.isHoverValue,this.isHiddenValue);return e.pushNode(this.getVecs()),e.data.isConstraint=this.isConstraint,e.data.constraintTargetDistance=this.constraintTargetDistance,e},t.prototype.getVecsFromDivision=function(e){void 0===e&&(e=1),this.getLength();for(var t=0;t<this.pts.length-1;++t){var n=this.pts[t].vec,o=(0,r.$$)(n.x,n.y),i=this.scene.annotationInstance.geometryCommon.gcmdSupporting.toScreen(o.x,o.y),s=.7*(0,r.Sp)(new r.h9(i[0],i[1]),this.pts[t].vec)*1,a=this.pts[t].vec,h=this.pts[t+1].vec,c=(0,r.bA)((0,r.Fv)((0,r.lu)(a,h)),s);c=(0,r.PD)(a,c),new k(this.scene,c.x,c.y,c.z).dummy()}},t.prototype.getVecsFromNumber=function(e){var t=this;void 0===e&&(e=5);for(var n=0;n<this.pts.length-1;++n){var o=this.pts[n].vec,i=this.pts[n+1].vec;(0,r.fi)(o,i,e).forEach((function(e){new k(t.scene,e.x,e.y,e.z).dummy()}))}},t.prototype.getBoundary=function(){return this.getVecs()},t.prototype.computeVec=function(){this.computeCenterVec(),this.computeBoundingVecs()},t.prototype.goToBlackhole=function(){this.isSelectable=!1,this.needBlackhole=!0,this.pts.forEach((function(e){e.goToBlackhole()}))},t.prototype.updateMidVec=function(){if(this.vecMid=[],this.type===r.zq.POLYLINE)for(var e=0;e<this.pts.length-1;++e)this.vecMid.push((0,r.zQ)(this.pts[e].vec,this.pts[e+1].vec))},t.prototype.computeMidPts=function(){for(var e=this.pts.length;e--;)if(this.pts[e].isMid){var t=this.pts[e];t.vec=(0,r.zQ)(t.nodes[0].vec,t.nodes[1].vec)}},t.prototype.computeCenterVec=function(){for(var e=[],t=0;t<this.pts.length;++t)e.push(this.pts[t].vec);return this.vec=(0,r.mI)(e),this.vec},t.prototype.computeBoundingVecs=function(){this.vecs=[];for(var e=0;e<this.pts.length;++e)this.vecs.push(this.pts[e].vec);this.vecsBound=(0,r.rv)(this.vecs)},t.prototype.computeMidPT=function(e){if(!(this.pts.length<3)){var t=this.pts[e],n=(0,r.zQ)(this.pts[e-1].vec,this.pts[e+1].vec);t.vec=n}},t.prototype.removePT=function(e){this.pts.splice(this.pts.indexOf(e),1),e.remove()},t.prototype.getVecs=function(){for(var e=[],t=0;t<this.pts.length;++t)e.push(this.pts[t].vec);return this.vecs=e,e},t.prototype.deepCopy=function(e,n,o){void 0===o&&(o=0);var i=this.toJSON(),s=t.fromJSON(this.scene,i,!0,!0);return s.move(e,n),s.isHoverValue=!0,s.emitAddStack(),s},Object.defineProperty(t.prototype,"isHidden",{get:function(){return this.isHiddenValue},set:function(e){this.isHiddenPre=this.isHiddenValue,this.isHiddenValue=e;for(var t=0;t<this.pts.length;++t)this.pts[t].isHiddenValue=e,this.pts[t].visibility=0;this.scene.annotationInstance.io.eventListenerAnnotation.hideStack(this.toJSON())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"IsSelectable",{get:function(){return this.isSelectable},set:function(e){this.isSelectable=e;for(var t=0;t<this.pts.length;++t)this.pts[t].isSelectable=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"v",{get:function(){return this.vec},set:function(e){this.vec=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isSelected",{get:function(){return this.isSelectedValue},set:function(e){if(!this.isRemove&&this.isRenderable&&!this.isHiddenValue){this.isSelectedValue=e;for(var t=0,n=this.pts;t<n.length;t++)n[t].isRenderable=e;this.scene.annotationInstance.io.eventListenerAnnotation.selectionStack(this.toJSON())}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isHover",{get:function(){return this.isHoverValue},set:function(e){if(!this.isUnderConstruction){if(this.isHoverValue=e,(this.isHoverValue&&!this.isHoverPre||!this.isHoverValue&&this.isHoverPre)&&this.scene.annotationInstance.io.eventListenerAnnotation.hoverStack(this.toJSON()),this.isHoverPre=this.isHoverValue,!this.isSelectedValue)for(var t=0,n=this.pts;t<n.length;t++)n[t].isRenderable=e;e||(this.needEmitHoverPost=!0,this.hidePopUpSummary())}},enumerable:!1,configurable:!0}),t.prototype.mouseLeftClick=function(){this.scene.annotationInstance.geometryCommon.gcmdProcessing.removeAllPopup(),this.showPopupSummary(),this.dimension.renderTotalLengthInput()},t.prototype.mouseRightClick=function(){},t.prototype.update=function(){},t.prototype.renderPost=function(e){this.update(),this.computeVec(),this.renderer.timer.updatePopupSummery(),this.scene.annotationInstance.activeCommandController.acProperties.isPanning,this.renderer.renderPost(e)},t.split=!1,t.isDone=!1,t}(y),z=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),G=function(e){function t(t){return e.call(this,t)||this}return z(t,e),t.prototype.updateStyle=function(){if(x.updateRenderStylePolygon(this.renderStyle,this.geo.scene.annotationInstance.customization.themeCurrent),x.updateRenderStylePolygonNode(this.renderStyleNode,this.geo.scene.annotationInstance.customization.themeCurrent),this.geo.pts)for(var e=0;e<this.geo.pts.length;++e)this.geo.pts[e].styleComponent.updateStyleForNode(this.renderStyleNode)},t}(b),W=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),B=function(e){function t(t,n,o,i){void 0===o&&(o=!1),void 0===i&&(i=!1);var s=e.call(this,t,n,o)||this;return s.initComponentPolygon(),n.styleComponent.updateStyleForNode(s.styleComponent.renderStyleNode),s.isConstraint=i,s.isFill=!0,t.annotationInstance.implementations.app.model.ioWrapper.eventInteraction.isEnableZoomByDoubleClick=!1,s.initPolygon(),s}return W(t,e),t.addGhost=function(e,t){},t.findAtPoint=function(e,t){for(var n=e.listAPolygonWrapper.length-1;n>=0;--n)if(e.listAPolygonWrapper[n].isSelectable&&e.listAPolygonWrapper[n].isMouseInside(t.x,t.y))return e.listAPolygonWrapper[n]},t.computeOver=function(e,t){var n=e.annotationInstance.geometryCommon.gcmdProcessing.findAtPoint(t);void 0!==n&&(n.isHoverValue=!0)},t.aPolygonFromNGon=function(e,n){for(var o=new t(e,n.pts[0].deepCopy()),i=1;i<n.pts.length;++i)o.addPT(n.pts[i].deepCopy());return o.type=r.zq.POLYGON,o.id=n.id,o.IsSelectable=!0,o.isUnderConstruction=!1,o},t.getPolygonbyVecs=function(e,n){for(var o=new t(e,new k(e,n[0].x,n[0].y)),i=1;i<n.length-1;++i)o.addPT(new k(e,n[i].x,n[i].y));return o.type=r.zq.POLYGON,o.computeCenterVec(),o.initVecsHistory(),e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(o.toJSON()),o.IsSelectable=!0,o.isUnderConstruction=!1,o.isHover=!1,o.visibilityValue=1,o.isRenderable=!0,o},t.fromJSON=function(e,n,o,i){void 0===o&&(o=!1),void 0===i&&(i=!1);var s=new t(e,k.getNodeFromJSON(e,n.nodes[0],o));if(o){s.isUndo=o;for(var a=1;a<n.nodes.length;++a)s.addPT(k.getNodeFromJSON(e,n.nodes[a],o))}else for(a=1;a<n.nodes.length;++a)s.addPT(k.getNodeFromJSON(e,n.nodes[a]));return s.type=r.zq[n.type],s.id=i?e.getUUID():n.id,s.IsSelectable=!0,s.isUnderConstruction=!1,s.isHover=!1,s.isHiddenValue=n.isHidden,n.isHidden?s.visibilityValue=0:s.visibilityValue=1,s.computeCenterVec(),s.initVecsHistory(),o||e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(s.toJSON()),s},t.drawShadow=function(e){void 0!==t.construction&&t.construction.pts[t.construction.pts.length-1].move(e.x,e.y)},t.getLine=function(e,n,o,i){void 0===o&&(o=!1),void 0===i&&(i=r.zq.AN_GON),void 0!==t.construction?t.construction.addPT(new k(e,n.x,n.y,0,!1,r.zq.ANODE_NGON)):(t.construction=new t(e,new k(e,n.x,n.y),!1,o),t.construction.pts[0].isSelectable=!0,t.construction.addPT(new k(e,n.x,n.y,0,!1,r.zq.ANODE_NGON)),t.construction.isUnderConstruction=!0)},t.getLineByPt=function(e){},t.undo=function(e,n){if(t.construction){var o=t.construction.pts.length-1;1!==o?(t.construction.removePT(t.construction.pts[--o]),t.construction.pts[o].vec.x=n.x,t.construction.pts[o].vec.y=n.y):t.cancel(e)}},t.done=function(e){e.annotationInstance.activeCommandController.IsTouchEvent?this.doneByTouch(e):this.doneByMouseClick(e),e.annotationInstance.implementations.app.model.ioWrapper.eventInteraction.isEnableZoomByDoubleClick=!0},t.doneByTouch=function(e){void 0!==t.construction&&(t.construction.IsSelectable=!0,t.construction.removePT(t.construction.pts[0]),(0,r.Sp)(t.construction.pts[t.construction.pts.length-1].vec,t.construction.pts[0].vec)<15&&t.construction.removePT(t.construction.pts[t.construction.pts.length-1]),t.construction.removePT(t.construction.pts[t.construction.pts.length-1]),t.construction.computeCenterVec(),t.construction.initVecsHistory(),t.construction.isUnderConstruction=!1,e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(t.construction.toJSON()),t.construction.pts.length<2&&t.construction.remove(),t.construction=void 0,e.annotationInstance.activeCommandController.goToACMode())},t.doneByMouseClick=function(e){void 0!==t.construction&&(t.construction.IsSelectable=!0,t.construction.removePT(t.construction.pts[t.construction.pts.length-1]),(0,r.Sp)(t.construction.pts[t.construction.pts.length-1].vec,t.construction.pts[0].vec)<2&&t.construction.removePT(t.construction.pts[t.construction.pts.length-1]),t.construction.removePT(t.construction.pts[t.construction.pts.length-1]),t.construction.computeCenterVec(),t.construction.isUnderConstruction=!1,e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(t.construction.toJSON()),t.construction.pts.length<2&&t.construction.remove(),t.construction=void 0,e.annotationInstance.activeCommandController.goToACMode())},t.doneByKeyboard=function(e){void 0!==t.construction&&(t.construction.IsSelectable=!0,t.construction.removePT(t.construction.pts[t.construction.pts.length-1]),t.construction.isUnderConstruction=!1,t.construction.computeCenterVec(),e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(t.construction.toJSON()),t.construction.pts.length<2&&t.construction.remove(),t.construction=void 0,e.annotationInstance.activeCommandController.goToACMode())},t.cancel=function(e){void 0!==t.construction&&(t.construction.needEmit=!1,t.construction.remove(),t.construction=void 0,e.annotationInstance.activeCommandController.goToACMode())},t.mouseDown=function(e,n){if(e.annotationInstance.activeCommandController.acProperties.isSmartSelectionWhenDrawing){var o=e.annotationInstance.geometryCommon.gcmdProcessing.findAtPoint(n);t.construction&&(t.getLine(e,n),o&&(t.construction.type=r.zq.POLYGON,t.construction.isClosed=!0,t.construction.removePT(t.construction.pts[t.construction.pts.length-1]),t.construction.removePT(t.construction.pts[t.construction.pts.length-1]),o.isSelectedValue=!1,o.isHoverValue=!1,o.isCapturedValue=!1,o.isSelectable=!1,t.construction.IsSelectable=!0,t.construction.isUnderConstruction=!1,t.construction.computeCenterVec(),e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(t.construction.toJSON()),t.construction=void 0))}else t.getLine(e,n)},t.mouseLeftClick=function(e,n,o,i){if(void 0===o&&(o=!1),void 0===i&&(i=r.zq.POLYGON),void 0===e.capture)return void 0!==t.construction&&t.isDone?(t.construction.isSelectedValue=!1,t.construction=void 0,void(t.isDone=!1)):void(void 0===t.construction&&t.getLine(e,n,o,i))},t.mouseMove=function(e){if(void 0!==t.construction){if(t.construction.scene.annotationInstance.activeCommandController.acProperties.pressShift&&t.construction.pts.length>1){var n=t.construction.pts[t.construction.pts.length-2];(0,r.Sp)(n.vec,new r.h9(e.x,e.y))>20&&this.mouseDown(t.construction.scene,e)}t.drawShadow(e)}},t.mouseDoubleClick=function(e,n){void 0!==t.construction&&t.done(e)},t.prototype.initComponentPolygon=function(){this.styleComponent=new G(this)},t.prototype.initPolygon=function(){this.type=r.zq.POLYGON,this.scene.addAPolygonWrapper(this)},t.prototype.getLog=function(){return this.isRemove||!this.isRenderable||this.isHiddenValue?"":"GUID : "+this.id+"/TYPE : "+this.type.toString()+"/Screen : /pos : "+this.pts.length+"/Area : "+this.getArea().toFixed(3).toString()+" m2/IsSEL : "+this.isSelectedValue+"/isSelable : "+this.isSelectable},t.prototype.getLogDOM=function(){return"Geometry ID : "+this.id+"<br>geometry Type : CCircle<br>position : <br>size : "+this.r+" pixel<br>"},Object.defineProperty(t.prototype,"IsSelectable",{get:function(){return this.isSelectable},set:function(e){this.isSelectable=e;for(var t=0;t<this.pts.length;++t)this.pts[t].isSelectable=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isHidden",{get:function(){return this.isHiddenValue},set:function(e){this.isHiddenPre=this.isHiddenValue,this.isHiddenValue=e;for(var t=0;t<this.pts.length;++t)this.pts[t].isHiddenValue=e,this.pts[t].visibility=0;this.scene.annotationInstance.io.eventListenerAnnotation.hideStack(this.toJSON())},enumerable:!1,configurable:!0}),t.prototype.mouseRightClick=function(){},t.prototype.findClosestNode=function(e,t){if(!this.isRemove&&this.isRenderable&&!this.isHiddenValue)for(var n=0;n<this.pts.length;++n)if(this.pts[n].isMouseInside(e,t))return this.pts[n]},t.prototype.remove=function(e){if(void 0===e&&(e=!0),!this.isRemove&&this.isRenderable&&!this.isHiddenValue){for(var t=0;t<this.pts.length;++t)this.pts[t].deepRemove();if(this.isSelectable=!1,this.isRenderable=!1,this.hidePopUpSummary(),!this.isUnderConstruction&&e){var n=this.toJSON();n&&this.scene.annotationInstance.io.eventListenerAnnotation.removeGeometryStack([n])}this.scene.removeAPolygonWrapper(this),this.scene.removeGeometry(this)}},t.prototype.deepCopy=function(e,n,o){void 0===o&&(o=0);var i=this.toJSON(),s=t.fromJSON(this.scene,i,!0,!0);return s.move(e,n),s.isHoverValue=!0,s.emitAddStack(),s},t.split=!1,t.isDone=!1,t}(M),H=function(){function e(e,t){void 0===t&&(t=2),this.numToFixed=2,this.geometryBase=e,this.numToFixed=t}return e.prototype.render=function(e,t,n){this.renderLength(e,t,n),this.renderDimTotal(e,n),this.renderTotalArea(e,n)},e.prototype.renderLength=function(e,t,n){for(var o=0;o<n.length-1;++o)n[o].x<n[o+1].x?this.geometryBase.scene.annotationInstance.renderer.draw.shape.line.lineDim(e,this.geometryBase.styleComponent.renderStyle,n[o].x,n[o].y,n[o+1].x,n[o+1].y,0):this.geometryBase.scene.annotationInstance.renderer.draw.shape.line.lineDim(e,this.geometryBase.styleComponent.renderStyle,n[o+1].x,n[o+1].y,n[o].x,n[o].y,0);if(t&&(n[n.length-1].x<n[0].x?this.geometryBase.scene.annotationInstance.renderer.draw.shape.line.lineDim(e,this.geometryBase.styleComponent.renderStyle,n[n.length-1].x,n[n.length-1].y,n[0].x,n[0].y,0):this.geometryBase.scene.annotationInstance.renderer.draw.shape.line.lineDim(e,this.geometryBase.styleComponent.renderStyle,n[0].x,n[0].y,n[n.length-1].x,n[n.length-1].y,0)),t)for(o=0;o<n.length;++o)o===n.length-1?this.geometryBase.scene.annotationInstance.renderer.draw.shape.line.lineDim(e,this.geometryBase.styleComponent.renderStyle,n[o].x,n[o].y,n[0].x,n[0].y,0):n[o].x<n[o+1].x?this.geometryBase.scene.annotationInstance.renderer.draw.shape.line.lineDim(e,this.geometryBase.styleComponent.renderStyle,n[o].x,n[o].y,n[o+1].x,n[o+1].y,0):this.geometryBase.scene.annotationInstance.renderer.draw.shape.line.lineDim(e,this.geometryBase.styleComponent.renderStyle,n[o+1].x,n[o+1].y,n[o].x,n[o].y,0);else for(o=0;o<n.length-1;++o)n[o].x<n[o+1].x?this.geometryBase.scene.annotationInstance.renderer.draw.shape.line.lineDim(e,this.geometryBase.styleComponent.renderStyle,n[o].x,n[o].y,n[o+1].x,n[o+1].y,0):this.geometryBase.scene.annotationInstance.renderer.draw.shape.line.lineDim(e,this.geometryBase.styleComponent.renderStyle,n[o+1].x,n[o+1].y,n[o].x,n[o].y,0)},e.prototype.renderDimTotal=function(e,t){t.length>2&&this.geometryBase.type===r.zq.POLYLINE&&this.renderTotalLength(e,t)},e.prototype.renderTotalArea=function(e,t,n){void 0===n&&(n="")},e.prototype.renderTotalLength=function(e,t){},e.prototype.renderLengthCircle=function(e,t,n){},e.prototype.renderTotalAreaCircle=function(e,t,n){},e.prototype.renderLengthRect=function(e,t){},e.prototype.renderTotalAreaRect=function(e,t,n){void 0===n&&(n="")},e.prototype.renderLengthCurve=function(e,t,n){},e.prototype.renderTotalLengthCurve=function(e,t,n){for(var o=0;o<t.length-1;++o);},e.prototype.renderRemainLengthByValue=function(e,t,n){},e.prototype.renderTotalAreaCurve=function(e,t,n){for(var o=0;o<t.length-1;++o);},e.prototype.renderTotalLengthInput=function(){},e}(),F=function(){function e(e){this.geo=e,this.host=e}return e.prototype.isMouseInside=function(e,t){var n=new r.h9(e,t);return!(this.host.isRemove||!this.host.isRenderable||this.host.isHiddenValue||!0===this.host.isUnderConstruction||void 0===this.host.isUnderConstruction||this.geo.isCollapse||(this.host.isRotate=!1,!this.isMouseInsidePt(n)&&(this.isMouseInsideCPMid(n)||this.isMouseInsideCP(n)?(this.host.isHover=!0,0):(0,r.Sp)(this.host.vecRotationHandler,n)<10?(this.host.isRotate=!0,this.host.isHover=!0,0):this.checkDistance(e,t)?(this.host.isHover=!0,0):!(0,r.xt)(this.host.vec,n,.5*this.host.width,.5*this.host.height)&&(this.host.isHover=!1,1))))},e.prototype.getLog=function(){return"GUID : "+this.host.id+"/TYPE : "+this.host.type.toString()+"/Screen : /Area : "+this.host.getArea().toFixed(3).toString()+" m2/IsSEL : "+this.host.isSelectedValue+"/isSelable : "+this.host.isSelectable},e.prototype.hide=function(){},e.prototype.isMouseInsideCPMid=function(e){for(var t=0;t<this.host.vecsCP.length;++t)if((0,r.Sp)(this.host.vecsCP[t],e)<10)return this.host.vecSelectedCp=t,this.host.isHoverDuplicatedVecs=!1,!0;return this.host.vecSelectedCp=-1,!1},e.prototype.isMouseInsideCP=function(e){for(var t=0;t<this.host.pts.length-1;++t)if((0,r.xs)(e,this.host.pts[t].vec,this.host.pts[t+1].vec)<10)return this.host.isHoverDuplicatedVecs=!1,!0;return!1},e.prototype.isMouseInsidePt=function(e){for(var t=0;t<this.host.pts.length;++t)if((0,r.Sp)(this.host.pts[t].vec,e)<10)return this.host.vecSelected=t,!0;return this.host.vecSelected=-1,!1},e.prototype.checkDistance=function(e,t){return this.geo.scene.annotationInstance.geometryCommon.gcmdProcessing.isMouseInsideByOffScreen(e-this.geo.scene.paramsEditing.croppingMaskParams.x,t-this.geo.scene.paramsEditing.croppingMaskParams.y,this.geo.hashColor)},e.prototype.updateActiveMouseCursor=function(){this.host.vecSelectedCp>-1?this.setMouseCursorMidCP():this.setMouseCursorCP()},e.prototype.setMouseCursorCP=function(){this.host.scene.capturePT?this.host.pts.indexOf(this.host.scene.capturePT)%2==0?this.host.scene.annotationInstance.activeCommandController.activeMouseCursor.setActiveCursor(r.CF.NWSEresize):this.host.scene.annotationInstance.activeCommandController.activeMouseCursor.setActiveCursor(r.CF.NESWresize):this.host.scene.annotationInstance.activeCommandController.activeMouseCursor.setActiveCursorDrag()},e.prototype.setMouseCursorMidCP=function(){-1===this.host.vecSelectedCp&&this.host.scene.annotationInstance.activeCommandController.activeMouseCursor.setActiveCursorDrag(),this.host.vecSelectedCp%2==0?this.host.scene.annotationInstance.activeCommandController.activeMouseCursor.setActiveCursor(r.CF.NSresize):this.host.scene.annotationInstance.activeCommandController.activeMouseCursor.setActiveCursor(r.CF.EWresize)},e.prototype.isMouseInsideSnapFrom=function(e){this.host.vecSelectedSnapping=void 0;for(var t=0;t<this.host.vecsCP.length;t+=1)if((0,r.Sp)(this.host.vecsCP[t],e)<this.host.scene.annotationInstance.activeCommandController.acProperties.toleranceSnapping)return this.host.vecSelectedSnapping=this.host.vecsCP[t],this.host.vecSelectedSnapping;if((0,r.Sp)(this.host.vec,e)<this.host.scene.annotationInstance.activeCommandController.acProperties.toleranceSnapping)return this.host.vecSelectedSnapping=this.host.vec,this.host.vecSelectedSnapping},e.prototype.checkAttachedTextleaderline=function(){if(!this.host.textLeaderline||!this.host.textLeaderline.leaderline)return!1;var e=!1;(0,r.Sp)(this.host.vec,this.host.textLeaderline.leaderline.v2)<5&&(e=!0);for(var t=0;t<this.host.vecsCP.length;++t)(0,r.Sp)(this.host.vecsCP[t],this.host.textLeaderline.leaderline.v2)<5&&(e=!0);return!!e||(this.host.textLeaderline.attachedShape=void 0,this.host.textLeaderline=void 0,!1)},e.prototype.updateLeaderlineSnap=function(e,t){if(this.host.computeCenterVec(),this.host.updateVecsCP(),(0,r.Sp)(this.host.vec,e)<5)this.host.vecSelectedSnapping=this.host.vec;else for(var n=0;n<this.host.vecsCP.length;++n)if((0,r.Sp)(this.host.vecsCP[n],e)<5)return void(this.host.vecSelectedSnapping=this.host.vecsCP[n])},e}(),U=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),j=function(e){function t(t){var n=e.call(this,t)||this;return n.host=t,n}return U(t,e),t.prototype.renderPost=function(e){this.interpolateColor.update(),this.timer.update(),this.timer.updatePopupSummery(),this.host.transformation.updateRotationAbsolute(),(this.host.scene.annotationInstance.activeCommandController.acProperties.isPanning||this.host.scene.annotationInstance.activeCommandController.acProperties.extentChanging)&&this.host.computeVec(),this.host.scene.annotationInstance.activeCommandController.acProperties.showUnit&&this.host.isConstraintRatio&&this.host.isHoverValue&&(e.textAlign="center",e.fillStyle="#ffffff",100<Math.abs(this.host.width)&&e.fillText("constrained by ratio",this.host.vec.x,this.host.vec.y)),this.host.scene.annotationInstance.activeCommandController.acProperties.showUnit&&(this.host.isHoverValue||this.host.isUnderConstruction)&&(this.host.dimension.renderLengthRect(e,this.host.vecs),this.host.isConstraintRatio?this.host.dimension.renderTotalAreaRect(e,this.host.vecs,", constrained by ratio"):this.host.dimension.renderTotalAreaRect(e,this.host.vecs)),this.renderPostGeometry(e,this.host.scene.annotationInstance.geometryCommon.gcmdSupporting.toScreenVecsOnCropping(this.host.getVecs()))},t.prototype.renderPostGeometry=function(e,t){var n=this.host.scene.annotationInstance.geometryCommon.gcmdSupporting.toScreenVecOnCropping(this.host.vec),o=Math.abs(this.host.vecsCP[1].x-this.host.vecsCP[0].x),i=Math.abs(.5*(this.host.vecsCP[2].y-this.host.vecsCP[0].y));this.host.updateVecsCP(),this.host.isHoverValue||this.host.isSelectedValue?(this.host.scene.annotationInstance.renderer.draw.shape.area.ellipseHover(e,this.host.styleComponent.renderStyle,n.x,n.y,o,i,this.host.isGrayColor,this.host.visibilityValue,this.host.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.host.renderer.tOver),this.host.isHoverValue,this.host.isSelectedValue),this.host.renderer.tOver+=this.host.scene.annotationInstance.renderer.dt,this.host.renderer.tDown1=0,this.host.isLeave=!0,this.host.scene.annotationInstance.implementations.app.model.appCoreWrapper.appControllerStatus.mode===r.An.Drawing&&this.host.enableRotate&&this.renderRotationHandler(e)):this.host.renderer.tOver=0,this.host.scene.annotationInstance.renderer.draw.shape.area.ellipse(e,this.host.styleComponent.renderStyle,n.x,n.y,o,i,!0,!0,!1),(this.host.isHoverValue||this.host.isSelectedValue||this.host.isUnderConstruction)&&this.host.scene.annotationInstance.implementations.app.model.appCoreWrapper.appControllerStatus.mode===r.An.Drawing&&(this.host.scene.annotationInstance.renderer.draw.shape.point.centerPointCircle(e,n.x,n.y),this.renderBoundingBox(e,t),this.renderCP(e,this.host.vecsCP)),this.t+=this.host.scene.annotationInstance.renderer.dt,this.renderPostGeometryOffScreen(n)},t.prototype.renderCP=function(e,t){if(this.host.scene.annotationInstance.implementations.app.model.appCoreWrapper.appControllerStatus.mode===r.An.Drawing&&this.host.isHoverValue||this.host.isSelectedValue||this.host.isUnderConstruction)for(var n=0;n<t.length;++n){var o=this.host.scene.annotationInstance.geometryCommon.gcmdSupporting.toScreenVecOnCropping(t[n]);this.host.scene.annotationInstance.renderer.draw.shape.node.nodeHover(e,this.host.pts[0].styleComponent.renderStyle,o.x,o.y,this.host.scene.annotationInstance.graphicsCoreWrapper.scaleScreenByRatioImageSize,1)}},t.prototype.renderPostGeometryOffScreen=function(e){this.host.scene.annotationInstance.renderer.offscreen.ellipseOffScreen(this.host.scene.annotationInstance.renderer.ctxOffscreen,this.host.styleComponent.renderStyle,this.host.hashColor,e.x,e.y,.5*Math.abs(this.host.width),.5*Math.abs(this.host.height),this.host.isFill)},t.prototype.renderBoundingBox=function(e,t){e.globalAlpha=1,e.lineWidth=1,e.strokeStyle=this.host.styleComponent.renderStyle.colorStroke,e.beginPath(),e.moveTo(t[0].x,t[0].y),e.lineTo(t[1].x,t[1].y),e.lineTo(t[2].x,t[2].y),e.lineTo(t[3].x,t[3].y),e.closePath(),e.stroke()},t.prototype.renderRotationHandler=function(e){this.host.isHover&&(this.host.enableRotate&&this.host.transformation.updateRotationHandler(),e.strokeStyle=this.host.styleComponent.renderStyle.colorStroke,e.beginPath(),e.moveTo(this.host.vecRotationHandler.x,this.host.vecRotationHandler.y),e.lineTo(this.host.vecs[0].x+.5*(this.host.vecs[1].x-this.host.vecs[0].x),this.host.vecs[0].y+.5*(this.host.vecs[1].y-this.host.vecs[0].y)),e.closePath(),e.stroke(),e.fillStyle=this.host.styleComponent.renderStyle.colorStroke,e.beginPath(),e.arc(this.host.vecRotationHandler.x,this.host.vecRotationHandler.y,7,0,2*Math.PI),e.closePath(),e.fill())},t}(C),q=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),J=function(e){function t(t){var n=e.call(this,t)||this;return n.updateStyle(),n.updateColor(),n}return q(t,e),t.prototype.updateStyle=function(){if(!this.isCustom){this.state.themeColorId=s.AccentColor1,this.isCustom=!0,x.updateRenderStylePolygon(this.renderStyle,this.geo.scene.annotationInstance.customization.themeCurrent),x.updateRenderStylePolygonNode(this.renderStyleNode,this.geo.scene.annotationInstance.customization.themeCurrent);for(var e=0;e<this.geo.pts.length;++e)this.geo.pts[e].styleComponent.updateStyleForNode(this.renderStyleNode)}},t.prototype.updateColor=function(e){void 0===e&&(e=void 0),this.isCustom=!0,void 0===e&&(e=this.geo.scene.annotationInstance.activeCommandController.activeColorController.activeColor),x.updateRenderColorPolygon(this.renderStyle,this.geo.scene.annotationInstance.customization.themeCurrent,e,[0,0,0,0]),x.updateRenderColorPolygonNode(this.renderStyleNode,this.geo.scene.annotationInstance.customization.themeCurrent,e);for(var t=0;t<this.geo.pts.length;++t)this.geo.pts[t].styleComponent.updateStyleForNode(this.renderStyleNode);this.tempColorRgba=e},t.prototype.updateStyleCustom=function(e){if(e.width&&(this.state.width=e.width),void 0!==e.color&&(this.state.themeColorId=e.color),e.colorRgba.length>0&&e.fill.length>0){this.tempColorRgba=e.colorRgba,this.tempFillRgba=e.fill,x.updateRenderStylePolygonCustom(this.renderStyle,this.geo.scene.annotationInstance.customization.themeCurrent,e.colorRgba,e.fill),x.updateRenderStylePolygonNodeCustom(this.renderStyleNode,this.geo.scene.annotationInstance.customization.themeCurrent,e.colorRgba,e.fill);for(var t=0;t<this.geo.pts.length;++t)this.geo.pts[t].styleComponent.updateStyleForNode(this.renderStyleNode)}return e.scale&&(this.renderStyle.scaleLocal=e.scale,this.state.scale=e.scale),this.isCustom=!0,!0},t.prototype.setDash=function(e){this.renderStyle.dash=e,this.geo.scene.annotationInstance.io.eventListenerAnnotation.addGeometryStack(this.geo.toJSON())},t.prototype.toJson=function(){if(this.isCustom){var e={width:this.state.width,scale:this.renderStyle.scaleLocal,colorRgba:this.tempColorRgba,fill:this.tempFillRgba};return this.state.themeColorId!==s.AccentColor1&&(e.color=this.state.themeColorId),e}},t.prototype.isSameStyle=function(e){if(e.colorRgba.length===this.tempColorRgba.length||e.fill.length===this.tempFillRgba){for(var t=0;t<e.colorRgba.length;t++)if(e.colorRgba[t]!==this.tempColorRgba[t])return!1;for(t=0;t<e.fill.length;t++)if(e.fill[t]!==this.tempFillRgba[t])return!1}return!0},t}(b),Y=function(){function e(e){this.geo=e}return e.prototype.translateByMouseEventData=function(e){},e.prototype.translate=function(e,t){},e.prototype.move=function(e,t){},e}(),X=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),K=function(e){function t(t){var n=e.call(this,t)||this;return n.anglePre=0,n.angle=0,n.geo=t,n.host=t,n}return X(t,e),t.prototype.translateByMouseEventData=function(e){if(this.host.vecSelected>-1)this.translateByMouseEventDataNode(e,this.host.vecSelected);else if(this.host.isRotate)this.rotatingShape(e.x,e.y);else if(!this.host.isRemove&&this.host.isRenderable&&!this.host.isHiddenValue){var t=e.x-e.preX,n=e.y-e.preY;if(-1!==this.host.vecSelectedCp)return this.translateCPByMouseEventData(e),this.host.computeCenterVec(),void this.updateTextleaderlineVec();if(-1!==this.host.vecSelected)return this.host.pts[this.host.vecSelected].translateByMouseEventData(e),this.host.computeCenterVec(),void this.updateTextleaderlineVec();for(var o=0;o<this.host.pts.length;++o)this.host.pts[o].vec.x+=t,this.host.pts[o].vec.y+=n;this.host.computeCenterVec(),this.host.textLeaderline&&(this.host.vecSelectedSnapping||this.host.updateLeaderlineSnap(this.host.textLeaderline.vec,5),this.updateTextleaderlineVec(),this.host.textLeaderline.translateByMouseEventData(e))}},t.prototype.translate=function(e,t){},t.prototype.updateRotationAbsolute=function(){this.angle=180*Math.atan2(this.host.vecRotationHandler.y-this.host.vec.y,this.host.vecRotationHandler.x-this.host.vec.x)/Math.PI},t.prototype.translateCPByMouseEventData=function(e){if(0===this.host.vecSelectedCp){var t=e.y-this.host.pts[0].vec.y;this.host.pts[0].vec.y+=t,this.host.pts[1].vec.y+=t,this.host.height<16&&(this.host.pts[0].vec.y-=t,this.host.pts[1].vec.y-=t)}else if(2===this.host.vecSelectedCp)t=e.y-this.host.pts[2].vec.y,this.host.pts[2].vec.y+=t,this.host.pts[3].vec.y+=t,this.host.height<16&&(this.host.pts[2].vec.y-=t,this.host.pts[3].vec.y-=t);else if(1===this.host.vecSelectedCp){var n=this.host.isHoverDuplicatedVecs?e.x:e.x-this.host.pts[1].vec.x;this.host.pts[1].vec.x+=n,this.host.pts[2].vec.x+=n,this.host.width<16&&(this.host.pts[1].vec.x-=n,this.host.pts[2].vec.x-=n)}else 3===this.host.vecSelectedCp&&(n=this.host.isHoverDuplicatedVecs?e.x:e.x-this.host.pts[0].vec.x,this.host.pts[0].vec.x+=n,this.host.pts[3].vec.x+=n,this.host.width<16&&(this.host.pts[0].vec.x-=n,this.host.pts[3].vec.x-=n))},t.prototype.translateByMouseEventDataNode=function(e,t){for(var n=0;n<this.host.pts.length;++n)this.host.pts[n].isRenderable=!0;this.host.textLeaderline&&!this.host.vecSelectedSnapping&&this.host.updateLeaderlineSnap(this.host.textLeaderline.vec,5);var o=e.x-e.preX,i=e.y-e.preY;0===t||2===t?Math.abs(o)>Math.abs(i)?i=o:o=i:1!==t&&3!==t||(Math.abs(o)>Math.abs(i)?i=-1*o:o=-1*i),this.host.isConstraintRatio?this.computeConstraintRatio(t,o,i):0===t?(this.translatePt(0,o,i),this.translatePt(3,o,0),this.translatePt(1,0,i),(this.host.width<16||this.host.height<16)&&(this.translatePt(0,-o,-i),this.translatePt(3,-o,0),this.translatePt(1,0,-i))):1===t?(this.translatePt(1,o,i),this.translatePt(2,o,0),this.translatePt(0,0,i),(this.host.width<16||this.host.height<16)&&(this.translatePt(1,-o,-i),this.translatePt(2,-o,0),this.translatePt(0,0,-i))):2===t?(this.translatePt(2,o,i),this.translatePt(1,o,0),this.translatePt(3,0,i),(this.host.width<16||this.host.height<16)&&(this.translatePt(2,-o,-i),this.translatePt(1,-o,0),this.translatePt(3,0,-i))):3===t&&(this.translatePt(3,o,i),this.translatePt(0,o,0),this.translatePt(2,0,i),(this.host.width<16||this.host.height<16)&&(this.translatePt(3,-o,-i),this.translatePt(0,-o,0),this.translatePt(2,0,-i))),this.host.computeCenterVec(),this.host.transformation.updateTextleaderlineVec()},t.prototype.translatePt=function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=0),this.host.pts[e].vec.x+=t,this.host.pts[e].vec.y+=n},t.prototype.updateTextleaderlineVec=function(){var e=0;this.host.vecSelectedSnapping&&this.host.textLeaderline&&this.host.textLeaderline.leaderline&&(e=this.host.textLeaderline.leaderline.v2.x-this.host.vecSelectedSnapping.x,this.host.textLeaderline.leaderline.v2.x=this.host.vecSelectedSnapping.x,this.host.textLeaderline.widthOffset+=e,e=this.host.textLeaderline.leaderline.v2.y-this.host.vecSelectedSnapping.y,this.host.textLeaderline.leaderline.v2.y=this.host.vecSelectedSnapping.y,this.host.textLeaderline.heightOffset+=e,this.host.textLeaderline.computeCenterVec())},t.prototype.rotatingShape=function(e,t){var n=180*Math.atan2(t-this.host.vec.y,e-this.host.vec.x)/Math.PI-this.angle,o=this.rotateVecsLoal([this.host.vecRotationHandler],this.host.vec,n);this.host.vecRotationHandler.x=o[0].x,this.host.vecRotationHandler.y=o[0].y,this.host.vecRotationHandler.z=o[0].z,o=this.rotateVecsLoal(this.host.vecs,this.host.vec,n),this.host.vecs[0].x=o[0].x,this.host.vecs[0].y=o[0].y,this.host.vecs[0].z=o[0].z,this.host.vecs[1].x=o[1].x,this.host.vecs[1].y=o[1].y,this.host.vecs[1].z=o[1].z,this.host.vecs[2].x=o[2].x,this.host.vecs[2].y=o[2].y,this.host.vecs[2].z=o[2].z,this.host.vecs[3].x=o[3].x,this.host.vecs[3].y=o[3].y,this.host.vecs[3].z=o[3].z,this.angle+=n},t.prototype.rotateVecsLoal=function(e,t,n){var o=new r.h9(-t.x,-t.y,-t.z),i=(0,r.Vt)(e,o);return i=(0,r.DM)(i,n),(0,r.Vt)(i,t)},t.prototype.updateRotationHandler=function(){this.host.vecRotationHandler.x=this.host.vecs[0].x+.5*(this.host.vecs[1].x-this.host.vecs[0].x),this.host.vecRotationHandler.y=this.host.vecs[0].y+.5*(this.host.vecs[1].y-this.host.vecs[0].y);var e=(0,r.ir)(this.host.vecs[0],this.host.vecs[1]),t=new r.h9(this.host.vecs[1].x-this.host.vecs[0].x,this.host.vecs[1].y-this.host.vecs[0].y,this.host.vecs[1].z-this.host.vecs[0].z),n=(0,r.ir)(e,t);n.unitize(),this.host.vecRotationHandler.x+=20*n.x,this.host.vecRotationHandler.y+=20*n.y,(0,r.Sp)(this.host.vec,this.host.vecRotationHandler)<.5*this.host.height&&(this.host.vecRotationHandler.x+=40*-n.x,this.host.vecRotationHandler.y+=40*-n.y)},t.prototype.computeConstraintRatio=function(e,t,n){var o=this.resizeConstraintRatio();if(0===e)if(Math.abs(t)>Math.abs(n)){var i=(0,r.kC)(o[0],o[1],o[0]+t);this.host.pts[e].vec.x+=t,this.host.pts[e].vec.y-=o[1]-i[1],this.host.pts[e+1].vec.y-=o[1]-i[1],this.host.pts[e+3].vec.x+=t}else i=(0,r.Ux)(o[0],o[1],o[1]+n),this.host.pts[e].vec.x-=o[0]-i[0],this.host.pts[e].vec.y+=n,this.host.pts[e+1].vec.y+=n,this.host.pts[e+3].vec.x-=o[0]-i[0];else 1===e?Math.abs(t)>Math.abs(n)?(this.host.pts[e].vec.x+=t,i=(0,r.kC)(o[0],o[1],o[0]+t),this.host.pts[e].vec.y+=o[1]-i[1],this.host.pts[e+1].vec.x+=t,this.host.pts[e-1].vec.y+=o[1]-i[1]):(i=(0,r.Ux)(o[0],o[1],o[1]+n),this.host.pts[e].vec.x+=o[0]-i[0],this.host.pts[e].vec.y+=n,this.host.pts[e+1].vec.x+=o[0]-i[0],this.host.pts[e-1].vec.y+=n):2===e?Math.abs(t)>Math.abs(n)?(i=(0,r.kC)(o[0],o[1],o[0]+t),this.host.pts[e].vec.x+=t,this.host.pts[e].vec.y=this.host.pts[0].vec.y+i[1],this.host.pts[e-1].vec.x+=t,this.host.pts[e+1].vec.y=this.host.pts[0].vec.y+i[1]):(i=(0,r.Ux)(o[0],o[1],o[1]+n),this.host.pts[e].vec.x=this.host.pts[0].vec.x+i[0],this.host.pts[e].vec.y+=n,this.host.pts[e-1].vec.x=this.host.pts[0].vec.x+i[0],this.host.pts[e+1].vec.y+=n):3===e&&(Math.abs(t)>Math.abs(n)?(i=(0,r.kC)(o[0],o[1],o[0]+t),this.host.pts[e].vec.x+=t,this.host.pts[e].vec.y+=o[1]-i[1],this.host.pts[e-1].vec.y+=o[1]-i[1],this.host.pts[0].vec.x+=t):(i=(0,r.Ux)(o[0],o[1],o[1]+n),this.host.pts[e].vec.x+=o[0]-i[0],this.host.pts[e].vec.y+=n,this.host.pts[e-1].vec.y+=n,this.host.pts[0].vec.x+=o[0]-i[0]))},t.prototype.resizeConstraintRatio=function(){return[this.host.pts[1].vec.x-this.host.pts[0].vec.x,this.host.pts[2].vec.y-this.host.pts[1].vec.y]},t}(Y),$=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Q=function(e){function t(t,n,o,i,s,a){void 0===i&&(i=0),void 0===s&&(s=!1),void 0===a&&(a=8);var h=e.call(this,t)||this;h.vecsCP=[],h.vecRotationHandler=new r.h9(0,0,0),h.isRotate=!1,h.isHoverDuplicatedVecs=!1,h.vecSelected=-1,h.vecSelectedCp=-1,h.enableRotate=!1,h.type=r.zq.CIRCLE,h.pts=[],h.pts.push(new k(t,n,o,0,s)),h.pts.push(new k(t,n,o,0,s)),h.pts.push(new k(t,n,o,0,s)),h.pts.push(new k(t,n,o,0,s));for(var c=0;c<h.pts.length;++c)s&&(h.pts[c].isHoverValue=!1),h.pts[c].type=r.zq.ANODE_CIRCLE;return h.lineWidth=a,h.initComponent(),h.initVecsCP(),h.computeRecPts(),h.isConstraintRatio=!1,h.initShape(),h}return $(t,e),t.getRectangleFromVoice=function(e){var t=new r.h9(.5*e.annotationInstance.geometryCommon.gcmdProcessing.width,.5*e.annotationInstance.geometryCommon.gcmdProcessing.height);this.getRectByVecs(e,[new r.h9(t.x-100,t.y-100),new r.h9(t.x+100,t.y-100),new r.h9(t.x+100,t.y+100),new r.h9(t.x-100,t.y+100)])},t.findAtPoint=function(e){},t.computeOver=function(e){t.findAtPoint(e)},t.getRectByVecs=function(e,n){var o=(0,r.HP)(n),i=new t(e,o[0].x,o[0].y,0,!1),s=o[1].x-o[0].x,a=o[1].y-o[0].y;i.pts[1].vec.x+=s,i.pts[2].vec.x+=s,i.pts[2].vec.y+=a,i.pts[3].vec.y+=a,i.IsSelectable=!0,i.isUnderConstruction=!1,i.updatePos(2,i.pts[1].vec.x+1,i.pts[3].vec.y+1,0),e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(i.toJSON())},t.getRectByTouch=function(e,t){var n=new r.h9(t.x,t.y,0);this.getRectByVecs(e,[new r.h9(n.x-100,n.y-100),new r.h9(n.x+100,n.y-100),new r.h9(n.x+100,n.y+100),new r.h9(n.x-100,n.y+100)])},t.getRect=function(e,n){if(void 0===t.construction)return t.construction=new t(e,n.x,n.y),void(t.construction.IsSelectable=!1);t.construction.isUnderConstruction=!1,t.construction.IsSelectable=!0,t.construction.updatePos(2,t.construction.pts[1].vec.x,t.construction.pts[3].vec.y+.1,0),e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(t.construction.toJSON()),t.construction=void 0},t.getRectByPt=function(e){},t.drawShadow=function(e,n){void 0===t.construction?new k(e,n.x,n.y,0).isSelectable=!1:(t.construction.pts[1].move(n.x,t.construction.pts[1].vec.y),t.construction.pts[2].move(n.x,n.y),t.construction.pts[3].move(t.construction.pts[3].vec.x,n.y),t.construction.computeCenterVec())},t.fromJSON=function(e,n,o,i){void 0===o&&(o=!1),void 0===i&&(i=!1);var s=k.getNodeFromJSON(e,n.nodes[0],o),a=new t(e,s.vec.x,s.vec.y,0,o);s.remove();for(var h=1;h<a.pts.length;++h){var c=k.getNodeFromJSON(e,n.nodes[h],o);a.pts[h].vec.x=c.vec.x,a.pts[h].vec.y=c.vec.y,a.pts[h].type=r.zq.ANODE_CIRCLE,c.remove()}return a.type=r.zq[n.type],a.isHiddenValue=n.isHidden,n.isHidden?a.visibility=0:a.visibility=1,n.styles&&n.styles.dash&&(a.styleComponent.renderStyle.dash=n.styles.dash),a.id=i?e.getUUID():n.id,a.IsSelectable=!0,a.isUnderConstruction=!1,a.isHover=!1,n.styles&&a.updateStyleCustom(n.styles),a.initVecsHistory(),a.computeCenterVec(),o||e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(a.toJSON()),a},t.cancel=function(){void 0!==t.construction&&t.construction.remove(),t.construction=void 0},t.mouseDown=function(e,t){},t.onMouseLeftClick=function(e,n,o,i){void 0===o&&(o=128),void 0===i&&(i=128),t.construction&&t.construction.remove();var s=new t(e,n.x-.5*o,n.y-.5*i);s.pts[1].vec.x+=o,s.pts[2].vec.x+=o,s.pts[2].vec.y+=i,s.pts[3].vec.y+=i,s.computeCenterVec(),s.IsSelectable=!0,s.isUnderConstruction=!1,s.isHover=!1,s.emitAddStack(),e.annotationInstance.activeCommandController.goToACMode()},t.onMouseMiddleClick=function(e){},t.onMouseRightClick=function(e){},t.onMouseDoubleClick=function(e){},t.onMouseMove=function(e,n){void 0!==t.construction&&t.drawShadow(e,n)},t.onMouseDrag=function(e,n){void 0!==t.construction?t.drawShadow(e,n):(e.annotationInstance.geometryCommon.gcmdSelecting.deSelectAllObjects(),t.getRect(e,n))},t.onMouseUp=function(e,n){t.construction&&(t.swap(t.construction),e.annotationInstance.activeCommandController.goToACMode(),t.construction.IsSelectable=!0,t.construction.isUnderConstruction=!1,t.construction.isHover=!1,(0,r.Sp)(t.construction.pts[0].vec,t.construction.pts[1].vec)<5&&(t.construction.pts[0].vec.x+=-60,t.construction.pts[0].vec.y+=-60,t.construction.pts[1].vec.x+=60,t.construction.pts[1].vec.y+=-60,t.construction.pts[2].vec.x+=60,t.construction.pts[2].vec.y+=60,t.construction.pts[3].vec.x+=-60,t.construction.pts[3].vec.y+=60),t.construction.isSelectedValue=!1,t.construction.isSelected=!1,t.construction.computeCenterVec(),t.construction.emitAddStack(),t.construction=void 0,t.isDone=!0)},t.swap=function(e){var t,n,o=0;e.pts[0].vec.x>e.pts[1].vec.x&&(t=e.pts[0].vec.x,n=e.pts[0].vec.y,o=e.pts[0].vec.z,e.pts[0].vec.x=e.pts[1].vec.x,e.pts[0].vec.y=e.pts[1].vec.y,e.pts[0].vec.z=e.pts[1].vec.z,e.pts[1].vec.x=t,e.pts[1].vec.y=n,e.pts[1].vec.z=o,t=e.pts[3].vec.x,n=e.pts[3].vec.y,o=e.pts[3].vec.z,e.pts[3].vec.x=e.pts[2].vec.x,e.pts[3].vec.y=e.pts[2].vec.y,e.pts[3].vec.z=e.pts[2].vec.z,e.pts[2].vec.x=t,e.pts[2].vec.y=n,e.pts[2].vec.z=o),e.pts[0].vec.y>e.pts[3].vec.y&&(t=e.pts[0].vec.x,n=e.pts[0].vec.y,o=e.pts[0].vec.z,e.pts[0].vec.x=e.pts[3].vec.x,e.pts[0].vec.y=e.pts[3].vec.y,e.pts[0].vec.z=e.pts[3].vec.z,e.pts[3].vec.x=t,e.pts[3].vec.y=n,e.pts[3].vec.z=o,t=e.pts[1].vec.x,n=e.pts[1].vec.y,o=e.pts[1].vec.z,e.pts[1].vec.x=e.pts[2].vec.x,e.pts[1].vec.y=e.pts[2].vec.y,e.pts[1].vec.z=e.pts[2].vec.z,e.pts[2].vec.x=t,e.pts[2].vec.y=n,e.pts[2].vec.z=o)},t.prototype.initComponent=function(){this.styleComponent=new J(this),this.renderer=new j(this),this.interaction=new F(this),this.transformation=new K(this)},t.prototype.initShape=function(){this.dimension=new H(this),this.isFill=!0,this.scene.addACircleWrapper(this)},t.prototype.computeCenterVec=function(){var e=(0,r.mI)([this.pts[0].vec,this.pts[1].vec,this.pts[2].vec,this.pts[3].vec]);return this.vec.x=e.x,this.vec.y=e.y,this.vec},t.prototype.computeRecPts=function(){var e=this.pts[0].vec,t=this.pts[2].vec,n=0,o=0,i=0;n=e.x<t.x?e.x:t.x,o=e.y<t.y?e.y:t.y,i=e.z<t.z?e.z:t.z;var s=new r.h9(n,o,i);n=e.x>t.x?e.x:t.x,o=e.y>t.y?e.y:t.y,i=e.z>t.z?e.z:t.z;var a=new r.h9(n,o,i);this.updatePos(1,a.x,s.y,s.z),this.updatePos(3,s.x,a.y,s.z);for(var h=0;h<this.pts.length;++h)this.pts[h].addEdge(this),this.pts[h].type=r.zq.ANODE_CIRCLE;this.updateVecsCP()},t.prototype.getRelatedVec=function(){for(var e=[],t=0;t<this.pts.length;++t){var n=this.pts[t];e.push(new r.h9(n.vec.x-this.vec.x,n.vec.y-this.vec.y,n.vec.z-this.vec.z))}},t.prototype.updatePos=function(e,t,n,o){this.pts[e].vec.x=t,this.pts[e].vec.y=n,this.pts[e].vec.z=o},t.prototype.getNodePopup=function(){return this.pts[this.pts.length-2]},t.prototype.getArea=function(){return(this.pts[1].vec.x-this.pts[0].vec.x)*(this.pts[2].vec.y-this.pts[0].vec.y)},t.prototype.getLog=function(){return this.interaction.getLog()},Object.defineProperty(t.prototype,"visibility",{set:function(e){this.visibilityValue=e;for(var t=0;t<this.pts.length;++t)this.pts[t].visibilityValue=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"IsHiddenChildren",{set:function(e){this.isHiddenPre=this.isHiddenValue,this.isHiddenValue=e;for(var t=0;t<this.pts.length;++t)this.pts[t].isHiddenValue=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isHidden",{set:function(e){this.isHiddenPre=this.isHiddenValue,this.isHiddenValue=e,this.IsHiddenChildren=e,this.scene.annotationInstance.io.eventListenerAnnotation.hideStack(this.toJSON())},enumerable:!1,configurable:!0}),t.prototype.move=function(e,t){if(!this.isRemove&&this.isRenderable&&!this.isHiddenValue){for(var n=e-this.vec.x-.5*(this.pts[1].vec.x-this.pts[0].vec.x),o=t-this.vec.y-.5*(this.pts[2].vec.y-this.pts[0].vec.y),i=0;i<this.pts.length;++i)this.pts[i].vec.x+=n,this.pts[i].vec.y+=o;this.computeCenterVec()}},t.prototype.goToBlackhole=function(){this.isSelectable=!1,this.needBlackhole=!0,this.pts.forEach((function(e){e.goToBlackhole()}))},t.prototype.translateByMouseEventData=function(e){return this.transformation.translateByMouseEventData(e)},t.prototype.translate=function(e,t){return this.transformation.translate(e,t)},t.prototype.computeConstraintRatio=function(e,t,n){return this.transformation.computeConstraintRatio(e,t,n)},t.prototype.isMouseInside=function(e,t){return this.interaction.isMouseInside(e,t)},t.prototype.updateVecsBySnapping=function(e,t,n){for(var o=-1,i=0;i<this.pts.length;++i)e===this.pts[i]&&(o=i);0===o?(this.pts[1].vec.y+=n,this.pts[3].vec.x+=t):1===o?(this.pts[0].vec.y+=n,this.pts[2].vec.x+=t):2===o?(this.pts[3].vec.y+=n,this.pts[1].vec.x+=t):3===o&&(this.pts[2].vec.y+=n,this.pts[0].vec.x+=t),this.computeCenterVec()},t.prototype.initVecsCP=function(){this.vecsCP.push(new r.h9(this.pts[0].vec.x+.5*(this.pts[1].vec.x-this.pts[0].vec.x),this.pts[0].vec.y+.5*(this.pts[1].vec.y-this.pts[0].vec.y),0)),this.vecsCP.push(new r.h9(this.pts[1].vec.x+.5*(this.pts[2].vec.x-this.pts[1].vec.x),this.pts[1].vec.y+.5*(this.pts[2].vec.y-this.pts[1].vec.y),0)),this.vecsCP.push(new r.h9(this.pts[2].vec.x+.5*(this.pts[3].vec.x-this.pts[2].vec.x),this.pts[2].vec.y+.5*(this.pts[3].vec.y-this.pts[2].vec.y),0)),this.vecsCP.push(new r.h9(this.pts[3].vec.x+.5*(this.pts[0].vec.x-this.pts[3].vec.x),this.pts[3].vec.y+.5*(this.pts[0].vec.y-this.pts[3].vec.y),0))},t.prototype.updateVecsCP=function(){this.vecsCP[0].x=this.pts[0].vec.x+.5*(this.pts[1].vec.x-this.pts[0].vec.x),this.vecsCP[0].y=this.pts[0].vec.y+.5*(this.pts[1].vec.y-this.pts[0].vec.y),this.vecsCP[1].x=this.pts[1].vec.x+.5*(this.pts[2].vec.x-this.pts[1].vec.x),this.vecsCP[1].y=this.pts[1].vec.y+.5*(this.pts[2].vec.y-this.pts[1].vec.y),this.vecsCP[2].x=this.pts[2].vec.x+.5*(this.pts[3].vec.x-this.pts[2].vec.x),this.vecsCP[2].y=this.pts[2].vec.y+.5*(this.pts[3].vec.y-this.pts[2].vec.y),this.vecsCP[3].x=this.pts[3].vec.x+.5*(this.pts[0].vec.x-this.pts[3].vec.x),this.vecsCP[3].y=this.pts[3].vec.y+.5*(this.pts[0].vec.y-this.pts[3].vec.y)},t.prototype.getVecs=function(){this.vecs=[];for(var e=0;e<this.pts.length;++e)this.vecs.push(this.pts[e].vec);return this.vecs},t.prototype.remove=function(e){void 0===e&&(e=!0);for(var t=0;t<this.pts.length;++t)this.pts[t].remove();if(e){var n=this.toJSON();n&&this.scene.annotationInstance.io.eventListenerAnnotation.removeGeometryStack([n])}this.deepRemove()},t.prototype.deepRemove=function(){this.isSelectable=!1,this.isRenderable=!1,this.hidePopUpSummary(),this.scene.removeACircle(this),this.scene.removeGeometry(this)},t.prototype.getParentType=function(){return"ACircle,ID:"+this.id},t.prototype.hide=function(){throw new Error("Method not implemented.")},Object.defineProperty(t.prototype,"IsSelectable",{get:function(){return this.isSelectable},set:function(e){this.isSelectable=e;for(var t=0;t<this.pts.length;++t)this.pts[t].isSelectable=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"IsRenderable",{set:function(e){this.isRenderable=e;for(var t=0;t<this.pts.length;++t)this.pts[t].isRenderable=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isSelected",{get:function(){return this.isSelectedValue},set:function(e){this.isSelectedValue=e;for(var t=0,n=this.pts;t<n.length;t++){var o=n[t];o.isRenderable=e,o.isSelectable=e,o.isSelectedValue=e}this.scene.annotationInstance.io.eventListenerAnnotation.selectionStack(this.toJSON())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isHover",{get:function(){return this.isHoverValue},set:function(e){if(!this.isUnderConstruction){if(this.isHoverValue=e,(this.isHoverValue&&!this.isHoverPre||!this.isHoverValue&&this.isHoverPre)&&this.scene.annotationInstance.io.eventListenerAnnotation.hoverStack(this.toJSON()),this.isHoverPre=this.isHoverValue,!this.isSelectedValue)for(var t=0,n=this.pts;t<n.length;t++){var o=n[t];o.isRenderable=e,o.isSelectable=e}e||(this.needEmitHoverPost=!0,this.hidePopUpSummary())}},enumerable:!1,configurable:!0}),t.prototype.getNode=function(){for(var e=[],t=0;t<this.pts.length;++t)e.push(this.pts[t].vec);return e},t.prototype.toJSON=function(){var e=new p(this.id,this.type,this.isSelectedValue,this.isHoverValue,this.isHiddenValue);e.pushNode(this.getNode());var t=this.styleComponent.toJson();return t&&(e.styles=t),e},t.prototype.deepCopy=function(e,n,o){void 0===o&&(o=0);var i=this.toJSON(),s=t.fromJSON(this.scene,i,!0,!0);return s.move(e,n),s.emitAddStack(),s},Object.defineProperty(t.prototype,"width",{get:function(){return this.pts[1].vec.x-this.pts[0].vec.x},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.pts[2].vec.y-this.pts[1].vec.y},enumerable:!1,configurable:!0}),t.prototype.computeBoundingVecs=function(){this.vecs=[];for(var e=0;e<this.pts.length;++e)this.vecs.push(this.pts[e].vec)},t.prototype.getBoundary=function(){return this.getVecs()},t.prototype.computeVec=function(){this.computeCenterVec(),this.computeBoundingVecs(),this.updateVecsCP()},t.prototype.mouseRightClick=function(){this.isFill=!this.isFill,this.isConstraintRatio=!this.isConstraintRatio},t.prototype.updateActiveCursor=function(){this.interaction.updateActiveMouseCursor()},t.prototype.renderPost=function(e){this.renderer.renderPost(e)},t.prototype.getVecForSnapping=function(){return this.vecSelectedSnapping},t.prototype.isMouseInsideSnapFrom=function(e){return this.interaction.isMouseInsideSnapFrom(e)},t.prototype.CheckAttachedTextleaderline=function(){return this.interaction.checkAttachedTextleaderline()},t.prototype.updateLeaderlineSnap=function(e,t){return this.interaction.updateLeaderlineSnap(e,t)},t.isDone=!1,t.split=!1,t.isConstraintRatio=!1,t}(y),Z=function(){function e(e){this.geo=e,this.host=e}return e.prototype.isMouseInside=function(e,t){var n=new r.h9(e,t);return!(this.host.isRemove||!this.host.isRenderable||this.host.isHiddenValue||!0===this.host.isUnderConstruction||void 0===this.host.isUnderConstruction||this.geo.isCollapse||(this.host.isRotate=!1,(0,r.Sp)(this.host.vecRotationHandler,n)<10?(this.host.isRotate=!0,this.host.isHover=!0,0):!this.isMouseInsidePt(n)&&!this.isMouseInsideCP(n)&&(this.checkDistance(e,t)?(this.host.isHover=!0,0):(this.host.isHover=!1,1))))},e.prototype.getLog=function(){return"GUID : "+this.host.id+"/TYPE : "+this.host.type.toString()+"/Screen : /Area : "+this.host.getArea().toFixed(3).toString()+" m2/IsSEL : "+this.host.isSelectedValue+"/isSelable : "+this.host.isSelectable},e.prototype.hide=function(){},e.prototype.isMouseInsidePt=function(e){for(var t=0;t<this.host.pts.length;++t)if((0,r.Sp)(this.host.pts[t].vec,e)<10)return this.host.vecSelected=t,!0;return this.host.vecSelected=-1,!1},e.prototype.isMouseInsideCP=function(e){for(var t=0;t<this.host.vecsCP.length;++t)if((0,r.Sp)(this.host.vecsCP[t],e)<10)return this.host.vecSelectedCp=t,this.host.isHoverDuplicatedVecs=!1,!0;return this.host.vecSelectedCp=-1,!1},e.prototype.checkDistance=function(e,t){for(var n=new r.h9(e,t),o=this.host.pts.length,i=0;i<o;++i)if(i<o-1){if((0,r.xs)(n,this.host.pts[i].vec,this.host.pts[i+1].vec)<this.host.lineWidth)return!0}else if((0,r.xs)(n,this.host.pts[i].vec,this.host.pts[0].vec)<this.host.lineWidth)return!0;return!(!this.host.isFill||!(0,r.X0)(n,this.host.vecs))},e.prototype.updateActiveMouseCursor=function(){this.host.vecSelectedCp>-1?this.setMouseCursorMidCP():this.setMouseCursorCP()},e.prototype.setMouseCursorCP=function(){this.host.scene.capturePT?this.host.pts.indexOf(this.host.scene.capturePT)%2==0?this.host.scene.annotationInstance.activeCommandController.activeMouseCursor.setActiveCursor(r.CF.NWSEresize):this.host.scene.annotationInstance.activeCommandController.activeMouseCursor.setActiveCursor(r.CF.NESWresize):this.host.scene.annotationInstance.activeCommandController.activeMouseCursor.setActiveCursorDrag()},e.prototype.setMouseCursorMidCP=function(){-1===this.host.vecSelectedCp&&this.host.scene.annotationInstance.activeCommandController.activeMouseCursor.setActiveCursorDrag(),this.host.vecSelectedCp%2==0?this.host.scene.annotationInstance.activeCommandController.activeMouseCursor.setActiveCursor(r.CF.NSresize):this.host.scene.annotationInstance.activeCommandController.activeMouseCursor.setActiveCursor(r.CF.EWresize)},e.prototype.isMouseInsideSnapFrom=function(e){this.host.vecSelectedSnapping=void 0;for(var t=0;t<this.host.pts.length;t+=1)if((0,r.Sp)(this.host.pts[t].vec,e)<this.host.scene.annotationInstance.activeCommandController.acProperties.toleranceSnapping)return this.host.vecSelectedSnapping=this.host.pts[t].vec,this.host.vecSelectedSnapping;if((0,r.Sp)(this.host.vec,e)<this.host.scene.annotationInstance.activeCommandController.acProperties.toleranceSnapping)return this.host.vecSelectedSnapping=this.host.vec,this.host.vecSelectedSnapping},e.prototype.checkAttachedTextleaderline=function(){if(!this.host.textLeaderline||!this.host.textLeaderline.leaderline)return!1;for(var e=!1,t=0;t<this.host.pts.length;++t)(0,r.Sp)(this.host.pts[t].vec,this.host.textLeaderline.leaderline.v2)<5&&(e=!0);for((0,r.Sp)(this.host.vec,this.host.textLeaderline.leaderline.v2)<5&&(e=!0),t=0;t<this.host.vecsCP.length;++t)(0,r.Sp)(this.host.vecsCP[t],this.host.textLeaderline.leaderline.v2)<5&&(e=!0);return!!e||(this.host.textLeaderline.attachedShape=void 0,this.host.textLeaderline=void 0,!1)},e.prototype.updateLeaderlineSnap=function(e,t){if(this.host.computeCenterVec(),(0,r.Sp)(this.host.vec,e)<5)this.host.vecSelectedSnapping=this.host.vec;else for(var n=0;n<this.host.pts.length;++n)if((0,r.Sp)(this.host.pts[n].vec,e)<5)return void(this.host.vecSelectedSnapping=this.host.pts[n].vec)},e}(),ee=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),te=function(e){function t(t){var n=e.call(this,t)||this;return n.host=t,n}return ee(t,e),t.prototype.renderPost=function(e){this.interpolateColor.update(),this.timer.update(),this.timer.updatePopupSummery(),this.host.transformation.updateRotationAbsolute(),this.host.scene.annotationInstance.activeCommandController.acProperties.isPanning&&this.host.computeVec(),this.host.scene.annotationInstance.activeCommandController.acProperties.showUnit&&this.host.isConstraintRatio&&this.host.isHoverValue&&(e.textAlign="center",e.fillStyle="#ffffff",100<Math.abs(this.host.width)&&e.fillText("constrained by ratio",this.host.vec.x,this.host.vec.y)),this.host.scene.annotationInstance.activeCommandController.acProperties.showUnit&&(this.host.isHoverValue||this.host.isUnderConstruction)&&(this.host.dimension.renderLengthRect(e,this.host.vecs),this.host.isConstraintRatio?this.host.dimension.renderTotalAreaRect(e,this.host.vecs,", constrained by ratio"):this.host.dimension.renderTotalAreaRect(e,this.host.vecs)),this.renderPostGeometry(e,this.host.scene.annotationInstance.geometryCommon.gcmdSupporting.toScreenVecsOnCropping(this.host.getVecs()))},t.prototype.renderPostGeometry=function(e,t){var n=this.host.scene.annotationInstance.geometryCommon.gcmdSupporting.toScreenVecOnCropping(this.host.vec);this.host.isHoverValue||this.host.isSelectedValue?(this.host.scene.annotationInstance.renderer.draw.shape.area.rectangleHover(e,this.host.styleComponent.renderStyle,t,this.host.isGrayColor,this.host.visibilityValue,this.host.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.host.renderer.tOver),this.host.isHoverValue,this.host.isSelectedValue),this.host.renderer.tOver+=this.host.scene.annotationInstance.renderer.dt,this.host.renderer.tDown1=0,this.host.isLeave=!0,this.host.scene.annotationInstance.implementations.app.model.appCoreWrapper.appControllerStatus.mode===r.An.Drawing&&this.host.enableRotate&&this.renderRotationHandler(e)):this.host.renderer.tOver=0,this.host.scene.annotationInstance.renderer.draw.shape.area.rectangle(e,this.host.styleComponent.renderStyle,t,this.host.vec,!0,!0,!1),(this.host.isHoverValue||this.host.isSelectedValue||this.host.isUnderConstruction)&&this.host.scene.annotationInstance.implementations.app.model.appCoreWrapper.appControllerStatus.mode===r.An.Drawing&&(this.host.scene.annotationInstance.renderer.draw.shape.point.centerPointCircle(e,n.x,n.y),this.renderCP(e,t)),this.t+=this.host.scene.annotationInstance.renderer.dt,this.renderPostGeometryOffScreen(t)},t.prototype.renderCP=function(e,t){this.host.updateVecsCP();for(var n=0,o=0,i=0;i<t.length;++i)i===t.length-1?(n=t[i].x+.5*(t[0].x-t[i].x),o=t[i].y+.5*(t[0].y-t[i].y)):(n=t[i].x+.5*(t[i+1].x-t[i].x),o=t[i].y+.5*(t[i+1].y-t[i].y)),this.host.scene.annotationInstance.renderer.draw.shape.node.nodeHover(e,this.host.pts[0].styleComponent.renderStyle,n,o,this.host.scene.annotationInstance.graphicsCoreWrapper.scaleScreenByRatioImageSize,1)},t.prototype.renderPostGeometryOffScreen=function(e){this.host.scene.annotationInstance.renderer.offscreen.rectangleOffScreen(this.host.scene.annotationInstance.renderer.ctxOffscreen,this.host.hashColor,e)},t.prototype.renderRotationHandler=function(e){this.host.isHover&&(this.host.enableRotate&&this.host.transformation.updateRotationHandler(),e.strokeStyle=this.host.styleComponent.renderStyle.colorStroke,e.beginPath(),e.moveTo(this.host.vecRotationHandler.x,this.host.vecRotationHandler.y),e.lineTo(this.host.vecs[0].x+.5*(this.host.vecs[1].x-this.host.vecs[0].x),this.host.vecs[0].y+.5*(this.host.vecs[1].y-this.host.vecs[0].y)),e.closePath(),e.stroke(),e.fillStyle=this.host.styleComponent.renderStyle.colorStroke,e.beginPath(),e.arc(this.host.vecRotationHandler.x,this.host.vecRotationHandler.y,7,0,2*Math.PI),e.closePath(),e.fill())},t}(C),ne=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),oe=function(e){function t(t){var n=e.call(this,t)||this;return n.updateStyle(),n.updateColor(),n}return ne(t,e),t.prototype.updateStyle=function(){if(!this.isCustom){this.state.themeColorId=s.AccentColor1,this.isCustom=!0,x.updateRenderStylePolygon(this.renderStyle,this.geo.scene.annotationInstance.customization.themeCurrent),x.updateRenderStylePolygonNode(this.renderStyleNode,this.geo.scene.annotationInstance.customization.themeCurrent);for(var e=0;e<this.geo.pts.length;++e)this.geo.pts[e].styleComponent.updateStyleForNode(this.renderStyleNode)}},t.prototype.updateColor=function(e){void 0===e&&(e=void 0),this.isCustom=!0,void 0===e&&(e=this.geo.scene.annotationInstance.activeCommandController.activeColorController.activeColor),x.updateRenderColorPolygon(this.renderStyle,this.geo.scene.annotationInstance.customization.themeCurrent,e,[0,0,0,0]),x.updateRenderColorPolygonNode(this.renderStyleNode,this.geo.scene.annotationInstance.customization.themeCurrent,e);for(var t=0;t<this.geo.pts.length;++t)this.geo.pts[t].styleComponent.updateStyleForNode(this.renderStyleNode);this.tempColorRgba=e},t.prototype.updateStyleCustom=function(e){if(e.width&&(this.state.width=e.width),void 0!==e.color&&(this.state.themeColorId=e.color),e.colorRgba.length>0&&e.fill.length>0){this.tempColorRgba=e.colorRgba,this.tempFillRgba=e.fill,x.updateRenderStylePolygonCustom(this.renderStyle,this.geo.scene.annotationInstance.customization.themeCurrent,e.colorRgba,e.fill),x.updateRenderStylePolygonNodeCustom(this.renderStyleNode,this.geo.scene.annotationInstance.customization.themeCurrent,e.colorRgba,e.fill);for(var t=0;t<this.geo.pts.length;++t)this.geo.pts[t].styleComponent.updateStyleForNode(this.renderStyleNode)}return e.scale&&(this.renderStyle.scaleLocal=e.scale,this.state.scale=e.scale),this.isCustom=!0,!0},t.prototype.setDash=function(e){this.renderStyle.dash=e,this.geo.scene.annotationInstance.io.eventListenerAnnotation.addGeometryStack(this.geo.toJSON())},t.prototype.toJson=function(){if(this.isCustom){var e={width:this.state.width,scale:this.renderStyle.scaleLocal,colorRgba:this.tempColorRgba,fill:this.tempFillRgba};return this.state.themeColorId!==s.AccentColor1&&(e.color=this.state.themeColorId),e}},t.prototype.isSameStyle=function(e){if(e.colorRgba.length===this.tempColorRgba.length||e.fill.length===this.tempFillRgba){for(var t=0;t<e.colorRgba.length;t++)if(e.colorRgba[t]!==this.tempColorRgba[t])return!1;for(t=0;t<e.fill.length;t++)if(e.fill[t]!==this.tempFillRgba[t])return!1}return!0},t}(b),ie=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),se=function(e){function t(t){var n=e.call(this,t)||this;return n.anglePre=0,n.angle=0,n.geo=t,n.host=t,n}return ie(t,e),t.prototype.translateByMouseEventData=function(e){if(this.host.vecSelected>-1)this.translateByMouseEventDataNode(e,this.host.vecSelected);else if(this.host.isRotate)this.rotatingShape(e.x,e.y);else{var t=e.x-e.preX,n=e.y-e.preY;if(-1!==this.host.vecSelectedCp)return this.translateCPByMouseEventData(e),this.host.computeCenterVec(),void this.updateTextleaderlineVec();if(-1!==this.host.vecSelected)return this.host.pts[this.host.vecSelected].translateByMouseEventData(e),this.host.computeCenterVec(),void this.updateTextleaderlineVec();for(var o=0;o<this.host.pts.length;++o)this.host.pts[o].vec.x+=t,this.host.pts[o].vec.y+=n;this.host.computeCenterVec(),this.host.textLeaderline&&(this.host.vecSelectedSnapping||this.host.updateLeaderlineSnap(this.host.textLeaderline.vec,5),this.updateTextleaderlineVec(),this.host.textLeaderline.translateByMouseEventData(e))}},t.prototype.translateByMouseEventDataNode=function(e,t){for(var n=0;n<this.host.pts.length;++n)this.host.pts[n].isRenderable=!0;this.host.textLeaderline&&!this.host.vecSelectedSnapping&&this.host.updateLeaderlineSnap(this.host.textLeaderline.vec,5);var o=e.x-e.preX,i=e.y-e.preY;0===t||2===t?Math.abs(o)>Math.abs(i)?i=o:o=i:1!==t&&3!==t||(Math.abs(o)>Math.abs(i)?i=-1*o:o=-1*i),this.host.isConstraintRatio?this.computeConstraintRatio(t,o,i):0===t?(this.translatePt(0,o,i),this.translatePt(3,o,0),this.translatePt(1,0,i),(this.host.width<16||this.host.height<16)&&(this.translatePt(0,-o,-i),this.translatePt(3,-o,0),this.translatePt(1,0,-i))):1===t?(this.translatePt(1,o,i),this.translatePt(2,o,0),this.translatePt(0,0,i),(this.host.width<16||this.host.height<16)&&(this.translatePt(1,-o,-i),this.translatePt(2,-o,0),this.translatePt(0,0,-i))):2===t?(this.translatePt(2,o,i),this.translatePt(1,o,0),this.translatePt(3,0,i),(this.host.width<16||this.host.height<16)&&(this.translatePt(2,-o,-i),this.translatePt(1,-o,0),this.translatePt(3,0,-i))):3===t&&(this.translatePt(3,o,i),this.translatePt(0,o,0),this.translatePt(2,0,i),(this.host.width<16||this.host.height<16)&&(this.translatePt(3,-o,-i),this.translatePt(0,-o,0),this.translatePt(2,0,-i))),this.host.computeCenterVec(),this.host.transformation.updateTextleaderlineVec()},t.prototype.translate=function(e,t){},t.prototype.updateRotationAbsolute=function(){this.angle=180*Math.atan2(this.host.vecRotationHandler.y-this.host.vec.y,this.host.vecRotationHandler.x-this.host.vec.x)/Math.PI},t.prototype.translatePt=function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=0),this.host.pts[e].vec.x+=t,this.host.pts[e].vec.y+=n},t.prototype.translateCPByMouseEventData=function(e){if(0===this.host.vecSelectedCp){var t=e.y-this.host.pts[0].vec.y;this.host.pts[0].vec.y+=t,this.host.pts[1].vec.y+=t,this.host.height<16&&(this.host.pts[0].vec.y-=t,this.host.pts[1].vec.y-=t)}else if(2===this.host.vecSelectedCp)t=e.y-this.host.pts[2].vec.y,this.host.pts[2].vec.y+=t,this.host.pts[3].vec.y+=t,this.host.height<16&&(this.host.pts[2].vec.y-=t,this.host.pts[3].vec.y-=t);else if(1===this.host.vecSelectedCp){var n=this.host.isHoverDuplicatedVecs?e.x:e.x-this.host.pts[1].vec.x;this.host.pts[1].vec.x+=n,this.host.pts[2].vec.x+=n,this.host.width<16&&(this.host.pts[1].vec.x-=n,this.host.pts[2].vec.x-=n)}else 3===this.host.vecSelectedCp&&(n=this.host.isHoverDuplicatedVecs?e.x:e.x-this.host.pts[0].vec.x,this.host.pts[0].vec.x+=n,this.host.pts[3].vec.x+=n,this.host.width<16&&(this.host.pts[0].vec.x-=n,this.host.pts[3].vec.x-=n))},t.prototype.rotatingShape=function(e,t){var n=180*Math.atan2(t-this.host.vec.y,e-this.host.vec.x)/Math.PI-this.angle,o=this.rotateVecsLoal([this.host.vecRotationHandler],this.host.vec,n);this.host.vecRotationHandler.x=o[0].x,this.host.vecRotationHandler.y=o[0].y,this.host.vecRotationHandler.z=o[0].z,o=this.rotateVecsLoal(this.host.vecs,this.host.vec,n),this.host.vecs[0].x=o[0].x,this.host.vecs[0].y=o[0].y,this.host.vecs[0].z=o[0].z,this.host.vecs[1].x=o[1].x,this.host.vecs[1].y=o[1].y,this.host.vecs[1].z=o[1].z,this.host.vecs[2].x=o[2].x,this.host.vecs[2].y=o[2].y,this.host.vecs[2].z=o[2].z,this.host.vecs[3].x=o[3].x,this.host.vecs[3].y=o[3].y,this.host.vecs[3].z=o[3].z,this.angle+=n},t.prototype.rotateVecsLoal=function(e,t,n){var o=new r.h9(-t.x,-t.y,-t.z),i=(0,r.Vt)(e,o);return i=(0,r.DM)(i,n),(0,r.Vt)(i,t)},t.prototype.updateTextleaderlineVec=function(){var e=0;this.host.vecSelectedSnapping&&this.host.textLeaderline&&this.host.textLeaderline.leaderline&&(e=this.host.textLeaderline.leaderline.v2.x-this.host.vecSelectedSnapping.x,this.host.textLeaderline.leaderline.v2.x=this.host.vecSelectedSnapping.x,this.host.textLeaderline.widthOffset+=e,e=this.host.textLeaderline.leaderline.v2.y-this.host.vecSelectedSnapping.y,this.host.textLeaderline.leaderline.v2.y=this.host.vecSelectedSnapping.y,this.host.textLeaderline.heightOffset+=e,this.host.textLeaderline.computeCenterVec())},t.prototype.updateRotationHandler=function(){this.host.vecRotationHandler.x=this.host.vecs[0].x+.5*(this.host.vecs[1].x-this.host.vecs[0].x),this.host.vecRotationHandler.y=this.host.vecs[0].y+.5*(this.host.vecs[1].y-this.host.vecs[0].y);var e=(0,r.ir)(this.host.vecs[0],this.host.vecs[1]),t=new r.h9(this.host.vecs[1].x-this.host.vecs[0].x,this.host.vecs[1].y-this.host.vecs[0].y,this.host.vecs[1].z-this.host.vecs[0].z),n=(0,r.ir)(e,t);n.unitize(),this.host.vecRotationHandler.x+=20*n.x,this.host.vecRotationHandler.y+=20*n.y,(0,r.Sp)(this.host.vec,this.host.vecRotationHandler)<.5*this.host.height&&(this.host.vecRotationHandler.x+=40*-n.x,this.host.vecRotationHandler.y+=40*-n.y)},t.prototype.computeConstraintRatio=function(e,t,n){var o=this.resizeConstraintRatio();if(0===e)if(Math.abs(t)>Math.abs(n)){var i=(0,r.kC)(o[0],o[1],o[0]+t);this.host.pts[e].vec.x+=t,this.host.pts[e].vec.y-=o[1]-i[1],this.host.pts[e+1].vec.y-=o[1]-i[1],this.host.pts[e+3].vec.x+=t}else i=(0,r.Ux)(o[0],o[1],o[1]+n),this.host.pts[e].vec.x-=o[0]-i[0],this.host.pts[e].vec.y+=n,this.host.pts[e+1].vec.y+=n,this.host.pts[e+3].vec.x-=o[0]-i[0];else 1===e?Math.abs(t)>Math.abs(n)?(this.host.pts[e].vec.x+=t,i=(0,r.kC)(o[0],o[1],o[0]+t),this.host.pts[e].vec.y+=o[1]-i[1],this.host.pts[e+1].vec.x+=t,this.host.pts[e-1].vec.y+=o[1]-i[1]):(i=(0,r.Ux)(o[0],o[1],o[1]+n),this.host.pts[e].vec.x+=o[0]-i[0],this.host.pts[e].vec.y+=n,this.host.pts[e+1].vec.x+=o[0]-i[0],this.host.pts[e-1].vec.y+=n):2===e?Math.abs(t)>Math.abs(n)?(i=(0,r.kC)(o[0],o[1],o[0]+t),this.host.pts[e].vec.x+=t,this.host.pts[e].vec.y=this.host.pts[0].vec.y+i[1],this.host.pts[e-1].vec.x+=t,this.host.pts[e+1].vec.y=this.host.pts[0].vec.y+i[1]):(i=(0,r.Ux)(o[0],o[1],o[1]+n),this.host.pts[e].vec.x=this.host.pts[0].vec.x+i[0],this.host.pts[e].vec.y+=n,this.host.pts[e-1].vec.x=this.host.pts[0].vec.x+i[0],this.host.pts[e+1].vec.y+=n):3===e&&(Math.abs(t)>Math.abs(n)?(i=(0,r.kC)(o[0],o[1],o[0]+t),this.host.pts[e].vec.x+=t,this.host.pts[e].vec.y+=o[1]-i[1],this.host.pts[e-1].vec.y+=o[1]-i[1],this.host.pts[0].vec.x+=t):(i=(0,r.Ux)(o[0],o[1],o[1]+n),this.host.pts[e].vec.x+=o[0]-i[0],this.host.pts[e].vec.y+=n,this.host.pts[e-1].vec.y+=n,this.host.pts[0].vec.x+=o[0]-i[0]))},t.prototype.resizeConstraintRatio=function(){return[this.host.pts[1].vec.x-this.host.pts[0].vec.x,this.host.pts[2].vec.y-this.host.pts[1].vec.y]},t}(Y),re=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),ae=function(e){function t(t,n,o,i,s,a){void 0===i&&(i=0),void 0===s&&(s=!1),void 0===a&&(a=8);var h=e.call(this,t)||this;h.vecsCP=[],h.vecRotationHandler=new r.h9(0,0,0),h.isRotate=!1,h.isHoverDuplicatedVecs=!1,h.vecSelected=-1,h.vecSelectedCp=-1,h.enableRotate=!1,h.type=r.zq.RECTANGLE,h.pts=[],h.pts.push(new k(t,n,o,0,s)),h.pts.push(new k(t,n,o,0,s)),h.pts.push(new k(t,n,o,0,s)),h.pts.push(new k(t,n,o,0,s));for(var c=0;c<h.pts.length;++c)s&&(h.pts[c].isHoverValue=!1),h.pts[c].type=r.zq.ANODE_RECT;return h.lineWidth=a,h.initComponent(),h.initVecsCP(),h.computeRecPts(),h.computeVec(),h.isConstraintRatio=!1,h.initShape(),h}return re(t,e),t.getRectangleFromVoice=function(e){var t=new r.h9(.5*e.annotationInstance.geometryCommon.gcmdProcessing.width,.5*e.annotationInstance.geometryCommon.gcmdProcessing.height);this.getRectByVecs(e,[new r.h9(t.x-100,t.y-100),new r.h9(t.x+100,t.y-100),new r.h9(t.x+100,t.y+100),new r.h9(t.x-100,t.y+100)])},t.findAtPoint=function(e){},t.computeHover=function(e){t.findAtPoint(e)},t.getRectByVecs=function(e,n){var o=(0,r.HP)(n),i=new t(e,o[0].x,o[0].y,0,!1),s=o[1].x-o[0].x,a=o[1].y-o[0].y;i.pts[1].vec.x+=s,i.pts[2].vec.x+=s,i.pts[2].vec.y+=a,i.pts[3].vec.y+=a,i.IsSelectable=!0,i.isUnderConstruction=!1,i.updatePos(2,i.pts[1].vec.x+1,i.pts[3].vec.y+1,0),e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(i.toJSON())},t.getRectByTouch=function(e,t){var n=new r.h9(t.x,t.y,0);this.getRectByVecs(e,[new r.h9(n.x-100,n.y-100),new r.h9(n.x+100,n.y-100),new r.h9(n.x+100,n.y+100),new r.h9(n.x-100,n.y+100)])},t.getRect=function(e,n){if(void 0===t.construction)return t.construction=new t(e,n.x,n.y),void(t.construction.IsSelectable=!1);t.construction.isUnderConstruction=!1,t.construction.IsSelectable=!0,t.construction.updatePos(2,t.construction.pts[1].vec.x,t.construction.pts[3].vec.y+.1,0),e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(t.construction.toJSON()),t.construction=void 0},t.getRectByPt=function(e){},t.drawShadow=function(e,n){void 0===t.construction?new k(e,n.x,n.y,0).isSelectable=!1:(t.construction.pts[1].move(n.x,t.construction.pts[1].vec.y),t.construction.pts[2].move(n.x,n.y),t.construction.pts[3].move(t.construction.pts[3].vec.x,n.y),t.construction.computeCenterVec())},t.fromJSON=function(e,n,o,i){void 0===o&&(o=!1),void 0===i&&(i=!1);var s=k.getNodeFromJSON(e,n.nodes[0],o),a=new t(e,s.vec.x,s.vec.y,0,o);s.remove();for(var h=1;h<a.pts.length;++h){var c=k.getNodeFromJSON(e,n.nodes[h],o);a.pts[h].vec.x=c.vec.x,a.pts[h].vec.y=c.vec.y,a.pts[h].type=r.zq.ANODE_RECT,c.remove()}return a.type=r.zq[n.type],a.isHiddenValue=n.isHidden,n.isHidden?a.visibility=0:a.visibility=1,n.styles&&n.styles.dash&&(a.styleComponent.renderStyle.dash=n.styles.dash),a.id=i?e.getUUID():n.id,a.IsSelectable=!0,a.isUnderConstruction=!1,a.isHover=!1,n.styles&&a.updateStyleCustom(n.styles),a.initVecsHistory(),o||e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(a.toJSON()),a},t.cancel=function(){void 0!==t.construction&&t.construction.remove(),t.construction=void 0},t.mouseDown=function(e,t){},t.onMouseLeftClick=function(e,n,o,i){void 0===o&&(o=128),void 0===i&&(i=128),t.construction&&t.construction.remove();var s=new t(e,n.x-.5*o,n.y-.5*i);s.pts[1].vec.x+=o,s.pts[2].vec.x+=o,s.pts[2].vec.y+=i,s.pts[3].vec.y+=i,s.IsSelectable=!0,s.isUnderConstruction=!1,s.isHover=!1,s.emitAddStack(),e.annotationInstance.activeCommandController.goToACMode()},t.onMouseMiddleClick=function(e){},t.onMouseRightClick=function(e){},t.onMouseDoubleClick=function(e){},t.onMouseMove=function(e,n){void 0!==t.construction&&t.drawShadow(e,n)},t.onMouseDrag=function(e,n){void 0!==t.construction?t.drawShadow(e,n):(e.annotationInstance.geometryCommon.gcmdSelecting.deSelectAllObjects(),t.getRect(e,n))},t.onMouseUp=function(e,n){t.construction&&(Q.swap(t.construction),e.annotationInstance.activeCommandController.goToACMode(),t.construction.IsSelectable=!0,t.construction.isUnderConstruction=!1,t.construction.isHover=!1,(0,r.Sp)(t.construction.pts[0].vec,t.construction.pts[1].vec)<5&&(t.construction.pts[0].vec.x+=-60,t.construction.pts[0].vec.y+=-60,t.construction.pts[1].vec.x+=60,t.construction.pts[1].vec.y+=-60,t.construction.pts[2].vec.x+=60,t.construction.pts[2].vec.y+=60,t.construction.pts[3].vec.x+=-60,t.construction.pts[3].vec.y+=60),t.construction.isSelected=!1,t.construction.computeCenterVec(),t.construction.emitAddStack(),t.construction=void 0,t.isDone=!0)},t.prototype.initComponent=function(){this.styleComponent=new oe(this),this.renderer=new te(this),this.interaction=new Z(this),this.transformation=new se(this)},t.prototype.initShape=function(){this.dimension=new H(this),this.isFill=!0,this.scene.addARectangleWrapper(this)},t.prototype.computeCenterVec=function(){return this.vec=(0,r.mI)([this.pts[0].vec,this.pts[1].vec,this.pts[2].vec,this.pts[3].vec]),this.vec},t.prototype.computeRecPts=function(){var e=this.pts[0].vec,t=this.pts[2].vec,n=0,o=0,i=0;n=e.x<t.x?e.x:t.x,o=e.y<t.y?e.y:t.y,i=e.z<t.z?e.z:t.z;var s=new r.h9(n,o,i);n=e.x>t.x?e.x:t.x,o=e.y>t.y?e.y:t.y,i=e.z>t.z?e.z:t.z;var a=new r.h9(n,o,i);this.updatePos(1,a.x,s.y,s.z),this.updatePos(3,s.x,a.y,s.z);for(var h=0;h<this.pts.length;++h)this.pts[h].addEdge(this),this.pts[h].type=r.zq.ANODE_RECT;this.updateVecsCP()},t.prototype.getRelatedVec=function(){for(var e=[],t=0;t<this.pts.length;++t){var n=this.pts[t];e.push(new r.h9(n.vec.x-this.vec.x,n.vec.y-this.vec.y,n.vec.z-this.vec.z))}},t.prototype.updatePos=function(e,t,n,o){this.pts[e].vec.x=t,this.pts[e].vec.y=n,this.pts[e].vec.z=o},t.prototype.getNodePopup=function(){return this.pts[this.pts.length-2]},t.prototype.getArea=function(){return(this.pts[1].vec.x-this.pts[0].vec.x)*(this.pts[2].vec.y-this.pts[0].vec.y)},t.prototype.getLog=function(){return this.interaction.getLog()},Object.defineProperty(t.prototype,"visibility",{set:function(e){this.visibilityValue=e;for(var t=0;t<this.pts.length;++t)this.pts[t].visibilityValue=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"IsHiddenChildren",{set:function(e){this.isHiddenPre=this.isHiddenValue,this.isHiddenValue=e;for(var t=0;t<this.pts.length;++t)this.pts[t].isHiddenValue=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isHidden",{set:function(e){this.isHiddenPre=this.isHiddenValue,this.isHiddenValue=e,this.IsHiddenChildren=e,this.scene.annotationInstance.io.eventListenerAnnotation.hideStack(this.toJSON())},enumerable:!1,configurable:!0}),t.prototype.move=function(e,t){if(!this.isRemove&&this.isRenderable&&!this.isHiddenValue){for(var n=e-this.vec.x-.5*(this.pts[1].vec.x-this.pts[0].vec.x),o=t-this.vec.y-.5*(this.pts[2].vec.y-this.pts[0].vec.y),i=0;i<this.pts.length;++i)this.pts[i].vec.x+=n,this.pts[i].vec.y+=o;this.computeCenterVec()}},t.prototype.goToBlackhole=function(){this.isSelectable=!1,this.needBlackhole=!0,this.pts.forEach((function(e){e.goToBlackhole()}))},t.prototype.translateByMouseEventData=function(e){return this.transformation.translateByMouseEventData(e)},t.prototype.translate=function(e,t){return this.transformation.translate(e,t)},t.prototype.computeConstraintRatio=function(e,t,n){return this.transformation.computeConstraintRatio(e,t,n)},t.prototype.isMouseInside=function(e,t){return this.interaction.isMouseInside(e,t)},t.prototype.updateVecsBySnapping=function(e,t,n){for(var o=-1,i=0;i<this.pts.length;++i)e===this.pts[i]&&(o=i);0===o?(this.pts[1].vec.y+=n,this.pts[3].vec.x+=t):1===o?(this.pts[0].vec.y+=n,this.pts[2].vec.x+=t):2===o?(this.pts[3].vec.y+=n,this.pts[1].vec.x+=t):3===o&&(this.pts[2].vec.y+=n,this.pts[0].vec.x+=t),this.computeCenterVec()},t.prototype.initVecsCP=function(){this.vecsCP.push(new r.h9(this.pts[0].vec.x+.5*(this.pts[1].vec.x-this.pts[0].vec.x),this.pts[0].vec.y+.5*(this.pts[1].vec.y-this.pts[0].vec.y),0)),this.vecsCP.push(new r.h9(this.pts[1].vec.x+.5*(this.pts[2].vec.x-this.pts[1].vec.x),this.pts[1].vec.y+.5*(this.pts[2].vec.y-this.pts[1].vec.y),0)),this.vecsCP.push(new r.h9(this.pts[2].vec.x+.5*(this.pts[3].vec.x-this.pts[2].vec.x),this.pts[2].vec.y+.5*(this.pts[3].vec.y-this.pts[2].vec.y),0)),this.vecsCP.push(new r.h9(this.pts[3].vec.x+.5*(this.pts[0].vec.x-this.pts[3].vec.x),this.pts[3].vec.y+.5*(this.pts[0].vec.y-this.pts[3].vec.y),0))},t.prototype.updateVecsCP=function(){this.vecsCP[0].x=this.pts[0].vec.x+.5*(this.pts[1].vec.x-this.pts[0].vec.x),this.vecsCP[0].y=this.pts[0].vec.y+.5*(this.pts[1].vec.y-this.pts[0].vec.y),this.vecsCP[1].x=this.pts[1].vec.x+.5*(this.pts[2].vec.x-this.pts[1].vec.x),this.vecsCP[1].y=this.pts[1].vec.y+.5*(this.pts[2].vec.y-this.pts[1].vec.y),this.vecsCP[2].x=this.pts[2].vec.x+.5*(this.pts[3].vec.x-this.pts[2].vec.x),this.vecsCP[2].y=this.pts[2].vec.y+.5*(this.pts[3].vec.y-this.pts[2].vec.y),this.vecsCP[3].x=this.pts[3].vec.x+.5*(this.pts[0].vec.x-this.pts[3].vec.x),this.vecsCP[3].y=this.pts[3].vec.y+.5*(this.pts[0].vec.y-this.pts[3].vec.y)},t.prototype.getVecs=function(){this.vecs=[];for(var e=0;e<this.pts.length;++e)this.vecs.push(this.pts[e].vec);return this.vecs},t.prototype.remove=function(e){void 0===e&&(e=!0);for(var t=0;t<this.pts.length;++t)this.pts[t].remove();if(e){var n=this.toJSON();n&&this.scene.annotationInstance.io.eventListenerAnnotation.removeGeometryStack([n])}this.deepRemove()},t.prototype.deepRemove=function(){this.isSelectable=!1,this.isRenderable=!1,this.hidePopUpSummary(),this.scene.removeARectangleWrapper(this),this.scene.removeGeometry(this)},t.prototype.getParentType=function(){return"ARectangle,ID:"+this.id},t.prototype.hide=function(){throw new Error("Method not implemented.")},Object.defineProperty(t.prototype,"IsSelectable",{get:function(){return this.isSelectable},set:function(e){this.isSelectable=e;for(var t=0;t<this.pts.length;++t)this.pts[t].isSelectable=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"IsRenderable",{set:function(e){this.isRenderable=e;for(var t=0;t<this.pts.length;++t)this.pts[t].isRenderable=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isSelected",{get:function(){return this.isSelectedValue},set:function(e){this.isSelectedValue=e;for(var t=0,n=this.pts;t<n.length;t++){var o=n[t];o.isRenderable=e,o.isSelectable=e,o.isSelectedValue=e}this.scene.annotationInstance.io.eventListenerAnnotation.selectionStack(this.toJSON())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isHover",{get:function(){return this.isHoverValue},set:function(e){if(!this.isUnderConstruction){if(this.isHoverValue=e,(this.isHoverValue&&!this.isHoverPre||!this.isHoverValue&&this.isHoverPre)&&this.scene.annotationInstance.io.eventListenerAnnotation.hoverStack(this.toJSON()),this.isHoverPre=this.isHoverValue,!this.isSelectedValue)for(var t=0,n=this.pts;t<n.length;t++){var o=n[t];o.isRenderable=e,o.isSelectable=e}e||(this.needEmitHoverPost=!0,this.hidePopUpSummary())}},enumerable:!1,configurable:!0}),t.prototype.getNode=function(){for(var e=[],t=0;t<this.pts.length;++t)e.push(this.pts[t].vec);return e},t.prototype.toJSON=function(){var e=new p(this.id,this.type,this.isSelectedValue,this.isHoverValue,this.isHiddenValue);e.pushNode(this.getNode());var t=this.styleComponent.toJson();return t&&(e.styles=t),e},t.prototype.deepCopy=function(e,n,o){void 0===o&&(o=0);var i=this.toJSON(),s=t.fromJSON(this.scene,i,!0,!0);return s.move(e,n),s.emitAddStack(),s},Object.defineProperty(t.prototype,"width",{get:function(){return this.pts[1].vec.x-this.pts[0].vec.x},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.pts[2].vec.y-this.pts[1].vec.y},enumerable:!1,configurable:!0}),t.prototype.computeBoundingVecs=function(){this.vecs=[];for(var e=0;e<this.pts.length;++e)this.vecs.push(this.pts[e].vec)},t.prototype.getBoundary=function(){return this.getVecs()},t.prototype.computeVec=function(){this.computeBoundingVecs(),this.updateVecsCP(),this.computeCenterVec()},t.prototype.mouseRightClick=function(){this.isFill=!this.isFill,this.isConstraintRatio=!this.isConstraintRatio},t.prototype.renderPost=function(e){this.renderer.renderPost(e)},t.prototype.getVecForSnapping=function(){return this.vecSelectedSnapping},t.prototype.updateActiveCursor=function(){this.interaction.updateActiveMouseCursor()},t.prototype.isMouseInsideSnapFrom=function(e){return this.interaction.isMouseInsideSnapFrom(e)},t.prototype.checkAttachedTextleaderline=function(){return this.interaction.checkAttachedTextleaderline()},t.prototype.updateLeaderlineSnap=function(e,t){return this.interaction.updateLeaderlineSnap(e,t)},Object.defineProperty(t.prototype,"textLeaderline",{get:function(){return this.textLeaderlineValue},set:function(e){e!==this.textLeaderlineValue&&(this.textLeaderlineValue&&e&&this.textLeaderlineValue.removeLeaderline(),this.textLeaderlineValue=e)},enumerable:!1,configurable:!0}),t.isDone=!1,t.split=!1,t.isConstraintRatio=!1,t}(y),he=function(){function e(e,t,n,o,i){this.detectionTolerance=10,this.curveTolerance=3,this.needBend=!0,this.scene=e,this.pGraph=t,this.tOver=0,this.tDown1=0,this.isLeave=!0,this.isHiddenPre=!1,this.isRemove=!1,this.visibility=1,n.add_AEdge(this),o.add_AEdge(this),i.add_AEdge(this),this.p0=n,this.pm=o,this.p1=i,this.p0.type=r.zq.ANODE,this.pm.type=r.zq.AMIDPOINT,this.p1.type=r.zq.ANODE,this.isCurved=!1,this.init()}return e.renderEdge=function(e,t,n,o,i,s,r,a,h,c){void 0===r&&(r=!1),void 0===a&&(a=!1),void 0===h&&(h=0);for(var p=0;p<o.length-2;p+=2){var l=[o[p].x,o[p].y,o[p+1].x,o[p+1].y,o[p+2].x,o[p+2].y],d=this.getControlPoints(o[p].x,o[p].y,o[p+1].x,o[p+1].y,o[p+2].x,o[p+2].y,.5);this.drawSpline(e,t,n,l,d,[.5,.5,.5,.5,.5,.5],i,s),this.offscreenRender(e,n,c,l,d,l.length)}},e.getControlPoints=function(e,t,n,o,i,s,r){var a=Math.sqrt(Math.pow(n-e,2)+Math.pow(o-t,2)),h=r*a/(a+Math.sqrt(Math.pow(i-n,2)+Math.pow(s-o,2))),c=r-h;return[n+h*(e-i),o+h*(t-s),n-c*(e-i),o-c*(t-s)]},e.drawSpline=function(e,t,n,o,i,s,r,a){var h=o,c=i,p=h.length;r||a?(e.annotationInstance.renderer.draw.shape.curve.edgeCurveQuadraticHover(t,n,h[0],h[1],c[0],c[1],h[2],h[3],e.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tOver),r,a),e.annotationInstance.renderer.draw.shape.curve.edgeCurveQuadraticHover(t,n,h[p-2],h[p-1],c[2*p-10],c[2*p-9],h[p-4],h[p-3],e.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tOver),r,a),this.tOver+=.015,this.tDown1=0,this.isLeave=!0):this.tOver=0,e.annotationInstance.renderer.draw.shape.curve.curveQuadratic(t,n,h[0],h[1],c[0],c[1],h[2],h[3],r,a),e.annotationInstance.renderer.draw.shape.curve.curveQuadratic(t,n,h[p-2],h[p-1],c[2*p-10],c[2*p-9],h[p-4],h[p-3],r,a)},e.offscreenRender=function(e,t,n,o,i,s){e.annotationInstance.renderer.offscreen.curveQuadraticArrowOffScreen(e.annotationInstance.renderer.ctxOffscreen,t,n,o[0],o[1],i[0],i[1],o[2],o[3]),e.annotationInstance.renderer.offscreen.curveQuadraticArrowOffScreen(e.annotationInstance.renderer.ctxOffscreen,t,n,o[s-2],o[s-1],i[2*s-10],i[2*s-9],o[s-4],o[s-3])},e.prototype.init=function(){this.IsHidden=!1,this.IsRenderable=!0,this.IsSelectable=!0},Object.defineProperty(e.prototype,"IsHover",{get:function(){return this.isHover},set:function(e){this.isHover=e,this.p0.isHover=e,this.pm.isHover=e,this.p1.isHover=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"IsRenderable",{get:function(){return this.isRenderable},set:function(e){this.isRenderable=e,this.p0.isRenderable=e,this.pm.isRenderable=e,this.p1.isRenderable=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"IsHidden",{get:function(){return this.isHidden},set:function(e){this.isHiddenPre=this.isHidden,this.isHidden=e,this.p0.isHidden=e,this.pm.isHidden=e,this.p1.isHidden=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"Visibility",{get:function(){return this.visibility},set:function(e){this.visibility=e,this.p0.visibility=0,this.pm.visibility=0,this.p1.visibility=0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"IsSelected",{get:function(){return this.isSelected},set:function(e){this.isSelected=e,this.p0.isRenderable=e,this.pm.isRenderable=e,this.p1.isRenderable=e},enumerable:!1,configurable:!0}),e.prototype.getClosePt=function(e,t){return this.p0.distance(e,t)<10?this.p0:this.p1.distance(e,t)<10?this.p1:this.pm.distance(e,t)<10?this.pm:void 0},e.prototype.translateByMouseEventData=function(e){this.p0.isVisited||(this.p0.isVisited=!0,this.p0.translateByMouseEventData(e),this.p0.textLeaderline&&this.translateForTextLeaderline(e,this.p0)),this.p1.isVisited||(this.p1.isVisited=!0,this.p1.translateByMouseEventData(e),this.p1.textLeaderline&&this.translateForTextLeaderline(e,this.p1)),this.isCurved&&(this.pm.isVisited||(this.pm.isVisited=!0,this.pm.vec.x+=e.x-e.preX,this.pm.vec.y+=e.y-e.preY,this.pm.textLeaderline&&(this.pm.textLeaderline.translateByMouseEventData(e),this.translateForTextLeaderline(e,this.pm))))},e.prototype.translateForTextLeaderline=function(e,t){return!(!t.textLeaderline||!t.textLeaderline.leaderline||(t.textLeaderline.leaderline.v2.x=t.vec.x,t.textLeaderline.leaderline.v2.y=t.vec.y,0))},e.prototype.splitEdge=function(e){if(e.type===r.zq.AMIDPOINT){var t=this.pGraph.edges.indexOf(this);this.pGraph.edges.splice(t,1);var n=new k(this.scene,e.vec.x,e.vec.y,e.vec.z);n.type=r.zq.ANODE;var o=this.pGraph.addEdge(this.p0,n),i=this.pGraph.addEdge(n,this.p1);return this.p0.aEdges.splice(this.p0.aEdges.indexOf(this),1),this.p1.aEdges.splice(this.p1.aEdges.indexOf(this),1),this.pGraph.edges.splice(t,0,i),this.pGraph.edges.splice(t,0,o),e.deepRemove(),this.pGraph.reBuildConnection(),n}},e.prototype.computeCurve=function(e){void 0===e&&(e=.5),this.computeVertex(e),this.computeWeight(e),this.computeControlPoint()},e.prototype.checkIsCurved=function(){var e=(0,r.zQ)(this.p0.vec,this.p1.vec);return(0,r.Sp)(e,this.pm.vec)<this.curveTolerance?(this.pm.vec.x=e.x,this.pm.vec.y=e.y,this.isCurved=!1,!1):(this.isCurved=!0,!0)},e.prototype.checkIsSnapStraight=function(){this.isCurved?(this.needBend=!1,this.curveTolerance=3):(this.needBend=!0,this.curveTolerance=0)},e.prototype.isMouseInsideByCurve=function(e,t){return this.computeCurve(.3),this.isInsideFirstAndLastCurves(e,t)?(this.IsHover=!0,!0):(this.IsHover=!1,!1)},e.prototype.isMouseInside=function(e,t){if(this.isCurved){if(this.isMouseInsideByCurve(e,t))return!0}else if(this.distance(e,t)<this.detectionTolerance*this.scene.annotationInstance.activeCommandController.scaleGlobal)return!0;return!1},e.prototype.getOtherPt=function(e){return this.p0===e?this.p1:this.p0},e.prototype.distance=function(e,t){return(0,r.xs)(new r.h9(e,t),this.p0.vec,this.p1.vec)},e.prototype.moveMidPt=function(e){if(this.isCurved);else{var t=(0,r.zQ)(this.p0.vec,this.p1.vec);this.pm.vec.x=t.x,this.pm.vec.y=t.y}},e.prototype.remove=function(){this.isRemove=!0,this.isRenderable=!1,this.p0.deepRemove(),this.pm.deepRemove(),this.p1.deepRemove(),this.removeFromParent()},e.prototype.getCenVec=function(){return new r.h9((this.p0.vec.x+this.pm.vec.x+this.p1.vec.x)/3,(this.p0.vec.y+this.pm.vec.y+this.p1.vec.y)/3,(this.p0.vec.z+this.pm.vec.z+this.p1.vec.z)/3)},e.prototype.getVecs=function(){return[this.p0.vec,this.pm.vec,this.p1.vec]},e.prototype.deepRemove=function(){},e.prototype.removeFromParent=function(){this.pGraph.removeEdge(this)},Object.defineProperty(e.prototype,"IsSelectable",{get:function(){return this.isSelectable},set:function(e){this.isSelectable=e,this.p0.isSelectable=e,this.pm.isSelectable=e,this.p1.isSelectable=e},enumerable:!1,configurable:!0}),e.prototype.updateMidVec=function(){if(!this.isCurved){var e=(0,r.zQ)(this.p0.vec,this.p1.vec);this.pm.vec.x=e.x,this.pm.vec.y=e.y}},e.prototype.renderPostHover=function(e){this.pGraph.isPath&&!this.isHover||(this.isCurved?(this.computeCurve(),this.drawSplineHover(e,this.pGraph.styleComponent.renderStyle,this.arrayVertexs,this.arrayControlPoint,this.arrayWeight,this.isHover,this.isSelected)):this.drawLineHover(e,this.pGraph.styleComponent.renderStyle,this.isHover,this.isSelected))},e.prototype.renderPost=function(t){if(!this.pGraph.isPath||this.isHover){var n=this.scene.paramsEditing.croppingMaskParams.x,o=this.scene.paramsEditing.croppingMaskParams.y;if(this.isCurved)this.computeCurve(),this.drawSpline(t,this.pGraph.styleComponent.renderStyle,this.arrayVertexs,this.arrayControlPoint,this.arrayWeight,this.isHover,this.isSelected),e.offscreenRender(this.scene,this.pGraph.styleComponent.renderStyle,this.pGraph.hashColor,this.arrayVertexs,this.arrayControlPoint,this.arrayVertexs.length);else{this.drawLine(t,this.pGraph.styleComponent.renderStyle,this.isHover,this.isSelected);var i=[this.p0.vec.x-n,this.p0.vec.y-o,this.pm.vec.x-n,this.pm.vec.y-o,this.p1.vec.x-n,this.p1.vec.y-o],s=e.getControlPoints(this.p0.vec.x-n,this.p0.vec.y-o,this.pm.vec.x-n,this.pm.vec.y-o,this.p1.vec.x-n,this.p1.vec.y-o,.5);e.offscreenRender(this.scene,this.pGraph.styleComponent.renderStyle,this.pGraph.hashColor,i,s,i.length)}if(!this.pGraph.scene.annotationInstance.activeCommandController.acProperties.isHiddenLog){var r=this.pGraph.edges.indexOf(this);t.font="30px Arial",t.fillText(r.toString(),this.pm.vec.x,this.pm.vec.y)}}},e.prototype.drawLine=function(e,t,n,o){var i=this.scene.paramsEditing.croppingMaskParams.x,s=this.scene.paramsEditing.croppingMaskParams.y;this.scene.annotationInstance.renderer.draw.shape.polyline.edgePolylineLineTo(e,this.pGraph.styleComponent.renderStyle,this.p0.vec.x-i,this.p0.vec.y-s,this.p1.vec.x-i,this.p1.vec.y-s,!1,!1,1,1,n,this.isSelected)},e.prototype.drawLineHover=function(e,t,n,o){if(n||o){var i=this.scene.paramsEditing.croppingMaskParams.x,s=this.scene.paramsEditing.croppingMaskParams.y;this.scene.annotationInstance.renderer.draw.shape.line.edgePolylineHover(e,t,this.p0.vec.x-i,this.p0.vec.y-s,this.p1.vec.x-i,this.p1.vec.y-s,this.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tOver),n,this.isSelected),this.tOver+=.015,this.tDown1=0,this.isLeave=!0}else this.tOver=0},e.prototype.drawSplineHover=function(e,t,n,o,i,s,a){var h=n,c=o,p=h.length;s||a?(this.scene.annotationInstance.implementations.app.model.appCoreWrapper.appControllerStatus.mode===r.An.Drawing&&this.scene.annotationInstance.renderer.draw.shape.line.shadowMidPointForBending(e,t,(0,r.zQ)(this.p0.vec,this.p1.vec)),this.scene.annotationInstance.renderer.draw.shape.curve.edgeCurveQuadraticHover(e,t,h[0],h[1],c[0],c[1],h[2],h[3],this.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tOver),s,a),this.scene.annotationInstance.renderer.draw.shape.curve.edgeCurveQuadraticHover(e,t,h[p-2],h[p-1],c[2*p-10],c[2*p-9],h[p-4],h[p-3],1,s,a),this.tOver+=.015,this.tDown1=0,this.isLeave=!0):this.tOver=0},e.prototype.drawSpline=function(e,t,n,o,i,s,r){var a=n,h=o,c=a.length;this.scene.annotationInstance.renderer.draw.shape.polyline.curveQuadratic(e,t,a[0],a[1],h[0],h[1],a[2],a[3],this.isHover,this.isSelected),this.scene.annotationInstance.renderer.draw.shape.polyline.curveQuadratic(e,t,a[c-2],a[c-1],h[2*c-10],h[2*c-9],a[c-4],a[c-3],this.isHover,this.isSelected)},e.prototype.computeVertex=function(e){var t=[];this.p0.weightLeft=e,this.p0.weightRight=e;var n=this.scene.paramsEditing.croppingMaskParams.x,o=this.scene.paramsEditing.croppingMaskParams.y;t.push(this.p0.vec.x-n,this.p0.vec.y-o),this.pm.weightLeft=e,this.pm.weightRight=e,t.push(this.pm.vec.x-n,this.pm.vec.y-o),this.p1.weightLeft=e,this.p1.weightRight=e,t.push(this.p1.vec.x-n,this.p1.vec.y-o),this.arrayVertexs=t},e.prototype.computeWeight=function(e){void 0===e&&(e=1);var t=[e,e,e];this.arrayWeight=t},e.prototype.computeControlPoint=function(){for(var t=[],n=0,o=this.arrayVertexs;n<o.length;n++){var i=o[n];t.push(i)}for(var s=[],r=0;r<t.length-4;r+=2)s=s.concat(e.getControlPoints(t[r]-this.scene.paramsEditing.croppingMaskParams.x,t[r+1]-this.scene.paramsEditing.croppingMaskParams.y,t[r+2]-this.scene.paramsEditing.croppingMaskParams.x,t[r+3]-this.scene.paramsEditing.croppingMaskParams.y,t[r+4]-this.scene.paramsEditing.croppingMaskParams.x,t[r+5]-this.scene.paramsEditing.croppingMaskParams.y,this.arrayWeight[r]));this.arrayControlPoint=s},e.prototype.isInsideFirstAndLastCurves=function(e,t,n){void 0===n&&(n=100);for(var o=this.arrayVertexs,i=this.arrayControlPoint,s=0;s<1;s+=.001){var a=Math.abs(Math.pow(1-s,3))*o[0]+3*Math.pow(1-s,2)*s*i[0]+3*Math.abs(1-s)*Math.pow(s,2)*i[0]+Math.abs(Math.pow(s,3))*o[2],h=Math.abs(Math.pow(1-s,3))*o[1]+3*Math.pow(1-s,2)*s*i[1]+3*Math.abs(1-s)*Math.pow(s,2)*i[1]+Math.abs(Math.pow(s,3))*o[3],c=Math.abs(Math.pow(1-s,3))*o[2]+3*Math.pow(1-s,2)*s*i[2]+3*Math.abs(1-s)*Math.pow(s,2)*i[2]+Math.abs(Math.pow(s,3))*o[4],p=Math.abs(Math.pow(1-s,3))*o[3]+3*Math.pow(1-s,2)*s*i[3]+3*Math.abs(1-s)*Math.pow(s,2)*i[3]+Math.abs(Math.pow(s,3))*o[5];if((0,r.Th)(new r.h9(a,h),new r.h9(e,t))<n)return!0;if((0,r.Th)(new r.h9(c,p),new r.h9(e,t))<n)return!0}return!1},e.isLeave=!1,e.tOver=0,e.tDown1=0,e}(),ce=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),pe=function(){function e(e,t,n){this.scene=e,this.type=r.zq.APOINT,this.v=new r.h9(t.x,t.y),this.t=0,this.isRender=!1,this.renderStyleNode=new x,this.initStyle(n)}return e.prototype.initStyle=function(e){e===r.zq.POLYLINE_BENDING?x.updateRenderColorPolylineNode(this.renderStyleNode,this.scene.annotationInstance.customization.themeCurrent,this.scene.annotationInstance.activeCommandController.activeColorController.activeColor):e===r.zq.POLYGON_GRAPH&&x.updateRenderColorPolygonNode(this.renderStyleNode,this.scene.annotationInstance.customization.themeCurrent,this.scene.annotationInstance.activeCommandController.activeColorController.activeColor)},e.prototype.move=function(e,t){this.v.x=e,this.v.y=t},e.prototype.update=function(){},e.prototype.render=function(e){this.isRender&&(this.t+=.01,this.update(),this.renderPost(e))},e.prototype.renderPost=function(e){this.scene.annotationInstance.renderer.draw.shape.node.nodeStart(e,this.renderStyleNode,this.v.x-this.scene.paramsEditing.croppingMaskParams.x,this.v.y-this.scene.paramsEditing.croppingMaskParams.y,1,this.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.t))},e}(),le=function(e){function t(t,n,o){var i=e.call(this,t,n,o)||this;return i.type=r.zq.AMIDPOINT,i}return ce(t,e),t.prototype.renderPost=function(e){this.scene.annotationInstance.renderer.draw.shape.node.nodeMidStart(e,this.renderStyleNode,this.v.x-this.scene.paramsEditing.croppingMaskParams.x,this.v.y-this.scene.paramsEditing.croppingMaskParams.y,this.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.t))},t}(pe),de=function(){function e(e,t,n){void 0===n&&(n=100),this.scene=e,this.type=t,this.constraintLength=n,this.isConstraintDrawing=0!==n,this.ps=[],this.psMid=[],this.renderStyle=new x,this.renderStyle.scaleGlobal=this.scene.annotationInstance.activeCommandController.scaleGlobal,this.initStyle(t)}return e.prototype.initStyle=function(e){e===r.zq.POLYLINE_BENDING?x.updateRenderColorPolyline(this.renderStyle,this.scene.annotationInstance.customization.themeCurrent,this.scene.annotationInstance.activeCommandController.activeColorController.activeColor):e===r.zq.POLYGON_GRAPH&&x.updateRenderColorPolygon(this.renderStyle,this.scene.annotationInstance.customization.themeCurrent,this.scene.annotationInstance.activeCommandController.activeColorController.activeColor,this.scene.annotationInstance.activeCommandController.activeColorController.activeColor)},e.prototype.getVecs=function(){for(var e=[],t=1;t<this.ps.length;++t){var n=this.ps[t].v;e.push(n)}var o=new r.h9(this.MouseVec.x+this.scene.paramsEditing.croppingMaskParams.x,this.MouseVec.y+this.scene.paramsEditing.croppingMaskParams.y);return e.push(o),(0,r.z1)(e,2)},e.prototype.getVecsVis=function(){for(var e=[],t=1;t<this.ps.length;++t){var n=this.ps[t].v;e.push(new r.h9(n.x-this.scene.paramsEditing.croppingMaskParams.x,n.y-this.scene.paramsEditing.croppingMaskParams.y))}return e},e.prototype.add=function(e){var t=new pe(this.scene,new r.h9(e.x,e.y),this.type);this.ps.push(t),this.ps.length>2?(this.ps[this.ps.length-1].isRender=!0,this.MouseVec=new r.h9(this.ps[this.ps.length-1].v.x-this.scene.paramsEditing.croppingMaskParams.x,this.ps[this.ps.length-1].v.y-this.scene.paramsEditing.croppingMaskParams.y),this.addMid(this.ps[this.ps.length-2].v,this.ps[this.ps.length-1].v)):(this.ps[0].isRender=!0,this.MouseVec=new r.h9(this.ps[this.ps.length-1].v.x-this.scene.paramsEditing.croppingMaskParams.x,this.ps[this.ps.length-1].v.y-this.scene.paramsEditing.croppingMaskParams.y))},e.prototype.mouseMove=function(e,t){this.MouseVec.x=e-this.scene.paramsEditing.croppingMaskParams.x,this.MouseVec.y=t-this.scene.paramsEditing.croppingMaskParams.y},e.prototype.undo=function(){if(this.ps.length<3)return this.scene.listAPolylineGraphShadow=void 0,void this.scene.annotationInstance.activeCommandController.goToACMode();this.ps.pop(),this.psMid.pop()},e.prototype.render=function(e){if(this.update(),this.renderPLine(e),this.renderNode(e),this.scene.annotationInstance.activeCommandController.acProperties.showUnit){var t=this.getVecs();t&&(this.dimension.renderLength(e,!1,t),this.dimension.renderTotalLength(e,t))}},e.prototype.addMid=function(e,t){var n=(0,r.zQ)(e,t),o=new le(this.scene,new r.h9(n.x,n.y),this.type);o.isRender=!0,this.psMid.push(o)},e.prototype.update=function(){for(var e=this.ps.length;e--;)this.ps[e].update();for(e=this.psMid.length;e--;)this.psMid[e].update()},e.prototype.renderPLine=function(e){this.type===r.zq.POLYLINE_BENDING?this.scene.annotationInstance.renderer.draw.shape.line.polylineShadow(e,this.renderStyle,this.getVecsVis(),this.MouseVec,this.type):this.type===r.zq.POLYGON_GRAPH&&this.scene.annotationInstance.renderer.draw.shape.line.polygonShadow(e,this.renderStyle,this.getVecsVis(),this.MouseVec,this.type)},e.prototype.renderNode=function(e){for(var t=this.ps.length;t--;)this.ps[t].render(e)},e}(),ue=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),ye=function(e){function t(t){var n=e.call(this,t)||this;return n.host=t,n}return ue(t,e),t.prototype.renderPost=function(e){!this.host.isRemove&&this.host.isRenderable&&(this.interpolateColor.update(),this.host.computeCenterVec(),this.timer.updatePopupSummery(),this.host.updateProjection(),this.renderPostGeometry(e))},t.prototype.renderPostGeometry=function(e){this.host.scene.annotationInstance.activeCommandController.acProperties.showUnit&&(this.host.isHoverValue||this.host.isUnderConstruction)&&this.host.dimension.renderLength(e,!1,this.host.getVecs()),this.renderHoverEffect(e),this.host.scene.annotationInstance.renderer.draw.shape.draw.renderer.needFocus&&this.host.isHoverValue,e.strokeStyle=this.host.styleComponent.renderStyle.colorInterpolatedString,this.host.isSelectedValue&&(e.strokeStyle=this.host.styleComponent.renderStyle.colorInterpolatedString),e.lineWidth=this.host.styleComponent.renderStyle.lineWidth*this.host.styleComponent.renderStyle.scaleGlobal*this.host.styleComponent.renderStyle.scaleLocal,e.beginPath();var t=this.host.edges[0].p0.vec.x-this.host.scene.paramsEditing.croppingMaskParams.x,n=this.host.edges[0].p0.vec.y-this.host.scene.paramsEditing.croppingMaskParams.y;e.moveTo(t,n);for(var o=this.host.edges.length,i=0;i<o;++i)this.host.edges[i].renderPost(e);e.lineCap="round",e.setLineDash(this.host.styleComponent.renderStyle.dash),e.stroke(),e.setLineDash([0,0])},t.prototype.renderHoverEffect=function(e){var t=this.host.edges.length;if(this.host.isHover||this.host.isSelected){this.tOver+=.015,this.tDown1=0,this.host.isLeave=!0;var n=this.host.scene.paramsEditing.croppingMaskParams.x,o=this.host.scene.paramsEditing.croppingMaskParams.y,i=this.host.styleComponent.renderStyle,s=this.host.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tOver);e.lineWidth=s*i.lineWidth*i.scaleGlobal*i.scaleLocal*this.host.scene.annotationInstance.implementations.imageAnnoApp.customization.themeCurrent.properties.elasticScale,e.beginPath();for(var r=0;r<t;++r){var a=this.host.edges[r].p0;e.moveTo(a.vec.x-n,a.vec.y-o);var h=this.host.edges[r].p1;e.strokeStyle=this.host.scene.annotationInstance.renderer.imageAnnoApp.customization.themeCurrent.properties.outlineHoverColorRGBAString,e.lineTo(h.vec.x-n,h.vec.y-o)}e.setLineDash(i.dash),e.lineCap="round",e.stroke(),e.setLineDash([0,0])}else this.tOver=0},t}(C),me=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),ve=function(e){function t(t){var n=e.call(this,t)||this;return n.updateStyle(),n.updateColor(),n}return me(t,e),t.prototype.updateStyle=function(){if(!this.isCustom&&(this.state.themeColorId=s.AccentColor1,this.isCustom=!0,x.updateRenderStylePolyline(this.renderStyle,this.geo.scene.annotationInstance.customization.themeCurrent),x.updateRenderStylePolylineNode(this.renderStyleNode,this.geo.scene.annotationInstance.customization.themeCurrent),this.geo.edges))for(var e=0;e<this.geo.edges.length;++e)this.geo.edges[e].p0.styleComponent.updateStyleForNode(this.renderStyleNode),this.geo.edges[e].pm.styleComponent.updateStyleForNode(this.renderStyleNode),this.geo.edges[e].p1.styleComponent.updateStyleForNode(this.renderStyleNode)},t.prototype.updateColor=function(e){if(void 0===e&&(e=void 0),this.isCustom=!0,void 0===e&&(e=this.geo.scene.annotationInstance.activeCommandController.activeColorController.activeColor),x.updateRenderColorPolyline(this.renderStyle,this.geo.scene.annotationInstance.customization.themeCurrent,e),x.updateRenderColorPolylineNode(this.renderStyleNode,this.geo.scene.annotationInstance.customization.themeCurrent,e),this.geo.edges)for(var t=0;t<this.geo.edges.length;++t)this.geo.edges[t].p0.styleComponent.updateStyleForNode(this.renderStyleNode),this.geo.edges[t].pm.styleComponent.updateStyleForNode(this.renderStyleNode),this.geo.edges[t].p1.styleComponent.updateStyleForNode(this.renderStyleNode);this.tempColorRgba=e},t.prototype.updateStyleCustom=function(e){if(e.width&&(this.state.width=e.width),void 0!==e.color&&(this.state.themeColorId=e.color),e.colorRgba.length>0&&(this.tempColorRgba=e.colorRgba,x.updateRenderStylePolylineCustom(this.renderStyle,this.geo.scene.annotationInstance.customization.themeCurrent,e.colorRgba),x.updateRenderStylePolylineNodeCustom(this.renderStyleNode,this.geo.scene.annotationInstance.customization.themeCurrent,e.colorRgba),this.geo.edges))for(var t=0;t<this.geo.edges.length;++t)this.geo.edges[t].p0.styleComponent.updateStyleForNode(this.renderStyleNode),this.geo.edges[t].pm.styleComponent.updateStyleForNode(this.renderStyleNode),this.geo.edges[t].p1.styleComponent.updateStyleForNode(this.renderStyleNode);return e.scale&&(this.renderStyle.scaleLocal=e.scale,this.state.scale=e.scale),this.isCustom=!0,e.colorRgba.length>0&&this.updateColor(e.colorRgba),!0},t.prototype.setDash=function(e){this.renderStyle.dash=e,this.geo.scene.annotationInstance.io.eventListenerAnnotation.addGeometryStack(this.geo.toJSON())},t.prototype.toJson=function(){if(this.isCustom){var e={width:this.state.width,scale:this.renderStyle.scaleLocal,colorRgba:this.tempColorRgba};return this.state.themeColorId!==s.AccentColor1&&(e.color=this.state.themeColorId),e}},t.prototype.isSameStyle=function(e){if(e.colorRgba.length===this.tempColorRgba.length)for(var t=0;t<e.colorRgba.length;t++)if(e.colorRgba[t]!==this.tempColorRgba[t])return!1;return!0},t}(b),ge=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),fe=function(e){function t(t,n,o,i,s){void 0===o&&(o=r.zq.POLYLINE_BENDING),void 0===i&&(i=!1),void 0===s&&(s=!0);var a=e.call(this,t)||this;a.torVisMidPt=10,a.vecSelected=-1,a.type=o,a.isUnderConstruction=!1,a.isSelectable=!0,a.isRenderable=!0,a.isUndo=i,a.isPath=!1,a.initComponent(),a.checkIsClosed(n);var h=a.computeNode(n,s);return a.computeEdge(h),a.computeCenterVec(),a.initVecsHistory(),a.isMovedValue=!0,a.initPolylineGraph(),a}return ge(t,e),t.findAtPoint=function(e,t){for(var n=e.listAPolylineGraphWrapper.length-1;n>=0;--n)if(e.listAPolylineGraphWrapper[n].isSelectable&&e.listAPolylineGraphWrapper[n].isMouseInside(t.x,t.y))return e.listAPolylineGraphWrapper[n]},t.getLengthSelection=function(e){for(var t=e.listAPolylineGraphWrapper.length,n=0;t--;)e.listAPolylineGraphWrapper[t].isSelected&&(n+=1);return n},t.computeOver=function(e,t){var n=this.findAtPoint(e,t);void 0!==n&&(n.isHoverValue=!0)},t.computeVectorsForBuild=function(){},t.fromJSON=function(e,n,o,i){void 0===o&&(o=!1),void 0===i&&(i=!1);for(var s=[],a=0;a<n.nodes.length;a+=2){var h=[n.nodes[a].sx,n.nodes[a].sy],c=new r.h9(h[0],h[1]);s.push(c)}var p=new t(e,s,r.zq.POLYLINE_BENDING,o,!0);return p.type=r.zq[n.type],p.id=i?e.getUUID():n.id,p.IsSelectable=!0,p.isUnderConstruction=!1,p.isHover=!1,n.styles&&n.styles.dash&&(p.styleComponent.renderStyle.dash=n.styles.dash),p.isHiddenValue=n.isHidden,n.isHidden?p.visibilityValue=0:p.visibilityValue=1,n.styles&&p.updateStyleCustom(n.styles),p.computeCenterVec(),p.initVecsHistory(),o||e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(p.toJSON()),p},t.getLine=function(e){},t.getLineByPt=function(e){},t.mouseDown=function(e,t){void 0!==e.listAPolylineGraphShadow&&e.listAPolylineGraphShadow.ps.length>0&&e.listAPolylineGraphShadow.add(new r.h9(t.x,t.y))},t.mouseLeftClick=function(e,t){void 0===e.capture&&(void 0===e.listAPolylineGraphShadow&&(e.listAPolylineGraphShadow=new de(e,r.zq.POLYLINE_BENDING),e.listAPolylineGraphShadow.add(new r.h9(t.x,t.y)),e.listAPolylineGraphShadow.add(new r.h9(t.x,t.y))),e.annotationInstance.implementations.app.model.ioWrapper.eventInteraction.isEnableZoomByDoubleClick=!1)},t.mouseMove=function(e,t){if(void 0!==e.listAPolylineGraphShadow){if(e.annotationInstance.activeCommandController.acProperties.pressShift){var n=e.listAPolylineGraphShadow.ps[e.listAPolylineGraphShadow.ps.length-1];(0,r.Sp)(n.v,new r.h9(t.x,t.y))>20&&e.listAPolylineGraphShadow.add(new r.h9(t.x,t.y))}e.listAPolylineGraphShadow.ps.length>1&&e.listAPolylineGraphShadow.mouseMove(t.x,t.y)}},t.mouseDoubleClick=function(e,n){var o;void 0!==e.listAPolylineGraphShadow&&(e.annotationInstance.activeCommandController.IsTouchEvent?e.listAPolylineGraphShadow.ps.length>1&&(o=e.listAPolylineGraphShadow.getVecs())&&((o=o.slice(0,o.length-1))?(t.getPolyline(e,o),e.listAPolylineGraphShadow=void 0,e.annotationInstance.activeCommandController.goToACMode()):(e.listAPolylineGraphShadow=void 0,e.annotationInstance.activeCommandController.goToACMode())):e.listAPolylineGraphShadow.ps.length>1&&((o=e.listAPolylineGraphShadow.getVecs())?(t.getPolyline(e,o),e.listAPolylineGraphShadow=void 0,e.annotationInstance.activeCommandController.goToACMode()):(e.listAPolylineGraphShadow=void 0,e.annotationInstance.activeCommandController.goToACMode())),e.annotationInstance.implementations.app.model.ioWrapper.eventInteraction.isEnableZoomByDoubleClick=!0)},t.undo=function(e,t){void 0!==e.listAPolylineGraphShadow&&e.listAPolylineGraphShadow.undo()},t.doneByKeyboard=function(e){if(void 0!==e.listAPolylineGraphShadow){var n=e.listAPolylineGraphShadow.getVecs();n?(t.getPolyline(e,n),e.listAPolylineGraphShadow=void 0,e.annotationInstance.activeCommandController.goToACMode()):(e.listAPolylineGraphShadow=void 0,e.annotationInstance.activeCommandController.goToACMode())}},t.cancel=function(e){void 0!==e.listAPolylineGraphShadow&&(e.listAPolylineGraphShadow=void 0)},t.getPolyline=function(e,n,o){if(void 0===o&&(o=!1),!(n.length<2)){if(!(o&&(0,r.Sp)(n[0],n[n.length-1])<10))return e.listAPolylineGraphShadow=void 0,new t(e,n,r.zq.POLYLINE_BENDING,!1,!0);B.getPolygonbyVecs(e,n)}},t.prototype.initPolylineGraph=function(){this.dimension=new H(this),this.isUndo||this.scene.annotationInstance.io.eventListenerAnnotation.addGeometryStack(this.toJSON()),this.scene.addAPolylineGraphWrapper(this)},t.prototype.initComponent=function(){this.styleComponent=new ve(this),this.renderer=new ye(this)},Object.defineProperty(t.prototype,"isHidden",{get:function(){return this.isHiddenValue},set:function(e){this.isHiddenPre=this.isHiddenValue,this.isHiddenValue=e;for(var t=0;t<this.edges.length;++t)this.edges[t].IsHidden=e,this.edges[t].Visibility=0;this.scene.annotationInstance.io.eventListenerAnnotation.hideStack(this.toJSON())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isHover",{get:function(){return this.isHoverValue},set:function(e){if(this.isHoverValue=e,(this.isHoverValue&&!this.isHoverPre||!this.isHoverValue&&this.isHoverPre)&&this.scene.annotationInstance.io.eventListenerAnnotation.hoverStack(this.toJSON()),this.isHoverPre=this.isHoverValue,!this.isSelectedValue)for(var t=this.edges.length;t--;)this.edges[t].IsRenderable=e,this.edges[t].IsHover=e;this.isHover,e||(this.needEmitHoverPost=!0,this.hidePopUpSummary())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"IsSelectable",{get:function(){return this.isSelectable},set:function(e){this.isSelectable=e;for(var t=0;t<this.edges.length;++t)this.edges[t].IsSelectable=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isSelected",{get:function(){return this.isSelectedValue},set:function(e){if(!this.isRemove&&!this.isHiddenValue){this.isSelectedValue=e;for(var t=0,n=this.edges;t<n.length;t++)(r=n[t]).IsSelected=e;for(var o=!0,i=0,s=this.edges;i<s.length;i++){var r;if((r=s[i]).p0.isSelectedValue){o=!1;break}if(r.pm.isSelectedValue){o=!1;break}if(r.p1.isSelectedValue){o=!1;break}}o&&this.scene.annotationInstance.io.eventListenerAnnotation.selectionStack(this.toJSON())}},enumerable:!1,configurable:!0}),t.prototype.move=function(e,t){if(!this.isRemove&&this.isRenderable&&!this.isHiddenValue){this.computeCenterVec();for(var n=e-this.vec.x,o=t-this.vec.y,i=0;i<this.edges.length;++i)this.edges[i].p0.vec.x+=n,this.edges[i].p0.vec.y+=o,this.edges[i].pm.vec.x+=n,this.edges[i].pm.vec.y+=o,this.edges[i].p1.vec.x+=n,this.edges[i].p1.vec.y+=o}},t.prototype.computeCenterVec=function(){for(var e=[],t=0;t<this.edges.length;++t)e.push(this.edges[t].p0.vec,this.edges[t].pm.vec,this.edges[t].p1.vec);this.vec=(0,r.mI)(e)},t.prototype.computeEdge=function(e){this.edges=[];for(var t=0;t<e.length-1;++t)this.edges.push(this.addEdge(e[t],e[t+1]))},t.prototype.addEdge=function(e,t){var n=(0,r.zQ)(e.vec,t.vec),o=new k(this.scene,n.x,n.y,0,!1,r.zq.AMIDPOINT);return new he(this.scene,this,e,o,t)},t.prototype.getNodePopup=function(){if(0!==this.edges.length){for(var e=this.edges[0].p0,t=Number.MAX_SAFE_INTEGER,n=0;n<this.edges.length;++n)this.edges[n].p0.vec.x<t&&(e=this.edges[n].p0,t=this.edges[n].p0.vec.x),this.edges[n].pm.vec.x<t&&(e=this.edges[n].pm,t=this.edges[n].pm.vec.x),this.edges[n].p1.vec.x<t&&(e=this.edges[n].p1,t=this.edges[n].p1.vec.x);return e}},t.prototype.computeNode=function(e,t){void 0===t&&(t=!0);var n=[];if(t)for(var o=0;o<e.length;++o)(i=new k(this.scene,e[o].x,e[o].y)).type=r.zq.ANODE,i.edges.push(this),i.isUnderConstruction=!1,n.push(i);else for(o=0;o<e.length;++o){var i;(i=k.getNodeFromScreenPos(this.scene,e[o])).type=r.zq.ANODE,i.isUnderConstruction=!1,i.edges.push(this),n.push(i)}return n},t.prototype.removeAndAppendEdge=function(e,t){var n=this.edges.indexOf(e);this.edges.splice(n,1);for(var o=0;o<t.length;++o)this.edges.splice(n,0,t[o])},t.prototype.removeEdge=function(e){this.edges.splice(this.edges.indexOf(e),1)},t.prototype.RemovePt=function(e){},t.prototype.remove=function(e){if(void 0===e&&(e=!0),!this.isRemove&&this.isRenderable&&!this.isHiddenValue)if(this.scene.Capture&&this.scene.Capture.type===r.zq.ANODE){var t=this.scene.Capture;if(t.aEdges[1]&&t.aEdges[0]){var n=t.aEdges[0].p0===t?t.aEdges[0].p1:t.aEdges[0].p0,o=t.aEdges[1].p0===t?t.aEdges[1].p1:t.aEdges[1].p0,i=[];n.aEdges.forEach((function(e){e.p0!==t&&e.p1!==t&&i.push(e)})),n.aEdges=i,i=[],o.aEdges.forEach((function(e){e.p0!==t&&e.p1!==t&&i.push(e)})),o.aEdges=i;var s=this.edges.lastIndexOf(t.aEdges[0]),a=this.edges.lastIndexOf(t.aEdges[1]),h=this.addEdge(n,o),c=s<a?s:a;this.edges.splice(c,0,h),t.aEdges[0].pm.deepRemove(),t.aEdges[1].pm.deepRemove(),this.edges.splice(this.edges.indexOf(t.aEdges[0]),1),this.edges.splice(this.edges.indexOf(t.aEdges[1]),1)}else if(t.aEdges[0]){n=t.aEdges[0].p0===t?t.aEdges[0].p1:t.aEdges[0].p0;var p=[];n.aEdges.forEach((function(e){e.p0!==t&&e.p1!==t&&p.push(e)})),n.aEdges=p,t.aEdges[0].pm.deepRemove(),this.edges.splice(this.edges.indexOf(t.aEdges[0]),1)}t.deepRemove(),this.reBuildConnection(),this.computeCenterVec(),this.initVecsHistory(),e&&(l=this.toJSON())&&this.scene.annotationInstance.io.eventListenerAnnotation.removeGeometryStack([l])}else{for(var l,d=this.edges.length;d--;)this.edges[d].remove();e&&(l=this.toJSON())&&this.scene.annotationInstance.io.eventListenerAnnotation.removeGeometryStack([l]),this.deepRemove()}},t.prototype.deepRemove=function(){this.isSelectable=!1,this.isRenderable=!1,this.hidePopUpSummary(),this.scene.removeAPolylineGraphWrapper(this),this.scene.removeGeometry(this)},t.prototype.removeOrphanNode=function(){},t.prototype.checkMinPt=function(){},t.prototype.updateGeometryByProjectedpos=function(e){},t.prototype.getLog=function(){return this.type},t.prototype.goToBlackhole=function(){this.isSelectable=!1,this.needBlackhole=!0,this.edges.forEach((function(e){e.p0.goToBlackhole(),e.pm.goToBlackhole(),e.p1.goToBlackhole()}))},t.prototype.isMouseInside=function(e,t){for(var n=!1,o=0;o<this.edges.length;++o)this.edges[o].isMouseInside(e,t)&&(n=!0);if(this.vecOthers){var i=this.vecOthers[0].x-this.edges[0].p0.vec.x;for(o=0;o<this.edges.length;++o)this.edges[o].isMouseInside(e-i,t)&&(n=!0)}for(o=0;o<this.edges.length;++o)this.edges[o].IsHover=n;return n},t.prototype.isMouseInsideNode=function(e,t){return!1},t.prototype.hasSamePtWtithCapture=function(){for(var e=0;e<this.edges.length;++e){if(this.edges[e].p0===this.scene.capture)return!0;if(this.edges[e].pm===this.scene.capture)return!0;if(this.edges[e].p1===this.scene.capture)return!0}return!1},t.prototype.translateByMouseEventData=function(e){if(!this.hasSamePtWtithCapture()){this.resetVisitPt();for(var t=0;t<this.edges.length;++t)this.edges[t].translateByMouseEventData(e)}},t.prototype.translateByMouseEventDataForTextLeaderline=function(e){},t.prototype.mouseLeftClick=function(){this.scene.annotationInstance.geometryCommon.gcmdProcessing.removeAllPopup(),this.showPopupSummary()},t.prototype.translate=function(e,t){},t.prototype.getVecForSnapping=function(){},t.prototype.hide=function(){},t.prototype.updateProjection=function(){this.isUnderConstruction},t.prototype.wrappingProjectedPosShape=function(e,t){e.isVisited||(e.isVisited=!0)},t.prototype.renderPost=function(e){this.renderer.renderPost(e)},t.prototype.getVecs=function(){for(var e=[],t=0;t<this.edges.length;++t)t===this.edges.length-1?(e.push(this.edges[t].p0.vec),e.push(this.edges[t].pm.vec),e.push(this.edges[t].p1.vec)):(e.push(this.edges[t].p0.vec),e.push(this.edges[t].pm.vec));return e},t.prototype.checkIsClosed=function(e,t){void 0===t&&(t=!1),t?(0,r.Sp)(e[0],e[e.length-1])<20&&(this.isClosed=!0,this.type=r.zq.POLYGON):this.isClosed=!1},t.prototype.getNode=function(){for(var e=[],t=0;t<this.edges.length;++t)t===this.edges.length-1?(e.push(this.edges[t].p0.vec),e.push(this.edges[t].pm.vec),e.push(this.edges[t].p1.vec)):(e.push(this.edges[t].p0.vec),e.push(this.edges[t].pm.vec));return e},t.prototype.toJSON=function(){var e=new p(this.id,this.type,this.isSelectedValue,this.isHoverValue,this.isHiddenValue);e.pushNode(this.getNode());var t=this.styleComponent.toJson();return t&&(e.styles=t),e},t.prototype.deepCopy=function(e,n,o){void 0===o&&(o=0);var i=this.toJSON();if(i){var s=t.fromJSON(this.scene,i,!1,!0);return s.move(e,n),s}},t.prototype.reBuildConnection=function(){this.edges.length>0&&(this.edges=this.reorderEdges())},t.prototype.updatePostTransformation=function(){for(var e=0;e<this.edges.length;++e)this.edges[e].updateMidVec()},t.prototype.resetVisitPt=function(){this.edges.forEach((function(e){e.p0.isVisited=!1,e.pm.isVisited=!1,e.p1.isVisited=!1}))},t.prototype.reorderEdges=function(){for(var e=[this.edges[0]],t=1e3,n=this.edges[0],o=1===this.edges[0].p0.aEdges.length?this.edges[0].p1:this.edges[0].p0;o&&2===o.aEdges.length&&(n=o.aEdges[0]===n?o.aEdges[1]:o.aEdges[0],e.push(n),o=o===n.p0?n.p1:n.p0,!(--t<0)););return e},t.prototype.checkAttachedTextleaderline=function(){for(var e=0,t=this.edges;e<t.length;e++){var n=t[e];if(n.p0.textLeaderline&&n.p0.textLeaderline.leaderline){if((0,r.Sp)(n.p0.vec,n.p0.textLeaderline.leaderline.v2)<5)return!0;n.p0.textLeaderline.attachedShape=void 0,n.p0.textLeaderline=void 0}if(n.pm.textLeaderline&&n.pm.textLeaderline.leaderline){if((0,r.Sp)(n.pm.vec,n.pm.textLeaderline.leaderline.v2)<5)return!0;n.pm.textLeaderline.attachedShape=void 0,n.pm.textLeaderline=void 0}if(n.p1.textLeaderline&&n.p1.textLeaderline.leaderline){if((0,r.Sp)(n.p1.vec,n.p1.textLeaderline.leaderline.v2)<5)return!0;n.p1.textLeaderline.attachedShape=void 0,n.p1.textLeaderline=void 0}}return!1},t.prototype.updateMidVec=function(){for(var e=0;e<this.edges.length;++e)if(!this.edges[e].isCurved){var t=(0,r.zQ)(this.edges[e].p0.vec,this.edges[e].p1.vec);this.edges[e].pm.vec.x=t.x,this.edges[e].pm.vec.y=t.y}},t.isSplit=!0,t}(y),Ce=function(){function e(){}return e.mouseDown=function(e,t){var n=e.annotationInstance.geometryCommon.gcmdProcessing.findAtPoint(t);n&&n.remove()},e.mouseMove=function(e){},e}(),Se=function(){function e(e){this.scene=e,this.vecs=[],this.isWindow=!1,this.t=0,this.vecTooltip=new r.h9(0,0)}return e.prototype.computeRecPtsWithMouse=function(e,t){},e.prototype.addVecs=function(e,t){this.vecs.push(new r.h9(e,t))},e.prototype.remove=function(){},e.prototype.cancel=function(){void 0!==e.construction&&e.construction.remove(),e.construction=void 0},e.prototype.drawShadow=function(t){void 0===e.construction||e.construction.computeRecPtsWithMouse(t.x,t.y)},e.prototype.mouseDown=function(t){this.v0=new r.h9(t.x,t.y),this.vecTooltip.x=-100,this.vecTooltip.y=-100,e.isTooltipRenderable=!1},e.prototype.mouseDrag=function(t){e.isLasso?this.addVecs(t.x,t.y):this.v1=new r.h9(t.x,t.y)},e.prototype.mouseUp=function(t){if(this.scene.annotationInstance.geometryCommon.gcmdSelecting.deSelectCaptureObjects(),e.isLasso){if(this.vecs.length<1)return;this.scene.annotationInstance.geometryCommon.gcmdSelecting.selecteObjectsByVecs((0,r.z1)(this.vecs)),this.vecs=[]}else{if(void 0===this.v0||void 0===this.v1)return;this.scene.annotationInstance.geometryCommon.gcmdSelecting.selecteObjectsByVecs((0,r.F$)(this.v0,this.v1),this.isWindow),this.v0=void 0,this.v1=void 0}},e.prototype.mouseMove=function(e){this.vecTooltip.x=e.x,this.vecTooltip.y=e.y},e.prototype.render=function(t){if(e.isTooltipRenderable,e.isLasso){if(this.vecs.length<1)return;this.scene.annotationInstance.renderer.draw.shape.selection.selectionLasso(t,this.vecs,!1,this.t)}else{if(void 0===this.v0||void 0===this.v1)return;this.v0.x>this.v1.x||this.v0.y>this.v1.y?this.isWindow=!0:this.isWindow=!1,this.scene.annotationInstance.renderer.draw.shape.selection.selection(t,this.v0,this.v1,this.isWindow,this.t)}this.t+=.5},e.isLasso=!1,e.isTooltipRenderable=!1,e}(),Ae=function(){function e(e){this.keyEventController=e}return e.prototype.keypress=function(e){var t=this.keyEventController.acWrapper.acs.imageAnnoApp.customization.shortcut.shortcutCommands[e.key.toUpperCase()];return void 0!==t&&e.hasCtrlKey===t.hasControl&&e.hasShiftKey===t.hasShift&&(this.keyEventController.acWrapper.acs.setActiveCommand(t.ac),!0)},e.prototype.ByDeleteKey=function(){this.keyEventController.acWrapper.acs.type!==r.uA.POLYLINE&&this.keyEventController.acWrapper.acs.type!==r.uA.POLYGON&&this.keyEventController.acWrapper.acs.type!==r.uA.CPOLYLINE&&this.keyEventController.acWrapper.acs.type!==r.uA.CPOLYGON&&this.keyEventController.acWrapper.acs.type!==r.uA.POLYLINE_BENDING&&this.keyEventController.acWrapper.acs.type!==r.uA.POLYGON_GRAPH||this.keyEventController.acWrapper.acs.activeCommand.undo(),this.keyEventController.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdProcessing.removeAllCapturedGeoGroup(),this.keyEventController.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce()},e.prototype.ByESCKey=function(){this.keyEventController.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdSelecting.cancelActiveCommand(),this.keyEventController.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdSelecting.deSelectCaptureObjects(),this.keyEventController.acWrapper.acs.acProperties.pressESC=!0,this.keyEventController.acWrapper.acs.goToACMode(),this.keyEventController.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce()},e}(),Pe=function(){function e(e){this.acWrapper=e,this.shortcutImplementation=new Ae(this)}return e.prototype.keyboardEventController=function(e){switch(e.PRESS_TYPE){case r.rO.Down:this.keydownPre(e);break;case r.rO.Up:this.keyUpPre(e)}},e.prototype.keyboardEventControllerFromDocument=function(e){switch(e.PRESS_TYPE){case r.rO.Down:this.keydownPreFromDocument(e);break;case r.rO.Up:this.keyUpPreFromDocument(e)}},e.prototype.keydownPre=function(e){if(this.acWrapper.acs.acProperties.pressKey=!0,e.hasCtrlKey&&(this.acWrapper.acs.acProperties.pressCtrlKey=!0),e.hasShiftKey&&e.hasCtrlKey&&76===e.keyCode)this.acWrapper.acs.imageAnnoApp.apiWrapper.environment.shiftLog();else if(e.hasShiftKey&&e.hasCtrlKey&&32===e.keyCode)this.acWrapper.acs.imageAnnoApp.implementations.app.initViewController();else if(!this.shortcutImplementation.keypress(e))if(this.acWrapper.acs.imageAnnoApp.implementations.app.PRODUCTION||!e.hasShiftKey||49!==e.keyCode)if(this.acWrapper.acs.imageAnnoApp.implementations.app.PRODUCTION||!e.hasShiftKey||50!==e.keyCode)if(this.acWrapper.acs.imageAnnoApp.implementations.app.PRODUCTION||!e.hasShiftKey||51!==e.keyCode)if(this.acWrapper.acs.imageAnnoApp.implementations.app.PRODUCTION||!e.hasShiftKey||52!==e.keyCode){if(!e.hasShiftKey||73!==e.keyCode)return e.hasShiftKey&&67===e.keyCode?(this.acWrapper.acs.imageAnnoApp.activeCommandController.setActiveCommand(r.uA.CIRCLE),void this.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce()):e.hasShiftKey&&82===e.keyCode?(this.acWrapper.acs.imageAnnoApp.activeCommandController.setActiveCommand(r.uA.RECTANGLE),void this.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce()):e.hasShiftKey&&70===e.keyCode?(this.acWrapper.acs.imageAnnoApp.apiWrapper.environment.shiftDash(),void this.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce()):void(this.acWrapper.acs.imageAnnoApp.implementations.app.PRODUCTION||!e.hasShiftKey||83!==e.keyCode?this.acWrapper.acs.imageAnnoApp.implementations.app.PRODUCTION||!e.hasShiftKey||87!==e.keyCode?this.acWrapper.acs.imageAnnoApp.implementations.app.PRODUCTION||!e.hasShiftKey||69!==e.keyCode?(49===e.keyCode?this.acWrapper.acs.imageAnnoApp.graphicsCoreWrapper.canvasWrapper.aCanvas.setLevel1():50===e.keyCode?this.acWrapper.acs.imageAnnoApp.graphicsCoreWrapper.canvasWrapper.aCanvas.setLevel2():51===e.keyCode?this.acWrapper.acs.imageAnnoApp.graphicsCoreWrapper.canvasWrapper.aCanvas.setLevel3():52===e.keyCode?this.acWrapper.acs.imageAnnoApp.graphicsCoreWrapper.canvasWrapper.aCanvas.setLevel4():53===e.keyCode?this.acWrapper.acs.imageAnnoApp.graphicsCoreWrapper.canvasWrapper.aCanvas.setLevel5():54===e.keyCode&&this.acWrapper.acs.imageAnnoApp.graphicsCoreWrapper.canvasWrapper.aCanvas.setLevel6(),this.acWrapper.acs.imageAnnoApp.implementations.app.model.appCoreWrapper.appControllerStatus.mode===r.An.Drawing&&(e.hasShiftKey&&8===e.keyCode||e.hasShiftKey&&e.keyCode&&46===e.keyCode?this.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdProcessing.removeAll():8!==e.keyCode&&46!==e.keyCode?(this.acWrapper.acs.imageAnnoApp.implementations.app.model.appCoreWrapper.appProperties.compileMode!==r.ct.Production&&(9===e.keyCode&&e.hasShiftKey&&(this.acWrapper.acs.acProperties.shiftDTMode++,this.acWrapper.acs.acProperties.shiftDTMode%3==0?this.acWrapper.acs.imageAnnoApp.implementations.app.model.appCoreWrapper.appControllerStatus.mode=r.An.Drawing:this.acWrapper.acs.acProperties.shiftDTMode%3==1?this.acWrapper.acs.imageAnnoApp.implementations.app.model.appCoreWrapper.appControllerStatus.mode=r.An.InteractiveViewer:this.acWrapper.acs.acProperties.shiftDTMode%3==2&&(this.acWrapper.acs.imageAnnoApp.implementations.app.model.appCoreWrapper.appControllerStatus.mode=r.An.ObserveViewer),this.acWrapper.acs.setActiveCommand(r.uA.NONE),this.acWrapper.acs.imageAnnoApp.apiWrapper.environment.logCommon(this.acWrapper.acs.m.x,this.acWrapper.acs.m.y)),e.hasShiftKey&&68===e.keyCode&&this.acWrapper.acs.imageAnnoApp.implementations.app.model.ioWrapper.download(),e.hasShiftKey&&79===e.keyCode&&this.acWrapper.acs.imageAnnoApp.implementations.app.model.ioWrapper.open(),85===e.keyCode&&this.acWrapper.acs.imageAnnoApp.apiWrapper.environment.shiftUnit()),e.hasShiftKey&&(this.acWrapper.acs.acProperties.pressShift=!0),e.hasAltKey&&(this.acWrapper.acs.acProperties.pressAltKey=!0,this.acWrapper.acs.acProperties.needDuplicateByAlt=!0),(this.acWrapper.acs.imageAnnoApp.implementations.app.model.appCoreWrapper.appControllerStatus.mode!==r.An.ObserveViewer||this.acWrapper.acs.imageAnnoApp.implementations.app.model.appCoreWrapper.appControllerStatus.currentControllerStatus.keyDown)&&(71===e.keyCode&&this.acWrapper.acs.imageAnnoApp.apiWrapper.environment.shiftGrid(),(this.acWrapper.acs.imageAnnoApp.implementations.app.model.appCoreWrapper.appControllerStatus.mode!==r.An.InteractiveViewer||this.acWrapper.acs.imageAnnoApp.implementations.app.model.appCoreWrapper.appControllerStatus.currentControllerStatus.keyDown)&&(77===e.keyCode&&this.acWrapper.acs.imageAnnoApp.apiWrapper.environment.shiftMeasure(),70===e.keyCode&&this.acWrapper.acs.imageAnnoApp.apiWrapper.environment.shiftMapfilter(),27===e.keyCode&&this.shortcutImplementation.ByESCKey(),83!==e.keyCode?49!==e.keyCode?(e.hasShiftKey&&65===e.keyCode&&this.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdSelecting.selectAllObjects(),(e.hasAltKey||e.hasMetaCommand||e.hasCtrlKey)&&67===e.keyCode&&this.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdProcessing.copySelGeo(),((e.hasAltKey||e.hasMetaCommand||e.hasCtrlKey)&&90===e.keyCode||90===e.keyCode)&&this.acWrapper.acs.activeCommand.undo(),(e.hasAltKey||e.hasMetaCommand||e.hasCtrlKey)&&86===e.keyCode&&(this.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdAProcessing.pasteSelGeo(this.acWrapper.acs.imageAnnoApp.activeCommandController.m.x,this.acWrapper.acs.imageAnnoApp.activeCommandController.m.y),this.acWrapper.acs.setActiveCommand(r.uA.NONE)),this.acWrapper.keydown(e),this.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce()):this.acWrapper.acs.imageAnnoApp.apiWrapper.environment.toggleBorderFeaturePolygon():this.acWrapper.acs.imageAnnoApp.activeCommandController.acProperties.snap=!this.acWrapper.acs.imageAnnoApp.activeCommandController.acProperties.snap))):this.shortcutImplementation.ByDeleteKey())):this.acWrapper.acs.imageAnnoApp.apiWrapper.environment.shiftIcon():this.acWrapper.acs.imageAnnoApp.apiWrapper.environment.shiftRenderShapeForRPoint():this.acWrapper.acs.imageAnnoApp.apiWrapper.environment.shiftScaleForRPoint());this.acWrapper.acs.activecommandIconPoint()}else this.acWrapper.acs.imageAnnoApp.apiWrapper.environment.shiftActiveCluster();else this.acWrapper.acs.imageAnnoApp.apiWrapper.environment.shiftScaleDynamicRender();else this.acWrapper.acs.imageAnnoApp.apiWrapper.environment.shiftOptimizerTextleaderline();else this.acWrapper.acs.imageAnnoApp.apiWrapper.environment.toggleDebuggerMode()},e.prototype.keyUpPre=function(e){27===e.keyCode&&(this.acWrapper.acs.acProperties.pressESC=!1),16===e.keyCode&&(this.acWrapper.acs.acProperties.pressShift=!1),this.acWrapper.acs.acProperties.pressCtrlKey=!1,this.acWrapper.keyUp(e),this.acWrapper.acs.acProperties.pressKey=!1},e.prototype.keydownPreFromDocument=function(e){switch(this.acWrapper.acs.acProperties.pressKey=!0,this.acWrapper.acs.acProperties.pressShift=e.hasShiftKey,this.acWrapper.acs.acProperties.pressCtrlKey=e.hasCtrlKey,e.key){case"Backspace":case"Delete":this.shortcutImplementation.ByDeleteKey();break;case"Escape":this.shortcutImplementation.ByESCKey()}},e.prototype.keyUpPreFromDocument=function(e){this.acWrapper.acs.acProperties.pressKey=!1,this.acWrapper.acs.acProperties.pressShift=e.hasShiftKey,this.acWrapper.acs.acProperties.pressCtrlKey=e.hasCtrlKey},e}(),we=function(){function e(e){this.mc=e}return e.prototype.mouseDownPre=function(e){},e.prototype.mouseLeftClickPre=function(e){},e.prototype.mouseMiddleClickPre=function(e){},e.prototype.mouseRightClickPre=function(e){},e.prototype.mouseUpPre=function(e){},e.prototype.mouseDoubleClickPre=function(e){},e.prototype.mouseMovePre=function(e){},e.prototype.mouseDragPre=function(e){},e.prototype.mouseWheelPre=function(e){},e}(),xe=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Ie=function(e){function t(t){var n=e.call(this,t)||this;return n._frameMove=0,n}return xe(t,e),t.prototype.mouseDownPre=function(e){this.mc.acWrapper.acs.imageAnnoApp.implementations.app.INSPECTION&&this.mc.acWrapper.acs.screenLog.push("MouseDownPre"),this.mc.acWrapper.acs.type!==r.uA.SELECT&&this.mc.acWrapper.acs.acProperties.isActivateSnapping&&this.mc.updatePosBySnapping(e);var t=this.mc.acWrapper.acs.imageAnnoApp;if(this.mc.mDownPos.x=e.x,this.mc.mDownPos.y=e.y,e=this.mc.acWrapper.acs.commonEvent(e),t.renderer.blackhole&&(t.renderer.blackhole.stopRender=!1),t.activeCommandController.acProperties.isDown=!0,t.activeCommandController.acProperties.isUp=!1,this.mc.acWrapper.acs.acProperties.needExecuteOptimizer=!0,t.activeCommandController.acProperties.clickMenu)t.activeCommandController.acProperties.clickMenu=!1;else if(!this.mc.acWrapper.acs.acProperties.isReturn&&t.implementations.app.model.appCoreWrapper.appControllerStatus.currentControllerStatus.mouseDown)if(e.isDown=!0,t.geometryCommon.gcmdProcessing.resetTranformation(),t.geometryCommon.gcmdProcessing.hasMultiSel(),t.activeCommandController&&(t.activeCommandController.acProperties.isTextEditing=!1,t.scene.captureText&&(t.io.eventListenerAnnotation.endEditingText(t.scene.captureText.toJSON()),t.scene.captureText=void 0)),t.implementations.app.model.appCoreWrapper.appControllerStatus.mode!==r.An.InteractiveViewer){if(this.mc.acWrapper.acs.acProperties.isSmartSelectionWhenDrawing||!this.mc.acWrapper.acs.acProperties.isDrawing){var n=t.geometryCommon.gcmdProcessing.findAtPoint(e),o=t.geometryCommon.gcmdProcessing.findAtPointFromAPoint(e),i=t.geometryCommon.gcmdProcessing.findAtPointFromPolygonGraph(e);if(i&&(o=i),n&&this.filterNodeSelectionForMovingMultipleShapes(n,e),n&&o&&n.type===r.zq.POLYLINE_BENDING&&(o.type===r.zq.POINT_REGULAR||o.type===r.zq.POINT_NUMBERED)&&(n=o),n&&n.type===r.zq.TEXT_LEADERLINE){t.implementations.app.model.ioWrapper.eventInteraction.isEnableZoomByDoubleClick=!1;var s=n;s.attachedShape&&s.leaderline&&(0,r.Sp)(s.leaderline.v2,new r.h9(this.mc.acWrapper.acs.m.x,this.mc.acWrapper.acs.m.y))<10&&(n=s.attachedShape)}else t.implementations.app.model.ioWrapper.eventInteraction.isEnableZoomByDoubleClick=!0;void 0!==n&&n.type!==r.zq.POLYGON_MULTIPLE?(n.type===r.zq.TEXT_LEADERLINE&&o&&(n=o),n.type!==r.zq.ANODE_RECT&&n.type!==r.zq.ANODE_CIRCLE||(n=n.edges[0]),t.scene.Capture&&(this.mc.acWrapper.acs.acProperties.pressShift||t.scene.Capture.isSelected&&(t.scene.Capture.isSelected=!1),t.scene.Capture.isCapturedValue=!1),t.scene.Capture=n,t.scene.Capture.isCapturedValue=!0):(t.scene.Capture&&(t.scene.Capture.isCapturedValue=!1),t.scene.Capture=void 0)}if(t.scene.Capture&&t.scene.Capture.type===r.zq.AMIDPOINT){var a=t.scene.Capture;a.aEdges[0]&&a.aEdges[0].checkIsSnapStraight()}this.mc.acWrapper.mouseDown(e)}else this.mc.acWrapper.acs.IsTouchEvent&&(this.mc.acWrapper.acs.type,r.uA.SELECT)},t.prototype.mouseLeftClickPre=function(e){if(this.mc.acWrapper.acs.imageAnnoApp.implementations.app.INSPECTION&&this.mc.acWrapper.acs.screenLog.push("MouseLeftClickPre"),this.mc.acWrapper.acs.imageAnnoApp.activeCommandController.acProperties.isClick=!0,!this.mc.acWrapper.acs.acProperties.isReturn&&this.mc.acWrapper.acs.imageAnnoApp.implementations.app.model.appCoreWrapper.appControllerStatus.currentControllerStatus.clickLeft&&(e=this.mc.acWrapper.acs.commonEvent(e),!this.mc.acWrapper.acs.imageAnnoApp.renderer.optimizer.mouseClick(e.x,e.y))){if(this.mc.acWrapper.acs.type===r.uA.SELECT&&this.mc.acWrapper.acs.acProperties.isActivateSnapping&&this.mc.updatePosBySnapping(e),!this.mc.acWrapper.acs.acProperties.pressShift&&this.mc.acWrapper.acs.acProperties.deselectNeeded?this.mc.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdSelecting.deSelectCaptureObjects():this.mc.acWrapper.acs.acProperties.deselectNeeded=!0,this.mc.acWrapper.acs.acProperties.isSmartSelectionWhenDrawing||!this.mc.acWrapper.acs.acProperties.isDrawing){var t;(t=this.mc.acWrapper.acs.imageAnnoApp.implementations.app.model.appCoreWrapper.browserUtility.isMobile&&this.mc.acWrapper.acs.imageAnnoApp.implementations.app.model.appCoreWrapper.appControllerStatus.mode!==r.An.Drawing?this.mc.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdProcessing.findAtPointByTouch(e):this.mc.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdProcessing.findAtPoint(e))&&(this.mc.acWrapper.acs.imageAnnoApp.scene.Capture=t),this.mc.acWrapper.acs.type===r.uA.APOINT||this.mc.acWrapper.acs.type===r.uA.POINT_ICON||this.mc.acWrapper.acs.type===r.uA.POINT_NUMBERED||this.mc.acWrapper.acs.type===r.uA.POINT_REGULAR||this.mc.acWrapper.acs.type===r.uA.TEXT?void 0!==this.mc.acWrapper.acs.imageAnnoApp.scene.capture&&(this.mc.acWrapper.acs.imageAnnoApp.scene.capture.type===r.zq.POINT_ICON||this.mc.acWrapper.acs.imageAnnoApp.scene.capture.type===r.zq.POINT_NUMBERED||this.mc.acWrapper.acs.imageAnnoApp.scene.capture.type===r.zq.POINT_REGULAR||this.mc.acWrapper.acs.imageAnnoApp.scene.capture.type===r.zq.TEXT||this.mc.acWrapper.acs.imageAnnoApp.scene.capture.type===r.zq.APOINT||this.mc.acWrapper.acs.imageAnnoApp.scene.capture.type===r.zq.CNODE?this.mc.acWrapper.acs.imageAnnoApp.scene.capture.isSelected=!this.mc.acWrapper.acs.imageAnnoApp.scene.capture.isSelected:(this.mc.acWrapper.acs.imageAnnoApp.scene.capture.isCapturedValue=!1,this.mc.acWrapper.acs.imageAnnoApp.scene.capture=void 0)):(void 0!==this.mc.acWrapper.acs.imageAnnoApp.scene.capture&&(this.mc.acWrapper.acs.imageAnnoApp.scene.capture.type===r.zq.TEXT||(this.mc.acWrapper.acs.imageAnnoApp.scene.capture.isSelected=!this.mc.acWrapper.acs.imageAnnoApp.scene.capture.isSelected,this.mc.acWrapper.acs.imageAnnoApp.scene.capture.mouseLeftClick(e.x,e.y))),this.mc.acWrapper.acs.imageAnnoApp.implementations.app.model.appCoreWrapper.appControllerStatus.mode===r.An.InteractiveViewer&&this.mc.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdProcessing.processSelectionViewerMode())}if(this.mc.acWrapper.acs.type!==r.uA.NONE&&this.mc.acWrapper.acs.type!==r.uA.SELECT&&this.mc.acWrapper.acs.type!==r.uA.SELECT_LASSO&&this.mc.acWrapper.acs.type!==r.uA.SELECT_RECT||this.mc.acWrapper.acs.imageAnnoApp.renderer.updateMouseHover(e),!this.mc.acWrapper.acs.imageAnnoApp.scene.capture)for(var n=0;n<this.mc.acWrapper.acs.imageAnnoApp.scene.listAPoint.length;++n)this.mc.acWrapper.acs.imageAnnoApp.scene.listAPoint[n].isSelectedSole=!1;this.mc.acWrapper.acs.imageAnnoApp.scene.Capture||this.mc.acWrapper.acs.type!==r.uA.SELECT||(this.mc.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdProcessing.removeAllPopup(),this.mc.acWrapper.acs.imageAnnoApp.io.eventListenerAnnotation.pointerOutStack()),this.mc.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdProcessing.emitSelections(),this.mc.acWrapper.mouseLeftClick(e)}},t.prototype.mouseMiddleClickPre=function(e){this.mc.acWrapper.acs.imageAnnoApp.implementations.app.model.appCoreWrapper.appControllerStatus.currentControllerStatus.clickMiddle&&(e=this.mc.acWrapper.acs.commonEvent(e),this.mc.acWrapper.mouseMiddleClick(e))},t.prototype.mouseRightClickPre=function(e){this.mc.acWrapper.acs.imageAnnoApp.implementations.app.model.appCoreWrapper.appControllerStatus.currentControllerStatus.clickRight&&(e=this.mc.acWrapper.acs.commonEvent(e),this.mc.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdProcessing.rightClickOnHoverGeo(e),this.mc.acWrapper.mouseRightClick(e))},t.prototype.mouseUpPre=function(e){if(this.mc.acWrapper.acs.imageAnnoApp.implementations.app.INSPECTION&&this.mc.acWrapper.acs.screenLog.push("MouseUpPre"),this.mc.acWrapper.acs.imageAnnoApp.activeCommandController.acProperties.isDragging=!1,this.mc.acWrapper.acs.imageAnnoApp.activeCommandController.acProperties.isUp=!0,this.mc.acWrapper.acs.imageAnnoApp.activeCommandController.acProperties.isDown=!1,this.mc.acWrapper.acs.imageAnnoApp.activeCommandController.acProperties.isClick=!1,e.isDown=!1,this.mc.acWrapper.acs.imageAnnoApp.scene.capture){var t=this.mc.acWrapper.acs.imageAnnoApp.scene.capture.getVecForSnapping();t&&this.mc.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdProcessing.autoSnapping(t)}this.mc.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdProcessing.doneDragging(),this.mc.acWrapper.acs.imageAnnoApp.scene.Capture&&(this.mc.acWrapper.acs.imageAnnoApp.scene.Capture.type,r.zq.ANODE),this.mc.acWrapper.acs.acProperties.isDrawing&&(this.mc.acWrapper.acs.imageAnnoApp.scene.Capture=void 0),this.mc.acWrapper.acs.imageAnnoApp.scene.Capture&&this.mc.acWrapper.acs.imageAnnoApp.scene.Capture.mouseUp(),this.mc.acWrapper.acs.imageAnnoApp.renderer.objectSnapping.updateGhostSnappingVec(void 0),this.mc.acWrapper.acs.imageAnnoApp.scene.capturePT=void 0,this.mc.acWrapper.acs.activeMouseCursor.updateActiveCursorByUp(this.mc.acWrapper.acs.type),this.mc.acWrapper.mouseUp(e),this.mouseUpPost(e)},t.prototype.mouseUpPost=function(e){this.mc.mDownPos.x!==e.x&&this.mc.mDownPos.y!==e.y&&this.mc.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdProcessing.transformStack()},t.prototype.mouseDoubleClickPre=function(e){if(this.mc.acWrapper.acs.imageAnnoApp.implementations.app.model.appCoreWrapper.appControllerStatus.currentControllerStatus.clickDouble){e=this.mc.acWrapper.acs.commonEvent(e);var t=this.mc.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdProcessing.findAtPoint(e);void 0!==t&&(t.type===r.zq.TEXT_LEADERLINE||t.mouseDoubleClick()),this.mc.acWrapper.mouseDoubleClick(e)}},t.prototype.mouseMovePre=function(e){this.mc.acWrapper.acs.imageAnnoApp.implementations.app.model.appCoreWrapper.appControllerStatus.currentControllerStatus.mouseMove&&(e.isDown?this.mouseDragPre(e):this._frameMove++%2==0&&(e=this.mc.acWrapper.acs.commonEvent(e),this.mc.acWrapper.acs.acProperties.isDrawing||this.mc.acWrapper.acs.type!==r.uA.SELECT&&this.mc.acWrapper.acs.type!==r.uA.NONE||this.mc.acWrapper.acs.imageAnnoApp.renderer.updateMouseHover(e),3===this.mc.acWrapper.acs.imageAnnoApp.graphicsCoreWrapper.canvasWrapper.aCanvas.canvasLoopController.level&&this.mc.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce(),this.mc.acWrapper.acs.activeMouseCursor.updateActiveCursorByMove(this.mc.acWrapper.acs.type),this.mc.acWrapper.mouseMove(e),this.mc.acWrapper.acs.imageAnnoApp.renderer.optimizer.mouseMove(e.x,e.y)))},t.prototype.mouseDragPre=function(e){if(this.mc.acWrapper.acs.imageAnnoApp.implementations.app.model.appCoreWrapper.appControllerStatus.currentControllerStatus.mouseDrag){if(e=this.mc.acWrapper.acs.commonEvent(e),this.mc.acWrapper.acs.imageAnnoApp.activeCommandController.acProperties.isDragging=!0,!0===e.isDown&&(this.mc.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdProcessing.moveMidPoint(e),this.mc.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdProcessing.moveSelectedGeo(e),this.mc.acWrapper.acs.imageAnnoApp.scene.capture&&(this.mc.acWrapper.acs.imageAnnoApp.scene.capture.type!==r.zq.APOINT&&this.mc.acWrapper.acs.imageAnnoApp.scene.capture.type!==r.zq.CNODE||this.mc.acWrapper.acs.imageAnnoApp.scene.capture.move(e.x,e.y)),this.mc.acWrapper.acs.acProperties.pressAltKey&&this.mc.acWrapper.acs.acProperties.needDuplicateByAlt&&(this.mc.acWrapper.acs.acProperties.needDuplicateByAlt=!1)),this.mc.acWrapper.acs.imageAnnoApp.scene.capture){var t=this.mc.acWrapper.acs.imageAnnoApp.scene.capture.getVecForSnapping();t&&this.mc.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdProcessing.autoSnappingTracker(t)}3===this.mc.acWrapper.acs.imageAnnoApp.graphicsCoreWrapper.canvasWrapper.aCanvas.canvasLoopController.level&&this.mc.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce(),this.mc.acWrapper.acs.imageAnnoApp.scene.captureHovered&&this.mc.acWrapper.acs.activeMouseCursor.updateActiveCursorByDrag(this.mc.acWrapper.acs.imageAnnoApp.scene.captureHovered),this.mc.acWrapper.acs.acProperties.needExecuteOptimizer=!0,this.mc.acWrapper.mouseDrag(e)}},t.prototype.filterNodeSelectionForMovingMultipleShapes=function(e,t){if(e.type===r.zq.AMIDPOINT&&e.edges[0].type===r.zq.ARROW_SINGLE||e.type===r.zq.AMIDPOINT&&e.edges[0].type===r.zq.ARROW_DOUBLE){var n=e;return this.mc.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdSelecting.deSelectAllObjects(),n.edges[0].isHover=!0,void(n.isSelected=!0)}if(e.type!==r.zq.ARROW_SINGLE&&e.type!==r.zq.ARROW_DOUBLE){if(e.type===r.zq.ANODE)return this.mc.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdSelecting.deSelectAllObjects(),void(e.aEdges[0].pGraph.isSelected=!0);if(e.type===r.zq.ANODE_RECT)return this.mc.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdSelecting.deSelectAllObjects(),void(e.isSelected=!0);if(e.type===r.zq.ANODE_CIRCLE)return this.mc.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdSelecting.deSelectAllObjects(),void(e.isSelected=!0);e.type!==r.zq.POLYGON_GRAPH||(o=e.getVecForSnapping())&&(this.mc.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdSelecting.deSelectAllObjects(),e.isSelected=!0)}else{var o;(o=e.findClosestNode(t.x,t.y))&&(this.mc.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdSelecting.deSelectAllObjects(),o.edges[0].isHover=!0,o.isSelected=!0)}},t}(we),be=function(){function e(e){this.mDownPos=new r.h9(-1,-1),this.acWrapper=e,this.MouseEvent=new Ie(this)}return e.prototype.mouseEventController=function(e){if(!(this.acWrapper.acs.imageAnnoApp.graphicsCoreWrapper.canvasWrapper.aCanvas.canvasLoopController.level<3)&&(4===this.acWrapper.acs.imageAnnoApp.graphicsCoreWrapper.canvasWrapper.aCanvas.canvasLoopController.level&&(this.acWrapper.acs.imageAnnoApp.graphicsCoreWrapper.canvasWrapper.aCanvas.canvasLoopController.stop=!1),this.acWrapper.acs.imageAnnoApp.implementations.app.model.appCoreWrapper.appProperties.isStandalone||!this.isOutsideExtent(e)))switch(e.CLICK_TYPE){case r.uD.Down:this.MouseEvent.mouseDownPre(e),this.mouseDownPost(e);break;case r.uD.Up:this.MouseEvent.mouseUpPre(e),this.mouseUpPost(e);break;case r.uD.Left:this.MouseEvent.mouseLeftClickPre(e),this.mouseLeftClickPost(e);break;case r.uD.Middle:this.MouseEvent.mouseMiddleClickPre(e),this.mouseMiddleClickPost(e);break;case r.uD.Right:this.MouseEvent.mouseRightClickPre(e),this.mouseRightClickPost(e);break;case r.uD.Double:this.MouseEvent.mouseDoubleClickPre(e),this.mouseDoubleClickPost(e);break;case r.uD.Move:this.MouseEvent.mouseMovePre(e),this.mouseMovePost(e);break;case r.uD.Drag:this.MouseEvent.mouseDragPre(e),this.mouseDragPost(e);break;case r.uD.Wheel:this.MouseEvent.mouseWheelPre(e),this.mouseWheelPost(e)}},e.prototype.updatePosBySnapping=function(e){var t=this.acWrapper.acs.imageAnnoApp.geometryCommon.gcmdProcessing.getPosBySnapping(e.x,e.y,20);e.x=t[0],e.y=t[1]},e.prototype.isOutsideExtent=function(e){var t=this.acWrapper.acs.imageAnnoApp.graphicsCoreWrapper.canvasWrapper.aCanvasMask.width;return t>e.x||this.acWrapper.acs.imageAnnoApp.graphicsCoreWrapper.canvasWrapper.aCanvasMask.canvas.width-t<e.x},e.prototype.mouseDownPost=function(e){},e.prototype.mouseUpPost=function(e){},e.prototype.mouseLeftClickPost=function(e){},e.prototype.mouseMiddleClickPost=function(e){},e.prototype.mouseRightClickPost=function(e){},e.prototype.mouseDoubleClickPost=function(e){},e.prototype.mouseMovePost=function(e){},e.prototype.mouseDragPost=function(e){},e.prototype.mouseWheelPost=function(e){},e}(),Oe=function(){function e(e){this.acs=e,this.mouseController=new be(this),this.keyboardController=new Pe(this)}return e.prototype.mouseEventController=function(e){this.mouseController.mouseEventController(e)},e.prototype.keyboardEventController=function(e){this.keyboardController.keyboardEventController(e)},e.prototype.keyboardEventControllerFromDocument=function(e){this.keyboardController.keyboardEventControllerFromDocument(e)},e.prototype.touchEventController=function(e){},e.prototype.mouseDown=function(e){},e.prototype.mouseLeftClick=function(e){},e.prototype.mouseMiddleClick=function(e){},e.prototype.mouseRightClick=function(e){},e.prototype.mouseDoubleClick=function(e){},e.prototype.mouseUp=function(e){},e.prototype.mouseMove=function(e){},e.prototype.mouseDrag=function(e){},e.prototype.keydown=function(e){},e.prototype.keyUp=function(e){},e.prototype.undo=function(){},e.prototype.cancel=function(){},e}(),Re=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Le=function(e){function t(t){return e.call(this,t)||this}return Re(t,e),t.prototype.mouseLeftClick=function(e){},t}(Oe),Ve=function(e){function t(t){return e.call(this,t)||this}return Re(t,e),t.prototype.mouseDown=function(e){Ce.mouseDown(this.acs.imageAnnoApp.scene,e)},t.prototype.mouseMove=function(e){Ce.mouseMove(e)},t}(Oe),ke=function(e){function t(t){return e.call(this,t)||this}return Re(t,e),t.prototype.mouseDown=function(e){this.acs.imageAnnoApp.renderer.selection.mouseDown(e)},t.prototype.mouseDrag=function(e){},t.prototype.mouseUp=function(e){},t}(Oe),Ne=function(e){function t(t){return e.call(this,t)||this}return Re(t,e),t.prototype.mouseDown=function(e){this.acs.imageAnnoApp.geometryCommon.gcmdSelecting.deSelectAllObjects(),this.acs.imageAnnoApp.renderer.selection.mouseDown(e)},t.prototype.mouseDrag=function(e){Se.isLasso=!1,this.acs.imageAnnoApp.renderer.selection.mouseDrag(e)},t.prototype.mouseUp=function(e){Se.isLasso=!1,this.acs.imageAnnoApp.renderer.selection.mouseUp(e),this.acs.goToACMode()},t.prototype.mouseMove=function(e){this.acs.imageAnnoApp.renderer.selection.mouseMove(e)},t}(Oe),Ee=function(e){function t(t){return e.call(this,t)||this}return Re(t,e),t.prototype.mouseDown=function(e){this.acs.imageAnnoApp.geometryCommon.gcmdSelecting.deSelectAllObjects(),this.acs.imageAnnoApp.renderer.selection.mouseDown(e)},t.prototype.mouseDrag=function(e){Se.isLasso=!0,this.acs.imageAnnoApp.renderer.selection.mouseDrag(e)},t.prototype.mouseUp=function(e){Se.isLasso=!0,this.acs.imageAnnoApp.renderer.selection.mouseUp(e),this.acs.goToACMode()},t.prototype.mouseMove=function(e){this.acs.imageAnnoApp.renderer.selection.mouseMove(e)},t}(Ne),_e=function(){function e(e){this.geo=e,this.host=e}return e.prototype.isMouseInside=function(e,t){if(this.host.isRemove||!this.host.isRenderable||this.host.isHiddenValue)return!1;if(this.checkCP(e,t))return!0;var n=e-this.host.vec.x,o=t-this.host.vec.y;return n*n/(this.host.widthHalf*this.host.widthHalf)+o*o/(this.host.heightHalf*this.host.heightHalf)<=1.1},e.prototype.getLog=function(){return"GUID : "+this.host.id+"/TYPE : "+this.host.type.toString()+"/Screen : /heightHalf : "+this.host.widthHalf.toFixed(3).toString()+" pixel/R2 : "+this.host.heightHalf.toFixed(3).toString()+" pixel/Area : "+this.host.getArea().toFixed(3).toString()+" m2/IsSEL : "+this.host.isSelectedValue+"/isSelable : "+this.host.isSelectable},e.prototype.checkCP=function(e,t){for(var n=new r.h9(e,t),o=0;o<this.host.vecsCP.length;++o)if((0,r.Sp)(n,this.host.vecsCP[o])<10)return this.host.vecSelectedCp=o,!0;return this.host.vecSelectedCp=-1,!1},e.prototype.hide=function(){},e}(),Te=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),De=function(e){function t(t){var n=e.call(this,t)||this;return n.host=t,n}return Te(t,e),t.prototype.renderPost=function(e){this.host.getCenterVec(),this.interpolateColor.update(),this.timer.update(),this.timer.updatePopupSummery(),this.renderPostGeometry(e)},t.prototype.renderPostGeometry=function(e){this.host.isHoverValue||this.host.isSelectedValue?(this.renderBoundbox(e),this.host.scene.annotationInstance.renderer.draw.shape.point.centerPoint(e,this.host.vec.x,this.host.vec.y),this.host.scene.annotationInstance.renderer.draw.shape.area.ellipseHover(e,this.host.styleComponent.renderStyle,this.host.vec.x,this.host.vec.y,this.host.widthHalf,this.host.heightHalf,this.host.isGrayColor,this.host.visibilityValue,this.host.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.host.renderer.tOver),this.host.isHoverValue,this.host.isSelectedValue),this.host.scene.annotationInstance.renderer.draw.shape.area.ellipse(e,this.host.styleComponent.renderStyle,this.host.vec.x,this.host.vec.y,this.host.widthHalf,this.host.heightHalf,this.host.isFill,this.host.isHoverValue,this.host.isSelectedValue),this.host.renderer.tOver+=this.host.scene.annotationInstance.renderer.dt,this.host.renderer.tDown1=0,this.host.isLeave=!0):(this.host.scene.annotationInstance.renderer.draw.shape.area.ellipse(e,this.host.styleComponent.renderStyle,this.host.vec.x,this.host.vec.y,this.host.widthHalf,this.host.heightHalf,this.host.isFill,this.host.isHoverValue,this.host.isSelectedValue),this.host.renderer.tOver=0),this.host.isUnderConstruction||this.host.isHoverValue,this.renderPostGeometryOffScreen(this.host.vec)},t.prototype.renderBoundbox=function(e){this.host.vecsCP[0].x=this.host.vec.x-this.host.widthHalf,this.host.vecsCP[0].y=this.host.vec.y-this.host.heightHalf,this.host.vecsCP[1].x=this.host.vec.x+this.host.widthHalf,this.host.vecsCP[1].y=this.host.vec.y-this.host.heightHalf,this.host.vecsCP[2].x=this.host.vec.x+this.host.widthHalf,this.host.vecsCP[2].y=this.host.vec.y+this.host.heightHalf,this.host.vecsCP[3].x=this.host.vec.x-this.host.widthHalf,this.host.vecsCP[3].y=this.host.vec.y+this.host.heightHalf,e.lineWidth=1.5,e.strokeStyle=this.host.styleComponent.renderStyle.colorStroke,e.beginPath(),e.moveTo(this.host.vecsCP[0].x,this.host.vecsCP[0].y);for(var t=1;t<this.host.vecsCP.length;++t)e.lineTo(this.host.vecsCP[t].x,this.host.vecsCP[t].y);for(e.closePath(),e.stroke(),e.fillStyle=this.host.styleComponent.renderStyleNode.colorFill,e.lineWidth=this.host.styleComponent.renderStyleNode.lineWidth,e.strokeStyle=this.host.styleComponent.renderStyleNode.colorStroke,t=0;t<this.host.vecsCP.length;++t)e.beginPath(),e.arc(this.host.vecsCP[t].x,this.host.vecsCP[t].y,5,0,2*Math.PI),e.closePath(),e.fill(),e.stroke()},t.prototype.renderPostGeometryOffScreen=function(e){this.host.scene.annotationInstance.renderer.offscreen.ellipseOffScreen(this.host.scene.annotationInstance.renderer.ctxOffscreen,this.host.styleComponent.renderStyle,this.host.hashColor,e.x,e.y,this.host.widthHalf,this.host.heightHalf,this.host.isFill)},t}(C),Me=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),ze=function(e){function t(t){var n=e.call(this,t)||this;return n.renderStyle=new x(n),n.renderStyleNode=new x(n),n.updateStyle(),n}return Me(t,e),t.prototype.updateStyle=function(){x.updateRenderStylePolygon(this.renderStyle,this.geo.scene.annotationInstance.customization.themeCurrent),x.updateRenderStylePolygonNode(this.renderStyleNode,this.geo.scene.annotationInstance.customization.themeCurrent);for(var e=0;e<this.geo.pts.length;++e)this.geo.pts[e].styleComponent.updateStyleForNode(this.renderStyleNode)},t.prototype.setDash=function(e){this.renderStyle.dash=e,this.geo.scene.annotationInstance.io.eventListenerAnnotation.addGeometryStack(this.geo.toJSON())},t.prototype.toJson=function(){if(this.renderStyle.dash.length>0)return{dash:this.renderStyle.dash}},t}(b),Ge=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),We=function(e){function t(t){var n=e.call(this,t)||this;return n.geo=t,n.host=t,n}return Ge(t,e),t.prototype.translateByMouseEventData=function(e){-1===this.host.vecSelected?this.host.isRemove||!this.host.isRenderable||this.host.isHiddenValue||(this.host.vec.x+=e.x-e.preX,this.host.vec.y+=e.y-e.preY,this.host.updateCP()):this.host.pts[this.host.vecSelected].translateByMouseEventData(e)},t}(Y),Be=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),He=function(e){function t(t,n,o,i,s,a,h,c){void 0===n&&(n=0),void 0===o&&(o=0),void 0===i&&(i=0),void 0===s&&(s=!1),void 0===a&&(a=5),void 0===h&&(h="white"),void 0===c&&(c="black");var p=e.call(this,t)||this;return p.vecs=[],p.vecsCP=[],p.vecSelected=-1,p.vecSelectedCp=-1,p.isUndo=s,p.vec=new r.h9(n,o,i),p.widthHalf=a,p.heightHalf=a,p.rOrigin=a,p.rTaget=a+10,p.pts=[],p.r=1,p.initComponent(),p.pts[0]=new k(p.scene,p.vec.x+.5*p.r,p.vec.y+.5*p.r,p.vec.z,p.isUndo),p.pts[2]=new k(p.scene,p.vec.x+.5*p.r,p.vec.y+.5*p.r,p.vec.z+.5*p.r,p.isUndo),p.pts[1]=new k(p.scene,p.vec.x,p.vec.y-.5*p.r,p.vec.z,p.isUndo),p.pts[3]=new k(p.scene,p.vec.x+.5*p.r,p.vec.y+.5*p.r,p.vec.z+.5*p.r,p.isUndo),p.pts[0].addEdge(p),p.pts[1].addEdge(p),p.pts[2].addEdge(p),p.pts[3].addEdge(p),p.pts[0].type=r.zq.ANODE_CIRCLE,p.pts[1].type=r.zq.ANODE_CIRCLE,p.pts[2].type=r.zq.ANODE_CIRCLE,p.pts[3].type=r.zq.ANODE_CIRCLE,p.vecsCP=[],p.vecsCP.push(new r.h9(p.pts[3].vec.x,p.pts[0].vec.y,0)),p.vecsCP.push(new r.h9(p.pts[1].vec.x,p.pts[0].vec.y,0)),p.vecsCP.push(new r.h9(p.pts[1].vec.x,p.pts[2].vec.y,0)),p.vecsCP.push(new r.h9(p.pts[3].vec.x,p.pts[2].vec.y,0)),p.initCircle(),p}return Be(t,e),t.fromJSON=function(e,n,o,i){void 0===o&&(o=!1),void 0===i&&(i=!1);var s=k.getNodeFromJSON(e,n.nodes[0],o),a=new t(e,s.vec.x,s.vec.y,0,o);s.remove();var h=k.getNodeFromJSON(e,n.nodes[1]),c=k.getNodeFromJSON(e,n.nodes[2]);return a.R0=h.vec.x-a.vec.x,a.R1=c.vec.y-a.vec.y,h.remove(),c.remove(),a.type=r.zq[n.type],a.IsSelectable=!0,a.isUnderConstruction=!1,a.isHiddenValue=n.isHidden,n.isHidden?a.visibilityValue=0:a.visibilityValue=1,n.styles&&n.styles.dash&&(a.styleComponent.renderStyle.dash=n.styles.dash),a.id=i?e.getUUID():n.id,a.initVecsHistory(),!o&&i?e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(a.toJSON()):a.isHover=!1,a},t.cancel=function(){void 0!==t.construction&&t.construction.remove(),t.construction=void 0},t.getLengthSelection=function(e){for(var t=e.listACircleWrapperr.length,n=0;t--;)e.listACircleWrapperr[t].isSelected&&(n+=1);return n},t.drawShadow=function(e){void 0!==t.construction&&(t.construction.R=t.construction.distance(e.x,e.y),t.construction.updateCP())},t.getCircleFromVoice=function(e){var t=new r.h9(.5*e.annotationInstance.geometryCommon.gcmdProcessing.width,.5*e.annotationInstance.geometryCommon.gcmdProcessing.height);this.getCircleByVecs(e,[t,new r.h9(t.x+100,t.y),new r.h9(t.x,t.y+100)])},t.getCircleByVecs=function(e,n){var o=(0,r.mI)(n),i=(0,r.lh)(n),s=new t(e,o.x,o.y,0,!1,2*i[0]);s.updateCP(),s.IsSelectable=!0,s.isUnderConstruction=!1,e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(s.toJSON())},t.getCircleByArea=function(e,n,o,i){var s=(0,r.yP)(n);s=e.annotationInstance.geometryCommon.gcmdProcessing.toMapConvertGeoDis(o,i,s);var a=new t(e,o,i,0,!1,s);a.updateCP(),a.IsSelectable=!0,a.isUnderConstruction=!1,e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(a.toJSON()),t.construction=a},t.getCircleByCircumference=function(e,n,o,i){var s=(0,r.sI)(n);s=e.annotationInstance.geometryCommon.gcmdProcessing.toMapConvertGeoDis(o,i,s);var a=new t(e,o,i,0,!1,s);a.updateCP(),a.IsSelectable=!0,a.isUnderConstruction=!1,e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(a.toJSON()),t.construction=a},t.getCircle=function(e,n){void 0!==t.construction?(t.construction.r=t.construction.distance(n.x,n.y),t.construction.IsSelectable=!0,t.construction.isUnderConstruction=!1,e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(t.construction.toJSON()),t.construction=void 0):(t.construction=new t(e,n.x,n.y),t.construction.IsSelectable=!1)},t.mouseDown=function(e,t){},t.onMouseMiddleClick=function(e){},t.onMouseRightClick=function(e){},t.onMouseLeftClick=function(e,t){this.getCirlceByTouch(e,t)},t.onMouseMove=function(e){},t.onMouseDrag=function(e,n){void 0!==t.construction?t.drawShadow(n):t.getCircle(e,n)},t.onMouseUp=function(e,n){t.construction&&(t.construction.IsSelectable=!0,t.construction.isUnderConstruction=!1,t.construction.isSelected=!1,t.construction=void 0,t.isDone=!0,e.annotationInstance.activeCommandController.goToACMode())},t.getCirlceByTouch=function(e,n){var o=new t(e,n.x,n.y,0,!1,64);o.updateCP(),o.IsSelectable=!0,o.isUnderConstruction=!1,o.isSelected=!1,e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(o.toJSON()),e.annotationInstance.activeCommandController.goToACMode()},t.prototype.initComponent=function(){this.styleComponent=new ze(this),this.renderer=new De(this),this.interaction=new _e(this),this.transformation=new We(this)},t.prototype.Init=function(){},t.prototype.initCircle=function(){this.dimension=new H(this),this.type=r.zq.CIRCLE,this.isRemove=!1,this.isHoverValue=!1,this.isFill=!0,this.isSelectable=!0,this.isRenderable=!0,this.isDraggable=!1,this.isSelectedValue=!1,this.isAniEasing=!1,this.isUnderConstruction=!0},t.prototype.getArea=function(){return Math.PI*this.heightHalf*this.widthHalf},t.prototype.getLog=function(){return this.interaction.getLog()},t.prototype.getLogDOM=function(){return"Geometry ID : "+this.id+"<br>geometry Type : ACircle<br>position : <br>size : "+this.r+" pixel<br>"},t.prototype.getParentType=function(){return""},t.prototype.getType=function(){return"ACircle"},t.prototype.getVecs=function(){for(var e=[],t=0;t<this.pts.length;++t)e.push(this.pts[t].vec);return this.vecs=e,e},Object.defineProperty(t.prototype,"visibility",{set:function(e){this.visibilityValue=e;for(var t=0;t<this.pts.length;++t)this.pts[t].visibilityValue=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"IsHiddenChildren",{set:function(e){this.isHiddenPre=this.isHiddenValue,this.isHiddenValue=e;for(var t=0;t<this.pts.length;++t)this.pts[t].isHiddenValue=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isHidden",{set:function(e){this.isHiddenPre=this.isHiddenValue,this.isHiddenValue=e,this.IsHiddenChildren=e,this.scene.annotationInstance.io.eventListenerAnnotation.hideStack(this.toJSON())},enumerable:!1,configurable:!0}),t.prototype.updateCP=function(e,t){void 0===e&&(e=this.widthHalf),void 0===t&&(t=this.heightHalf),this.widthHalf=e,this.heightHalf=t,this.pts[0].vec.x=this.vec.x+this.widthHalf,this.pts[0].vec.y=this.vec.y,this.pts[2].vec.x=this.vec.x-this.widthHalf,this.pts[2].vec.y=this.vec.y,this.pts[1].vec.x=this.vec.x,this.pts[1].vec.y=this.vec.y-this.heightHalf,this.pts[3].vec.x=this.vec.x,this.pts[3].vec.y=this.vec.y+this.heightHalf},t.prototype.getCenterVec=function(){return this.vec=new r.h9(0,0,0),this.vec=(0,r.PD)(this.vec,this.pts[0].vec),this.vec=(0,r.PD)(this.vec,this.pts[1].vec),this.vec=(0,r.PD)(this.vec,this.pts[2].vec),this.vec=(0,r.PD)(this.vec,this.pts[3].vec),this.vec.divByVal(4),this.widthHalf=Math.abs(this.pts[0].vec.x-this.vec.x),this.heightHalf=Math.abs(this.pts[1].vec.y-this.vec.y),this.vec},t.prototype.goToBlackhole=function(){this.isSelectable=!1,this.needBlackhole=!0,this.pts.forEach((function(e){e.goToBlackhole()}))},t.prototype.getNodePopup=function(){return this.pts[0]},Object.defineProperty(t.prototype,"R",{set:function(e){this.widthHalf=e,this.heightHalf=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"R0",{set:function(e){this.widthHalf=e,this.pts[0].vec.x=this.vec.x+this.widthHalf,this.pts[0].vec.y=this.vec.y,this.pts[2].vec.x=this.vec.x-this.widthHalf,this.pts[2].vec.y=this.vec.y},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"R1",{set:function(e){this.heightHalf=e,this.pts[1].vec.x=this.vec.x,this.pts[1].vec.y=this.vec.y-this.heightHalf,this.pts[3].vec.x=this.vec.x,this.pts[3].vec.y=this.vec.y+this.heightHalf},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"IsSelectable",{set:function(e){this.isSelectable=e,this.pts[0].isSelectable=e,this.pts[1].isSelectable=e,this.pts[2].isSelectable=e,this.pts[3].isSelectable=e},enumerable:!1,configurable:!0}),t.prototype.isMouseInside=function(e,t){return this.interaction.isMouseInside(e,t)},t.prototype.distance=function(e,t){return Math.sqrt((this.vec.x-e)*(this.vec.x-e)+(this.vec.y-t)*(this.vec.y-t))},t.prototype.geoToScreen=function(){},t.prototype.activateEasing=function(e,t){this.tVec=new r.h9(e.x,e.y,0),this.isAniEasing=!0,this.updateCP()},t.prototype.easing=function(){this.isAniEasing&&(this.vec=(0,r.PD)((0,r.bA)(this.vec,.95),(0,r.bA)(this.tVec,.05)),(0,r.Sp)(this.vec,this.tVec)<1&&(this.isAniEasing=!1)),this.updateCP()},t.prototype.remove=function(e){if(void 0===e&&(e=!0),this.isRemove=!1,this.isRenderable=!1,this.pts[0].remove(),this.pts[1].remove(),this.pts[2].remove(),this.pts[3].remove(),e){var t=this.toJSON();t&&this.scene.annotationInstance.io.eventListenerAnnotation.removeGeometryStack([t])}this.scene.removeGeometry(this)},t.prototype.hide=function(){},t.prototype.move=function(e,t){this.isRemove||!this.isRenderable||this.isHiddenValue||(this.vec.x=e,this.vec.y=t,this.updateCP())},t.prototype.translateByMouseEventData=function(e){return this.transformation.translateByMouseEventData(e)},t.prototype.translate=function(e,t){},Object.defineProperty(t.prototype,"isSelected",{get:function(){return this.isSelectedValue},set:function(e){this.isSelectedValue=e,this.pts[0].isRenderable=e,this.pts[1].isRenderable=e,this.pts[2].isRenderable=e,this.pts[3].isRenderable=e,this.scene.annotationInstance.io.eventListenerAnnotation.selectionStack(this.toJSON())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isHover",{get:function(){return this.isHoverValue},set:function(e){this.isRemove||!this.isRenderable||this.isHiddenValue||this.isUnderConstruction||(this.isHoverValue=e,(this.isHoverValue&&!this.isHoverPre||!this.isHoverValue&&this.isHoverPre)&&this.scene.annotationInstance.io.eventListenerAnnotation.hoverStack(this.toJSON()),this.isHoverPre=this.isHoverValue,this.isSelectedValue||(this.pts[0].isRenderable=e,this.pts[1].isRenderable=e,this.pts[2].isRenderable=e,this.pts[3].isRenderable=e),e||(this.needEmitHoverPost=!0,this.hidePopUpSummary()))},enumerable:!1,configurable:!0}),t.prototype.getNode=function(){var e=[];return e.push(this.vec),e.push(this.pts[0].vec),e.push(this.pts[1].vec),e.push(this.pts[2].vec),e.push(this.pts[3].vec),e},t.prototype.toJSON=function(){var e=new p(this.id,this.type,this.isSelectedValue,this.isHoverValue,this.isHiddenValue);e.pushNode(this.getNode());var t=this.styleComponent.toJson();return t&&(e.styles=t),e},t.prototype.deepCopy=function(e,n,o){void 0===o&&(o=0);var i=this.toJSON();if(i){var s=t.fromJSON(this.scene,i,!0,!0);return s.move(e,n),s.emitAddStack(),s}},t.prototype.mouseRightClick=function(){this.isFill=!this.isFill},t.prototype.renderPost=function(e){this.renderer.renderPost(e)},t.isDone=!1,t.construction=void 0,t}(y),Fe=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Ue=function(e){function t(t){return e.call(this,t)||this}return Fe(t,e),t.prototype.updateStyle=function(){if(x.updateRenderStylePolygon(this.renderStyle,this.geo.scene.annotationInstance.customization.themeCurrent),x.updateRenderStylePolygonNode(this.renderStyleNode,this.geo.scene.annotationInstance.customization.themeCurrent),this.geo.pts)for(var e=0;e<this.geo.pts.length;++e)this.geo.pts[e].styleComponent.updateStyleForNode(this.renderStyleNode)},t}(b),je=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),qe=function(e){function t(n,o,i,s,a,h){void 0===s&&(s=0),void 0===a&&(a=r.zq.CN_GON),void 0===h&&(h=t.nNumber);var c=e.call(this,n)||this;return c.pts=[],c.vec=new r.h9(o,i),c.type=a,c.n=h,c.initComponent(),c.init(),c}return je(t,e),t.findAtPoint=function(e){for(var n=t.list.length-1;n>=0;--n)if(t.list[n].isSelectable&&t.list[n].isMouseInside(e.x,e.y))return t.list[n]},t.computeOver=function(e){var n=t.findAtPoint(e);void 0!==n&&(n.isHoverValue=!0)},t.fromJSON=function(e,n,o,i,s){void 0===o&&(o=!1),void 0===i&&(i=!1),void 0===s&&(s=!1);var a=k.getNodeFromJSON(e,n.nodes[0]),h=new t(e,a.vec.x,a.vec.y);h.type=r.zq[n.type],a.remove();for(var c=1;c<h.pts.length;++c){var p=k.getNodeFromJSON(e,n.nodes[c]);h.pts[c].vec.x=p.vec.x,h.pts[c].vec.y=p.vec.y,h.pts[c].type=r.zq.CNODE}h.id=n.id,h.IsSelectable=!0,h.isUnderConstruction=!1,e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(h.toJSON()),t.construction=void 0},t.getLine=function(e,n,o){void 0!==t.construction?t.construction.type===r.zq.CN_GON?(t.construction.IsSelectable=!0,t.construction.isUnderConstruction=!1,B.aPolygonFromNGon(e,t.construction),t.construction.remove(),e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(t.construction.toJSON()),t.construction=void 0):t.construction.type===r.zq.CN_STAR&&(t.construction.numClick++,2===t.construction.numClick&&(t.construction.IsSelectable=!0,t.construction.isUnderConstruction=!1,e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(t.construction.toJSON()),B.aPolygonFromNGon(e,t.construction),t.construction.remove(),t.construction=void 0)):(t.construction=new t(e,n.x,n.y,0,o),t.construction.shiftNGon(),t.construction.isUnderConstruction=!0,t.construction.IsSelectable=!1)},t.getLineByPt=function(e){},t.cancel=function(){void 0!==t.construction&&(t.construction.IsSelectable=!0,t.construction.isUnderConstruction=!1,t.construction.remove(),t.construction=void 0)},t.drawShadow=function(e){void 0!==t.construction&&t.construction.updateGeo(e.x,e.y)},t.add=function(e){t.list.push(e)},t.remove=function(e,n){var o=n.toJSON();o&&(e.annotationInstance.io.eventListenerAnnotation.removeGeometryStack([o]),t.list.splice(t.list.indexOf(n),1))},t.mouseDown=function(e,n,o){void 0!==t.construction&&(o===r.zq.CN_GON?(t.getLine(e,n,o),t.construction=void 0,t.isDone=!0,e.annotationInstance.activeCommandController.goToACMode()):o===r.zq.CN_STAR&&(t.getLine(e,n,o),t.numClick++>0&&(t.construction=void 0,t.isDone=!0,t.numClick=0,e.annotationInstance.activeCommandController.goToACMode())))},t.mouseLeftClick=function(e,n,o){t.isDone?t.isDone=!1:void 0===e.annotationInstance.scene.capture&&void 0===t.construction&&t.getLine(e,n,o)},t.mouseMove=function(e){void 0!==t.construction&&t.drawShadow(e)},t.prototype.initComponent=function(){this.styleComponent=new Ue(this)},t.prototype.init=function(){this.r1=10,this.lineWidth=8,this.numClick=0,this.vecs=[],t.add(this)},t.prototype.updateVecs=function(){this.vecs=[];for(var e=0;e<this.pts.length;++e)this.vecs.push(this.pts[e].vec);return this.vecs},t.prototype.getLog=function(){var e=0;return this.type===r.zq.CN_GON?e=this.n:this.type===r.zq.CN_STAR&&(e=Math.trunc(.5*this.n)),"GUID : "+this.id+"/TYPE : "+this.type.toString()+"/N num : "+e+"/Screen : /IsSEL : "+this.isSelectedValue+"/isSelable : "+this.isSelectable},t.prototype.translate=function(e,t){},t.prototype.translateByMouseEventData=function(e){for(var t=e.x-e.preX,n=e.y-e.preY,o=0;o<this.pts.length;++o)this.pts[o].vec.x+=t,this.pts[o].vec.y+=n},t.prototype.remove=function(){for(var e=0;e<this.pts.length;++e)this.pts[e].remove();this.isSelectable=!1,this.isRenderable=!1,t.remove(this.scene,this)},t.prototype.hide=function(){},Object.defineProperty(t.prototype,"Scale",{set:function(e){this.updateNGonByScale(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"v",{get:function(){return this.vec},set:function(e){this.vec=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"R",{get:function(){return this.r},set:function(e){this.r=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"IsSelectable",{get:function(){return this.isSelectable},set:function(e){this.isSelectable=e;for(var t=0;t<this.pts.length;++t)this.pts[t].isSelectable=e},enumerable:!1,configurable:!0}),t.prototype.isMouseInside=function(e,t){return!0!==this.isUnderConstruction&&void 0!==this.isUnderConstruction&&(this.checkDistance(e,t)?(this.isHover=!0,!0):(this.isHover=!1,!1))},t.prototype.checkDistance=function(e,t){if((0,r.X0)(new r.h9(e,t),this.getVecs()))return!0;for(var n=0;n<this.pts.length-1;++n)if((0,r.xs)(new r.h9(e,t),this.pts[n].vec,this.pts[n+1].vec)<this.lineWidth)return!0;return!1},t.prototype.getVecs=function(){for(var e=[],t=0;t<this.pts.length;++t)e.push(this.pts[t].vec);return e},t.prototype.computeCenterVec=function(){for(var e=[],t=0;t<this.pts.length;++t)e.push(this.pts[t].vec);this.vec=(0,r.mI)(e)},t.prototype.distance=function(e,t){return Math.sqrt((this.vec.x-e)*(this.vec.x-e)+(this.vec.y-t)*(this.vec.y-t))},t.prototype.updateNGonByScale=function(e){this.updateNGon(this.vec.x+e,this.vec.y)},t.prototype.updateNGon=function(e,t){this.r1=this.distance(e,t);var n=new r.h9(this.vec.x-e,this.vec.y-t).normalize(),o=(0,r.p$)(this.vec).normalize(),i=(0,r.Cj)(o,n)*(Math.PI/180);(0,r.lu)(n,o).x<0&&(i*=-1);for(var s=2*Math.PI/this.n,a=this.n;a--;){var h=this.vec.x+this.r1*Math.cos(i),c=this.vec.y+this.r1*Math.sin(i);i+=s,this.pts[a].vec.x=h,this.pts[a].vec.y=c}},t.prototype.updateNStar=function(e,t){0===this.numClick?this.r1=this.distance(e,t):1===this.numClick&&(this.r2=this.distance(e,t));var n=new r.h9(this.vec.x-e,this.vec.y-t).normalize(),o=(0,r.p$)(this.vec).normalize(),i=(0,r.Cj)(o,n)*(Math.PI/180);(0,r.lu)(n,o).x<0&&(i*=-1);for(var s=2*Math.PI/this.n,a=this.n;a--;)if(0===this.numClick){var h=void 0,c=void 0;a%2==0?(h=this.vec.x+this.r1*Math.cos(i),c=this.vec.y+this.r1*Math.sin(i)):(h=this.vec.x+(this.r1-5)*Math.cos(i),c=this.vec.y+(this.r1-5)*Math.sin(i)),i+=s,this.pts[a].vec.x=h,this.pts[a].vec.y=c}else h=void 0,c=void 0,a%2==0?(h=this.vec.x+this.r1*Math.cos(i),c=this.vec.y+this.r1*Math.sin(i)):(h=this.vec.x+this.r2*Math.cos(i),c=this.vec.y+this.r2*Math.sin(i)),i+=s,this.pts[a].vec.x=h,this.pts[a].vec.y=c},t.prototype.updateGeo=function(e,t){this.type===r.zq.CN_GON?this.updateNGon(e,t):this.type===r.zq.CN_STAR&&this.updateNStar(e,t)},t.prototype.computeNGon=function(e){if(void 0===e&&(e=this.n),this.pts.length>0){for(var t=this.pts.length;t--;)this.pts[t].remove();this.pts=[]}this.type===r.zq.CN_STAR&&(this.n=2*e);for(var n=0,o=2*Math.PI/this.n,i=this.n;i--;){var s=this.vec.x+this.r1*Math.cos(n),a=this.vec.y+this.r1*Math.sin(n);n+=o;var h=new k(this.scene,s,a);h.addEdge(this),h.type=r.zq.CNODE,h.isSelectable=!1,this.pts.push(h)}},t.prototype.shiftNGon=function(){this.isUnderConstruction||this.computeCenterVec(),this.computeNGon()},Object.defineProperty(t.prototype,"isSelected",{get:function(){return this.isSelectedValue},set:function(e){this.isSelectedValue=e,this.scene.annotationInstance.io.eventListenerAnnotation.selectionStack(this.toJSON())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isHover",{get:function(){return this.isHoverValue},set:function(e){if(!this.isUnderConstruction&&(this.isHoverValue=e,!this.isUnderConstruction)){for(var t=0,n=this.pts;t<n.length;t++)n[t].isRenderable=e;(this.isHoverValue&&!this.isHoverPre||!this.isHoverValue&&this.isHoverPre)&&this.scene.annotationInstance.io.eventListenerAnnotation.hoverStack(this.toJSON()),this.isHoverPre=this.isHoverValue}},enumerable:!1,configurable:!0}),t.prototype.getNode=function(){for(var e=[],t=0;t<this.pts.length;++t)e.push(this.pts[t].vec);return e},t.prototype.toJSON=function(){var e=new p(this.id,this.type,this.isSelectedValue,this.isHoverValue,this.isHiddenValue);return e.pushNode(this.getNode()),e},t.prototype.renderPost=function(e){if(!(this.pts.length<3)){for(var t=[],n=0;n<this.pts.length;++n)t.push(new r.h9(this.pts[n].vec.x-this.scene.annotationInstance.scene.paramsEditing.croppingMaskParams.x,this.pts[n].vec.y-this.scene.annotationInstance.scene.paramsEditing.croppingMaskParams.y));this.type===r.zq.CN_GON?this.scene.annotationInstance.renderer.draw.shape.ngon.nGon(e,t,this.isHoverValue,this.isSelectedValue):this.type===r.zq.CN_STAR&&this.scene.annotationInstance.renderer.draw.shape.ngon.nStar(e,this.pts,this.isHoverValue,this.isSelectedValue)}},t.list=[],t.isDone=!1,t.numClick=0,t.split=!1,t.nNumber=5,t}(y),Je=function(){function e(e){this.selVec=void 0,this.selMidVec=void 0,this.selectedVec=void 0,this.selVecForTextLeaderline=void 0,this.vs=[],this.mouseV=new r.h9(0,0,0),this.mouseR=10,this.index=-1,this.host=e,this.index=-1}return e.prototype.initByVec=function(e){this.vs=e},e.prototype.getVecs=function(){return this.vs},e.prototype.removeSelVec=function(){this.selVec=void 0,this.selMidVec=void 0,this.selectedVec=void 0,this.vs.length<4?this.host.remove():this.vs.splice(this.vs.indexOf(this.vs[this.index]),1)},e.prototype.getCenVec=function(){return this.cVec=(0,r.mI)(this.vs),this.cVec},e.prototype.getclosestVec=function(e,t){for(var n=-1,o=Number.MAX_SAFE_INTEGER,i=0;i<this.vs.length;++i){var s=(0,r.Sp)(e,this.vs[i]);s<t&&s<o&&(o=s,n=i)}if(n>-1)return this.selVec=this.vs[n],this.selVecForTextLeaderline=this.vs[n],this.vs[n];this.selVec=void 0,this.selVecForTextLeaderline=void 0},e.prototype.isMouseInside=function(e,t){this.mouseV.x=e,this.mouseV.y=t;for(var n=0;n<this.vs.length-1;++n){if((0,r.Sp)(this.mouseV,this.vs[n])<this.mouseR*this.host.scaleForRender*this.host.scene.annotationInstance.activeCommandController.scaleGlobal)return this.selVec=this.vs[n],this.selMidVec=void 0,this.index=n,n;var o=this.vs[n].x+.5*(this.vs[n+1].x-this.vs[n].x),i=this.vs[n].y+.5*(this.vs[n+1].y-this.vs[n].y);if(this.selMidVec=new r.h9(o,i,0),(0,r.Sp)(this.mouseV,this.selMidVec)<this.mouseR*this.host.scaleForRender*this.host.scene.annotationInstance.activeCommandController.scaleGlobal)return this.selVec=void 0,this.index=n,n;this.selMidVec=void 0}if((0,r.Sp)(this.mouseV,this.vs[this.vs.length-1])<this.mouseR*this.host.scaleForRender*this.host.scene.annotationInstance.activeCommandController.scaleGlobal)return this.selVec=this.vs[this.vs.length-1],this.selMidVec=void 0,this.index=this.vs.length-1,this.vs.length-1;var s=this.vs[this.vs.length-1].x+.5*(this.vs[0].x-this.vs[this.vs.length-1].x),a=this.vs[this.vs.length-1].y+.5*(this.vs[0].y-this.vs[this.vs.length-1].y);return this.selMidVec=new r.h9(s,a,0),(0,r.Sp)(this.mouseV,this.selMidVec)<this.mouseR*this.host.scaleForRender*this.host.scene.annotationInstance.activeCommandController.scaleGlobal?(this.selVec=void 0,this.index=this.vs.length-1,this.vs.length-1):(this.selVec=void 0,this.selMidVec=void 0,this.index=-1,-1)},e.prototype.insertMidVec=function(){this.selMidVec&&(this.vs.splice(this.index+1,0,this.selMidVec),this.selVec=this.selMidVec,this.selMidVec=void 0)},e.prototype.splitNodeVec=function(){var e=this.vs[this.index],t=this.vs[this.index+1],n=this.vs[this.index-1];this.index>0&&this.index<this.vs.length-1?(t=this.vs[this.index+1],n=this.vs[this.index-1]):this.index===this.vs.length-1?(t=this.vs[0],n=this.vs[this.index-1]):0===this.index&&(n=this.vs[this.vs.length-1]);var o=(0,r.zQ)(e,t);this.vs.splice(this.index+1,0,o),o=(0,r.zQ)(e,n),this.vs.splice(this.index,0,o)},e}(),Ye=function(){function e(e){this.xOff=5,this.yOff=5,this.geo=e}return e.prototype.isMouseInside=function(e,t){return-1!==this.geo.graphCore.isMouseInside(e,t)||!!this.geo.scene.annotationInstance.geometryCommon.gcmdProcessing.isMouseInsideByOffScreen(e-this.geo.scene.paramsEditing.croppingMaskParams.x,t-this.geo.scene.paramsEditing.croppingMaskParams.y,this.geo.hashColor)},e.prototype.GetLog=function(){return this.geo.isRemove||!this.geo.isRenderable||this.geo.isHiddenValue?"":"GUID : "+this.geo.id+"/TYPE : "+this.geo.type.toString()+"/Screen : /pos : "+this.geo.graphCore.vs.length+"/Area : "+this.geo.getArea().toFixed(3).toString()+" m2/IsSEL : "+this.geo.isSelectedValue+"/isSelable : "+this.geo.isSelectable},e.prototype.hide=function(){},e.prototype.showPopupSummary=function(){var e=this;this.geo.scene.annotationInstance.activeCommandController.needPopup()&&(this.geo.hasPopup||this.geo.isGhost||(this.geo.hasPopup=!0,this.geo.popup=document.createElement("div"),this.geo.popup.id="pa-"+this.geo.id,this.geo.popup.style.position="absolute",this.geo.popup.style.zIndex="1000",this.geo.popup.style.height="0px",this.geo.popup.style.width="0px",this.geo.popup.style.backgroundColor="red",this.geo.scene.annotationInstance.implementations.app.model.modelViewWrapper.div.appendChild(this.geo.popup),this.geo.popup.style.top=this.geo.vec.y+"px",this.geo.popup.style.left=this.geo.vec.x+"px",this.showPopupStackTimer&&clearTimeout(this.showPopupStackTimer),this.showPopupStackTimer=setTimeout((function(){e.geo.popup&&e.geo.scene.annotationInstance.io.eventListenerAnnotation.showPopupStack(e.geo.toJSON())}),this.geo.timePopupDelay)))},e.prototype.needSnapping=function(e){for(var t=15,n=t,o=new r.h9(-100,-100),i=0;i<this.geo.graphCore.vs.length-1;++i)(n=(0,r.Sp)(this.geo.graphCore.vs[i],e))<t&&(t=n,o=this.geo.graphCore.vs[i]),(n=(0,r.iV)(e.x,e.y,this.geo.graphCore.vs[i+1].x-this.geo.graphCore.vs[i].x,this.geo.graphCore.vs[i+1].y-this.geo.graphCore.vs[i].y))<t&&(t=n,o.x=this.geo.graphCore.vs[i+1].x-this.geo.graphCore.vs[i].x,o.y=this.geo.graphCore.vs[i+1].y-this.geo.graphCore.vs[i].y);return(n=(0,r.Sp)(this.geo.graphCore.vs[this.geo.graphCore.vs.length-1],e))<t&&(t=n,o=this.geo.graphCore.vs[this.geo.graphCore.vs.length-1]),(n=(0,r.iV)(e.x,e.y,this.geo.graphCore.vs[this.geo.graphCore.vs.length-1].x-this.geo.graphCore.vs[0].x,this.geo.graphCore.vs[this.geo.graphCore.vs.length-1].y-this.geo.graphCore.vs[0].y))<t&&(t=n,o.x=this.geo.graphCore.vs[this.geo.graphCore.vs.length-1].x-this.geo.graphCore.vs[0].x,o.y=this.geo.graphCore.vs[this.geo.graphCore.vs.length-1].y-this.geo.graphCore.vs[0].y),[t,o]},e}(),Xe=function(){function e(e){this.geo=e}return e.prototype.ToJSON=function(){var e=new p(this.geo.id,r.zq.POLYGON_GRAPH,this.geo.isSelectedValue,this.geo.isHoverValue,this.geo.isHiddenValue);e.pushNode(this.getNode());var t=this.geo.styleComponent.toJson();return t&&(e.styles=t),e},e.prototype.getNode=function(){for(var e=[],t=0;t<this.geo.graphCore.vs.length;++t)e.push(this.geo.graphCore.vs[t]);return e},e.prototype.remove=function(e){if(void 0===e&&(e=!0),e){var t=this.ToJSON();t&&this.geo.scene.annotationInstance.io.eventListenerAnnotation.removeGeometryStack([t])}this.geo.deepRemove()},e}(),Ke=function(){function e(e){this.geo=e}return e.prototype.mouseLeftClick=function(){this.geo.graphCore.selVec?this.geo.graphCore.selectedVec=this.geo.graphCore.selVec:(this.geo.graphCore.selectedVec=void 0,this.geo.scene.annotationInstance.geometryCommon.gcmdProcessing.removeAllPopup(),this.geo.showPopupSummary())},e.prototype.mouseRightClick=function(){},e.prototype.mouseMiddleClick=function(e){},e.prototype.mouseMoveClick=function(e){},e}(),$e=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Qe=function(e){function t(t){var n=e.call(this,t)||this;return n.geo=t,n}return $e(t,e),t.prototype.renderPost=function(e){this.interpolateColor.update(),this.timer.update(),this.geo.inspector.update(e),this.geo.updateCenVec();for(var t=[],n=0;n<this.geo.graphCore.vs.length;++n)t.push(new r.h9(this.geo.graphCore.vs[n].x-this.geo.scene.paramsEditing.croppingMaskParams.x,this.geo.graphCore.vs[n].y-this.geo.scene.paramsEditing.croppingMaskParams.y));this.renderPolygon(e,t)},t.prototype.renderPostNodes=function(e){this.geo.scene.annotationInstance.interactionMode===r.An.Drawing&&((this.geo.isHoverValue||this.geo.isSelectedValue)&&this.renderNodes(e,this.geo.graphCore.vs,this.geo.scaleForRender*this.geo.scene.annotationInstance.graphicsCoreWrapper.scaleScreenByRatioImageSize),this.renderSelectedVec(e))},t.prototype.renderPolygon=function(e,t){this.offscreenRenderPolygon(t),this.geo.isHoverValue||this.geo.isSelectedValue?(this.geo.scene.annotationInstance.renderer.draw.shape.area.polygonHover(e,this.geo.styleComponent.renderStyle,t,this.geo.isGrayColor,this.geo.visibilityValue,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tOver),this.geo.isHoverValue,this.geo.isSelectedValue),this.tOver+=.01,this.tDown1=0,this.geo.isLeave=!0,this.geo.scene.annotationInstance.renderer.draw.shape.area.polygon(e,this.geo.styleComponent.renderStyle,t,this.geo.isUnderConstruction,this.geo.isGrayColor,this.geo.visibilityValue,this.geo.isFill,this.geo.isHover,this.geo.isSelectedValue)):(this.tOver=0,this.geo.scene.annotationInstance.renderer.draw.shape.area.polygon(e,this.geo.styleComponent.renderStyle,t,this.geo.isUnderConstruction,this.geo.isGrayColor,this.geo.visibilityValue,this.geo.isFill,this.geo.isHover,this.geo.isSelectedValue))},t.prototype.renderSelectedVec=function(e){this.geo.graphCore.selectedVec&&this.geo.scene.annotationInstance.renderer.draw.shape.node.nodeSelected(e,this.geo.styleComponent.renderStyleNodeSelected,this.geo.graphCore.selectedVec.x-this.geo.scene.paramsEditing.croppingMaskParams.x,this.geo.graphCore.selectedVec.y-this.geo.scene.paramsEditing.croppingMaskParams.y,this.geo.scene.annotationInstance.graphicsCoreWrapper.scaleScreenByRatioImageSize)},t.prototype.renderNodes=function(e,t,n){for(var o=this.geo.scene.paramsEditing.croppingMaskParams.x,i=this.geo.scene.paramsEditing.croppingMaskParams.y,s=0;s<t.length-1;++s)this.geo.scene.annotationInstance.renderer.draw.shape.node.nodeMidHover(e,this.geo.styleComponent.renderStyleNode,t[s].x+.5*(t[s+1].x-t[s].x)-o,t[s].y+.5*(t[s+1].y-t[s].y)-i,n,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tOver),!1),this.geo.scene.annotationInstance.renderer.draw.shape.node.nodeStart(e,this.geo.styleComponent.renderStyleNode,t[s].x-o,t[s].y-i,n,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tOver));this.geo.scene.annotationInstance.renderer.draw.shape.node.nodeMidHover(e,this.geo.styleComponent.renderStyleNode,t[t.length-1].x+.5*(t[0].x-t[t.length-1].x)-o,t[t.length-1].y+.5*(t[0].y-t[t.length-1].y)-i,n,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tOver),!1),this.geo.scene.annotationInstance.renderer.draw.shape.node.nodeStart(e,this.geo.styleComponent.renderStyleNode,t[t.length-1].x-o,t[t.length-1].y-i,n,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tOver))},t.prototype.offscreenRenderPolygon=function(e){this.geo.scene.annotationInstance.renderer.offscreen.polygonOffScreen(this.geo.scene.annotationInstance.renderer.ctxOffscreen,this.geo.hashColor,e)},t}(C),Ze=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),et=function(e){function t(t){var n=e.call(this,t)||this;return n.renderStyleNodeSelected=new x,n.updateStyle(),n.updateColor(),n}return Ze(t,e),t.prototype.updateStyle=function(){this.isCustom||(this.state.themeColorId=s.AccentColor1,this.isCustom=!0,x.updateRenderStylePolygon(this.renderStyle,this.geo.scene.annotationInstance.customization.themeCurrent),x.updateRenderStylePolygonNode(this.renderStyleNode,this.geo.scene.annotationInstance.customization.themeCurrent),x.shiftNodeStyle(this.renderStyleNode,this.renderStyleNodeSelected))},t.prototype.updateColor=function(e){void 0===e&&(e=void 0),this.isCustom=!0,void 0===e&&(e=this.geo.scene.annotationInstance.activeCommandController.activeColorController.activeColor),x.updateRenderColorPolygon(this.renderStyle,this.geo.scene.annotationInstance.customization.themeCurrent,e,e),x.updateRenderColorPolygonNode(this.renderStyleNode,this.geo.scene.annotationInstance.customization.themeCurrent,e),x.shiftNodeStyle(this.renderStyleNode,this.renderStyleNodeSelected),this.tempColorRgba=e},t.prototype.updateStyleCustom=function(e){return e.width&&(this.state.width=e.width),void 0!==e.color&&(this.state.themeColorId=e.color),e.colorRgba.length>0&&e.fill.length>0&&(this.tempColorRgba=e.colorRgba,this.tempFillRgba=e.fill,x.updateRenderStylePolygonCustom(this.renderStyle,this.geo.scene.annotationInstance.customization.themeCurrent,e.colorRgba,e.fill),x.updateRenderStylePolygonNodeCustom(this.renderStyleNode,this.geo.scene.annotationInstance.customization.themeCurrent,e.colorRgba,e.fill),x.shiftNodeStyleCustom(this.renderStyleNode,this.renderStyleNodeSelected),this.updateColor(e.colorRgba)),e.scale&&(this.renderStyle.scaleLocal=e.scale,this.state.scale=e.scale),this.isCustom=!0,!0},t.prototype.setDash=function(e){this.renderStyle.dash=e,this.geo.scene.annotationInstance.io.eventListenerAnnotation.addGeometryStack(this.geo.toJSON())},t.prototype.toJson=function(){if(this.isCustom){var e={width:this.state.width,scale:this.renderStyle.scaleLocal,colorRgba:this.tempColorRgba,fill:this.tempFillRgba};return this.state.themeColorId!==s.AccentColor1&&(e.color=this.state.themeColorId),e}},t.prototype.isSameStyle=function(e){if(e.colorRgba.length===this.tempColorRgba.length||e.fill.length===this.tempFillRgba){for(var t=0;t<e.colorRgba.length;t++)if(e.colorRgba[t]!==this.tempColorRgba[t])return!1;for(t=0;t<e.fill.length;t++)if(e.fill[t]!==this.tempFillRgba[t])return!1}return!0},t}(b),tt=function(){function e(e){this._needCtrlKey=!0,this.geo=e}return e.prototype.polygonGraphResetForSplit=function(){this._needCtrlKey=!0},e.prototype.translateByMouseEventData=function(e){if(!this.geo.isRemove&&this.geo.isRenderable&&!this.geo.isHiddenValue){var t=e.x-e.preX,n=e.y-e.preY;if(this.geo.graphCore.selVec){if(this.geo.scene.annotationInstance.activeCommandController.acProperties.pressCtrlKey&&this._needCtrlKey&&(this.geo.graphCore.splitNodeVec(),this._needCtrlKey=!1),this.geo.graphCore.selVec.x+=t,this.geo.graphCore.selVec.y+=n,this.geo.skipTranslationForLeaderline)return;return this.geo.textLeaderline&&(this.geo.textLeaderline.translateByMouseEventData(e),this.geo.textLeaderline&&this.geo.textLeaderline.leaderline&&(this.geo.textLeaderline.leaderline.v2.x+=t,this.geo.textLeaderline.leaderline.v2.y+=n)),void(this.geo.isSelectedNode=!0)}if(this.geo.graphCore.selMidVec)return this.geo.graphCore.insertMidVec(),void(this.geo.isSelectedNode=!0);this.geo.isSelectedNode=!1;for(var o=0;o<this.geo.graphCore.vs.length;++o)this.geo.graphCore.vs[o].x+=t,this.geo.graphCore.vs[o].y+=n;this.geo.textLeaderline&&(this.geo.textLeaderline.translateByMouseEventData(e),this.geo.textLeaderline.leaderline&&(this.geo.textLeaderline.leaderline.v2.x+=t,this.geo.textLeaderline.leaderline.v2.y+=n))}},e.prototype.translate=function(e,t){},e}(),nt=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),ot=function(e){function t(t,n,o,i,s){void 0===o&&(o=r.zq.POLYGON_GRAPH),void 0===i&&(i=!1),void 0===s&&(s=!0);var a=e.call(this,t)||this;return a.isSelectedNode=!1,a.torVisMidPt=10,a.skipTranslationForLeaderline=!0,a.type=o,a.isUnderConstruction=!1,a.isSelectable=!0,a.isRenderable=!0,a.isFill=!0,a.isUndo=i,a.initGraph(n),a.updateCenVec(),a.initVecsHistory(),a.initComponent(),a.scene.addAPolygonGraphWrapper(a),a.isUndo||a.scene.annotationInstance.io.eventListenerAnnotation.addGeometryStack(a.toJSON()),a}return nt(t,e),t.cancel=function(e){void 0!==e.listAPolylineGraphShadow&&(e.listAPolylineGraphShadow=void 0)},t.doneByKeyboard=function(e){if(void 0!==e.listAPolylineGraphShadow){var n=e.listAPolylineGraphShadow.getVecs();n?(t.getPolygon(e,n),e.listAPolylineGraphShadow=void 0,e.annotationInstance.activeCommandController.goToACMode()):(e.listAPolylineGraphShadow=void 0,e.annotationInstance.activeCommandController.goToACMode())}},t.undo=function(e,t){void 0!==e.listAPolylineGraphShadow&&e.listAPolylineGraphShadow.undo()},t.mouseDown=function(e,t){void 0!==e.listAPolylineGraphShadow&&e.listAPolylineGraphShadow.ps.length>0&&e.listAPolylineGraphShadow.add(new r.h9(t.x,t.y))},t.mouseLeftClick=function(e,t,n,o){void 0===n&&(n=!1),void 0===o&&(o=r.zq.POLYGON_GRAPH),void 0===e.capture&&(void 0===e.listAPolylineGraphShadow&&(e.listAPolylineGraphShadow=new de(e,o),e.listAPolylineGraphShadow.add(new r.h9(t.x,t.y)),e.listAPolylineGraphShadow.add(new r.h9(t.x,t.y))),e.annotationInstance.implementations.app.model.ioWrapper.eventInteraction.isEnableZoomByDoubleClick=!1)},t.mouseMove=function(e,t){if(void 0!==e.listAPolylineGraphShadow){if(e.annotationInstance.activeCommandController.acProperties.pressShift){var n=e.listAPolylineGraphShadow.ps[e.listAPolylineGraphShadow.ps.length-1];(0,r.Sp)(n.v,new r.h9(t.x,t.y))>20&&e.listAPolylineGraphShadow.add(new r.h9(t.x,t.y))}e.listAPolylineGraphShadow.ps.length>1&&e.listAPolylineGraphShadow.mouseMove(t.x,t.y)}},t.mouseDoubleClick=function(e,n){var o;void 0!==e.listAPolylineGraphShadow&&(e.annotationInstance.activeCommandController.IsTouchEvent?e.listAPolylineGraphShadow.ps.length>1&&(o=e.listAPolylineGraphShadow.getVecs())&&((o=o.slice(0,o.length-1))?(t.getPolygon(e,o),e.listAPolylineGraphShadow=void 0,e.annotationInstance.activeCommandController.goToACMode()):(e.listAPolylineGraphShadow=void 0,e.annotationInstance.activeCommandController.goToACMode())):e.listAPolylineGraphShadow.ps.length>1&&((o=e.listAPolylineGraphShadow.getVecs())?(t.getPolygon(e,o),e.listAPolylineGraphShadow=void 0,e.annotationInstance.activeCommandController.goToACMode()):(e.listAPolylineGraphShadow=void 0,e.annotationInstance.activeCommandController.goToACMode())),e.annotationInstance.implementations.app.model.ioWrapper.eventInteraction.isEnableZoomByDoubleClick=!0)},t.getPolygonbyVecs=function(e,t){return this.getPolygon(e,t)},t.getPolygon=function(e,n,o){return void 0===o&&(o=!1),e.listAPolylineGraphShadow=void 0,new t(e,n,r.zq.POLYGON_GRAPH,!1,!0)},t.fromJSON=function(e,n,o,i){void 0===o&&(o=!1),void 0===i&&(i=!1);for(var s=[],a=0;a<n.nodes.length;++a){var h=new r.h9(n.nodes[a].sx,n.nodes[a].sy);s.push(h)}var c=new t(e,s,r.zq.POLYGON_GRAPH,!0);return c.type=r.zq[n.type],c.id=i?e.getUUID():n.id,c.isUnderConstruction=!1,c.isHover=!1,c.isHiddenValue=n.isHidden,n.isHidden?c.visibilityValue=0:c.visibilityValue=1,n.styles&&n.styles.dash&&(c.styleComponent.renderStyle.dash=n.styles.dash),n.styles&&c.updateStyleCustom(n.styles),n.data.scale&&c.initScale(n.data.scale),c.initVecsHistory(),o||e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(c.toJSON()),c},t.prototype.initComponent=function(){this.styleComponent=new et(this),this.mouseEventComponent=new Ke(this),this.ioComponent=new Xe(this),this.interactionComponent=new Ye(this),this.transformationComponent=new tt(this),this.renderer=new Qe(this)},t.prototype.initGraph=function(e){this.graphCore=new Je(this),this.graphCore.initByVec(e)},t.prototype.updateCenVec=function(){this.vec=this.graphCore.getCenVec()},t.prototype.polygonGraphResetForSplit=function(){this.transformationComponent.polygonGraphResetForSplit()},t.prototype.needSnapping=function(e){return this.interactionComponent.needSnapping(e)},t.prototype.getVecForSnapping=function(){return this.graphCore.selVec},t.prototype.getVecs=function(){return this.graphCore.vs},t.prototype.goToBlackhole=function(){this.needBlackhole=!0,this.tVec=this.scene.annotationInstance.renderer.blackhole.v,this.isAniAccel=!0},t.prototype.isMoveUpdate=function(){this.vecsHistory.length<1||(this.isMove=!0,this.isTransform=!0)},t.prototype.remove=function(e){if(void 0===e&&(e=!0),!this.isRemove&&this.isRenderable&&!this.isHiddenValue){if(this.graphCore.selectedVec){this.graphCore.removeSelVec();var t=this.toJSON();if(t)return void this.scene.annotationInstance.io.eventListenerAnnotation.transformStack([t])}this.ioComponent.remove(e)}},t.prototype.deepRemove=function(){this.isSelectable=!1,this.isRenderable=!1,this.hidePopUpSummary(),this.scene.removeAPolygonGraphWrapper(this),this.scene.removeGeometry(this)},t.prototype.isMouseInside=function(e,t){return this.interactionComponent.isMouseInside(e,t)},t.prototype.getLog=function(){return this.interactionComponent.GetLog()},t.prototype.hide=function(){this.interactionComponent.hide()},t.prototype.translateByMouseEventData=function(e){this.transformationComponent.translateByMouseEventData(e)},t.prototype.translate=function(e,t){this.transformationComponent.translate(e,t)},t.prototype.toJSON=function(){return this.ioComponent.ToJSON()},t.prototype.mouseLeftClick=function(){this.mouseEventComponent.mouseLeftClick()},t.prototype.mouseRightClick=function(){this.mouseEventComponent.mouseRightClick()},t.prototype.renderPost=function(e){this.renderer.renderPost(e)},t.prototype.renderPostNodes=function(e){this.renderer.renderPostNodes(e)},Object.defineProperty(t.prototype,"isHidden",{get:function(){return this.isHiddenValue},set:function(e){this.isHiddenPre=this.isHiddenValue,this.isHiddenValue=e,this.scene.annotationInstance.io.eventListenerAnnotation.hideStack(this.toJSON())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isSelected",{get:function(){return this.isSelectedValue},set:function(e){this.isRemove||!this.isRenderable||this.isHiddenValue||this.graphCore.selVec||(this.isSelectedValue=e,e||(this.graphCore.selectedVec=void 0),this.scene.annotationInstance.io.eventListenerAnnotation.selectionStack(this.toJSON()))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isHover",{get:function(){return this.isHoverValue},set:function(e){this.isUnderConstruction||(this.isHoverValue=e,(this.isHoverValue&&!this.isHoverPre||!this.isHoverValue&&this.isHoverPre)&&this.scene.annotationInstance.io.eventListenerAnnotation.hoverStack(this.toJSON()),this.isHoverPre=this.isHoverValue,e||(this.needEmitHoverPost=!0,this.hidePopUpSummary()))},enumerable:!1,configurable:!0}),t.prototype.getBoundary=function(){return[this.vec]},t.prototype.showPopupSummary=function(){this.interactionComponent.showPopupSummary()},t.prototype.getclosestNode=function(e,t){if(this.graphCore.getclosestVec(e,t))return this},t.prototype.findClosestVec=function(e){return this.graphCore.getclosestVec(e,20)},t.prototype.updatePopup=function(){this.hasPopupValue&&void 0!==this.popup&&(this.hasGhostPopup?(this.popup.style.top=this.vec.y-this.scene.annotationInstance.customization.themeCurrent.nPoint.height-this.ghostPopupOffset+"px",this.popup.style.left=this.vec.x+"px"):(this.popup.style.top=this.vec.y+"px",this.popup.style.left=this.vec.x+"px"))},t.prototype.checkAttachedTextleaderline=function(){if(!this.textLeaderline||!this.textLeaderline.leaderline)return!1;if(this.skipTranslationForLeaderline=!0,this.graphCore.selVec&&this.textLeaderline&&this.textLeaderline.leaderline){if((0,r.Sp)(this.graphCore.selVec,this.textLeaderline.leaderline.v2)>5)return this.skipTranslationForLeaderline=!0,!1;this.skipTranslationForLeaderline=!1}for(var e=!1,t=0;t<this.graphCore.vs.length;++t)(0,r.Sp)(this.graphCore.vs[t],this.textLeaderline.leaderline.v2)<5&&(e=!0);return!!e||(this.textLeaderline.attachedShape=void 0,this.textLeaderline=void 0,!1)},t.isSplit=!0,t}(y),it=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),st=function(e){function t(t){var n=e.call(this,t)||this;return n.host=t,n}return it(t,e),t.prototype.renderPost=function(e){this.timer.update(),this.host.computeBoundingVecsAndCenterVec(),this.host.scene.annotationInstance.activeCommandController.acProperties.showUnit&&(this.host.type===r.zq.CURVE_CLOSE?(this.host.isHoverValue||this.host.isUnderConstruction)&&this.host.dimension.renderTotalAreaCurve(e,this.host.vecs,this.host.isClosed):(this.host.isHoverValue||this.host.isUnderConstruction)&&this.host.dimension.renderTotalLengthCurve(e,this.host.vecs,this.host.isClosed)),this.host.computeCurve(),this.renderPostGeometry(e)},t.prototype.renderPostGeometry=function(e){this.renderSpline(e,this.host.arrayVertexs,this.host.arrayControlPoint,this.host.arrayWeight,this.host.isHoverValue,this.host.isSelectedValue,this.host.isClosed),(this.host.isHoverValue||this.host.isSelectedValue)&&this.host.scene.annotationInstance.implementations.app.model.appCoreWrapper.appControllerStatus.mode===r.An.Drawing&&(this.drawControlLine(e,this.host.arrayControlPoint,this.host.arrayVertexs),this.drawControPoint(e,this.host.arrayControlPoint))},t.prototype.renderSpline=function(e,t,n,o,i,s,r){var a=t,h=n,c=a.length;if(r){if(this.host.isHoverValue||this.host.isSelectedValue)for(var p=2;p<c+2;p+=2)this.host.scene.annotationInstance.renderer.draw.shape.curve.curveBezierClosedHoverPolygon(e,this.host.styleComponent.renderStyle,a[p],a[p+1],h[2*p-2],h[2*p-1],h[2*p],h[2*p+1],a[p+2],a[p+3],this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.host.renderer.tOver));for(p=2;p<c+2;p+=2)this.host.scene.annotationInstance.renderer.draw.shape.curve.curveBezierClosed(e,this.host.styleComponent.renderStyle,a[p],a[p+1],h[2*p-2],h[2*p-1],h[2*p],h[2*p+1],a[p+2],a[p+3],this.host.isHoverValue,this.host.isSelectedValue);this.host.isFill&&this.renderCurveInfill(e,t,n)}else{if(this.host.isHoverValue||this.host.isSelectedValue){for(p=2;p<a.length-5;p+=2)this.host.scene.annotationInstance.renderer.draw.shape.curve.curveBezierHoverPolyline(e,this.host.styleComponent.renderStyle,a[p],a[p+1],h[2*p-2],h[2*p-1],h[2*p],h[2*p+1],a[p+2],a[p+3],this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.host.renderer.tOver));this.host.scene.annotationInstance.renderer.draw.shape.curve.curveQuadraticHoverPolyline(e,this.host.styleComponent.renderStyle,a[0],a[1],h[0],h[1],a[2],a[3],this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.host.renderer.tOver)),this.host.scene.annotationInstance.renderer.draw.shape.curve.curveQuadraticHoverPolyline(e,this.host.styleComponent.renderStyle,a[c-2],a[c-1],h[2*c-10],h[2*c-9],a[c-4],a[c-3],this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.host.renderer.tOver))}for(p=2;p<a.length-5;p+=2)this.host.scene.annotationInstance.renderer.draw.shape.curve.curveBezier(e,this.host.styleComponent.renderStyle,a[p],a[p+1],h[2*p-2],h[2*p-1],h[2*p],h[2*p+1],a[p+2],a[p+3],this.host.isHoverValue,this.host.isSelectedValue);this.host.scene.annotationInstance.renderer.draw.shape.curve.curveQuadratic(e,this.host.styleComponent.renderStyle,a[0],a[1],h[0],h[1],a[2],a[3],this.host.isHoverValue,this.host.isSelectedValue),this.host.scene.annotationInstance.renderer.draw.shape.curve.curveQuadratic(e,this.host.styleComponent.renderStyle,a[c-2],a[c-1],h[2*c-10],h[2*c-9],a[c-4],a[c-3],this.host.isHoverValue,this.host.isSelectedValue)}this.offscreenRender(a,h,c,r)},t.prototype.drawControPoint=function(e,t){e.lineWidth=.5*this.host.styleComponent.renderStyleNode.lineWidth,e.fillStyle=this.host.styleComponent.renderStyleNode.colorFill,e.strokeStyle=this.host.styleComponent.renderStyleNode.colorStroke;for(var n=0;n<t.length-1;n+=2)e.beginPath(),e.arc(t[n],t[n+1],3*this.host.scaleForRender,0,2*Math.PI,!1),e.fill(),e.stroke()},t.prototype.drawControlLine=function(e,t,n){for(var o=2;o<n.length-5;o+=2)this.host.scene.annotationInstance.renderer.draw.shape.curve.drawControlLine(e,this.host.styleComponent.renderStyle,n[o],n[o+1],t[2*o-2],t[2*o-1]),this.host.scene.annotationInstance.renderer.draw.shape.curve.drawControlLine(e,this.host.styleComponent.renderStyle,n[o+2],n[o+3],t[2*o],t[2*o+1]);this.host.scene.annotationInstance.renderer.draw.shape.curve.drawControlLine(e,this.host.styleComponent.renderStyle,n[2],n[3],t[0],t[1]),this.host.scene.annotationInstance.renderer.draw.shape.curve.drawControlLine(e,this.host.styleComponent.renderStyle,n[n.length-4],n[n.length-3],t[2*n.length-10],t[2*n.length-9])},t.prototype.renderCurveInfill=function(e,t,n,o){void 0===o&&(o=.3);var i=t,s=n,r=i.length;this.host.scene.annotationInstance.renderer.needFocus&&!this.host.isHoverValue?(e.strokeStyle=this.host.styleComponent.renderStyle.colorStrokeHover,e.fillStyle=this.host.styleComponent.renderStyle.colorFillHover):(e.strokeStyle=this.host.styleComponent.renderStyle.colorStroke,e.fillStyle=this.host.styleComponent.renderStyle.colorFill),this.host.isSelectedValue&&(e.strokeStyle=this.host.styleComponent.renderStyle.colorStroke,e.fillStyle=this.host.styleComponent.renderStyle.colorFill),e.beginPath(),e.moveTo(i[2],i[3]);for(var a=2;a<r+2;a+=2)this.host.scene.annotationInstance.renderer.draw.shape.curve.curveBezierClosedFill(e,this.host.styleComponent.renderStyle,i[a],i[a+1],s[2*a-2],s[2*a-1],s[2*a],s[2*a+1],i[a+2],i[a+3]);e.closePath(),e.fill()},t.prototype.renderCurveInfillOffscreen=function(e,t,n,o){var i=n,s=o,r=i.length;e.save(),e.beginPath(),e.fillStyle=t,e.moveTo(i[2],i[3]);for(var a=2;a<r+2;a+=2)this.host.scene.annotationInstance.renderer.draw.shape.curve.curveBezierClosedFill(e,this.host.styleComponent.renderStyle,i[a],i[a+1],s[2*a-2],s[2*a-1],s[2*a],s[2*a+1],i[a+2],i[a+3]);e.closePath(),e.fill(),e.restore()},t.prototype.offscreenRender=function(e,t,n,o){if(o){for(var i=2;i<n+2;i+=2)this.host.scene.annotationInstance.renderer.offscreen.curveBezierOffScreen(this.host.scene.annotationInstance.renderer.ctxOffscreen,this.host.styleComponent.renderStyle,this.host.hashColor,e[i],e[i+1],t[2*i-2],t[2*i-1],t[2*i],t[2*i+1],e[i+2],e[i+3]);this.renderCurveInfillOffscreen(this.host.scene.annotationInstance.renderer.ctxOffscreen,this.host.hashColor,e,t)}else{for(i=2;i<e.length-5;i+=2)this.host.scene.annotationInstance.renderer.offscreen.curveBezierOffScreen(this.host.scene.annotationInstance.renderer.ctxOffscreen,this.host.styleComponent.renderStyle,this.host.hashColor,e[i],e[i+1],t[2*i-2],t[2*i-1],t[2*i],t[2*i+1],e[i+2],e[i+3]);this.host.scene.annotationInstance.renderer.offscreen.curveQuadraticArrowOffScreen(this.host.scene.annotationInstance.renderer.ctxOffscreen,this.host.styleComponent.renderStyle,this.host.hashColor,e[0],e[1],t[0],t[1],e[2],e[3]),this.host.scene.annotationInstance.renderer.offscreen.curveQuadraticArrowOffScreen(this.host.scene.annotationInstance.renderer.ctxOffscreen,this.host.styleComponent.renderStyle,this.host.hashColor,e[n-2],e[n-1],t[2*n-10],t[2*n-9],e[n-4],e[n-3])}},t}(C),rt=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),at=function(e){function t(t){var n=e.call(this,t)||this;return n.updateStyle(),n}return rt(t,e),t.prototype.updateStyle=function(){x.updateRenderStylePolygon(this.renderStyle,this.geo.scene.annotationInstance.customization.themeCurrent),x.updateRenderStylePolygonNode(this.renderStyleNode,this.geo.scene.annotationInstance.customization.themeCurrent)},t}(b),ht=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),ct=function(e){function t(t,n,o){void 0===n&&(n=!1),void 0===o&&(o=!1);var i=e.call(this,t)||this;return i.vecSelected=-1,i.vec=new r.h9(0,0,0),i.pts=[],i.initComponent(),i.isClosed=n,i.isUndo=o,i.isUnderConstruction=!0,i.showDetails=!0,i.isClosed?(i.type=r.zq.CURVE_CLOSE,i.isFill=!0):(i.type=r.zq.CURVE_OPEN,i.isFill=!1),i.dimension=new H(i),i.scene.addACurve(i),i.init(),i}return ht(t,e),t.getControlPoints=function(e,t,n,o,i,s,r){var a=Math.sqrt(Math.pow(n-e,2)+Math.pow(o-t,2)),h=r*a/(a+Math.sqrt(Math.pow(i-n,2)+Math.pow(s-o,2))),c=r-h;return[n+h*(e-i),o+h*(t-s),n-c*(e-i),o-c*(t-s)]},t.computeControlPoints=function(e,n,o){void 0===o&&(o=!1);var i=[];if(o){e.push(e[0],e[1],e[2],e[3]),e.unshift(e[e.length-1]),e.unshift(e[e.length-1]);for(var s=0;s<e.length;s+=2)i=i.concat(t.getControlPoints(e[s],e[s+1],e[s+2],e[s+3],e[s+4],e[s+5],n));i=i.concat(i[0],i[1])}else for(s=0;s<e.length-4;s+=2)i=i.concat(t.getControlPoints(e[s],e[s+1],e[s+2],e[s+3],e[s+4],e[s+5],n));return i},t.getLength=function(e,t){for(var n=e.listACurve.length,o=0;n--;)t===e.listACurve[n].type&&(o+=1);return o},t.getLengthSelection=function(e,t){for(var n=e.listACurve.length,o=0;n--;)e.listACurve[n].isSelected&&t===e.listACurve[n].type&&(o+=1);return o},t.fromJSON=function(e,n,o,i,s){void 0===o&&(o=!1),void 0===i&&(i=!1),void 0===s&&(s=!1);var a=new t(e,s,o);if(o)for(var h=0;h<n.nodes.length;++h)a.addPT(k.getNodeFromJSON(e,n.nodes[h],o));else for(h=0;h<n.nodes.length;++h)a.addPT(k.getNodeFromJSON(e,n.nodes[h]));return a.type=r.zq[n.type],a.IsSelectable=!0,a.isUnderConstruction=!1,a.isHover=!1,a.isHidden=n.isHidden,a.id=i?e.getUUID():n.id,n.isHidden?a.visibilityValue=0:a.visibilityValue=1,a.initVecsHistory(),t.construction=void 0,a},t.getCurveByVecs=function(e,n,o){void 0===o&&(o=!1);for(var i=new t(e,o),s=0;s<n.length;++s)i.addPT(new k(e,n[s].x,n[s].y,0));return i.IsSelectable=!0,i.isUnderConstruction=!1,e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(i.toJSON()),i},t.drawShadow=function(e){if(void 0!==t.construction)if(t.construction.pts.length<3){if(t.construction.isRemove)return;t.construction.pts[t.construction.pts.length-1].move(e.x,e.y);var n=t.construction.pts[0],o=t.construction.pts[1],i=t.construction.pts[2];o.vec.x=.5*(n.vec.x+i.vec.x),o.vec.y=.5*(n.vec.y+i.vec.y)}else t.construction.pts[t.construction.pts.length-1].move(e.x,e.y)},t.getCurveByPt=function(e,n){t.construction=new t(e),t.construction.addPT(new k(e,n.vec.x,n.vec.y)),t.construction.addPT(new k(e,n.vec.x,n.vec.y)),t.construction.addPT(new k(e,n.vec.x,n.vec.y)),n.remove()},t.getCurve=function(e,n,o){void 0===o&&(o=!1),void 0!==t.construction?t.construction.pts[0].distance(n.x,n.y)<5?(t.construction.isClosed=o,t.construction.isClosed?(t.construction.removePT(t.construction.pts[0]),t.construction.removePT(t.construction.pts[0]),t.construction.removePT(t.construction.pts[t.construction.pts.length-1]),t.construction.removePT(t.construction.pts[t.construction.pts.length-1])):(t.construction.removePT(t.construction.pts[0]),t.construction.removePT(t.construction.pts[t.construction.pts.length-1]),t.construction.removePT(t.construction.pts[t.construction.pts.length-1])),t.construction.IsCapture=!1,t.construction=void 0):t.construction.addPT(new k(e,n.x,n.y)):(t.construction=new t(e,o),t.construction.addPT(new k(e,n.x,n.y)),t.construction.addPT(new k(e,n.x,n.y)),t.construction.addPT(new k(e,n.x,n.y)))},t.done=function(e,n){void 0===n&&(n=!1),void 0!==t.construction&&(t.construction.pts.length<5?(new k(e,t.construction.pts[0].vec.x,t.construction.pts[0].vec.y,t.construction.pts[0].vec.z).dummy(),t.construction.remove(),t.construction=void 0,e.annotationInstance.activeCommandController.goToACMode()):(t.construction.isClosed?(t.construction.removePT(t.construction.pts[0]),t.construction.removePT(t.construction.pts[0]),t.construction.removePT(t.construction.pts[t.construction.pts.length-1]),t.construction.removePT(t.construction.pts[t.construction.pts.length-1])):(t.construction.removePT(t.construction.pts[0]),t.construction.removePT(t.construction.pts[t.construction.pts.length-1]),t.construction.removePT(t.construction.pts[t.construction.pts.length-1])),t.construction.IsSelectable=!0,t.construction.isUnderConstruction=!1,e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(t.construction.toJSON()),t.construction=void 0,e.annotationInstance.activeCommandController.goToACMode()))},t.doneByKeyboard=function(e){void 0!==t.construction&&(t.construction.pts.length<5?(new k(e,t.construction.pts[0].vec.x,t.construction.pts[0].vec.y,t.construction.pts[0].vec.z).dummy(),t.construction.remove(),t.construction=void 0,e.annotationInstance.activeCommandController.goToACMode()):(t.construction.removePT(t.construction.pts[0]),t.construction.removePT(t.construction.pts[1]),t.construction.removePT(t.construction.pts[t.construction.pts.length-1]),t.construction.IsSelectable=!0,t.construction.isUnderConstruction=!1,e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(t.construction.toJSON()),t.construction=void 0,e.annotationInstance.activeCommandController.goToACMode()))},t.undo=function(e){if(t.construction){var n=t.construction.pts.length-1;n<4?t.cancel():(t.construction.removePT(t.construction.pts[--n]),t.construction.pts[n].vec.x=e.x,t.construction.pts[n].vec.y=e.y)}},t.cancel=function(){void 0!==t.construction&&(t.construction.isRemove=!0,t.construction.remove(),t.construction=void 0)},t.mouseDown=function(e,n,o){if(void 0===o&&(o=!1),e.annotationInstance.activeCommandController.acProperties.isSmartSelectionWhenDrawing){var i=e.annotationInstance.geometryCommon.gcmdProcessing.findAtPoint(n);t.construction&&(i===t.construction.pts[t.construction.pts.length-1]?void 0!==i&&i.type===r.zq.ANODE&&void 0!==t.construction?(t.construction&&t.construction.addPT(new k(e,i.v.x,i.v.y,i.v.z)),i.remove()):void 0!==i&&i.type===r.zq.ANODE&&void 0===t.construction&&t.getCurveByPt(e,i):t.getCurve(e,n,o))}else t.getCurve(e,n,o)},t.mouseDoubleClick=function(e,n,o){void 0===o&&(o=!1),void 0!==t.construction&&t.done(e,o)},t.mouseLeftClick=function(e,n,o){void 0===o&&(o=!1),void 0===e.capture&&void 0===t.construction&&t.getCurve(e,n,o)},t.mouseMove=function(e){t.drawShadow(e)},t.prototype.initComponent=function(){this.styleComponent=new at(this),this.renderer=new st(this)},t.prototype.init=function(){},t.prototype.getLog=function(){return"GUID : "+this.id+"/TYPE : "+this.type.toString()+"/Screen : /Nodes : "+this.pts.length+"/IsSEL : "+this.isSelectedValue+"/isSelable : "+this.isSelectable},t.prototype.getLogDOM=function(){return"Geometry ID : "+this.id+"<br>geometry Type : CCircle<br>position : size : "+this.r+" pixel<br>"},t.prototype.getVecs=function(){this.vecs=[];for(var e=0,t=this.pts;e<t.length;e++){var n=t[e];this.vecs.push(n.vec)}return this.vecs},t.prototype.computeVertex=function(){this.arrayVertexs=[];for(var e=0,t=this.pts;e<t.length;e++){var n=t[e];this.arrayVertexs.push(n.vec.x,n.vec.y)}},t.prototype.computeWeight=function(){this.arrayWeight=[];for(var e=0,t=this.pts;e<t.length;e++){var n=t[e];this.arrayWeight.push(n.weightLeft,n.weightRight)}},t.prototype.computeControlPoint=function(){for(var e=[],n=0,o=this.arrayVertexs;n<o.length;n++){var i=o[n];e.push(i)}var s=[];if(this.isClosed){e.push(e[0],e[1],e[2],e[3]),e.unshift(e[this.arrayVertexs.length-1]),e.unshift(e[this.arrayVertexs.length-1]);for(var r=0;r<this.arrayVertexs.length;r+=2)s=s.concat(t.getControlPoints(e[r],e[r+1],e[r+2],e[r+3],e[r+4],e[r+5],this.arrayWeight[r]));return s=s.concat(s[0],s[1]),this.arrayControlPoint=s,void(this.arrayVertexs=e)}for(r=0;r<e.length-4;r+=2)s=s.concat(t.getControlPoints(e[r],e[r+1],e[r+2],e[r+3],e[r+4],e[r+5],this.arrayWeight[r]));this.arrayControlPoint=s},t.prototype.goToBlackhole=function(){this.isSelectable=!1,this.needBlackhole=!0,this.pts.forEach((function(e){e.goToBlackhole()}))},t.prototype.computeVertexDuplication=function(e){this.arrayVertexs=[];for(var n=0,o=e;n<o.length;n++){var i=o[n];this.arrayVertexs.push(i.x,i.y)}for(var s=[],r=0,a=this.arrayVertexs;r<a.length;r++){var h=a[r];s.push(h)}var c=[];if(this.isClosed){s.push(s[0],s[1],s[2],s[3]),s.unshift(s[this.arrayVertexs.length-1]),s.unshift(s[this.arrayVertexs.length-1]);for(var p=0;p<this.arrayVertexs.length;p+=2)c=c.concat(t.getControlPoints(s[p],s[p+1],s[p+2],s[p+3],s[p+4],s[p+5],this.arrayWeight[p]));return c=c.concat(c[0],c[1]),this.arrayControlPoint=c,void(this.arrayVertexs=s)}for(p=0;p<s.length-4;p+=2)c=c.concat(t.getControlPoints(s[p],s[p+1],s[p+2],s[p+3],s[p+4],s[p+5],this.arrayWeight[p]));this.arrayControlPoint=c},t.prototype.computeCurve=function(){this.computeVertex(),this.computeWeight(),this.computeControlPoint()},t.prototype.remove=function(e){void 0===e&&(e=!0);for(var t=this.pts.length;t--;)this.pts[t].remove();if(e){var n=this.toJSON();n&&this.scene.annotationInstance.io.eventListenerAnnotation.removeGeometryStack([n])}this.scene.removeACurve(this),this.scene.removeGeometry(this)},t.prototype.hide=function(){},t.prototype.addPT=function(e){e.type=r.zq.ANODE,e.vec.w=.5,e.weightLeft=e.vec.w,e.weightRight=0,e.isSelectable=!1,e.styleComponent.renderStyle=this.styleComponent.renderStyleNode,e.styleComponent.renderStyleNode=this.styleComponent.renderStyleNode,e.styleComponent.updateStyleForNode(this.styleComponent.renderStyleNode),e.edges.push(this),this.pts.push(e),this.pts.length>2&&this.computeCurve()},t.prototype.removePT=function(e){this.pts.splice(this.pts.indexOf(e),1),e.remove()},t.prototype.deepCopy=function(e,n,o){void 0===o&&(o=0);var i=this.toJSON();if(i){var s=void 0;return(s=i.type===r.zq.CURVE_CLOSE?t.fromJSON(this.scene,i,!0,!0,!0):t.fromJSON(this.scene,i,!0,!0)).move(e,n),s.isHover=!0,s.emitAddStack(),s}},t.prototype.move=function(e,t){if(!this.isRemove&&this.isRenderable&&!this.isHiddenValue){this.computeBoundingVecsAndCenterVec();for(var n=e-this.vec.x,o=t-this.vec.y,i=0;i<this.pts.length;++i)this.pts[i].vec.x+=n,this.pts[i].vec.y+=o}},t.prototype.isMouseInside=function(e,t){return!(!0===this.isUnderConstruction||void 0===this.isUnderConstruction||!this.checkDistance(e,t)&&!this.isMouseInsideByOffScreen(e,t))},t.prototype.checkDistance=function(e,t){return!1},t.prototype.isMouseInsideByOffScreen=function(e,t){return this.scene.annotationInstance.geometryCommon.gcmdProcessing.isMouseInsideByOffScreen(e,t,this.hashColor)?(this.isHover=!0,!0):(this.isHover=!1,!1)},Object.defineProperty(t.prototype,"IsSelectable",{get:function(){return this.isSelectable},set:function(e){this.isSelectable=e;for(var t=0;t<this.pts.length;++t)this.pts[t].isSelectable=e},enumerable:!1,configurable:!0}),t.prototype.translateByMouseEventData=function(e){for(var t=e.x-e.preX,n=e.y-e.preY,o=0;o<this.pts.length;++o)this.pts[o].vec.x+=t,this.pts[o].vec.y+=n},t.prototype.translate=function(e,t){},Object.defineProperty(t.prototype,"isSelected",{get:function(){return this.isSelectedValue},set:function(e){this.isSelectedValue=e;for(var t=0,n=this.pts;t<n.length;t++)n[t].isRenderable=e;this.scene.annotationInstance.io.eventListenerAnnotation.selectionStack(this.toJSON())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isHover",{get:function(){return this.isHoverValue},set:function(e){if(!this.isUnderConstruction&&!this.isSelectedValue){for(var t=0,n=this.pts;t<n.length;t++)n[t].isRenderable=e;if(this.isHoverValue=e,this.isHoverValue&&!this.isHoverPre){for(var o=0;o<this.pts.length;++o)this.pts[o].renderer.t=0;this.scene.annotationInstance.io.eventListenerAnnotation.hoverStack(this.toJSON())}else!this.isHoverValue&&this.isHoverPre&&this.scene.annotationInstance.io.eventListenerAnnotation.hoverStack(this.toJSON());this.isHoverPre=this.isHoverValue,e||(this.needEmitHoverPost=!0,this.hidePopUpSummary())}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"IsCapture",{get:function(){return this.isCapturedValue},set:function(e){for(var t=0;t<this.pts.length;++t)this.pts[t].isCapturedValue=e},enumerable:!1,configurable:!0}),t.prototype.getNode=function(){for(var e=[],t=0;t<this.pts.length;++t)e.push(this.pts[t].vec);return e},t.prototype.mouseRightClick=function(){this.isClosed&&(this.isFill=!this.isFill)},t.prototype.toJSON=function(){var e=new p(this.id,this.type,this.isSelectedValue,this.isHoverValue,this.isHiddenValue);return e.pushNode(this.getNode()),e},t.prototype.renderPost=function(e){this.renderer.renderPost(e)},t.prototype.computeBoundingVecsAndCenterVec=function(){this.vecs=[];for(var e=0;e<this.pts.length;++e)this.vecs.push(this.pts[e].vec);this.vec=(0,r.mI)(this.vecs)},t.construction=void 0,t}(y),pt=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),lt=function(e){function t(t){var n=e.call(this,t)||this;return n.vec=new r.h9(0,0,0),n}return pt(t,e),Object.defineProperty(t.prototype,"v",{get:function(){var e=(this.p0.vec.x+this.p1.vec.y+this.pm.vec.x)/3,t=(this.p0.vec.x+this.p1.vec.y+this.pm.vec.x)/3,n=(this.p0.vec.z+this.p1.vec.z+this.pm.vec.z)/3;return this.vec=new r.h9(e,t,n),this.vec},set:function(e){this.vec=e},enumerable:!1,configurable:!0}),t.prototype.getLog=function(){return""},t.prototype.renderPost=function(e){},t.prototype.isMouseInside=function(e,t){return!1},t.prototype.translateByMouseEventData=function(e){},t.prototype.translate=function(e,t){},t.prototype.remove=function(){},t.prototype.hide=function(){},t}(y),dt=function(){function e(e){this.geo=e}return e.prototype.isMouseInside=function(e,t){return!1},e.prototype.getLog=function(){return""},e.prototype.hide=function(){},e}(),ut=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),yt=function(e){function t(t){var n=e.call(this,t)||this;return n.host=t,n}return ut(t,e),t.prototype.isMouseInside=function(e,t){return!(!0===this.host.isUnderConstruction||void 0===this.host.isUnderConstruction||this.host.scene.annotationInstance.implementations.app.model.appCoreWrapper.appControllerStatus.mode!==r.An.Drawing||!this.isMouseInsideByMath(e,t)&&!this.isMouseInsideByOffScreen(e,t))},t.prototype.isMouseInsideByOffScreen=function(e,t){return this.host.scene.annotationInstance.geometryCommon.gcmdProcessing.isMouseInsideByOffScreen(e-this.host.scene.annotationInstance.scene.paramsEditing.croppingMaskParams.x,t-this.host.scene.annotationInstance.scene.paramsEditing.croppingMaskParams.y,this.host.hashColor)?(this.host.isHover=!0,!0):(this.host.isHover=!1,!1)},t.prototype.isMouseInsideByMath=function(e,t){return e-=this.host.scene.annotationInstance.scene.paramsEditing.croppingMaskParams.x,t-=this.host.scene.annotationInstance.scene.paramsEditing.croppingMaskParams.y,this.host.computeCurve(.3),this.isInsideFirstAndLastCurves(e,t)?(this.host.isHover=!0,!0):(this.host.isHover=!1,!1)},t.prototype.isInsideFirstAndLastCurves=function(e,t,n){void 0===n&&(n=100);for(var o=this.host.arrayVertexs,i=this.host.arrayControlPoint,s=0;s<1;s+=.001){var a=Math.abs(Math.pow(1-s,3))*o[0]+3*Math.pow(1-s,2)*s*i[0]+3*Math.abs(1-s)*Math.pow(s,2)*i[0]+Math.abs(Math.pow(s,3))*o[2],h=Math.abs(Math.pow(1-s,3))*o[1]+3*Math.pow(1-s,2)*s*i[1]+3*Math.abs(1-s)*Math.pow(s,2)*i[1]+Math.abs(Math.pow(s,3))*o[3],c=Math.abs(Math.pow(1-s,3))*o[2]+3*Math.pow(1-s,2)*s*i[2]+3*Math.abs(1-s)*Math.pow(s,2)*i[2]+Math.abs(Math.pow(s,3))*o[4],p=Math.abs(Math.pow(1-s,3))*o[3]+3*Math.pow(1-s,2)*s*i[3]+3*Math.abs(1-s)*Math.pow(s,2)*i[3]+Math.abs(Math.pow(s,3))*o[5];if((0,r.Th)(new r.h9(a,h),new r.h9(e,t))<n*this.host.scene.annotationInstance.activeCommandController.scaleGlobal)return!0;if((0,r.Th)(new r.h9(c,p),new r.h9(e,t))<n*this.host.scene.annotationInstance.activeCommandController.scaleGlobal)return!0}return!1},t.prototype.translateByMouseEventData=function(e){if(!this.host.isRemove&&this.host.isRenderable&&!this.host.isHiddenValue){var t=e.x-e.preX,n=e.y-e.preY;this.host.p0.vec.x+=t,this.host.p0.vec.y+=n,this.host.p1.vec.x+=t,this.host.p1.vec.y+=n,this.host.pm.vec.x+=t,this.host.pm.vec.y+=n}},t.prototype.getLog=function(){return"GUID : "+this.host.id+"/TYPE : "+this.host.type.toString()+"/POS : /SIZE : "+this.host.r+" pixel/IsSEL : "+this.host.isSelectedValue+"/isSelable : "+this.host.isSelectable},t.prototype.hide=function(){},t}(dt),mt=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),vt=function(e){function t(t){var n=e.call(this,t)||this;return n._isDash=!1,n.host=t,n}return mt(t,e),t.prototype.renderPost=function(e){this.host.arrowScale!==this.host.scene.annotationInstance.customization.themeCurrent.arrow.scale&&(this.host.arrowScale=this.host.scene.annotationInstance.customization.themeCurrent.arrow.scale),this.host.computeCurve(),(this.host.scene.annotationInstance.activeCommandController.acProperties.isPanning||this.host.scene.annotationInstance.activeCommandController.acProperties.isViewChanging)&&this.host.updateScaleByZoomLevel(),this.host.isUnderConstruction&&this.host.computeMidPoint(),this.renderPostGeometry(e)},t.prototype.renderPostGeometry=function(e){this.drawSpline(e,this.host.arrayVertexs,this.host.arrayControlPoint)},t.prototype.drawSpline=function(e,t,n){var o=t,i=n,s=o.length,a=[this.host.p0.vec,this.host.p1.vec,this.host.pm.vec];this.offscreenRender(o,i,s);var h=this.host.scene.annotationInstance.renderer.draw.shape.curve;this.host.isHoverValue||this.host.isSelectedValue?(h.curveQuadraticArrow(e,this.host.styleComponent.renderStyle,o[0],o[1],i[0],i[1],o[2],o[3],this.host.isHoverValue,a,this.host.isGrayColor,this.host.visibilityValue,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tOver),this.host.isSelectedValue,this.host.styleComponent.state.themeColorId,this._isDash,3),h.curveQuadraticArrow(e,this.host.styleComponent.renderStyle,o[s-2],o[s-1],i[2*s-10],i[2*s-9],o[s-4],o[s-3],this.host.isHoverValue,a,this.host.isGrayColor,this.host.visibilityValue,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tOver),this.host.isSelectedValue,this.host.styleComponent.state.themeColorId,this._isDash),h.cArrowByTranslation(e,this.host.styleComponent.renderStyle,new r.h9(o[4],o[5]),new r.h9(i[2],i[3]),o[4],o[5],this.host.arrowScale,this.host.styleComponent.renderStyle.scaleLocal*this.host.scene.annotationInstance.activeCommandController.scaleGlobal,this.host.isHoverValue,this.host.isGrayColor,this.host.visibilityValue,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tOver),this.host.isSelectedValue,this.host.styleComponent.state.themeColorId),this.host.type===r.zq.ARROW_DOUBLE&&h.cArrowByTranslation(e,this.host.styleComponent.renderStyle,new r.h9(o[0],o[1]),new r.h9(i[0],i[1]),o[0],o[1],this.host.arrowScale,this.host.styleComponent.renderStyle.scaleLocal*this.host.scene.annotationInstance.activeCommandController.scaleGlobal,!0,this.host.isGrayColor,this.host.visibilityValue,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tOver),this.host.isSelectedValue,this.host.styleComponent.state.themeColorId),this.tOver+=this.host.scene.annotationInstance.renderer.dt,this.tDown1=0,this.host.isLeave=!0):(h.curveQuadraticArrow(e,this.host.styleComponent.renderStyle,o[0],o[1],i[0],i[1],o[2],o[3],this.host.isHoverValue,a,this.host.isGrayColor,this.host.visibilityValue,1,this.host.isSelectedValue,this.host.styleComponent.state.themeColorId,this._isDash,3),h.curveQuadraticArrow(e,this.host.styleComponent.renderStyle,o[s-2],o[s-1],i[2*s-10],i[2*s-9],o[s-4],o[s-3],this.host.isHoverValue,a,this.host.isGrayColor,this.host.visibilityValue,1,this.host.isSelectedValue,this.host.styleComponent.state.themeColorId,this._isDash),h.cArrowByTranslation(e,this.host.styleComponent.renderStyle,new r.h9(o[4],o[5]),new r.h9(i[2],i[3]),o[4],o[5],this.host.arrowScale,this.host.styleComponent.renderStyle.scaleLocal*this.host.scene.annotationInstance.activeCommandController.scaleGlobal,this.host.isHoverValue,this.host.isGrayColor,this.host.visibilityValue,1,this.host.isSelectedValue,this.host.styleComponent.state.themeColorId),this.host.type===r.zq.ARROW_DOUBLE&&h.cArrowByTranslation(e,this.host.styleComponent.renderStyle,new r.h9(o[0],o[1]),new r.h9(i[0],i[1]),o[0],o[1],this.host.arrowScale,this.host.styleComponent.renderStyle.scaleLocal*this.host.scene.annotationInstance.activeCommandController.scaleGlobal,!1,this.host.isGrayColor,this.host.visibilityValue,1,this.host.isSelectedValue,this.host.styleComponent.state.themeColorId),this.tOver=0)},t.prototype.offscreenRender=function(e,t,n){this.host.scene.annotationInstance.renderer.offscreen.curveQuadraticArrowOffScreen(this.host.scene.annotationInstance.renderer.ctxOffscreen,this.host.styleComponent.renderStyle,this.host.hashColor,e[0],e[1],t[0],t[1],e[2],e[3]),this.host.scene.annotationInstance.renderer.offscreen.curveQuadraticArrowOffScreen(this.host.scene.annotationInstance.renderer.ctxOffscreen,this.host.styleComponent.renderStyle,this.host.hashColor,e[n-2],e[n-1],t[2*n-10],t[2*n-9],e[n-4],e[n-3])},Object.defineProperty(t.prototype,"isDash",{get:function(){return this._isDash},set:function(e){this._isDash=e},enumerable:!1,configurable:!0}),t}(C),gt=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),ft=function(e){function t(t){var n=e.call(this,t)||this;return n.updateStyle(),n.updateColor(),n}return gt(t,e),t.prototype.updateStyle=function(){this.isCustom||(this.state.themeColorId=s.TitleColor,this.tempColorRgba=[0,0,0,1],this.isCustom=!0,x.updateRenderStyleArrow(this.renderStyle,this.geo.scene.annotationInstance.customization.themeCurrent),x.updateRenderStyleArrowNode(this.renderStyleNode,this.geo.scene.annotationInstance.customization.themeCurrent),this.updateStyleNode())},t.prototype.updateColor=function(e){void 0===e&&(e=void 0),this.isCustom=!0,void 0===e&&(e=this.geo.scene.annotationInstance.activeCommandController.activeColorController.activeColor),x.updateRenderColorArrowCustom(this.renderStyle,this.geo.scene.annotationInstance.customization.themeCurrent,e),x.updateRenderColorArrowNodeCustom(this.renderStyleNode,this.geo.scene.annotationInstance.customization.themeCurrent,e),this.updateStyleNode(),this.tempColorRgba=e},t.prototype.updateAccentColor=function(){},t.prototype.updateStyleCustom=function(e){return e.colorRgba&&(this.tempColorRgba=e.colorRgba),e.scale&&(this.renderStyle.scaleLocal=e.scale,this.state.scale=e.scale),e.width&&(this.state.width=e.width),void 0!==e.color&&(this.state.themeColorId=e.color),void 0!==e.lineDash&&(this.state.lineTypeId=e.lineDash,this.renderStyle.dash=function(e){switch(e){case i.Large:return[8,4];case i.Small:return[4,4];case i.Continuous:return[0,0];default:return[]}}(e.lineDash)),e.colorRgba.length>0&&(x.updateRenderStyleArrowCustom(this.renderStyle,this.geo.scene.annotationInstance.customization.themeCurrent,e),x.updateRenderStyleArrowNodeCustom(this.renderStyleNode,this.geo.scene.annotationInstance.customization.themeCurrent,e),this.updateStyleNode()),this.isCustom=!0,!0},t.prototype.updateStyleNode=function(){if(this.geo.pts)for(var e=0;e<this.geo.pts.length;++e)this.geo.pts[e].styleComponent.updateStyleForNode(this.renderStyleNode)},t.prototype.toJson=function(){if(this.isCustom){var e={width:this.state.width,scale:this.renderStyle.scaleLocal,colorRgba:this.tempColorRgba};return this.state.lineTypeId!==i.Continuous&&(e.lineDash=this.state.lineTypeId),this.state.themeColorId!==s.TitleColor&&(e.color=this.state.themeColorId),e}},t}(b),Ct=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),St=function(e){function t(t){var n=e.call(this,t)||this;return n.host=t,n}return Ct(t,e),t.prototype.translateByMouseEventData=function(e){if(!this.host.isRemove&&this.host.isRenderable&&!this.host.isHiddenValue)if(this.host.pm.isHoverValue)this.host.pm.translateByMouseEventData(e);else{var t=e.x-e.preX,n=e.y-e.preY;this.host.p0.vec.x+=t,this.host.p0.vec.y+=n,this.translateForTextLeaderline(e,this.host.p0),this.host.p1.vec.x+=t,this.host.p1.vec.y+=n,this.translateForTextLeaderline(e,this.host.p1),this.host.pm.vec.x+=t,this.host.pm.vec.y+=n,this.translateForTextLeaderline(e,this.host.pm)}},t.prototype.translateForTextLeaderline=function(e,t){return!(!t.textLeaderline||(t.textLeaderline.translateByMouseEventData(e),!t.textLeaderline.leaderline)||(t.textLeaderline.leaderline.v2.x=t.vec.x,t.textLeaderline.leaderline.v2.y=t.vec.y,0))},t.prototype.translate=function(e,t){},t.prototype.move=function(e,t){if(!this.host.isRemove&&this.host.isRenderable&&!this.host.isHiddenValue){this.host.computeCenterVec();for(var n=e-this.host.vec.x,o=t-this.host.vec.y,i=0;i<this.host.pts.length;++i)this.host.pts[i].vec.x+=n,this.host.pts[i].vec.y+=o}},t}(b),At=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Pt=function(){},wt=function(e){function t(t,n,o,i,s){void 0===i&&(i=!1),void 0===s&&(s=r.zq.ARROW_SINGLE);var a=e.call(this,t)||this;a.vecSelected=-1,a.numSelectionWhenConstruction=0,a.isUndo=i,a.type=s,a.p0=n,a.p1=o;var h=(0,r.zQ)(a.p0.vec,a.p1.vec);return a.pm=new k(t,h.x,h.y,h.z),a.p0.type=r.zq.ANODE,a.pm.type=r.zq.ANODE,a.p1.type=r.zq.ANODE,a.vecs=[a.p0.vec,a.pm.vec,a.p1.vec],a.isMove=!0,a.tVec=new r.h9(0,0,0),a.initComponent(),a.initAArow(),a}return At(t,e),t.findAtPoint=function(e,t){for(var n=e.listAArrow.length-1;n>=0;--n)if(e.listAArrow[n].isSelectable&&e.listAArrow[n].isMouseInside(t.x,t.y))return e.listAArrow[n]},t.computeOver=function(e,n){var o=t.findAtPoint(e,n);void 0!==o&&(o.isHoverValue=!0)},t.getLength=function(e,t){for(var n=e.listAArrow.length,o=0;n--;)e.listAArrow[n].type===t&&(o+=1);return o},t.getLengthSelection=function(e,t){for(var n=e.listAArrow.length,o=0;n--;)e.listAArrow[n].isSelected&&e.listAArrow[n].type===t&&(o+=1);return o},t.fromJSON=function(e,n,o,i,s){void 0===o&&(o=!1),void 0===i&&(i=!1),void 0===s&&(s=!1);var a,h=k.getNodeFromJSON(e,n.nodes[0],o),c=k.getNodeFromJSON(e,n.nodes[1],o),p=k.getNodeFromJSON(e,n.nodes[2],o);h.type=r.zq.ANODE,c.type=r.zq.AMIDPOINT,p.type=r.zq.ANODE,(a=new t(e,h,p,o||!1,s?r.zq.ARROW_SINGLE:r.zq.ARROW_DOUBLE)).pm.vec.x=c.vec.x,a.pm.vec.y=c.vec.y,c.remove(),a.id=i?e.getUUID():n.id,a.isUnderConstruction=!1,a.numSelectionWhenConstruction=2,a.isHover=!1,a.pm.type=r.zq.AMIDPOINT,n.data.isDash&&(a.renderer.isDash=n.data.isDash),n.styles&&a.updateStyleCustom(n.styles),a.computeCenterVec(),a.initVecsHistory(),o||e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(a.toJSON()),t.condition.v0=void 0,t.condition.v1=void 0,t.condition.geo=void 0},t.fromSmartDrawing=function(e,n,o){void 0===o&&(o=r.zq.ARROW_SINGLE),t.getRectByVecs(e,n,o)},t.getRectByVecs=function(e,n,o){void 0===o&&(o=r.zq.ARROW_SINGLE);var i=!1,s=n[0],a=n[n.length-1],h=new t(e,new k(e,s.x,s.y,0,i,r.zq.ANODE),new k(e,a.x,a.y,0,i,r.zq.ANODE),i,o);h.isSelected=h.isHover=h.isUnderConstruction=!1,e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(h.toJSON())},t.drawShadow=function(e,n,o){if(void 0===t.condition.geo){var i=new k(e,n.x,n.y,0);i.isSelectable=!1,o===r.zq.ARROW_SINGLE&&void 0!==t.condition.v0&&(t.condition.geo=new t(e,t.condition.v0,i,!1,r.zq.ARROW_SINGLE)),o===r.zq.ARROW_DOUBLE&&void 0!==t.condition.v0&&(t.condition.geo=new t(e,t.condition.v0,i,!1,r.zq.ARROW_DOUBLE)),void 0!==t.condition.geo&&(t.condition.geo.isSelectable=!1)}else void 0!==t.condition.geo.p1&&t.condition.geo.p1.move(n.x,n.y)},t.getLine=function(e,n,o){if(void 0===o&&(o=r.zq.ARROW_SINGLE),void 0!==t.condition.v0){if(void 0!==t.condition.v0){if(void 0===t.condition.geo)return;return t.condition.geo.p1.move(n.x,n.y),t.condition.geo.computeMidPoint(),t.condition.geo.isSelectable=!0,t.condition.geo.isUnderConstruction=!1,t.condition.geo.isSelected=!1,t.condition.geo.isCaptured=!1,void e.annotationInstance.io.eventListenerAnnotation.addGeometryStack(t.condition.geo.toJSON())}}else t.condition.v0=new k(e,n.x,n.y)},t.getLineByPt=function(e,n){if(void 0===t.condition.v0&&void 0===t.condition.v1)return t.condition.v0=new k(e,n.vec.x,n.vec.y,n.vec.z),void(t.split?t.condition.v0.vec=n.vec:n.remove());void 0!==t.condition.geo&&void 0!==t.condition.geo.p1&&t.condition.geo.p1.move(n.vec.x,n.vec.y),void 0!==t.condition.geo&&(t.condition.geo.isSelectable=!0,t.condition.geo.isUnderConstruction=!1),n.type===r.zq.CNODE?t.split&&void 0!==t.condition.geo&&(t.condition.geo.p1.vec=n.vec):n.type===r.zq.APOINT&&n.remove()},t.cancel=function(){void 0!==t.condition.geo&&t.condition.geo.remove(),t.condition.v0=void 0,t.condition.v1=void 0,t.condition.geo=void 0},t.mouseDown=function(e,n,o){void 0!==t.condition.geo&&(void 0!==e.capture&&e.capture.type===r.zq.APOINT?t.getLineByPt(e,e.capture):t.getLine(e,n,o),t.condition.geo.computeCenterVec(),t.condition.geo.isUnderConstruction=!1,e.Capture=t.condition.geo,t.condition.geo.isSelected=!0,t.condition.v0=void 0,t.condition.v1=void 0,t.condition.geo=void 0,t.isDone=!1,e.annotationInstance.activeCommandController.acProperties.deselectNeeded=!1,e.annotationInstance.activeCommandController.goToACMode()),t.condition.geo&&this.drawShadow(e,n,o)},t.mouseLeftClick=function(e,n,o){t.isDone?t.isDone=!1:(void 0!==e.capture&&e.capture.type===r.zq.APOINT&&void 0!==e.capture&&(t.getLineByPt(e,e.capture),t.isDone=!1),void 0===t.condition.geo&&(t.getLine(e,n,o),t.isDone=!1),t.drawShadow(e,n,o))},t.mouseMove=function(e,n,o){void 0!==t.condition.v0&&t.drawShadow(e,n,o)},t.mouseUp=function(e){},t.prototype.initComponent=function(){this.transformation=new St(this),this.interaction=new yt(this),this.styleComponent=new ft(this),this.renderer=new vt(this)},t.prototype.initAArow=function(){this.computeCenterVec(),this.p0.addEdge(this),this.pm.addEdge(this),this.p1.addEdge(this),this.pts=[this.p0,this.pm,this.p1],this.arrowScale=1,this.lineWidth=5,this.curveWeight=.5,this.scene.addAArrow(this)},t.prototype.computeMidPoint=function(){var e=(0,r.zQ)(this.p0.vec,this.p1.vec);this.pm.vec.x=e.x,this.pm.vec.y=e.y,this.pm.isPointMid=!0,this.pm.type=r.zq.AMIDPOINT},t.prototype.computeVertex=function(e){for(var t=[],n=this.scene.paramsEditing.croppingMaskParams.x,o=this.scene.paramsEditing.croppingMaskParams.y,i=0,s=e;i<s.length;i++){var r=s[i];t.push(r.x-n,r.y-o)}return t},t.prototype.computeWeight=function(e){void 0===e&&(e=1);for(var t=[],n=0;n<this.pts.length;++n)t.push(e);this.arrayWeight=t},t.prototype.computeControlPoint=function(e){for(var t=[],n=0,o=e;n<o.length;n++){var i=o[n];t.push(i)}for(var s=[],r=0;r<t.length-4;r+=2)s=s.concat(ct.getControlPoints(t[r],t[r+1],t[r+2],t[r+3],t[r+4],t[r+5],this.arrayWeight[r]));return s},t.prototype.findClosestNode=function(e,t){if(!this.isRemove&&this.isRenderable&&!this.isHiddenValue)return this.p0.isMouseInside(e,t)?this.p0:this.p1.isMouseInside(e,t)?this.p1:void 0},t.prototype.computeCurve=function(e){void 0===e&&(e=.5),this.arrayVertexs=this.computeVertex(this.getVecs()),this.computeWeight(e),this.arrayControlPoint=this.computeControlPoint(this.arrayVertexs),this.computeCenterVec()},t.prototype.computeCenterVec=function(){var e=[this.p0.vec,this.p1.vec,this.pm.vec];return this.vec=(0,r.mI)(e),this.vec},t.prototype.getLog=function(){return this.interaction.getLog()},t.prototype.deepCopy=function(e,n){this.isSelected=!1;var o=this.p0.deepCopy(),i=this.p1.deepCopy();if(o&&i){var s=new t(this.scene,o,i,!1,this.type);return s.pm.vec.x=this.pm.vec.x,s.pm.vec.y=this.pm.vec.y,s.isUnderConstruction=!1,s.move(e,n),s.emitAddStack(),s}},t.prototype.goToBlackhole=function(){this.isSelectable=!1,this.needBlackhole=!0,this.p0.goToBlackhole(),this.pm.goToBlackhole(),this.p1.goToBlackhole()},t.prototype.move=function(e,t){if(!this.isRemove&&this.isRenderable&&!this.isHiddenValue){this.computeCenterVec();for(var n=e-this.vec.x,o=t-this.vec.y,i=0;i<this.pts.length;++i)this.pts[i].vec.x+=n,this.pts[i].vec.y+=o}},t.prototype.getVecs=function(){return[this.p0.vec,this.pm.vec,this.p1.vec]},t.prototype.isSelectedByWindow=function(e){return!!((0,r.X0)(this.p0.vec,e)&&(0,r.X0)(this.pm.vec,e)&&(0,r.X0)(this.p1.vec,e))},t.prototype.isSelectedByCrossing=function(e){return!!(0,r.X0)(this.p0.vec,e)||!!(0,r.X0)(this.pm.vec,e)||!!(0,r.X0)(this.p1.vec,e)},t.prototype.isMouseInside=function(e,t){return this.interaction.isMouseInside(e,t)},t.prototype.translateByMouseEventData=function(e){this.transformation.translateByMouseEventData(e)},t.prototype.remove=function(e){if(void 0===e&&(e=!0),this.isSelectable=!1,this.isRenderable=!1,this.isRemove=!0,this.p0.deepRemove(),this.p1.deepRemove(),this.pm.deepRemove(),this.scene.removeAArrow(this),this.scene.removeGeometry(this),e){var t=this.toJSON();t&&this.scene.annotationInstance.io.eventListenerAnnotation.removeGeometryStack([t])}},t.prototype.hide=function(){this.interaction.hide()},t.prototype.getNode=function(){var e=[];return e.push(this.p0.vec),e.push(this.pm.vec),e.push(this.p1.vec),e},Object.defineProperty(t.prototype,"isSelected",{get:function(){return this.isSelectedValue},set:function(e){1!=this.numSelectionWhenConstruction++&&(this.scene.capture===this&&this.isMouseInside(this.scene.annotationInstance.activeCommandController.m.x,this.scene.annotationInstance.activeCommandController.m.y)?(this.isSelectedValue=!0,this.p0.isRenderable=!0,this.p1.isRenderable=!0,this.pm.isRenderable=!0):(this.isSelectedValue=e,this.p0.isRenderable=e,this.p1.isRenderable=e,this.pm.isRenderable=e),this.scene.annotationInstance.io.eventListenerAnnotation.selectionStack(this.toJSON()))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isHover",{get:function(){return this.isHoverValue},set:function(e){this.isRemove||!this.isRenderable||this.isHiddenValue||this.isUnderConstruction||(this.isHoverValue=e,(this.isHoverValue&&!this.isHoverPre||!this.isHoverValue&&this.isHoverPre)&&this.scene.annotationInstance.io.eventListenerAnnotation.hoverStack(this.toJSON()),this.isHoverPre=this.isHoverValue,this.isSelectedValue||(this.p0.isRenderable=e,this.p1.isRenderable=e,this.pm.isRenderable=e),e||(this.needEmitHoverPost=!0,this.hidePopUpSummary()))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isHidden",{get:function(){return this.isHiddenValue},set:function(e){this.isHiddenValue=e,this.p0.isHiddenValue=e,this.p0.visibility=0,this.pm.isHiddenValue=e,this.pm.visibility=0,this.p1.isHiddenValue=e,this.p1.visibility=0,this.scene.annotationInstance.io.eventListenerAnnotation.hideStack(this.toJSON())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isCaptured",{get:function(){return this.isCapturedValue},set:function(e){this.isCapturedValue=this.p0.isCapturedValue=this.pm.isCapturedValue=this.p1.isCapturedValue=e},enumerable:!1,configurable:!0}),t.prototype.renderPost=function(e){this.renderer.renderPost(e)},t.prototype.mouseRightClick=function(){if(this.scene.annotationInstance.implementations.app.CONFIG.LAB){this.renderer.isDash=!this.renderer.isDash;var e=this.toJSON();e&&this.scene.annotationInstance.io.eventListenerAnnotation.transformStack([e])}},t.prototype.mouseUp=function(){},t.prototype.toJSON=function(){var e=new p(this.id,this.type,this.isSelectedValue,this.isHoverValue,this.isHiddenValue);e.pushNode(this.getNode());var t=this.styleComponent.toJson();return t&&(e.styles=t),e},t.isDone=!1,t.split=!1,t.condition=new Pt,t}(lt),xt=function(){function e(e){this.offsetForTextDiv=10,this.wrapper=e,this.showTextDiv();var t=[255,0,0,1];this.textCol="rgba("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}return Object.defineProperty(e.prototype,"textCol",{set:function(e){this.divText&&(this.divText.style.color="black")},enumerable:!1,configurable:!0}),e.prototype.updateDiv=function(){if(this.divText){var e=this.wrapper.scene.annotationInstance.customization.themeCurrent.textleaderline.scale,t=(this.wrapper.v1.x-this.wrapper.v0.x)*e*.5;this.divText.style.left=1===e?this.wrapper.vecOffset.x+this.offsetForTextDiv*e-t+"px":this.wrapper.vecOffset.x-t+"px",this.divText.style.top=this.wrapper.vUp.vec.y+Math.abs(this.wrapper.v1.y-this.wrapper.v0.y)-.5*Math.abs(this.wrapper.v1.y-this.wrapper.v0.y)+"px",this.divText.style.top=this.wrapper.v0.y+this.offsetForTextDiv+"px",this.divText.style.width=(this.wrapper.width-2*this.offsetForTextDiv)*e+"px"}this.divTextAnchor&&(this.divTextAnchor.style.top=this.wrapper.v0.y-this.wrapper.offsetForTextEditor+"px",this.divTextAnchor.style.left=this.wrapper.v0.x+"px")},e.prototype.hideTextDiv=function(){this.divText&&this.wrapper.scene.annotationInstance.implementations.app.model.modelViewWrapper.div.removeChild(this.divText),this.divTextAnchor&&this.wrapper.scene.annotationInstance.implementations.app.model.modelViewWrapper.div.removeChild(this.divTextAnchor),this.divText=void 0,this.divTextAnchor=void 0,this.wrapper.scene.annotationInstance.io.eventListenerAnnotation.hideTextStack(this.wrapper.toJSON())},e.prototype.showTextDiv=function(){this.getDivBaseContainer(),this.getDivAnchor(),this.wrapper.isUnderConstruction||this.wrapper.scene.annotationInstance.io.eventListenerAnnotation.showTextStack(this.wrapper.toJSON())},e.prototype.focusOnTextDiv=function(){document.getElementById("text-editor-"+this.wrapper.id)&&(this.wrapper.scene.annotationInstance.io.eventListenerAnnotation.startEditingText(this.wrapper.toJSON()),this.wrapper.scene.annotationInstance.activeCommandController.IsTextEditing=!0)},e.prototype.getDivAnchor=function(){var e=document.createElement("div");return e.id="text-toolbar-"+this.wrapper.id,e.style.position="absolute",e.style.height="0px",e.style.width="0px",e.style.backgroundColor="#00ff00",e.style.top=this.wrapper.v0.y-this.wrapper.offsetForTextEditor+"px",e.style.left=this.wrapper.v0.x+"px",this.divTextAnchor=e,this.wrapper.scene.annotationInstance.implementations.app.model.modelViewWrapper.div.insertBefore(this.divTextAnchor,this.wrapper.scene.annotationInstance.graphicsCoreWrapper.canvasWrapper.aCanvasMask.canvas),e},e.prototype.getDivBaseContainer=function(){var e=this,t=document.createElement("div");return t.id="text-editor-"+this.wrapper.id,t.style.position="absolute",t.style.textOverflow="false",t.style.minWidth=this.wrapper.widthMin-2*this.offsetForTextDiv+"px",t.style.width=this.wrapper.width-2*this.offsetForTextDiv+"px",t.style.left=this.wrapper.v0.x+this.offsetForTextDiv+"px",t.style.top=this.wrapper.v0.y+this.offsetForTextDiv+"px",t.onmousedown=function(){e.wrapper.scene.annotationInstance.implementations.app.model.appCoreWrapper.appControllerStatus.mode===r.An.Drawing&&(e.wrapper.scene.annotationInstance.activeCommandController.IsTextEditing=!0)},t.addEventListener("keydown",(function(n){e.wrapper&&t.clientHeight&&(e.wrapper.height=t.clientHeight,e.wrapper.updateBoundingBox()),t.textContent,e.wrapper.scene.annotationInstance.graphicsCoreWrapper.renderForce()})),this.wrapper.scene.annotationInstance.implementations.app.model.modelViewWrapper.div.insertBefore(t,this.wrapper.scene.annotationInstance.graphicsCoreWrapper.canvasWrapper.aCanvasMask.canvas),this.divText=t,t},e}(),It=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();!function(e){e.CIRCLE="CIRCLE",e.DIAMOND="DIAMOND",e.LEFT="LEFT",e.RIGHT="RIGHT"}(P||(P={}));var bt,Ot=function(){function e(e,t,n,o){void 0===o&&(o=P.CIRCLE),this.r=6,this.diaHeight=6.5,this.diaWidth=6.5,this.isConnected=!0,this.caText=e,this.type=o,this.vec=new r.h9(t,n)}return e.prototype.isMouseInside=function(e,t){return(0,r.Sp)(new r.h9(e,t),this.vec)<this.r+5},e.prototype.updatePos=function(e,t){this.vec.x=e,this.vec.y=t},e.prototype.render=function(e){this.caText.scene.annotationInstance.renderer.draw.shape.text.renderNodeDia(e,this.caText.styleComponent,this.vec.x,this.vec.y,this.diaWidth,this.diaHeight)},e}(),Rt=function(e){function t(t,n,o,i){return void 0===i&&(i=P.CIRCLE),e.call(this,t,n,o,i)||this}return It(t,e),t}(Ot),Lt=function(e){function t(t,n,o,i){return void 0===i&&(i=P.DIAMOND),e.call(this,t,n,o,i)||this}return It(t,e),t}(Ot),Vt=function(){function e(e,t){this.isHover=!0,this.t=0,this.r=2.5,this.isDrag=!1,this.isMouseClick=!1,this.isUpperDia=!1,this.caText=e,this.v0=t.vec,this.vecOffset=new r.h9(0,0),this.v1=new r.h9(this.v0.x,this.v0.y),this.v1Render=new r.h9(this.v0.x,this.v0.y),this.v2=new r.h9(this.v0.x,this.v0.y),this.vecsHistory=[this.v2]}return e.prototype.isMouseInside=function(e,t){var n=new r.h9(e,t);return(0,r.xs)(n,this.v0,this.v1)<10||(0,r.xs)(n,this.v1,this.v2)<10},e.prototype.updateMidV=function(){this.v1.x=this.v0.x,this.v1.y=this.v2.y,this.v1Render.x=this.caText.vecOffset.x,this.v1Render.y=this.caText.vec.y},e.prototype.updateTransformationStack=function(){(0,r.Sp)(this.v2,new r.h9(this.caText.mouseX,this.caText.mouseY))<this.r&&(this.caText.scene.annotationInstance.activeCommandController.acProperties.isDown||this.isMouseClick||(this.caText.scene.annotationInstance.io.eventListenerAnnotation.transformStack([this.caText.toJSON()]),this.isMouseClick=!0),this.caText.scene.annotationInstance.activeCommandController.acProperties.isDown&&(this.isMouseClick=!1))},Object.defineProperty(e.prototype,"v2",{get:function(){return this._v2},set:function(e){this._v2=e},enumerable:!1,configurable:!0}),e.prototype.renderLeaderLine=function(e){this.v0=this.caText.vecOffset,this.v2=this.caText.vec,this.isDrag&&(this.isDrag=!1,this.v2=(0,r.p$)(this.vecsHistory[this.vecsHistory.length-1])),this.updateMidV(),this.caText.scene.annotationInstance.renderer.draw.shape.text.renderLeaderLine(e,this.caText.styleComponent,this.caText.vecOffset,this.v1Render,this.v2,this.t,this.isUpperDia,this.caText.isHoverValue,this.caText.isSelectedValue),this.t+=.1},e}(),kt=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Nt=function(e){function t(t){var n=e.call(this,t)||this;return n._isSelectedReaderline=!1,n.wrapper=t,n}return kt(t,e),Object.defineProperty(t.prototype,"IsSelected",{get:function(){return this.wrapper.isSelectedValue},set:function(e){this.wrapper.isSelectedValue=e,this.wrapper.scene.annotationInstance.io.eventListenerAnnotation.selectionStack(this.wrapper.toJSON())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"IsSelectedReaderline",{get:function(){return this._isSelectedReaderline},set:function(e){this._isSelectedReaderline=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"IsHover",{get:function(){return this.wrapper.isHoverValue},set:function(e){this.wrapper.isRemove||!this.wrapper.isRenderable||this.wrapper.isHiddenValue||(this.wrapper.isHoverValue=e,this.wrapper.leaderline&&(this.wrapper.leaderline.isHover=e),(this.wrapper.isHoverValue&&!this.wrapper.isHoverPre||!this.wrapper.isHoverValue&&this.wrapper.isHoverPre)&&this.wrapper.scene.annotationInstance.io.eventListenerAnnotation.hoverStack(this.wrapper.toJSON()),this.wrapper.isHoverPre=this.wrapper.isHoverValue,e||(this.wrapper.needEmitHoverPost=!0,this.wrapper.hidePopUpSummary()))},enumerable:!1,configurable:!0}),t.prototype.translateByMouseEventData=function(e){if(this.wrapper.mouseX=e.x,this.wrapper.mouseY=e.y,this.wrapper.isRenderable&&!this.wrapper.isHiddenValue&&!this.wrapper.enableEditValue&&this.wrapper.enableDrag)if(this.wrapper.isRenderCollapse)this.translateByMouseEventDataCollapse(e);else{var t=e.x-e.preX,n=e.y-e.preY,o=!1;if(this.wrapper.nodeSelected){if(this.wrapper.width=this.wrapper.v1.x-this.wrapper.v0.x,this.wrapper.nodeSelected.type===P.LEFT?(this.wrapper.width-t>this.wrapper.widthMin+2?this.wrapper.v0.x+=t:this.wrapper.v0.x-=2,o=!0):this.wrapper.nodeSelected.type===P.RIGHT&&(this.wrapper.width+t>this.wrapper.widthMin+2?this.wrapper.v1.x+=t:this.wrapper.v1.x+=2,o=!0),this.wrapper.nodeSelected.type===P.DIAMOND)return this.wrapper.attachedShape&&(this.wrapper.attachedShape.textLeaderline&&(this.wrapper.attachedShape.textLeaderline=void 0),this.wrapper.attachedShape=void 0),this.wrapper.leadlineInteraction(e.x,e.y),this.wrapper.leaderline&&this.wrapper.vUp.isConnected&&(this.wrapper.vecOffset.x=this.wrapper.v0.x+.5*(this.wrapper.v1.x-this.wrapper.v0.x),this.wrapper.vecOffset.y=this.wrapper.v1.y,this.wrapper.widthOffset=this.wrapper.vecOffset.x-this.wrapper.vec.x,this.wrapper.heightOffset=this.wrapper.vecOffset.y-this.wrapper.vec.y),this.wrapper.computeCenterVec(),void this.wrapper.updateBoundingBox()}else{if(this.wrapper.nodeTargetLeaderLine)return this.updateLeaderlineTarget(e.x,e.y),this.wrapper.vecOffset.x=this.wrapper.v0.x+.5*(this.wrapper.v1.x-this.wrapper.v0.x),this.wrapper.vecOffset.y=this.wrapper.v0.y+.5*(this.wrapper.v1.y-this.wrapper.v0.y),this.wrapper.widthOffset=this.wrapper.vecOffset.x-this.wrapper.vec.x,this.wrapper.heightOffset=this.wrapper.vecOffset.y-this.wrapper.vec.y+.5*this.wrapper.height,this.wrapper.computeCenterVec(),this.wrapper.updateVecsBox(),void this.wrapper.updateBoundingBox();this.wrapper.v0.x+=t,this.wrapper.v0.y+=n,this.wrapper.v1.x+=t,this.wrapper.v1.y+=n}o?this.wrapper.leaderline?(this.wrapper.vecOffset.x=this.wrapper.v0.x+.5*(this.wrapper.v1.x-this.wrapper.v0.x),this.wrapper.widthOffset=this.wrapper.vecOffset.x-this.wrapper.vec.x):(this.wrapper.vec.x=this.wrapper.v0.x+.5*(this.wrapper.v1.x-this.wrapper.v0.x),this.wrapper.vecOffset.x=this.wrapper.v0.x+.5*(this.wrapper.v1.x-this.wrapper.v0.x),this.wrapper.widthOffset=0,this.wrapper.heightOffset=0):this.wrapper.leaderline?(this.wrapper.vecOffset.x=this.wrapper.v0.x+.5*(this.wrapper.v1.x-this.wrapper.v0.x),this.wrapper.vecOffset.y=this.wrapper.v0.y+.5*(this.wrapper.v1.y-this.wrapper.v0.y),this.wrapper.widthOffset=this.wrapper.vecOffset.x-this.wrapper.vec.x,this.wrapper.heightOffset=this.wrapper.vecOffset.y-this.wrapper.vec.y+.5*this.wrapper.height,this.wrapper.updateVecsBox()):(this.wrapper.vec.x+=t,this.wrapper.vec.y+=n,this.wrapper.vecOffset.x+=this.wrapper.vec.x,this.wrapper.vecOffset.y+=this.wrapper.vec.y,this.wrapper.widthOffset=0,this.wrapper.heightOffset=0,this.wrapper.updateVecsBox()),this.wrapper.computeCenterVec(),this.wrapper.txtDiv.updateDiv(),this.updateSideNodes(),this.updateConectNodes(),this.wrapper.updateBoundingBox()}},t.prototype.translateByMouseEventDataCollapse=function(e){var t=e.x-e.preX,n=e.y-e.preY;this.wrapper.leaderline?(this.wrapper.vecOffset.x+=t,this.wrapper.vecOffset.y+=n,this.wrapper.widthOffset+=t,this.wrapper.heightOffset+=n,this.updateSideNodes()):(this.wrapper.widthOffset=0,this.wrapper.heightOffset=0,this.wrapper.vecOffset.x+=t,this.wrapper.vecOffset.y+=n,this.wrapper.vec.x+=t,this.wrapper.vec.y+=n),this.wrapper.updateVecsBox(),this.wrapper.updateBoundingBox()},t.prototype.mouseLeftClick=function(e,t){if(this.wrapper.scene.captureText=this.wrapper,this.wrapper.isCollapse)return this.wrapper.collision.isCollided=!1,this.wrapper.isCollapse=!1,void this.wrapper.txtDiv.focusOnTextDiv();this.wrapper.IsSelectedReaderline?this.wrapper.isSelectedReaderlineByClick=!0:this.wrapper.isSelectedReaderlineByClick=!1,this.wrapper.isSelectedReaderlineByClick||this.wrapper.isMouseInsideDiv(e,t)&&this.wrapper.txtDiv.focusOnTextDiv()},t.prototype.mouseUp=function(){this.wrapper.snapForPoint()},t.prototype.mouseDoubleClick=function(){this.wrapper.isEditiable=!this.wrapper.isEditiable},t.prototype.isMouseInside=function(e,t){return this.wrapper.isRenderCollapse?(0,r.Sp)(new r.h9(e,t),this.geo.vec)<15?(this.wrapper.isHover=!0,!0):(this.wrapper.isHover=!1,!1):this.wrapper.scene.annotationInstance.implementations.app.model.appCoreWrapper.appControllerStatus.mode===r.An.Drawing&&(this.isMouseInsideLeaderline(e,t)||this.isMouseInsideNodes(e,t)?(this.wrapper.IsSelectedReaderline=!0,this.wrapper.isHover=!0,!0):(this.wrapper.IsSelectedReaderline=!1,(0,r.mp)(new r.h9(e,t),this.wrapper.v0,this.wrapper.v1)?(this.wrapper.isHover=!0,!0):(this.wrapper.isHover=!1,!1)))},t.prototype.isMouseInsideDiv=function(e,t){if(this.wrapper.isRenderCollapse)return!1;var n=[new r.h9(this.wrapper.v0.x+this.wrapper.offDiv,this.wrapper.v0.y+this.wrapper.offDiv),new r.h9(this.wrapper.v0.x+this.wrapper.width-this.wrapper.offDiv,this.wrapper.v0.y+this.wrapper.offDiv),new r.h9(this.wrapper.v0.x+this.wrapper.width-this.wrapper.offDiv,this.wrapper.v0.y+this.wrapper.height-this.wrapper.offDiv),new r.h9(this.wrapper.v0.x+this.wrapper.offDiv,this.wrapper.v0.y+this.wrapper.height-this.wrapper.offDiv)];return!!(0,r.X0)(new r.h9(e,t,0),n)},t.prototype.updateLeaderlineTarget=function(e,t){void 0!==this.wrapper.nodeTargetLeaderLine&&(this.wrapper.nodeTargetLeaderLine.x=e,this.wrapper.nodeTargetLeaderLine.y=t,this.wrapper.nodeTargetLeaderLine.x=e,this.wrapper.nodeTargetLeaderLine.y=t)},t.prototype.isMouseInsideLeaderline=function(e,t){if(this.wrapper.leaderline){if(this.wrapper.leaderline.isMouseInside(e,t))return this.wrapper.nodeTargetLeaderLine=this.wrapper.leaderline.v2,this.wrapper.leaderline.isHover=!0,!0;this.wrapper.leaderline.isHover=!1}return this.wrapper.nodeTargetLeaderLine=void 0,!1},t.prototype.updateSideNodes=function(){this.wrapper.vLeft.updatePos(this.wrapper.v0.x,this.wrapper.v0.y+.5*this.wrapper.height),this.wrapper.vRight.updatePos(this.wrapper.v1.x,this.wrapper.v0.y+.5*this.wrapper.height)},t.prototype.updateConectNodes=function(){this.wrapper.vUp.updatePos(this.wrapper.v0.x+.5*this.wrapper.width,this.wrapper.v0.y),this.wrapper.vDown.updatePos(this.wrapper.v0.x+.5*this.wrapper.width,this.wrapper.v1.y)},t.prototype.isMouseInsideNodes=function(e,t){this.wrapper.nodeSelected=void 0;for(var n=0;n<this.wrapper.nodes.length;++n)if(this.wrapper.nodes[n].isMouseInside(e,t))return this.wrapper.nodeSelected=this.wrapper.nodes[n],!0;return!1},t.prototype.leadlineInteraction=function(e,t){this.wrapper.leaderline?(this.wrapper.vec.x=e,this.wrapper.vec.y=t,this.wrapper.widthOffset=this.wrapper.vecOffset.x-this.wrapper.vec.x,this.wrapper.heightOffset=this.wrapper.vecOffset.y-this.wrapper.vec.y):this.wrapper.leaderline=new Vt(this.wrapper,this.wrapper.getClosestNodeDia(e,t))},t}(dt),Et=function(){function e(e){this.wrapper=e}return e.prototype.toJSON=function(){var e=new p(this.wrapper.id,r.zq.TEXT_LEADERLINE,this.wrapper.isSelectedValue,this.wrapper.isHoverValue,this.wrapper.isHiddenValue);0!==this.wrapper.widthOffset||0!==this.wrapper.heightOffset?e.pushNode([this.wrapper.vec,new r.h9(this.wrapper.widthOffset,this.wrapper.heightOffset)]):e.pushNode([this.wrapper.vec]),e.data={content:this.wrapper.contentHtmltemp,width:this.wrapper.width,height:this.wrapper.height,version:2,zoom:this.wrapper.renderer.zoomLevel};var t=this.wrapper.styleComponent.toJson();return t&&(e.styles=t),e},e.prototype.getLog=function(){return"GUID : "+this.wrapper.id+"/TYPE : "+this.wrapper.type.toString()+"/Screen : SIZE : "+this.wrapper.r+" pixel/IsCap :"+this.wrapper.isCapturedValue+"/IsSEL : "+this.wrapper.isSelectedValue+"/IsHid : "+this.wrapper.isHiddenValue+"/IsDeg : "+this.wrapper.isDrag+"/isSelable : "+this.wrapper.isSelectable+"/hasLeaderline : "+this.wrapper.leaderline},e.prototype.processingUpdate=function(e){var t=JSON.parse(e);t.content&&(this.wrapper.contentHtmltemp=t.content),this.wrapper.scene.annotationInstance.io.eventListenerAnnotation.updateStack(this.toJSON())},e.prototype.deepCopy=function(e,t,n){void 0===n&&(n=0);var o=this.toJSON();if(o){var i=this.wrapper.fromJSON(o,!0,!0);return i.move(e,t),i.isHover=!1,i.emitAddStack(),i}},e.prototype.remove=function(e){if(void 0===e&&(e=!0),this.wrapper.scene.annotationInstance.implementations.app.model.appCoreWrapper.appControllerStatus.drawing){if(this.wrapper.attachedShape&&(this.wrapper.attachedShape.textLeaderline=void 0),this.wrapper.isSelectedReaderlineByClick)return this.wrapper.leaderline=void 0,this.wrapper.isSelected=!1,void this.wrapper.scene.annotationInstance.io.eventListenerAnnotation.transformStack([this.toJSON()]);if(!this.wrapper.scene.annotationInstance.activeCommandController.acProperties.isTextEditing){if(this.wrapper.removeDiv(),e){var t=this.toJSON();t&&(this.wrapper.scene.annotationInstance.io.eventListenerAnnotation.hideTextStack(t),this.wrapper.scene.annotationInstance.io.eventListenerAnnotation.removeGeometryStack([t]))}this.wrapper.scene.removeATextleaderlineWrapper(this.wrapper),this.wrapper.scene.removeGeometry(this.wrapper)}}},e.prototype.removeByAttachedShape=function(){this.wrapper.leaderline=void 0,this.wrapper.attachedShape&&(this.wrapper.attachedShape.textLeaderline=void 0,this.wrapper.attachedShape=void 0),this.resetAnchorVec(),this.wrapper.scene.annotationInstance.io.eventListenerAnnotation.transformStack([this.toJSON()])},e.prototype.RemoveLeaderline=function(){this.wrapper.leaderline=void 0,this.wrapper.attachedShape&&(this.wrapper.attachedShape.textLeaderline=void 0,this.wrapper.attachedShape=void 0),this.resetAnchorVec(),this.wrapper.scene.annotationInstance.io.eventListenerAnnotation.transformStack([this.toJSON()])},e.prototype.removeDiv=function(){try{this.wrapper.scene.annotationInstance.implementations.app.model.modelViewWrapper.div&&(this.wrapper.txtDiv.divText&&this.wrapper.scene.annotationInstance.implementations.app.model.modelViewWrapper.div.removeChild(this.wrapper.txtDiv.divText),this.wrapper.txtDiv.divTextAnchor&&this.wrapper.scene.annotationInstance.implementations.app.model.modelViewWrapper.div.removeChild(this.wrapper.txtDiv.divTextAnchor))}catch(e){}},e.prototype.resetAnchorVec=function(){this.wrapper.widthOffset=0,this.wrapper.heightOffset=0,this.wrapper.vUp.isConnected&&(this.wrapper.vecOffset.y+=this.wrapper.height),this.wrapper.vec.x=this.wrapper.vecOffset.x,this.wrapper.vec.y=this.wrapper.vecOffset.y,this.wrapper.updateVecs()},e}(),_t=function(){function e(e){this.wrapper=e}return e.prototype.outExtent=function(){this.wrapper.updateScreenVecForPan(),this.wrapper.isInsideExtent&&(this.wrapper.txtDiv.hideTextDiv(),this.wrapper.isInsideExtent=!1)},e.prototype.inExtent=function(){this.wrapper.isInsideExtent||(this.wrapper.txtDiv.showTextDiv(),this.wrapper.isInsideExtent=!0)},e}(),Tt=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Dt=function(e){function t(t){var n=e.call(this,t)||this;return n.zoomLevel=0,n.zoomDifference=0,n.hasSnippet=!1,n.scaleRuntime=0,n.widthRuntime=0,n.heightRuntime=0,n.v0Runtime=new r.h9(0,0,0),n.wrapper=t,n}return Tt(t,e),t.prototype.renderPost=function(e){this.scaleRuntime=1,this.widthRuntime=(this.wrapper.v1.x-this.wrapper.v0.x)*this.scaleRuntime,this.heightRuntime=Math.abs(this.wrapper.v1.y-this.wrapper.v0.y),this.v0Runtime.x=this.wrapper.vecOffset.x-.5*this.widthRuntime,this.v0Runtime.y=this.wrapper.vUp.vec.y,this.wrapper.isRenderCollapse?this.renderSnippet(e,this.widthRuntime,this.heightRuntime):(this.wrapper.scene.annotationInstance.renderer.draw.shape.text.roundedRectACTextStoryMapByWidth(e,this.wrapper.styleComponent,this.v0Runtime,this.widthRuntime,this.heightRuntime,3,0,0,this.wrapper.isHoverValue,this.wrapper.isSelectedValue),this.wrapper.scene.annotationInstance.interactionMode===r.An.Drawing&&(this.wrapper.isHover||this.wrapper.isSelected)&&this.renderNodes(e))},t.prototype.renderSnippet=function(e,t,n){this.wrapper.isHover?(this.wrapper.txtDiv.divText&&this.wrapper.txtDiv.divText.hidden&&(this.wrapper.txtDiv.divText.hidden=!1),this.hasSnippet=!0,this.wrapper.leaderline&&(this.wrapper.findClosestNodeDia(),this.wrapper.leaderline.renderLeaderLine(e)),this.wrapper.scene.annotationInstance.renderer.draw.shape.text.roundedRectACTextStoryMapByWidth(e,this.wrapper.styleComponent,this.v0Runtime,t,n,3,0,0,this.wrapper.isHoverValue,this.wrapper.isSelectedValue)):(this.wrapper.txtDiv.divText&&!this.wrapper.txtDiv.divText.hidden&&(this.wrapper.txtDiv.divText.hidden=!0),this.hasSnippet=!1)},t.prototype.renderLeadline=function(e){this.wrapper.isRenderCollapse?this.renderMarker(e):this.wrapper.leaderline&&(this.wrapper.findClosestNodeDia(),this.wrapper.leaderline.renderLeaderLine(e))},t.prototype.renderNodes=function(e){this.wrapper.vLeft.render(e),this.wrapper.vRight.render(e),this.wrapper.vUp.render(e),this.wrapper.vDown.render(e)},t.prototype.renderMarker=function(e){if(!this.hasSnippet){var t=this.wrapper.vec;e.beginPath(),e.arc(t.x,t.y,7,0,6.28),e.closePath();var n=this.wrapper.styleComponent.styleAnchorNode.fillStyle;e.fillStyle="rgba("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+")",e.fill(),e.lineWidth=this.wrapper.styleComponent.styleAnchorNode.lineWidth,n=this.wrapper.styleComponent.styleAnchorNode.strokeStyle,e.strokeStyle="rgba("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+")",e.stroke()}},t}(C),Mt=function(){this.width=36,this.height=28,this.scale=1,this.fillStyleFirstArray=[0,0,0,0],this.fillStyleSecondArray=[0,0,0,0],this.lineWidth=1,this.shadowColor="rgba(0 ,0 ,0 , 0.5)",this.shadowColorHover="rgba(0 ,0 ,0 , 1.0)",this.shadowBlur=5},zt=function(){this.width=36,this.height=28,this.fontSize=9,this.fontColorArray=[0,0,0,0],this.scale=1,this.fillStyleFirstArray=[0,0,0,0],this.fillStyleSecondArray=[0,0,0,0],this.strokeStyleFirstArray=[0,0,0,0],this.lineWidth=1,this.shadowColor="rgba(0 ,0 ,0 , 0.5)",this.shadowColorHover="rgba(0 ,0 ,0 , 1.0)",this.shadowBlur=5},Gt=function(){this.scale=1,this.fillStyleFirstArray=[0,0,0,0],this.fillStyleSecondArray=[0,0,0,0],this.strokeStyleFirstArray=[0,0,0,0],this.lineWidth=1},Wt=function(){this.fillStyleFirstArray=[0,0,0,0],this.fillStyleSecondArray=[0,0,0,0],this.strokeStyleFirstArray=[0,0,0,0],this.strokeStyleSecondArray=[0,0,0,0],this.lineWidth=1,this.lineDash=[0,0],this.scale=1},Bt=function(){this.strokeStyleFirstArray=[0,0,0,0],this.strokeStyleSecondArray=[0,0,0,0],this.lineWidth=1},Ht=function(){this.fillStyleFirstArray=[0,0,0,0],this.fillStyleSecondArray=[0,0,0,0],this.strokeStyleFirstArray=[0,0,0,0],this.strokeStyleSecondArray=[0,0,0,0],this.lineWidth=1},Ft=function(){function e(){this.strokeStyle=[0,0,0,1],this.lineWidth=2,this._dash=[0,0]}return Object.defineProperty(e.prototype,"dash",{get:function(){return this._dash},set:function(e){this._dash=e},enumerable:!1,configurable:!0}),e}(),Ut=function(){this.fillStyle=[0,0,0,1],this.strokeStyle=[0,0,0,1],this.lineWidth=2,this.radius=5,this.dash=[0,0]},jt=function(){this.fillStyle=[0,0,0,1],this.strokeStyle=[100,100,100,1],this.lineWidth=2,this.dash=[0,0]},qt=function(){this.fillStyle=[20,20,20,1],this.strokeStyle=[0,0,0,1],this.lineWidth=2,this.dash=[0,0]},Jt=function(){this.fillStyleFirstArray=[0,0,0,0],this.fillStyleSecondArray=[0,0,0,0],this.strokeStyleFirstArray=[0,0,0,0],this.handleNode=new jt,this.box=new qt,this.anchorNode=new Ut,this.leaderline=new Ft,this.scale=1},Yt=function(){this.size=8,this.lineWidth=6,this.sizeMid=2,this.lineWidthMid=2},Xt=function(){this.elasticScale=3.5,this.pointBoundOffset=8,this.outlineHoverColorArray=[0,0,0,0],this.outlineHoverColorRGBAString="rgba(255,255,255,1.0)",this.maskColor="#000000",this.isDarkBG=!1,this.opacity=.6,this.opacityHover=.7,this.desaturationValue=-.3,this.timeTransitionA=.015,this.timeTransitionB=.015},Kt=function(){this.fillStyleFirstArray=[0,0,0,0],this.strokeStyleFirstArray=[0,0,0,0]},$t=function(){this.fillStyleFirstArray=[0,0,0,0],this.strokeStyleFirstArray=[0,0,0,0],this.lineWidth=1},Qt=function(){function e(){this.rPoint=new Mt,this.nPoint=new zt,this.iPoint=new Gt,this.arrow=new Wt,this.polyline=new Bt,this.polygon=new Ht,this.properties=new Xt,this.selection=new Kt,this.freehand=new $t,this.node=new Yt,this.textleaderline=new Jt}return e.prototype.toJson=function(){return JSON.parse(JSON.stringify(this))},e.prototype.downloadJson=function(e){void 0===e&&(e="AnnotationTheme.json"),new r.QH(this.toJson(),e).dummy()},e}(),Zt=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),en=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.textColor=s.BackgroundColor,t.backgroundColor=s.TitleColor,t}return Zt(t,e),t}(I),tn=function(e){function t(t){var n=e.call(this,t)||this;return n.state=new en,n.updateStyle(),n}return Zt(t,e),t.prototype.updateStyle=function(){var e=this.geo.scene.annotationInstance.customization.themeCurrent.textleaderline;this.styleBox||(this.styleBox=new qt,this.styleBox.dash=[0,0],this.styleBox.fillStyle=e.box.fillStyle,this.styleBox.lineWidth=e.box.lineWidth,this.styleBox.strokeStyle=e.box.strokeStyle),this.styleAnchorNode||(this.styleAnchorNode=new Ut,this.styleAnchorNode.dash=[0,0],this.styleAnchorNode.fillStyle=e.anchorNode.fillStyle,this.styleAnchorNode.lineWidth=e.anchorNode.lineWidth,this.styleAnchorNode.strokeStyle=e.anchorNode.strokeStyle),this.styleHandleNode||(this.styleHandleNode=new jt,this.styleHandleNode.dash=[0,0],this.styleHandleNode.fillStyle=e.handleNode.fillStyle,this.styleHandleNode.lineWidth=e.handleNode.lineWidth,this.styleHandleNode.strokeStyle=e.handleNode.strokeStyle),this.styleLeaderline||(this.styleLeaderline=new Ft,this.styleLeaderline.dash=[0,0],this.styleLeaderline.lineWidth=e.leaderline.lineWidth,this.styleLeaderline.strokeStyle=e.leaderline.strokeStyle)},t.prototype.updateStyleCustom=function(e){var t=!1;return void 0!==e.box&&(this.styleBox.dash=e.box.dash?e.box.dash:this.styleBox.dash,this.styleBox.fillStyle=e.box.fill?e.box.fill:this.styleBox.fillStyle,this.styleBox.lineWidth=e.box.width?e.box.width:this.styleBox.lineWidth,this.styleBox.strokeStyle=e.box.strokeStyle?e.box.strokeStyle:this.styleBox.strokeStyle,t=!0),void 0!==e.anchorNode&&(this.styleAnchorNode.dash=e.anchorNode.dash?e.anchorNode.dash:this.styleAnchorNode.dash,this.styleAnchorNode.fillStyle=e.anchorNode.fill?e.anchorNode.fill:this.styleAnchorNode.fillStyle,this.styleAnchorNode.lineWidth=e.anchorNode.width?e.anchorNode.width:this.styleAnchorNode.lineWidth,this.styleAnchorNode.strokeStyle=e.anchorNode.strokeStyle?e.anchorNode.strokeStyle:this.styleAnchorNode.strokeStyle,t=!0),void 0!==e.handleNode&&(this.styleHandleNode.dash=e.handleNode.dash?e.handleNode.dash:this.styleHandleNode.dash,this.styleHandleNode.fillStyle=e.handleNode.fill?e.handleNode.fill:this.styleHandleNode.fillStyle,this.styleHandleNode.lineWidth=e.handleNode.width?e.handleNode.width:this.styleHandleNode.lineWidth,this.styleHandleNode.strokeStyle=e.handleNode.strokeStyle?e.handleNode.strokeStyle:this.styleHandleNode.strokeStyle,t=!0),void 0!==e.leaderline&&(this.styleLeaderline.dash=e.leaderline.dash?e.leaderline.dash:this.styleLeaderline.dash,this.styleLeaderline.lineWidth=e.leaderline.width?e.leaderline.width:this.styleLeaderline.lineWidth,this.styleLeaderline.strokeStyle=e.leaderline.strokeStyle?e.leaderline.strokeStyle:this.styleLeaderline.strokeStyle,t=!0),this.state.width=e.width||this.state.width,this.tempColorRgba=e.colorRgba||this.tempColorRgba,this.state.scale=e.scale||this.state.scale,void 0!==e.textColor&&(this.state.textColor=e.textColor),void 0!==e.backgroundColor&&(this.state.backgroundColor=e.backgroundColor),e.lineDash&&(this.state.lineTypeId=e.lineDash),this.isCustom=!0,t&&!this.geo.isUnderConstruction&&(this.geo.isTransform=!0),!0},t.prototype.toJson=function(){if(this.isCustom){var e={box:{dash:this.styleBox.dash,fill:this.styleBox.fillStyle,width:this.styleBox.lineWidth,strokeStyle:this.styleBox.strokeStyle},anchorNode:{dash:this.styleAnchorNode.dash,fill:this.styleAnchorNode.fillStyle,width:this.styleAnchorNode.lineWidth,strokeStyle:this.styleAnchorNode.strokeStyle},handleNode:{dash:this.styleHandleNode.dash,fill:this.styleHandleNode.fillStyle,width:this.styleHandleNode.lineWidth,strokeStyle:this.styleHandleNode.strokeStyle},leaderline:{dash:this.styleLeaderline.dash,width:this.styleLeaderline.lineWidth,strokeStyle:this.styleLeaderline.strokeStyle},width:this.state.width,scale:this.state.scale,colorRgba:this.tempColorRgba};return this.state.backgroundColor!==s.TitleColor&&(e.backgroundColor=this.state.backgroundColor),this.state.textColor!==s.BackgroundColor&&(e.textColor=this.state.textColor),this.state.lineTypeId!==i.Continuous&&(e.lineDash=this.state.lineTypeId),e}},t}(b),nn=function(){function e(e){this.host=e}return e.prototype.update=function(e){this.host.scene.annotationInstance.implementations.app.INSPECTION&&(e.font="10px Arial",this.host.collision.isRenderable=!0,this.showStatus(e),this.showVecOffset(e),this.showVecBound(e),this.showLeaderlineInfo(e),this.showLeaderlinePos(e),this.host.collision.render(e))},e.prototype.showLeaderlinePos=function(e){this.host.vec&&(e.beginPath(),e.arc(this.host.vec.x,this.host.vec.y,6.5,0,6.28),e.closePath(),e.fillStyle="#ff0000",e.fill())},e.prototype.showStatus=function(e){var t=this.host.v1;e.beginPath(),e.arc(t.x,t.y,5,0,6.28),e.closePath(),e.fillStyle="#ff0000",e.fill();var n="IsTransform: "+this.host.isTransform;e.fillText(n,t.x+10,t.y-10),n=", Zoom: "+this.host.renderer.zoomLevel,e.fillText(n,t.x+100,t.y-10)},e.prototype.ShowVecCenter=function(e){var t=this.host.vecCenter;e.beginPath(),e.arc(t.x,t.y,5,0,6.28),e.closePath(),e.fillStyle="#fff000",e.fill();var n=""+t.x,o=""+t.y;e.fillText(n,t.x,t.y+10),e.fillText(o,t.x,t.y+24)},e.prototype.showVecBound=function(e){var t=this.host.v0;e.beginPath(),e.arc(t.x,t.y,5,0,6.28),e.closePath(),e.fillStyle="#00ff00",e.fill();var n=""+t.x,o=""+t.y;e.fillText(n,t.x,t.y+10),e.fillText(o,t.x,t.y+24);var i=this.host.v1;e.beginPath(),e.arc(i.x,i.y,5,0,6.28),e.closePath(),e.fillStyle="#00ff00",e.fill(),n=""+i.x,o=""+i.y,e.fillText(n,i.x,i.y+10),e.fillText(o,i.x,i.y+24)},e.prototype.showVecAnchor=function(e){var t=this.host.vec;e.beginPath(),e.arc(t.x,t.y,2.5,0,6.28),e.closePath(),e.fillStyle="#ff0000",e.fill();var n=""+t.x,o=""+t.y;e.fillText(n,t.x,t.y+10),e.fillText(o,t.x,t.y+24)},e.prototype.showVecOffset=function(e){var t=this.host.vecOffset;e.beginPath(),e.arc(t.x,t.y,2.5,0,6.28),e.closePath(),e.fillStyle="#0000ff",e.fill();var n=""+t.x,o=""+t.y;e.fillText(n,t.x,t.y+10),e.fillText(o,t.x,t.y+24)},e.prototype.showLeaderlineInfo=function(e){var t=this.host.v1;e.beginPath(),e.arc(t.x,t.y,2.5,0,6.28),e.closePath(),e.fillStyle="#ff0000",e.fill();var n=""+this.host.leaderline;e.fillText(n,t.x,t.y-60),this.host.attachedShape?e.fillText(this.host.attachedShape.type,t.x,t.y-50):e.fillText("None",t.x,t.y-50)},e}(),on=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),sn=function(e){function t(t,n,o,i,s,a,h){void 0===i&&(i=170),void 0===s&&(s=40),void 0===a&&(a=!1),void 0===h&&(h="Start typing here.");var c=e.call(this,t)||this;return c.widthOffset=0,c.heightOffset=0,c.widthMin=80,c.offDiv=10,c.isSelectedReaderlineByClick=!1,c.enableDrag=!0,c.nodeSelected=void 0,c.leaderline=void 0,c.nodeTargetLeaderLine=void 0,c.offsetForTextEditor=20,c.lineWidthForCheck=5,c.mouseX=0,c.mouseY=0,c.numToggleTheme=0,c.attachedShape=void 0,c.isRenderCollapse=!1,c.inspector=new nn(c),c.isUndo=a,c.type=r.zq.TEXT_LEADERLINE,c.vec=new r.h9(n,o),c.vecOffset=new r.h9(c.vec.x,c.vec.y),c.v0=new r.h9(c.vec.x-.5*c.width,c.vec.y-c.height),c.v1=new r.h9(c.vec.x+.5*c.width,c.vec.y),c.initComponent(),c.initZoomLevel(),c.computeCenterVec(),c.txtDiv=new xt(c),c.txtDiv.divText&&(c._heightPre=c.txtDiv.divText.clientHeight),c.width=i,c.height=s,c.vLeft=new Rt(c,c.v0.x,c.v0.y+.5*c.height,P.LEFT),c.vRight=new Rt(c,c.v1.x,c.v0.y+.5*c.height,P.RIGHT),c.vUp=new Lt(c,c.v0.x+.5*c.width,c.v0.y,P.DIAMOND),c.vDown=new Lt(c,c.v0.x+.5*c.width,c.v0.y+c.height,P.DIAMOND),c.nodes=[c.vLeft,c.vRight,c.vUp,c.vDown],c.trajectoryVecs=[],c.initVecsHistory(),c.visTrajector=!0,c.isDrop=!1,c.isDrag=!1,c.isSelectedValue=!1,c.isLeave=!0,c.isHoverValue=!1,c.isGeoPos=!0,c.isUnderConstruction=!1,c.collision.offset=1,c.updateVecs(),c.updateBoundingBox(),c.scene.addATextleaderlineWrapper(c),c.isUndo||(c.scene.annotationInstance.io.eventListenerAnnotation.addGeometryStack(c.toJSON()),c.txtDiv.hideTextDiv(),c.txtDiv.showTextDiv(),c.txtDiv.focusOnTextDiv()),c}return on(t,e),t.fromSmartDrawing=function(e,n){var o=n[n.length-1],i=n[0],s=new t(e,o.x,o.y,170,40,!1);s.leadlineInteraction(i.x,i.y),s.leadlineInteraction(i.x,i.y),s.leaderline,s.isHover=!1,s.interaction.updateSideNodes(),s.interaction.updateConectNodes(),s.txtDiv.updateDiv()},t.fromJSON=function(e,n,o,i){void 0===o&&(o=!1),void 0===i&&(i=!1);var s=[n.nodes[0].sx,n.nodes[0].sy],r=n.data.content,a=n.data.width?n.data.width:170,h=n.data.height?n.data.height:40,c=new t(e,s[0],s[1],a,h,o,r);return n.nodes[1]&&c.initLeaderlineOffset(n.nodes[1].sx,n.nodes[1].sy),c.contentHtmltemp=r,n.data.zoom&&c.initZoomLevel(n.data.zoom),c.isUnderConstruction=!0,n.styles&&c.updateStyleCustom(n.styles),c.isUnderConstruction=!1,c.id=i?e.getUUID():n.id,c.txtDiv.divText&&(c.txtDiv.divText.id="text-editor-"+c.id),c.isHiddenValue=n.isHidden,n.isHidden?c.visibilityValue=0:c.visibilityValue=1,c.computeCenterVec(),c.txtDiv.updateDiv(),c.updateVecs(),o&&e.annotationInstance.io.eventListenerAnnotation.showTextStack(c.toJSON()),c.isSelected=!1,c.isHover=!1,c.isTransform=!1,c.initVecsHistory(),c.initHeightFromJSON(h),c},t.mouseLeftClick=function(e,n){if(void 0===e.capture){e.annotationInstance.activeCommandController.goToACMode();var o=new t(e,n.x,n.y);o.isSelected=!0,e.Capture=o,o.dummy()}},t.mouseMove=function(e){},t.ESC=function(){},t.prototype.emitTransformationStackRightNode=function(){for(var e=0;e<this.nodes.length;++e)this.nodes[e].type,P.RIGHT},t.prototype.updateVecsBox=function(){this.leaderline?(this.renderer.zoomDifference,this.vecOffset.x=this.vec.x+this.widthOffset,this.vecOffset.y=this.vec.y+this.heightOffset):(this.vecOffset.x=this.vec.x,this.vecOffset.y=this.vec.y),this.v0.x=this.vecOffset.x-.5*this.width,this.v0.y=this.vecOffset.y-this.height,this.v1.x=this.vecOffset.x+.5*this.width,this.v1.y=this.vecOffset.y,this.interaction.updateSideNodes(),this.interaction.updateConectNodes()},t.prototype.initComponent=function(){this.io=new Et(this),this.projection=new _t(this),this.interaction=new Nt(this),this.styleComponent=new tn(this),this.renderer=new Dt(this)},t.prototype.initZoomLevel=function(e){void 0===e&&(e=1),this.renderer.zoomLevel=e},t.prototype.remove=function(e){void 0===e&&(e=!0),this.io.remove(e)},t.prototype.initVecsHistory=function(){this.vecsHistory=[],this.vecsHistory.push((0,r.p$)(this.vecCenter),(0,r.p$)(this.vecCenter),(0,r.p$)(this.vecCenter))},t.prototype.removeByAttachedShape=function(){this.io.removeByAttachedShape()},t.prototype.removeLeaderline=function(){this.io.RemoveLeaderline()},t.prototype.removeDiv=function(){this.io.removeDiv()},t.prototype.hide=function(){},t.prototype.deepCopy=function(e,t,n){return void 0===n&&(n=0),this.io.deepCopy(e,t,n)},t.prototype.updateScreenVecForPan=function(){},t.prototype.outExtent=function(){this.projection.outExtent()},t.prototype.inExtent=function(){this.projection.inExtent()},t.prototype.updateScreenVec=function(){},t.prototype.initLeaderlineOffset=function(e,t){this.widthOffset=e,this.heightOffset=t,this.interaction.leadlineInteraction(e,t),this.updateVecs()},t.prototype.mouseLeftClick=function(e,t){this.interaction.mouseLeftClick(e,t)},t.prototype.mouseDoubleClick=function(){this.interaction.mouseDoubleClick()},t.prototype.mouseUp=function(){this.interaction.mouseUp()},t.prototype.isMouseInside=function(e,t){return this.interaction.isMouseInside(e,t)},t.prototype.isMouseInsideDiv=function(e,t){return this.interaction.isMouseInsideDiv(e,t)},t.prototype.translate=function(e,t){},t.prototype.translateByMouseEventData=function(e){this.interaction.translateByMouseEventData(e)},t.prototype.leadlineInteraction=function(e,t){this.interaction.leadlineInteraction(e,t)},t.prototype.toJSON=function(){return this.io.toJSON()},t.prototype.getLog=function(){return this.io.getLog()},t.prototype.processingUpdate=function(e){this.io.processingUpdate(e)},t.prototype.updateVecsHistory=function(){for(this.vecCenter=this.computeCenterVec(),this.vecsHistory.push((0,r.p$)(this.vecCenter));this.vecsHistory.length>3;)this.vecsHistory.shift()},t.prototype.updateOptimizer=function(){},t.prototype.update=function(){},t.prototype.renderLeadline=function(e){this.update(),this.renderer.renderLeadline(e)},t.prototype.renderPost=function(e){this.renderer.renderPost(e),this.inspector.update(e)},t.prototype.getNode=function(){return[this.vec,this.vecOffset]},t.prototype.updateVecs=function(){this.updateScreenVecForPan(),this.updateVecsBox(),this.interaction.updateSideNodes(),this.interaction.updateConectNodes(),this.txtDiv.updateDiv(),this.updateBoundingBox()},t.prototype.getClosestNodeDia=function(e,t){return(0,r.Sp)(new r.h9(e,t),this.vUp.vec)<(0,r.Sp)(new r.h9(e,t),this.vDown.vec)?(this.vUp.isConnected=!0,this.vDown.isConnected=!1,this.vUp):(this.vUp.isConnected=!1,this.vDown.isConnected=!0,this.vDown)},t.prototype.findClosestNodeDia=function(){this.leaderline&&((0,r.Sp)(this.leaderline.v1,this.vUp.vec)<(0,r.Sp)(this.leaderline.v1,this.vDown.vec)?(this.vUp.isConnected=!0,this.vDown.isConnected=!1,this.leaderline.v0.x=this.vUp.vec.x,this.leaderline.v0.y=this.vUp.vec.y,this.leaderline.v0.z=this.vUp.vec.z):(this.vUp.isConnected=!1,this.vDown.isConnected=!0,this.leaderline.v0.x=this.vDown.vec.x,this.leaderline.v0.y=this.vDown.vec.y,this.leaderline.v0.z=this.vDown.vec.z))},t.prototype.computeCenterVec=function(){return this.vecCenter=(0,r.mI)(this.getVecs()),this.vecCenter},t.prototype.getVecs=function(){return[this.v0,this.v1,this.vec]},t.prototype.isMoveUpdate=function(){this.vecsHistory.length<1||(this.vecCenter,this.scene.annotationInstance.activeCommandController.zoomLevelForMoving?this.isMove=!1:(this.isMove=!0,this.isTransform=!0))},t.prototype.snapForPoint=function(){var e=this.scene.annotationInstance.geometryCommon.gcmdProcessing.getClosestNodeForSnapping(this.vec.x,this.vec.y,25);if(e){if(this.leaderline){this.attachedShape&&(this.attachedShape.textLeaderline=void 0,this.attachedShape=void 0),e.textLeaderline=this;var t=e.getVecForSnapping();t&&(this.vec.x=this.leaderline.v2.x=t.x,this.vec.y=this.leaderline.v2.y=t.y,this.vec.z=this.leaderline.v2.z=t.z,this.attachedShape=e)}}else this.attachedShape&&(this.attachedShape.textLeaderline=void 0,this.attachedShape=void 0)},t.prototype.initSnapForPointForUndo=function(){var e=this.scene.annotationInstance.geometryCommon.gcmdProcessing.getClosestNodeForSnapping(this.vec.x,this.vec.y,25);if(void 0!==e){e.textLeaderline=this;var t=e.getVecForSnapping();t&&(this.vec.x=t.x,this.vec.y=t.y,this.vec.z=t.z,this.attachedShape=e,this.isTransform=!0)}},Object.defineProperty(t.prototype,"isSelected",{get:function(){return this.interaction.IsSelected},set:function(e){this.interaction.IsSelected=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"IsSelectedReaderline",{get:function(){return this.interaction.IsSelectedReaderline},set:function(e){this.interaction.IsSelectedReaderline=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isHover",{get:function(){return this.interaction.IsHover},set:function(e){this.interaction.IsHover=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},set:function(e){if(0!==e){!this.renderer.hasSnippet&&this.isCollapse&&(e+=20),this._height=e;var t=e+2*this.txtDiv.offsetForTextDiv;this._height=t,this.v0.y=this.v1.y-t}},enumerable:!1,configurable:!0}),t.prototype.initHeightFromJSON=function(e){var t=(e-=20)+2*this.txtDiv.offsetForTextDiv;this._height=t,this.v0.y=this.v1.y-t,this.update(),this.scene.annotationInstance.activeCommandController.acProperties.needExecuteOptimizer=!0},t.prototype.updateDivHeight=function(){this.txtDiv.divText&&this._heightPre!==this.txtDiv.divText.clientHeight&&(this._heightPre=this.txtDiv.divText.clientHeight,this.height=this.txtDiv.divText.clientHeight,this.interaction.updateSideNodes(),this.interaction.updateConectNodes(),this.txtDiv.updateDiv())},t.prototype.updateBoundingBox=function(){var e=1*(this.v1.x-this.v0.x),t=Math.abs(this.v1.y-this.v0.y);this.collision.minVec=new r.h9(this.vecOffset.x-.5*e,this.vecOffset.y-t),this.collision.maxVec=new r.h9(this.vecOffset.x+.5*e,this.vecOffset.y)},Object.defineProperty(t.prototype,"isCollapse",{get:function(){return this.isRenderCollapse},set:function(e){e?(this.isRenderCollapse=!0,this.txtDiv.divText&&!this.txtDiv.divText.hidden&&(this.txtDiv.divText.hidden=!0)):(this.isRenderCollapse=!1,this.txtDiv.divText&&this.txtDiv.divText.hidden&&(this.txtDiv.divText.hidden=!1))},enumerable:!1,configurable:!0}),t.prototype.fromJSON=function(e,n,o){void 0===n&&(n=!1),void 0===o&&(o=!1);var i=[e.nodes[0].sx,e.nodes[0].sy],s=e.data.content,r=e.data.width?e.data.width:170,a=e.data.height?e.data.height:40,h=i[0],c=i[1],p=new t(this.scene,h,c,r,a,n,s);return e.nodes[1]&&p.initLeaderlineOffset(e.nodes[1].sx,e.nodes[1].sy),p.contentHtmltemp=s,e.data.zoom&&p.initZoomLevel(e.data.zoom),p.isUnderConstruction=!0,e.styles&&p.updateStyleCustom(e.styles),p.isUnderConstruction=!1,p.id=o?this.scene.getUUID():e.id,p.txtDiv.divText&&(p.txtDiv.divText.id="text-editor-"+p.id),p.isHiddenValue=e.isHidden,e.isHidden?p.visibilityValue=0:p.visibilityValue=1,p.computeCenterVec(),p.txtDiv.updateDiv(),p.updateVecs(),n&&this.scene.annotationInstance.io.eventListenerAnnotation.showTextStack(p.toJSON()),p.isSelected=!1,p.isHover=!1,p.isTransform=!1,p.initVecsHistory(),p.initHeightFromJSON(a),p},t}(y),rn=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),an=function(e){function t(t){var n=e.call(this,t)||this;return n.host=t,n}return rn(t,e),t.prototype.renderPost=function(e){this.timer.update(),this.host.vecs.length<2||(this.host.isFreehandDrawing?this.host.scene.annotationInstance.renderer.draw.shape.freeHand.freeHandbyVecs(e,this.host.vecs,this.host.scene.annotationInstance.activeCommandController.activeColorController.activeColor,this.host.scene.annotationInstance.renderer.imageAnnoApp.customization.themeCurrent.freehand.lineWidth*this.host.styleComponent.renderStyle.scaleGlobal*this.host.styleComponent.renderStyle.scaleLocal,this.host.isClosed):this.host.remove())},t}(C),hn=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),cn=function(e){function t(t){var n=e.call(this,t)||this;return n.updateStyle(),n.geo.styleComponent.updateColor(),n}return hn(t,e),t.prototype.updateStyle=function(){x.updateRenderStyleFH(this.renderStyle,this.geo.scene.annotationInstance.customization.themeCurrent),x.updateRenderStyleFH(this.renderStyleNode,this.geo.scene.annotationInstance.customization.themeCurrent)},t}(b),pn=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),ln=function(e){function t(n,o,i){void 0===i&&(i=r.hO.None);var s=e.call(this,n)||this;s.vecs=[],s.modelType=i,s.typeFreehand=o,s.direction=0,s.isFreehandDrawing=!0,s.isClosed=t.isClose,s.optimizer=r.g.DouglasPeucker;var a=s.scene.annotationInstance.customization.themeCurrent.freehand.strokeStyleFirstArray;return s.col="rgba("+a[0]+", "+a[1]+", "+a[2]+", 0.5}",s.initComponent(),t.construction=s,s.init(),s}return pn(t,e),t.cancel=function(){void 0!==t.construction&&t.construction.remove(),t.construction=void 0},t.mouseDown=function(e,n){e.annotationInstance.geometryCommon.gcmdSelecting.deSelectAllObjects(),t.isTooltipRenderable=!1},t.mouseDrag=function(e){t.isTooltipRenderable=!1,t.construction&&t.construction.addVecs(e.x,e.y)},t.mouseUp=function(e,n){if(void 0!==t.construction){if(t.construction.vecs.length<2)return;t.construction.computeVector(),t.construction.isFreehandDrawing=!1,t.construction=void 0,e.annotationInstance.activeCommandController.goToACMode()}},t.mouseMove=function(e,n,o,i){void 0===i&&(i=r.hO.None),void 0===t.construction&&void 0===e.annotationInstance.geometryCommon.gcmdProcessing.findAtPoint(n)&&(t.construction=new t(e,o,i)),t.vecTooltip[0]=n.x,t.vecTooltip[1]=n.y},t.prototype.initComponent=function(){this.styleComponent=new cn(this),this.renderer=new an(this)},t.prototype.init=function(){this.scene.addAFreehandSmartDrawing(this)},t.prototype.addVecs=function(e,t){this.vecs.push(new r.h9(e,t))},t.prototype.checkDotProduct=function(e){var t=[];t.push(e[0]);for(var n=0;n<e.length-5;++n){var o=(0,r.lu)(e[n],e[n+1]);o=(0,r.Fv)(o);var i=(0,r.lu)(e[n],e[n+2]);i=(0,r.Fv)(i);var s=(0,r.lu)(e[n],e[n+3]);i=(0,r.Fv)(s);var a=(0,r.lu)(e[n],e[n+4]);a=(0,r.Fv)(a);var h=(0,r.lu)(e[n],e[n+5]);h=(0,r.Fv)(h);var c=(0,r.nI)(o,i),p=(0,r.nI)(o,s),l=(0,r.nI)(o,s);(isNaN(c)||isNaN(p)||isNaN(l))&&t.push(e[n])}return t.push(e[e.length-1]),t},t.prototype.divVecs=function(e){return e},t.prototype.getPtByVs=function(e){for(var t=e.length;t--;)new k(this.scene,e[t].x,e[t].y).dummy()},t.prototype.computeVector=function(){return e=this,t=void 0,o=function(){var e,t;return function(e,t){var n,o,i,s,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(i=2&s[0]?o.return:s[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;switch(o=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,o=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(!((i=(i=r.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){r=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){r.label=s[1];break}if(6===s[0]&&r.label<i[1]){r.label=i[1],i=s;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(s);break}i[2]&&r.ops.pop(),r.trys.pop();continue}s=t.call(e,r)}catch(e){s=[6,e],o=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}}(this,(function(n){if(e=this.vecs,this.dotProductProcess(e),this.modelType,r.hO.DeepLearning,this.typeFreehand===r.iu.SmartDrawing)e=this.checkDotProduct(e),e=this.divVecs(e),this.getPtByVs(e);else{if(this.optimizer,r.g.DouglasPeucker,t=(0,r.$z)(e),(0,r.Sp)(e[0],e[e.length-1])<10&&(e.pop(),t.pop()),e.length<2)return[2];if(4<e.length&&e.length<15&&!(0,r.AR)(t))return He.getCircleByVecs(this.scene,e),[2];if(3<e.length&&e.length<8)return ae.getRectByVecs(this.scene,e),[2];B.getPolygonbyVecs(this.scene,e),this.remove()}return[2]}))},new((n=void 0)||(n=Promise))((function(i,s){function r(e){try{h(o.next(e))}catch(e){s(e)}}function a(e){try{h(o.throw(e))}catch(e){s(e)}}function h(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}h((o=o.apply(e,t||[])).next())}));var e,t,n,o},t.prototype.dotProductProcess=function(e){var n=e,o=(0,r.Lg)(n);(o=(0,r.aj)(o,500)).push(.1*n.length),t.dotArrayForTrainSimplify.push(o);for(var i=[],s=0;s<n.length;++s)i.push(n[s].x,n[s].y);for(t.dotVecArrayForTrainSimplify.push(i),o=(0,r.Lg)(e),(o=(0,r.aj)(o,500)).push(.1*n.length),t.dotArrayForTrainOrigin.push(o),i=[],s=0;s<e.length;++s)i.push(e[s].x,e[s].y);t.dotVecArrayForTrainOrigin.push(i)},t.prototype.predictDrawingShape=function(e){var t=(0,r.aj)(e,501),n=this.scene.annotationInstance.implementations.app.addon.smartDrawing.PredictByLogisticRegression(t);return[this.scene.annotationInstance.implementations.app.addon.smartDrawing.PredictByMultiClassification(t),n]},t.prototype.getShapeFromPrediction=function(e,t){switch(e){case"CIRCLE":He.getCircleByVecs(this.scene,t);break;case"TRI-GON":B.getPolygonbyVecs(this.scene,t);break;case"ARROW_SINGLE":wt.fromSmartDrawing(this.scene,t,r.zq.ARROW_SINGLE);break;case"ARROW_DOUBLE":wt.fromSmartDrawing(this.scene,t,r.zq.ARROW_DOUBLE);break;case"RECTANGLE":ae.getRectByVecs(this.scene,t);break;case"TEXT_LEADERLINE":sn.fromSmartDrawing(this.scene,t);break;case"CURVE":ct.getCurveByVecs(this.scene,t)}},t.prototype.getLog=function(){return""},t.prototype.isMouseInside=function(e,t){return!1},t.prototype.translateByMouseEventData=function(e){},t.prototype.translate=function(e,t){},t.prototype.hide=function(){},t.prototype.remove=function(){this.scene.removeGeometry(this),this.scene.removeAFreehandSmartDrawing(this)},t.prototype.toJSON=function(){},t.prototype.renderPost=function(e){t.isTooltipRenderable,this.vecs.length<2||(this.isFreehandDrawing?this.scene.annotationInstance.renderer.draw.shape.freeHand.freeHandbyVecs(e,this.vecs,this.scene.annotationInstance.activeCommandController.activeColorController.activeColor,this.scene.annotationInstance.renderer.imageAnnoApp.customization.themeCurrent.freehand.lineWidth*this.styleComponent.renderStyle.scaleGlobal*this.styleComponent.renderStyle.scaleLocal,this.isClosed):this.remove())},t.isClose=!1,t.dotArrayForTrainOrigin=[],t.dotVecArrayForTrainOrigin=[],t.dotArrayForTrainSimplify=[],t.dotVecArrayForTrainSimplify=[],t.isTooltipRenderable=!1,t.vecTooltip=[0,0],t}(y),dn=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),un=function(e){function t(t){var n=e.call(this,t)||this;return n.host=t,n.host.styleComponent.updateColor(),n}return dn(t,e),t.prototype.renderPost=function(e){if(this.timer.update(),!(this.host.vecs.length<2))if(this.host.isFreehandDrawing){for(var t=[],n=0;n<this.host.vecs.length;++n)t.push(new r.h9(this.host.vecs[n].x-this.host.scene.annotationInstance.scene.paramsEditing.croppingMaskParams.x,this.host.vecs[n].y-this.host.scene.annotationInstance.scene.paramsEditing.croppingMaskParams.y));this.host.scene.annotationInstance.renderer.draw.shape.freeHand.freeHandbyVecs(e,t,this.host.scene.annotationInstance.activeCommandController.activeColorController.activeColor,this.host.scene.annotationInstance.renderer.imageAnnoApp.customization.themeCurrent.freehand.lineWidth*this.host.styleComponent.renderStyle.scaleGlobal*this.host.styleComponent.renderStyle.scaleLocal,this.host.isClosed)}else this.host.remove()},t}(C),yn=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),mn=function(e){function t(t){var n=e.call(this,t)||this;return n.renderStyle=new x,n.renderStyleNode=new x,n.updateStyle(),n}return yn(t,e),t.prototype.updateStyle=function(){x.updateRenderStyleFH(this.renderStyle,this.geo.scene.annotationInstance.customization.themeCurrent),x.updateRenderStyleFH(this.renderStyleNode,this.geo.scene.annotationInstance.customization.themeCurrent)},t.prototype.updateStyleByFHType=function(e){e===r.iu.Polygon?(x.updateRenderStyleFHPolygon(this.renderStyle,this.geo.scene.annotationInstance.customization.themeCurrent),x.updateRenderStyleFHPolygonNode(this.renderStyleNode,this.geo.scene.annotationInstance.customization.themeCurrent)):e===r.iu.PolylineBending&&(x.updateRenderStyleFHPolyline(this.renderStyle,this.geo.scene.annotationInstance.customization.themeCurrent),x.updateRenderStyleFHPolylineNode(this.renderStyleNode,this.geo.scene.annotationInstance.customization.themeCurrent))},t}(b),vn=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),gn=function(e){function t(n,o){var i=e.call(this,n)||this;return i.vecs=[],i.optimizer=r.g.Regular,i.typeFreehand=o,i.typeFreehand===r.iu.PolylineGon||i.typeFreehand===r.iu.Polygon||i.typeFreehand===r.iu.PolygonGraph?i.isClosed=!0:i.isClosed=!1,i.direction=0,i.isFreehandDrawing=!0,i.optimizer=r.g.DouglasPeucker,i.initComponent(),t.geo=i,i.init(),i}return vn(t,e),t.cancel=function(){void 0!==t.construction&&t.construction.remove(),t.construction=void 0},t.mouseDown=function(e,n,o){e.annotationInstance.geometryCommon.gcmdSelecting.deSelectAllObjects(),t.isTooltipRenderable=!1},t.mouseDrag=function(e,n,o){void 0===t.construction&&this.mouseMove(e,n,o),t.isTooltipRenderable=!1,t.construction&&t.construction.addVecs(n.x,n.y)},t.mouseUp=function(e,n){if(void 0!==t.construction){if(t.construction.vecs.length<2)return;t.construction.computeVector(),t.construction.isFreehandDrawing=!1,e.annotationInstance.activeCommandController.goToACMode(),t.construction=void 0}},t.mouseMove=function(e,n,o){void 0===t.geo&&void 0===e.annotationInstance.geometryCommon.gcmdProcessing.findAtPoint(n)&&(t.construction=new t(e,o),t.construction.styleComponent.updateStyleByFHType(o)),t.vecTooltip[0]=n.x,t.vecTooltip[1]=n.y},t.prototype.initComponent=function(){this.styleComponent=new mn(this),this.renderer=new un(this)},t.prototype.init=function(){this.scene.addAFreehand(this)},t.prototype.addVecs=function(e,t){this.vecs.push(new r.h9(e,t))},t.prototype.checkDotProduct=function(e){var t=[];t.push(e[0]);for(var n=0;n<e.length-5;++n){var o=(0,r.lu)(e[n],e[n+1]);o=(0,r.Fv)(o);var i=(0,r.lu)(e[n],e[n+2]);i=(0,r.Fv)(i);var s=(0,r.lu)(e[n],e[n+3]);i=(0,r.Fv)(s);var a=(0,r.lu)(e[n],e[n+4]);a=(0,r.Fv)(a);var h=(0,r.lu)(e[n],e[n+5]);h=(0,r.Fv)(h);var c=(0,r.nI)(o,i),p=(0,r.nI)(o,s),l=(0,r.nI)(o,s);(isNaN(c)||isNaN(p)||isNaN(l))&&t.push(e[n])}return t.push(e[e.length-1]),t},t.prototype.divVecs=function(e){return e},t.prototype.getPtByVs=function(e){for(var t=e.length;t--;)new k(this.scene,e[t].x,e[t].y).dummy()},t.prototype.computeVector=function(){var e=this.vecs;if(this.typeFreehand===r.iu.SmartDrawing)e=this.checkDotProduct(e),e=this.divVecs(e),this.getPtByVs(e);else{if(this.optimizer===r.g.DouglasPeucker?e=r.mL.simplifyPath(e,2):this.optimizer===r.g.Regular&&(e=(0,r.z1)(e,30)),e.length<2)return;this.typeFreehand===r.iu.CurveClosed&&ct.getCurveByVecs(this.scene,e,!0),this.typeFreehand===r.iu.Curve&&ct.getCurveByVecs(this.scene,e),this.typeFreehand===r.iu.PolylineBending&&fe.getPolyline(this.scene,e),this.typeFreehand===r.iu.Polyline&&M.getPolylineByVecs(this.scene,e),this.typeFreehand===r.iu.PolylineGon&&B.getPolygonbyVecs(this.scene,e),this.typeFreehand===r.iu.PolygonGraph&&ot.getPolygonbyVecs(this.scene,e),this.remove()}},t.prototype.getLog=function(){return""},t.prototype.isMouseInside=function(e,t){return!1},t.prototype.translateByMouseEventData=function(e){},t.prototype.translate=function(e,t){},t.prototype.hide=function(){},t.prototype.remove=function(){t.geo=void 0,this.scene.removeGeometry(this),this.scene.removeAFreehand(this)},t.prototype.toJSON=function(){},t.prototype.renderPost=function(e){this.renderer.renderPost(e)},t.isClose=!1,t.isTooltipRenderable=!1,t.vecTooltip=[0,0],t}(y),fn=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Cn=function(e){function t(t){var n=e.call(this,t)||this;return n.host=t,n}return fn(t,e),t.prototype.renderPost=function(e){this.host.isRenderable&&this.host.img&&(this.timer.update(),e.save(),e.translate(this.host.vec.x,this.host.vec.y),e.rotate(this.host.angle/180),this.t>.6?this.host.isHoverValue||this.host.isSelected&&this.host.type===r.zq.POINT_ICON?(this.host.scene.annotationInstance.renderer.draw.shape.point.pointIcon(e,this.host.styleComponent.renderStyle,0,0,this.host.widthRender,this.host.heightRender,this.host.img,!0,this.host.isGrayColor,this.host.visibilityValue,!0,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tOver)),this.tOver+=this.host.scene.annotationInstance.renderer.dt,this.tDown1=0,this.host.isLeave=!0,this.renderBoundary(e),this.renderControlPoint(e),this.renderCP(e),this.host.needShadowBound&&this.renderShadow(e)):(this.host.scene.annotationInstance.renderer.draw.shape.point.pointIcon(e,this.host.styleComponent.renderStyle,0,0,this.host.widthRender,this.host.heightRender,this.host.img,!1,this.host.isGrayColor,this.host.visibilityValue,!1),this.tOver=0):this.host.scene.annotationInstance.renderer.draw.shape.point.pointIcon(e,this.host.styleComponent.renderStyle,0,0,this.host.widthRender,this.host.heightRender,this.host.img,!0,this.host.isGrayColor,this.host.visibilityValue,!0,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.t)),e.restore())},t.prototype.renderIcon=function(e){},t.prototype.renderBoundary=function(e){for(var t=[],n=0;n<this.host.arrayCP.length;++n)t.push(this.host.arrayCP[n].vec);e.beginPath();var o=this.host.scene.annotationInstance.customization.themeCurrent.nPoint.fillStyleFirstArray;e.strokeStyle="rgba("+o[0]+", "+o[1]+", "+o[2]+", "+o[3]+")",e.lineWidth=2,this.host.scene.annotationInstance.renderer.draw.shape.area.roundedRect(e,this.host.styleComponent.renderStyle,t,0,0),e.closePath(),e.stroke()},t.prototype.renderCP=function(e){e.fillStyle="#ffffff";var t=this.host.scene.annotationInstance.customization.themeCurrent.nPoint.fillStyleFirstArray;e.strokeStyle="rgba("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")",e.beginPath(),e.arc(0,0,2.5,0,2*Math.PI),e.closePath(),e.fill(),e.stroke()},t.prototype.renderControlPoint=function(e){for(var t=0;t<this.host.arrayCP.length;++t)this.host.arrayCP[t].renderPost(this.host.scene,e)},t.prototype.renderShadow=function(e){for(var t=0;t<this.host.sizes.length;++t){var n=(0,r.Ux)(this.host.img.width,this.host.img.height,this.host.sizes[t]),o=0-.5*n[0],i=0-.5*n[1];e.globalAlpha=1,e.lineDashOffset=-this.t,e.beginPath(),e.lineWidth=.5,e.strokeStyle="#ffffff",e.setLineDash([2,2]),e.rect(o,i,n[0],n[1]),e.closePath(),e.stroke(),e.globalAlpha=1,e.lineDashOffset=-this.t-4,e.beginPath(),e.lineWidth=.5,e.strokeStyle="#000000",e.setLineDash([2,2]),e.rect(o,i,n[0],n[1]),e.closePath(),e.stroke(),e.setLineDash([0,0])}},t}(C),Sn=function(){function e(e,t,n,o){this.r=4,this.strokeWith=2,this.vec=new r.h9(t,n,o),this.index=e}return e.prototype.renderPost=function(e,t){t.lineWidth=this.strokeWith,t.fillStyle="#ffffff";var n=e.annotationInstance.customization.themeCurrent.nPoint.fillStyleFirstArray;t.strokeStyle="rgba("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+")",t.beginPath(),t.arc(this.vec.x,this.vec.y,this.r,0,2*Math.PI),t.closePath(),t.fill(),t.stroke()},e}(),An=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Pn=function(e){function t(t){var n=e.call(this,t)||this;return n.updateStyle(),n}return An(t,e),t.prototype.updateStyle=function(){x.updateRenderStyleRPoint(this.renderStyle,this.geo.scene.annotationInstance.customization.themeCurrent)},t}(b),wn=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),xn=function(e){function t(t,n,o,i,s,a,h,c,p,l){void 0===n&&(n=0),void 0===o&&(o=0),void 0===i&&(i=0),void 0===s&&(s=!1),void 0===a&&(a=""),void 0===h&&(h=""),void 0===c&&(c=r.zq.POINT_ICON),void 0===p&&(p=5),void 0===l&&(l=r.cg.Round);var d=e.call(this,t,n,o,i,c)||this;if(d.widthRender=0,d.heightRender=0,d.indexControPointSelected=-1,d.xOffset=-3,d.yOffset=-3,d.arrayCP=[],d.needRotation=!1,d.angle=0,d.needShadowBound=!1,d.needEmitResizeTransform=!1,d.sizes=[],d.sizesDis=[],d.path=h,d.isUndo=s,d.isPointMid=!1,d.hasPopupValue=!1,d.isRenderable=!1,d.idBase64=a,d.initComponent(),d.InitIcon()){if(t.addIPoint(d),d.isUndo)return d;t.annotationInstance.io.eventListenerAnnotation.addGeometryStack(d.toJSON())}return d}return wn(t,e),t.fromJSON=function(e,n,o,i){void 0===o&&(o=!1),void 0===i&&(i=!1);var s=[n.nodes[0].sx,n.nodes[0].sy],a=new t(e,s[0],s[1],0,o,n.data.idBase64);return a.type=r.zq[n.type],a.isHiddenValue=n.isHidden,n.isHidden?a.visibilityValue=0:a.visibilityValue=1,a.id=i?e.getUUID():n.id,a.heightRender=n.data.height,a.widthRender=n.data.width,a.img.src=e.annotationInstance.renderer.draw.image.listBase64.get(n.data.idBase64),a.isRenderable=!0,a.initVecsHistory(),a},t.MouseRightClick=function(e){},t.mouseMiddleClick=function(e){},t.mouseLeftClick=function(e,n){void 0===e.capture&&e.annotationInstance.renderer.draw.image.activeBase64ID&&(new t(e,n.x,n.y,0).dummy(),e.annotationInstance.activeCommandController.acProperties.pressShift||e.annotationInstance.activeCommandController.goToACMode())},t.mouseDrag=function(e){},t.prototype.initComponent=function(){this.styleComponent=new Pn(this),this.renderer=new Cn(this)},t.prototype.InitIcon=function(){if(this.hasPopupValue&&this.appendDiv(),!(this.idBase64.length<1))return!1;this.idBase64=this.scene.annotationInstance.renderer.draw.image.activeBase64ID,this.img=new Image,this.img.src=this.scene.annotationInstance.renderer.draw.image.activeBase64ID,this.isRenderable=!0,this.isUnderConstruction=!1;var e=(0,r.yH)(this.img.width,this.img.height,72);return this.widthRender=e[0],this.heightRender=e[1],this.midHeightImg=this.widthRender[0],this.midWidthImg=this.widthRender[1],this.xOffset=0,this.yOffset=0,this.arrayCP=[],this.arrayCP.push(new Sn(0,0-this.midWidthImg-this.xOffset,0-this.midHeightImg-this.yOffset,0)),this.arrayCP.push(new Sn(1,0+this.midWidthImg+this.xOffset,0-this.midHeightImg-this.yOffset,0)),this.arrayCP.push(new Sn(2,0+this.midWidthImg+this.xOffset,0+this.midHeightImg+this.yOffset,0)),this.arrayCP.push(new Sn(3,0-this.midWidthImg-this.xOffset,0+this.midHeightImg+this.yOffset,0)),this.sizes=[16,32,48,72],this.computeDistanceForSnap(),!0},t.prototype.computeDistanceForSnap=function(){this.sizesDis=[];for(var e=0;e<this.sizes.length;++e){var t=(0,r.yH)(this.img.width,this.img.height,this.sizes[e]),n=0-.5*t[0],o=0-.5*t[1],i=(0,r.Sp)(new r.h9(0,0),new r.h9(n,o));this.sizesDis.push(i)}},t.prototype.getParentType=function(){return"APointIconWrapper"},t.prototype.appendDiv=function(){this.divHeight=150,this.divWidth=100,this.div=document.createElement("div"),this.div.id="dt_icon_"+this.id.toString(),this.div.style.height=this.divHeight+"px",this.div.style.width=this.divWidth+"px",this.div.style.top=(this.vec.y-.5*this.divHeight).toString()+"px",this.div.style.left=(this.vec.x+50).toString()+"px",this.div.style.position="absolute",this.div.style.background="red",this.div.style.zIndex="999",this.div.style.visibility="hidden"},t.prototype.translateDiv=function(){this.div.style.top=(this.vec.y-.5*this.divHeight).toString()+"px",this.div.style.left=(this.vec.x+50).toString()+"px"},t.prototype.isMouseInside=function(e,t){if(this.isRemove||!this.isRenderable||this.isHiddenValue)return!1;var n=new r.h9(e,t);this.needRotation=!1;for(var o=0;o<this.arrayCP.length;++o){var i=(0,r.Sp)(n,new r.h9(this.arrayCP[o].vec.x+this.vec.x,this.arrayCP[o].vec.y+this.vec.y));if(i<this.arrayCP[o].r+3)return this.indexControPointSelected=this.arrayCP[o].index,this.needRotation=!1,!0;this.arrayCP[0].r+3<i&&i<this.arrayCP[0].r+13&&(this.needRotation=!0)}return this.indexControPointSelected=-1,!!(0,r.X0)(n,[new r.h9(this.arrayCP[0].vec.x+this.vec.x,this.arrayCP[0].vec.y+this.vec.y),new r.h9(this.arrayCP[1].vec.x+this.vec.x,this.arrayCP[1].vec.y+this.vec.y),new r.h9(this.arrayCP[2].vec.x+this.vec.x,this.arrayCP[2].vec.y+this.vec.y),new r.h9(this.arrayCP[3].vec.x+this.vec.x,this.arrayCP[3].vec.y+this.vec.y)])||!!this.needRotation},t.prototype.deepCopy=function(e,n){var o=new t(this.scene,e,n,this.vec.z,!0,this.idBase64,this.path,this.type,this.r);return o.type=this.type,o.isHiddenValue=this.isHiddenValue,o.id=this.scene.getUUID(),o.widthRender=this.widthRender,o.heightRender=this.heightRender,o.emitAddStack(),o},t.prototype.translate=function(e,t){},t.prototype.translateByMouseEventData=function(e){if(!this.isRemove&&this.isRenderable&&!this.isHiddenValue&&!this.scene.annotationInstance.activeCommandController.acProperties.pressESC){var t=e.x-e.preX,n=e.y-e.preY;if(this.needRotation&&this.scene.annotationInstance.activeCommandController.acProperties.pressShift)this.angle+=t+n;else{if(this.indexControPointSelected>-1)return this.needEmitResizeTransform=!0,void(this.scene.annotationInstance.activeCommandController.acProperties.pressShift?this.translateControlPointForFreeform(t,n):(this.translateControlPointSnap(e),this.needShadowBound=!0));this.needShadowBound=!1,this.vec.x+=t,this.vec.y+=n,this.isDrag=!0,this.textLeaderline&&(this.textLeaderline.translateByMouseEventData(e),this.textLeaderline.leaderline&&(this.textLeaderline.leaderline.v2.x=this.vec.x,this.textLeaderline.leaderline.v2.y=this.vec.y))}}},Object.defineProperty(t.prototype,"isSelected",{get:function(){return this.isSelectedValue},set:function(e){this.isSelectedValue=e,this.scene.annotationInstance.io.eventListenerAnnotation.selectionStack(this.toJSON())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isHover",{get:function(){return this.isHoverValue},set:function(e){this.isHoverValue=e,(this.isHoverValue&&!this.isHoverPre||!this.isHoverValue&&this.isHoverPre)&&this.scene.annotationInstance.io.eventListenerAnnotation.hoverStack(this.toJSON()),this.isHoverPre=this.isHoverValue,e||(this.needEmitHoverPost=!0,this.hidePopUpSummary())},enumerable:!1,configurable:!0}),t.prototype.translateControlPointSnap=function(e){for(var t=(0,r.Sp)(this.vec,new r.h9(e.x,e.y)),n=0;n<this.sizesDis.length;++n)if(t<this.sizesDis[n]){var o=(0,r.yH)(this.img.width,this.img.height,this.sizes[n]);this.widthRender=o[0],this.heightRender=o[1],this.arrayCP[0].vec.x=.5*-o[0],this.arrayCP[0].vec.y=.5*-o[1],this.arrayCP[1].vec.x=.5*+o[0],this.arrayCP[1].vec.y=.5*-o[1],this.arrayCP[2].vec.x=.5*+o[0],this.arrayCP[2].vec.y=.5*+o[1],this.arrayCP[3].vec.x=.5*-o[0],this.arrayCP[3].vec.y=.5*+o[1];break}},t.prototype.translateControlPointForFreeform=function(e,t){0===this.indexControPointSelected?(this.arrayCP[0].vec.x+=e,this.arrayCP[0].vec.y+=t,this.arrayCP[1].vec.x-=e,this.arrayCP[1].vec.y+=t,this.arrayCP[2].vec.x-=e,this.arrayCP[2].vec.y-=t,this.arrayCP[3].vec.x+=e,this.arrayCP[3].vec.y-=t):1===this.indexControPointSelected?(this.arrayCP[0].vec.x-=e,this.arrayCP[0].vec.y+=t,this.arrayCP[1].vec.x+=e,this.arrayCP[1].vec.y+=t,this.arrayCP[2].vec.x+=e,this.arrayCP[2].vec.y-=t,this.arrayCP[3].vec.x-=e,this.arrayCP[3].vec.y-=t):2===this.indexControPointSelected?(this.arrayCP[0].vec.x-=e,this.arrayCP[0].vec.y-=t,this.arrayCP[1].vec.x+=e,this.arrayCP[1].vec.y-=t,this.arrayCP[2].vec.x+=e,this.arrayCP[2].vec.y+=t,this.arrayCP[3].vec.x-=e,this.arrayCP[3].vec.y+=t):3===this.indexControPointSelected&&(this.arrayCP[0].vec.x+=e,this.arrayCP[0].vec.y-=t,this.arrayCP[1].vec.x-=e,this.arrayCP[1].vec.y-=t,this.arrayCP[2].vec.x-=e,this.arrayCP[2].vec.y+=t,this.arrayCP[3].vec.x+=e,this.arrayCP[3].vec.y+=t),this.widthRender=this.arrayCP[1].vec.x-this.arrayCP[0].vec.x,this.heightRender=this.arrayCP[3].vec.y-this.arrayCP[0].vec.y},t.prototype.remove=function(e){if(void 0===e&&(e=!0),this.isSelectable=!1,this.isRenderable=!1,this.hasPopupValue&&this.hidePopUpSummary(),this.textLeaderline&&(this.textLeaderline.removeByAttachedShape(),this.textLeaderline=void 0),this.isSelectable=!1,this.isRenderable=!1,this.isRemove=!0,e){var t=this.toJSON();t&&this.scene.annotationInstance.io.eventListenerAnnotation.removeGeometryStack([t])}this.scene.removeBasePoint(this),this.scene.removeIPoint(this),this.scene.removeGeometry(this)},t.prototype.toJSON=function(){},t.prototype.mouseUp=function(){if(this.needEmitResizeTransform){var e=this.toJSON();e&&this.scene.annotationInstance.io.eventListenerAnnotation.transformStack([e])}this.needEmitResizeTransform=!1},t.prototype.renderPost=function(e){this.renderer.renderPost(e)},t}(v),In=function(){function e(e){this.geo=e}return e.prototype.isMouseInside=function(e,t){return!1},e.prototype.getLog=function(){return""},e.prototype.hide=function(){},e}(),bn=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),On=function(e){function t(t){var n=e.call(this,t)||this;return n.host=t,n}return bn(t,e),t.prototype.renderPost=function(e){if(this.host.inspector.update(e),this.interpolateColor.update(),!(this.host.isCollapse||this.host.scaleForRender<.01||void 0===this.host.scene.annotationInstance.customization.themeCurrent.nPoint.SVG)){var t=this.host.scene.annotationInstance.renderer.draw.shape.pointSVG,n=this.host.scene.annotationInstance.renderer.draw.shape.point,o=this.host.scene.annotationInstance.geometryCommon.gcmdSupporting.toScreenVecOnCropping(this.host.vec);this.host.isDrag?(n.shadowNPoint(e,this.host.styleComponent.renderStyle,o.x,o.y,this.host.scaleForRender*this.host.styleComponent.renderStyle.scaleGlobal*this.host.styleComponent.renderStyle.scaleLocal,this.host.isSelected,this.host.isHover),this.host.scene.annotationInstance.implementations.app.param.environment===r.qA.AGSM?(n.pointNumberedOverBoundingByCircle(e,this.host.styleComponent.renderStyle,o.x,o.y,this.host.scaleForRender*this.host.styleComponent.renderStyle.scaleGlobal*this.host.styleComponent.renderStyle.scaleLocal,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tOver),!0,!0,this.host.isGrayColor,this.host.visibility),n.pointNumberedDragByCircle(e,this.host.styleComponent.renderStyle,o.x,o.y,this.host.scaleForRender*this.host.styleComponent.renderStyle.scaleGlobal*this.host.styleComponent.renderStyle.scaleLocal,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tDown2),!1,!1,this.host.isGrayColor,this.host.visibility,this.host.isHover,this.host.isSelected)):t.pointSVGNormalFill(e,this.host.scene.annotationInstance.customization.themeCurrent.nPoint.SVG.path2D,this.host.styleComponent.renderStyle,o.x,o.y,this.host.scaleForRender*this.host.styleComponent.renderStyle.scaleGlobal*this.host.styleComponent.renderStyle.scaleLocal,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tDown2),!1,!1,this.host.isGrayColor,this.host.visibilityValue,this.host.isPinValue,this.host.isHoverValue,this.host.isSelectedValue,!0),this.tUp+=.015,this.tDown2=0):(this.host.isSelectedValue?(n.shadowNPoint(e,this.host.styleComponent.renderStyle,o.x,o.y,this.host.scaleForRender*this.host.styleComponent.renderStyle.scaleGlobal*this.host.styleComponent.renderStyle.scaleLocal,this.host.isSelected,this.host.isHover),this.host.scene.annotationInstance.implementations.app.param.environment===r.qA.AGSM?n.pointNumberedOverBoundingByCircleSelected(e,this.host.styleComponent.renderStyle,o.x,o.y,this.host.scaleForRender*this.host.styleComponent.renderStyle.scaleGlobal*this.host.styleComponent.renderStyle.scaleLocal,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tOver),!0,!0,this.host.isGrayColor,this.host.visibilityValue):t.pointSVGNormalFill(e,this.host.scene.annotationInstance.customization.themeCurrent.nPoint.SVG.path2D,this.host.styleComponent.renderStyle,o.x,o.y,this.host.scaleForRender*this.host.styleComponent.renderStyle.scaleGlobal*this.host.styleComponent.renderStyle.scaleLocal,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tDown2),!1,!1,this.host.isGrayColor,this.host.visibilityValue,this.host.isPinValue,this.host.isHoverValue,this.host.isSelectedValue,!0),this.tOver+=.015,this.tDown1=0,this.host.isHoverValue?this.tOverPopupSummary+=this.host.scene.annotationInstance.renderer.dt:this.tOverPopupSummary=0,this.host.isLeave=!0):this.host.isHoverValue?(n.shadowNPointLight(e,this.host.styleComponent.renderStyle,o.x,o.y,this.host.scaleForRender*this.host.styleComponent.renderStyle.scaleGlobal*this.host.styleComponent.renderStyle.scaleLocal,this.host.isSelected,this.host.isHover),this.host.scene.annotationInstance.implementations.app.param.environment===r.qA.AGSM?n.pointNumberedOverBoundingByCircle(e,this.host.styleComponent.renderStyle,o.x,o.y,this.host.scaleForRender*this.host.styleComponent.renderStyle.scaleGlobal*this.host.styleComponent.renderStyle.scaleLocal,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tOver),!0,!0,this.host.isGrayColor,this.host.visibility):t.pointSVGNormalFill(e,this.host.scene.annotationInstance.customization.themeCurrent.nPoint.SVG.path2D,this.host.styleComponent.renderStyle,o.x,o.y,this.host.scaleForRender*this.host.styleComponent.renderStyle.scaleGlobal*this.host.styleComponent.renderStyle.scaleLocal,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tDown2),!1,!1,this.host.isGrayColor,this.host.visibilityValue,this.host.isPinValue,this.host.isHoverValue,this.host.isSelectedValue,!0),this.tOver+=.015,this.tOverPopupSummary+=this.host.scene.annotationInstance.renderer.dt,this.tDown1=0,this.host.isLeave=!0):this.host.isLeave&&!this.host.isDrag?(this.host.scene.annotationInstance.implementations.app.param.environment,r.qA.AGSM,this.tDown1+=.015,this.tOver=this.tOverPopupSummary=0,this.tDown1>.15&&(this.host.isLeave=!1)):this.host.isDrag||(this.host.scene.annotationInstance.implementations.app.param.environment,r.qA.AGSM,n.pointNumberedOverBoundingByCircle(e,this.host.styleComponent.renderStyle,o.x,o.y,this.host.scaleForRender*this.host.styleComponent.renderStyle.scaleGlobal*this.host.styleComponent.renderStyle.scaleLocal,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tDown1),!1,!1,this.host.isGrayColor,this.host.visibilityValue),this.tDown1+=this.host.scene.annotationInstance.renderer.dt,this.tOver=this.tOverPopupSummary=0),this.host.scene.annotationInstance.implementations.app.param.environment===r.qA.AGSM?n.pointNumberedDragByCircle(e,this.host.styleComponent.renderStyle,o.x,o.y,this.host.scaleForRender*this.host.styleComponent.renderStyle.scaleGlobal*this.host.styleComponent.renderStyle.scaleLocal,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tDown2),!1,!1,this.host.isGrayColor,this.host.visibility,this.host.isHover,this.host.isSelected):t.pointSVGNormalFill(e,this.host.scene.annotationInstance.customization.themeCurrent.nPoint.SVG.path2D,this.host.styleComponent.renderStyle,o.x,o.y,this.host.scaleForRender*this.host.styleComponent.renderStyle.scaleGlobal*this.host.styleComponent.renderStyle.scaleLocal,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tDown2),!1,!1,this.host.isGrayColor,this.host.visibilityValue,this.host.isPinValue,this.host.isHoverValue,this.host.isSelectedValue),this.tUp=0,this.tDown2+=.5*this.host.scene.annotationInstance.renderer.dt,this.tDown2>.15&&(this.host.isDrop=!1)),this.DrawingText(e,o.x,o.y),this.host.hasPopup&&this.host.isMove&&this.host.updateDivPos(),this.host.t+=this.host.scene.annotationInstance.renderer.dt,this.host.scene.annotationInstance.implementations.app.param.environment===r.qA.AGSM?this.renderNPointCircleOffScreen(this.host.scene.annotationInstance.renderer.ctxOffscreen,o.x,o.y,this.host.scaleForRender*this.host.styleComponent.renderStyle.scaleGlobal*this.host.styleComponent.renderStyle.scaleLocal):this.offScreenRender(o.x,o.y)}},t.prototype.DrawingText=function(e,t,n){var o=this.geo.styleComponent.renderStyle.scaleLocal*this.geo.styleComponent.renderStyle.scaleGlobal,i=this.geo.scene.annotationInstance.renderer.imageAnnoApp.customization.themeCurrent.nPoint.fontSize*o+"px "+this.geo.scene.annotationInstance.renderer.imageAnnoApp.customization.themeCurrent.nPoint.fontFamily;e.font=i,e.textAlign="center",e.fillStyle=this.host.styleComponent.textColor,this.host.scene.annotationInstance.implementations.app.param.environment===r.qA.AGSM?e.fillText(this.host.getIndex().toString(),t,n-20*o*.5):e.fillText(this.host.getIndex().toString(),t,n-28*o*.5)},t.prototype.offScreenRender=function(e,t){var n=(0,r.nP)();Rn(this.host.scene.annotationInstance.renderer.ctxOffscreen,[e,t],n.path2D,this.geo.hashColor,this.geo.scene.annotationInstance.activeCommandController.scaleGlobal*this.geo.styleComponent.renderStyle.scaleLocal,-13.14,-28)},t.prototype.renderNPointCircleOffScreen=function(e,t,n,o){var i=this.host.scene.annotationInstance.customization.themeCurrent.nPoint.height*o;e.fillStyle=this.geo.hashColor,e.beginPath(),e.arc(t,n-.5*i,.5*i,0,2*Math.PI),e.closePath(),e.fill()},t}(C),Rn=function(e,t,n,o,i,s,r){void 0===i&&(i=1),void 0===s&&(s=-8),void 0===r&&(r=-32),e.fillStyle=o,e.save(),e.translate(t[0]+s*i,t[1]+r*i),e.scale(i,i),e.fill(n),e.restore()},Ln=n(8184),Vn=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),kn=function(e){function t(t){var n=e.call(this,t)||this;return n.textColor="#000",n.updateStyle(),n.updateColor(),n}return Vn(t,e),t.prototype.updateStyle=function(){this.isCustom||(this.state.themeColorId=s.AccentColor1,this.isCustom=!0,x.updateRenderStyleNPoint(this.renderStyle,this.geo.scene.annotationInstance.customization.themeCurrent)),this.updateTextColor()},t.prototype.updateColor=function(e){void 0===e&&(e=void 0),this.isCustom=!0,void 0===e&&(e=this.geo.scene.annotationInstance.activeCommandController.activeColorController.activeColor),x.updateRenderColorNPoint(this.renderStyle,this.geo.scene.annotationInstance.customization.themeCurrent,e),this.tempColorRgba=e,this.updateTextColor()},t.prototype.updateStyleCustom=function(e){var t=!1;return e.size&&(this.geo.size=e.size.toUpperCase(),t=!0),e.width&&(this.state.width=e.width),void 0!==e.color&&(this.state.themeColorId=e.color),e.colorRgba.length>0&&(this.tempColorRgba=e.colorRgba,x.updateRenderColorRPointCustom(this.renderStyle,this.geo.scene.annotationInstance.customization.themeCurrent,e.colorRgba)),e.scale&&(this.renderStyle.scaleLocal=e.scale,this.state.scale=e.scale),this.isCustom=!0,t&&!this.geo.isUnderConstruction&&(this.geo.isTransform=!0),this.updateTextColor(),!0},t.prototype.toJson=function(){if(this.isCustom){var e={width:this.state.width,scale:this.renderStyle.scaleLocal,colorRgba:this.tempColorRgba,number:this.geo.getIndex()};return this.renderStyle.size!==r.$u.MEDIUM&&(e.size=this.renderStyle.size.toLowerCase()),this.state.themeColorId!==s.AccentColor1&&(e.color=this.state.themeColorId),e}},t.prototype.isSameStyle=function(e){if(e.colorRgba.length===this.tempColorRgba.length)for(var t=0;t<e.colorRgba.length;t++)if(e.colorRgba[t]!==this.tempColorRgba[t])return!1;return!0},t.prototype.updateTextColor=function(){this.textColor=(0,Ln.XV)(this.renderStyle.colorFill)},t}(b),Nn=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),En=function(e){function t(t){var n=e.call(this,t)||this;return n.geo=t,n}return Nn(t,e),t.prototype.translateByMouseEventData=function(e){},t.prototype.translate=function(e,t){},t}(Y),_n=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Tn=function(e){function t(t,n,o,i,s,a,h,c,p,l){void 0===n&&(n=0),void 0===o&&(o=0),void 0===i&&(i=0),void 0===s&&(s=!1),void 0===a&&(a=r.zq.POINT_NUMBERED),void 0===h&&(h=5),void 0===c&&(c="white"),void 0===p&&(p="black"),void 0===l&&(l=r.cg.Round);var d=e.call(this,t,n,o,i,a)||this;d.numberIndexNeeded=!0,d.svgPath=new Path2D("M26 2a2 2 0 00-2-2H2a2 2 0 00-2 2v17a2 2 0 002 2h6.757l4.276 6.33L17.31 21H24a2 2 0 002-2V2z"),d._numberIndex=-1,d._hashColorRGB=[0,0,0,0],d.type=a,d.isUndo=s,d.numberIndex=d.scene.listNPoint.length+1;var u=d.hashColor.split("(")[1].split(")")[0].split(",");return d._hashColorRGB=[+u[0],+u[1],+u[2]],d.InitComponent(),t.addNPoint(d),d.isUndo||t.annotationInstance.io.eventListenerAnnotation.addGeometryStack(d.toJSON()),d}return _n(t,e),t.FindAtPoint=function(e,t,n){for(var o=e.listNPoint.length-1;o>=0;--o)if(e.listNPoint.length[o].isSelectable&&e.listNPoint.length[o].IsMouseInside(t,n))return e.listNPoint.length[o]},t.GetLengthSelection=function(e){for(var t=e.listNPoint.length,n=0;t--;)e.listNPoint[t].isSelected&&(n+=1);return n},t.RemoveAllCapturedGeo=function(e){for(var t=e.listNPoint,n=0;n<t.length;++n)!0===e.listNPoint[n].isSelectedValue&&e.listNPoint[n].remove()},t.DeSelecteCaptureObjects=function(e){for(var t=0;t<e.listNPoint.length;++t)e.listNPoint[t].isSelectedValue=!1},t.MoveSelectedGeo=function(e,t){for(var n=0;n<e.listNPoint.length;++n)!0!==e.listNPoint[n].isSelectedValue||e.listNPoint[n].isHoverValue||e.listNPoint[n].translateByMouseEventData(t),!0===e.listNPoint[n].isHoverValue&&e.listNPoint[n].translateByMouseEventData(t)},t.FromJSON=function(e,n,o,i){void 0===o&&(o=!1),void 0===i&&(i=!1);var s=[n.nodes[0].sx,n.nodes[0].sy],a=new t(e,s[0],s[1],0,o);return a.type=r.zq[n.type],a.id=i?e.getUUID():n.id,a.isHiddenValue=n.isHidden,n.isHidden?a.visibilityValue=0:a.visibilityValue=1,n.styles&&a.updateStyleCustom(n.styles),a.initVecsHistory(),a},t.MouseRightClick=function(e){},t.MouseMiddleClick=function(e){},t.mouseLeftClick=function(e,n){void 0===e.capture&&(new t(e,n.x,n.y,0).dummy(),e.annotationInstance.activeCommandController.acProperties.pressShift||e.annotationInstance.activeCommandController.goToACMode())},t.prototype.InitComponent=function(){this.styleComponent=new kn(this),this.renderer=new On(this),this.transformation=new En(this),this.interaction=new In(this)},t.prototype.init=function(){this.isGeoPos=!0,this.edges=[],this.isPointMid=!1,this.t=0},t.prototype.isMouseInside=function(e,t){return!(this.isRemove||!this.isRenderable||this.isHiddenValue)&&!this.isCollapse&&this.scene.annotationInstance.geometryCommon.gcmdProcessing.isMouseInsideByOffScreenNumberPoint(e-this.scene.annotationInstance.renderer.imageAnnoApp.scene.paramsEditing.croppingMaskParams.x,t-this.scene.annotationInstance.renderer.imageAnnoApp.scene.paramsEditing.croppingMaskParams.y,this._hashColorRGB)},t.prototype.isMouseInsideWithTolerance=function(e,t,n){return!(this.isRemove||!this.isRenderable||this.isHiddenValue)&&!this.isCollapse&&this.distance(e,t+11*this.scaleForRender)<=this.r*this.scaleForRender+12*this.scaleForRender+n},t.prototype.getParentType=function(){return"ANNOTATION.POINT_NUMBERED"},t.prototype.remove=function(e){if(void 0===e&&(e=!0),this.isSelectable=!1,this.isRenderable=!1,this.hasPopupValue&&this.hidePopUpSummary(),e){var t=this.toJSON();t&&this.scene.annotationInstance.io.eventListenerAnnotation.removeGeometryStack([t])}this.textLeaderline&&(this.textLeaderline.removeByAttachedShape(),this.textLeaderline=void 0),this.scene.removeBasePoint(this),this.scene.removeNPoint(this),this.scene.removeGeometry(this)},t.prototype.getIndex=function(){return this.scene.listNPoint.indexOf(this)+1},t.prototype.deepCopy=function(e,n){return new t(this.scene,e,n,this.vec.z,!1,this.type,this.r)},Object.defineProperty(t.prototype,"isSelected",{get:function(){return this.isSelectedValue},set:function(e){this.isSelectedValue=e,this.scene.annotationInstance.io.eventListenerAnnotation.selectionStack(this.toJSON())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isHover",{get:function(){return this.isHoverValue},set:function(e){this.isHoverValue=e,(this.isHoverValue&&!this.isHoverPre||!this.isHoverValue&&this.isHoverPre)&&this.scene.annotationInstance.io.eventListenerAnnotation.hoverStack(this.toJSON()),this.isHoverPre=this.isHoverValue,e||(this.needEmitHoverPost=!0,this.hidePopUpSummary())},enumerable:!1,configurable:!0}),t.prototype.mouseLeftClick=function(){this.scene.annotationInstance.geometryCommon.gcmdProcessing.removeAllPopup(),this.showPopupSummary()},t.prototype.updateDivPos=function(){this.popup&&(this.popup.style.top=this.vec.y-31*this.scene.annotationInstance.customization.themeCurrent.nPoint.scale+"px",this.popup.style.left=this.vec.x-17*this.scene.annotationInstance.customization.themeCurrent.nPoint.scale+"px")},t.prototype.renderPost=function(e){this.renderer.renderPost(e),this.scene.annotationInstance.implementations.app.INSPECTION&&this.collision.render(e)},t.prototype.toJSON=function(){if(this.type!==r.zq.ANODE&&this.type!==r.zq.ANODE_CIRCLE&&this.type!==r.zq.AMIDPOINT&&this.type!==r.zq.AN_GON&&this.type!==r.zq.ANODE_RECT){var e=new p(this.id,this.type,this.isSelectedValue,this.isHoverValue,this.isHiddenValue);e.pushNode(this.getNode());var t=this.styleComponent.toJson();return t&&(e.styles=t),e}},Object.defineProperty(t.prototype,"numberIndex",{get:function(){return this._numberIndex},set:function(e){this._numberIndex=e},enumerable:!1,configurable:!0}),t.prototype.updateBoundingBox=function(){this.collision.minVec=new r.h9(this.vec.x-16,this.vec.y-30),this.collision.maxVec=new r.h9(this.vec.x+16,this.vec.y+2)},t.prototype.showPopupSummary=function(){var e=this;this.scene.annotationInstance.activeCommandController.needPopup()&&(this.hasPopupValue||this.popup||this.isGhost||(this.hasPopupValue=!0,this.popup=document.createElement("div"),this.popup.id="pa-"+this.id,this.popup.style.position="absolute",this.popup.style.pointerEvents="none",this.scene.annotationInstance.implementations.app.model.modelViewWrapper.div.appendChild(this.popup),this.popup.style.height=34*this.scene.annotationInstance.customization.themeCurrent.nPoint.scale+"px",this.popup.style.width=34*this.scene.annotationInstance.customization.themeCurrent.nPoint.scale+"px",this.popup.style.top=this.vec.y-31*this.scene.annotationInstance.customization.themeCurrent.nPoint.scale+"px",this.popup.style.left=this.vec.x-17*this.scene.annotationInstance.customization.themeCurrent.nPoint.scale+"px",this.showPopupStackTimer&&clearTimeout(this.showPopupStackTimer),this.showPopupStackTimer=setTimeout((function(){e.popup&&e.scene.annotationInstance.io.eventListenerAnnotation.showPopupStack(e.toJSON())}),this.timePopupDelay)))},t.prototype.updatePopup=function(){this.hasPopupValue&&void 0!==this.popup&&(this.hasGhostPopup?(this.popup.style.top=this.vec.y-this.scene.annotationInstance.customization.themeCurrent.nPoint.height-this.ghostPopupOffset+"px",this.popup.style.left=this.vec.x+"px"):(this.popup.style.top=this.vec.y-31*this.scene.annotationInstance.customization.themeCurrent.nPoint.scale+"px",this.popup.style.left=this.vec.x-17*this.scene.annotationInstance.customization.themeCurrent.nPoint.scale+"px"))},t.prototype.hidePopUpSummary=function(){if(this.popup&&this.popup.parentNode&&this.scene.annotationInstance.activeCommandController.acProperties.insideMap){if(this.renderer.tOverPopupSummary=0,this.popup.parentNode.removeChild(this.popup),this.type===r.zq.CNODE){var e=new p(this.id,this.type,this.isSelectedValue,this.isHoverValue,this.isHiddenValue);e.pushNode(this.getNode()),this.scene.annotationInstance.io.eventListenerAnnotation.hidePopupStack(e)}else this.scene.annotationInstance.io.eventListenerAnnotation.hidePopupStack(this.toJSON());this.hasPopupPre=!1,this.popup=void 0,this.hasPopupValue=!1}},t}(v),Dn=function(){function e(e){this.geo=e}return e.prototype.isMouseInside=function(e,t){return!(this.geo.isRemove||!this.geo.isRenderable||this.geo.isHiddenValue)&&!this.geo.isCollapse&&(this.geo.scene.annotationInstance.implementations.app.model.appCoreWrapper.browserUtility.isMobile?(0,r.Sp)(new r.h9(e,t),new r.h9(this.geo.vec.x,this.geo.vec.y-.5*(this.geo.collision.maxVec.y-this.geo.collision.minVec.y)))<15:(0,r.mp)(new r.h9(e,t),this.geo.collision.minVec,this.geo.collision.maxVec))},e.prototype.getLog=function(){return""},e.prototype.hide=function(){},e.prototype.updateDivPos=function(){if(this.geo.popup)switch(this.geo.renderer.pointRenderType){case r.oW.RpointA:this.geo.popup.style.top=this.geo.vec.y-32+"px",this.geo.popup.style.left=this.geo.vec.x-10+"px";break;case r.oW.Image:this.geo.popup.style.top=this.geo.vec.y+"px",this.geo.popup.style.left=this.geo.vec.x+.5*this.geo.styleComponent.img.width+1+"px"}},e.prototype.showPopupSummary=function(){var e=this;if(this.geo.scene.annotationInstance.activeCommandController.needPopup()&&!this.geo.hasPopup&&!this.geo.isGhost){switch(this.geo.hasPopup=!0,this.geo.popup=document.createElement("div"),this.geo.popup.id="pa-"+this.geo.id,this.geo.popup.style.position="absolute",this.geo.popup.style.pointerEvents="none",this.geo.scene.annotationInstance.implementations.app.model.modelViewWrapper.div.appendChild(this.geo.popup),this.geo.renderer.pointRenderType){case r.oW.RpointA:1===this.geo.scene.annotationInstance.customization.themeCurrent.nPoint.scale?(this.geo.popup.style.height="33px",this.geo.popup.style.width="18px",this.geo.popup.style.top=this.geo.vec.y-32+"px",this.geo.popup.style.left=this.geo.vec.x-10+"px"):(this.geo.popup.style.height=32*this.geo.scene.annotationInstance.customization.themeCurrent.nPoint.scale+"px",this.geo.popup.style.width=18*this.geo.scene.annotationInstance.customization.themeCurrent.nPoint.scale+"px",this.geo.popup.style.top=this.geo.vec.y-32*this.geo.scene.annotationInstance.customization.themeCurrent.nPoint.scale+"px",this.geo.popup.style.left=this.geo.vec.x-10*this.geo.scene.annotationInstance.customization.themeCurrent.nPoint.scale+1+"px");break;case r.oW.Image:this.geo.popup.style.top=this.geo.vec.y+"px",this.geo.popup.style.left=this.geo.vec.x+.5*this.geo.styleComponent.img.width+1+"px"}this.showPopupStackTimer&&clearTimeout(this.showPopupStackTimer),this.showPopupStackTimer=setTimeout((function(){e.geo.popup&&e.geo.scene.annotationInstance.io.eventListenerAnnotation.showPopupStack(e.geo.toJSON())}),100)}},e.prototype.updatePopup=function(){if(this.geo.hasPopup&&void 0!==this.geo.popup)switch(this.geo.renderer.pointRenderType){case r.oW.RpointA:this.geo.hasGhostPopup?(this.geo.popup.style.top=this.geo.vec.y-this.geo.scene.annotationInstance.customization.themeCurrent.nPoint.height-this.geo.ghostPopupOffset+"px",this.geo.popup.style.left=this.geo.vec.x+"px"):1===this.geo.scene.annotationInstance.customization.themeCurrent.nPoint.scale?(this.geo.popup.style.top=this.geo.vec.y-32+"px",this.geo.popup.style.left=this.geo.vec.x-10+"px"):(this.geo.popup.style.top=this.geo.vec.y-32*this.geo.scene.annotationInstance.customization.themeCurrent.nPoint.scale+"px",this.geo.popup.style.left=this.geo.vec.x-10*this.geo.scene.annotationInstance.customization.themeCurrent.nPoint.scale+1+"px");break;case r.oW.Image:this.geo.popup.style.top=this.geo.vec.y+"px",this.geo.popup.style.left=this.geo.vec.x+.5*this.geo.styleComponent.img.width+1+"px"}},e}(),Mn=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),zn=function(e){function t(t){var n=e.call(this,t)||this;return n.host=t,n}return Mn(t,e),t.prototype.renderPost=function(e){if(this.host.inspector.update(e),this.interpolateColor.update(),this.host.scaleForRender=1,!(this.host.isCollapse||this.host.scaleForRender<.01)){var t=this.host.scene.annotationInstance.renderer.draw.shape.point;this.host.isDrag?(t.pointRegularDragBySVGPath(e,this.host.styleComponent.renderStyle,this.host.vec.x,this.host.vec.y,this.host.scaleForRender*this.host.scene.annotationInstance.activeCommandController.scaleGlobal,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tUp),!0,!0,this.host.isGrayColor,this.host.visibilityValue,this.host.isPinValue,this.host.isHoverValue,this.host.isSelectedValue),this.tUp+=.015,this.tDown2=0):(this.host.isSelectedValue?(t.shadowRPoint(e,this.host.styleComponent.renderStyle,this.host.vec.x,this.host.vec.y,this.host.isSelected,this.host.isHover),t.pointRegularOverBoundingBySVGPathSelected(e,this.host.styleComponent.renderStyle,this.host.vec.x,this.host.vec.y,this.host.scaleForRender*this.host.scene.annotationInstance.activeCommandController.scaleGlobal,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tOver),!0,!0,this.host.isGrayColor,this.host.visibilityValue,this.host.isPinValue),this.tOver+=.015,this.tDown1=0,this.host.isHoverValue?this.tOverPopupSummary+=this.host.scene.annotationInstance.renderer.dt:this.tOverPopupSummary=0,this.host.isLeave=!0):this.host.isHoverValue?(t.shadowRPointLight(e,this.host.styleComponent.renderStyle,this.host.vec.x,this.host.vec.y,this.host.scaleForRender*this.host.scene.annotationInstance.activeCommandController.scaleGlobal,this.host.isSelected,this.host.isHover),t.pointRegularOverBoundingBySVGPath(e,this.host.styleComponent.renderStyle,this.host.vec.x,this.host.vec.y,this.host.scaleForRender*this.host.scene.annotationInstance.activeCommandController.scaleGlobal,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tOver),!0,!0,this.host.isGrayColor,this.host.visibilityValue,this.host.isPinValue),this.tOver+=.015,this.tOverPopupSummary+=this.host.scene.annotationInstance.renderer.dt,this.tDown1=0,this.host.isLeave=!0):this.host.isLeave&&!this.host.isDrag?(t.pointRegularOverBoundingBySVGPath(e,this.host.styleComponent.renderStyle,this.host.vec.x,this.host.vec.y,this.host.scaleForRender*this.host.scene.annotationInstance.activeCommandController.scaleGlobal,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tDown1),!1,!0,this.host.isGrayColor,this.host.visibilityValue,this.host.isPinValue),this.tDown1+=this.host.scene.annotationInstance.renderer.dt,this.tOver=this.tOverPopupSummary=0,this.tDown1>.15&&(this.host.isLeave=!1)):this.host.isDrag||(t.pointRegularOverBoundingBySVGPath(e,this.host.styleComponent.renderStyle,this.host.vec.x,this.host.vec.y,this.host.scaleForRender*this.host.scene.annotationInstance.activeCommandController.scaleGlobal,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tDown1),!1,!1,this.host.isGrayColor,this.host.visibilityValue,this.host.isPinValue),this.tDown1+=this.host.scene.annotationInstance.renderer.dt,this.tOver=this.tOverPopupSummary=0),t.pointRegularDragBySVGPath(e,this.host.styleComponent.renderStyle,this.host.vec.x,this.host.vec.y,this.host.scaleForRender*this.host.scene.annotationInstance.activeCommandController.scaleGlobal,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tDown2),!1,!1,this.host.isGrayColor,this.host.visibilityValue,this.host.isPinValue,this.host.isHoverValue,this.host.isSelectedValue),this.tUp=0,this.tDown2+=.5*this.host.scene.annotationInstance.renderer.dt),this.host.hasPopup&&this.host.isMove&&this.host.updateDivPos(),this.t+=this.host.scene.annotationInstance.renderer.dt,this.offScreenRender()}},t.prototype.offScreenRender=function(){this.host.scene.annotationInstance.renderer.offscreen.rPointOffscreen(this.host.scene.annotationInstance.renderer.ctxOffscreen,this.host.hashColor,this.host.vec,this.host.scaleForRender)},t}(C),Gn=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Wn=function(e){function t(t){var n=e.call(this,t)||this;return n.host=t,n.pointRenderType=r.oW.RpointA,n}return Gn(t,e),t.prototype.renderPost=function(e){if(this.host.inspector.update(e),this.interpolateColor.update(),!(this.host.isCollapse||this.host.scaleForRender<.01)){switch(this.host.hasPopup&&this.host.isMove&&this.host.updateDivPos(),this.pointRenderType){case r.oW.RpointA:this.renderPointA(e);break;case r.oW.Image:this.renderPointIcon(e)}this.t+=this.host.scene.annotationInstance.renderer.dt,this.offScreenRender()}},t.prototype.renderPointA=function(e){var t=this.host.scene.annotationInstance.renderer.draw.shape.pointGeneric,n=this.host.scene.annotationInstance.renderer.draw.shape.point,o=this.host.scene.annotationInstance.geometryCommon.gcmdSupporting.toScreenVecOnCropping(this.host.vec),i=this.host.styleComponent.renderStyle.scaleGlobal*this.host.styleComponent.renderStyle.scaleLocal;this.geo.collision.updateByScale(i),this.host.isDrag?(n.shadowRPoint(e,this.host.styleComponent.renderStyle,o.x,o.y,this.host.isSelected,this.host.isHover),t.pointGenericOverBoundingSelected(e,this.pointRenderType,this.host.styleComponent.renderStyle,o.x,o.y,i,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tOver),!0,!0,this.host.isGrayColor,this.host.visibilityValue,this.host.isPinValue),t.pointGenericDrag(e,this.pointRenderType,this.host.styleComponent.renderStyle,o.x,o.y,i,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tUp),!0,!0,this.host.isGrayColor,this.host.visibilityValue,this.host.isPinValue,this.host.isHoverValue,this.host.isSelectedValue),this.tUp+=.015,this.tDown2=0):(this.host.isSelectedValue?(n.shadowRPoint(e,this.host.styleComponent.renderStyle,o.x,o.y,this.host.isSelected,this.host.isHover),t.pointGenericOverBoundingSelected(e,this.pointRenderType,this.host.styleComponent.renderStyle,o.x,o.y,i,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tOver),!0,!0,this.host.isGrayColor,this.host.visibilityValue,this.host.isPinValue),this.tOver+=.015,this.tDown1=0,this.host.isHoverValue?this.tOverPopupSummary+=this.host.scene.annotationInstance.renderer.dt:this.tOverPopupSummary=0,this.host.isLeave=!0):this.host.isHoverValue?(n.shadowRPointLight(e,this.host.styleComponent.renderStyle,o.x,o.y,i,this.host.isSelected,this.host.isHover),t.pointGenericOverBounding(e,this.pointRenderType,this.host.styleComponent.renderStyle,o.x,o.y,i,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tOver),!0,!0,this.host.isGrayColor,this.host.visibilityValue,this.host.isPinValue),this.tOver+=.015,this.tOverPopupSummary+=this.host.scene.annotationInstance.renderer.dt,this.tDown1=0,this.host.isLeave=!0):this.host.isLeave&&!this.host.isDrag?(t.pointGenericOverBounding(e,this.pointRenderType,this.host.styleComponent.renderStyle,o.x,o.y,i,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tDown1),!1,!0,this.host.isGrayColor,this.host.visibilityValue,this.host.isPinValue),this.tDown1+=this.host.scene.annotationInstance.renderer.dt,this.tOver=this.tOverPopupSummary=0,this.tDown1>.15&&(this.host.isLeave=!1)):this.host.isDrag||(t.pointGenericOverBounding(e,this.pointRenderType,this.host.styleComponent.renderStyle,o.x,o.y,i,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tDown1),!1,!1,this.host.isGrayColor,this.host.visibilityValue,this.host.isPinValue),this.tDown1+=this.host.scene.annotationInstance.renderer.dt,this.tOver=this.tOverPopupSummary=0),t.pointGenericDrag(e,this.pointRenderType,this.host.styleComponent.renderStyle,o.x,o.y,i,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tDown2),!1,!1,this.host.isGrayColor,this.host.visibilityValue,this.host.isPinValue,this.host.isHoverValue,this.host.isSelectedValue),this.tUp=0,this.tDown2+=.5*this.host.scene.annotationInstance.renderer.dt)},t.prototype.renderPointIcon=function(e){var t=this.host.scene.annotationInstance.renderer.draw.shape.pointGeneric,n=this.host.scene.annotationInstance.renderer.draw.shape.point,o=this.host.styleComponent.img.width*this.host.scene.annotationInstance.customization.themeCurrent.rPoint.scale,i=this.host.styleComponent.img.height*this.host.scene.annotationInstance.customization.themeCurrent.rPoint.scale;this.renderImg(e,this.host.styleComponent.img,this.host.vec.x-.5*o,this.host.vec.y-i,o,i,this.host.isHover,this.host.isSelectedValue),this.host.isDrag?(t.pointGenericDrag(e,this.pointRenderType,this.host.styleComponent.renderStyle,this.host.vec.x,this.host.vec.y,this.host.scaleForRender,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tUp),!0,!0,this.host.isGrayColor,this.host.visibilityValue,this.host.isPinValue,this.host.isHoverValue,this.host.isSelectedValue),this.tUp+=.015,this.tDown2=0):(this.host.isSelectedValue?(n.shadowRPoint(e,this.host.styleComponent.renderStyle,this.host.vec.x,this.host.vec.y,this.host.isSelected,this.host.isHover),this.tOver+=.015,this.tDown1=0,this.host.isHoverValue?this.tOverPopupSummary+=this.host.scene.annotationInstance.renderer.dt:this.tOverPopupSummary=0,this.host.isLeave=!0):this.host.isHoverValue?(n.shadowRPointLight(e,this.host.styleComponent.renderStyle,this.host.vec.x,this.host.vec.y,this.host.scaleForRender,this.host.isSelected,this.host.isHover),this.tOver+=.015,this.tOverPopupSummary+=this.host.scene.annotationInstance.renderer.dt,this.tDown1=0,this.host.isLeave=!0):this.host.isLeave&&!this.host.isDrag?(this.tDown1+=this.host.scene.annotationInstance.renderer.dt,this.tOver=this.tOverPopupSummary=0,this.tDown1>.15&&(this.host.isLeave=!1)):this.host.isDrag||(this.tDown1+=this.host.scene.annotationInstance.renderer.dt,this.tOver=this.tOverPopupSummary=0),t.pointGenericDrag(e,this.pointRenderType,this.host.styleComponent.renderStyle,this.host.vec.x,this.host.vec.y,this.host.scaleForRender,this.geo.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.tDown2),!1,!1,this.host.isGrayColor,this.host.visibilityValue,this.host.isPinValue,this.host.isHoverValue,this.host.isSelectedValue),this.tUp=0,this.tDown2+=.5*this.host.scene.annotationInstance.renderer.dt)},t.prototype.renderImg=function(e,t,n,o,i,s,r,a){r||a||(e.globalAlpha=this.interpolateColor.opacity),e.drawImage(t,n,o,i,s),e.globalAlpha=1},t.prototype.offScreenRender=function(){switch(this.pointRenderType){case r.oW.RpointA:this.host.scene.annotationInstance.renderer.offscreen.rPointOffscreen(this.host.scene.annotationInstance.renderer.ctxOffscreen,this.host.hashColor,this.host.vec,this.host.scaleForRender);break;case r.oW.Image:this.host.scene.annotationInstance.renderer.ctxOffscreen.fillStyle=this.host.hashColor,this.host.scene.annotationInstance.renderer.ctxOffscreen.beginPath(),this.host.scene.annotationInstance.renderer.ctxOffscreen.rect(this.host.collision.minVec.x,this.host.collision.minVec.y,this.host.collision.maxVec.x-this.host.collision.minVec.x,this.host.collision.maxVec.y-this.host.collision.minVec.y),this.host.scene.annotationInstance.renderer.ctxOffscreen.closePath(),this.host.scene.annotationInstance.renderer.ctxOffscreen.fill()}},t}(zn),Bn=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Hn=function(e){function t(t){var n=e.call(this,t)||this;return n.img=new Image,n.defaultURL=n.geo.scene.annotationInstance.implementations.app.CONFIG.config.BASE_URL+"/static/storymaps-xgraphics/images/theme-assets/common/unnumbered-pin.svg",n.updateStyle(),n.updateColor(),n}return Bn(t,e),t.prototype.updateStyle=function(){this.isCustom||(this.state.themeColorId=s.AccentColor1,this.isCustom=!0,this.url=this.geo.scene.annotationInstance.customization.themeCurrent.rPoint.URL,x.updateRenderStyleRPoint(this.renderStyle,this.geo.scene.annotationInstance.customization.themeCurrent))},t.prototype.updateColor=function(e){void 0===e&&(e=void 0),this.isCustom=!0,void 0===e&&(e=this.geo.scene.annotationInstance.activeCommandController.activeColorController.activeColor),x.updateRenderColorRPointCustom(this.renderStyle,this.geo.scene.annotationInstance.customization.themeCurrent,e),this.tempColorRgba=e},t.prototype.updateStyleCustom=function(e){var t=this,n=!1;return e.size&&(this.geo.size=e.size.toUpperCase(),this.renderStyle.size=this.geo.size,n=!0),e.url&&this.url!==e.url&&(this.url=e.url,this.img=new Image,this.img.src=this.url,this.img.onload=function(){e.size?(t.geo.size=e.size.toUpperCase(),t.renderStyle.size=t.geo.size):t.geo.size=r.$u.MEDIUM,e.url!==t.defaultURL?t.geo.renderer.pointRenderType=r.oW.Image:t.geo.renderer.pointRenderType=r.oW.RpointA,n=!0}),e.width&&(this.state.width=e.width),void 0!==e.color&&(this.state.themeColorId=e.color),e.colorRgba.length>0&&(this.tempColorRgba=e.colorRgba,x.updateRenderColorRPointCustom(this.renderStyle,this.geo.scene.annotationInstance.customization.themeCurrent,e.colorRgba),this.updateColor(e.colorRgba)),e.scale&&(this.renderStyle.scaleLocal=e.scale,this.state.scale=e.scale),"string"==typeof e.symbol&&(this.symbol=e.symbol),this.isCustom=!0,n&&!this.geo.isUnderConstruction&&(this.geo.isTransform=!0),!0},t.prototype.toJson=function(){if(this.isCustom){var e={width:this.state.width,scale:this.renderStyle.scaleLocal,colorRgba:this.tempColorRgba,url:this.url};return this.renderStyle.size!==r.$u.MEDIUM&&(e.size=this.renderStyle.size.toLowerCase()),this.url!==this.defaultURL&&(e.symbolType="image"),this.symbol&&(e.symbol=this.symbol),this.state.themeColorId!==s.AccentColor1&&(e.color=this.state.themeColorId),e}},t.prototype.isSameStyle=function(e){if(e.size&&e.size!==this.renderStyle.size.toLowerCase())return!1;if(e.colorRgba.length===this.tempColorRgba.length)for(var t=0;t<e.colorRgba.length;t++)if(e.colorRgba[t]!==this.tempColorRgba[t])return!1;return this.url===e.url},t}(b),Fn=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Un=function(e){function t(t){var n=e.call(this,t)||this;return n.geo=t,n}return Fn(t,e),t.prototype.translateByMouseEventData=function(e){this.geo.isDrag=!0,this.geo.vec.x+=e.x-e.preX,this.geo.vec.y+=e.y-e.preY,this.geo.updatePostTransformation()},t.prototype.translate=function(e,t){},t}(Y),jn=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();!function(e){e[e.LARGE=1.2]="LARGE",e[e.MEDIUM=1]="MEDIUM",e[e.SMALL=.832]="SMALL"}(bt||(bt={}));var qn=function(e){function t(t,n,o,i,s,a,h,c,p,l){void 0===n&&(n=0),void 0===o&&(o=0),void 0===i&&(i=0),void 0===s&&(s=!1),void 0===a&&(a=r.zq.POINT_REGULAR),void 0===h&&(h=5),void 0===c&&(c="white"),void 0===p&&(p="black"),void 0===l&&(l=r.cg.Round);var d=e.call(this,t,n,o,i,a)||this;return d.iconSize=1,d.isUndo=s,d.scaleForRender=1,d.initComponent(),d.updateBoundingBox(),t.addRPoint(d),d.isUndo||t.annotationInstance.io.eventListenerAnnotation.addGeometryStack(d.toJSON()),d}return jn(t,e),t.findAtPoint=function(e,t,n){for(var o=e.listRPoint.length-1;o>=0;--o)if(e.listRPoint[o].isSelectable&&e.listRPoint[o].isMouseInside(t,n))return e.listRPoint[o]},t.getLengthSelection=function(e){for(var t=e.listRPoint.length,n=0;t--;)e.listRPoint[t].isSelected&&(n+=1);return n},t.removeAllCapturedGeo=function(e){for(var t=e.listRPoint,n=0;n<t.length;++n)!0===e.listRPoint[n].isSelectedValue&&e.listRPoint[n].remove()},t.deSelecteCaptureObjects=function(e){for(var t=0;t<e.listRPoint.length;++t)e.listRPoint[t].isSelectedValue=!1},t.moveSelectedGeo=function(e,t){for(var n=0;n<e.listRPoint.length;++n)!0!==e.listRPoint[n].isSelectedValue||e.listRPoint[n].isHoverValue||e.listRPoint[n].translateByMouseEventData(t),!0===e.listRPoint[n].isHoverValue&&e.listRPoint[n].translateByMouseEventData(t)},t.fromJSON=function(e,n,o,i){void 0===o&&(o=!1),void 0===i&&(i=!1);var s=[n.nodes[0].sx,n.nodes[0].sy],a=new t(e,s[0],s[1],0,o);return n.styles&&a.updateStyleCustom(n.styles),a.type=r.zq[n.type],a.isHiddenValue=n.isHidden,a.id=i?e.getUUID():n.id,n.isHidden?a.visibilityValue=0:a.visibilityValue=1,n.data.scale&&a.initScale(n.data.scale),n.data.url&&a.updateIcon(n.data.url),a.initVecsHistory(),a},t.mouseRightClick=function(e){},t.mouseMiddleClick=function(e){},t.mouseLeftClick=function(e,n){void 0===e.capture&&(new t(e,n.x,n.y,0).dummy(),e.annotationInstance.activeCommandController.acProperties.pressShift||e.annotationInstance.activeCommandController.goToACMode())},t.onMouseMove=function(e){},t.mouseDrag=function(e){},t.mouseUp=function(e){},t.prototype.initComponent=function(){this.styleComponent=new Hn(this),this.renderer=new Wn(this),this.transformation=new Un(this),this.interaction=new Dn(this)},t.prototype.init=function(){this.isGeoPos=!0,this.edges=[],this.isPointMid=!1},t.prototype.getParentType=function(){return"ANNOTATION_POINT_REGULAR"},t.prototype.renderPost=function(e){isNaN(this.vec.x)||(this.renderer.renderPost(e),this.scene.annotationInstance.implementations.app.INSPECTION&&this.collision.render(e))},t.prototype.isMouseInside=function(e,t){return this.interaction.isMouseInside(e,t)},t.prototype.isMouseInsideWithTolerance=function(e,t,n){return!(this.isRemove||!this.isRenderable||this.isHiddenValue)&&!this.isCollapse&&this.distance(e,t+11*this.scaleForRender)<=this.r*this.scaleForRender+12*this.scaleForRender+n},t.prototype.getLog=function(){return this.interaction.getLog()},t.prototype.hide=function(){this.interaction.hide()},Object.defineProperty(t.prototype,"isSelected",{get:function(){return this.isSelectedValue},set:function(e){this.isSelectedValue=e,this.scene.annotationInstance.io.eventListenerAnnotation.selectionStack(this.toJSON())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isHover",{get:function(){return this.isHoverValue},set:function(e){this.isHoverValue=e,(this.isHoverValue&&!this.isHoverPre||!this.isHoverValue&&this.isHoverPre)&&this.scene.annotationInstance.io.eventListenerAnnotation.hoverStack(this.toJSON()),this.isHoverPre=this.isHoverValue,e||(this.needEmitHoverPost=!0,this.hidePopUpSummary())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isPin",{get:function(){return this.isPinValue},set:function(e){this.isPinValue=e},enumerable:!1,configurable:!0}),t.prototype.translateByMouseEventData=function(e){this.isMovableValue&&(this.isRemove||!this.isRenderable||this.isHiddenValue||(this.transformation.translateByMouseEventData(e),this.textLeaderline&&(this.textLeaderline.translateByMouseEventData(e),this.textLeaderline&&this.textLeaderline.leaderline&&(this.textLeaderline.leaderline.v2.x=this.vec.x,this.textLeaderline.leaderline.v2.y=this.vec.y))))},t.prototype.translate=function(e,t){this.transformation.translate(e,t)},t.prototype.updateDivPos=function(){this.interaction.updateDivPos()},t.prototype.showPopupSummary=function(){this.interaction.showPopupSummary()},t.prototype.updatePopup=function(){this.interaction.updatePopup()},t.prototype.updateIcon=function(e){this.renderer.pointRenderType=r.oW.Image,this.styleComponent.renderStyle.url=e},t.prototype.removeIcon=function(){this.renderer.pointRenderType=r.oW.RpointA},t.prototype.remove=function(e){if(void 0===e&&(e=!0),this.isRenderable&&!this.isHiddenValue){if(this.isRemove=!0,this.isSelectable=!1,this.isRenderable=!1,this.hasPopupValue&&this.hidePopUpSummary(),!this.isGhost&&e){var t=this.toJSON();t&&this.scene.annotationInstance.io.eventListenerAnnotation.removeGeometryStack([t])}this.textLeaderline&&(this.textLeaderline.removeByAttachedShape(),this.textLeaderline=void 0),this.scene.removeBasePoint(this),this.scene.removeRPoint(this),this.scene.removeGeometry(this)}},t.prototype.deepCopy=function(e,n){return new t(this.scene,e,n,this.vec.z,!1,this.type,this.r)},t.prototype.mouseLeftClick=function(){this.isGhost||(this.scene.annotationInstance.geometryCommon.gcmdProcessing.removeAllPopup(),this.showPopupSummary())},t.prototype.updateBoundingBox=function(){this.scaleForRender=this.iconSize*this.scene.annotationInstance.customization.themeCurrent.rPoint.scale;var e=this.scaleForRender,t=32*e,n=23*e*.65;this.collision.minVec=new r.h9(this.vec.x-n-4,this.vec.y-t-2),this.collision.maxVec=new r.h9(this.vec.x+n+-4,this.vec.y+1)},Object.defineProperty(t.prototype,"size",{get:function(){return this.sizeValue},set:function(e){if(this.sizeValue=e,this.styleComponent.img){var t=[];switch(e){case r.$u.LARGE:this.iconSize=bt.LARGE,this.styleComponent.renderStyle.size=r.$u.LARGE,t=this.styleComponent.img.width>this.styleComponent.img.height?(0,r.kC)(this.styleComponent.img.width,this.styleComponent.img.height,40):(0,r.Ux)(this.styleComponent.img.width,this.styleComponent.img.height,40),this.styleComponent.img.width=t[0],this.styleComponent.img.height=t[1];break;case r.$u.MEDIUM:this.iconSize=bt.MEDIUM,this.styleComponent.renderStyle.size=r.$u.MEDIUM,t=this.styleComponent.img.width>this.styleComponent.img.height?(0,r.kC)(this.styleComponent.img.width,this.styleComponent.img.height,32):(0,r.Ux)(this.styleComponent.img.width,this.styleComponent.img.height,32),this.styleComponent.img.width=t[0],this.styleComponent.img.height=t[1];break;case r.$u.SMALL:this.iconSize=bt.SMALL,this.styleComponent.renderStyle.size=r.$u.SMALL,t=this.styleComponent.img.width>this.styleComponent.img.height?(0,r.kC)(this.styleComponent.img.width,this.styleComponent.img.height,28):(0,r.Ux)(this.styleComponent.img.width,this.styleComponent.img.height,28),this.styleComponent.img.width=t[0],this.styleComponent.img.height=t[1]}}if(this.renderType!==r.oW.Image)switch(e){case r.$u.LARGE:this.iconSize=bt.LARGE,this.styleComponent.renderStyle.size=r.$u.LARGE;break;case r.$u.MEDIUM:this.iconSize=bt.MEDIUM,this.styleComponent.renderStyle.size=r.$u.MEDIUM;break;case r.$u.SMALL:this.iconSize=bt.SMALL,this.styleComponent.renderStyle.size=r.$u.SMALL}this.updateBoundingBox()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"renderType",{get:function(){return this.renderer.pointRenderType},set:function(e){this.renderer.pointRenderType=e},enumerable:!1,configurable:!0}),t}(v),Jn=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Yn=function(e){function t(t){return e.call(this,t)||this}return Jn(t,e),t.prototype.mouseLeftClick=function(e){k.mouseLeftClick(this.acs.imageAnnoApp.scene,e)},t.prototype.mouseMiddleClick=function(e){k.mouseMiddleClick(e)},t.prototype.mouseRightClick=function(e){k.mouseRightClick(e)},t.prototype.mouseMove=function(e){},t.prototype.mouseDrag=function(e){},t}(Oe),Xn=function(e){function t(t){return e.call(this,t)||this}return Jn(t,e),t.prototype.mouseLeftClick=function(e){qn.mouseLeftClick(this.acs.imageAnnoApp.scene,e)},t}(Yn),Kn=function(e){function t(t){return e.call(this,t)||this}return Jn(t,e),t.prototype.mouseLeftClick=function(e){Tn.mouseLeftClick(this.acs.imageAnnoApp.scene,e)},t}(Yn),$n=function(e){function t(t){return e.call(this,t)||this}return Jn(t,e),t.prototype.mouseLeftClick=function(e){xn.mouseLeftClick(this.acs.imageAnnoApp.scene,e)},t}(Yn),Qn=function(e){function t(t){return e.call(this,t)||this}return Jn(t,e),t.prototype.mouseDown=function(e){wt.mouseDown(this.acs.imageAnnoApp.scene,e,r.zq.ARROW_SINGLE)},t.prototype.mouseLeftClick=function(e){wt.mouseLeftClick(this.acs.imageAnnoApp.scene,e,r.zq.ARROW_SINGLE)},t.prototype.mouseMove=function(e){wt.mouseMove(this.acs.imageAnnoApp.scene,e,r.zq.ARROW_SINGLE)},t.prototype.mouseUp=function(e){wt.mouseUp(e)},t.prototype.keydown=function(e){"Escape"!==e.key&&81!==e.keyCode&&13!==e.keyCode||wt.cancel()},t}(Oe),Zn=function(e){function t(t){return e.call(this,t)||this}return Jn(t,e),t.prototype.mouseDown=function(e){wt.mouseDown(this.acs.imageAnnoApp.scene,e,r.zq.ARROW_DOUBLE)},t.prototype.mouseLeftClick=function(e){wt.mouseLeftClick(this.acs.imageAnnoApp.scene,e,r.zq.ARROW_DOUBLE)},t.prototype.mouseMove=function(e){void 0!==wt.condition.v0&&wt.drawShadow(this.acs.imageAnnoApp.scene,e,r.zq.ARROW_DOUBLE)},t}(Qn),eo=function(e){function t(t){return e.call(this,t)||this}return Jn(t,e),t.prototype.mouseDown=function(e){ct.mouseDown(this.acs.imageAnnoApp.scene,e)},t.prototype.mouseLeftClick=function(e){ct.mouseLeftClick(this.acs.imageAnnoApp.scene,e)},t.prototype.mouseDoubleClick=function(e){ct.mouseDoubleClick(this.acs.imageAnnoApp.scene,e)},t.prototype.mouseMove=function(e){ct.mouseMove(e)},t.prototype.keydown=function(e){27===e.keyCode&&ct.cancel(),81!==e.keyCode&&13!==e.keyCode||ct.doneByKeyboard(this.acs.imageAnnoApp.scene)},t.prototype.undo=function(){ct.undo(this.acs.m)},t}(Oe),to=function(e){function t(t){return e.call(this,t)||this}return Jn(t,e),t.prototype.mouseLeftClick=function(e){ct.mouseLeftClick(this.acs.imageAnnoApp.scene,e,!0)},t.prototype.mouseDoubleClick=function(e){ct.mouseDoubleClick(this.acs.imageAnnoApp.scene,e,!0)},t.prototype.mouseDown=function(e){ct.mouseDown(this.acs.imageAnnoApp.scene,e,!0)},t.prototype.mouseMove=function(e){ct.mouseMove(e)},t}(eo),no=function(e){function t(t){return e.call(this,t)||this}return Jn(t,e),t.prototype.mouseDown=function(e){gn.mouseDown(this.acs.imageAnnoApp.scene,e,r.iu.Polyline)},t.prototype.mouseDrag=function(e){gn.mouseDrag(this.acs.imageAnnoApp.scene,e,r.iu.Polyline)},t.prototype.mouseUp=function(e){gn.mouseUp(this.acs.imageAnnoApp.scene,e)},t.prototype.keydown=function(e){27===e.keyCode&&gn.cancel()},t.prototype.mouseMove=function(e){gn.mouseMove(this.acs.imageAnnoApp.scene,e,r.iu.Polyline)},t}(Oe),oo=function(e){function t(t){return e.call(this,t)||this}return Jn(t,e),t.prototype.mouseDown=function(e){gn.mouseDown(this.acs.imageAnnoApp.scene,e,r.iu.PolylineBending)},t.prototype.mouseDrag=function(e){gn.mouseDrag(this.acs.imageAnnoApp.scene,e,r.iu.PolylineBending)},t.prototype.mouseUp=function(e){gn.mouseUp(this.acs.imageAnnoApp.scene,e)},t.prototype.keydown=function(e){27===e.keyCode&&gn.cancel()},t.prototype.mouseMove=function(e){gn.mouseMove(this.acs.imageAnnoApp.scene,e,r.iu.PolylineBending)},t.prototype.cancel=function(){gn.cancel()},t}(Oe),io=function(e){function t(t){return e.call(this,t)||this}return Jn(t,e),t.prototype.mouseDown=function(e){gn.mouseDown(this.acs.imageAnnoApp.scene,e,r.iu.Polygon)},t.prototype.mouseDrag=function(e){gn.mouseDrag(this.acs.imageAnnoApp.scene,e,r.iu.Polygon)},t.prototype.mouseUp=function(e){gn.mouseUp(this.acs.imageAnnoApp.scene,e)},t.prototype.keydown=function(e){27===e.keyCode&&gn.cancel()},t.prototype.mouseMove=function(e){gn.mouseMove(this.acs.imageAnnoApp.scene,e,r.iu.Polygon)},t}(Oe),so=function(e){function t(t){return e.call(this,t)||this}return Jn(t,e),t.prototype.mouseDown=function(e){gn.mouseDown(this.acs.imageAnnoApp.scene,e,r.iu.PolygonGraph)},t.prototype.mouseDrag=function(e){gn.mouseDrag(this.acs.imageAnnoApp.scene,e,r.iu.PolygonGraph)},t.prototype.mouseUp=function(e){gn.mouseUp(this.acs.imageAnnoApp.scene,e)},t.prototype.keydown=function(e){27===e.keyCode&&gn.cancel()},t.prototype.mouseMove=function(e){gn.mouseMove(this.acs.imageAnnoApp.scene,e,r.iu.PolygonGraph)},t.prototype.cancel=function(){gn.cancel()},t}(Oe),ro=function(e){function t(t){return e.call(this,t)||this}return Jn(t,e),t.prototype.mouseDown=function(e){gn.mouseDown(this.acs.imageAnnoApp.scene,e,r.iu.Curve)},t.prototype.mouseMove=function(e){gn.mouseMove(this.acs.imageAnnoApp.scene,e,r.iu.Curve)},t}(no),ao=function(e){function t(t){return e.call(this,t)||this}return Jn(t,e),t.prototype.mouseDown=function(e){gn.mouseDown(this.acs.imageAnnoApp.scene,e,r.iu.CurveClosed)},t.prototype.mouseMove=function(e){gn.mouseMove(this.acs.imageAnnoApp.scene,e,r.iu.CurveClosed)},t}(no),ho=function(e){function t(t){return e.call(this,t)||this}return Jn(t,e),t.prototype.mouseDown=function(e){ae.mouseDown(this.acs.imageAnnoApp.scene,e)},t.prototype.mouseLeftClick=function(e){var t=128*this.acs.scaleGlobal;ae.onMouseLeftClick(this.acs.imageAnnoApp.scene,e,t,t)},t.prototype.mouseMiddleClick=function(e){},t.prototype.mouseRightClick=function(e){ae.onMouseRightClick(e)},t.prototype.mouseMove=function(e){ae.onMouseMove(this.acs.imageAnnoApp.scene,e)},t.prototype.mouseDrag=function(e){ae.onMouseDrag(this.acs.imageAnnoApp.scene,e)},t.prototype.mouseUp=function(e){ae.onMouseUp(this.acs.imageAnnoApp.scene,e)},t.prototype.keydown=function(e){"Escape"!==e.key&&81!==e.keyCode&&13!==e.keyCode||ae.cancel()},t.prototype.cancel=function(){ae.cancel()},t}(Oe),co=function(e){function t(t){return e.call(this,t)||this}return Jn(t,e),t.prototype.mouseDown=function(e){Q.mouseDown(this.acs.imageAnnoApp.scene,e)},t.prototype.mouseLeftClick=function(e){var t=128*this.acs.scaleGlobal;Q.onMouseLeftClick(this.acs.imageAnnoApp.scene,e,t,t)},t.prototype.mouseMiddleClick=function(e){},t.prototype.mouseRightClick=function(e){Q.onMouseRightClick(e)},t.prototype.mouseMove=function(e){},t.prototype.mouseDrag=function(e){Q.onMouseDrag(this.acs.imageAnnoApp.scene,e)},t.prototype.mouseUp=function(e){Q.onMouseUp(this.acs.imageAnnoApp.scene,e)},t.prototype.keydown=function(e){27===e.keyCode&&Q.cancel()},t.prototype.cancel=function(){Q.cancel()},t}(Oe),po=function(e){function t(t){return e.call(this,t)||this}return Jn(t,e),t.prototype.mouseDown=function(e){He.getCircleByArea(this.acs.imageAnnoApp.scene,5e5,e.x,e.y)},t.prototype.mouseLeftClick=function(e){He.construction&&(He.construction.isSelected=!1,He.construction=void 0),this.acs.imageAnnoApp.activeCommandController.goToACMode()},t.prototype.mouseMiddleClick=function(e){},t.prototype.mouseRightClick=function(e){He.onMouseRightClick(e)},t.prototype.mouseMove=function(e){He.onMouseMove(e)},t.prototype.mouseDrag=function(e){},t.prototype.keydown=function(e){27===e.keyCode&&He.cancel()},t}(Oe),lo=function(e){function t(t){return e.call(this,t)||this}return Jn(t,e),t.prototype.mouseDown=function(e){He.getCircleByCircumference(this.acs.imageAnnoApp.scene,500,e.x,e.y)},t.prototype.mouseLeftClick=function(e){He.construction&&(He.construction.isSelected=!1,He.construction=void 0),this.acs.imageAnnoApp.activeCommandController.goToACMode()},t.prototype.mouseMiddleClick=function(e){},t.prototype.mouseRightClick=function(e){He.onMouseRightClick(e)},t.prototype.mouseMove=function(e){He.onMouseMove(e)},t.prototype.mouseDrag=function(e){},t.prototype.keydown=function(e){27===e.keyCode&&He.cancel()},t}(Oe),uo=function(e){function t(t){return e.call(this,t)||this}return Jn(t,e),t.prototype.mouseLeftClick=function(e){M.mouseLeftClick(this.acs.imageAnnoApp.scene,e)},t.prototype.mouseMove=function(e){M.mouseMove(e)},t.prototype.mouseDoubleClick=function(e){M.mouseDoubleClick(this.acs.imageAnnoApp.scene,e)},t.prototype.mouseDown=function(e){M.mouseDown(this.acs.imageAnnoApp.scene,e)},t.prototype.keydown=function(e){27===e.keyCode&&M.cancel(this.acs.imageAnnoApp.scene),81!==e.keyCode&&13!==e.keyCode||M.doneByKeyboard(this.acs.imageAnnoApp.scene)},t.prototype.undo=function(){M.undo(this.acs.imageAnnoApp.scene,this.acs.m)},t}(Oe),yo=function(e){function t(t){return e.call(this,t)||this}return Jn(t,e),t.prototype.mouseLeftClick=function(e){fe.mouseLeftClick(this.acs.imageAnnoApp.scene,e)},t.prototype.mouseMove=function(e){fe.mouseMove(this.acs.imageAnnoApp.scene,e)},t.prototype.mouseDoubleClick=function(e){fe.mouseDoubleClick(this.acs.imageAnnoApp.scene,e)},t.prototype.mouseDown=function(e){fe.mouseDown(this.acs.imageAnnoApp.scene,e)},t.prototype.keydown=function(e){27===e.keyCode&&fe.cancel(this.acs.imageAnnoApp.scene),81!==e.keyCode&&13!==e.keyCode||fe.doneByKeyboard(this.acs.imageAnnoApp.scene)},t.prototype.undo=function(){fe.undo(this.acs.imageAnnoApp.scene,this.acs.m)},t}(Oe),mo=function(e){function t(t){return e.call(this,t)||this}return Jn(t,e),t.prototype.mouseLeftClick=function(e){M.mouseLeftClick(this.acs.imageAnnoApp.scene,e,!0)},t.prototype.mouseMove=function(e){M.mouseMove(e)},t.prototype.mouseDoubleClick=function(e){M.mouseDoubleClick(this.acs.imageAnnoApp.scene,e)},t.prototype.mouseDown=function(e){M.mouseDown(this.acs.imageAnnoApp.scene,e,!0)},t.prototype.keydown=function(e){27===e.keyCode&&M.cancel(this.acs.imageAnnoApp.scene),81!==e.keyCode&&13!==e.keyCode||M.doneByKeyboard(this.acs.imageAnnoApp.scene)},t.prototype.undo=function(){M.undo(this.acs.imageAnnoApp.scene,this.acs.m)},t}(Oe),vo=function(e){function t(t){return e.call(this,t)||this}return Jn(t,e),t.prototype.mouseLeftClick=function(e){B.mouseLeftClick(this.acs.imageAnnoApp.scene,e)},t.prototype.mouseMove=function(e){B.mouseMove(e)},t.prototype.mouseDoubleClick=function(e){B.mouseDoubleClick(this.acs.imageAnnoApp.scene,e)},t.prototype.mouseDown=function(e){B.mouseDown(this.acs.imageAnnoApp.scene,e)},t.prototype.keydown=function(e){27===e.keyCode&&B.cancel(this.acs.imageAnnoApp.scene),81!==e.keyCode&&13!==e.keyCode||B.doneByKeyboard(this.acs.imageAnnoApp.scene)},t.prototype.undo=function(){B.undo(this.acs.imageAnnoApp.scene,this.acs.m)},t}(Oe),go=function(e){function t(t){return e.call(this,t)||this}return Jn(t,e),t.prototype.mouseLeftClick=function(e){ot.mouseLeftClick(this.acs.imageAnnoApp.scene,e)},t.prototype.mouseMove=function(e){ot.mouseMove(this.acs.imageAnnoApp.scene,e)},t.prototype.mouseDoubleClick=function(e){ot.mouseDoubleClick(this.acs.imageAnnoApp.scene,e)},t.prototype.mouseDown=function(e){ot.mouseDown(this.acs.imageAnnoApp.scene,e)},t.prototype.keydown=function(e){27===e.keyCode&&ot.cancel(this.acs.imageAnnoApp.scene),81!==e.keyCode&&13!==e.keyCode||ot.doneByKeyboard(this.acs.imageAnnoApp.scene)},t.prototype.undo=function(){ot.undo(this.acs.imageAnnoApp.scene,this.acs.m)},t}(Oe),fo=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Jn(t,e),t}(Oe),Co=function(e){function t(t){return e.call(this,t)||this}return Jn(t,e),t.prototype.mouseLeftClick=function(e){B.mouseLeftClick(this.acs.imageAnnoApp.scene,e,!0)},t.prototype.mouseMove=function(e){B.mouseMove(e)},t.prototype.mouseDoubleClick=function(e){B.mouseDoubleClick(this.acs.imageAnnoApp.scene,e)},t.prototype.mouseDown=function(e){B.mouseDown(this.acs.imageAnnoApp.scene,e)},t.prototype.keydown=function(e){27===e.keyCode&&B.cancel(this.acs.imageAnnoApp.scene),81!==e.keyCode&&13!==e.keyCode||B.doneByKeyboard(this.acs.imageAnnoApp.scene)},t.prototype.undo=function(){B.undo(this.acs.imageAnnoApp.scene,this.acs.m)},t}(Oe),So=function(e){function t(t){return e.call(this,t)||this}return Jn(t,e),t.prototype.mouseLeftClick=function(e){this.acs.imageAnnoApp.activeCommandController.IsTextEditing=!0,sn.mouseLeftClick(this.acs.imageAnnoApp.scene,e)},t.prototype.mouseMove=function(e){sn.mouseMove(e)},t}(Oe),Ao=function(e){function t(t){return e.call(this,t)||this}return Jn(t,e),t.prototype.mouseDown=function(e){ln.mouseDown(this.acs.imageAnnoApp.scene,e)},t.prototype.mouseDrag=function(e){ln.mouseDrag(e)},t.prototype.mouseUp=function(e){ln.mouseUp(this.acs.imageAnnoApp.scene,e)},t.prototype.keydown=function(e){27===e.keyCode&&ln.cancel()},t.prototype.mouseMove=function(e){ln.mouseMove(this.acs.imageAnnoApp.scene,e,r.iu.Polyline)},t}(Oe),Po=function(e){function t(t){return e.call(this,t)||this}return Jn(t,e),t.prototype.mouseDown=function(e){ln.mouseDown(this.acs.imageAnnoApp.scene,e)},t.prototype.mouseDrag=function(e){ln.mouseDrag(e)},t.prototype.mouseUp=function(e){ln.mouseUp(this.acs.imageAnnoApp.scene,e)},t.prototype.keydown=function(e){27===e.keyCode&&ln.cancel()},t.prototype.mouseMove=function(e){ln.mouseMove(this.acs.imageAnnoApp.scene,e,r.iu.Polyline,r.hO.DeepLearning)},t}(Ao),wo=(function(e){function t(t){return e.call(this,t)||this}Jn(t,e),t.prototype.mouseDown=function(e){qe.mouseDown(this.acs.imageAnnoApp.scene,e,r.zq.CN_GON)},t.prototype.mouseLeftClick=function(e){qe.mouseLeftClick(this.acs.imageAnnoApp.scene,e,r.zq.CN_GON)},t.prototype.mouseMove=function(e){qe.mouseMove(e)},t.prototype.keydown=function(e){27===e.keyCode&&qe.cancel()}}(Oe),function(e){function t(t){return e.call(this,t)||this}return Jn(t,e),t.prototype.mouseDown=function(e){qe.mouseDown(this.acs.imageAnnoApp.scene,e,r.zq.CN_STAR)},t.prototype.mouseLeftClick=function(e){qe.mouseLeftClick(this.acs.imageAnnoApp.scene,e,r.zq.CN_STAR)},t.prototype.mouseMove=function(e){qe.mouseMove(e)},t.prototype.keydown=function(e){27===e.keyCode&&qe.cancel()},t}(Oe)),xo=function(){function e(e){this.unit=r.fb.Kilometer,this.unitEnumInt=0,this.shiftDTMode=0,this.isHiddenLog=!0,this.isTextEditing=!1,this.insideMap=!1,this.needPostACMode=!0,this.isMarkupEnv=!0,this.isReturn=!1,this.isShortCutActive=!0,this.showUnit=!1,this.showTooltip=!0,this.showActiveCommandChain=!0,this.isDrawing=!1,this.isSmartSelectionWhenDrawing=!1,this.snap=!1,this.hasMultiSel=!1,this.activateCollsion=!1,this.activateMapScale=!1,this.isDragging=!1,this.isUp=!1,this.isViewChanging=!1,this.isDown=!1,this.isClick=!1,this.clickMenu=!1,this.showTooltipPoint=!1,this.hasHovering=!1,this.isActivateSnapping=!1,this.needDuplicateByAlt=!1,this.deselectNeeded=!0,this.needrePositionTextLeaderLine=!0,this.needHideTextLeaderLine=!0,this.needCollisionDetection=!0,this.pressKey=!1,this.pressShift=!1,this.pressESC=!1,this.pressAltKey=!1,this.accentColor=!1,this.isScaleDynamicRender=!0,this.isActiveCluster=!1,this._needExecuteOptimizer=!1,this._optimizerTextleaderline=r.Nv.None,this._optimizerPoint=r.xX.None,this._pressCtrlKey=!1,this._isPanning=!1,this._isZooming=!1,this._extentChanging=!1,this.activeCommandController=e}return Object.defineProperty(e.prototype,"optimizerPoint",{get:function(){return this._optimizerPoint},set:function(e){this._optimizerPoint=e,this.activeCommandController.imageAnnoApp.renderer.optimizer.typePoint=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"optimizerTextleaderline",{get:function(){return this._optimizerTextleaderline},set:function(e){this._optimizerTextleaderline=e,this.activeCommandController.imageAnnoApp.renderer.optimizer.typeTextleaderline=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pressCtrlKey",{get:function(){return this._pressCtrlKey},set:function(e){this._pressCtrlKey=e,!1===e&&this.activeCommandController.imageAnnoApp.geometryCommon.gcmdProcessing.polygonGraphResetForSplit()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"toleranceSnapping",{get:function(){return this.activeCommandController.imageAnnoApp.renderer.objectSnapping.toleranceSnapping},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isPanning",{get:function(){return this._isPanning},set:function(e){this._isPanning=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isZooming",{get:function(){return this._isZooming},set:function(e){this._isZooming=e,e||(this.needExecuteOptimizer=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mapScale",{get:function(){return 1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"needExecuteOptimizer",{get:function(){return this._needExecuteOptimizer},set:function(e){this._needExecuteOptimizer=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"extentChanging",{get:function(){return this._extentChanging},set:function(e){this.activeCommandController.shiftRenderLoop(!e),this._extentChanging=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"zoom",{get:function(){},enumerable:!1,configurable:!0}),e}(),Io=function(){function e(e){this.ac=e,this.initActiveCursor()}return e.prototype.reset=function(){},e.prototype.updateActiveCursorByUp=function(e){this.activeCursor.default()},e.prototype.updateActiveCursorByMove=function(e){this.updateActiveCursor(e)},e.prototype.updateActiveCursorByDrag=function(e){!this.ac.imageAnnoApp.scene.capture||this.ac.imageAnnoApp.scene.capture.type!==r.zq.ANODE_RECT&&this.ac.imageAnnoApp.scene.capture.type!==r.zq.ANODE_CIRCLE&&this.ac.imageAnnoApp.scene.capture.type!==r.zq.RECTANGLE&&this.ac.imageAnnoApp.scene.capture.type!==r.zq.CIRCLE?this.setActiveCursorDrag():e.updateActiveCursor()},e.prototype.setActiveCursorDrag=function(){this.activeCursor.dragging()},e.prototype.setActiveCursorHovering=function(){this.activeCursor.hovering()},e.prototype.updateActiveCursor=function(e){e!==r.uA.TEXT?e===r.uA.SELECT||e===r.uA.NONE||e===r.uA.SELECT_LASSO||e===r.uA.SELECT_RECT?(this.ac.acProperties.hasHovering&&this.ac.imageAnnoApp.implementations.app.model.appCoreWrapper.appControllerStatus.mode===r.An.Drawing||this.activeCursor.default(),this.ac.imageAnnoApp.implementations.app.model.appCoreWrapper.appControllerStatus.mode===r.An.Drawing&&this.activeCursorForText()):this.activeCursor.creating():this.activeCursor.texting()},e.prototype.activeCursorForText=function(){for(var e=0;e<this.ac.imageAnnoApp.scene.listATextleaderlineWrapper.length;++e)this.ac.imageAnnoApp.scene.listATextleaderlineWrapper[e].isMouseInsideDiv(this.ac.m.x,this.ac.m.y)&&this.activeCursor.texting()},e.prototype.initActiveCursor=function(){this.activeCursor=new r.$b(this.ac.imageAnnoApp.implementations.app.model.modelViewWrapper.div)},e.prototype.setActiveCursor=function(e){switch(e){case r.CF.EWresize:this.activeCursor.set_ew_resize();break;case r.CF.NSresize:this.activeCursor.set_ns_resize();break;case r.CF.NESWresize:this.activeCursor.set_nesw_resize();break;case r.CF.NWSEresize:this.activeCursor.set_nwse_resize();break;case r.CF.Pointer:this.activeCursor.hovering()}},e}(),bo=function(){function e(e){var t=this;this.activeColor=[41,78,241,1],this.checkChanges=(0,r.Ds)((function(){t.ac.imageAnnoApp.scene.captureScene()})),this.ac=e}return e.prototype.setActiveColor=function(e,t){void 0===t&&(t=!0),this.activeColor=(0,r.rW)(e),this.activeColor.length<3&&this.activeColor.push(1),this.updateColorSelGeometries(this.activeColor),this.ac.imageAnnoApp.scene.capture&&t&&this.checkChanges()},e.prototype.getActiveColor=function(){return(0,r.iC)(this.activeColor[0],this.activeColor[1],this.activeColor[2])},e.prototype.updateColorSelGeometries=function(e){this.ac.imageAnnoApp.geometryCommon.gcmdProcessing.updateColorStyle(e)},e}(),Oo=function(){function e(e){this.numLins=10,this.list=[],this.ac=e}return e.prototype.push=function(e){this.list.push(e),this.list.length>this.numLins&&this.list.shift()},e.prototype.render=function(e){e.textAlign=r.PH.Left,e.fillStyle="#000000",e.font="10px Arial";for(var t=this.list.length;t--;)e.fillText("log: "+this.list[t],.2*e.canvas.width,100+30*(this.list.length-t))},e}(),Ro=function(){function e(e){var t;this.sanpValue=10,this.type=r.uA.NONE,this.activeBase64img="",this.scaleGlobal=1,this._isTouchEvent=!1,this._zoomLevelForMoving=2,this.acProperties=new xo(this),this.imageAnnoApp=e,this.commands=((t={})[r.uA.POINT_REGULAR]=new Xn(this),t[r.uA.POINT_NUMBERED]=new Kn(this),t[r.uA.POINT_ICON]=new $n(this),t[r.uA.ARROW_SINGLE]=new Qn(this),t[r.uA.ARROW_DOUBLE]=new Zn(this),t[r.uA.CURVE_OPEN]=new eo(this),t[r.uA.CURVE_CLOSE]=new to(this),t[r.uA.POLYLINE]=new uo(this),t[r.uA.POLYLINE_CONSTRAINT]=new mo(this),t[r.uA.POLYLINE_BENDING]=new yo(this),t[r.uA.POLYGON]=new vo(this),t[r.uA.POLYGON_GRAPH]=new go(this),t[r.uA.POLYGON_CONSTRAINT]=new Co(this),t[r.uA.POLYGON_MULTIPLE]=new fo(this),t[r.uA.TEXT_LEADERLINE]=new So(this),t[r.uA.FREEHAND_POLYLINE]=new no(this),t[r.uA.FREEHAND_POLYLINE_BENDING]=new oo(this),t[r.uA.FREEHAND_POLYGON]=new io(this),t[r.uA.FREEHAND_POLYGON_GRAPH]=new so(this),t[r.uA.FREEHAND_CURVE]=new ro(this),t[r.uA.FREEHAND_CURVE_CLOSED]=new ao(this),t[r.uA.SMARTDRAWING]=new Ao(this),t[r.uA.SMARTDRAWING_DEEPLEARNING]=new Po(this),t[r.uA.NONE]=new Le(this),t[r.uA.SELECT]=new ke(this),t[r.uA.REMOVE]=new Ve(this),t[r.uA.SELECT_RECT]=new Ne(this),t[r.uA.SELECT_LASSO]=new Ee(this),t[r.uA.RECTANGLE]=new ho(this),t[r.uA.STAR]=new wo(this),t[r.uA.CIRCLE]=new co(this),t[r.uA.CIRCLE_CONSTRAINT_AREA]=new po(this),t[r.uA.CIRCLE_CONSTRAINT_CIRCUMFERENCE]=new lo(this),t),this.m=new a.$E,this.mNoSnap=this.m.deepCopy(),this.activeCommand=new Le(this),this.screenLog=new Oo(this),this.postACMode=r.uA.SELECT,this.activeMouseCursor=new Io(this),this.activeColorController=new bo(this),this.setActiveCommand(r.uA.SELECT)}return e.prototype.setActiveColor=function(e){},e.prototype.setScaleGlobal=function(e){e>.5&&(this.scaleGlobal=e,this.imageAnnoApp.graphicsCoreWrapper.renderForce())},e.prototype.setActiveCommand=function(e){e=this.remapActiveCommandVersion(e),r.uA.SMARTDRAWING_DEEPLEARNING,this.acProperties.pressShift=!1,this.imageAnnoApp.implementations.app.model.appCoreWrapper.appControllerStatus.mode===r.An.Drawing?(e===r.uA.SELECT||e===r.uA.NONE?this.acProperties.isDrawing=!1:this.acProperties.isDrawing=!0,this.cancelAC(),this.activeCommand=this.commands[e],this.type=e,this.activeMouseCursor.updateActiveCursorByUp(this.type),this.type===r.uA.POINT_REGULAR||this.type===r.uA.POINT_ICON||this.type===r.uA.POINT_NUMBERED||this.type===r.uA.LINE?this.acProperties.showTooltipPoint=!0:this.acProperties.showTooltipPoint=!1):this.activeCommand=this.commands[e]},e.prototype.goToACMode=function(e){void 0===e&&(e=this.postACMode),this.acProperties.needPostACMode&&(this.setActiveCommand(e),this.imageAnnoApp.io.eventListenerAnnotation.shiftCAMode(e))},Object.defineProperty(e.prototype,"zoomLevelForMoving",{get:function(){return this._zoomLevelForMoving},set:function(e){this._zoomLevelForMoving=2+Math.floor(e/4)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"postACMode",{get:function(){return this._postACMode},set:function(e){this._postACMode=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"IsTouchEvent",{get:function(){return this._isTouchEvent},set:function(e){this._isTouchEvent=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"IsTextEditing",{get:function(){return this.acProperties.isTextEditing},set:function(e){this.acProperties.isTextEditing=e},enumerable:!1,configurable:!0}),e.prototype.resizeCanvas=function(e,t){},e.prototype.cancelAC=function(){this.acProperties.pressShift=!1,this.imageAnnoApp.implementations.app.model.appCoreWrapper.appControllerStatus.mode!==r.An.ObserveViewer&&(fe.cancel(this.imageAnnoApp.scene),B.cancel(this.imageAnnoApp.scene),M.cancel(this.imageAnnoApp.scene))},e.prototype.getCircleFromVoice=function(){},e.prototype.getRectangleFromVoice=function(){ae.getRectangleFromVoice(this.imageAnnoApp.scene)},e.prototype.reUndoProcessing=function(e){this.imageAnnoApp.geometryCommon.gcmdProcessing.reUndoProcessing(e)},e.prototype.reUndoProcessingStorymaps=function(e){this.imageAnnoApp.geometryCommon.gcmdProcessing.reUndoProcessingStorymaps(e)},e.prototype.repopulateGeometries=function(e){this.imageAnnoApp.geometryCommon.gcmdProcessing.repopulateGeometries(e)},e.prototype.base64DumpIcon=function(e,t,n){this.base64Processing(e,t,n)},e.prototype.removeSelShape=function(){this.imageAnnoApp.geometryCommon.gcmdProcessing.removeAllCapturedGeoGroup()},e.prototype.base64Processing=function(e,t,n){e===r.Us.AddIconBase64&&void 0!==n&&this.imageAnnoApp.renderer.draw.image.addBase64(t,n),e===r.Us.SelectIconBase64&&this.imageAnnoApp.renderer.draw.image.activeBase64(t)},e.prototype.mousePostProcess=function(e,t){return void 0===t&&(t=this.sanpValue),this.acProperties.snap?(e.x=Math.floor(e.x/t)*t,e.y=Math.floor(e.y/t)*t,e):e},e.prototype.processingUpdate=function(e,t){this.imageAnnoApp.geometryCommon.gcmdProcessing.processingUpdate(e,t)},e.prototype.removeByIDs=function(e){this.imageAnnoApp.geometryCommon.gcmdProcessing.removeByIDs(e)},e.prototype.removeAllShapes=function(){this.imageAnnoApp.geometryCommon.gcmdSelecting.selectAllObjects(),this.imageAnnoApp.geometryCommon.gcmdProcessing.removeAllGeo(),this.imageAnnoApp.geometryCommon.gcmdProcessing.removeAll()},e.prototype.updateProjection=function(e){if(this.imageAnnoApp.implementations.app.model.imageWrapper.img){var t=this.imageAnnoApp.implementations.app.model.imageWrapper.projectionToImageSpace(e.x,e.y);e.x=t[0],e.y=t[1],e.x+=this.imageAnnoApp.scene.paramsEditing.croppingMaskParams.x,e.y+=this.imageAnnoApp.scene.paramsEditing.croppingMaskParams.y}},e.prototype.commonEvent=function(e){return this.updateProjection(e),this.mNoSnap=e.deepCopy(),e=this.mousePostProcess(e),this.imageAnnoApp.apiWrapper.environment.logCommon(e.x,e.y),this.m=e,e},e.prototype.hide=function(e){this.imageAnnoApp.geometryCommon.gcmdProcessing.hide(e)},e.prototype.unhide=function(e){this.imageAnnoApp.geometryCommon.gcmdProcessing.unhide(e)},e.prototype.setupPolylineConstraintLength=function(e){this.imageAnnoApp.geometryCommon.gcmdProcessing.setupPolylineConstraintLength(e)},e.prototype.setupPolylineConstraintLengthPercentage=function(e){this.imageAnnoApp.geometryCommon.gcmdProcessing.setupPolylineConstraintLengthPercentage(e)},e.prototype.disableExcept=function(e){this.imageAnnoApp.geometryCommon.gcmdProcessing.disableExcept(e)},e.prototype.highlight=function(e){this.imageAnnoApp.geometryCommon.gcmdProcessing.highlight(e)},e.prototype.downloadShapes=function(){this.imageAnnoApp.implementations.app.model.ioWrapper.download()},e.prototype.downloadTheme=function(){this.imageAnnoApp.customization.downloadTheme()},e.prototype.pause=function(){this.imageAnnoApp.implementations.app.pause()},e.prototype.resume=function(){this.imageAnnoApp.implementations.app.resume()},e.prototype.needPopup=function(){return!this.acProperties.isMarkupEnv},e.prototype.remapActiveCommandVersion=function(e){return e},e.prototype.shiftRenderLoop=function(e){!e&&this.imageAnnoApp.scene.listATextleaderlineWrapper.length>0?this.imageAnnoApp.graphicsCoreWrapper.canvasWrapper.aCanvas.IsRenderSkip=!1:this.imageAnnoApp.graphicsCoreWrapper.canvasWrapper.aCanvas.IsRenderSkip=!0},e.prototype.activecommandIconPoint=function(){this.setActiveCommand(r.uA.POINT_ICON)},e.prototype.setScaleGraphics=function(e,t,n){void 0===t&&(t=!0),void 0===n&&(n=!0);var o=this.imageAnnoApp.geometryCommon.gcmdProcessing.hasMultiSel();if(o&&o.length>0)for(var i=0;i<o.length;++i)t?o[i].setScaleLocal(e):e+o[i].styleComponent.renderStyle.scaleLocal>.5&&o[i].setScaleLocal(e+o[i].styleComponent.renderStyle.scaleLocal);else t?this.imageAnnoApp.activeCommandController.setScaleGlobal(e):this.imageAnnoApp.activeCommandController.setScaleGlobal(e+this.imageAnnoApp.activeCommandController.scaleGlobal);n&&this.imageAnnoApp.scene.captureScene(),this.activeCommand.acs.imageAnnoApp.graphicsCoreWrapper.renderForce()},e}(),Lo=function(){function e(e){this.gcmd=e}return e.prototype.downloadImag=function(){var e=document.createElement("a");e.download="filename.png",e.href=this.gcmd.annotationInstance.graphicsCoreWrapper.canvasWrapper.aCanvas.canvas.toDataURL("image/jpeg"),e.click()},e.prototype.computeBoundaryFromGeos=function(e){for(var t=[],n=0;n<e.length;++n)for(var o=e[n].getBoundary(),i=0;i<o.length;++i)t.push(o[i]);return(0,r.HP)(t)},e.prototype.pasteSelGeoInPlace=function(e,t){var n=this.gcmd.annotationInstance.scene.copyPasteGeo.length;if(0!==n)if(1!==n){for(;n--;)if(this.gcmd.annotationInstance.scene.copyPasteGeo[n]){var o=this.gcmd.annotationInstance.scene.copyPasteGeo[n];o.isSelectedValue=!1;var i=this.gcmd.annotationInstance.scene.copyPasteGeo[n].deepCopy(o.v.x+e,o.v.y+t);if(i){var s=i;s.isSelected=!0,s.isHover=!0}}this.gcmd.annotationInstance.activeCommandController.setActiveCommand(r.uA.NONE)}else this.gcmd.annotationInstance.scene.copyPasteGeo[0].deepCopy(this.gcmd.annotationInstance.scene.copyPasteGeo[0].vec.x+e,this.gcmd.annotationInstance.scene.copyPasteGeo[0].vec.y+t)},e.prototype.pasteSelGeo=function(e,t){var n=this.gcmd.annotationInstance.scene.copyPasteGeo.length;if(0!==n)if(1!==n){for(var o=(0,r.hW)();n--;)o.Add(this.gcmd.annotationInstance.scene.copyPasteGeo[n].v);for(n=this.gcmd.annotationInstance.scene.copyPasteGeo.length,o.x=e-o.x/n,o.y=t-o.y/n;n--;)if(this.gcmd.annotationInstance.scene.copyPasteGeo[n]){var i=this.gcmd.annotationInstance.scene.copyPasteGeo[n];i.isSelectedValue=!1;var s=this.gcmd.annotationInstance.scene.copyPasteGeo[n].deepCopy(i.v.x+o.x,i.v.y+o.y);s&&(s.isSelected=!0)}this.gcmd.gcmdSelecting.deSelectCaptureObjects()}else this.gcmd.annotationInstance.scene.copyPasteGeo[0].deepCopy(e,t)},e.prototype.getCanvas=function(){return this.gcmd.annotationInstance.graphicsCoreWrapper.canvasWrapper.aCanvas.ctx.canvas},e}(),Vo=function(){function e(e){this.gcmd=e}return Object.defineProperty(e.prototype,"width",{get:function(){return+this.gcmd.annotationInstance.implementations.app.model.modelViewWrapper.divHost.style.width.split("px")[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return+this.gcmd.annotationInstance.implementations.app.model.modelViewWrapper.divHost.style.height.split("px")[0]},enumerable:!1,configurable:!0}),e.prototype.rightClickOnHoverGeo=function(e){for(var t=this.gcmd.annotationInstance.scene.geometryList.length;t--;)if(this.gcmd.annotationInstance.scene.geometryList[t].isHover)return this.gcmd.annotationInstance.scene.geometryList[t].mouseRightClick(e),!0;return!1},e.prototype.updatePopup=function(){},e.prototype.moveSelectedGeoPreSmartVersionBetweenGeometryAndNodes=function(e){},e.prototype.moveSelectedGeo=function(e){for(var t=0;t<this.gcmd.annotationInstance.scene.geometryList.length;++t)if(this.gcmd.annotationInstance.scene.geometryList[t].isCapturedValue||this.gcmd.annotationInstance.scene.geometryList[t].isSelected&&this.gcmd.annotationInstance.scene.geometryList[t].type!==r.zq.CNODE&&this.gcmd.annotationInstance.scene.geometryList[t].type!==r.zq.CNODE_CIRCLE){var n=this.gcmd.annotationInstance.scene.geometryList[t].findClosestNode(e.x,e.y);null!=n?(n.translateByMouseEventData(e),this.gcmd.annotationInstance.scene.Capture=n):this.gcmd.annotationInstance.scene.geometryList[t].translateByMouseEventData(e)}},e.prototype.moveMidPoint=function(e){},e.prototype.removeAllGeo=function(){var e=v.list.length;if(0!==e){for(;e--;)v.list[e].remove();var t=this.gcmd.annotationInstance.scene.geometryList.length;if(0!==t)for(;t--;)this.gcmd.annotationInstance.scene.geometryList[t].remove()}},e.prototype.resetTranformation=function(){var e=this.gcmd.annotationInstance.scene.geometryList.length;if(0!==e)for(;e--;)this.gcmd.annotationInstance.scene.geometryList[e].isTransform=!1},e.prototype.checkAttachedTextleaderline=function(e){return e.type===r.zq.POLYGON_GRAPH||e.type===r.zq.POLYLINE_BENDING||e.type===r.zq.RECTANGLE?e.checkAttachedTextleaderline():e.type===r.zq.CIRCLE?e.CheckAttachedTextleaderline():!(e.textLeaderline&&e.textLeaderline.leaderline&&(0,r.Sp)(e.textLeaderline.leaderline.v2,e.vec)>5&&(e.textLeaderline.attachedShape=void 0,e.textLeaderline=void 0,1))},e.prototype.processSelectionViewerMode=function(){var e=this.gcmd.annotationInstance.scene.geometryList.length;if(this.gcmd.annotationInstance.scene.capture)for(;e--;)this.gcmd.annotationInstance.scene.capture===this.gcmd.annotationInstance.scene.geometryList[e]?this.gcmd.annotationInstance.scene.geometryList[e].isSelectedValue=!0:this.gcmd.annotationInstance.scene.geometryList[e].isSelectedValue=!1;else for(;e--;)this.gcmd.annotationInstance.scene.geometryList[e].isSelectedValue=!1},e.prototype.polygonGraphResetForSplit=function(){for(var e=this.gcmd.annotationInstance.scene.listAPolygonGraphWrapper.length;e--;)this.gcmd.annotationInstance.scene.listAPolygonGraphWrapper[e].polygonGraphResetForSplit()},e.prototype.copySelGeo=function(){this.gcmd.annotationInstance.scene.copyPasteGeo=[];for(var e=this.gcmd.annotationInstance.scene.geometryList.length;e--;)(this.gcmd.annotationInstance.scene.geometryList[e].isSelected||this.gcmd.annotationInstance.scene.geometryList[e].isHoverValue)&&this.gcmd.annotationInstance.scene.copyPasteGeo.push(this.gcmd.annotationInstance.scene.geometryList[e]);this.gcmd.annotationInstance.activeCommandController.setActiveCommand(r.uA.NONE)},e.prototype.toMapConvertGeoDis=function(e,t,n){var o=n/1,i=this.gcmd.gcmdSupporting.toMap(e+o,t);return[i[0],i[1]][0]-e},e.prototype.setCaptureHovered=function(e){e!==this.gcmd.annotationInstance.scene.captureHovered&&(this.gcmd.annotationInstance.scene.captureHovered=e)},e.prototype.getHashColor=function(e){for(;;){var t=(0,r.kt)();if(!this.gcmd.annotationInstance.scene.listHashColor[t])return this.gcmd.annotationInstance.scene.listHashColor[t]=e,t}},e.prototype.getShapeByHashCol=function(e){return this.gcmd.annotationInstance.scene.listHashColor[e]},e.prototype.isMouseInsideByOffScreenNumberPoint=function(e,t,n){var o=this.pickColorsOffscreen(e,t,3,3),i=30;return(0,r.Sm)(o[0],o[1],o[2],n[0],n[1],n[2])<i||(0,r.Sm)(o[4],o[5],o[6],n[0],n[1],n[2])<i||(0,r.Sm)(o[8],o[9],o[10],n[0],n[1],n[2])<i||(0,r.Sm)(o[12],o[13],o[14],n[0],n[1],n[2])<i||(0,r.Sm)(o[16],o[17],o[18],n[0],n[1],n[2])<i||(0,r.Sm)(o[20],o[21],o[22],n[0],n[1],n[2])<i||(0,r.Sm)(o[24],o[25],o[26],n[0],n[1],n[2])<i||(0,r.Sm)(o[28],o[29],o[30],n[0],n[1],n[2])<i||(0,r.Sm)(o[32],o[33],o[34],n[0],n[1],n[2])<i},e.prototype.isMouseInsideByOffScreen=function(e,t,n){var o=this.pickColorOffscreen(e,t);return!(!this.getShapeByHashCol(o)||o!==n)},e.prototype.getClosestNodeForSnapping=function(e,t,n){for(var o=new r.h9(e,t),i=this.gcmd.annotationInstance.scene.listBasePoint.length,s=-1;i--;)if(!this.gcmd.annotationInstance.scene.listBasePoint[i].isCollapse){if(this.gcmd.annotationInstance.scene.listBasePoint[i].type===r.zq.AMIDPOINT){var a=this.gcmd.annotationInstance.scene.listBasePoint[i];if(a.aEdges[0]&&a.aEdges[0].pGraph.type===r.zq.POLYLINE_BENDING)continue}var h=(0,r.Sp)(this.gcmd.annotationInstance.scene.listBasePoint[i].vec,o);h<n&&(n=h,s=i)}for(i=this.gcmd.annotationInstance.scene.listARectangleWrapper.length;i--;)if((c=this.gcmd.annotationInstance.scene.listARectangleWrapper[i]).updateLeaderlineSnap(o,n),c.vecSelectedSnapping){if((0,r.Sp)(c.vecSelectedSnapping,o)<5)return c;c.vecSelectedSnapping=void 0}for(i=this.gcmd.annotationInstance.scene.listACircleWrapperr.length;i--;){var c;if((c=this.gcmd.annotationInstance.scene.listACircleWrapperr[i]).updateLeaderlineSnap(o,n),c.vecSelectedSnapping){if((0,r.Sp)(c.vecSelectedSnapping,o)<5)return c;c.vecSelectedSnapping=void 0}}if(s>-1)return this.gcmd.annotationInstance.scene.listBasePoint[s];for(i=this.gcmd.annotationInstance.scene.listAPolygonGraphWrapper.length;i--;){var p=this.gcmd.annotationInstance.scene.listAPolygonGraphWrapper[i].getclosestNode(o,n);if(p)return p}},e.prototype.pickColorsOffscreen=function(e,t,n,o){return void 0===n&&(n=1),void 0===o&&(o=1),this.gcmd.annotationInstance.renderer.ctxOffscreen.getImageData(e,t,n,o).data},e.prototype.pickColorOffscreen=function(e,t){var n=this.pickColorsOffscreen(e,t);return"rgb("+n[0]+","+n[1]+","+n[2]+")"},e.prototype.getSelGeo=function(){for(var e=[],t=this.gcmd.annotationInstance.scene.geometryList.length;t--;)this.gcmd.annotationInstance.scene.geometryList[t].isSelected&&e.push(this.gcmd.annotationInstance.scene.geometryList[t]);return e},e.prototype.getGeoById=function(e){for(var t=this.gcmd.annotationInstance.scene.geometryList.length;t--;)if(this.gcmd.annotationInstance.scene.geometryList[t].id===e)return this.gcmd.annotationInstance.scene.geometryList[t]},e.prototype.getRPointtById=function(e){for(var t=this.gcmd.annotationInstance.scene.listRPoint.length;t--;)if(this.gcmd.annotationInstance.scene.listRPoint[t].id===e)return this.gcmd.annotationInstance.scene.listRPoint[t]},e.prototype.updateIconPoint=function(e,t){var n=this.getRPointtById(e);n&&(n.updateIcon(t),this.gcmd.gcmdSupporting.renderForce())},e.prototype.duplicateByDragging=function(){if(this.gcmd.annotationInstance.scene.Capture){var e=this.gcmd.annotationInstance.scene.Capture.deepCopy(this.gcmd.annotationInstance.scene.Capture.vec.x,this.gcmd.annotationInstance.scene.Capture.vec.y);this.gcmd.annotationInstance.scene.Capture.isHover=!1,this.gcmd.annotationInstance.scene.Capture.isSelected=!1,e&&(e.isHover=!0,this.gcmd.annotationInstance.scene.Capture=e)}var t=this.hasMultiSel();if(void 0!==t)for(var n=0,o=t;n<o.length;n++){var i=o[n];i.isSelected=!1,i.isHover=!1;var s=i.deepCopy(i.vec.x,i.vec.y);s&&(s.isSelected=!0,s.isHover=!0)}},e.prototype.getSelectedGeoIDs=function(){for(var e=[],t=0;t<this.gcmd.annotationInstance.scene.geometryList.length;++t)this.gcmd.annotationInstance.scene.geometryList[t].type!==r.zq.ANODE_RECT&&this.gcmd.annotationInstance.scene.geometryList[t].type!==r.zq.ANODE_CIRCLE&&this.gcmd.annotationInstance.scene.geometryList[t].isSelectedValue&&e.push(this.gcmd.annotationInstance.scene.geometryList[t].id);return e},e.prototype.processingUpdate=function(e,t){var n=this.getGeoById(e);n&&n.type===r.zq.TEXT_LEADERLINE&&n.processingUpdate(t)},e.prototype.removeByIDs=function(e){var t=this,n=[];JSON.parse(e).forEach((function(e){var o=t.getGeoById(e);if(o){var i=o.toJSON();i&&(n.push(i),o.remove(!1))}})),this.gcmd.annotationInstance.io.eventListenerAnnotation.removeGeometryStack(n),this.gcmd.gcmdSupporting.renderForce()},e.prototype.removeBeforeDump=function(){this.gcmd.gcmdSelecting.deSelectAllObjects(),this.removeAllCapturedGeo();for(var e=this.gcmd.annotationInstance.scene.listATextleaderlineWrapper.length;e--;)this.gcmd.annotationInstance.scene.listATextleaderlineWrapper[e]&&this.gcmd.annotationInstance.scene.listATextleaderlineWrapper[e].removeDiv();this.removeAllDiv(),this.resetGeometryList()},e.prototype.reUndoProcessing=function(e){var t=this;this.removeBeforeDump(),e.forEach((function(e){t.getGeoByIOGeometry(e,!0)})),this.initConnectionTextleaderlines(),this.gcmd.annotationInstance.activeCommandController.acProperties.needExecuteOptimizer=!0,this.gcmd.gcmdSupporting.renderForce()},e.prototype.reUndoProcessingStorymaps=function(e){var t=this;this.removeBeforeDump(),e.forEach((function(e){t.getGeoByIOGeometry(e,!0)})),this.initConnectionTextleaderlines(),this.gcmd.annotationInstance.activeCommandController.acProperties.needExecuteOptimizer=!0,this.gcmd.gcmdSupporting.renderForce()},e.prototype.hide=function(e){for(var t=e.length;t--;)for(var n=0;n<this.gcmd.annotationInstance.scene.geometryList.length;++n)this.gcmd.annotationInstance.scene.geometryList[n].id===e[t]&&(this.gcmd.annotationInstance.scene.geometryList[n].isRenderable=!1,this.gcmd.annotationInstance.scene.geometryList[n].isHidden=!0,this.gcmd.annotationInstance.scene.geometryList[n].visibility=0)},e.prototype.unhide=function(e){for(var t=e.length;t--;)for(var n=0;n<this.gcmd.annotationInstance.scene.geometryList.length;++n)this.gcmd.annotationInstance.scene.geometryList[n].id===e[t]&&(this.gcmd.annotationInstance.scene.geometryList[n].isRenderable=!0,this.gcmd.annotationInstance.scene.geometryList[n].isHidden=!1,this.gcmd.annotationInstance.scene.geometryList[n].visibility=1)},e.prototype.setupPolylineConstraintLength=function(e){if(this.gcmd.annotationInstance.scene.capture&&this.gcmd.annotationInstance.scene.capture.type===r.zq.POLYLINE){var t=50*(e+1);this.gcmd.annotationInstance.scene.capture.constraintTargetDistance=t}},e.prototype.setupPolylineConstraintLengthPercentage=function(e){this.gcmd.annotationInstance.scene.capture&&this.gcmd.annotationInstance.scene.capture.type===r.zq.POLYLINE&&(this.gcmd.annotationInstance.scene.capture.constraintTargetDistancePercentage=e)},e.prototype.disableExcept=function(e){for(var t=[],n=0;n<e.length;++n)t.push(this.getGeoById(e[n]));for(var o=0;o<t.length;++o)for(n=0;n<this.gcmd.annotationInstance.scene.geometryList.length;++n)this.gcmd.annotationInstance.scene.geometryList[n]===t[o]?this.gcmd.annotationInstance.scene.geometryList[n].disable=!1:this.gcmd.annotationInstance.scene.geometryList[n].disable=!0},e.prototype.highlight=function(e){this.gcmd.annotationInstance.renderer.needFocus=!0;for(var t=0;t<this.gcmd.annotationInstance.scene.geometryList.length;++t)this.gcmd.annotationInstance.scene.geometryList[t].id===e?(this.gcmd.annotationInstance.scene.geometryList[t].isSelected=!0,this.gcmd.annotationInstance.scene.geometryList[t].isHover=!0):(this.gcmd.annotationInstance.scene.geometryList[t].isSelected=!1,this.gcmd.annotationInstance.scene.geometryList[t].isHover=!1)},e.prototype.autoSnappingTracker=function(e){return this.gcmd.annotationInstance.renderer.objectSnapping.autoSnappingTracker(e,!1)},e.prototype.autoSnapping=function(e){return this.gcmd.annotationInstance.renderer.objectSnapping.autoSnappingTracker(e,!0)},e.prototype.getPosBySnapping=function(e,t,n){for(var o=15,i=new r.h9(e,t),s=new r.h9(e,t),a=this.gcmd.annotationInstance.scene.geometryList.length;a--;){var h=this.gcmd.annotationInstance.scene.geometryList[a].needSnapping(s);h[0]&&h[1]&&h[0]>0&&h[0]<o&&(o=h[0],i=h[1])}return o<n&&(e=i.x,t=i.y),[e,t]},e.prototype.repopulateGeometries=function(e){for(var t in this.removeAll(),e)if(e[t]){var n=e[t];this.getGeoByIOGeometry(n,!1,!0)}this.initConnectionTextleaderlines(),this.gcmd.gcmdSupporting.renderForce()},e.prototype.removeAll=function(e){for(var t=this.gcmd.annotationInstance.scene.listATextleaderlineWrapper.length;t--;)this.gcmd.annotationInstance.scene.listATextleaderlineWrapper[t]&&this.gcmd.annotationInstance.scene.listATextleaderlineWrapper[t].removeDiv();for(t=this.gcmd.annotationInstance.scene.geometryList.length;t--;)this.gcmd.annotationInstance.scene.geometryList[t]&&this.gcmd.annotationInstance.scene.geometryList[t].remove(e);this.removeAllDiv(),this.resetGeometryList(),this.gcmd.gcmdSupporting.renderForce()},e.prototype.removeAllDiv=function(){for(var e=0;e<this.gcmd.annotationInstance.implementations.app.model.modelViewWrapper.div.childElementCount;++e)this.gcmd.annotationInstance.implementations.app.model.modelViewWrapper.div.lastChild&&this.gcmd.annotationInstance.implementations.app.model.modelViewWrapper.div.lastChild instanceof HTMLDivElement&&this.gcmd.annotationInstance.implementations.app.model.modelViewWrapper.div.lastChild.remove()},e.prototype.removeAllPopup=function(){for(var e=0;e<this.gcmd.annotationInstance.implementations.app.model.modelViewWrapper.div.childElementCount;++e)this.gcmd.annotationInstance.implementations.app.model.modelViewWrapper.div.lastChild&&this.gcmd.annotationInstance.implementations.app.model.modelViewWrapper.div.lastChild instanceof HTMLDivElement&&this.gcmd.annotationInstance.implementations.app.model.modelViewWrapper.div.lastChild.id.includes("pa")&&this.gcmd.annotationInstance.implementations.app.model.modelViewWrapper.div.lastChild.remove();for(e=0;e<this.gcmd.annotationInstance.scene.geometryList.length;++e)this.gcmd.annotationInstance.scene.geometryList[e].hasPopup&&this.gcmd.annotationInstance.scene.geometryList[e].hidePopUpSummary()},e.prototype.initConnectionTextleaderlines=function(){for(var e=this.gcmd.annotationInstance.scene.listATextleaderlineWrapper.length;e--;)void 0!==this.gcmd.annotationInstance.scene.listATextleaderlineWrapper[e].leaderline&&this.gcmd.annotationInstance.scene.listATextleaderlineWrapper[e].initSnapForPointForUndo()},e.prototype.resetGeometryList=function(){this.gcmd.annotationInstance.scene.geometryList=[],this.gcmd.annotationInstance.scene.listATextleaderlineWrapper=[],this.gcmd.annotationInstance.scene.listBasePoint=[],this.gcmd.annotationInstance.scene.listAPoint=[],this.gcmd.annotationInstance.scene.listAArrow=[],this.gcmd.annotationInstance.scene.listIPoint=[],this.gcmd.annotationInstance.scene.listRPoint=[],this.gcmd.annotationInstance.scene.listNPoint=[],this.gcmd.annotationInstance.scene.listACircleWrapperr=[],this.gcmd.annotationInstance.scene.listARectangleWrapper=[],this.gcmd.annotationInstance.scene.listAPolylineWrapper=[],this.gcmd.annotationInstance.scene.listAPolygonGraphWrapper=[],this.gcmd.annotationInstance.scene.listAPolygonWrapper=[],this.gcmd.annotationInstance.scene.listAPolylineGraphWrapper=[],this.gcmd.annotationInstance.scene.listACurve=[],this.gcmd.annotationInstance.scene.listALog=[]},e.prototype.removeCapturedTextLeaderline=function(){for(var e=this.gcmd.annotationInstance.scene.listATextleaderlineWrapper.length;e--;)this.gcmd.annotationInstance.scene.listATextleaderlineWrapper[e].isSelected&&this.gcmd.annotationInstance.scene.listATextleaderlineWrapper[e].remove();this.gcmd.gcmdSupporting.renderForce()},e.prototype.DumpByIGeometriesFromImageDataModel=function(e){for(var t=0;t<e.length;++t)this.getGeoByIOGeometry(e[t],!0)},e.prototype.DumpByIGeometries=function(e){for(var t=0;t<e.length;++t)this.getGeoByIOGeometry(e[t],!0)},e.prototype.getGeoByIOGeometry=function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!1),void 0!==e&&(e.type===r.zq.POINT_REGULAR?qn.fromJSON(this.gcmd.annotationInstance.scene,e,t,n):e.type===r.zq.POINT_NUMBERED?Tn.FromJSON(this.gcmd.annotationInstance.scene,e,t,n):e.type===r.zq.CIRCLE?Q.fromJSON(this.gcmd.annotationInstance.scene,e,t,n):e.type===r.zq.RECTANGLE?ae.fromJSON(this.gcmd.annotationInstance.scene,e,t,n):e.type===r.zq.POLYLINE?M.fromJSON(this.gcmd.annotationInstance.scene,e,t,n):e.type===r.zq.POLYLINE_BENDING?fe.fromJSON(this.gcmd.annotationInstance.scene,e,t,n):e.type===r.zq.POLYGON?B.fromJSON(this.gcmd.annotationInstance.scene,e,t,n):e.type===r.zq.POLYGON_GRAPH?ot.fromJSON(this.gcmd.annotationInstance.scene,e,t,n):e.type===r.zq.POINT_ICON?xn.fromJSON(this.gcmd.annotationInstance.scene,e,t,n):e.type===r.zq.ARROW_SINGLE?wt.fromJSON(this.gcmd.annotationInstance.scene,e,t,n,!0):e.type===r.zq.ARROW_DOUBLE?wt.fromJSON(this.gcmd.annotationInstance.scene,e,t,n,!1):e.type===r.zq.CURVE_OPEN?ct.fromJSON(this.gcmd.annotationInstance.scene,e,t,n):e.type===r.zq.CURVE_CLOSE?ct.fromJSON(this.gcmd.annotationInstance.scene,e,t,n,!0):e.type===r.zq.TEXT_LEADERLINE&&sn.fromJSON(this.gcmd.annotationInstance.scene,e,t,n))},e.prototype.hasMultiSel=function(){for(var e=this.gcmd.annotationInstance.scene.geometryList.length,t=[];e--;)this.gcmd.annotationInstance.scene.geometryList[e].isUnderConstruction||this.gcmd.annotationInstance.scene.geometryList[e].isSelectedValue&&t.push(this.gcmd.annotationInstance.scene.geometryList[e]);if(t)return this.gcmd.annotationInstance.scene.captureMultiple=t,t;this.gcmd.annotationInstance.scene.captureMultiple=void 0},e.prototype.updateStyleCustom=function(e){for(var t=[],n=0;n<e.length;++n)for(var o=0;o<this.gcmd.annotationInstance.scene.geometryList.length;++o){var i=this.gcmd.annotationInstance.scene.geometryList[o];if(i.id===e[n].id&&i.updateStyleCustom(e[n].style)){var s=i.toJSON();s&&t.push(s)}}t.length>0&&this.gcmd.annotationInstance.io.eventListenerAnnotation.transformStack(t),this.gcmd.gcmdSupporting.renderForce()},e.prototype.setSizeRPoint=function(e){for(var t=0;t<this.gcmd.annotationInstance.scene.listRPoint.length;++t)this.gcmd.annotationInstance.scene.listRPoint[t].size=e;this.gcmd.annotationInstance.geometryCommon.gcmdSupporting.renderForce()},e.prototype.setRenderTypePoint=function(e){if(r.oW.hasOwnProperty(e))for(var t=0;t<this.gcmd.annotationInstance.scene.listRPoint.length;++t)this.gcmd.annotationInstance.scene.listRPoint[t].renderer.pointRenderType=e,this.gcmd.annotationInstance.scene.listRPoint[t].styleComponent.renderStyle.url="";else if("string"==typeof e)for(t=0;t<this.gcmd.annotationInstance.scene.listRPoint.length;++t)this.gcmd.annotationInstance.scene.listRPoint[t].renderer.pointRenderType=r.oW.Image,this.gcmd.annotationInstance.scene.listRPoint[t].styleComponent.renderStyle.url=e;this.gcmd.annotationInstance.geometryCommon.gcmdSupporting.renderForce()},e.prototype.findAtPointFromAPoint=function(e){for(var t=this.gcmd.annotationInstance.scene.listBasePoint.length-1;t>=0;--t)if(this.gcmd.annotationInstance.scene.listBasePoint[t].isSelectable&&this.gcmd.annotationInstance.scene.listBasePoint[t].isMouseInside(e.x,e.y))return this.gcmd.annotationInstance.scene.listBasePoint[t]},e.prototype.findAtPointFromPolygonGraph=function(e){for(var t=this.gcmd.annotationInstance.scene.listAPolygonGraphWrapper.length-1;t>=0;--t)if(this.gcmd.annotationInstance.scene.listAPolygonGraphWrapper[t].isSelectable){if(void 0!==this.gcmd.annotationInstance.scene.listAPolygonGraphWrapper[t].getVecForSnapping())return this.gcmd.annotationInstance.scene.listAPolygonGraphWrapper[t];this.gcmd.annotationInstance.scene.listAPolygonGraphWrapper[t].graphCore.selVec=void 0,this.gcmd.annotationInstance.scene.listAPolygonGraphWrapper[t].graphCore.selectedVec=void 0,this.gcmd.annotationInstance.scene.listAPolygonGraphWrapper[t].graphCore.selVecForTextLeaderline=void 0}},e.prototype.findAtPointByTouch=function(e){for(var t=[],n=this.gcmd.annotationInstance.scene.geometryList.length-1;n>=0;--n)this.gcmd.annotationInstance.scene.geometryList[n].type===r.zq.POINT_REGULAR?(this.gcmd.annotationInstance.scene.geometryList[n].isSelectable&&this.gcmd.annotationInstance.scene.geometryList[n].isHoverValue||this.gcmd.annotationInstance.scene.geometryList[n].isMouseInside(e.x,e.y))&&t.push(this.gcmd.annotationInstance.scene.geometryList[n]):this.gcmd.annotationInstance.scene.geometryList[n].isSelectable&&this.gcmd.annotationInstance.scene.geometryList[n].isMouseInside(e.x,e.y)&&t.push(this.gcmd.annotationInstance.scene.geometryList[n]);var o=[];for(n=0;n<this.gcmd.annotationInstance.scene.listNPoint.length;++n)(s=this.gcmd.annotationInstance.scene.listNPoint[n].isMouseInsideWithTolerance(e.x,e.y,50))&&o.push(this.gcmd.annotationInstance.scene.listNPoint[n]);for(n=0;n<this.gcmd.annotationInstance.scene.listRPoint.length;++n)(s=this.gcmd.annotationInstance.scene.listRPoint[n].isMouseInsideWithTolerance(e.x,e.y,50))&&o.push(this.gcmd.annotationInstance.scene.listRPoint[n]);if(o.length>0){var i=-1,s=Number.MAX_SAFE_INTEGER;for(n=0;n<o.length;++n){var a=o[n].distance(e.x,e.y+11*o[n].scaleForRender);a<s&&(s=a,i=n),t=[o[i]]}}var h=!1;if(t.length>1)for(n=0;n<t.length;++n)t[n].type!==r.zq.CIRCLE&&t[n].type!==r.zq.RECTANGLE&&t[n].type!==r.zq.POLYLINE&&t[n].type!==r.zq.POLYGON&&t[n].type!==r.zq.POLYGON_GRAPH&&t[n].type!==r.zq.CN_GON&&t[n].type!==r.zq.CN_STAR||(h=!0);var c=[];if(h){for(n=0;n<t.length;++n)c.push(Math.abs(t[n].getArea()));return t[(0,r.Cv)(c)]}for(n=0;n<t.length;++n)if(t[n].isSelectable&&t[n].isMouseInside(e.x,e.y))return t[n]},e.prototype.findAtPoint=function(e){for(var t=[],n=this.gcmd.annotationInstance.scene.geometryList.length-1;n>=0;--n)if(this.gcmd.annotationInstance.scene.geometryList[n].type===r.zq.POINT_REGULAR){if(this.gcmd.annotationInstance.scene.geometryList[n].isSelectable&&this.gcmd.annotationInstance.scene.geometryList[n].isHoverValue||this.gcmd.annotationInstance.scene.geometryList[n].isMouseInside(e.x,e.y)){if(this.gcmd.annotationInstance.scene.geometryList[n].type!==r.zq.POLYGON&&this.gcmd.annotationInstance.scene.geometryList[n].type!==r.zq.POLYGON_GRAPH&&this.gcmd.annotationInstance.scene.geometryList[n].type!==r.zq.CIRCLE&&this.gcmd.annotationInstance.scene.geometryList[n].type!==r.zq.CCURVE_CLOSED&&this.gcmd.annotationInstance.scene.geometryList[n].type!==r.zq.RECTANGLE&&this.gcmd.annotationInstance.scene.geometryList[n].type!==r.zq.CN_GON&&this.gcmd.annotationInstance.scene.geometryList[n].type!==r.zq.CN_STAR&&this.gcmd.annotationInstance.scene.geometryList[n].type!==r.zq.POLYGON_MULTIPLE)return this.gcmd.annotationInstance.scene.geometryList[n];t.push(this.gcmd.annotationInstance.scene.geometryList[n])}}else if(this.gcmd.annotationInstance.scene.geometryList[n].isSelectable&&this.gcmd.annotationInstance.scene.geometryList[n].isMouseInside(e.x,e.y)){if(this.gcmd.annotationInstance.scene.geometryList[n].type!==r.zq.POLYGON&&this.gcmd.annotationInstance.scene.geometryList[n].type!==r.zq.POLYGON_GRAPH&&this.gcmd.annotationInstance.scene.geometryList[n].type!==r.zq.CIRCLE&&this.gcmd.annotationInstance.scene.geometryList[n].type!==r.zq.CCURVE_CLOSED&&this.gcmd.annotationInstance.scene.geometryList[n].type!==r.zq.RECTANGLE&&this.gcmd.annotationInstance.scene.geometryList[n].type!==r.zq.CN_GON&&this.gcmd.annotationInstance.scene.geometryList[n].type!==r.zq.CN_STAR&&this.gcmd.annotationInstance.scene.geometryList[n].type!==r.zq.POLYGON_MULTIPLE)return this.gcmd.annotationInstance.scene.geometryList[n];t.push(this.gcmd.annotationInstance.scene.geometryList[n])}var o=!1;if(t.length>1)for(n=0;n<t.length;++n)t[n].type!==r.zq.CIRCLE&&t[n].type!==r.zq.RECTANGLE&&t[n].type!==r.zq.POLYLINE&&t[n].type!==r.zq.POLYGON&&t[n].type!==r.zq.POLYGON_GRAPH&&t[n].type!==r.zq.CN_GON&&t[n].type!==r.zq.CN_STAR||(o=!0);var i=[];if(o){for(n=0;n<t.length;++n)i.push(Math.abs(t[n].getArea()));return t[(0,r.Cv)(i)]}for(n=0;n<t.length;++n)if(t[n].isSelectable&&t[n].isMouseInside(e.x,e.y))return t[n]},e.prototype.hasSelectedOvered=function(){for(var e=this.gcmd.annotationInstance.scene.geometryList.length;e--;)if(this.gcmd.annotationInstance.scene.geometryList[e].isSelected||this.gcmd.annotationInstance.scene.geometryList[e].isHoverValue)return!0;return!1},e.prototype.doneDragging=function(){for(var e=this.gcmd.annotationInstance.scene.geometryList.length;e--;)!0===this.gcmd.annotationInstance.scene.geometryList[e].isDrag&&(this.gcmd.annotationInstance.scene.geometryList[e].isDrag=!1)},e.prototype.removeAllCapturedGeo=function(){this.gcmd.gcmdSupporting.renderForce();for(var e=this.gcmd.annotationInstance.scene.listBasePoint.length;e--;)this.gcmd.annotationInstance.scene.listBasePoint[e]&&!0===this.gcmd.annotationInstance.scene.listBasePoint[e].isSelected&&this.gcmd.annotationInstance.scene.listBasePoint[e].remove();var t=this.gcmd.annotationInstance.scene.geometryList.length;if(0!==t){for(;t--;)void 0!==this.gcmd.annotationInstance.scene.geometryList[t]&&null!==this.gcmd.annotationInstance.scene.geometryList[t]&&!0===this.gcmd.annotationInstance.scene.geometryList[t].isSelected&&(this.gcmd.annotationInstance.scene.geometryList[t].type,r.zq.CLINE,this.gcmd.annotationInstance.scene.geometryList[t].remove());for(var n=0,o=this.gcmd.annotationInstance.scene.geometryList;n<o.length;n++){var i=o[n];!0===i.isSelected&&(i.isSelected=!1)}}},e.prototype.reorderNumberedPoints=function(e){for(var t=0;t<this.gcmd.annotationInstance.scene.listNPoint.length;++t)this.gcmd.annotationInstance.scene.listNPoint[t].numberIndexNeeded=!0;for(var n=[],o=1;e.length;){var i=e[0];for(e.shift(),t=0;t<this.gcmd.annotationInstance.scene.listNPoint.length;++t)this.gcmd.annotationInstance.scene.listNPoint[t].numberIndexNeeded&&this.gcmd.annotationInstance.scene.listNPoint[t].id===i&&(this.gcmd.annotationInstance.scene.listNPoint[t].numberIndexNeeded=!1,this.gcmd.annotationInstance.scene.listNPoint[t].numberIndex=o++,n.push(this.gcmd.annotationInstance.scene.listNPoint[t]))}this.gcmd.annotationInstance.scene.listNPoint=n},e.prototype.removeAllCapturedGeoGroup=function(){if(this.gcmd.annotationInstance.scene.capture){if(this.gcmd.annotationInstance.scene.capture.type&&this.gcmd.annotationInstance.scene.capture.type===r.zq.POLYGON_GRAPH&&this.gcmd.annotationInstance.scene.capture.graphCore.selVec)return void this.gcmd.annotationInstance.scene.capture.remove(!1);if(this.gcmd.annotationInstance.scene.capture.type&&this.gcmd.annotationInstance.scene.capture.type===r.zq.ANODE)return void this.gcmd.annotationInstance.scene.capture.remove()}var e=this.hasMultiSel();if(this.gcmd.annotationInstance.scene.capture&&this.gcmd.annotationInstance.scene.capture.type===r.zq.TEXT_LEADERLINE){var t=this.gcmd.annotationInstance.scene.capture;if(t.isSelectedReaderlineByClick&&t.leaderline)return void(t.IsSelectedReaderline&&t.removeLeaderline())}var n=[];e&&e.forEach((function(e){if(e.type===r.zq.POLYGON_GRAPH){var t=e;t.graphCore.selVec?t.remove(!1):(o=e.toJSON())&&(n.push(o),e.remove(!1))}else{var o;(o=e.toJSON())&&(n.push(o),e.remove(!1))}})),this.gcmd.annotationInstance.io.eventListenerAnnotation.removeGeometryStack(n),this.gcmd.gcmdSupporting.renderForce()},e.prototype.transformStack=function(){if(this.gcmd.annotationInstance.implementations.app.model.appCoreWrapper.appControllerStatus.mode===r.An.Drawing&&!this.gcmd.annotationInstance.activeCommandController.acProperties.isPanning){for(var e=[],t=[],n=this.gcmd.annotationInstance.scene.geometryList.length;n--;){var o=this.gcmd.annotationInstance.scene.geometryList[n];if(o.isSelected||o.isCapturedValue||o.isTransform){if(o.isUnderConstruction)continue;var i;o.isTransform&&(o.type===r.zq.TEXT_LEADERLINE?o.attachedShape?(i=o.toJSON())&&(t.push(i),o.isTransform=!1):(i=o.toJSON())&&(e.push(i),t.push(i),o.isTransform=!1):((i=o.toJSON())&&(e.push(i),t.push(i)),o.isTransform=!1)),o.updateVecsHistory(),o.type===r.zq.ALINE&&(i=o.toJSON())&&e.push(i)}}if(this.gcmd.annotationInstance.renderer.blackhole&&this.gcmd.annotationInstance.renderer.blackhole.isActive&&(0,r.Sp)(this.gcmd.annotationInstance.renderer.blackhole.v,new r.h9(this.gcmd.annotationInstance.activeCommandController.m.x,this.gcmd.annotationInstance.activeCommandController.m.y,0))<this.gcmd.annotationInstance.renderer.blackhole.radius)return void this.gcmd.annotationInstance.renderer.blackhole.removeSelectedShapesByBlackhole(e);for(t.length>0&&this.gcmd.annotationInstance.io.eventListenerAnnotation.transformStack(t),n=this.gcmd.annotationInstance.scene.geometryList.length;n--;)this.gcmd.annotationInstance.scene.geometryList[n].isTransform=!1}},e.prototype.undo=function(){this.gcmd.annotationInstance.scene.undo()},e.prototype.redo=function(){this.gcmd.annotationInstance.scene.redo()},e.prototype.emitSelections=function(){var e=this.gcmd.gcmdSelecting.getCapturedGeometries();this.gcmd.annotationInstance.io.emitAction("select-shapes@"+JSON.stringify(e))},e.prototype.updateColorStyle=function(e){for(var t=0;t<this.gcmd.annotationInstance.scene.geometryList.length;++t)this.gcmd.annotationInstance.scene.geometryList[t].isSelected&&this.gcmd.annotationInstance.scene.geometryList[t].updateColor(e);this.gcmd.annotationInstance.graphicsCoreWrapper.renderForce()},e.capture=void 0,e.captureMultiple=void 0,e.captureHovered=void 0,e.captureForEasing=void 0,e.list=[],e.copyPasteGeo=[],e.listHashColor={},e}(),ko=function(){function e(e){this.gcmd=e}return e.prototype.selecteObjectsByVecs=function(e,t){void 0===t&&(t=!1);for(var n=this.gcmd.annotationInstance.scene.geometryList.length,o=[];n--;)this.gcmd.annotationInstance.scene.geometryList[n].type!==r.zq.CBLACKHOLE&&this.gcmd.annotationInstance.scene.geometryList[n].type!==r.zq.CNODE&&this.gcmd.annotationInstance.scene.geometryList[n].type!==r.zq.ANODE&&this.gcmd.annotationInstance.scene.geometryList[n].type!==r.zq.ANODE_CIRCLE&&this.gcmd.annotationInstance.scene.geometryList[n].type!==r.zq.AMIDPOINT&&this.gcmd.annotationInstance.scene.geometryList[n].type!==r.zq.ANODE_RECT&&this.gcmd.annotationInstance.scene.geometryList[n].type!==r.zq.AN_GON&&this.gcmd.annotationInstance.scene.geometryList[n].type!==r.zq.ANODE_TEXT&&this.gcmd.annotationInstance.scene.geometryList[n].isSelectedByWindow(e)&&(this.gcmd.annotationInstance.scene.geometryList[n].isSelectedValue=!0,o.push(this.gcmd.annotationInstance.scene.geometryList[n].id));this.gcmd.annotationInstance.io.eventListenerAnnotation.selectionsStackByID(o)},e.prototype.deSelectCaptureObjects=function(){for(var e=this.gcmd.annotationInstance.scene.geometryList.length;e--;)this.gcmd.annotationInstance.scene.geometryList[e].isCapturedValue||(this.gcmd.annotationInstance.scene.geometryList[e].type===r.zq.TEXT?this.gcmd.annotationInstance.scene.geometryList[e].isEditiable=!1:this.gcmd.annotationInstance.scene.geometryList[e].isSelected&&(this.gcmd.annotationInstance.scene.geometryList[e].isSelected=!1,this.gcmd.annotationInstance.scene.geometryList[e].isHover=!1));this.gcmd.annotationInstance.scene.Capture=void 0},e.prototype.deSelectAllObjects=function(){for(var e=this.gcmd.annotationInstance.scene.geometryList.length;e--;)this.gcmd.annotationInstance.scene.geometryList[e].isCaptured=!1,this.gcmd.annotationInstance.scene.geometryList[e].isSelected=!1,this.gcmd.annotationInstance.scene.geometryList[e].isHover=!1;this.gcmd.annotationInstance.scene.Capture=void 0},e.prototype.selectAllObjects=function(){for(var e=this.gcmd.annotationInstance.scene.geometryList.length;e--;)this.gcmd.annotationInstance.scene.geometryList[e].type!==r.zq.APOINT&&this.gcmd.annotationInstance.scene.geometryList[e].type!==r.zq.AMIDPOINT&&this.gcmd.annotationInstance.scene.geometryList[e].type!==r.zq.ANODE&&this.gcmd.annotationInstance.scene.geometryList[e].type!==r.zq.ANODE_CIRCLE&&this.gcmd.annotationInstance.scene.geometryList[e].type!==r.zq.ANODE_NGON&&this.gcmd.annotationInstance.scene.geometryList[e].type!==r.zq.ANODE_RECT&&this.gcmd.annotationInstance.scene.geometryList[e].type!==r.zq.ANODE_TEXT&&this.gcmd.annotationInstance.scene.geometryList[e].type!==r.zq.CBLACKHOLE&&this.gcmd.annotationInstance.scene.geometryList[e].type!==r.zq.CNODE&&this.gcmd.annotationInstance.scene.geometryList[e].type!==r.zq.CNODE_RECT&&(this.gcmd.annotationInstance.scene.geometryList[e].isSelected||(this.gcmd.annotationInstance.scene.geometryList[e].isSelected=!0))},e.prototype.getAllGeometries=function(){for(var e,t=[],n=0;n<this.gcmd.annotationInstance.scene.geometryList.length;++n)(e=this.gcmd.annotationInstance.scene.geometryList[n].toJSON())&&t.push(e);return t},e.prototype.getCapturedGeometries=function(){for(var e,t=[],n=0;n<this.gcmd.annotationInstance.scene.geometryList.length;++n)this.gcmd.annotationInstance.scene.geometryList[n].isSelected&&(e=this.gcmd.annotationInstance.scene.geometryList[n].toJSON())&&t.push(e);return t},e.prototype.cancelActiveCommand=function(){this.gcmd.annotationInstance.activeCommandController.type!==r.uA.RECTANGLE&&this.gcmd.annotationInstance.activeCommandController.type!==r.uA.CIRCLE&&this.gcmd.annotationInstance.activeCommandController.type!==r.uA.FREEHAND_POLYLINE_BENDING&&this.gcmd.annotationInstance.activeCommandController.type!==r.uA.FREEHAND_POLYGON_GRAPH||this.gcmd.annotationInstance.activeCommandController.activeCommand.cancel()},e}(),No=function(){function e(e){this.gcmd=e}return e.prototype.updateStyle=function(){for(var e=this.gcmd.annotationInstance.scene.geometryList.length;e--;)this.gcmd.annotationInstance.scene.geometryList[e].styleComponent.updateStyle();this.renderForce()},e.prototype.renderForce=function(){this.gcmd.annotationInstance.graphicsCoreWrapper.renderForce(),this.gcmd.annotationInstance.activeCommandController.acProperties.needExecuteOptimizer=!0},e.prototype.checkBoundIntersection=function(e,t,n){return!!(0,r.c8)(e,t,n)},e.prototype.pushThemeJSON=function(e){this.gcmd.annotationInstance.customization.themeRenderStyle.pushThemeJSON(e)},e.prototype.toScreen=function(e,t){return[e,t]},e.prototype.toMap=function(e,t){return[e,t]},e.prototype.updateCanvasSize=function(e){this.gcmd.annotationInstance.graphicsCoreWrapper.canvasWrapper.aCanvas.canvasView.style.background="rgba(255, 0, 0, 0.2)",this.gcmd.annotationInstance.graphicsCoreWrapper.canvasWrapper.aCanvas.resizeCanvas(300,500),this.gcmd.annotationInstance.graphicsCoreWrapper.canvasWrapper.aCanvas.divHost.style.width="300px",this.gcmd.annotationInstance.graphicsCoreWrapper.canvasWrapper.aCanvas.divHost.style.height="500px"},e.prototype.toScreenVecOnCropping=function(e){return{x:e.x-this.gcmd.annotationInstance.scene.paramsEditing.croppingMaskParams.x,y:e.y-this.gcmd.annotationInstance.scene.paramsEditing.croppingMaskParams.y}},e.prototype.toScreenVecsOnCropping=function(e){for(var t=[],n=0;n<e.length;++n){var o=this.toScreenVecOnCropping(e[n]);t.push(new r.h9(o.x,o.y))}return t},e}(),Eo=function(e){this.annotationInstance=e,this.gcmdSupporting=new No(this),this.gcmdProcessing=new Vo(this),this.gcmdSelecting=new ko(this),this.gcmdAProcessing=new Lo(this)},_o=function(){function e(e){this.apiWrapper=e}return e.prototype.initAddon=function(e){},e}(),To=function(){function e(e){this._optimizerTextleaderline=0,this._optimizerPoint=0,this._scalePoint=0,this._renderTypePoint=0,this._iconPoint=0,this.apiWrapper=e}return e.prototype.logCommon=function(e,t){},e.prototype.toggleClusteringPoint=function(e){e?this.setOptimizerClusteringPoint(r.xX.Collision):this.setOptimizerClusteringPoint(r.xX.None)},e.prototype.setOptimizerClusteringPoint=function(e){void 0===e&&(e=r.xX.None),this.apiWrapper.annotationInstance.activeCommandController.acProperties.optimizerPoint=e,this.apiWrapper.annotationInstance.activeCommandController.acProperties.needExecuteOptimizer=!0,this.apiWrapper.annotationInstance.geometryCommon.gcmdSupporting.renderForce()},e.prototype.toggleDebuggerMode=function(){this.toggleInspector()},e.prototype.shiftDash=function(){this.apiWrapper.annotationInstance.scene.capture&&(0===this.apiWrapper.annotationInstance.scene.capture.styleComponent.renderStyle.dash.length?this.apiWrapper.annotationInstance.scene.capture.setDash([4,4]):this.apiWrapper.annotationInstance.scene.capture.setDash([]))},e.prototype.toggleInspector=function(){this.apiWrapper.annotationInstance.implementations.app.INSPECTION=!this.apiWrapper.annotationInstance.implementations.app.INSPECTION,this.apiWrapper.annotationInstance.activeCommandController.acProperties.isHiddenLog=!this.apiWrapper.annotationInstance.implementations.app.INSPECTION},e.prototype.shiftOptimizerTextleaderline=function(){void 0!==this.apiWrapper.annotationInstance.implementations.imageAnnoApp&&(this._optimizerTextleaderline++,this._optimizerTextleaderline%3==0?this.apiWrapper.annotationInstance.implementations.imageAnnoApp.activeCommandController.acProperties.optimizerTextleaderline=r.Nv.None:this._optimizerTextleaderline%3==1?this.apiWrapper.annotationInstance.implementations.imageAnnoApp.activeCommandController.acProperties.optimizerTextleaderline=r.Nv.Zoom:this._optimizerTextleaderline%3==2&&(this.apiWrapper.annotationInstance.implementations.imageAnnoApp.activeCommandController.acProperties.optimizerTextleaderline=r.Nv.Collision))},e.prototype.shiftActiveCluster=function(){void 0!==this.apiWrapper.annotationInstance.implementations.imageAnnoApp&&(this._optimizerPoint++,this._optimizerPoint%2==0?this.apiWrapper.annotationInstance.implementations.imageAnnoApp.activeCommandController.acProperties.optimizerPoint=r.xX.None:this.apiWrapper.annotationInstance.implementations.imageAnnoApp.activeCommandController.acProperties.optimizerPoint=r.xX.Collision)},e.prototype.shiftScaleForRPoint=function(){this._scalePoint++,this._scalePoint%3==0?this.apiWrapper.annotationInstance.geometryCommon.gcmdProcessing.setSizeRPoint(r.$u.SMALL):this._scalePoint%3==1?this.apiWrapper.annotationInstance.geometryCommon.gcmdProcessing.setSizeRPoint(r.$u.MEDIUM):this._scalePoint%3==2&&this.apiWrapper.annotationInstance.geometryCommon.gcmdProcessing.setSizeRPoint(r.$u.LARGE)},e.prototype.shiftRenderShapeForRPoint=function(){this._renderTypePoint++,this._renderTypePoint%3==0?this.apiWrapper.annotationInstance.geometryCommon.gcmdProcessing.setRenderTypePoint(r.oW.RpointA):this._renderTypePoint%3==1?this.apiWrapper.annotationInstance.geometryCommon.gcmdProcessing.setRenderTypePoint(r.oW.RpointB):this._renderTypePoint%3==2&&this.shiftIcon()},e.prototype.shiftIcon=function(){this._iconPoint++,this._iconPoint%5==0?this.apiWrapper.annotationInstance.geometryCommon.gcmdProcessing.setRenderTypePoint("/static/storymaps-website-common/images/browsers/chrome.png"):this._iconPoint%5==1?this.apiWrapper.annotationInstance.geometryCommon.gcmdProcessing.setRenderTypePoint("/static/images/story-maps-logo.png"):this._iconPoint%5==2||this._iconPoint%5==3?this.apiWrapper.annotationInstance.geometryCommon.gcmdProcessing.setRenderTypePoint("/static/storymaps-xgraphics/images/item-browser"):this._iconPoint%5==4&&this.apiWrapper.annotationInstance.geometryCommon.gcmdProcessing.setRenderTypePoint("/static/storymaps-website-common/images/browsers/safari.png")},e.prototype.updateIconPoint=function(e){this.apiWrapper.annotationInstance.geometryCommon.gcmdProcessing.updateIconPoint(e.id,e.url)},e.prototype.shiftScaleDynamicRender=function(){void 0!==this.apiWrapper.annotationInstance.implementations.imageAnnoApp&&(this.apiWrapper.annotationInstance.implementations.imageAnnoApp.activeCommandController.acProperties.isScaleDynamicRender=!this.apiWrapper.annotationInstance.implementations.imageAnnoApp.activeCommandController.acProperties.isScaleDynamicRender)},e.prototype.shiftLog=function(){this.apiWrapper.annotationInstance.activeCommandController.acProperties.isHiddenLog=!this.apiWrapper.annotationInstance.activeCommandController.acProperties.isHiddenLog},e.prototype.bindFromDisplay=function(){},e.prototype.shiftMapfilter=function(){},e.prototype.toggleMapfilter=function(e){},e.prototype.toggleActiveCommandChain=function(e){"true"===e?this.apiWrapper.annotationInstance.activeCommandController.acProperties.showActiveCommandChain=!0:"false"===e&&(this.apiWrapper.annotationInstance.activeCommandController.acProperties.showActiveCommandChain=!1)},e.prototype.toggleDrawingTooltips=function(e){"true"===e?this.apiWrapper.annotationInstance.activeCommandController.acProperties.showTooltip=!0:"false"===e&&(this.apiWrapper.annotationInstance.activeCommandController.acProperties.showTooltip=!1)},e.prototype.toggleGrid=function(e){},e.prototype.toggleBorderFeaturePolygon=function(){},e.prototype.shiftGrid=function(){},e.prototype.shiftMeasure=function(){},e.prototype.toggleMeasure=function(e){},e.prototype.togglTooltip=function(e){},e.prototype.togglActiveCommandChain=function(e){},e.prototype.shiftSnapping=function(){this.apiWrapper.annotationInstance.activeCommandController.acProperties.isActivateSnapping=!this.apiWrapper.annotationInstance.activeCommandController.acProperties.isActivateSnapping},e.prototype.shiftUnitDisplay=function(){this.apiWrapper.annotationInstance.activeCommandController.acProperties.showUnit=!this.apiWrapper.annotationInstance.activeCommandController.acProperties.showUnit;for(var e=0,t=this.apiWrapper.annotationInstance.scene.listALog;e<t.length;e++)t[e].isShow=this.apiWrapper.annotationInstance.activeCommandController.acProperties.showUnit},e.prototype.shiftUnit=function(){this.apiWrapper.annotationInstance.activeCommandController.acProperties.unitEnumInt++,0===this.apiWrapper.annotationInstance.activeCommandController.acProperties.unitEnumInt?this.apiWrapper.annotationInstance.activeCommandController.acProperties.unit=r.fb.Kilometer:1===this.apiWrapper.annotationInstance.activeCommandController.acProperties.unitEnumInt?this.apiWrapper.annotationInstance.activeCommandController.acProperties.unit=r.fb.Meter:2===this.apiWrapper.annotationInstance.activeCommandController.acProperties.unitEnumInt&&(this.apiWrapper.annotationInstance.activeCommandController.acProperties.unit=r.fb.Mile),this.apiWrapper.annotationInstance.activeCommandController.acProperties.unitEnumInt>2&&(this.apiWrapper.annotationInstance.activeCommandController.acProperties.unitEnumInt=0)},e.prototype.toggleCollisionDetection=function(){this.apiWrapper.annotationInstance.activeCommandController.acProperties.needCollisionDetection=!this.apiWrapper.annotationInstance.activeCommandController.acProperties.needCollisionDetection},e.prototype.activateOffScreen=function(){this.apiWrapper.annotationInstance.graphicsCoreWrapper.canvasWrapper.aCanvasOffScreen.appendDiv()},e.prototype.deactivateOffScreen=function(){try{this.apiWrapper.annotationInstance.graphicsCoreWrapper.canvasWrapper.aCanvasOffScreen.removeDiv()}catch(e){}},e.prototype.shiftBlackholeRender=function(){},e.prototype.shiftBlackholePos=function(){this.apiWrapper.annotationInstance.renderer.blackhole.smartEvasion=!this.apiWrapper.annotationInstance.renderer.blackhole.smartEvasion},e}(),Do=function(e){this.annotationInstance=e,this.addon=new _o(this),this.environment=new To(this)},Mo=function(){function e(e,t){this.icons={},this.tempImageID=void 0,this.customization=e,this.initIcon(t)}return e.prototype.initIcon=function(e){for(var t in e.iconBase64){var n=new Image;n.src=e.iconBase64[t],this.icons[t]=n}},e.prototype.addIcon=function(e){this.icons[e]||(this.icons[e]=this.addIconAsset(e))},e.prototype.getIconByURL=function(e){return this.icons[e]},e.prototype.removeIconAsset=function(e){delete this.icons[e]},e.prototype.addIconAsset=function(e){var t=new Image;return t.crossOrigin="Anonymous",t.onload=function(){},t.src=e,t},e}(),zo=function(e,t,n,o){return new(n||(n=Promise))((function(i,s){function r(e){try{h(o.next(e))}catch(e){s(e)}}function a(e){try{h(o.throw(e))}catch(e){s(e)}}function h(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}h((o=o.apply(e,t||[])).next())}))},Go=function(e,t){var n,o,i,s,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(i=2&s[0]?o.return:s[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;switch(o=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,o=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(!((i=(i=r.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){r=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){r.label=s[1];break}if(6===s[0]&&r.label<i[1]){r.label=i[1],i=s;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(s);break}i[2]&&r.ops.pop(),r.trys.pop();continue}s=t.call(e,r)}catch(e){s=[6,e],o=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}},Wo=function(){function e(e,t){this.shiftTheme=1,this.shiftThemeNumberLayerOrdering=0,this.numLayer=-1,this.isDone=!1,this.queueTheme=void 0,this.customization=e,this.customization.annotationInstance.implementations.app.param.environment===r.qA.AGSM?(this.defaultRPoint=(0,r.VT)(),this.defaultNPoint=(0,r.nP)()):(this.defaultRPoint=(0,r.KF)(),this.defaultNPoint=(0,r.nP)()),this.computeTheme(t)}return e.prototype.shiftEnvironment=function(e){e===r.qA.AGSM?this.updateRPointPath((0,r.VT)()):this.updateRPointPath((0,r.KF)())},e.prototype.updateRPointPath=function(e){this.customization.themeCurrent.rPoint.SVG.path2D=e.path2D;var t=36,n=28;this.customization.annotationInstance.implementations.app.param.environment===r.qA.AGSM&&(t=32,n=30),this.customization.themeCurrent.rPoint.width=t,this.customization.themeCurrent.rPoint.height=n;for(var o=0;o<this.customization.annotationInstance.scene.listRPoint.length;++o)this.customization.annotationInstance.scene.listRPoint[o].styleComponent.renderStyle.width=t,this.customization.annotationInstance.scene.listRPoint[o].styleComponent.renderStyle.height=n},e.prototype.updateNPointPath=function(e){this.customization.themeCurrent.nPoint.SVG.path2D=e},e.prototype.pushThemeJSON=function(e){return zo(this,void 0,void 0,(function(){return Go(this,(function(t){switch(t.label){case 0:return this.isDone?[4,this.computeTheme(e)]:(this.queueTheme=e,[2]);case 1:return t.sent(),[2]}}))}))},e.prototype.computeTheme=function(e){return zo(this,void 0,void 0,(function(){var t;return Go(this,(function(n){switch(n.label){case 0:return this.isDone=!1,this.customization.themeCurrent=new Qt,this.updateThemeBGType(e.mode),this.updateThemeInteraction(e),this.updateMaskColor(e.properties.maskColor),this.updateSelection(e.graphics.line.colorRgba,e.graphics.polygon.fill),this.buildPropertiesData(e),this.customization.themeCurrent=this.buildThemeDataShape(e.graphics),[4,this.buildThemeDataAsync(e.graphics)];case 1:return n.sent(),this.isDone=!0,this.queueTheme&&(t=this.queueTheme,this.queueTheme=void 0,this.computeTheme(t)),[2]}}))}))},e.prototype.buildPropertiesData=function(e){this.customization.themeCurrent.properties.elasticScale=e.properties.elasticScale,this.customization.themeCurrent.properties.desaturationValue=e.properties.desaturationValue,this.customization.themeCurrent.properties.timeTransitionA=e.properties.timeTransitionA,this.customization.themeCurrent.properties.timeTransitionB=e.properties.timeTransitionB},e.prototype.buildThemeDataShape=function(e){var t=this.customization.themeCurrent;return t.node.size=.5*e.node.sizeNode,t.node.lineWidth=2,t.node.sizeMid=.5*e.node.sizeNodeMid,t.node.lineWidthMid=2,t.polyline.strokeStyleFirstArray=[e.line.colorRgba[0],e.line.colorRgba[1],e.line.colorRgba[2],e.line.colorRgba[3]],t.polyline.strokeStyleSecondArray=[e.line.colorRgba[0],e.line.colorRgba[1],e.line.colorRgba[2],t.properties.opacity],t.polyline.lineWidth=e.line.width,t.arrow.fillStyleFirstArray=[e.arrow.colorRgba[0],e.arrow.colorRgba[1],e.arrow.colorRgba[2],e.arrow.colorRgba[3]],t.arrow.fillStyleSecondArray=[e.arrow.colorRgba[0],e.arrow.colorRgba[1],e.arrow.colorRgba[2],t.properties.opacity+.5],t.arrow.strokeStyleFirstArray=[e.arrow.colorRgba[0],e.arrow.colorRgba[1],e.arrow.colorRgba[2],e.arrow.colorRgba[3]],t.arrow.strokeStyleSecondArray=[e.arrow.colorRgba[0],e.arrow.colorRgba[1],e.arrow.colorRgba[2],t.properties.opacity],t.arrow.lineWidth=e.arrow.width,t.arrow.scale=e.arrow.scale,t.polygon.fillStyleFirstArray=[e.polygon.fill[0],e.polygon.fill[1],e.polygon.fill[2],e.polygon.fill[3]],t.polygon.fillStyleSecondArray=[e.polygon.fill[0],e.polygon.fill[1],e.polygon.fill[2],t.properties.opacity-.2],t.polygon.strokeStyleFirstArray=[e.polygon.colorRgba[0],e.polygon.colorRgba[1],e.polygon.colorRgba[2],e.polygon.colorRgba[3]],t.polygon.strokeStyleSecondArray=[e.polygon.colorRgba[0],e.polygon.colorRgba[1],e.polygon.colorRgba[2],t.properties.opacity-.2],t.polygon.lineWidth=e.polygon.width,t.freehand.fillStyleFirstArray=[e.polygon.fill[0],e.polygon.fill[1],e.polygon.fill[2],t.properties.opacity],t.freehand.strokeStyleFirstArray=[e.polygon.colorRgba[0],e.polygon.colorRgba[1],e.polygon.colorRgba[2],t.properties.opacity],t.freehand.lineWidth=e.polygon.width,t.textleaderline.scale=e.textLeaderline.scale,t.textleaderline.box.dash=e.textLeaderline.box.dash,t.textleaderline.box.lineWidth=e.textLeaderline.box.width,t.textleaderline.box.fillStyle=e.textLeaderline.box.fill,t.textleaderline.box.strokeStyle=e.textLeaderline.box.strokeStyle,t.textleaderline.handleNode.dash=e.textLeaderline.handleNode.dash,t.textleaderline.handleNode.lineWidth=e.textLeaderline.handleNode.width,t.textleaderline.handleNode.fillStyle=e.textLeaderline.handleNode.fill,t.textleaderline.handleNode.strokeStyle=e.textLeaderline.handleNode.strokeStyle,t.textleaderline.leaderline.dash=e.textLeaderline.leaderline.dash,t.textleaderline.leaderline.lineWidth=e.textLeaderline.leaderline.width,t.textleaderline.leaderline.strokeStyle=e.textLeaderline.leaderline.strokeStyle,t.textleaderline.anchorNode.dash=e.textLeaderline.anchorNode.dash,t.textleaderline.anchorNode.lineWidth=e.textLeaderline.anchorNode.width,t.textleaderline.anchorNode.fillStyle=e.textLeaderline.anchorNode.fill,t.textleaderline.anchorNode.strokeStyle=e.textLeaderline.anchorNode.strokeStyle,t.iPoint.scale=e.iconPoint.scale,t.rPoint.URL=e.regularPoint.url,t.rPoint.fillStyleFirstArray=e.regularPoint.colorRgba,t.rPoint.shadowBlur=e.regularPoint.shadowBlur,t.rPoint.shadowColor=e.regularPoint.shadowColor,t.rPoint.shadowColorHover=e.regularPoint.shadowColorHover,t.rPoint.scale=e.regularPoint.scale,t.rPoint.fillStyleSecondArray=[e.regularPoint.colorRgba[0],e.regularPoint.colorRgba[1],e.regularPoint.colorRgba[2],t.properties.opacity],t.nPoint.URL=e.numberedPoint.url,t.nPoint.shadowBlur=e.numberedPoint.shadowBlur,t.nPoint.shadowColor=e.numberedPoint.shadowColor,t.nPoint.shadowColorHover=e.numberedPoint.shadowColorHover,t.nPoint.fillStyleSecondArray=[e.numberedPoint.colorRgba[0],e.numberedPoint.colorRgba[1],e.numberedPoint.colorRgba[2],t.properties.opacity+.1],t.nPoint.fillStyleFirstArray=[e.numberedPoint.colorRgba[0],e.numberedPoint.colorRgba[1],e.numberedPoint.colorRgba[2],e.numberedPoint.colorRgba[3]],t.nPoint.fontColorArray=[e.numberedPoint.fontColor[0],e.numberedPoint.fontColor[1],e.numberedPoint.fontColor[2],e.numberedPoint.fontColor[3]],t.nPoint.fontSize=e.numberedPoint.fontSize,t.nPoint.fontFamily=e.numberedPoint.fontFamily,t.nPoint.scale=e.numberedPoint.scale,t},e.prototype.buildThemeDataAsync=function(e){return zo(this,void 0,void 0,(function(){var e,t,n,o;return Go(this,(function(i){return(e=this.customization.themeCurrent).rPoint.SVG={type:"path",height:28,width:36,path2D:this.defaultRPoint.path2D},t=28,e.rPoint.SVG.height=t,e.rPoint.height=t,n=36,e.rPoint.SVG.width=n,e.rPoint.width=n,o={type:"path",width:36,height:28,path:[],path2D:this.defaultNPoint.path2D},e.nPoint.SVG=o,t=28,e.nPoint.SVG.height=t,e.nPoint.height=t,n=36,e.nPoint.SVG.width=n,e.nPoint.width=n,this.customization.annotationInstance.geometryCommon.gcmdSupporting.updateStyle(),[2,e]}))}))},e.prototype.updateThemeBGType=function(e){this.customization.themeCurrent.properties.isDarkBG="dark"===e},e.prototype.updateMaskColor=function(e){this.customization.themeCurrent.properties.maskColor="rgba("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")",this.customization.annotationInstance.graphicsCoreWrapper.canvasWrapper.aCanvasMask.maskColor=this.customization.themeCurrent.properties.maskColor},e.prototype.updateThemeInteraction=function(e){this.customization.themeCurrent.properties.outlineHoverColorArray=e.properties.outlineHoverColor,this.customization.themeCurrent.properties.outlineHoverColorRGBAString="rgba("+e.properties.outlineHoverColor[0]+", "+e.properties.outlineHoverColor[1]+", "+e.properties.outlineHoverColor[2]+", "+e.properties.outlineHoverColor[3]+")"},e.prototype.updateSelection=function(e,t){this.customization.themeCurrent.selection.strokeStyleFirstArray=e,this.customization.themeCurrent.selection.fillStyleFirstArray=t},e}(),Bo=function(e){this.key="",this.hasShift=!1,this.hasControl=!1,this.ac=r.uA.NONE,this.key=e.key.toUpperCase(),this.hasShift=e.shift,this.hasControl=e.control},Ho=function(){function e(e,t){this.shortcutCommands={},this.customization=e,t?this.pushThemeJSON(t):this.pushThemeJSON(this.customization.annotationInstance.implementations.app.model.assets.theme)}return e.prototype.pushThemeJSON=function(e){var t=this;if(e.shortcut)for(var n=function(n){Object.keys(e.shortcut[n]).forEach((function(o){var i,s=e.shortcut[n][o];return"select"===o&&""!==s.key?((i=new Bo(s)).ac=r.uA.SELECT,void(t.shortcutCommands[s.key.toUpperCase()]=i)):"selectRect"===o&&""!==s.key?((i=new Bo(s)).ac=r.uA.SELECT_RECT,void(t.shortcutCommands[s.key.toUpperCase()]=i)):"undo"===o&&""!==s.key?((i=new Bo(s)).ac=r.uA.UNDO,void(t.shortcutCommands[s.key.toUpperCase()]=i)):"redo"===o&&""!==s.key?((i=new Bo(s)).ac=r.uA.REDO,void(t.shortcutCommands[s.key.toUpperCase()]=i)):"rPoint"===o&&""!==s.key?((i=new Bo(s)).ac=r.uA.POINT_REGULAR,void(t.shortcutCommands[s.key.toUpperCase()]=i)):"nPoint"===o&&""!==s.key?((i=new Bo(s)).ac=r.uA.POINT_NUMBERED,void(t.shortcutCommands[s.key.toUpperCase()]=i)):"polyline"===o&&""!==s.key?((i=new Bo(s)).ac=r.uA.POLYLINE_BENDING,void(t.shortcutCommands[s.key.toUpperCase()]=i)):"freehandPolyline"===o&&""!==s.key?((i=new Bo(s)).ac=r.uA.FREEHAND_POLYLINE_BENDING,void(t.shortcutCommands[s.key.toUpperCase()]=i)):"polygon"===o&&""!==s.key?((i=new Bo(s)).ac=r.uA.POLYGON_GRAPH,void(t.shortcutCommands[s.key.toUpperCase()]=i)):"freehandPolygon"===o&&""!==s.key?((i=new Bo(s)).ac=r.uA.FREEHAND_POLYGON_GRAPH,void(t.shortcutCommands[s.key.toUpperCase()]=i)):"textleaderline"===o&&""!==s.key?((i=new Bo(s)).ac=r.uA.TEXT_LEADERLINE,void(t.shortcutCommands[s.key.toUpperCase()]=i)):"singleArrow"===o&&""!==s.key?((i=new Bo(s)).ac=r.uA.ARROW_SINGLE,void(t.shortcutCommands[s.key.toUpperCase()]=i)):"doubleArrrow"===o&&""!==s.key?((i=new Bo(s)).ac=r.uA.ARROW_DOUBLE,void(t.shortcutCommands[s.key.toUpperCase()]=i)):void 0}))},o=0;o<e.shortcut.length;++o)n(o)},e}(),Fo=function(){function e(e,t){this.annotationInstance=e,t||(t=this.annotationInstance.implementations.app.model.assets.theme),this.iconAsset=new Mo(this,t),this.themeRenderStyle=new Wo(this,t),this.shortcut=new Ho(this,t)}return e.prototype.downloadTheme=function(){return this.themeCurrent.downloadJson()},e}(),Uo=function(){function e(e,t){void 0===t&&(t="canvas"),this.id="canvas",this.zIndex="1",this.loopNum=0,this.needRenderloop=!0,this.pause=!1,this.frameRate=60,this.isLoop=!0,this.isViewChanging=!1,this.isActive=!1,this.divHost=e,this.id=t,this.initPre()}return e.prototype.initPre=function(){this.canvasView=document.createElement("canvas"),this.canvasView.id=this.id,this.canvasView.style.width="100%",this.canvasView.style.height="100%",this.canvasView.style.zIndex=this.zIndex,this.canvasView.style.position="absolute",this.canvasView.style.pointerEvents="none",this.ctxView=this.canvasView.getContext("2d"),this.ctxView.globalCompositeOperation="source-over",this.divHost.appendChild(this.canvasView),this.canvas=document.createElement("canvas"),this.canvas.id=this.id,this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.zIndex=this.zIndex,this.canvas.style.position="absolute",this.canvas.style.pointerEvents="none",this.ctx=this.canvas.getContext("2d"),this.ctx.globalCompositeOperation="source-over",this.deltaTime=new jo,this.canvasLoopController=new qo(100),this.canvasLoopController.level=4,this.init(),this.loop()},e.prototype.init=function(){},e.prototype.loop=function(){var e=this;if(this.isActive){var t=performance.now();if(this.deltaTime.updateFPS(),this.canvasLoopController.level>3){if(6===this.canvasLoopController.level)requestAnimationFrame((function(){e.loop()})),this.clear(),this.render();else if(5===this.canvasLoopController.level)this.isViewChanging,requestAnimationFrame((function(){e.loop()})),this.clear(),this.render();else if(4===this.canvasLoopController.level){if(this.isViewChanging,requestAnimationFrame((function(){e.loop()})),this.canvasLoopController.stop)return;this.clear(),this.render(),this.canvasLoopController.timerForStop()}}else 1===this.canvasLoopController.level&&this.isViewChanging?this.clear():(this.clear(),this.render());var n=performance.now();this.log="level:  "+this.canvasLoopController.level+", total frames: "+this.loopNum+++" (FPS: "+this.deltaTime.frameRate.toFixed(0)+"), a loop took: "+(n-t).toFixed(2)+" ms to execute.",this.logOut()}},Object.defineProperty(e.prototype,"log",{get:function(){return this._log},set:function(e){this._log=e},enumerable:!1,configurable:!0}),e.prototype.initOffscreen=function(e){this.canvasOffScreen=e},e.prototype.resize=function(e,t){this.canvas.width=e,this.canvas.height=t},e.prototype.clear=function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctxView.clearRect(0,0,this.canvas.width,this.canvas.height),this.canvasOffScreen&&this.canvasOffScreen.clear()},e.prototype.setLevel1=function(){this.canvasLoopController.level=1,this.loop()},e.prototype.setLevel2=function(){this.canvasLoopController.level=2,this.loop()},e.prototype.setLevel3=function(){this.canvasLoopController.level=3,this.loop()},e.prototype.renderSetLevel4=function(){this.canvasLoopController.stop=!0},e.prototype.setLevel4=function(){var e=this;this.canvasLoopController.reset(),setTimeout((function(){e.canvasLoopController.level=4,e.loop()}),500)},e.prototype.setLevel5=function(){var e=this;this.canvasLoopController.reset(),setTimeout((function(){e.canvasLoopController.level=5,e.loop()}),500)},e.prototype.setLevel6=function(){var e=this;this.canvasLoopController.reset(),setTimeout((function(){e.canvasLoopController.level=6,e.loop()}),500)},e}(),jo=function(){function e(){this.last=0}return e.prototype.updateFPS=function(){this.now=window.performance.now(),this.msLoop=this.now-this.last,this.last=this.now,this.delta=this.delta+Math.min(1,this.msLoop/1e3),this.delta>this.frameRate&&(this.delta=this.delta-this.frameRate),this.delta=(Date.now()-this.timeLastRender)/1e3,this.timeLastRender=Date.now(),this.frameRate=1/this.delta},Object.defineProperty(e.prototype,"dt",{get:function(){return this.delta},enumerable:!1,configurable:!0}),e}(),qo=function(){function e(e){this._level=-1,this._stop=!1,this.numRender=0,this.numStopFrame=e}return Object.defineProperty(e.prototype,"stop",{get:function(){return this._stop},set:function(e){this.numRender=0,this._stop=e},enumerable:!1,configurable:!0}),e.prototype.timerForStop=function(){this.numRender++,this.numRender>this.numStopFrame&&(this.numRender=0,this.stop=!0)},e.prototype.reset=function(){this._level=-1},Object.defineProperty(e.prototype,"level",{get:function(){return this._level},set:function(e){this._level=e},enumerable:!1,configurable:!0}),e}(),Jo=function(){function e(t){e.instance=this,this.hostCanvas=t,this.init()}return e.prototype.init=function(){this.canvas=document.createElement("canvas"),this.canvas.id="OffScreen",this.canvas.style.zIndex="90",this.canvas.style.position="absolute",this.offScreenCtx=this.canvas.getContext("2d"),this.canvas.width=this.hostCanvas.width,this.canvas.height=this.hostCanvas.height},e.prototype.resizeCanvas=function(e,t){this.offScreenCtx.canvas.width=e,this.offScreenCtx.canvas.height=t},e.prototype.clear=function(){this.offScreenCtx.clearRect(0,0,this.offScreenCtx.canvas.width,this.offScreenCtx.canvas.height)},e}(),Yo=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Xo=function(e){function t(t,n){void 0===n&&(n=60);var o=e.call(this,t.graphicsCoreWrapper.imageAnnoApp.implementations.app.model.modelViewWrapper.div,"AnnotationImageTool")||this;return o.then=0,o.interval=0,o.last=0,o.asyncSafeGuard=0,o.time=0,o._frameSkip=3,o.canvasWrapper=t,o.xOff=0,o.yOff=0,o.xOffCurrent=0,o.yOffCurrent=0,o.xOffPre=0,o.yOffPre=0,o.anchor=new r.h9(0,0,0),o.timeLastRender=0,o.delta=0,o.frameVisTimer=.05,o.dropRate=30,o.IsRenderSkip=!0,o.isLoop=!0,o.frameRate=n,o.deltaTime.frameRate=n,o.setLevel6(),o.frameSkip=3,o}return Yo(t,e),Object.defineProperty(t.prototype,"frameSkip",{get:function(){return this._frameSkip},set:function(e){this._frameSkip=e},enumerable:!1,configurable:!0}),t.prototype.initPost=function(e){this.isActive=e,this.ctx.lineCap=r.cg.Round},Object.defineProperty(t.prototype,"imageSmoothingEnabled",{set:function(e){this.ctx.imageSmoothingEnabled=e,this.ctxView.imageSmoothingEnabled=e},enumerable:!1,configurable:!0}),t.prototype.getImageData=function(){return this.ctx.getImageData(0,0,this.ctx.canvas.width,this.ctx.canvas.height)},t.prototype.render=function(){if(this.clearPost(),this.time+=.001,!this.isActive)return this.canvasWrapper.aCanvasOffScreen.clear(),void this.ctxView.clearRect(0,0,this.ctxView.canvas.width,this.ctxView.canvas.height);this.canvasWrapper.aCanvasOffScreen.clear(),this.canvasWrapper.graphicsCoreWrapper.rendererWrapper.render(this.ctx),this.ctxView.clearRect(0,0,this.ctxView.canvas.width,this.ctxView.canvas.height),0!==this.canvas.width&&0!==this.canvas.height?this.ctxView.drawImage(this.canvas,0,0):(this.isLoop=!1,this.isActive=!1,this.canvasLoopController.stop=!0)},t.prototype.clear=function(){},t.prototype.clearPost=function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctxView.clearRect(0,0,this.canvas.width,this.canvas.height),this.canvasOffScreen&&this.canvasOffScreen.clear()},t.prototype.resizeCanvas=function(e,t){this.ctx.canvas.width=e,this.ctx.canvas.height=t,this.ctxView.canvas.width=e,this.ctxView.canvas.height=t},t.prototype.destroy=function(){this.setLevel1(),this.isLoop=!1,this.isActive=!1,this.canvasLoopController.stop=!0,this.loop=function(){},this.render=function(){},this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas)},t.prototype.logOut=function(){},Object.defineProperty(t.prototype,"IsRenderSkip",{get:function(){return this._isRenderSkip},set:function(e){this._isRenderSkip=e},enumerable:!1,configurable:!0}),t.prototype.doPause=function(e){var t=this;void 0===e&&(e=0),this.isActive=!1,this.canvasWrapper.aCanvasOffScreen.clear(),this.ctxView.clearRect(0,0,this.ctxView.canvas.width,this.ctxView.canvas.height),e>0&&setTimeout((function(){t.doResume()}),e)},t.prototype.doResume=function(){this.isActive=!0,this.isLoop=!0,this.canvasWrapper.renderForce(),this.loop()},t}(Uo),Ko=function(){function e(e){this.isActive=!0,this.canvasWrapper=e,this._maskColor="#000000",this.canvasWrapper.graphicsCoreWrapper.imageAnnoApp.implementations.app.model.appCoreWrapper.appProperties.isStandalone,this._width=0,this.init()}return e.prototype.init=function(){this.canvas=document.createElement("canvas"),this.canvas.id="AnnotationImageToolMask",this.canvas.style.zIndex="1",this.canvas.style.position="absolute",this.canvas.style.pointerEvents="none",this.ctx=this.canvas.getContext("2d"),this.canvasWrapper.graphicsCoreWrapper.imageAnnoApp.implementations.app.model.modelViewWrapper.div.appendChild(this.canvas),this.ctx.globalCompositeOperation="source-over",this.canvas.width=1,this.canvas.height=1,this.renderMask()},Object.defineProperty(e.prototype,"maskColor",{get:function(){return this._maskColor},set:function(e){this._maskColor=e,this.renderMask()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},set:function(e){this._width=e,this.renderMask()},enumerable:!1,configurable:!0}),e.prototype.resizeCanvas=function(e,t){this.canvas.width=e,this.canvas.height=t,this.renderMask()},e.prototype.renderMask=function(){this.isActive&&(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.lineWidth=0,this.ctx.strokeStyle=this._maskColor,this.ctx.fillStyle=this._maskColor,this.ctx.beginPath(),this.ctx.rect(0,0,this._width,this.canvas.height),this.ctx.rect(this.canvas.width-this._width,0,this.canvas.width,this.canvas.height),this.ctx.closePath(),this.ctx.fill())},e}(),$o=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Qo=function(e){function t(t){var n=e.call(this,t.aCanvas.canvas)||this;return n.isActive=!0,n.canvasWrapper=t,n.canvas.id="AnnotationOffScreen",n.offScreenCtx.imageSmoothingEnabled=!1,n}return $o(t,e),t.prototype.appendDiv=function(){this.canvasWrapper.graphicsCoreWrapper.imageAnnoApp.implementations.app.model.modelViewWrapper.div.appendChild(this.canvas)},t.prototype.removeDiv=function(){this.canvasWrapper.graphicsCoreWrapper.imageAnnoApp.implementations.app.model.modelViewWrapper.div.removeChild(this.canvas)},t.prototype.getOffscreenRenderer=function(){return this.offScreenCtx},t.prototype.clear=function(){this.offScreenCtx.clearRect(0,0,this.canvas.width,this.canvas.height)},t.prototype.getColorByPos=function(e,t){if(!this.isActive)return"";var n=this.offScreenCtx.getImageData(e,t,1,1).data;return"rgb("+n[0]+","+n[1]+","+n[2]+")"},t}(Jo),Zo=function(){function e(e,t){this.graphicsCoreWrapper=e,this.aCanvas=new Xo(this),this.aCanvas.setLevel4(),this.aCanvasOffScreen=new Qo(this),this.aCanvasMask=new Ko(this),this.aCanvas.initPost(t)}return e.prototype.pause=function(e){void 0===e&&(e=0),this.aCanvas.doPause(e)},e.prototype.resume=function(){this.aCanvas.doResume()},e.prototype.destroy=function(){this.aCanvas.destroy(),this.isActive=!1},e.prototype.renderForce=function(){this.aCanvas.canvasLoopController.stop=!1},e.prototype.resizeCanvas=function(e,t){this.aCanvas.resizeCanvas(e,t),this.aCanvasOffScreen&&(this.aCanvasOffScreen.canvas.width=e,this.aCanvasOffScreen.canvas.height=t,this.aCanvasOffScreen.canvas.style.width=this.aCanvas.canvas.style.width,this.aCanvasOffScreen.canvas.style.height=this.aCanvas.canvas.style.height)},Object.defineProperty(e.prototype,"isActive",{set:function(e){this.aCanvas.isActive=e,this.aCanvasOffScreen.isActive=e,this.aCanvasMask.isActive=e,e&&this.aCanvas.loop()},enumerable:!1,configurable:!0}),e}(),ei=function(){function e(e){this.graphicsCoreWrapper=e}return e.prototype.resizeCanvas=function(e,t){this.graphicsCoreWrapper.canvasWrapper.resizeCanvas(e,t)},e.prototype.render=function(e){this.graphicsCoreWrapper.imageAnnoApp.implementations.render(e)},e}(),ti=function(){function e(e,t){this.scaleScreenByRatioImageSize=1,this.imageAnnoApp=e,this.canvasWrapper=new Zo(this,t)}return e.prototype.initPost=function(){this.rendererWrapper=new ei(this)},e.prototype.pause=function(e){void 0===e&&(e=0),this.canvasWrapper.pause(e)},e.prototype.resume=function(){this.canvasWrapper.resume()},e.prototype.resizeCanvas=function(e,t){this.canvasWrapper.resizeCanvas(e,t)},e.prototype.renderForce=function(){this.canvasWrapper.renderForce()},e.prototype.destroy=function(){this.canvasWrapper.destroy()},e}(),ni="@",oi=function(){function e(e){this.log=!1,this.io=e,this.init()}return e.prototype.init=function(){this.numOfCommand=0},e.prototype.shiftCAMode=function(e){this.log;var t="set-drawing-mode@"+e.toString();this.io.emitAction(t)},e.prototype.shiftOptionStack=function(e,t){var n=""+e+ni+t;this.io.emitAction(n)},e.prototype.modificationStack=function(e){this.log},e.prototype.addGeometryStack=function(e){if(this.log,e){var t="add@"+JSON.stringify(e);this.numOfCommand++,this.io.emitAction(t),this.io.imageAnnoApp.scene.captureScene()}},e.prototype.selectionStack=function(e){if(this.log,e)if(e.isSelected){var t="select@"+JSON.stringify([e.id]);if(this.io.imageAnnoApp.activeCommandController.acProperties.pressShift&&this.io.imageAnnoApp.implementations.app.APP===r.BQ.AnnotationMap){var n=this.io.imageAnnoApp.geometryCommon.gcmdProcessing.getSelectedGeoIDs();if(n.length)return void this.selectionsStackByID(n)}this.io.imageAnnoApp.implementations.app.model.appCoreWrapper.appProperties.compileMode!==r.ct.Production?(this.numOfCommand++,this.io.emitAction(t)):this.io.emitAction(t)}else t="deselect@"+JSON.stringify([e.id]),this.numOfCommand++,this.io.emitAction(t)},e.prototype.selectionsStackByID=function(e){this.log;var t="select@"+JSON.stringify(e);this.numOfCommand++,this.io.emitAction(t)},e.prototype.hideStack=function(e){if(this.log,e)if(e.isHidden){var t="hide@"+e.id;this.numOfCommand++,this.io.emitAction(t)}else t="show@"+e.id,this.numOfCommand++,this.io.emitAction(t)},e.prototype.hoverStack=function(e){if(this.log,e)if(e.isOver){var t="enter@"+e.id;this.numOfCommand++,this.io.emitAction(t)}else t="leave@"+e.id,this.numOfCommand++,this.io.emitAction(t)},e.prototype.hoverPostStack=function(e){if(this.log,e&&e.isOver){var t="enterPost@"+e.id;this.numOfCommand++,this.io.emitAction(t)}},e.prototype.updateStack=function(e){if(this.log,e){var t="update@"+JSON.stringify({id:e.id,content:e.data.content});this.numOfCommand++,this.io.emitAction(t)}},e.prototype.showPopupStack=function(e){if(this.log,e){var t="showPopup@"+JSON.parse(JSON.stringify(e)).id;this.numOfCommand++,this.io.emitAction(t)}},e.prototype.hidePopupStack=function(e){if(this.log,e){var t="hidePopup@"+JSON.parse(JSON.stringify(e)).id;this.numOfCommand++,this.io.emitAction(t)}},e.prototype.showTextStack=function(e){if(this.log,e){var t="showText@"+JSON.parse(JSON.stringify(e)).id;this.numOfCommand++,this.io.emitAction(t)}},e.prototype.hideTextStack=function(e){if(this.log,e){var t="hideText@"+JSON.parse(JSON.stringify(e)).id;this.numOfCommand++,this.io.emitAction(t)}},e.prototype.startEditingText=function(e){if(this.log,e){var t="startEditingText@"+e.id;this.numOfCommand++,this.io.emitAction(t)}},e.prototype.endEditingText=function(e){if(this.log,e){var t="endEditingText@"+e.id;this.numOfCommand++,this.io.emitAction(t)}},e.prototype.initGhostStack=function(e){if(this.log,e){var t="add@"+JSON.stringify(e);this.numOfCommand++,this.io.emitAction(t)}},e.prototype.showGhostPopupStack=function(e){if(this.log,e){var t="showGhostPopup@"+JSON.stringify({id:"ghost",mapping:e.data.content});this.numOfCommand++,this.io.emitAction(t)}},e.prototype.hideGhostPopupStack=function(){this.log,this.io.emitAction("hideGhostPopup")},e.prototype.removeGeometryStack=function(e){if(this.log,e){var t="remove@",n=[];e.forEach((function(e){n.push(e.id)})),this.numOfCommand++,t+=JSON.stringify(n),this.io.emitAction(t),this.io.imageAnnoApp.scene.captureScene()}},e.prototype.transformStack=function(e){if(this.log,e){var t="transform@"+JSON.stringify(e);this.numOfCommand++,this.io.emitAction(t),this.io.imageAnnoApp.scene.captureScene()}},e.prototype.pointerOutStack=function(){this.log;var e=r.Us.PointerOut;this.io.emitAction(e)},e.prototype.getActionString=function(e,t){return""+e+ni+("string"==typeof t?t:JSON.stringify(t))},e.prototype.addBase64Stack=function(e,t){var n="addBase64"+(ni+e+ni+t);this.io.emitAction(n)},e.prototype.base64Stack=function(e,t){var n="addBase64"+(ni+e+ni+t);this.io.emitAction(n)},e.prototype.selectBase64=function(e){var t="selectBase64@"+e;this.io.emitAction(t)},e}(),ii=n(8423),si=function(){function e(e){this.io=e}return e.prototype.pushActionTyped=function(e){switch(e.type){case r.Us.Style:this.io.imageAnnoApp.geometryCommon.gcmdProcessing.updateStyleCustom(e.payload);break;case r.Us.ClusteringPoint:this.io.imageAnnoApp.apiWrapper.environment.toggleClusteringPoint(e.payload);break;case r.Us.Hover:case r.Us.Unhover:this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce()}},e.prototype.pushAction=function(e){"string"==typeof e?this.doAction(e):"object"==typeof e&&this.pushActionTyped(e)},e.prototype.doAction=function(e){var t=this,n=e.indexOf(ii._),o=n<0?[e]:[e.substring(0,n),e.substring(n+1,e.length)],i=o[1],s=this.io.imageAnnoApp.scene.geometryList,a=this.io.imageAnnoApp.scene.geometryList.length;switch(o[0]){case"style":var h=JSON.parse(o[1]);this.io.imageAnnoApp.geometryCommon.gcmdProcessing.updateStyleCustom(h);break;case r.Us.SetDrawingMode:var c=o[1];this.io.imageAnnoApp.activeCommandController.setActiveCommand(this.io.mappingCommand(c)),this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case r.Us.ActiveColorId:this.io.imageAnnoApp.activeCommandController.setActiveColor(o[1]);break;case r.Us.ToggleMapfilter:this.io.imageAnnoApp.apiWrapper.environment.toggleMapfilter(i),this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case"sliderValue":case"sizeBrush":case"setSketchColor":break;case"sizeCanvas":var p=JSON.parse(JSON.stringify(o[1]));this.io.imageAnnoApp.geometryCommon.gcmdSupporting.updateCanvasSize(p);break;case"typeBrush":break;case r.Us.ToggleQuickActions:this.io.imageAnnoApp.apiWrapper.environment.toggleActiveCommandChain(i),this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case r.Us.Undo:this.io.imageAnnoApp.geometryCommon.gcmdProcessing.undo(),this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case r.Us.Redo:this.io.imageAnnoApp.geometryCommon.gcmdProcessing.redo(),this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case r.Us.ChangeTheme:this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case r.Us.ToggleDrawingTooltips:this.io.imageAnnoApp.apiWrapper.environment.toggleDrawingTooltips(i),this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case r.Us.ToggleGrid:this.io.imageAnnoApp.apiWrapper.environment.toggleGrid(i),this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case r.Us.ToggleMeasure:this.io.imageAnnoApp.apiWrapper.environment.toggleMeasure(i),this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case r.Us.ShiftUnit:this.io.imageAnnoApp.apiWrapper.environment.shiftUnit(),this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case r.Us.DumpIconsBase64s:var l=JSON.parse(o[1]);Object.keys(l).forEach((function(e){t.io.imageAnnoApp&&t.io.imageAnnoApp.activeCommandController.base64Processing("addBase64",e,l[e])})),this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case r.Us.AddIconBase64:var d=JSON.parse(o[1]);Object.keys(d).forEach((function(e){t.io.imageAnnoApp.activeCommandController.base64Processing(o[0],e,d[e])})),this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case r.Us.SelectIconBase64:this.io.imageAnnoApp.activeCommandController.base64Processing(o[0],o[1]),this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case r.Us.InclusiveSelect:for(;a--;)if(s[a].id===i){s[a].isSelected=!0;break}this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case r.Us.InclusiveDeselect:for(;a--;)if(s[a].id===i){s[a].isSelected=!1;break}this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case r.Us.ExclusiveSelect:for(;a--;)s[a].id===i?s[a].isSelected=!0:s[a].isSelected&&(s[a].isSelected=!1);this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case r.Us.ExclusiveDeselect:for(;a--;)s[a].id!==i&&s[a].isSelected&&(s[a].isSelected=!1);this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case r.Us.Remove:this.io.imageAnnoApp.geometryCommon.gcmdProcessing.removeByIDs(o[1]),this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case r.Us.RemoveSelected:this.io.imageAnnoApp.geometryCommon.gcmdProcessing.removeAllCapturedGeoGroup(),this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case r.Us.Update:this.io.imageAnnoApp.activeCommandController.processingUpdate(JSON.parse(o[1]).id,o[1]),this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case r.Us.ReorderNumberedPoints:this.io.imageAnnoApp.geometryCommon.gcmdProcessing.reorderNumberedPoints(JSON.parse(i)),this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case r.Us.ReorderNumberedTourPoints:case r.Us.Unhighlight:case r.Us.Hover:case r.Us.Unhover:this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case r.Us.Enter:for(;a--;)s[a].id===i?(s[a].isHover=!0,s[a].isHiddenValue?(s[a].renderer.tOver=0,s[a].visibility=.2):s[a].visibility=1):s[a].isHover&&(s[a].isHover=!1,s[a].isHiddenValue?s[a].visibility=0:s[a].visibility=1);this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case r.Us.Leave:for(;a--;)s[a].isHover=!1,s[a].isHiddenValue&&(s[a].visibility=0);this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case r.Us.Show:this.io.imageAnnoApp.activeCommandController.unhide(JSON.parse(o[1])),this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case r.Us.Hide:this.io.imageAnnoApp.activeCommandController.hide(JSON.parse(o[1])),this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case r.Us.HidePopup:for(;a--;)s[a].id===i&&s[a].hidePopUpSummary();this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case r.Us.ShowPopup:for(;a--;)s[a].id===i&&s[a].showPopupSummary();this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case r.Us.Dump:this.io.imageAnnoApp.geometryCommon.gcmdSelecting.deSelectAllObjects(),this.io.imageAnnoApp.geometryCommon.gcmdProcessing.removeAllCapturedGeo();var u=new Map,y=JSON.parse(i);Object.keys(y).forEach((function(e){u.set(e,t.convertShapeToIOGeometry(y[e]))})),this.io.imageAnnoApp.activeCommandController.reUndoProcessingStorymaps(u),this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case r.Us.InitGhost:var m=[],v=JSON.parse(o[1]).POLYGON_MULTIPLE;if(v)for(var g=0;g<v.length;++g){var f=this.convertShapeToIOGeometry(v[g]);m.push(f)}this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case r.Us.EnterGhost:case r.Us.LeaveGhost:case r.Us.AddGhost:case r.Us.RemoveGhost:this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case r.Us.PolylineConstraintLength:this.io.imageAnnoApp.activeCommandController.setupPolylineConstraintLength(parseFloat(i)),this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case r.Us.PolylineConstraintLengthPercentage:this.io.imageAnnoApp.activeCommandController.setupPolylineConstraintLengthPercentage(parseFloat(i)),this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case r.Us.DisableExcept:var C=JSON.parse(o[1]);this.io.imageAnnoApp.activeCommandController.disableExcept(C),this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce();break;case r.Us.Highlight:this.io.imageAnnoApp.activeCommandController.highlight(o[1]),this.io.imageAnnoApp.geometryCommon.gcmdSupporting.renderForce()}},e.prototype.getProjectedBoundingVec=function(e){var t=Number.MAX_SAFE_INTEGER,n=Number.MAX_SAFE_INTEGER,o=Number.MIN_SAFE_INTEGER,i=Number.MIN_SAFE_INTEGER;return Object.keys(e).forEach((function(s){for(var r=0;r<e[s];++r)t>e[s][r].proX&&(t=e[s][r].proX),n>e[s][r].proY&&(n=e[s][r].proY),o<e[s][r].proX&&(o=e[s][r].proX),i<e[s][r].proY&&(i=e[s][r].proY)})),[t,n,o,i]},e.prototype.convertShapeToIOGeometry=function(e){var t=this.io.mappingCommand(e.type),n=new p(e.id,r.zq[t],!1,!1,e.isHidden);return n.pushNode(e.nodes.map((function(e){return(0,r.Qi)(e.sx,e.sy,e.long,e.lat,e.ele,e.proX,e.proY,e.proZ)}))),void 0!==e.data&&(n.data=e.data),void 0!==e.styles&&(n.styles=e.styles),n},e}(),ri=function(){function e(e){this.imageAnnoApp=e,this.stateProcessingAnnotation=new si(this),this.eventListenerAnnotation=new oi(this)}return e.prototype.mappingCommand=function(e){return e===r.uA.SMARTDRAWING?e=r.uA.SMARTDRAWING_DEEPLEARNING:e===r.uA.POLYGON?e=r.uA.POLYGON_GRAPH:e===r.uA.POLYGON_GRAPH?e=r.uA.POLYGON:e===r.uA.FREEHAND_POLYGON&&(e=r.uA.FREEHAND_POLYGON_GRAPH),e},e.prototype.emitAction=function(e){this.imageAnnoApp.implementations.app.INSPECTION&&(e.split("@")[0],e.split("@")[0],e.split("@")[0]),this.imageAnnoApp.implementations.app.model.ioWrapper.emitAction.emitAction(e)},e}(),ai=function(){function e(e){this.host=e}return e.prototype.renderPost=function(e){if(!this.host.scene.capture||!this.host.scene.capture.isGhost){if(this.host.stopRender)return this.host.tInit=0,this.host.tLeave=0,this.host.t=0,void(this.host.isActive=!1);if(this.host.v.x=.5*e.canvas.width,this.host.smartEvasion?this.host.scene.annotationInstance.activeCommandController.m.y<.5*e.canvas.height?this.host.v.y=e.canvas.height-50:this.host.v.y=50:this.host.v.y=e.canvas.height-50,e.lineWidth=2,e.fillStyle="rgba(0,0,0,0.5)",e.strokeStyle=r.$C.White,0<this.host.tInit&&this.host.tInit<1){var t=this.host.scene.annotationInstance.renderer.numericalMotion.easeOutElastic2(this.host.t);if(0<this.host.t){e.beginPath(),e.arc(this.host.v.x,this.host.v.y,t*this.host.radius,0,12.56636),e.closePath(),e.fill(),e.stroke();var n=t*this.host.sizeTrash;e.drawImage(this.host.imgTrash,this.host.v.x-.5*n,this.host.v.y-.5*n,n,n),this.host.isShow=!0}else this.host.isShow=!1;this.host.t+=.005}else if(0<this.host.tLeave&&this.host.tLeave<1){t=this.host.scene.annotationInstance.renderer.numericalMotion.easeInElastic(this.host.tLeave);var o=this.host.radius-t*this.host.radius;0<o&&(this.host.isShow&&(e.beginPath(),e.arc(this.host.v.x,this.host.v.y,o,0,12.56636),e.closePath(),e.fill(),e.stroke(),n=this.host.sizeTrash-t*this.host.sizeTrash,e.drawImage(this.host.imgTrash,this.host.v.x-.5*n,this.host.v.y-.5*n,n,n),this.host.t=-.2,t<.5&&this.host.removeGeo()),.2<this.host.tLeave&&(this.host.isShow=!1,this.host.exceptionByLeaderline=!1))}}},e}(),hi=function(){function e(e){this.host=e}return e.prototype.updateTime=function(){if(this.host.scene.annotationInstance.activeCommandController.acProperties.isDragging){if(void 0===this.host.scene.Capture)this.host.tInit=-1.01;else{if(this.host.scene.Capture.type===r.zq.APOINT||this.host.scene.Capture.type===r.zq.AMIDPOINT||this.host.scene.Capture.type===r.zq.ANODE)return void(this.host.isActive=!1);if(this.host.scene.Capture.type===r.zq.POLYGON_GRAPH&&this.host.scene.Capture.isSelectedNode)return void(this.host.isActive=!1);this.host.isActive=!0,this.host.tInit=.01}this.host.exceptionByLeaderline?this.host.tLeave+=.0025:this.host.tLeave=0}else this.host.stopRender?this.host.tInit+=.015:this.host.tInit=1.1;this.host.scene.Capture&&this.host.scene.annotationInstance.activeCommandController.acProperties.isUp&&(this.host.tLeave+=.0025)},e}(),ci=function(){function e(e){this.isActive=!1,this.radius=24,this.t=0,this.tInit=0,this.tLeave=0,this.needRender=!1,this.hasCapture=!1,this.isUp=!1,this.isShow=!1,this.hover=!1,this.hoverPre=!1,this.distanceForDetection=120,this.sizeTrash=24,this.stopRender=!1,this.exceptionByLeaderline=!1,this.offX=-1,this.smartEvasion=!0,this.removeForce=!0,this.scene=e,this.removeForce=!0,this.renderer=new ai(this),this.timer=new hi(this),this.v=new r.h9(0,0),this.imgTrash=new Image,this.imgTrash.src=this.scene.annotationInstance.implementations.app.CONFIG.config.BASE_URL+"/static/storymaps-xgraphics/images/theme-assets/common/trash-24.svg"}return e.prototype.updateTime=function(){this.timer.updateTime()},e.prototype.render=function(e){this.updateTime(),this.isInside(),this.isActive&&this.renderer.renderPost(e)},e.prototype.isInside=function(){this.isActive&&((0,r.CV)([this.v.x,this.v.y,this.v.z],[this.scene.annotationInstance.activeCommandController.m.x,this.scene.annotationInstance.activeCommandController.m.y,0])<this.distanceForDetection?(this.radius=48,this.sizeTrash=48,this.hover=!0,this.hoverPre!==this.hover&&(this.hoverPre=this.hover,this.t=.3)):(this.radius=24,this.sizeTrash=24,this.hover=!1,this.hoverPre!==this.hover&&(this.hoverPre=this.hover,this.t=0)))},e.prototype.removeSelectedShapesByBlackhole=function(e){if(!this.scene.capture||!this.scene.capture.isGhost){for(var t=this.scene.annotationInstance.scene.geometryList.length,n=[];t--;){var o=this.scene.annotationInstance.scene.geometryList[t];if(o.isSelected||o.isHoverValue||o.isCapturedValue){if(o.isUnderConstruction)continue;if(o.type===r.zq.TEXT_LEADERLINE){var i=o;if(i.leaderline)if((0,r.Sp)(i.leaderline.v2,this.v)<42){i.removeLeaderline();for(var s=[],a=0;a<e.length;++a)e[a].id!==i.id&&s.push(e[a]);e=s}else n.push(o);else n.push(o)}else n.push(o)}}for(var h=0;h<n.length;++h)n[h].remove(!1);e.length>0&&this.scene.annotationInstance.io.eventListenerAnnotation.removeGeometryStack(e)}},e.prototype.removeGeo=function(){if((!this.scene.capture||!this.scene.capture.isGhost)&&this.hover&&this.scene.Capture&&this.scene.annotationInstance.activeCommandController.acProperties.isUp){if(this.scene.Capture.type===r.zq.TEXT_LEADERLINE){var e=this.scene.Capture;if(e.leaderline&&e.leaderline.isMouseInside(this.scene.annotationInstance.activeCommandController.m.x,this.scene.annotationInstance.activeCommandController.m.y))return(0,r.Sp)(this.v,e.leaderline.v2)<42&&e.removeLeaderline(),this.scene.Capture=void 0,this.tInit=-1.01,this.tLeave=.01,this.scene.annotationInstance.activeCommandController.acProperties.isDragging=!0,void(this.exceptionByLeaderline=!0);this.removeForce&&(this.scene.Capture=void 0,this.stopRender=!0)}else this.removeForce&&(this.scene.Capture=void 0,this.stopRender=!0);var t=this.scene.geometryList.length;if(0!==t)for(;t--;)this.scene.geometryList[t]&&!0===this.scene.geometryList[t].isSelected&&this.removeForce&&(this.scene.Capture=void 0,this.stopRender=!0)}},e}(),pi=function(){function e(e){this.isHover=!1,this.vecGhostSnapping=void 0,this.objectSnapping=e,this.t=0,this.tOver=0,this.tOverPopupSummary=0,this.tDown1=0,this.tDown2=0,this.tUp=0}return e.prototype.updateGhostSnappingVec=function(e){this.vecGhostSnapping=e||void 0},e.prototype.render=function(e){if(this.vecGhostSnapping){var t=this.objectSnapping.renderer.imageAnnoApp.scene.paramsEditing.croppingMaskParams.x,n=this.objectSnapping.renderer.imageAnnoApp.scene.paramsEditing.croppingMaskParams.y;this.tOver+=.015,this.objectSnapping.renderer.draw.shape.snapping.circleBG(e,this.vecGhostSnapping.x-t,this.vecGhostSnapping.y-n,this.objectSnapping.toleranceSnapping,this.objectSnapping.renderer.numericalMotion.easeOutElastic2(this.tOver)),this.renderGhostGeo(e,t,n)}else this.tOver=0},e.prototype.renderGhostGeo=function(e,t,n){if(this.objectSnapping.renderer.imageAnnoApp.scene.capture&&this.vecGhostSnapping){if(this.objectSnapping.renderer.imageAnnoApp.scene.capture.type===r.zq.POINT_REGULAR)return;if(this.objectSnapping.renderer.imageAnnoApp.scene.capture.type===r.zq.POINT_NUMBERED)return;if(this.objectSnapping.renderer.imageAnnoApp.scene.capture.type===r.zq.ANODE||this.objectSnapping.renderer.imageAnnoApp.scene.capture.type===r.zq.AMIDPOINT){var o=this.objectSnapping.renderer.imageAnnoApp.scene.capture;if(o.aEdges[0]&&o.aEdges[0].pGraph.type===r.zq.POLYLINE_BENDING){var i=o.aEdges[0].pGraph,s=this.getVecFromAPolylineGraph(i);return void this.objectSnapping.renderer.draw.shape.line.polylineByVecGhost(e,i.styleComponent.renderStyle,s,[t,n],!1,!1,.5)}if(o.edges[0]&&o.edges[0].type===r.zq.ARROW_DOUBLE||o.edges[0].type===r.zq.ARROW_SINGLE){i=o.edges[0],s=this.getVecFromArrow(i);var a=this.computeVertex(s,[t,n]),h=this.computeWeight(i.getVecs(),.5),c=this.computeControlPoint(a,h);return void this.drawSpline(e,i.getVecs(),a,c,i)}}else{if(this.objectSnapping.renderer.imageAnnoApp.scene.capture.type===r.zq.POLYGON_GRAPH)return i=this.objectSnapping.renderer.imageAnnoApp.scene.capture,s=this.getVecFromAPolygonGraph(i,[t,n]),void this.objectSnapping.renderer.draw.shape.area.polygonByVecGhost(e,i.styleComponent.renderStyle,s,!1,!1,.1);if(this.objectSnapping.renderer.imageAnnoApp.scene.capture.type===r.zq.TEXT_LEADERLINE){if((i=this.objectSnapping.renderer.imageAnnoApp.scene.capture).leaderline&&i.IsSelectedReaderline){var p=new r.h9(i.leaderline.v1Render.x,this.vecGhostSnapping.y),l=this.vecGhostSnapping;this.objectSnapping.renderer.draw.shape.text.renderLeaderLine(e,i.styleComponent,i.vecOffset,p,l,i.renderer.t,i.leaderline.isUpperDia,i.leaderline.isHover,i.isSelectedValue)}return}}}},e.prototype.getVecFromAPolylineGraph=function(e){var t=e.getVecs(),n=[];if(this.vecGhostSnapping)for(var o=0;o<t.length;++o)(0,r.Sp)(t[o],this.vecGhostSnapping)<this.objectSnapping.toleranceSnapping?n.push(this.vecGhostSnapping):n.push(t[o]);return n},e.prototype.getVecFromAPolygonGraph=function(e,t){var n=e.getVecs(),o=[];if(this.vecGhostSnapping)for(var i=0;i<n.length;++i)(0,r.Sp)(n[i],this.vecGhostSnapping)<this.objectSnapping.toleranceSnapping?o.push(new r.h9(this.vecGhostSnapping.x-t[0],this.vecGhostSnapping.y-t[1],0)):o.push(new r.h9(n[i].x-t[0],n[i].y-t[1],0));return o},e.prototype.getVecFromArrow=function(e){var t=e.getVecs(),n=[];if(this.vecGhostSnapping)for(var o=0;o<t.length;++o)(0,r.Sp)(t[o],this.vecGhostSnapping)<this.objectSnapping.toleranceSnapping?n.push(this.vecGhostSnapping):n.push(t[o]);return n},e.prototype.computeVertex=function(e,t){for(var n=[],o=0,i=e;o<i.length;o++){var s=i[o];n.push(s.x-t[0],s.y-t[1])}return n},e.prototype.computeWeight=function(e,t){void 0===t&&(t=1);for(var n=[],o=0;o<e.length;++o)n.push(t);return n},e.prototype.computeControlPoint=function(e,t){for(var n=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var o=Array(e),i=0;for(t=0;t<n;t++)for(var s=arguments[t],r=0,a=s.length;r<a;r++,i++)o[i]=s[r];return o}(e),o=[],i=0;i<n.length-4;i+=2)o=o.concat(ct.getControlPoints(n[i],n[i+1],n[i+2],n[i+3],n[i+4],n[i+5],t[i]));return o},e.prototype.drawSpline=function(e,t,n,o,i){var s=n,a=o,h=s.length,c=t,p=this.objectSnapping.renderer.draw.shape.curve;p.curveQuadraticArrow(e,i.styleComponent.renderStyle,s[0],s[1],a[0],a[1],s[2],s[3],!0,c,!1,.5,this.objectSnapping.renderer.numericalMotion.easeOutElastic2(this.tOver),!1,i.styleComponent.state.themeColorId,!1),p.curveQuadraticArrow(e,i.styleComponent.renderStyle,s[h-2],s[h-1],a[2*h-10],a[2*h-9],s[h-4],s[h-3],!0,c,!1,.5,this.objectSnapping.renderer.numericalMotion.easeOutElastic2(this.tOver),!1,i.styleComponent.state.themeColorId,!1),p.cArrowByTranslation(e,i.styleComponent.renderStyle,new r.h9(s[4],s[5]),new r.h9(a[2],a[3]),s[4],s[5],i.arrowScale,i.scaleForRender,i.isHoverValue,i.isGrayColor,i.visibilityValue,1,i.isSelectedValue,i.styleComponent.state.themeColorId),i.type===r.zq.ARROW_DOUBLE&&p.cArrowByTranslation(e,i.styleComponent.renderStyle,new r.h9(s[0],s[1]),new r.h9(a[0],a[1]),s[0],s[1],i.arrowScale,i.scaleForRender,!1,i.isGrayColor,i.visibilityValue,1,i.isSelectedValue,i.styleComponent.state.themeColorId)},e.prototype.checkMidPtPolylineBending=function(){if(this.objectSnapping.renderer.imageAnnoApp.scene.capture&&this.objectSnapping.renderer.imageAnnoApp.scene.capture.type===r.zq.ANODE){var e=this.objectSnapping.renderer.imageAnnoApp.scene.capture;e.aEdges[0]&&e.aEdges[0].pGraph.updateMidVec()}},e.prototype.checkLeaderlineOffset=function(){if(this.objectSnapping.renderer.imageAnnoApp.scene.capture&&this.objectSnapping.renderer.imageAnnoApp.scene.capture.type===r.zq.TEXT_LEADERLINE){var e=this.objectSnapping.renderer.imageAnnoApp.scene.capture;if(e&&e.leaderline&&this.objectSnapping.aGhostSnapping.vecGhostSnapping){var t=e.leaderline.v2.x-this.objectSnapping.aGhostSnapping.vecGhostSnapping.x,n=e.leaderline.v2.y-this.objectSnapping.aGhostSnapping.vecGhostSnapping.y;e.widthOffset+=t,e.heightOffset+=n}}},e}(),li=function(){function e(e){this.objectSnapping=e}return e.prototype.updateGhostSnappingVec=function(e){this.objectSnapping.aGhostSnapping.updateGhostSnappingVec(e)},e.prototype.isSnappingToCircle=function(e){if(!this.objectSnapping.renderer.imageAnnoApp.scene.capture)return!1;if(this.objectSnapping.renderer.imageAnnoApp.scene.capture.textLeaderline)return!1;for(var t=0;t<this.objectSnapping.renderer.imageAnnoApp.scene.listACircleWrapperr.length;++t){var n=this.objectSnapping.renderer.imageAnnoApp.scene.listACircleWrapperr[t].isMouseInsideSnapFrom(e);if(n&&n!==e)return this.updateGhostSnappingVec(n),!0}return!1},e.prototype.isSnappingToRectangle=function(e){if(!this.objectSnapping.renderer.imageAnnoApp.scene.capture)return!1;if(this.objectSnapping.renderer.imageAnnoApp.scene.capture.textLeaderline)return!1;for(var t=0;t<this.objectSnapping.renderer.imageAnnoApp.scene.listARectangleWrapper.length;++t){var n=this.objectSnapping.renderer.imageAnnoApp.scene.listARectangleWrapper[t].isMouseInsideSnapFrom(e);if(n&&n!==e)return this.updateGhostSnappingVec(n),!0}return!1},e.prototype.donotSnapForCircle=function(e){return!!this.objectSnapping.renderer.imageAnnoApp.scene.capture&&this.objectSnapping.renderer.imageAnnoApp.scene.capture.type===r.zq.CIRCLE},e.prototype.donotSnapForCircleRect=function(e){return this.objectSnapping.renderer.imageAnnoApp.scene.listBasePoint[e].type===r.zq.ANODE_CIRCLE||this.objectSnapping.renderer.imageAnnoApp.scene.listBasePoint[e].type===r.zq.ANODE_RECT},e.prototype.isSnappingItself=function(e){var t=this.objectSnapping.renderer.imageAnnoApp.scene.capture,n=this.objectSnapping.renderer.imageAnnoApp.scene.listBasePoint[e];return!!(t&&n&&!(t.type!==r.zq.ANODE&&t.type!==r.zq.AMIDPOINT||n.type!==r.zq.ANODE&&n.type!==r.zq.AMIDPOINT)&&t.edges.length>0&&n.edges.length>0&&t.edges[0]===n.edges[0])},e.prototype.isAllowSnappingPointToPoint=function(e){var t=this.objectSnapping.renderer.imageAnnoApp.scene.capture;return!t||t.type!==r.zq.POINT_NUMBERED&&t.type!==r.zq.POINT_REGULAR||!this.objectSnapping.renderer.imageAnnoApp.scene.listBasePoint[e]||this.objectSnapping.renderer.imageAnnoApp.scene.listBasePoint[e]===t||this.objectSnapping.renderer.imageAnnoApp.scene.listBasePoint[e].type!==r.zq.POINT_NUMBERED&&this.objectSnapping.renderer.imageAnnoApp.scene.listBasePoint[e].type!==r.zq.POINT_REGULAR},e.prototype.isAllowSnappingNodeToNodeInSameShape=function(e){if(this.objectSnapping.renderer.imageAnnoApp.scene.capture&&(this.objectSnapping.renderer.imageAnnoApp.scene.capture.type===r.zq.ANODE||this.objectSnapping.renderer.imageAnnoApp.scene.capture.type===r.zq.AMIDPOINT)){var t=this.objectSnapping.renderer.imageAnnoApp.scene.capture;if(t.edges[0]){for(var n=t.edges[0].getVecs(),o=0;o<n.length;++o)if(this.objectSnapping.renderer.imageAnnoApp.scene.listBasePoint[e]&&this.objectSnapping.renderer.imageAnnoApp.scene.listBasePoint[e].vec===n[o])return!1}else if(t.aEdges[0])for(n=t.aEdges[0].pGraph.getVecs(),o=0;o<n.length;++o)if(this.objectSnapping.renderer.imageAnnoApp.scene.listBasePoint[e]&&this.objectSnapping.renderer.imageAnnoApp.scene.listBasePoint[e].vec===n[o])return!1}return!0},e.prototype.isAllowMidNodePolylineBending=function(e){if(this.objectSnapping.renderer.imageAnnoApp.scene.listBasePoint[e].type===r.zq.AMIDPOINT){var t=this.objectSnapping.renderer.imageAnnoApp.scene.listBasePoint[e];if(t.aEdges[0]&&t.aEdges[0].pGraph.type===r.zq.POLYLINE_BENDING)return!0}return!1},e}(),di=function(){function e(e){this.toleranceSnapping=19,this.frameValue=0,this.renderer=e,this.snappingProcessor=new li(this),this.aGhostSnapping=new pi(this)}return e.prototype.updateGhostSnappingVec=function(e){this.aGhostSnapping.updateGhostSnappingVec(e)},e.prototype.render=function(e){this.aGhostSnapping.render(e)},e.prototype.autoSnappingTracker=function(e,t){return!(this.renderer.imageAnnoApp.interactionMode!==r.An.Drawing||!e||!this.renderer.imageAnnoApp.activeCommandController.acProperties.isActivateSnapping||((this.frameValue++%10==0||t)&&this.updateSnapping(e,t),1))},e.prototype.updateSnapping=function(e,t){var n=this.renderer.imageAnnoApp.scene.capture;if(n&&(n.type===r.zq.ANODE_RECT||n.type===r.zq.ANODE_CIRCLE))return!1;if(n&&(n.type===r.zq.ARROW_SINGLE||n.type===r.zq.ARROW_DOUBLE))return!1;if(n&&n.type===r.zq.TEXT_LEADERLINE){if(!(g=n).IsSelectedReaderline)return!1;if(void 0===g.leaderline)return!1}if(this.renderer.imageAnnoApp.scene.capture&&this.renderer.imageAnnoApp.scene.capture.type===r.zq.POLYGON_GRAPH){var o=this.renderer.imageAnnoApp.scene.capture.getVecForSnapping();o&&(e=o)}for(var i=this.toleranceSnapping,s=-1,a=this.renderer.imageAnnoApp.scene.listBasePoint.length;a--;){var h=this.renderer.imageAnnoApp.scene.listBasePoint[a];if(h.vec.x&&n!==h){if(h.isCollapse)continue;if(this.snappingProcessor.isAllowMidNodePolylineBending(a))continue;var c=(0,r.Sp)(h.vec,e);c<i&&(i=c,s=a)}}if(this.snappingProcessor.donotSnapForCircle(s))return!1;if(-1===s)if(t){for(var p=!1,l=0;l<this.renderer.imageAnnoApp.scene.listAPolygonGraphWrapper.length;++l){if((y=this.renderer.imageAnnoApp.scene.listAPolygonGraphWrapper[l])!==n&&(m=y.findClosestVec(e))&&(0,r.Sp)(m,e)<this.toleranceSnapping){e.x=m.x,e.y=m.y,p=!0,y.updatePostTransformation();var d=n;d&&d.aEdges&&d.aEdges[0]&&d.aEdges[0].pGraph.updatePostTransformation()}y.graphCore.selVec=void 0,y.graphCore.selectedVec=void 0,y.graphCore.selVecForTextLeaderline=void 0,y.graphCore.selMidVec=void 0}if(p)return!0}else for(var u=0;u<this.renderer.imageAnnoApp.scene.listAPolygonGraphWrapper.length;++u){var y,m;if((y=this.renderer.imageAnnoApp.scene.listAPolygonGraphWrapper[u])!==n&&(m=y.findClosestVec(e))&&(0,r.Sp)(m,e)<this.toleranceSnapping){var v=new r.h9(m.x,m.y);return this.updateGhostSnappingVec(v),!0}this.updateGhostSnappingVec(void 0)}if(this.snappingProcessor.isSnappingItself(s))return!1;if(!this.snappingProcessor.isAllowSnappingPointToPoint(s))return!1;if(!this.snappingProcessor.isAllowSnappingNodeToNodeInSameShape(s))return!1;if(this.snappingProcessor.isSnappingToRectangle(e))return t&&(this.aGhostSnapping.checkLeaderlineOffset(),this.aGhostSnapping.vecGhostSnapping&&(e.x=this.aGhostSnapping.vecGhostSnapping.x,e.y=this.aGhostSnapping.vecGhostSnapping.y,this.aGhostSnapping.checkMidPtPolylineBending())),!0;if(this.snappingProcessor.isSnappingToCircle(e))return t&&(this.aGhostSnapping.checkLeaderlineOffset(),this.aGhostSnapping.vecGhostSnapping&&(e.x=this.aGhostSnapping.vecGhostSnapping.x,e.y=this.aGhostSnapping.vecGhostSnapping.y,this.aGhostSnapping.checkMidPtPolylineBending())),!0;if(i<this.toleranceSnapping&&this.renderer.imageAnnoApp.scene.listBasePoint[s].vec.x){if(this.snappingProcessor.donotSnapForCircleRect(s))return!1;if(t){var g,f=this.renderer.imageAnnoApp.scene.listBasePoint[s].vec.x-e.x,C=this.renderer.imageAnnoApp.scene.listBasePoint[s].vec.y-e.y;n&&n.type===r.zq.TEXT_LEADERLINE&&((g=n).widthOffset-=f,g.heightOffset-=C),e.x=this.renderer.imageAnnoApp.scene.listBasePoint[s].vec.x,e.y=this.renderer.imageAnnoApp.scene.listBasePoint[s].vec.y,this.aGhostSnapping.checkMidPtPolylineBending()}else{var S=this.renderer.imageAnnoApp.scene.listBasePoint[s].vec.x,A=this.renderer.imageAnnoApp.scene.listBasePoint[s].vec.y;v=new r.h9(S,A),this.updateGhostSnappingVec(v)}}else this.updateGhostSnappingVec(void 0);return!1},e}(),ui=function(){function e(e){this.optimizer=e}return e.prototype.update=function(){},e}(),yi=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),mi=function(e){function t(t){var n=e.call(this,t)||this;return n.needUpdateComputeCollision=!1,n.needOptimization=!1,n.isDoneOptimization=!0,n.renderer=t.optimizer.renderer,n}return yi(t,e),t.prototype.update=function(){(this.renderer.imageAnnoApp.activeCommandController.acProperties.isZooming||this.needUpdateComputeCollision)&&(this.collisionDetectionCompute(),this.needUpdateComputeCollision=!1),!this.needOptimization&&this.isDoneOptimization||this.updatePos()},t.prototype.updatePos=function(){for(var e=0;e<this.renderer.imageAnnoApp.scene.listATextleaderlineWrapper.length;++e)this.renderer.imageAnnoApp.scene.listATextleaderlineWrapper[e].collision.update()},t.prototype.collisionDetectionCompute=function(){for(var e=0;e<this.renderer.imageAnnoApp.scene.listATextleaderlineWrapper.length;++e)this.renderer.imageAnnoApp.scene.listATextleaderlineWrapper[e].collision.neighborShapes=[];this.renderer.imageAnnoApp.activeCommandController.acProperties.needHideTextLeaderLine&&this.collisionDetection(this.renderer.imageAnnoApp.scene.listATextleaderlineWrapper)},t.prototype.reposition=function(){this.renderer.imageAnnoApp.activeCommandController.acProperties.needrePositionTextLeaderLine},t.prototype.collisionDetection=function(e){if(!e[0]||e[0].scene.annotationInstance.activeCommandController.acProperties.needCollisionDetection){for(var t=!0,n=0;n<e.length-1;++n)for(var o=[e[n].collision.minVec,e[n].collision.maxVec],i=n+1;i<e.length;++i){var s=[e[i].collision.minVec,e[i].collision.maxVec];(0,r.Y4)(o,s)&&(e[n].collision.neighborShapes.push(e[i]),e[i].collision.neighborShapes.push(e[n]),this.needOptimization=!0,t=!1)}this.isDoneOptimization=t,t&&(this.needOptimization=!1)}},t}(ui),vi=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),gi=function(e){function t(t){return e.call(this,t)||this}return vi(t,e),t.prototype.update=function(){this.optimizerTextleaderlineByCollision()},t.prototype.optimizerTextleaderlineByCollision=function(){for(var e=0;e<this.optimizer.optimizer.renderer.imageAnnoApp.scene.listATextleaderlineWrapper.length;++e)(n=this.optimizer.optimizer.renderer.imageAnnoApp.scene.listATextleaderlineWrapper[e]).collision.isCollided=!1,n.collision.numOrder=-1,n.isCollapse=!1;var t=0;for(e=0;e<this.optimizer.optimizer.renderer.imageAnnoApp.scene.listATextleaderlineWrapper.length;++e)for(var n=this.optimizer.optimizer.renderer.imageAnnoApp.scene.listATextleaderlineWrapper[e],o=0;o<this.optimizer.optimizer.renderer.imageAnnoApp.scene.listATextleaderlineWrapper.length;++o){var i=this.optimizer.optimizer.renderer.imageAnnoApp.scene.listATextleaderlineWrapper[o];i!==n&&(0,r.Y4)([n.collision.minVec,n.collision.maxVec],[i.collision.minVec,i.collision.maxVec])&&(n.collision.isCollided=!0,n.collision.numOrder=t++,n.isCollapse=!0)}},t.prototype.optimizerTextleaderlineByCollisionCostBased=function(){for(var e=0;e<this.optimizer.optimizer.renderer.imageAnnoApp.scene.listATextleaderlineWrapper.length;++e)(n=this.optimizer.optimizer.renderer.imageAnnoApp.scene.listATextleaderlineWrapper[e]).collision.isCollided=!1,n.collision.numOrder=-1,n.isCollapse=!1;var t=0;for(e=0;e<this.optimizer.optimizer.renderer.imageAnnoApp.scene.listATextleaderlineWrapper.length;++e){var n;if(!(n=this.optimizer.optimizer.renderer.imageAnnoApp.scene.listATextleaderlineWrapper[e]).isCapturedValue)for(var o=0;o<this.optimizer.optimizer.renderer.imageAnnoApp.scene.listATextleaderlineWrapper.length;++o){var i=this.optimizer.optimizer.renderer.imageAnnoApp.scene.listATextleaderlineWrapper[o];if(i!==n&&(0,r.Y4)([n.collision.minVec,n.collision.maxVec],[i.collision.minVec,i.collision.maxVec])){n.collision.isCollided=!0,n.collision.numOrder=t++,n.isCollapse=!0;break}}}},t}(ui),fi=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Ci=function(e){function t(t){return e.call(this,t)||this}return fi(t,e),t.prototype.update=function(){this.optimizerTextleaderlineByNone()},t.prototype.optimizerTextleaderlineByNone=function(){for(var e=0;e<this.optimizer.optimizer.renderer.imageAnnoApp.scene.listATextleaderlineWrapper.length;++e){var t=this.optimizer.optimizer.renderer.imageAnnoApp.scene.listATextleaderlineWrapper[e];t.isRenderCollapse=!1,t.txtDiv.divText&&t.txtDiv.divText.hidden&&(t.txtDiv.divText.hidden=!1)}},t}(ui),Si=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Ai=function(e){function t(t){return e.call(this,t)||this}return Si(t,e),t.prototype.update=function(){this.optimizerTextleaderlineByZoom()},t.prototype.optimizerTextleaderlineByZoom=function(){},t}(ui),Pi=function(){function e(e,t){this.optimizer=e,this.type=t}return Object.defineProperty(e.prototype,"type",{get:function(){return this._type},set:function(e){switch(this._type=e,this.optimizer.renderer.imageAnnoApp.implementations.app.PRODUCTION,e){case r.Nv.Zoom:return void(this.activeOptimizer=new Ai(this));case r.Nv.Collision:return void(this.activeOptimizer=new gi(this));case r.Nv.Agent:return void(this.activeOptimizer=new mi(this));default:return void(this.activeOptimizer=new Ci(this))}},enumerable:!1,configurable:!0}),e.prototype.update=function(){this.activeOptimizer.update()},e}(),wi=function(){function e(e){this.optimizer=e}return e.prototype.mouseClick=function(e,t){return!1},e.prototype.mouseMove=function(e,t){},e.prototype.update=function(){},e.prototype.render=function(e){},e}(),xi=function(){function e(e){this.listRPoint=[],this.listNPoint=[],this.optimizer=e}return e.prototype.update=function(){this.updatePoints(),this.listNPoint=this.buildConnectivity(this.listNPoint),this.listRPoint=this.buildConnectivity(this.listRPoint),this.initGeometry();var e=this.buildGraph(this.listNPoint),t=this.buildGraph(this.listRPoint);if(e&&t){this.addClusterByGeometries(e,r.zq.POINT_NUMBERED),this.addClusterByGeometries(t,r.zq.POINT_REGULAR),this.postUpdateCollisionBasedonGraph();var n=this.needDecompose();n.length>0&&(this.splitClusters(n),this.postMergeCluster())}},e.prototype.initGeometry=function(){this.optimizer.renderer.initGeometry()},e.prototype.addClusterByGeometries=function(e,t){this.optimizer.renderer.addClusterByGeometries(e,t)},e.prototype.updatePoints=function(){this.listNPoint=[],this.listRPoint=[];for(var e=0;e<this.optimizer.optimizer.optimizer.renderer.imageAnnoApp.scene.listNPoint.length;++e)!this.optimizer.optimizer.optimizer.renderer.imageAnnoApp.scene.listNPoint[e].isHidden&&this.optimizer.optimizer.optimizer.renderer.imageAnnoApp.scene.listNPoint[e].isRenderable&&((t=this.optimizer.optimizer.optimizer.renderer.imageAnnoApp.scene.listNPoint[e]).collision.reset(),this.listNPoint.push(t));for(e=0;e<this.optimizer.optimizer.optimizer.renderer.imageAnnoApp.scene.listRPoint.length;++e){var t;!this.optimizer.optimizer.optimizer.renderer.imageAnnoApp.scene.listRPoint[e].isHidden&&this.optimizer.optimizer.optimizer.renderer.imageAnnoApp.scene.listRPoint[e].isRenderable&&((t=this.optimizer.optimizer.optimizer.renderer.imageAnnoApp.scene.listRPoint[e]).collision.reset(),this.listRPoint.push(t))}},e.prototype.buildConnectivity=function(e){for(var t=0;t<e.length;++t)for(var n=e[t],o=t+1;o<e.length;++o){var i=e[o];!i.isCollapse&&i!==n&&(0,r.Y4)([n.collision.minVec,n.collision.maxVec],[i.collision.minVec,i.collision.maxVec])&&(n.collision.isCollided=!0,n.isCollapse=!0,n.numVisit=0,n.collision.neighborShapes.push(i),i.collision.isCollided=!0,i.isCollapse=!0,i.numVisit=0,i.collision.neighborShapes.push(n))}return e},e.prototype.buildGraph=function(e){for(var t=[],n=0;n<e.length;++n){var o=[],i=[e[n]];i[0].collision.isVisited=!0,o.push(i[0]);for(var s=0,r=void 0;void 0!==(r=i.shift());){for(var a=0;a<r.collision.neighborShapes.length;++a)r.collision.neighborShapes[a].collision.isVisited||(r.collision.neighborShapes[a].collision.isVisited=!0,i.push(r.collision.neighborShapes[a]),o.push(r.collision.neighborShapes[a]));if(s++>1e3)return}o.length>1&&t.push(o)}return t},e.prototype.postUpdateCollisionBasedonGraph=function(){for(var e=0;e<this.optimizer.renderer.clustersNPoint.length;++e)this.updateByQueue(this.optimizer.renderer.clustersNPoint[e],this.listNPoint);for(e=0;e<this.optimizer.renderer.clustersRPoint.length;++e)this.updateByQueue(this.optimizer.renderer.clustersRPoint[e],this.listNPoint)},e.prototype.updateByQueue=function(e,t){for(var n=0,o=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var o=Array(e),i=0;for(t=0;t<n;t++)for(var s=arguments[t],r=0,a=s.length;r<a;r++,i++)o[i]=s[r];return o}(t);o.length;){var i=o.shift();if(i){if(i.numVisit>100){i.numVisit=0;break}if(0===o.length&&t.length<n++)break;i.collision.isCollided||((0,r.Y4)([i.collision.minVec,i.collision.maxVec],[e.minVec,e.maxVec])?(i.collision.isCollided=!0,i.isCollapse=!0,i.numVisit=0,e.addPost(i)):(i.numVisit++,o.push(i)))}}},e.prototype.needDecompose=function(){for(var e=[],t=0;t<this.optimizer.renderer.clustersNPoint.length;++t)this.optimizer.renderer.clustersNPoint[t].needDecompose()&&e.push(this.optimizer.renderer.clustersNPoint[t]);for(t=0;t<this.optimizer.renderer.clustersRPoint.length;++t)this.optimizer.renderer.clustersRPoint[t].needDecompose()&&e.push(this.optimizer.renderer.clustersRPoint[t]);return e},e.prototype.splitClusters=function(e){for(var t=0;t<e.length;++t)e[t].split()},e.prototype.postMergeCluster=function(){this.postMergeClusterCompute(this.optimizer.renderer.clustersNPoint),this.postMergeClusterCompute(this.optimizer.renderer.clustersRPoint)},e.prototype.postMergeClusterCompute=function(e){for(var t=0;t<e.length-1;++t)for(var n=e[t],o=t+1;o<e.length;++o){var i=e[o];i.isVisited||(0,r.Sp)(n.vec,i.vec)<n.r1+20&&(i.isVisited=!0,n.merge(i))}},e}(),Ii=function(){function e(e){this.m=new r.h9(0,0),this.optimizer=e}return e.prototype.mouseClick=function(e,t){this.m.x=e,this.m.y=t;for(var n=0;n<this.optimizer.renderer.clustersNPoint.length;++n)if(this.optimizer.renderer.clustersNPoint[n].isInside(this.m))return!0;for(n=0;n<this.optimizer.renderer.clustersRPoint.length;++n)if(this.optimizer.renderer.clustersRPoint[n].isInside(this.m))return!0;return!1},e.prototype.mouseMove=function(e,t){this.m.x=e,this.m.y=t;for(var n=0;n<this.optimizer.renderer.clustersNPoint.length;++n)this.optimizer.renderer.clustersNPoint[n].isInside(this.m);for(n=0;n<this.optimizer.renderer.clustersRPoint.length;++n)this.optimizer.renderer.clustersRPoint[n].isInside(this.m)},e}(),bi=function(){function e(e,t,n){this.r0=16,this.r1=24,this.isHover=!1,this.isVisited=!1,this.boundingBoxMin=new r.h9(Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER),this.boundingBoxMax=new r.h9(Number.MIN_SAFE_INTEGER,Number.MIN_SAFE_INTEGER,Number.MIN_SAFE_INTEGER),this.vec=new r.h9(0,0,0),this.t=1,this.gridResolution=85,this.tempVecGridList=[],this.tempGeoGridList=[],this.renderer=e,this.geometries=t,this.type=n;for(var o=0;o<this.geometries.length;++o)this.vec.x+=this.geometries[o].vec.x,this.vec.y+=this.geometries[o].vec.y,this.updateBoundingBox(this.geometries[o].vec);this.vec.x/=this.geometries.length,this.vec.y/=this.geometries.length,this.minVec=new r.h9(this.vec.x-this.r1,this.vec.y-this.r1,0),this.maxVec=new r.h9(this.vec.x+this.r1,this.vec.y+this.r1,0)}return e.prototype.isInside=function(e){return(0,r.Sp)(this.vec,e)<this.r1?(this.isHover=!0,this.geometries[0].scene.annotationInstance.activeCommandController.activeMouseCursor.setActiveCursorHovering(),this.geometries[0].scene.annotationInstance.renderer.needFocus=!0,this.geometries[0].scene.annotationInstance.activeCommandController.acProperties.hasHovering=!0,!0):(this.isHover=!1,!1)},e.prototype.addPost=function(e){if(!this.geometries.includes(e)){this.geometries.push(e),this.vec=new r.h9(0,0,0);for(var t=0;t<this.geometries.length;++t)this.vec.x+=this.geometries[t].vec.x,this.vec.y+=this.geometries[t].vec.y,this.updateBoundingBox(this.geometries[t].vec);this.vec.x/=this.geometries.length,this.vec.y/=this.geometries.length,this.minVec=new r.h9(this.vec.x-this.r1,this.vec.y-this.r1,0),this.maxVec=new r.h9(this.vec.x+this.r1,this.vec.y+this.r1,0)}},e.prototype.needDecompose=function(){return this.boundingBoxMax.x-this.boundingBoxMin.x>this.gridResolution||this.boundingBoxMax.y-this.boundingBoxMin.y>this.gridResolution},e.prototype.split=function(){this.deepRemove();var e=(this.boundingBoxMax.x-this.boundingBoxMin.x)/this.gridResolution<1?1:(this.boundingBoxMax.x-this.boundingBoxMin.x)/this.gridResolution,t=(this.boundingBoxMax.y-this.boundingBoxMin.y)/this.gridResolution<1?1:(this.boundingBoxMax.y-this.boundingBoxMin.y)/this.gridResolution,n=this.buildGrid(e,t);this.buildSubCluster(n,e,t)},e.prototype.merge=function(e){this.geometries.concat(e.geometries),this.vec=new r.h9(0,0,0);for(var t=0;t<this.geometries.length;++t)this.vec.x+=this.geometries[t].vec.x,this.vec.y+=this.geometries[t].vec.y,this.updateBoundingBox(this.geometries[t].vec);this.vec.x/=this.geometries.length,this.vec.y/=this.geometries.length,this.minVec=new r.h9(this.vec.x-this.r1,this.vec.y-this.r1,0),this.maxVec=new r.h9(this.vec.x+this.r1,this.vec.y+this.r1,0),e.deepRemove()},e.prototype.deepRemove=function(){this.renderer.removeCluster(this)},e.prototype.buildGrid=function(e,t){this.tempGeoGridList=[];for(var n=[],o=0;o<t;++o){for(var i=this.boundingBoxMin.y+o*this.gridResolution,s=[],a=0;a<e;++a){var h=this.boundingBoxMin.x+a*this.gridResolution;n.push(new r.h9(h,i)),s.push([])}this.tempGeoGridList.push(s)}return this.tempVecGridList=n,n},e.prototype.buildSubCluster=function(t,n,o){for(var i=0;i<this.geometries.length;++i)this.getCellAtPoint(this.geometries[i].vec,n,o).push(this.geometries[i]);for(var s=0;s<this.tempGeoGridList.length;++s)for(var a=0;a<this.tempGeoGridList[s].length;++a)this.tempGeoGridList[s][a]&&(1===this.tempGeoGridList[s][a].length?this.tempGeoGridList[s][a][0].collision.reset():this.tempGeoGridList[s][a].length>1&&(this.tempGeoGridList[s][a][0].type===r.zq.POINT_NUMBERED?this.renderer.clustersNPoint.push(new e(this.renderer,this.tempGeoGridList[s][a],this.tempGeoGridList[s][a][0].type)):this.tempGeoGridList[s][a][0].type===r.zq.POINT_REGULAR&&this.renderer.clustersRPoint.push(new e(this.renderer,this.tempGeoGridList[s][a],this.tempGeoGridList[s][a][0].type))))},e.prototype.getCellAtPoint=function(e,t,n){var o=new r.h9(e.x-this.boundingBoxMin.x,e.y-this.boundingBoxMin.y),i=Math.round(o.x/this.gridResolution),s=Math.round(o.y/this.gridResolution);return i>=t&&(i=t-1),s>=n&&(s=n-1),i<0&&(i=0),s<0&&(s=0),i=Math.round(i),s=Math.round(s),this.tempGeoGridList[s][i]},e.prototype.draw=function(e,t){if(this.updateTimer(),t.optimizer.optimizer.optimizer.renderer.imageAnnoApp.activeCommandController.acProperties.extentChanging){this.vec=new r.h9(0,0,0),this.boundingBoxMin=new r.h9(Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER),this.boundingBoxMax=new r.h9(Number.MIN_SAFE_INTEGER,Number.MIN_SAFE_INTEGER,Number.MIN_SAFE_INTEGER);for(var n=0;n<this.geometries.length;++n)this.vec.x+=this.geometries[n].vec.x,this.vec.y+=this.geometries[n].vec.y,this.updateBoundingBox(this.geometries[n].vec);this.vec.x/=this.geometries.length,this.vec.y/=this.geometries.length,this.minVec=new r.h9(this.vec.x-this.r1,this.vec.y-this.r1,0),this.maxVec=new r.h9(this.vec.x+this.r1,this.vec.y+this.r1,0)}if(t.optimizer.optimizer.optimizer.renderer.draw.shape.cluster.drawingPresetClustering(e,this.geometries,this.vec,this.r0,this.r1,this.isHover,this.t),t.optimizer.optimizer.optimizer.renderer.imageAnnoApp.implementations.app.INSPECTION&&(e.beginPath(),e.rect(this.minVec.x,this.minVec.y,this.maxVec.x-this.minVec.x,this.maxVec.y-this.minVec.y),e.closePath(),e.fillStyle="rgba(0, 0, 0, 0.3)",e.fill(),e.lineWidth=.5,e.beginPath(),e.rect(this.boundingBoxMin.x,this.boundingBoxMin.y,this.boundingBoxMax.x-this.boundingBoxMin.x,this.boundingBoxMax.y-this.boundingBoxMin.y),e.closePath(),e.stroke(),this.tempVecGridList.length>0))for(n=0;n<this.tempVecGridList.length;++n)e.beginPath(),e.rect(this.tempVecGridList[n].x,this.tempVecGridList[n].y,this.gridResolution,this.gridResolution),e.closePath(),e.stroke()},e.prototype.updateTimer=function(){this.geometries[0].scene.annotationInstance.activeCommandController.acProperties.hasHovering?(this.t-=this.geometries[0].scene.annotationInstance.customization.themeCurrent.properties.timeTransitionA,this.t=this.t<.4?.4:this.t):(this.t+=this.geometries[0].scene.annotationInstance.customization.themeCurrent.properties.timeTransitionB,this.t=this.t>1?1:this.t)},e.prototype.updateBoundingBox=function(e){this.boundingBoxMin.x=e.x<this.boundingBoxMin.x?e.x:this.boundingBoxMin.x,this.boundingBoxMin.y=e.y<this.boundingBoxMin.y?e.y:this.boundingBoxMin.y,this.boundingBoxMax.x=e.x>this.boundingBoxMax.x?e.x:this.boundingBoxMax.x,this.boundingBoxMax.y=e.y>this.boundingBoxMax.y?e.y:this.boundingBoxMax.y},e}(),Oi=function(){function e(e){this.clustersNPoint=[],this.clustersRPoint=[],this.optimizer=e}return e.prototype.initGeometry=function(){this.clustersNPoint=[],this.clustersRPoint=[]},e.prototype.addClusterByGeometries=function(e,t){if(t===r.zq.POINT_NUMBERED)for(var n=0;n<e.length;++n)this.clustersNPoint.push(new bi(this,e[n],t));else if(t===r.zq.POINT_REGULAR)for(n=0;n<e.length;++n)this.clustersRPoint.push(new bi(this,e[n],t))},e.prototype.removeCluster=function(e){e.geometries[0].type===r.zq.POINT_NUMBERED?this.clustersNPoint.splice(this.clustersNPoint.indexOf(e),1):e.geometries[0].type===r.zq.POINT_REGULAR&&this.clustersRPoint.splice(this.clustersRPoint.indexOf(e),1)},e.prototype.render=function(e){if(this.clustersNPoint.length>0)for(var t=0;t<this.clustersNPoint.length;++t)this.clustersNPoint[t].draw(e,this);if(this.clustersRPoint.length>0)for(t=0;t<this.clustersRPoint.length;++t)this.clustersRPoint[t].draw(e,this)},e}(),Ri=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Li=function(e){function t(t){var n=e.call(this,t)||this;return n.interaction=new Ii(n),n.graph=new xi(n),n.renderer=new Oi(n),n}return Ri(t,e),t.prototype.mouseClick=function(e,t){return!!this.interaction.mouseClick(e,t)},t.prototype.mouseMove=function(e,t){this.interaction.mouseMove(e,t)},t.prototype.render=function(e){this.renderer.render(e)},t.prototype.update=function(){this.graph.update()},t}(wi),Vi=function(){function e(e){this.listRPoint=[],this.listNPoint=[],this.rx=15,this.ry=8,this.xInterval=0,this.yInterval=0,this.cells=[],this.optimizer=e}return e.prototype.update=function(){this.initGrid()},e.prototype.initGrid=function(){this.cells=[];var e=this.optimizer.optimizer.optimizer.renderer.ctx.canvas.width,t=this.optimizer.optimizer.optimizer.renderer.ctx.canvas.height;this.xInterval=e/(this.rx-1),this.yInterval=t/(this.ry-1);for(var n=0;n<this.ry;n++){for(var o=[],i=0;i<this.rx;i++)o.push(new ki(this,i,n));this.cells.push(o)}for(var s=0;s<this.optimizer.optimizer.optimizer.renderer.imageAnnoApp.scene.listNPoint.length;++s){var r=this.optimizer.optimizer.optimizer.renderer.imageAnnoApp.scene.listNPoint[s];this.getCellAtPoint(r.vec).add(r)}for(n=0;n<this.ry;++n)for(i=0;i<this.rx;++i)this.cells[n][i].geometries.length<2&&(this.cells[n][i].isRenderable=!1)},e.prototype.getCellAtPoint=function(e){var t=Math.round(e.x/this.xInterval),n=Math.round(e.y/this.yInterval);return t>=this.rx&&(t=this.rx-1),n>=this.ry&&(n=this.ry-1),t<0&&(t=0),n<0&&(n=0),this.cells[n][t]},e.prototype.render=function(e){for(var t=0;t<this.cells.length;t++)for(var n=0;n<this.cells[t].length;n++)this.cells[t][n].draw(e)},e}(),ki=function(){function e(e,t,n){this.r0=16,this.r1=24,this.isHover=!1,this.geometries=[],this.isRenderableValue=!0,this.grid=e,this.xI=t,this.yI=n,this.vec=new r.h9(t*this.grid.xInterval,n*this.grid.yInterval),this.geometries=[]}return e.prototype.add=function(e){e.isRenderable=!1,this.geometries.push(e),this.vecRender=new r.h9(0,0,0);for(var t=0;t<this.geometries.length;++t)this.vecRender.x+=this.geometries[t].vec.x,this.vecRender.y+=this.geometries[t].vec.y;this.vecRender.x/=this.geometries.length,this.vecRender.y/=this.geometries.length},Object.defineProperty(e.prototype,"isRenderable",{get:function(){return this.isRenderableValue},set:function(e){if(!e){for(var t=0;t<this.geometries.length;++t)this.geometries[t].isRenderable=!0;this.geometries=[]}this.isRenderableValue=e},enumerable:!1,configurable:!0}),e.prototype.draw=function(e){if(this.isRenderable){if(this.grid.optimizer.optimizer.optimizer.renderer.imageAnnoApp.activeCommandController.acProperties.extentChanging){this.vecRender=new r.h9(0,0,0);for(var t=0;t<this.geometries.length;++t)this.vecRender.x+=this.geometries[t].vec.x,this.vecRender.y+=this.geometries[t].vec.y;this.vecRender.x/=this.geometries.length,this.vecRender.y/=this.geometries.length}e.beginPath(),e.arc(this.vecRender.x,this.vecRender.y,5,0,2*Math.PI),e.closePath(),e.stroke(),this.grid.optimizer.optimizer.optimizer.renderer.draw.shape.cluster.drawingPresetClustering(e,this.geometries,this.vecRender,this.r0,this.r1,this.isHover)}},e}(),Ni=function(){function e(e){this.m=new r.h9(0,0),this.optimizer=e}return e.prototype.mouseClick=function(e,t){this.m.x=e,this.m.y=t;for(var n=0;n<this.optimizer.renderer.pointClusters.length;++n)if(this.optimizer.renderer.pointClusters[n].isInside(this.m))return!0;return!1},e.prototype.mouseMove=function(e,t){this.m.x=e,this.m.y=t;for(var n=0;n<this.optimizer.renderer.pointClusters.length;++n)this.optimizer.renderer.pointClusters[n].isInside(this.m)},e}(),Ei=function(){function e(e){this.pointClusters=[],this.optimizer=e}return e.prototype.initGeometry=function(){this.pointClusters=[]},e.prototype.pushGeometry=function(e,t){for(var n=0;n<e.length;++n)this.pointClusters.push(new _i(e[n],t))},e.prototype.render=function(e){this.optimizer.grid.render(e)},e}(),_i=function(){function e(e,t){this.r0=16,this.r1=24,this.isHover=!1,this.vec=new r.h9(0,0,0),this.geometries=e,this.type=t;for(var n=0;n<this.geometries.length;++n)this.vec.x+=this.geometries[n].vec.x,this.vec.y+=this.geometries[n].vec.y;this.vec.x/=this.geometries.length,this.vec.y/=this.geometries.length}return e.prototype.isInside=function(e){return(0,r.Sp)(this.vec,e)<this.r1+2?(this.isHover=!0,!0):(this.isHover=!1,!1)},e.prototype.draw=function(e,t){if(t.optimizer.optimizer.optimizer.renderer.imageAnnoApp.activeCommandController.acProperties.extentChanging){this.vec=new r.h9(0,0,0);for(var n=0;n<this.geometries.length;++n)this.vec.x+=this.geometries[n].vec.x,this.vec.y+=this.geometries[n].vec.y;this.vec.x/=this.geometries.length,this.vec.y/=this.geometries.length}t.optimizer.optimizer.optimizer.renderer.draw.shape.cluster.drawingPresetClustering(e,this.geometries,this.vec,this.r0,this.r1,this.isHover)},e}(),Ti=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Di=function(e){function t(t){var n=e.call(this,t)||this;return n.interaction=new Ni(n),n.grid=new Vi(n),n.renderer=new Ei(n),n}return Ti(t,e),t.prototype.mouseClick=function(e,t){return!!this.interaction.mouseClick(e,t)},t.prototype.mouseMove=function(e,t){this.interaction.mouseMove(e,t)},t.prototype.render=function(e){this.renderer.render(e)},t.prototype.update=function(){this.grid.update()},t}(wi),Mi=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),zi=function(e){function t(t){return e.call(this,t)||this}return Mi(t,e),t.prototype.update=function(){this.optimizerTextleaderlineByNone()},t.prototype.optimizerTextleaderlineByNone=function(){for(var e=0;e<this.optimizer.optimizer.renderer.imageAnnoApp.scene.listNPoint.length;++e)this.optimizer.optimizer.renderer.imageAnnoApp.scene.listNPoint[e].collision.reset();for(e=0;e<this.optimizer.optimizer.renderer.imageAnnoApp.scene.listRPoint.length;++e)this.optimizer.optimizer.renderer.imageAnnoApp.scene.listRPoint[e].collision.reset()},t}(wi),Gi=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Wi=function(e){function t(t){return e.call(this,t)||this}return Gi(t,e),t.prototype.update=function(){this.optimizerTextleaderlineByZoom()},t.prototype.optimizerTextleaderlineByZoom=function(){},t}(wi),Bi=function(){function e(e,t){this.optimizer=e,this.type=t}return Object.defineProperty(e.prototype,"type",{get:function(){return this._type},set:function(e){switch(this._type=e,this.optimizer.renderer.imageAnnoApp.implementations.app.PRODUCTION,e){case r.xX.Zoom:return void(this.activeOptimizer=new Wi(this));case r.xX.Grid:return void(this.activeOptimizer=new Di(this));case r.xX.Collision:return void(this.activeOptimizer=new Li(this));case r.xX.Agent:return;default:return void(this.activeOptimizer=new zi(this))}},enumerable:!1,configurable:!0}),e.prototype.update=function(){this.activeOptimizer.update()},e.prototype.render=function(e){this.activeOptimizer&&this.activeOptimizer.render(e)},e.prototype.mouseClick=function(e,t){return!(!this.activeOptimizer||!this.activeOptimizer.mouseClick(e,t))},e.prototype.mouseMove=function(e,t){this.activeOptimizer&&this.activeOptimizer.mouseMove(e,t)},e}(),Hi=function(){function e(e){this.initForceTimer=0,this.renderer=e,this.init()}return Object.defineProperty(e.prototype,"typeTextleaderline",{get:function(){return this.textleaderlineOptimizer.type},set:function(e){this.textleaderlineOptimizer.type=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"typePoint",{get:function(){return this.pointOptimizer.type},set:function(e){this.pointOptimizer.type=e},enumerable:!1,configurable:!0}),e.prototype.init=function(){this.pointOptimizer=new Bi(this,this.renderer.imageAnnoApp.activeCommandController.acProperties.optimizerPoint),this.textleaderlineOptimizer=new Pi(this,this.renderer.imageAnnoApp.activeCommandController.acProperties.optimizerTextleaderline)},e.prototype.update=function(){this.renderer.imageAnnoApp.activeCommandController.acProperties.isPanning||(this.renderer.imageAnnoApp.activeCommandController.acProperties.needExecuteOptimizer||++this.initForceTimer<30)&&(this.pointOptimizer.update(),this.textleaderlineOptimizer.update(),this.renderer.imageAnnoApp.activeCommandController.acProperties.needExecuteOptimizer=!1)},e.prototype.render=function(e){this.pointOptimizer.render(e)},e.prototype.mouseClick=function(e,t){return!!this.pointOptimizer.mouseClick(e,t)},e.prototype.mouseMove=function(e,t){this.pointOptimizer.mouseMove(e,t)},e}(),Fi=function(){function e(e){this.index=0,this.renderer=e}return e.prototype.renderEnv=function(e){for(this.renderer.objectSnapping.render(e),qe.construction&&qe.construction.renderPost(e),this.index=this.renderer.imageAnnoApp.scene.listACircleWrapperr.length;this.index--;)this.renderer.imageAnnoApp.scene.listACircleWrapperr[this.index].render(e);for(this.index=this.renderer.imageAnnoApp.scene.listAPolygonGraphWrapper.length;this.index--;)this.renderer.imageAnnoApp.scene.listAPolygonGraphWrapper[this.index].render(e);for(this.index=this.renderer.imageAnnoApp.scene.listARectangleWrapper.length;this.index--;)this.renderer.imageAnnoApp.scene.listARectangleWrapper[this.index].render(e);for(this.index=this.renderer.imageAnnoApp.scene.listAPolylineGraphWrapper.length;this.index--;)this.renderer.imageAnnoApp.scene.listAPolylineGraphWrapper[this.index].render(e);for(this.renderer.imageAnnoApp.scene.listAPolylineGraphShadow&&this.renderer.imageAnnoApp.scene.listAPolylineGraphShadow.render(e),this.index=this.renderer.imageAnnoApp.scene.listAFreehandSmartDrawing.length;this.index--;)this.renderer.imageAnnoApp.scene.listAFreehandSmartDrawing[this.index].render(e);for(this.index=this.renderer.imageAnnoApp.scene.listAFreehand.length;this.index--;)this.renderer.imageAnnoApp.scene.listAFreehand[this.index].render(e);for(this.index=this.renderer.imageAnnoApp.scene.listAPolylineWrapper.length;this.index--;)this.renderer.imageAnnoApp.scene.listAPolylineWrapper[this.index].render(e);for(this.index=this.renderer.imageAnnoApp.scene.listACurve.length;this.index--;)this.renderer.imageAnnoApp.scene.listACurve[this.index].render(e);for(this.index=this.renderer.imageAnnoApp.scene.listAArrow.length;this.index--;)this.renderer.imageAnnoApp.scene.listAArrow[this.index].render(e);for(wt.condition.geo&&wt.condition.geo.render(e),this.index=this.renderer.imageAnnoApp.scene.listATextleaderlineWrapper.length;this.index--;)this.renderer.imageAnnoApp.scene.listATextleaderlineWrapper[this.index].renderLeadline(e);for(this.index=this.renderer.imageAnnoApp.scene.listAPolygonGraphWrapper.length;this.index--;)this.renderer.imageAnnoApp.scene.listAPolygonGraphWrapper[this.index].renderPostNodes(e);for(this.index=this.renderer.imageAnnoApp.scene.listAPoint.length;this.index--;)this.renderer.imageAnnoApp.scene.listAPoint[this.index].render(e);for(this.index=this.renderer.imageAnnoApp.scene.listRPoint.length;this.index--;)this.renderer.imageAnnoApp.scene.listRPoint[this.index].render(e);for(this.index=this.renderer.imageAnnoApp.scene.listIPoint.length;this.index--;)this.renderer.imageAnnoApp.scene.listIPoint[this.index].render(e);for(this.index=this.renderer.imageAnnoApp.scene.listNPoint.length;this.index--;)this.renderer.imageAnnoApp.scene.listNPoint[this.index].render(e);for(this.renderer.optimizer.render(e),this.index=this.renderer.imageAnnoApp.scene.listATextleaderlineWrapper.length;this.index--;)this.renderer.imageAnnoApp.scene.listATextleaderlineWrapper[this.index].render(e);if(this.renderer.imageAnnoApp.implementations.app.INSPECTION){if(e.fillStyle="#000000",e.font="10px Arial",this.renderer.imageAnnoApp.scene.capture){var t=this.renderer.imageAnnoApp.scene.capture.vec,n=this.renderer.imageAnnoApp.scene.capture.type;e.fillText(""+n,t.x,t.y+10)}var o=this.renderer.imageAnnoApp.scene.geometryList.length,i=this.renderer.imageAnnoApp.scene.listAPoint.length,s=this.renderer.imageAnnoApp.scene.Capture?this.renderer.imageAnnoApp.scene.Capture.type:void 0,r=this.renderer.imageAnnoApp.activeCommandController.acProperties.mapScale,a=this.renderer.debugText,h=this.renderer.imageAnnoApp.implementations.app.model.appCoreWrapper.browserUtility.isMobile;e.fillText("num of geo: "+o,.5*this.renderer.imageAnnoApp.graphicsCoreWrapper.canvasWrapper.aCanvas.ctx.canvas.width-150,30),e.fillText("num of aPoint(node): "+i,.5*this.renderer.imageAnnoApp.graphicsCoreWrapper.canvasWrapper.aCanvas.ctx.canvas.width-150,50),e.fillText("capture: "+s,.5*this.renderer.imageAnnoApp.graphicsCoreWrapper.canvasWrapper.aCanvas.ctx.canvas.width+0,30),e.fillText("map scale: "+r,.5*this.renderer.imageAnnoApp.graphicsCoreWrapper.canvasWrapper.aCanvas.ctx.canvas.width+150+0,30),e.fillText("debug: "+a,.5*this.renderer.imageAnnoApp.graphicsCoreWrapper.canvasWrapper.aCanvas.ctx.canvas.width,60),e.fillText("isMobile: "+h,.5*this.renderer.imageAnnoApp.graphicsCoreWrapper.canvasWrapper.aCanvas.ctx.canvas.width,90),this.renderer.imageAnnoApp.activeCommandController.screenLog.render(e)}},e}(),Ui=function(){function e(e){this.renderer=e,this.canvas=document.createElement("canvas"),this.canvas.style.background="#000000",this.canvas.style.position="absolute";var t=this.canvas.getContext("2d");t&&(this.ctxTemp=t)}return e.prototype.getImgDataFromHTMLImg=function(e,t){e.crossOrigin="anonymous",this.ctxTemp.drawImage(e,50,50)},e.prototype.ellipseOffScreen=function(e,t,n,o,i,s,r,a,h){void 0===h&&(h=.3),e.beginPath(),e.ellipse(o,i,s,r,0,0,2*Math.PI,!1),e.closePath(),e.fillStyle=n,a&&e.fill(),this.polygonEndOffScreen(e,t,n)},e.prototype.polygonEndOffScreen=function(e,t,n){e.lineWidth=t.lineWidth,e.strokeStyle=n,e.stroke()},e.prototype.rectangleOffScreen=function(e,t,n){e.beginPath(),e.moveTo(n[0].x,n[0].y);for(var o=1;o<n.length;++o)e.lineTo(n[o].x,n[o].y);e.fillStyle=t,e.closePath(),e.fill()},e.prototype.curveQuadraticArrowOffScreen=function(e,t,n,o,i,s,r,a,h){e.lineWidth=t.lineWidth+10,e.strokeStyle=n,e.beginPath(),e.moveTo(o,i),e.quadraticCurveTo(s,r,a,h),e.stroke(),e.closePath()},e.prototype.curveBezierOffScreen=function(e,t,n,o,i,s,r,a,h,c,p){e.lineWidth=t.lineWidth+10,e.strokeStyle=n,e.beginPath(),e.moveTo(o,i),e.bezierCurveTo(s,r,a,h,c,p),e.stroke(),e.closePath()},e.prototype.polygonOffScreen=function(e,t,n,o){void 0===o&&(o=10),e.fillStyle=t,e.strokeStyle=t,e.lineWidth=o,e.beginPath(),e.moveTo(n[0].x,n[0].y);for(var i=1;i<n.length;++i)e.lineTo(n[i].x,n[i].y);e.closePath(),e.stroke(),e.fill()},e.prototype.PolygonOffScreenByVecs=function(e,t,n,o){void 0===o&&(o=10),e.fillStyle=t,e.strokeStyle=t,e.lineWidth=o,e.beginPath(),e.moveTo(n[0].x,n[0].y);for(var i=1;i<n.length;++i)e.lineTo(n[i].x,n[i].y);e.closePath(),e.stroke(),e.fill()},e.prototype.polygonOffScreenByVecsOfVecs=function(e,t,n){for(var o=1;o<n.length;++o)this.PolygonOffScreenByVecs(e,t,n[o])},e.prototype.rPointOffscreen=function(e,t,n,o){var i=n.x-.5*this.renderer.imageAnnoApp.customization.themeCurrent.rPoint.width,s=n.y-this.renderer.imageAnnoApp.customization.themeCurrent.rPoint.height;e.beginPath(),e.fillStyle=t,e.rect(i-this.renderer.imageAnnoApp.scene.paramsEditing.croppingMaskParams.x+(.5*this.renderer.imageAnnoApp.customization.themeCurrent.rPoint.width-.5*this.renderer.imageAnnoApp.customization.themeCurrent.rPoint.width*o),s-this.renderer.imageAnnoApp.scene.paramsEditing.croppingMaskParams.y+(this.renderer.imageAnnoApp.customization.themeCurrent.rPoint.height-this.renderer.imageAnnoApp.customization.themeCurrent.rPoint.height*o),this.renderer.imageAnnoApp.customization.themeCurrent.rPoint.width*o,this.renderer.imageAnnoApp.customization.themeCurrent.rPoint.height*o),e.closePath(),e.fill()},e.prototype.pointRegularDragOffscreen=function(e,t,n,o,i,s){if(void 0===i&&(i=1),void 0===s&&(s=!0),this.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG){var r=this.renderer.imageAnnoApp.customization.themeCurrent.properties.pointBoundOffset;s?r*=i:r-=r*i,e.beginPath(),e.fillStyle=t,e.rect(n,o,this.renderer.imageAnnoApp.customization.themeCurrent.rPoint.width,this.renderer.imageAnnoApp.customization.themeCurrent.rPoint.height),e.closePath(),e.fill()}},e}(),ji=function(){function e(e){this.listBase64=new Map,this.activeBase64ID="",this.draw=e}return e.prototype.addBase64=function(e,t){this.listBase64.has(e)||(this.listBase64.set(e,t),this.draw.renderer.imageAnnoApp.io.eventListenerAnnotation.addBase64Stack(e,t))},e.prototype.activeBase64=function(e){this.listBase64.has(e)&&(this.activeBase64ID=e,this.draw.renderer.imageAnnoApp.activeCommandController.activeBase64img=this.listBase64.get(e),this.draw.renderer.imageAnnoApp.io.eventListenerAnnotation.selectBase64(e))},e}(),qi=function(){function e(e){this.index=0,this.shape=e}return e.prototype.polygonEnd=function(e,t,n,o){e.lineWidth=t.lineWidth*t.scaleLocal*t.scaleGlobal,this.shape.draw.renderer.needFocus&&!n?e.strokeStyle=t.colorInterpolatedString:e.strokeStyle=t.colorStroke,o&&(e.strokeStyle=t.colorStroke),e.setLineDash(t.dash),e.stroke(),e.setLineDash([])},e.prototype.polygonHoverEnd=function(e,t,n,o,i,s){e.lineWidth=t.lineWidth*t.scaleGlobal*t.scaleLocal*i*this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.elasticScale,e.strokeStyle=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.outlineHoverColorRGBAString,e.closePath(),e.setLineDash(t.dash),e.stroke(),e.setLineDash([0,0])},e.prototype.polygonHover=function(e,t,n,o,i,s,r,a){for(void 0===s&&(s=1),void 0===r&&(r=!0),e.beginPath(),e.moveTo(n[0].x,n[0].y),this.index=1;this.index<n.length;++this.index)e.lineTo(n[this.index].x,n[this.index].y);this.polygonHoverEnd(e,t,r,a,s,i)},e.prototype.ellipse=function(e,t,n,o,i,s,r,a,h,c){void 0===c&&(c=.3),e.beginPath(),e.ellipse(n,o,i,s,0,0,2*Math.PI,!1),e.closePath(),e.fillStyle=t.colorFill,this.shape.draw.renderer.needFocus,e.fillStyle=t.colorInterpolatedString,h&&(e.fillStyle=t.colorInterpolatedString),this.polygonEnd(e,t,a,h)},e.prototype.ellipseLocalTint=function(e,t,n,o,i,s,r,a,h,c){void 0===c&&(c=.3),e.beginPath(),e.ellipse(n,o,i,s,0,0,2*Math.PI,!1),e.closePath();var p=s,l=[127.5,127.5,127.5],d=e.createRadialGradient(n,o,0,n,o,p);d.addColorStop(0,"rgba("+l[0]+", "+l[1]+", "+l[2]+", 0.9)"),d.addColorStop(1,"rgba("+l[0]+", "+l[1]+", "+l[2]+", 0.0)"),e.fillStyle=d,e.fill()},e.prototype.ellipseHover=function(e,t,n,o,i,s,r,a,h,c,p){void 0===h&&(h=1),void 0===c&&(c=!0),e.beginPath(),e.ellipse(n,o,i,s,0,0,2*Math.PI,!1),e.closePath(),this.polygonHoverEnd(e,t,c,p,h,a)},e.prototype.roundedRect=function(e,t,n,o,i){void 0===i&&(i=0);var s=o;e.lineWidth=t.lineWidth*t.scaleGlobal*t.scaleLocal,e.strokeStyle=t.colorStroke,e.beginPath(),e.moveTo(n[0].x+i+s,n[0].y),e.lineTo(n[1].x-i-s,n[1].y),e.arcTo(n[1].x-i,n[1].y,n[1].x-i,n[1].y+s,s),e.lineTo(n[2].x-i,n[2].y-s),e.arcTo(n[2].x-i,n[2].y,n[2].x-i-s,n[2].y,s),e.lineTo(n[3].x+i+s,n[3].y),e.arcTo(n[3].x+i,n[3].y,n[3].x+i,n[3].y-s,s),e.lineTo(n[0].x+i,n[0].y+s),e.arcTo(n[0].x+i,n[0].y,n[0].x+i+s,n[0].y,s),e.setLineDash(t.dash),e.stroke(),e.setLineDash([])},e.prototype.rectangle=function(e,t,n,o,i,s,r){for(e.beginPath(),e.moveTo(n[0].x,n[0].y),this.index=1;this.index<n.length;++this.index)e.lineTo(n[this.index].x,n[this.index].y);e.closePath(),e.fillStyle=t.colorFill,i&&(this.shape.draw.renderer.needFocus,e.fillStyle=t.colorInterpolatedString,r&&(e.fillStyle=t.colorInterpolatedString)),this.polygonEnd(e,t,s,r)},e.prototype.rectangleHover=function(e,t,n,o,i,s,r,a){for(void 0===s&&(s=1),void 0===r&&(r=!0),e.beginPath(),e.moveTo(n[0].x,n[0].y),this.index=1;this.index<n.length;++this.index)e.lineTo(n[this.index].x,n[this.index].y);this.polygonHoverEnd(e,t,r,a,s,i)},e.prototype.polygon=function(e,t,n,o,i,s,r,a,h){for(e.beginPath(),e.moveTo(n[0].x,n[0].y),this.index=1;this.index<n.length;++this.index)e.lineTo(n[this.index].x,n[this.index].y);for(e.closePath(),this.shape.draw.renderer.needFocus,e.fillStyle=t.colorInterpolatedString,h&&(e.fillStyle=t.colorInterpolatedString),e.beginPath(),e.moveTo(n[0].x,n[0].y),this.index=1;this.index<n.length;++this.index)e.lineTo(n[this.index].x,n[this.index].y);e.lineWidth=t.lineWidth*t.scaleGlobal*t.scaleLocal,this.shape.draw.renderer.needFocus&&!a?e.strokeStyle=t.colorInterpolatedString:e.strokeStyle=t.colorStroke,h&&(e.strokeStyle=t.colorStroke),e.setLineDash(t.dash),o?(e.stroke(),e.closePath()):(e.closePath(),e.stroke()),e.setLineDash([])},e.prototype.polygonByVecGhost=function(e,t,n,o,i,s){for(e.beginPath(),e.moveTo(n[0].x,n[0].y),this.index=1;this.index<n.length;++this.index)e.lineTo(n[this.index].x,n[this.index].y);for(e.fillStyle=t.colorFill,e.closePath(),e.beginPath(),e.moveTo(n[0].x,n[0].y),this.index=1;this.index<n.length;++this.index)e.lineTo(n[this.index].x,n[this.index].y);e.lineTo(n[0].x,n[0].y),e.lineWidth=t.lineWidth*t.scaleGlobal*t.scaleLocal,e.strokeStyle=t.colorStroke,o?(e.stroke(),e.closePath()):(e.closePath(),e.stroke())},e}(),Ji=function(e){this.drawingPresetClustering=function(e,t,n,o,i,s,r){void 0===r&&(r=1);var a=t[0].styleComponent.renderStyle.colorFillHover.split(","),h="rgba("+ +a[0].split("(")[1]+", "+ +a[1]+", "+ +a[2]+", "+(+a[3].split(")")[0]-.1)*r+")",c=t[0].styleComponent.renderStyle.colorInterpolatedString;if(s)for(var p=0;p<t.length;++p)e.lineWidth=.6,e.strokeStyle=t[0].styleComponent.renderStyle.colorFill,e.beginPath(),e.moveTo(n.x,n.y),e.lineTo(t[p].vec.x,t[p].vec.y),e.closePath(),e.stroke(),e.lineWidth=1,e.strokeStyle="rgba(255, 255, 255, 1)",e.fillStyle=t[0].styleComponent.renderStyle.colorFill,e.beginPath(),e.arc(t[p].vec.x,t[p].vec.y,4,0,2*Math.PI),e.closePath(),e.fill(),e.stroke();s?(e.fillStyle=t[0].styleComponent.renderStyle.colorFill,e.beginPath(),e.arc(n.x,n.y,1.5,0,2*Math.PI),e.closePath(),e.fill()):(e.beginPath(),e.arc(n.x,n.y,i,0,2*Math.PI),e.closePath(),e.fillStyle=h,e.fill(),e.beginPath(),e.arc(n.x,n.y,o,0,2*Math.PI),e.closePath(),e.fillStyle=c,e.fill(),e.fillStyle="rgba(255, 255, 255, 1)",e.font="bold 11px Arial",e.textAlign="center",e.fillText(""+t.length,n.x,n.y+4))},this.shape=e},Yi=function(){function e(e){this.index=0,this.shape=e}return e.prototype.cArrowByTranslation=function(e,t,n,o,i,a,h,c,p,l,d,u,y,m){void 0===u&&(u=1);var v=(0,r.vQ)((0,r.p$)(n),(0,r.p$)(o));e.save(),e.translate(i,a),e.rotate(-v*Math.PI/180);var g=7.5*this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.arrow.scale*c,f=-12*this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.arrow.scale*c;if(e.beginPath(),e.moveTo(0,0),e.lineTo(-f*h,-g*h),e.lineTo(-f*h,g*h),e.closePath(),e.lineWidth=t.lineWidth*t.scaleGlobal*t.scaleLocal,this.shape.draw.renderer.needFocus&&!p?(e.fillStyle=t.colorFillHover,e.strokeStyle=t.colorInterpolatedString):(e.fillStyle=t.colorFill,e.strokeStyle=t.colorInterpolatedString),y&&(e.fillStyle=t.colorFill,e.strokeStyle=t.colorInterpolatedString),p&&m===s.BackgroundColor){var C=+t.colorStroke.split(",")[1];e.strokeStyle=C<50?"rgba(255, 255, 255, 0.5)":"rgba(0, 0, 0, 0.5)"}e.stroke(),e.fill(),e.restore()},e.prototype.curveQuadraticArrow=function(e,t,n,o,i,s,r,a,h,c,p,l,d,u,y,m,v,g){void 0===d&&(d=1),void 0===m&&(m=!1),void 0===v&&(v=0),void 0===g&&(g=!0),e.lineDashOffset=v,e.setLineDash(t.dash),e.lineWidth=t.lineWidth*t.scaleGlobal*t.scaleLocal,e.beginPath(),e.moveTo(r,a),e.quadraticCurveTo(i,s,n,o),this.shape.draw.renderer.needFocus,e.strokeStyle=t.colorInterpolatedString,u&&(e.fillStyle=t.colorFill,e.strokeStyle=t.colorInterpolatedString),e.stroke(),e.setLineDash([])},e.prototype.arrowByVecNode=function(e,t,n,o,i,s,r,a,h){for(void 0===r&&(r=1),void 0===a&&(a=!0),this.index=0;this.index<n.length;++this.index)this.shape.node.node(e,t,n[this.index].x,n[this.index].y,o);this.shape.area.polygonHoverEnd(e,t,a,h,r,s)},e.prototype.curveQuadratic=function(e,t,n,o,i,s,r,a,h,c){void 0===h&&(h=!1),e.lineWidth=t.lineWidth*t.scaleGlobal*t.scaleLocal,this.shape.draw.renderer.needFocus,e.strokeStyle=t.colorInterpolatedString,c&&(e.strokeStyle=t.colorInterpolatedString),e.beginPath(),e.moveTo(n,o),e.quadraticCurveTo(i,s,r,a),e.stroke()},e.prototype.edgeCurveQuadraticHover=function(e,t,n,o,i,s,r,a,h,c,p){void 0===h&&(h=1),e.lineWidth=h*t.lineWidth*t.scaleGlobal*t.scaleLocal,this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.elasticScale,e.strokeStyle=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.outlineHoverColorRGBAString,e.beginPath(),e.moveTo(n,o),e.quadraticCurveTo(i,s,r,a),e.stroke()},e.prototype.curveBezier=function(e,t,n,o,i,s,r,a,h,c,p,l){e.lineWidth=t.lineWidth*t.scaleGlobal*t.scaleLocal,this.shape.draw.renderer.needFocus&&!p?(e.fillStyle=t.colorFillHover,e.strokeStyle=t.colorInterpolatedString):(e.fillStyle=t.colorFill,e.strokeStyle=t.colorInterpolatedString),l&&(e.fillStyle=t.colorFill,e.strokeStyle=t.colorInterpolatedString),e.beginPath(),e.moveTo(n,o),e.bezierCurveTo(i,s,r,a,h,c),e.stroke()},e.prototype.curveBezierClose=function(e,t,n,o,i,s,r,a,h,c){e.lineWidth=t.lineWidth*t.scaleGlobal*t.scaleLocal,e.strokeStyle=t.colorInterpolatedString,e.beginPath(),e.moveTo(n,o),e.bezierCurveTo(i,s,r,a,h,c),e.stroke()},e.prototype.curveBezierHoverPolyline=function(e,t,n,o,i,s,r,a,h,c,p,l){void 0===l&&(l=.5),e.lineWidth=p*t.lineWidth*t.scaleGlobal*t.scaleLocal*this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.elasticScale,e.strokeStyle=t.colorInterpolatedString,e.beginPath(),e.moveTo(n,o),e.bezierCurveTo(i,s,r,a,h,c),e.stroke()},e.prototype.curveBezierClosed=function(e,t,n,o,i,s,r,a,h,c,p,l){e.lineWidth=t.lineWidth*t.scaleGlobal*t.scaleLocal,this.shape.draw.renderer.needFocus&&!p?(e.fillStyle=t.colorFillHover,e.strokeStyle=t.colorInterpolatedString):(e.fillStyle=t.colorFill,e.strokeStyle=t.colorInterpolatedString),l&&(e.fillStyle=t.colorFill,e.strokeStyle=t.colorInterpolatedString),e.beginPath(),e.moveTo(n,o),e.bezierCurveTo(i,s,r,a,h,c),e.stroke()},e.prototype.curveBezierClosedHoverPolygon=function(e,t,n,o,i,s,r,a,h,c,p){e.lineWidth=p*t.lineWidth*t.scaleGlobal*t.scaleLocal*this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.elasticScale,e.strokeStyle=t.colorInterpolatedString,e.beginPath(),e.moveTo(n,o),e.bezierCurveTo(i,s,r,a,h,c),e.stroke()},e.prototype.curveBezierClosedFill=function(e,t,n,o,i,s,r,a,h,c){e.strokeStyle=t.colorInterpolatedString,e.lineWidth=t.lineWidth*t.scaleGlobal*t.scaleLocal,e.bezierCurveTo(i,s,r,a,h,c)},e.prototype.curveQuadraticHoverPolyline=function(e,t,n,o,i,s,r,a,h){e.lineWidth=h*t.lineWidth*t.scaleGlobal*t.scaleLocal*this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.elasticScale,e.strokeStyle=t.colorInterpolatedString,e.beginPath(),e.moveTo(n,o),e.quadraticCurveTo(i,s,r,a),e.stroke()},e.prototype.drawControlLine=function(e,t,n,o,i,s){e.lineWidth=1*t.scaleGlobal*t.scaleLocal,this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.isDarkBG,e.strokeStyle=t.colorStroke,e.beginPath(),e.moveTo(n,o),e.lineTo(i,s),e.closePath(),e.stroke(),e.restore()},e}(),Xi=function(){function e(e){this.index=0,this.shape=e}return e.prototype.freeHandbyVecs=function(e,t,n,o,i){void 0===i&&(i=!1),e.globalCompositeOperation=r.ew.Screen;var s="rgba("+n[0]+","+n[1]+","+n[2]+",0.35)";for(e.fillStyle=s,e.strokeStyle=s,e.lineWidth=o,e.beginPath(),e.moveTo(t[0].x,t[0].y),this.index=1;this.index<t.length;++this.index)e.lineTo(t[this.index].x,t[this.index].y);for(e.stroke(),this.index=0;this.index<t.length;++this.index)e.beginPath(),e.arc(t[this.index].x,t[this.index].y,1,0,2*Math.PI,!1),e.closePath(),e.stroke();e.globalCompositeOperation=r.ew.SourceOver},e}(),Ki=function(){function e(e){this.index=0,this.shape=e}return e.prototype.line=function(e,t,n,o,i,s,r){var a=t.lineWidth;r&&(a=this.shape.draw.renderer.numericalMotion.scale(a)),e.beginPath(),e.moveTo(n,o),e.lineTo(i,s),e.closePath(),e.lineWidth=a,e.strokeStyle=t.colorStroke,e.stroke()},e.prototype.lineTrajectory=function(e,t,n){for(e.globalAlpha=1,e.globalCompositeOperation=r.ew.Screen,this.index=1;this.index<n.length-2;this.index+=2)e.beginPath(),e.moveTo(n[this.index+1].x,n[this.index+1].y),e.lineTo(n[this.index].x,n[this.index].y),e.lineWidth=.15*t.lineWidth*t.scaleGlobal*t.scaleLocal,e.strokeStyle=t.colorStroke,e.stroke(),e.closePath();e.globalCompositeOperation=r.ew.SourceOver},e.prototype.polyline=function(e,t,n,o,i,s,r){for(e.lineWidth=t.lineWidth*t.scaleGlobal*t.scaleLocal,this.shape.draw.renderer.needFocus&&!s?e.strokeStyle=t.colorStrokeHover:e.strokeStyle=t.colorStroke,r&&(e.strokeStyle=t.colorStroke),e.beginPath(),e.moveTo(n[0].x,n[0].y),this.index=1;this.index<n.length;++this.index)e.lineTo(n[this.index].x,n[this.index].y);e.stroke(),e.closePath()},e.prototype.polylineHover=function(e,t,n,o,i,s,r){for(void 0===s&&(s=1),void 0===r&&(r=!0),e.lineWidth=s*t.lineWidth*t.scaleGlobal*t.scaleLocal*this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.elasticScale,e.strokeStyle=t.colorStrokeHover,e.beginPath(),e.moveTo(n[0].x,n[0].y),this.index=1;this.index<n.length;++this.index)e.lineTo(n[this.index].x,n[this.index].y);e.stroke(),e.setLineDash(t.dash),e.closePath(),e.setLineDash([0,0])},e.prototype.edgePolylineHover=function(e,t,n,o,i,s,r,a,h){void 0===r&&(r=1),e.lineWidth=r*t.lineWidth*t.scaleGlobal*t.scaleLocal*this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.elasticScale,e.strokeStyle=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.outlineHoverColorRGBAString,e.beginPath(),e.moveTo(n,o),e.lineTo(i,s),e.closePath(),e.setLineDash(t.dash),e.stroke(),e.setLineDash([0,0])},e.prototype.shadowMidPointForBending=function(e,t,n){e.lineWidth=t.lineWidth*t.scaleGlobal*t.scaleLocal,e.strokeStyle=t.colorStroke,e.fillStyle=t.colorFill,e.beginPath(),e.arc(n.x,n.y,this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.node.sizeMid,0,6.28),e.closePath(),e.setLineDash(t.dash),e.stroke(),e.setLineDash([0,0])},e.prototype.polylineByVecGhost=function(e,t,n,o,i,s,r){e.lineWidth=t.lineWidth*t.scaleGlobal*t.scaleLocal,e.strokeStyle=t.colorStroke,e.fillStyle=t.colorFill,e.beginPath(),e.moveTo(n[0].x-o[0],n[0].y-o[1]);for(var a=1;a<n.length;++a)e.lineTo(n[a].x-o[0],n[a].y-o[1]);e.stroke()},e.prototype.polylineShadow=function(e,t,n,o,i){e.lineWidth=t.lineWidth*t.scaleGlobal*t.scaleLocal,e.strokeStyle=t.colorStroke,e.fillStyle=t.colorFill,e.beginPath(),e.moveTo(n[0].x,n[0].y);for(var s=1;s<n.length;++s)e.lineTo(n[s].x,n[s].y);e.lineTo(o.x,o.y),e.stroke(),i===r.zq.POLYGON_GRAPH&&e.fill()},e.prototype.polygonShadow=function(e,t,n,o,i){e.lineWidth=t.lineWidth*t.scaleGlobal*t.scaleLocal,e.strokeStyle=t.colorStroke,e.fillStyle=t.colorFill,e.beginPath(),e.moveTo(n[0].x,n[0].y);for(var s=1;s<n.length;++s)e.lineTo(n[s].x,n[s].y);e.lineTo(o.x,o.y),e.closePath(),e.stroke()},e.prototype.lineDim=function(e,t,n,o,i,s,a){var h=n+.5*(i-n),c=o+.5*(s-o),p=(0,r.vQ)((0,r.p$)(new r.h9(n,o)),(0,r.p$)(new r.h9(i,s)));e.translate(h,c),e.rotate(-p*Math.PI/180),this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.isDarkBG?e.fillStyle=r.$C.White:e.fillStyle=r.$C.Black,e.textBaseline="bottom",e.textAlign="center",e.fillText(a.toFixed(2).toString()+"",0,-10),e.setTransform(1,0,0,1,0,0)},e}(),$i=function(){function e(e){this.shape=e}return e.prototype.nGon=function(e,t,n,o){e.globalAlpha=1,e.beginPath(),e.moveTo(t[0].x,t[0].y);for(var i=1;i<t.length;++i)e.lineTo(t[i].x,t[i].y);for(e.closePath(),e.beginPath(),e.moveTo(t[0].x,t[0].y),i=1;i<t.length;++i)e.lineTo(t[i].x,t[i].y);e.closePath(),e.stroke()},e.prototype.nStar=function(e,t,n,o){e.globalAlpha=1,e.beginPath(),e.moveTo(t[0].vec.x,t[0].vec.y);for(var i=1;i<t.length;++i)e.lineTo(t[i].vec.x,t[i].vec.y);var s=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.polygon.fillStyleFirstArray;for(e.fillStyle="rgba("+s[0]+","+s[1]+","+s[2]+","+s[3]+")",e.closePath(),e.fill(),e.beginPath(),e.moveTo(t[0].vec.x,t[0].vec.y),i=1;i<t.length;++i)e.lineTo(t[i].vec.x,t[i].vec.y);e.closePath(),e.stroke()},e}(),Qi=function(){function e(e){this.shape=e}return e.prototype.nodeMidHover=function(e,t,n,o,i,s,r){void 0===r&&(r=!1),r?(e.lineWidth=t.lineWidth,e.fillStyle=t.colorFill,e.strokeStyle=t.colorStroke,e.beginPath(),s<.1?e.arc(n,o,(Math.abs(this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.node.sizeMid)+3)*i,0,2*Math.PI,!1):e.arc(n,o,Math.abs(this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.node.sizeMid+3)*i*s,0,2*Math.PI,!1)):(e.lineWidth=t.lineWidth,e.fillStyle=t.colorStroke,e.strokeStyle=t.colorStrokeHover,e.beginPath(),s<.1?e.arc(n,o,(Math.abs(this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.node.sizeMid)+1)*i,0,2*Math.PI,!1):e.arc(n,o,Math.abs(this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.node.sizeMid)*i*s,0,2*Math.PI,!1)),e.closePath(),e.fill(),e.stroke()},e.prototype.nodeMidHoverForArrow=function(e,t,n,o,i,r,a,h){if(void 0===a&&(a=!1),e.beginPath(),e.lineWidth=t.lineWidth,a)return e.fillStyle=t.colorFill,i<.1?e.arc(n,o,r,0,2*Math.PI,!1):e.arc(n,o,r*i,0,2*Math.PI,!1),e.fill(),void e.closePath();if(e.fillStyle=t.colorStroke,e.strokeStyle=t.colorStrokeHover,h===s.BackgroundColor){var c=+t.colorStroke.split(",")[1];e.strokeStyle=c<50?"rgba(255, 255, 255, 0.5)":"rgba(0, 0, 0, 0.5)"}i<.1?e.arc(n,o,r,0,2*Math.PI,!1):e.arc(n,o,r*i,0,2*Math.PI,!1),e.closePath(),e.fill(),e.stroke()},e.prototype.nodeMidStart=function(e,t,n,o,i){e.lineWidth=t.lineWidth,e.fillStyle=t.colorStroke,e.beginPath(),i<.1?e.arc(n,o,Math.abs(this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.node.sizeMid),0,2*Math.PI,!1):e.arc(n,o,Math.abs(this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.node.sizeMid*i),0,2*Math.PI,!1),e.closePath(),e.fill()},e.prototype.nodeHover=function(e,t,n,o,i,s){e.lineWidth=t.lineWidth,e.strokeStyle=t.colorStroke,e.fillStyle=t.colorFill,e.beginPath(),e.arc(n,o,(Math.abs(this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.node.size)+1)*i,0,2*Math.PI,!1),e.closePath(),e.fill(),e.stroke()},e.prototype.node=function(e,t,n,o,i){e.lineWidth=t.lineWidth,e.strokeStyle=t.colorStroke,e.fillStyle=t.colorFill,e.beginPath(),e.arc(n,o,(this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.node.size+1)*i,0,2*Math.PI,!1),e.closePath(),e.fill(),e.stroke()},e.prototype.nodeSelected=function(e,t,n,o,i){e.lineWidth=t.lineWidth,e.strokeStyle=t.colorStroke,e.fillStyle=t.colorFill,e.beginPath(),e.arc(n,o,(this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.node.size+2)*i,0,2*Math.PI,!1),e.closePath(),e.fill(),e.stroke()},e.prototype.nodeStart=function(e,t,n,o,i,r,a){if(e.lineWidth=t.lineWidth,e.fillStyle=t.colorFill,e.strokeStyle=t.colorStroke,a===s.BackgroundColor){var h=+t.colorStroke.split(",")[1];e.strokeStyle=h<50?"rgba(255, 255, 255, 0.5)":"rgba(0, 0, 0, 0.5)"}e.beginPath(),r<.1?e.arc(n,o,Math.abs(this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.node.size+1)*i,0,2*Math.PI,!1):e.arc(n,o,Math.abs(this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.node.size+1)*i*r,0,2*Math.PI,!1),e.fill(),e.stroke()},e}(),Zi=function(){function e(e){this.shape=e}return e.prototype.pointRegularOverBoundingBySVGPath=function(e,t,n,o,i,s,a,h,c,p,l){void 0===s&&(s=1),void 0===a&&(a=!0),void 0===h&&(h=!1);var d=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.pointBoundOffset;if(this.shape.draw.renderer.hasAni||(a=!1),a?d*=s:d-=d*s,h){e.lineWidth=.5+s*t.lineWidth*t.scaleGlobal*t.scaleLocal*this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.elasticScale;var u=n-.5*this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.width+6,y=o-this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.height+0;if(this.shape.draw.renderer.imageAnnoApp.implementations.app.model.appCoreWrapper.browserUtility.type===r.Aq.Edge)return void this.pointRegularOverBoundingBySVGPathEdgeSupport(e,t,u,y);var m=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.width,v=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.height,g=.25*m;e.save(),e.translate(u+1.25*(g-g*i),y+(v-v*i)),e.scale(i,i),e.strokeStyle=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.outlineHoverColorRGBAString,this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG&&e.stroke(this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG.path2D),e.restore()}},e.prototype.pointRegularOverBoundingBySVGPathSelected=function(e,t,n,o,i,s,a,h,c,p,l){void 0===s&&(s=1),void 0===a&&(a=!0),void 0===h&&(h=!1);var d=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.pointBoundOffset;if(this.shape.draw.renderer.hasAni||(a=!1),a?d*=s:d-=d*s,h){e.lineWidth=.5+s*t.lineWidth*t.scaleGlobal*t.scaleLocal*this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.elasticScale;var u=n-.5*this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.width+6,y=o-this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.height+0;if(this.shape.draw.renderer.imageAnnoApp.implementations.app.model.appCoreWrapper.browserUtility.type===r.Aq.Edge)return void this.pointRegularOverBoundingBySVGPathEdgeSupport(e,t,u,y);e.save(),e.translate(u-1.5,y-1.75),e.scale(1.2,1.125),e.strokeStyle=t.colorInterpolatedString,this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG&&e.stroke(this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG.path2D),e.restore(),e.save(),e.translate(u,y),e.strokeStyle=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.outlineHoverColorRGBAString,this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG&&e.stroke(this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG.path2D),e.restore()}},e.prototype.pointRegularDragBySVGPath=function(e,t,n,o,i,s,a,h,c,p,l,d,u){void 0===s&&(s=1),void 0===a&&(a=!0),void 0===h&&(h=!1);var y=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.pointBoundOffset;if(this.shape.draw.renderer.hasAni||(a=!1,s=1),a?y*=s:y-=y*s,o-=1.8*y,h){var m=2.5*y;m<0&&(m=0)}this.shape.draw.renderer.imageAnnoApp.implementations.app.model.appCoreWrapper.browserUtility.type!==r.Aq.Edge?this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG&&this.pointRagularSVGRender(e,t,n-.5*this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.width+6,o-this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.height+0,i,d,u):this.pointRagularSVGRenderEdgeSupport(e,t,n-.5*this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.width+6,o-this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.height+0,d,u)},e.prototype.pointRagularSVGRender=function(e,t,n,o,i,s,r,a){void 0===a&&(a=!1);var h=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.width,c=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.height;this.shape.draw.renderer.needFocus,e.fillStyle=t.colorInterpolatedString,r&&(e.fillStyle=t.colorInterpolatedString);var p=.25*h;e.save(),e.translate(n+1.25*(p-p*i),o+(c-c*i)),e.scale(i,i),e.strokeStyle=t.colorStroke,e.fill(this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG.path2D,"evenodd"),e.lineWidth=0,a&&e.stroke(this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG.path2D),e.restore()},e.prototype.pointRegularDragGhost=function(e,t,n,o,i,s,a,h,c,p){var l=this;if(void 0===i&&(i=1),void 0===s&&(s=!0),void 0===a&&(a=!1),this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG){var d=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.pointBoundOffset;if(s?d*=i:d-=d*i,e.fillStyle=(0,r.Wo)(r.$C.Black,.3),e.beginPath(),s?e.ellipse(n,o,7,2.5,0,0,2*Math.PI,!1):e.ellipse(n,o+2,4,2,0,0,2*Math.PI,!1),e.closePath(),e.fill(),o-=1.8*d,a){var u=2.5*d;u<0&&(u=0),e.strokeStyle=t.colorStroke,e.lineWidth=t.lineWidth*t.scaleGlobal*t.scaleLocal,e.beginPath(),e.arc(n,o-.5*this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.height,u,0,2*Math.PI,!1),e.closePath(),e.fill(),e.stroke()}this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG&&(e.save(),e.translate(n-.5*this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.width,o-this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.height),e.beginPath(),Object.keys(this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG.path).map((function(t){var n=l.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG.path[t];if(n){var o=t.split(" ")[1];"M"===o?e.moveTo(n[0],n[1]):"C"===o?e.bezierCurveTo(n[0],n[1],n[2],n[3],n[4],n[5]):"L"===o&&e.lineTo(n[0],n[1])}})),p||(e.fillStyle=(0,r.Z3)("#888888",c-.8)),e.closePath(),e.fill(),e.restore())}},e.prototype.pointNumberedOverBoundingByCircleSelected=function(e,t,n,o,i,s,r,a,h,c){void 0===s&&(s=1),void 0===r&&(r=!0),void 0===a&&(a=!1);var p=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.nPoint.height,l=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.pointBoundOffset;if(r?l*=s:l-=l*s,e.fillStyle=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.outlineHoverColorRGBAString,a){var d=p*i*.5+.75*s*this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.elasticScale;d<0&&(d=0),e.beginPath(),e.arc(n,o-p*i*.5,d,0,2*Math.PI,!1),e.closePath(),e.fill(),e.strokeStyle=t.colorFill,e.lineWidth=2.5,e.beginPath(),e.arc(n,o-p*i*.5,d+1,0,2*Math.PI,!1),e.closePath(),e.stroke()}},e.prototype.pointNumberedOverBoundingByCircle=function(e,t,n,o,i,s,r,a,h,c){void 0===s&&(s=1),void 0===r&&(r=!0),void 0===a&&(a=!1);var p=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.nPoint.height,l=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.pointBoundOffset;if(r?l*=s:l-=l*s,e.fillStyle=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.outlineHoverColorRGBAString,a){var d=p*i*.5+.75*s*this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.elasticScale;d<0&&(d=0),e.beginPath(),e.arc(n,o-p*i*.5,d,0,2*Math.PI,!1),e.closePath(),e.fill()}},e.prototype.pointNumberedDragByCircle=function(e,t,n,o,i,s,r,a,h,c,p,l){void 0===s&&(s=1),void 0===r&&(r=!0),void 0===a&&(a=!1);var d=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.nPoint.height*i,u=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.nPoint.scale;this.shape.draw.renderer.hasAni||(r=!1,s=1);var y=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.pointBoundOffset;if(r?y*=s:y-=y*s,o-=1.8*y,e.strokeStyle=t.colorStroke,e.fillStyle=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.outlineHoverColorRGBAString,a){var m=3.5*u*y;m<0&&(m=0),e.beginPath(),e.arc(n,o-.5*d,m,0,2*Math.PI,!1),e.closePath(),e.fill()}this.shape.draw.renderer.needFocus,e.fillStyle=t.colorInterpolatedString,l&&(e.fillStyle=t.colorInterpolatedString),e.beginPath(),e.arc(n,o-.5*d,.5*d,0,2*Math.PI),e.closePath(),e.fill()},e.prototype.pointNumberedDragByCircleGhost=function(e,t,n,o,i,s,a,h,c,p,l,d){void 0===i&&(i=1),void 0===s&&(s=!0),void 0===a&&(a=!1);var u=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.nPoint.height;this.shape.draw.renderer.hasAni||(s=!1,i=1);var y=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.pointBoundOffset;if(s?y*=i:y-=y*i,e.fillStyle=(0,r.Wo)(r.$C.Black,.3),s&&(e.beginPath(),e.ellipse(n,o,7,2.5,0,0,2*Math.PI,!1),e.closePath(),e.fill()),o-=1.8*y,e.strokeStyle=t.colorStroke,e.fillStyle=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.outlineHoverColorRGBAString,a){var m=2.5*this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.nPoint.scale*y;m<0&&(m=0),e.beginPath(),e.arc(n,o-.5*u+2,m,0,2*Math.PI,!1),e.closePath(),e.fill()}this.shape.draw.renderer.needFocus,e.fillStyle=t.colorInterpolatedString,d&&(e.fillStyle=t.colorInterpolatedString),e.beginPath(),e.arc(n,o-.5*u+2,.5*u,0,2*Math.PI),e.closePath(),e.fill();var v=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.nPoint.fontSize+"px "+this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.nPoint.fontFamily;e.font=v;var g=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.nPoint.fontColorArray;e.fillStyle=l||d?"rgba("+g[0]+", "+g[1]+", "+g[2]+", "+g[3]+")":"rgba("+g[0]+", "+g[1]+", "+g[2]+", "+(g[3]-.3)+")",e.textAlign="center",e.fillText(p.toString(),n,o-.5*u+6)},e.prototype.pointIcon=function(e,t,n,o,i,s,r,a,h,c,p,l){void 0===p&&(p=!1),void 0===l&&(l=1),e.globalAlpha=c,e.fillStyle=t.colorFill;var d=10*l,u=.5*i+d,y=.5*s+d,m=.5*u,v=.5*y;e.drawImage(r,n-m,o-v,u,y)},e.prototype.centerPoint=function(e,t,n){e.beginPath(),e.arc(t,n,1,0,2*Math.PI,!1),e.closePath(),e.fillStyle="black",e.fill()},e.prototype.centerPointCircle=function(e,t,n){e.lineWidth=1,e.strokeStyle="#001c1b",e.beginPath(),e.moveTo(t,n-4.5),e.lineTo(t,n+4.5),e.moveTo(t-4.5,n),e.lineTo(t+4.5,n),e.stroke()},e.prototype.pointRagularSVGRenderEdgeSupport=function(e,t,n,o,i,s,r){if(void 0===r&&(r=!1),e.save(),e.translate(n,o),this.shape.draw.renderer.needFocus,e.fillStyle=t.colorInterpolatedString,s&&(e.fillStyle=t.colorInterpolatedString),e.strokeStyle=t.colorStroke,e.lineWidth=0,this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG&&this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG.path){var a=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG.path;e.beginPath(),Object.keys(a).map((function(t){var n=a[t];if(n){var o=t.split(" ")[1];"M"===o?e.moveTo(n[0],n[1]):"C"===o?e.bezierCurveTo(n[0],n[1],n[2],n[3],n[4],n[5]):"L"===o&&e.lineTo(n[0],n[1])}})),e.closePath(),e.fill()}e.restore()},e.prototype.pointRegularOverBoundingBySVGPathEdgeSupport=function(e,t,n,o){e.save(),e.translate(n,o),e.strokeStyle=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.outlineHoverColorRGBAString;var i=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG.path;e.beginPath(),Object.keys(i).map((function(t){var n=i[t];if(n){var o=t.split(" ")[1];"M"===o?e.moveTo(n[0],n[1]):"C"===o?e.bezierCurveTo(n[0],n[1],n[2],n[3],n[4],n[5]):"L"===o&&e.lineTo(n[0],n[1])}})),e.closePath(),e.stroke(),e.restore()},e.prototype.shadowRPoint=function(e,t,n,o,i,s){this.shape.draw.renderer.imageAnnoApp.implementations.app.model.appCoreWrapper.browserUtility.type!==r.Aq.Safari&&this.shape.draw.renderer.imageAnnoApp.implementations.app.model.appCoreWrapper.browserUtility.type!==r.Aq.Edge&&(e.beginPath(),e.ellipse(n,o+5,10,2.5,0,0,2*Math.PI,!1),e.closePath(),e.fillStyle=i||s?this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.shadowColorHover:this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.shadowColor,e.filter="blur("+this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.shadowBlur+"px)",e.fill(),e.filter="none")},e.prototype.shadowRPointLight=function(e,t,n,o,i,s,a){this.shape.draw.renderer.imageAnnoApp.implementations.app.model.appCoreWrapper.browserUtility.type!==r.Aq.Safari&&this.shape.draw.renderer.imageAnnoApp.implementations.app.model.appCoreWrapper.browserUtility.type!==r.Aq.Edge&&(e.beginPath(),e.ellipse(n,o+5,10,2.5,0,0,2*Math.PI,!1),e.closePath(),e.fillStyle=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.shadowColor,e.filter="blur("+this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.shadowBlur+"px)",e.fill(),e.filter="none")},e.prototype.shadowNPoint=function(e,t,n,o,i,s,a){this.shape.draw.renderer.imageAnnoApp.implementations.app.model.appCoreWrapper.browserUtility.type!==r.Aq.Safari&&this.shape.draw.renderer.imageAnnoApp.implementations.app.model.appCoreWrapper.browserUtility.type!==r.Aq.Edge&&(e.beginPath(),e.ellipse(n,o+5,10*i,2.5,0,0,2*Math.PI,!1),e.closePath(),e.fillStyle=s||a?this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.nPoint.shadowColorHover:this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.nPoint.shadowColor,e.filter="blur("+this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.nPoint.shadowBlur+"px)",e.fill(),e.filter="none")},e.prototype.shadowNPointLight=function(e,t,n,o,i,s,a){this.shape.draw.renderer.imageAnnoApp.implementations.app.model.appCoreWrapper.browserUtility.type!==r.Aq.Safari&&this.shape.draw.renderer.imageAnnoApp.implementations.app.model.appCoreWrapper.browserUtility.type!==r.Aq.Edge&&(e.beginPath(),e.ellipse(n,o+5,10*i,2.5,0,0,2*Math.PI,!1),e.closePath(),e.fillStyle=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.nPoint.shadowColor,e.filter="blur("+this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.nPoint.shadowBlur+"px)",e.fill(),e.filter="none")},e}(),es=function(){function e(e){this.shape=e}return e.prototype.pointGenericDrag=function(e,t,n,o,i,s,a,h,c,p,l,d,u,y){void 0===a&&(a=1),void 0===h&&(h=!0),void 0===c&&(c=!1);var m=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.pointBoundOffset;if(this.shape.draw.renderer.hasAni||(h=!1,a=1),h?m*=a:m-=m*a,i-=1.8*m,c){var v=2.5*m;v<0&&(v=0)}this.shape.draw.renderer.imageAnnoApp.implementations.app.model.appCoreWrapper.browserUtility.type!==r.Aq.Edge?this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG&&this.pointRegularSVGRender(e,t,n,o,i,s,u,y):this.pointRegularSVGRenderEdgeSupport(e,t,n,o-.25*n.width*s,i-n.height+0,u,y)},e.prototype.pointRegularSVGRender=function(e,t,n,o,i,s,a,h,c){void 0===c&&(c=!1);var p=n.width,l=n.height,d=.25*p*s;switch(this.shape.draw.renderer.needFocus,e.fillStyle=n.colorInterpolatedString,h&&(e.fillStyle=n.colorInterpolatedString),e.save(),e.translate(o-d,i-l*s),e.scale(s,s),e.strokeStyle=n.colorStroke,t){case r.oW.RpointA:e.fill(this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG.path2D,"evenodd"),e.lineWidth=0,c&&e.stroke(this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG.path2D);break;case r.oW.Image:this.getIconByURL(n.url)&&this.pointIcon(e,n,0,0,32,32,this.getIconByURL(n.url),!1,!1,1,a,h)}e.restore()},e.prototype.pointIcon=function(e,t,n,o,i,s,r,a,h,c,p,l,d,u){void 0===p&&(p=!1),void 0===l&&(l=!1),void 0===d&&(d=!1),void 0===u&&(u=1),e.globalAlpha=c,e.fillStyle=t.colorFill,p||l||(e.globalAlpha=t.interpolationNum),e.drawImage(r,n,o,i,s),e.globalAlpha=1},e.prototype.pointIconHover=function(e,t,n,o,i,s,a,h,c,p,l,d){void 0===l&&(l=!1),void 0===d&&(d=1),e.lineWidth=.75,e.beginPath(),e.rect(n-1,o-1,i+2,s+2),e.closePath(),e.strokeStyle=r.$C.Black,e.stroke(),e.beginPath(),e.rect(n,o,i,s),e.closePath(),e.strokeStyle=r.$C.White,e.stroke()},e.prototype.pointIconSelected=function(e,t,n,o,i,s,a,h,c,p,l,d){void 0===l&&(l=!1),void 0===d&&(d=1),t.size===r.$u.SMALL?(e.lineWidth=.75,e.beginPath(),e.rect(n-5,o-12,i+10,s+12),e.closePath(),e.strokeStyle=r.$C.Black,e.stroke(),e.beginPath(),e.rect(n-4,o-11,i+8,s+10),e.closePath(),e.strokeStyle=r.$C.White,e.stroke()):(e.lineWidth=.5,e.beginPath(),e.rect(n-3,o-7,i+6,s+8),e.closePath(),e.strokeStyle=r.$C.Black,e.stroke(),e.beginPath(),e.rect(n-2,o-6,i+4,s+6),e.closePath(),e.strokeStyle=r.$C.White,e.stroke())},e.prototype.pointGenericOverBoundingSelected=function(e,t,n,o,i,s,a,h,c,p,l,d){void 0===a&&(a=1),void 0===h&&(h=!0),void 0===c&&(c=!1);var u=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.pointBoundOffset,y=n.height;if(this.shape.draw.renderer.hasAni||(h=!1),h?u*=a:u-=u*a,c){e.lineWidth=.5+a*n.lineWidth*this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.elasticScale;var m=o-.25*n.width*s,v=i-n.height*s;if(this.shape.draw.renderer.imageAnnoApp.implementations.app.model.appCoreWrapper.browserUtility.type===r.Aq.Edge)return void this.pointRegularOverBoundingBySVGPathEdgeSupport(e,n,m,v);if(e.save(),e.translate(m,i-y*s),e.scale(s,s),e.lineWidth=5,e.strokeStyle=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.outlineHoverColorRGBAString,this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG)switch(t){case r.oW.RpointA:e.stroke(this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG.path2D);break;case r.oW.Image:this.pointIconSelected(e,n,m,v,32,32,this.getIconByURL(n.url),!1,!1,1)}e.restore()}},e.prototype.pointGenericOverBounding=function(e,t,n,o,i,s,a,h,c,p,l,d){void 0===a&&(a=1),void 0===h&&(h=!0),void 0===c&&(c=!1);var u=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.pointBoundOffset;if(this.shape.draw.renderer.hasAni||(h=!1),h?u*=a:u-=u*a,c){e.lineWidth=.5+a*n.lineWidth*this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.elasticScale*2;var y=o-.25*n.width*s,m=i-n.height+0;if(this.shape.draw.renderer.imageAnnoApp.implementations.app.model.appCoreWrapper.browserUtility.type===r.Aq.Edge)return void this.pointRegularOverBoundingBySVGPathEdgeSupport(e,n,y,m);var v=n.width,g=n.height,f=.25*v*s;switch(e.save(),e.translate(o-f,i-g*s),e.scale(s,s),e.strokeStyle=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.outlineHoverColorRGBAString,t){case r.oW.RpointA:this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG&&e.stroke(this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG.path2D);break;case r.oW.Image:this.pointIconHover(e,n,0,0,32,32,this.getIconByURL(n.url),!1,!1,1)}e.restore()}},e.prototype.pointRegularSVGRenderEdgeSupport=function(e,t,n,o,i,s,a,h){switch(void 0===h&&(h=!1),e.save(),e.translate(o,i),this.shape.draw.renderer.needFocus,e.fillStyle=n.colorInterpolatedString,a&&(e.fillStyle=n.colorInterpolatedString),e.strokeStyle=n.colorStroke,e.lineWidth=0,t){case r.oW.RpointA:if(this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG&&this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG.path){var c=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG.path;e.beginPath(),Object.keys(c).map((function(t){var n=c[t];if(n){var o=t.split(" ")[1];"M"===o?e.moveTo(n[0],n[1]):"C"===o?e.bezierCurveTo(n[0],n[1],n[2],n[3],n[4],n[5]):"L"===o&&e.lineTo(n[0],n[1])}})),e.closePath(),e.fill()}case r.oW.Image:}e.restore()},e.prototype.pointRegularOverBoundingBySVGPathEdgeSupport=function(e,t,n,o){e.save(),e.translate(n,o),e.strokeStyle=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.outlineHoverColorRGBAString;var i=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG.path;e.beginPath(),Object.keys(i).map((function(t){var n=i[t];if(n){var o=t.split(" ")[1];"M"===o?e.moveTo(n[0],n[1]):"C"===o?e.bezierCurveTo(n[0],n[1],n[2],n[3],n[4],n[5]):"L"===o&&e.lineTo(n[0],n[1])}})),e.closePath(),e.stroke(),e.restore()},e.prototype.getIconByURL=function(e){return this.shape.draw.renderer.imageAnnoApp.customization.iconAsset.getIconByURL(e)},e}(),ts=function(){function e(e){this.shape=e}return e.prototype.pointSVGNormalFill=function(e,t,n,o,i,s,r,a,h,c,p,l,d,u,y){void 0===r&&(r=1),void 0===a&&(a=!0),void 0===h&&(h=!1),void 0===y&&(y=!1),this.pointSVGRender(e,t,n,o,i,s,d,u,y)},e.prototype.pointSVGRender=function(e,t,n,o,i,s,r,a,h,c){void 0===h&&(h=!1),void 0===c&&(c=1);var p=n.width,l=n.height,d=.365*p*s;this.shape.draw.renderer.needFocus,e.fillStyle=n.colorInterpolatedString,a&&(e.fillStyle=n.colorInterpolatedString),e.save(),e.translate(o-d,i-l*s),e.scale(s,s),e.strokeStyle=n.colorStroke,h&&(e.lineWidth=4*c,e.strokeStyle="#ffffff",e.stroke(t)),e.fill(t,"evenodd"),e.restore()},e.prototype.pointIcon=function(e,t,n,o,i,s,r,a,h,c,p,l,d,u){void 0===p&&(p=!1),void 0===l&&(l=!1),void 0===d&&(d=!1),void 0===u&&(u=1),e.globalAlpha=c,e.fillStyle=t.colorFill,p||l||(e.globalAlpha=t.interpolationNum),e.drawImage(r,n,o,i,s),e.globalAlpha=1},e.prototype.pointIconHover=function(e,t,n,o,i,s,a,h,c,p,l,d){void 0===l&&(l=!1),void 0===d&&(d=1),e.lineWidth=.75,e.beginPath(),e.rect(n-1,o-1,i+2,s+2),e.closePath(),e.strokeStyle=r.$C.Black,e.stroke(),e.beginPath(),e.rect(n,o,i,s),e.closePath(),e.strokeStyle=r.$C.White,e.stroke()},e.prototype.pointIconSelected=function(e,t,n,o,i,s,a,h,c,p,l,d){void 0===l&&(l=!1),void 0===d&&(d=1),t.size===r.$u.SMALL?(e.lineWidth=.75,e.beginPath(),e.rect(n-5,o-12,i+10,s+12),e.closePath(),e.strokeStyle=r.$C.Black,e.stroke(),e.beginPath(),e.rect(n-4,o-11,i+8,s+10),e.closePath(),e.strokeStyle=r.$C.White,e.stroke()):(e.lineWidth=.5,e.beginPath(),e.rect(n-3,o-7,i+6,s+8),e.closePath(),e.strokeStyle=r.$C.Black,e.stroke(),e.beginPath(),e.rect(n-2,o-6,i+4,s+6),e.closePath(),e.strokeStyle=r.$C.White,e.stroke())},e.prototype.pointGenericOverBoundingSelected=function(e,t,n,o,i,s,a,h,c,p,l,d){void 0===a&&(a=1),void 0===h&&(h=!0),void 0===c&&(c=!1);var u=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.pointBoundOffset,y=n.width,m=n.height,v=.5*y*s;if(this.shape.draw.renderer.hasAni||(h=!1),h?u*=a:u-=u*a,c){if(e.lineWidth=.5+a*n.lineWidth*n.scaleGlobal*n.scaleLocal*this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.elasticScale,e.save(),e.translate(o-v,i-m*s),e.scale(s,s),e.lineWidth=7,e.strokeStyle=n.colorInterpolatedString,this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG)switch(t){case r.oW.RpointA:e.stroke(this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG.path2D);break;case r.oW.Image:this.pointIconSelected(e,n,0,0,32,32,this.getIconByURL(n.url),!1,!1,1)}if(e.lineWidth=3,e.strokeStyle=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.outlineHoverColorRGBAString,this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG)switch(t){case r.oW.RpointA:e.stroke(this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG.path2D);break;case r.oW.Image:this.pointIconSelected(e,n,0,0,32,32,this.getIconByURL(n.url),!1,!1,1)}e.restore()}},e.prototype.pointGenericOverBounding=function(e,t,n,o,i,s,a,h,c,p,l,d){void 0===a&&(a=1),void 0===h&&(h=!0),void 0===c&&(c=!1);var u=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.pointBoundOffset;if(this.shape.draw.renderer.hasAni||(h=!1),h?u*=a:u-=u*a,c){e.lineWidth=.5+a*n.lineWidth*n.scaleGlobal*n.scaleLocal*this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.elasticScale*2;var y=n.width,m=n.height,v=.5*y*s;switch(e.save(),e.translate(o-v,i-m*s),e.scale(s,s),e.strokeStyle=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.outlineHoverColorRGBAString,t){case r.oW.RpointA:this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG&&e.stroke(this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.rPoint.SVG.path2D);break;case r.oW.Image:this.pointIconHover(e,n,0,0,32,32,this.getIconByURL(n.url),!1,!1,1)}e.restore()}},e.prototype.pointNumberedOverBoundingByCircle=function(e,t,n,o,i,s,r,a,h,c,p){void 0===r&&(r=1),void 0===a&&(a=!0),void 0===h&&(h=!1);var l=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.nPoint.height,d=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.pointBoundOffset;if(a?d*=r:d-=d*r,e.fillStyle=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.outlineHoverColorRGBAString,h){var u=l*s*.5+.75*r*this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.properties.elasticScale;u<0&&(u=0),e.fill(t)}},e.prototype.getIconByURL=function(e){return this.shape.draw.renderer.imageAnnoApp.customization.iconAsset.getIconByURL(e)},e}(),ns=function(){function e(e){this.shape=e}return e.prototype.edgePolylineLineTo=function(e,t,n,o,i,s,r,a,h,c,p,l){void 0===r&&(r=!1),void 0===a&&(a=!1),void 0===h&&(h=1),void 0===c&&(c=1),e.lineTo(n,o),e.lineTo(i,s)},e.prototype.edgePolyline=function(e,t,n,o,i,s,r,a,h,c,p,l){void 0===r&&(r=!1),void 0===a&&(a=!1),void 0===h&&(h=1),void 0===c&&(c=1),e.moveTo(n,o),e.lineTo(i,s)},e.prototype.curveQuadratic=function(e,t,n,o,i,s,r,a,h,c){void 0===h&&(h=!1),e.moveTo(n,o),e.quadraticCurveTo(i,s,r,a)},e}(),os=function(){function e(e){this.shape=e}return e.prototype.selectionLasso=function(e,t,n,o){void 0===n&&(n=!1),void 0===o&&(o=0),e.globalCompositeOperation=r.ew.ColorDodge,e.lineWidth=1,e.lineDashOffset=-o;var i=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.selection.strokeStyleFirstArray;e.strokeStyle="rgba("+i[0]+", "+i[1]+", "+i[2]+", 0.9)",i=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.selection.fillStyleFirstArray,e.fillStyle="rgba("+i[0]+", "+i[1]+", "+i[2]+", 0.3)",e.setLineDash([4,4]),e.beginPath(),e.setLineDash([5,4]),e.moveTo(t[0].x,t[0].y);for(var s=1;s<t.length;++s)e.lineTo(t[s].x,t[s].y);e.closePath(),e.fill(),e.stroke(),e.setLineDash([]),e.globalCompositeOperation=r.ew.SourceOver},e.prototype.selection=function(e,t,n,o,i){void 0===o&&(o=!1),void 0===i&&(i=0),e.globalCompositeOperation=r.ew.ColorDodge,e.lineWidth=1,e.lineDashOffset=-i;var s=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.selection.strokeStyleFirstArray;e.strokeStyle="rgba("+s[0]+", "+s[1]+", "+s[2]+", 0.9)",s=this.shape.draw.renderer.imageAnnoApp.customization.themeCurrent.selection.fillStyleFirstArray,e.fillStyle="rgba("+s[0]+", "+s[1]+", "+s[2]+", 0.3)",o?e.setLineDash([4,4]):e.setLineDash([5,4]),e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(t.x,n.y),e.lineTo(n.x,n.y),e.lineTo(n.x,t.y),e.closePath(),e.fill(),e.stroke(),e.setLineDash([]),e.globalCompositeOperation=r.ew.SourceOver},e}(),is=function(){function e(e){this.shape=e}return e.prototype.circleBG=function(e,t,n,o,i){void 0===i&&(i=1);var s=this.shape.draw.renderer.imageAnnoApp.activeCommandController.activeColorController.activeColor;e.strokeStyle="rgba("+s[0]+", "+s[1]+", "+s[2]+", 0.9)",e.fillStyle="rgba("+s[0]+", "+s[1]+", "+s[2]+", 0.3)";var r=o+1*i;r<0&&(r=0),e.beginPath(),e.arc(t,n,r,0,2*Math.PI,!1),e.closePath(),e.fill()},e}(),ss=function(){function e(e){this.needResetDash=!1,this.shape=e}return e.prototype.roundedRectACTextStoryMapByWidth=function(e,t,n,o,i,a,h,c,p,l){void 0===h&&(h=0),void 0===c&&(c=0),e.beginPath(),e.rect(n.x,n.y,o,i),e.closePath();var d=t.styleBox.fillStyle;e.fillStyle="rgba("+d[0]+", "+d[1]+", "+d[2]+", 1)",l&&(e.fillStyle="rgba("+d[0]+", "+d[1]+", "+d[2]+", 1)"),t.state.textColor===s.BackgroundColor||t.state.textColor===s.TitleColor?(e.shadowBlur=15,e.shadowColor="rgba(0,0,0,0.05)",e.fill(),e.shadowBlur=0):(this.shape.draw.renderer.imageAnnoApp.implementations.app.param.interactionMode===r.An.Drawing&&(e.strokeStyle="rgba("+t.styleLeaderline.strokeStyle[0]+", "+t.styleLeaderline.strokeStyle[1]+", "+t.styleLeaderline.strokeStyle[2]+", 1)",(l||p)&&(e.lineWidth=t.styleBox.lineWidth,e.setLineDash([4,4]),e.stroke())),e.setLineDash([]))},e.prototype.renderNodeDia=function(e,t,n,o,i,s){e.beginPath(),e.moveTo(n+i,o),e.lineTo(n,o+s),e.lineTo(n-i,o),e.lineTo(n,o-s),e.closePath(),e.lineWidth=t.styleHandleNode.lineWidth,e.strokeStyle="rgba("+t.styleHandleNode.strokeStyle[0]+", "+t.styleHandleNode.strokeStyle[1]+", "+t.styleHandleNode.strokeStyle[2]+", "+t.styleHandleNode.strokeStyle[3]+")",e.fillStyle="rgba("+t.styleHandleNode.fillStyle[0]+", "+t.styleHandleNode.fillStyle[1]+", "+t.styleHandleNode.fillStyle[2]+", "+t.styleHandleNode.fillStyle[3]+")",e.fill(),e.stroke()},e.prototype.renderLeaderLine=function(e,t,n,o,i,s,r,a,h){var c=t.styleLeaderline.strokeStyle,p="rgba("+c[0]+", "+c[1]+", "+c[2]+", "+c[3]+")";e.lineDashOffset=0,e.beginPath(),e.moveTo(n.x,n.y),e.lineTo(o.x,o.y),e.lineTo(i.x,i.y),e.setLineDash(t.styleLeaderline.dash),this.needResetDash=!0,e.strokeStyle=p,e.lineWidth=t.styleLeaderline.lineWidth,e.stroke(),e.setLineDash([]),(a||h)&&(e.beginPath(),e.arc(i.x,i.y,7,0,6.28),e.closePath(),e.strokeStyle="rgba("+t.styleAnchorNode.strokeStyle[0]+", "+t.styleAnchorNode.strokeStyle[1]+", "+t.styleAnchorNode.strokeStyle[2]+", "+t.styleAnchorNode.strokeStyle[3]+")",e.fillStyle="rgba("+t.styleAnchorNode.fillStyle[0]+", "+t.styleAnchorNode.fillStyle[1]+", "+t.styleAnchorNode.fillStyle[2]+", "+t.styleAnchorNode.fillStyle[3]+")",e.lineWidth=t.styleAnchorNode.lineWidth,e.fill(),e.stroke())},e}(),rs=function(e){this.draw=e,this.point=new Zi(this),this.pointGeneric=new es(this),this.pointSVG=new ts(this),this.node=new Qi(this),this.cluster=new Ji(this),this.line=new Ki(this),this.ngon=new $i(this),this.area=new qi(this),this.text=new ss(this),this.curve=new Yi(this),this.polyline=new ns(this),this.selection=new os(this),this.freeHand=new Xi(this),this.snapping=new is(this)},as=function(){function e(e){this.renderer=e,this.init()}return e.prototype.init=function(){this.shape=new rs(this),this.image=new ji(this)},e}(),hs=function(){function e(e,t,n){void 0===n&&(n=60),this.debugText=0,this.isFetchTheme=!1,this.unHover=!1,this.hasAni=!1,this.frameValue=0,this.frameUpdateValue=0,this.frameSkipValue=2,this._updateProjectionForce=!0,this._needFocus=!1,this.index=0,this.imageAnnoApp=e,this.numericalMotion=new r.aX,this.t=0,this.hasAni=t,this.frameRate=n,this.needBlackhole=!1,this.env=new Fi(this),this.objectSnapping=new di(this),this.draw=new as(this),this.offscreen=new Ui(this),this.imageAnnoApp.implementations.app.model.appCoreWrapper.appProperties.compileMode!==r.ct.Production&&this.development(),this.selection=new Se(this.imageAnnoApp.scene),this.needBlackhole&&(this.blackhole=new ci(this.imageAnnoApp.scene))}return e.prototype.initPost=function(){this.canvasOff(),this.bindContextForOffscreen(),this.optimizer=new Hi(this)},Object.defineProperty(e.prototype,"needFocus",{get:function(){return this._needFocus},set:function(e){this._needFocus=!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dt",{get:function(){return this.imageAnnoApp.graphicsCoreWrapper.canvasWrapper.aCanvas.deltaTime.dt},enumerable:!1,configurable:!0}),e.prototype.bindContextForOffscreen=function(){this.ctxOffscreen=this.imageAnnoApp.graphicsCoreWrapper.canvasWrapper.aCanvasOffScreen.offScreenCtx},e.prototype.development=function(){},e.prototype.canvasOff=function(){this.xOff=0,this.yOff=0,this.xOffCurrent=0,this.yOffCurrent=0,this.xOffPre=0,this.yOffPre=0,this.zoomFactor=0,this.zoomFactorPre=0,this.zoomFactorCurrent=0,this.anchor=new r.h9(0,0,0)},e.prototype.saveDrawingGeometries=function(){var e=new Map;for(this.index=this.imageAnnoApp.scene.geometryList.length;this.index--;){var t=this.imageAnnoApp.scene.geometryList[this.index].toJSON();void 0!==t&&e.set(this.imageAnnoApp.scene.geometryList[this.index].id,t)}return e},e.prototype.Init=function(){},e.prototype.render=function(e){this.updatePre(),this.renderPre(e),console.log("rendering..."),this.env.renderEnv(e),this.renderPost(e),this.updatePost()},Object.defineProperty(e.prototype,"updateProjectionForce",{get:function(){return this._updateProjectionForce},set:function(e){this._updateProjectionForce=e,this.t=0},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){},e.prototype.updateMouseHover=function(e){var t=!1;for(this.index=this.imageAnnoApp.scene.geometryList.length;this.index--;)this.imageAnnoApp.scene.geometryList[this.index].isSelectedValue&&(t=!0),this.imageAnnoApp.scene.geometryList[this.index].isMouseInside(e.x,e.y)?(this.imageAnnoApp.scene.geometryList[this.index].isHover=!0,this.imageAnnoApp.geometryCommon.gcmdProcessing.setCaptureHovered(this.imageAnnoApp.scene.geometryList[this.index]),t=!0):this.imageAnnoApp.scene.geometryList[this.index].isHover=!1;t||this.imageAnnoApp.geometryCommon.gcmdProcessing.setCaptureHovered(void 0),this.imageAnnoApp.renderer.needFocus=t,this.imageAnnoApp.activeCommandController.acProperties.hasHovering=t},e.prototype.updatePre=function(){if(this.imageAnnoApp.scene.reset(),this.xOff=this.xOffCurrent-this.xOffPre,this.yOff=this.yOffCurrent-this.yOffPre,this.zoomFactor=this.zoomFactorCurrent-this.zoomFactorPre,this.t+=.01,this.index=this.imageAnnoApp.scene.listBasePoint.length,this.updateProjectionForce){if(this.imageAnnoApp.activeCommandController.acProperties.isPanning=!0,this.frameUpdateValue++%2==0)for(;this.index--;)this.imageAnnoApp.scene.listBasePoint[this.index].update(!0);this.t>.5&&(this.imageAnnoApp.activeCommandController.acProperties.isPanning=!1,this.updateProjectionForce=!1)}else if(this.imageAnnoApp.activeCommandController.acProperties.isPanning||this.imageAnnoApp.activeCommandController.acProperties.isZooming)for(;this.index--;)this.imageAnnoApp.scene.listBasePoint[this.index].update();else if(this.frameUpdateValue++%3==0)for(;this.index--;)this.imageAnnoApp.scene.listBasePoint[this.index].update();this.optimizer.update()},e.prototype.updatePost=function(){this.xOffPre=this.xOffCurrent,this.yOffPre=this.yOffCurrent,this.zoomFactorPre=this.zoomFactorCurrent},e.prototype.renderPre=function(e){this.blackhole&&this.blackhole.render(e)},e.prototype.renderPost=function(e){for(this.imageAnnoApp.implementations.app.model.appCoreWrapper.appProperties.compileMode,r.ct.Production,this.index=this.imageAnnoApp.scene.listALog.length;this.index--;)this.imageAnnoApp.scene.listALog[this.index].render(e);this.renderCroppingArea(e),this.selection.render(e)},e.prototype.renderCroppingArea=function(e){this.imageAnnoApp.scene.paramsEditing.renderCroppingArea(e)},e}(),cs=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),ps=function(e,t,n,o){this.geometry=[],this.activeColor="#000000",this.globalScale=1,this.isModifiedImage=!0,this.geometry=e,this.isModifiedImage=t,this.activeColor=n,this.globalScale=o},ls=function(e){function t(){var t=e.call(this)||this;return t.history=[],t}return cs(t,e),t.prototype.pushAdapter=function(e,t,n,o){this.push(new ps(e,t,n,o))},t.prototype.push=function(e){this.currentIndex<this.history.length-1&&this.history.splice(this.currentIndex+1,this.history.length),this.history.push(e),this.currentIndex=this.history.length-1},t.prototype.undo=function(){if(0!==this.currentIndex)return this.currentIndex--,this.history[this.currentIndex]},t.prototype.redo=function(){return this.currentIndex++,this.currentIndex=this.currentIndex<this.history.length?this.currentIndex:this.history.length-1,this.history[this.currentIndex]},t}(r.i$),ds=function(){function e(e){this.scene=e}return e.prototype.isInsideCropShape=function(e,t){if(this.croppingMaskParams.shape===r.oU.Circle){var n=this.scene.annotationInstance.implementations.app.model.imageWrapper.projectionToImageSpace(e,t);return 0===this.ctx.getImageData(n[0],n[1],1,1).data[3]}return!0},e.prototype.updateDataCropping=function(e){var t=document.createElement("canvas");t.style.width="100%",t.style.height="100%",this.ctx=t.getContext("2d"),t.width=e.width,t.height=e.height,this.croppingMaskParams=e,this.scene.annotationInstance.geometryCommon.gcmdSupporting.renderForce(),this.drawOffscreen(this.ctx)},e.prototype.updateBGStyle=function(){this.croppingMaskParams.isCropGraphics},e.prototype.toggleCropGraphics=function(){this.croppingMaskParams.isCropGraphics=!this.croppingMaskParams.isCropGraphics},e.prototype.renderCroppingArea=function(e){this.croppingMaskParams.isCropGraphics&&(0,r.EW)(e,this.croppingMaskParams.shape,0,0,this.croppingMaskParams.width,this.croppingMaskParams.height,!1),this.updateBGStyle()},e.prototype.drawOffscreen=function(e){if(this.croppingMaskParams.shape===r.oU.Circle){var t=.5*this.croppingMaskParams.width,n=.5*this.croppingMaskParams.height;e.beginPath(),e.rect(-1,-1,e.canvas.width+1,e.canvas.height+1),e.ellipse(t,n,t,n,0,0,2*Math.PI),e.closePath(),e.fill("evenodd")}else e.beginPath(),e.rect(0,0,e.canvas.width,this.croppingMaskParams.y),e.rect(0,this.croppingMaskParams.y+this.croppingMaskParams.height,e.canvas.width,e.canvas.height),e.rect(0,0,this.croppingMaskParams.x,e.canvas.height),e.rect(this.croppingMaskParams.x+this.croppingMaskParams.width,0,e.canvas.width,e.canvas.height),e.closePath(),e.fill()},e}(),us=function(){function e(e){this.geometryList=[],this.listBasePoint=[],this.listAPoint=[],this.listRPoint=[],this.listNPoint=[],this.listIPoint=[],this.listARectangleWrapper=[],this.listACircleWrapperr=[],this.listAPolylineWrapper=[],this.listAPolygonWrapper=[],this.listANGonWrapper=[],this.listAPolygonGraphWrapper=[],this.listAPolylineGraphWrapper=[],this.listAPolylineGraphShadow=void 0,this.listAArrow=[],this.listACurve=[],this.listAFreehand=[],this.listAFreehandSmartDrawing=[],this.listATextleaderlineWrapper=[],this.listALog=[],this.listHashColor={},this.copyPasteGeo=[],this.preCapture=void 0,this.capture=void 0,this.capturePT=void 0,this.captureMultiple=void 0,this.captureHovered=void 0,this.captureForEasing=void 0,this.captureText=void 0,this.useModifiedImage=!0,this.annotationInstance=e,this.sceneManager=new ls,this.paramsEditing=new ds(this)}return e.prototype.undo=function(){var e=this.sceneManager.undo();void 0===e?this.annotationInstance.geometryCommon.gcmdProcessing.removeBeforeDump():(this.annotationInstance.activeCommandController.setScaleGlobal(e.globalScale),this.annotationInstance.activeCommandController.reUndoProcessing(e.geometry),e.isModifiedImage!==this.useModifiedImage&&(e.isModifiedImage?this.annotationInstance.implementations.app.model.imageWrapper.toCroppedImg():this.annotationInstance.implementations.app.model.imageWrapper.toOriginalImg()),this.useModifiedImage=e.isModifiedImage,this.annotationInstance.implementations.app.api.emitDataToExpressImageData(),this.emitUndoRedoHistory()),this.annotationInstance.renderer.needFocus=!1},e.prototype.redo=function(){var e=this.sceneManager.redo();void 0!==e&&(this.annotationInstance.activeCommandController.setScaleGlobal(e.globalScale),this.annotationInstance.activeCommandController.reUndoProcessing(e.geometry),e.isModifiedImage!==this.useModifiedImage&&(e.isModifiedImage?this.annotationInstance.implementations.app.model.imageWrapper.toCroppedImg():this.annotationInstance.implementations.app.model.imageWrapper.toOriginalImg()),this.useModifiedImage=e.isModifiedImage,this.emitUndoRedoHistory()),this.annotationInstance.renderer.needFocus=!1},e.prototype.captureScene=function(){for(var e=[],t=0;t<this.geometryList.length;++t){var n=this.geometryList[t].toJSON();n&&e.push(n)}this.useModifiedImage=this.annotationInstance.implementations.app.model.imageWrapper.useModifiedImage;var o=this.annotationInstance.activeCommandController;this.sceneManager.pushAdapter(e,this.useModifiedImage,o.activeColorController.getActiveColor(),o.scaleGlobal),this.emitUndoRedoHistory()},e.prototype.emitUndoRedoHistory=function(){var e=this.sceneManager.getCurrentState();this.annotationInstance.io.emitAction("history@"+JSON.stringify(e))},e.prototype.addGeometry=function(e){this.geometryList.push(e)},e.prototype.removeGeometry=function(e){this.geometryList.splice(this.geometryList.indexOf(e),1)},e.prototype.addBasePoint=function(e){this.listBasePoint.push(e)},e.prototype.removeBasePoint=function(e){this.listBasePoint.splice(this.listBasePoint.indexOf(e),1)},e.prototype.addAPoint=function(e){this.listAPoint.push(e)},e.prototype.removeAPoint=function(e){this.listAPoint.splice(this.listAPoint.indexOf(e),1)},e.prototype.addRPoint=function(e){this.listRPoint.push(e)},e.prototype.removeRPoint=function(e){this.listRPoint.splice(this.listRPoint.indexOf(e),1)},e.prototype.addNPoint=function(e){this.listNPoint.push(e)},e.prototype.removeNPoint=function(e){this.listNPoint.splice(this.listNPoint.indexOf(e),1)},e.prototype.addIPoint=function(e){this.listIPoint.push(e)},e.prototype.removeIPoint=function(e){this.listIPoint.splice(this.listIPoint.indexOf(e),1)},e.prototype.addARectangleWrapper=function(e){this.listARectangleWrapper.push(e)},e.prototype.removeARectangleWrapper=function(e){this.listARectangleWrapper.splice(this.listARectangleWrapper.indexOf(e),1)},e.prototype.addACircleWrapper=function(e){this.listACircleWrapperr.push(e)},e.prototype.removeACircle=function(e){this.listACircleWrapperr.splice(this.listACircleWrapperr.indexOf(e),1)},e.prototype.addAArrow=function(e){this.listAArrow.push(e)},e.prototype.removeAArrow=function(e){this.listAArrow.splice(this.listAArrow.indexOf(e),1)},e.prototype.addACurve=function(e){this.listACurve.push(e)},e.prototype.removeACurve=function(e){this.listACurve.splice(this.listACurve.indexOf(e),1)},e.prototype.addAFreehand=function(e){this.listAFreehand.push(e)},e.prototype.removeAFreehand=function(e){this.listAFreehand.splice(this.listAFreehand.indexOf(e),1)},e.prototype.addAFreehandSmartDrawing=function(e){this.listAFreehandSmartDrawing.push(e)},e.prototype.removeAFreehandSmartDrawing=function(e){this.listAFreehandSmartDrawing.splice(this.listAFreehandSmartDrawing.indexOf(e),1)},e.prototype.addAPolylineGraphWrapper=function(e){this.listAPolylineGraphWrapper.push(e)},e.prototype.removeAPolylineGraphWrapper=function(e){this.listAPolylineGraphWrapper.splice(this.listAPolylineGraphWrapper.indexOf(e),1)},e.prototype.addAPolylineWrapper=function(e){this.listAPolylineWrapper.push(e)},e.prototype.removeAPolylineWrapper=function(e){this.listAPolylineWrapper.splice(this.listAPolylineWrapper.indexOf(e),1)},e.prototype.addAPolygonWrapper=function(e){this.listAPolygonWrapper.push(e)},e.prototype.removeAPolygonWrapper=function(e){this.listAPolygonWrapper.splice(this.listAPolygonWrapper.indexOf(e),1)},e.prototype.addAPolygonGraphWrapper=function(e){this.listAPolygonGraphWrapper.push(e)},e.prototype.removeAPolygonGraphWrapper=function(e){this.listAPolygonGraphWrapper.splice(this.listAPolygonGraphWrapper.indexOf(e),1)},e.prototype.addANGonWrapper=function(e){this.listANGonWrapper.push(e)},e.prototype.removeANGonWrapper=function(e){this.listANGonWrapper.splice(this.listANGonWrapper.indexOf(e),1)},e.prototype.addATextleaderlineWrapper=function(e){this.listATextleaderlineWrapper.push(e)},e.prototype.removeATextleaderlineWrapper=function(e){this.listATextleaderlineWrapper.splice(this.listATextleaderlineWrapper.indexOf(e),1)},e.prototype.addALog=function(e){this.listALog.push(e)},e.prototype.removeALog=function(e){this.listALog.splice(this.listALog.indexOf(e),1)},e.prototype.getUUID=function(){return(0,r.Fs)()},e.prototype.getHashColor=function(e){for(;;){var t=(0,r.kt)();if(!this.listHashColor[t])return this.listHashColor[t]=e,t}},Object.defineProperty(e.prototype,"Capture",{get:function(){return this.capture},set:function(e){this.annotationInstance.implementations.app.INSPECTION&&(void 0===e?this.annotationInstance.activeCommandController.screenLog.push("undefined"):this.annotationInstance.activeCommandController.screenLog.push(e.type)),void 0!==this.capture&&(this.capture.isCapturedValue=!1),this.preCapture=this.capture,this.preCapture&&(this.preCapture.isCapturedValue=!1),this.capture=e,this.capture&&(this.annotationInstance.geometryCommon.gcmdProcessing.checkAttachedTextleaderline(this.capture),this.capture.isCapturedValue=!0,this.capture.updateVecsHistory())},enumerable:!1,configurable:!0}),e.prototype.reset=function(){},e.prototype.destroy=function(){this.annotationInstance.geometryCommon.gcmdProcessing.removeAll()},e}(),ys=function(){function e(e,t,n,o){this.implementations=e,this.interactionMode=this.implementations.app.model.appCoreWrapper.appControllerStatus.mode,this.apiWrapper=new Do(this),this.graphicsCoreWrapper=new ti(this,n),this.scene=new us(this),this.renderer=new hs(this,t),this.io=new ri(this),this.geometryCommon=new Eo(this),this.activeCommandController=new Ro(this),this.customization=new Fo(this,o),this.renderer.ctx=this.graphicsCoreWrapper.canvasWrapper.aCanvas.ctx,this.renderer.ctxOffscreen=this.graphicsCoreWrapper.canvasWrapper.aCanvasOffScreen.offScreenCtx,this.interactionMode}return e.prototype.initPost=function(){this.graphicsCoreWrapper.initPost(),this.graphicsCoreWrapper.canvasWrapper.aCanvas.imageSmoothingEnabled=!0,this.renderer.initPost()},e.prototype.resize=function(e,t){this.graphicsCoreWrapper.resizeCanvas(e,t)},e.prototype.destroy=function(){this.renderer.destroy(),this.graphicsCoreWrapper.destroy()},e.prototype.mouseEventController=function(e){this.activeCommandController.activeCommand.mouseEventController(e)},e.prototype.pushAction=function(e){this.io.stateProcessingAnnotation.pushAction(e)},e}(),ms=function(){function e(e,t){this.divHost=t,this.app=e}return e.prototype.initAnnotationCanvasInstance=function(e,t,n){this.imageAnnoApp=new ys(this,e,t,n)},e.prototype.initAnnotationSVGInstance=function(e,t,n){},Object.defineProperty(e.prototype,"isViewChanging",{set:function(e){this.imageAnnoApp&&(this.imageAnnoApp.activeCommandController.acProperties.isViewChanging=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isTouchEvent",{set:function(e){this.imageAnnoApp&&(this.imageAnnoApp.activeCommandController.IsTouchEvent=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isCustomAPI",{set:function(e){e||this.imageAnnoApp&&this.imageAnnoApp.graphicsCoreWrapper.canvasWrapper.aCanvasMask&&(this.imageAnnoApp.graphicsCoreWrapper.canvasWrapper.aCanvasMask.width=0)},enumerable:!1,configurable:!0}),e.prototype.updateExtentSVG=function(){},e.prototype.pushTheme=function(e){this.imageAnnoApp&&this.imageAnnoApp.geometryCommon.gcmdSupporting.pushThemeJSON(e)},e.prototype.initPost=function(){this.imageAnnoApp&&this.imageAnnoApp.initPost()},e.prototype.resize=function(e,t){this.imageAnnoApp&&this.imageAnnoApp.resize(e,t)},e.prototype.Pause=function(e){void 0===e&&(e=0),this.imageAnnoApp&&this.imageAnnoApp.graphicsCoreWrapper.pause(e)},e.prototype.resume=function(){this.imageAnnoApp&&this.imageAnnoApp.graphicsCoreWrapper.resume()},e.prototype.mouseEventController=function(e){this.updateEventLog(e),this.imageAnnoApp&&this.imageAnnoApp.mouseEventController(e),this.sketch&&this.sketch.mouseEventController(e)},e.prototype.keyboardEventController=function(e){this.updateEventLog(e),this.imageAnnoApp&&this.imageAnnoApp.activeCommandController.activeCommand.keyboardEventController(e)},e.prototype.keyboardEventControllerFromDocument=function(e){this.updateEventLog(e),this.imageAnnoApp&&this.imageAnnoApp.activeCommandController.activeCommand.keyboardEventControllerFromDocument(e)},e.prototype.touchEventController=function(e){this.updateEventLog(e),this.imageAnnoApp&&this.imageAnnoApp.activeCommandController.activeCommand.touchEventController(e)},e.prototype.render=function(e){this.imageAnnoApp&&this.imageAnnoApp.renderer.render(e)},e.prototype.destroy=function(){this.imageAnnoApp&&this.imageAnnoApp.destroy(),this.sketch&&this.sketch.destroy()},e.prototype.pushAction=function(e){this.imageAnnoApp&&this.imageAnnoApp.pushAction(e),this.sketch&&this.sketch.pushAction(e)},e.prototype.updateEventLog=function(e){this.imageAnnoApp&&this.imageAnnoApp.activeCommandController.acProperties.isHiddenLog},e}()}}]);