(self.webpackChunk=self.webpackChunk||[]).push([[4906],{8038:(e,t,n)=>{"use strict";n.r(t),n.d(t,{AppUpscaler:()=>D});var i=n(3290);const s=e=>(e=>Array.isArray(e))(e)?e[0]:e;class r extends i.ugM.Layer{constructor(){super({}),this.beta=.2}call(e){return i.dC7(s(e),this.beta)}}r.className="MultiplyBeta";class a extends i.ugM.Layer{constructor(){super({}),this.scale=4}computeOutputShape(e){return[e[0],e[1],e[2],3]}call(e){return i.nTT(s(e),this.scale,"NHWC")}}a.className="PixelShuffle";const o="https://unpkg.com/@upscalerjs/models@0.8.27",l=e=>`${o}/models/${e}/config.json`,c=e=>{Array.isArray(e)?console.warn(e.join("\n")):console.warn(e)},d=(h={"div2k/rdn-C3-D10-G64-G064-x2":{urlPath:"div2k/005-2x",scale:2},"div2k/rdn-C3-D10-G64-G064-x3":{urlPath:"div2k/019-3x",scale:3},"div2k/rdn-C3-D10-G64-G064-x4":{urlPath:"div2k/017-4x",scale:4},"idealo/psnr-small":{urlPath:"idealo/psnr-small-quant-uint8",scale:2},"idealo/gans":{urlPath:"idealo/gans",scale:4,preprocess:e=>i.dC7(e,1/255),postprocess:e=>i.dC7(e.clipByValue(0,1),255),customLayers:[r,a]}},Object.entries(h).reduce(((e,[t,n])=>{return{...e,[t]:{...n,url:(i=n.urlPath,`${o}/models/${i}/model.json`),configURL:l(n.urlPath)}};var i}),{})),u={"div2k-2x":["div2k-2x","div2k/rdn-C3-D10-G64-G064-x2","0.8.0"],"div2k-3x":["div2k-3x","div2k/rdn-C3-D10-G64-G064-x3","0.8.0"],"div2k-4x":["div2k-4x","div2k/rdn-C3-D10-G64-G064-x4","0.8.0"],psnr:["psnr","idealo/psnr-small","0.8.0"]},p=async e=>{const t=(({model:e="idealo/gans",scale:t}={})=>{if(e in d){const n=d[e];if(n.deprecated&&((e,t)=>{const n=e[t];n&&((e,t,n)=>{c([`The key ${e} has been deprecated and will be removed in the next release (${n}).`,`Please switch to the following key: ${t}`])})(...n)})(u,e),t)throw new Error([`You are requesting the pretrained model ${e} but are providing an explicit scale.`,"This is not allowed.","For more details, see https://thekevinscott.github.io/UpscalerJS/#/?id=you-are-requesting-the-pretrained-model-but-are-providing-an-explicit-scale"].join(" "));return n}if(!t)throw new Error(["If providing a custom model, you must provide an explicit scale.","For more details, see https://thekevinscott.github.io/UpscalerJS/#/?id=you-must-provide-an-explicit-scale"].join(" "));return{url:e,scale:t}})(e);return t.customLayers&&t.customLayers.forEach((e=>{i.m7h.registerClass(e)})),{model:await i.FBF(t.url),modelDefinition:t}};var h;let f;const g=async e=>{try{if(e.configURL)return(await fetch(e.configURL).then((e=>e.json()))).description}catch(e){}return""},m=e=>"patchSize"in e,w=async(e,t)=>{await i.glt();const{model:n}=await e;for(const e of t)if(m(e)){const{patchSize:t,padding:s=0}=e,r=t+2*s,a=await n.predict(i.lls([1,r,r,3]));await i.glt(),a.dataSync(),a.dispose()}else{if("number"!=typeof e[0]||"number"!=typeof e[1])throw new Error(`Invalid value passed to warmup in warmupSizes. Expected two numbers, got ${e.join(",")}`);const[t,s]=e,r=await n.predict(i.lls([1,s,t,3]));await i.glt(),r.dataSync(),r.dispose()}};var v=n(4279),y=n.n(v);const x=(e,t,n)=>{if(t[e]<0){const i=0-t[e];t[e]+=i,n[e]-=i}},b=(e,t,n,i,s,r)=>{if(n[t]>e){const a=n[t]-e;let o=0;i[t]-a<0&&(o=0-(i[t]-a)),i[t]-=a-o,n[t]-=a;const l=a-o;s[t]+=l,r[t]+=l}},k=(e,t,n)=>{n[e]>t[e]&&(n[e]=t[e])},C=({row:e,col:t,patchSize:n,height:i,width:s,padding:r=0})=>{let a=n,o=n;a>i&&(a=i),o>s&&(o=s);const l=[e*n-r,t*n-r],c=[r,r];x(0,l,c),x(1,l,c);const d=[l[0]+a+2*r,l[1]+o+2*r],u=[c[0]+a,c[1]+o];b(i,0,d,l,c,u),b(s,1,d,l,c,u);const p=[d[0]-l[0],d[1]-l[1]];return k(0,p,u),k(1,p,u),{origin:l,sliceOrigin:c,size:p,sliceSize:[u[0]-c[0],u[1]-c[1]]}};function S(e,t){if(e){const n=e(t);return t.dispose(),n}return t}const z=async(e,t,n,s={})=>{const{tensor:r,type:a}=await(async e=>{if((e=>"string"==typeof e)(e)){const n=await(t=e,new Promise(((e,n)=>{const i=new Image;i.src=t,i.crossOrigin="anonymous",i.onload=()=>e(i),i.onerror=n})));return{tensor:i.Xhn.fromPixels(n).expandDims(0),type:"string"}}var t;if((e=>{try{return e instanceof HTMLImageElement}catch(e){return!1}})(e))return{tensor:i.Xhn.fromPixels(e).expandDims(0),type:"HTMLImageElement"};if((e=>4===e.shape.length)(e))return{tensor:e,type:"tensor"};if(3===e.shape.length)return{tensor:e.expandDims(0),type:"tensor"};throw new Error([`Unsupported dimensions for incoming pixels: ${e.shape.length}.`,"Only 3 or 4 dimension tensors are supported."].join(" "))})(t),o=S(n.preprocess,r),l=await(async(e,t,n,{progress:s,patchSize:r,padding:a}={})=>{const o=n.scale;if(r){void 0===a&&c(['"padding" is undefined, but "patchSize" is explicitly defined.',"Without padding, patches of images often have visible artifacting at the seams. Defining an explicit padding will resolve the artifacting.","For more information, see https://thekevinscott.github.io/UpscalerJS/#/?id=padding-is-undefined.",'To hide this warning, pass an explicit padding of "0".']);const n=3,[l,d]=t.shape.slice(1),{rows:u,columns:p}=((e,t)=>{const[n,i]=(e=>{if(4===e.shape.length)return e.shape.slice(1,3);if(3===e.shape.length)return e.shape.slice(0,2);throw new Error(`Invalid shape provided to getWidthAndHeight, expected tensor of rank 3 or 4: ${JSON.stringify(e.shape)}`)})(e);return{rows:Math.ceil(n/t),columns:Math.ceil(i/t)}})(t,r),{size:h}=C({row:0,col:0,patchSize:r,height:l,width:d,padding:a});let f=i.lls([1,0,h[1]*o,n]);const g=u*p;for(let c=0;c<u;c++){let u=i.lls([1,h[0]*o,0,n]);for(let n=0;n<p;n++){const{origin:h,size:f,sliceOrigin:m,sliceSize:w}=C({row:c,col:n,patchSize:r,padding:a,height:l,width:d}),v=t.slice([0,h[0],h[1]],[-1,f[0],f[1]]);await i.glt();const y=e.predict(v);await i.glt(),v.dispose(),await i.glt(),s&&s((c*p+n+1)/g);const x=y.slice([0,m[0]*o,m[1]*o],[-1,w[0]*o,w[1]*o]);await i.glt(),y.dispose(),await i.glt(),u=u.concat(x,2),await i.glt(),x.dispose(),await i.glt()}f=f.concat(u,1),await i.glt(),u.dispose(),await i.glt()}return f.squeeze()}return i.lub((()=>{const n=e.predict(t);return s&&s(1),n.squeeze()}))})(e,o,n,s),d=S(n.postprocess,l);if("tensor"!==a&&r.dispose(),"tensor"===s.output)return d;const u=y()(d);return d.dispose(),u};var D=function(){function e(e){void 0===e&&(e="main");var t="https://raw.githubusercontent.com/NamjuLee/data/master/img/map/worldMapGlobeA_small.png",n=new Image;n.src=t;var i=document.getElementById(e);i&&i.appendChild(n),new class{constructor(e={}){this.getModel=()=>this._model,this.warmup=async e=>{await w(this._model,e)},this.upscale=async(e,t={})=>{const{model:n,modelDefinition:i}=await this._model;return z(n,e,i,t)},this.getModelDefinitions=()=>(async()=>(f||(f=await(async(e={})=>{const t=Object.entries(d);return await Promise.all(t.map((async([t,n])=>{const i=await g(n);e[t]={...n,description:i}}))),e})()),f))(),this._opts={...e},this._model=p(this._opts),w(this._model,this._opts.warmupSizes||[])}}({}).upscale(t).then((function(e){console.log(e);var t=document.createElement("img");t.src=e,i&&i.appendChild(t)})),console.log("upscaler done")}return e.Init=function(t){new e(t)},e.prototype.InitHTML=function(){var e=this,t=document.createElement("button");t.style.width="100px",t.style.height="20px",t.style.marginLeft="20px",t.style.zIndex="5",t.name="Clear",t.innerText="Clear",t.value="Clear",t.onclick=function(){console.log(e),e.canvasSD.Clear()},this.host.appendChild(t),this.divText=document.createElement("div"),this.divText.id="classText",this.divText.style.zIndex="5",this.divText.innerText="class: ",this.divText.style.marginLeft="20px",this.host.appendChild(this.divText)},e.prototype.Init=function(e){console.log("this is init...")},e.prototype.Clear=function(){this.canvasSD.Clear()},e}()},4279:function(e,t){"use strict";var n=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(s,r){function a(e){try{l(i.next(e))}catch(e){r(e)}}function o(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((i=i.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,i,s,r,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return r={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function o(r){return function(o){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(s=2&r[0]?i.return:r[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,r[1])).done)return s;switch(i=0,s&&(r=[2&r[0],s.value]),r[0]){case 0:case 1:s=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,i=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!((s=(s=a.trys).length>0&&s[s.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!s||r[1]>s[0]&&r[1]<s[3])){a.label=r[1];break}if(6===r[0]&&a.label<s[1]){a.label=s[1],s=r;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(r);break}s[2]&&a.ops.pop(),a.trys.pop();continue}r=t.call(e,a)}catch(e){r=[6,e],i=0}finally{n=s=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,o])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.tensorAsBase64=t.tensorAsBuffer=void 0,t.tensorAsBuffer=function(e){return n(void 0,void 0,void 0,(function(){var t,n,s,r,a,o,l,c,d;return i(this,(function(i){switch(i.label){case 0:return t=e.shape,n=t[0],s=t[1],r=new Uint8ClampedArray(s*n*4),[4,e.data()];case 1:for(a=i.sent(),o=0,l=0;l<n;l++)for(c=0;c<s;c++)r[d=4*(l*s+c)]=a[o],r[d+1]=a[o+1],r[d+2]=a[o+2],r[d+3]=255,o+=3;return[2,r]}}))}))},t.tensorAsBase64=function(e){return n(void 0,void 0,void 0,(function(){var n,s,r,a,o,l;return i(this,(function(i){switch(i.label){case 0:return n=e.shape,s=n[0],r=n[1],[4,t.tensorAsBuffer(e)];case 1:return a=i.sent(),(o=new ImageData(r,s)).data.set(a),(l=document.createElement("canvas")).width=r,l.height=s,l.getContext("2d").putImageData(o,0,0),[2,l.toDataURL()]}}))}))},t.default=t.tensorAsBase64},613:()=>{},4240:()=>{},6227:()=>{},8072:()=>{},8090:()=>{},3706:()=>{}}]);