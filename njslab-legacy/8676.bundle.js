"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[8676],{8676:(t,e,i)=>{i.r(e),i.d(e,{DynamicSpringTruss:()=>R});var s,o=function(){},n=function(t){this.app=t},h=i(7435),r=i(8903),a=i(906);!function(t){t.PERSPECTIVE="PERSPECTIVE",t.ORTHOGRAPHIC="ORTHOGRAPHIC",t.STEREO="STEREO"}(s||(s={}));var p,d=function(){function t(t,e,i,o){void 0===o&&(o=s.PERSPECTIVE),this.initX=0,this.initY=0,this.prevX=0,this.prevY=0,this.rotateRate=150,this.panRate=50,this.zoomRate=200,this.zoomFactor=1,this.frustumSize=.001,this.cameraShift=0,this.ableToMove=!0,this.canvas=t,this.type=o,this.width=e,this.height=i,this.type===s.PERSPECTIVE?this.GetPerspective(0,10,50):this.type===s.ORTHOGRAPHIC?this.GetOrthographic():this.type===s.STEREO&&this.GetStereo(),this.stereoCamera=new h.u37}return t.prototype.GetStereo=function(){},Object.defineProperty(t.prototype,"aspect",{get:function(){return this.width/this.height},set:function(t){this.type===s.PERSPECTIVE?this.cameraP.aspect=t:(this.type,s.ORTHOGRAPHIC)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"camera",{get:function(){return this.type===s.PERSPECTIVE?this.cameraP:this.type===s.ORTHOGRAPHIC?this.cameraO:this.cameraP},enumerable:!1,configurable:!0}),t.prototype.GetPerspective=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=2),void 0===i&&(i=2),this.cameraP=new h.cPb(45,this.width/this.height,.01,1e4),this.cameraP.position.set(t,e,i),this.InitOrbitController()},t.prototype.GetOrthographic=function(){this.cameraO=new h.iKG(this.frustumSize*this.aspect/-2,this.frustumSize*this.aspect/2,this.frustumSize/2,this.frustumSize/-2,.01,5e4),this.cameraO.position.set(0,1,0),this.InitOrbitController()},t.prototype.InitOrbitController=function(){this.type===s.PERSPECTIVE?this.controls=new r.OrbitControls(this.cameraP,this.canvas.renderer.domElement):this.type===s.ORTHOGRAPHIC&&(this.controls=new r.OrbitControls(this.cameraO,this.canvas.renderer.domElement)),this.controls.minDistance=.01,this.controls.maxDistance=500,this.controls.enablePan=!0,this.controls.enableZoom=!0,this.yRotRate=this.rotateRate/this.width*Math.PI/90,this.xRotRate=this.rotateRate/this.height*Math.PI/180,this.xPanRate=this.panRate/this.width*this.zoomFactor,this.yPanRate=this.panRate/this.height*this.zoomFactor,this.zPanRate=this.zoomRate/this.height},t.prototype.EnableDamping=function(t,e){void 0===e&&(e=.35),this.controls.enableDamping=t,this.controls.dampingFactor=e},t.prototype.MouseDown=function(t,e){this.initX=this.prevX=t,this.initY=this.prevY=e},t.prototype.MouseMove=function(t,e,i){if(void 0===i&&(i=!1),this.ableToMove){var s=t-this.prevX,o=e-this.prevY;i?(this.controls.panLeft(s*this.xPanRate,this.cameraP.matrix),this.controls.panUp(o*this.yPanRate,this.cameraP.matrix)):(this.controls.rotateLeft(s*this.xRotRate),this.controls.rotateUp(o*this.yRotRate)),this.prevX=t,this.prevY=e}},t.prototype.MouseWheel=function(t){this.controls.enableZoom=!0,t*=.1;var e=100*this.cameraP.position.length();this.zoomFactor=e,t>0?(this.cameraP.position.x*=.9,this.cameraP.position.y*=.9,this.cameraP.position.z*=.9):(this.cameraP.position.x*=1.1,this.cameraP.position.y*=1.1,this.cameraP.position.z*=1.1)},t.prototype.ShiftCamera=function(){this.cameraShift++,2===this.cameraShift&&(this.cameraShift=0),0===this.cameraShift?this.GetPerspective():1===this.cameraShift&&this.GetOrthographic()},t.prototype.MouseEventController=function(t){t.CLICK_TYPE===a.uh.DOWN&&this.MouseDown(t.x,t.y),t.CLICK_TYPE===a.uh.DRAG&&this.MouseMove(t.x,t.y,t.pressedShift),t.CLICK_TYPE===a.uh.WHEEL&&this.MouseWheel(t.wheel)},t}(),c=function(){function t(t,e){this.bg=0,this.isActive=!0,this.canvasWrapper=t,this.hostDiv=e,this.Init()}return t.prototype.Init=function(){var t=this.hostDiv.clientWidth,e=this.hostDiv.clientHeight;this.renderer=new h.CP7({antialias:!0,alpha:!0}),this.renderer.setPixelRatio(t/e),this.camera=new d(this,t,e),this.scene=new h.xsS,this.renderer.domElement.id="dynamic-spring",this.renderer.domElement.style.position="absolute",this.renderer.domElement.style.pointerEvents="none",this.renderer.setSize(t,e),this.hostDiv.appendChild(this.renderer.domElement),this.RenderLoop(this)},t.prototype.RenderLoop=function(t){var e=this;this.isActive&&(requestAnimationFrame((function(){e.RenderLoop(e)})),this.UpdateBinding(),this.camera.controls.update(),this.renderer.render(this.scene,this.camera.camera))},t.prototype.UpdateBinding=function(){console.log("implementation needed")},t.prototype.ResizeCanvas=function(t,e){this.camera.aspect=t/e,this.camera.camera.updateProjectionMatrix(),this.renderer.setSize(t,e)},t.prototype.ResizeEffect=function(t,e){},t.prototype.Remove=function(){for(;this.scene.children.length;)this.scene.remove(this.scene.children[0])},t}(),u=function(t){this.graphicsCoreWrapper=t,this.canvasThree=new c(this,this.graphicsCoreWrapper.app.divHost)},l=function(){function t(t){this.app=t,this.canvasWrapper=new u(this)}return t.prototype.Resize=function(t,e){this.canvasWrapper.canvasThree.ResizeCanvas(t,e)},t.prototype.Dispose=function(){this.canvasWrapper.canvasThree.isActive=!1},t}(),m=function(){function t(t){this.scene=t}return t.prototype.MouseEventController=function(t){this.scene.app.graphicsCoreWrapper.canvasWrapper.canvasThree.camera.MouseEventController(t),t.CLICK_TYPE!==a.uh.LEFT?t.CLICK_TYPE!==a.uh.MIDDLE?t.CLICK_TYPE!==a.uh.DOWN_RIGHT?t.CLICK_TYPE!==a.uh.DOUBLE?t.CLICK_TYPE!==a.uh.MOVE?t.CLICK_TYPE!==a.uh.DRAG?t.CLICK_TYPE!==a.uh.DOWN?t.CLICK_TYPE!==a.uh.UP||this.MouseUpPre(t):this.MouseDownPre(t):this.MouseDragPre(t):this.MouseMovePre(t):this.MouseDoubleClickPre(t):this.MouseRightClickPre(t):this.MouseMiddleClickPre(t):this.MouseLeftClickPre(t)},t.prototype.MouseDown=function(t){},t.prototype.MouseDownPre=function(t){this.scene.MouseDown(t.x,t.y),this.MouseDown(t)},t.prototype.MouseLeftClick=function(t){},t.prototype.MouseLeftClickPre=function(t){this.MouseLeftClick(t)},t.prototype.MouseMiddleClick=function(t){},t.prototype.MouseMiddleClickPre=function(t){this.MouseMiddleClick(t)},t.prototype.MouseRightClick=function(t){},t.prototype.MouseRightClickPre=function(t){this.MouseRightClick(t)},t.prototype.MouseUp=function(t){},t.prototype.MouseUpPre=function(t){this.scene.MouseUp(t.x,t.y),this.MouseUp(t)},t.prototype.MouseDoubleClick=function(t){},t.prototype.MouseDoubleClickPre=function(t){this.MouseDoubleClick(t)},t.prototype.MouseMove=function(t){},t.prototype.MouseMovePre=function(t){this.scene.MouseMove(t.x,t.y),this.MouseMove(t)},t.prototype.MouseDrag=function(t){},t.prototype.MouseDragPre=function(t){this.scene.MouseDrag(t.x,t.y),this.MouseDrag(t)},t}(),f=function(){function t(t){this.listMesh=[],this.raycaster=new h.iMs,this.m=new h.FM8(0,0),this.scene=t,this.raycaster.params.Points={threshold:.1}}return t.prototype.Raycast=function(t,e,i){this.m.x=t/this.scene.app.graphicsCoreWrapper.canvasWrapper.canvasThree.renderer.domElement.clientWidth*2-1,this.m.y=-e/this.scene.app.graphicsCoreWrapper.canvasWrapper.canvasThree.renderer.domElement.clientHeight*2+1,this.raycaster.setFromCamera(this.m,this.scene.app.graphicsCoreWrapper.canvasWrapper.canvasThree.camera.camera);var s=this.raycaster.intersectObjects(i);if(s.length>0){var o=s[0];console.log(o.point)}},t.prototype.RaycastPoint=function(t,e,i){this.raycaster.params.Points={threshold:5},this.m.x=t/this.scene.app.graphicsCoreWrapper.canvasWrapper.canvasThree.renderer.domElement.clientWidth*2-1,this.m.y=-e/this.scene.app.graphicsCoreWrapper.canvasWrapper.canvasThree.renderer.domElement.clientHeight*2+1,this.raycaster.setFromCamera(this.m,this.scene.app.graphicsCoreWrapper.canvasWrapper.canvasThree.camera.camera);var s=this.raycaster.intersectObjects(i);if(s.length>0){var o=s[0];return[o.point.x,o.point.y,o.point.z]}return null},t}(),g=function(){function t(t){this.sceneWrapper=t,this.Init()}return t.prototype.Init=function(){this.hemiLight=new h.vmT(16777215,16777215,.6),this.hemiLight.color.setHSL(.6,1,.6),this.hemiLight.groundColor.setHSL(.095,1,.75),this.hemiLight.position.set(0,50,0),this.sceneWrapper.scene.add(this.hemiLight),this.dirLight=new h.Ox3(16777215,1),this.dirLight.color.setHSL(.1,1,.95),this.dirLight.position.set(-1,1.75,1),this.dirLight.position.multiplyScalar(30),this.dirLight.castShadow=!0,this.dirLight.shadow.mapSize.width=4096,this.dirLight.shadow.mapSize.height=4096,this.dirLight.shadow.camera.left=-50,this.dirLight.shadow.camera.right=50,this.dirLight.shadow.camera.top=50,this.dirLight.shadow.camera.bottom=-50,this.dirLight.shadow.bias=-1e-4,this.dirLight.shadow.camera.near=.001,this.dirLight.shadow.camera.far=350,this.sceneWrapper.scene.add(this.dirLight)},t.prototype.Dispose=function(){this.dirLight.visible=!1,this.hemiLight.visible=!1,this.sceneWrapper.scene.remove(this.dirLight),this.sceneWrapper.scene.remove(this.hemiLight)},t}();!function(t){t[t.particle=0]="particle",t[t.particleLine=1]="particleLine",t[t.thread=2]="thread",t[t.grid=3]="grid",t[t.fabric=4]="fabric",t[t.curtain=5]="curtain",t[t.tensileStructure=6]="tensileStructure",t[t.network=7]="network"}(p||(p={}));var v=function(){function t(t,e,i){this.p=a.h9.Origin(),this.f=a.h9.Origin(),this.u=a.h9.Origin(),this.m=0,this.Fixed=!1,this.isCapture=!1,this.p=new a.h9(t.x,t.y,t.z),this.u=new a.h9(e.x,e.y,e.z),this.m=i}return t.prototype.Move=function(t,e,i){void 0===i&&(i=0),this.Fixed||(this.u.Mult(e),this.u.Add(a.h9.Scale(this.f,t/this.m)),this.p.Add(a.h9.Scale(this.u,t)),this.p.y<i&&(this.p.y=i,this.u.y<0&&(this.u.y=-this.u.y)))},t}(),y=function(){function t(t,e){this.targetLength=0,this.springConstant=.8,this.n0=t,this.n1=e,this.targetLength=this.n0.p.Distance(this.n1.p)}return t.prototype.ApplySpringForce=function(){var t=a.h9.Sub(this.n1.p,this.n0.p),e=t.Length();t.Unitize();var i=a.h9.Scale(t,(e-this.targetLength)*this.springConstant);this.n0.f=a.h9.Add(this.n0.f,i),this.n1.f=a.h9.Sub(this.n1.f,i)},t}(),C=function(){function t(){this.nodes=[],this.edges=[]}return t.prototype.Graph=function(){},t.prototype.InitTemplate=function(t,e,i,s,o,n,h,r){var d=(o-i)/(t-1),c=(n-s)/(e-1);switch(r){case p.particle:for(var u=0;u<t;++u)this.AddNode(new a.h9(.1*u,0,4),a.h9.Zero(),.2+.1*u);break;case p.thread:for(u=0;u<t;++u)this.AddNode(new a.h9(.1*u,0,4),a.h9.Zero(),1);for(u=0;u<t-1;++u)this.AddEdge(this.nodes[u],this.nodes[u+1]);this.nodes[this.nodes.length-1].Fixed=!0;break;case p.grid:for(var l=0;l<e;++l)for(u=0;u<t;++u)this.AddNode(new a.h9(i+u*d,s+l*c,h),a.h9.Zero(),1);break;case p.fabric:for(l=0;l<e;++l)for(u=0;u<t;++u)this.AddNode(new a.h9(i+u*d,s+l*c,h),a.h9.Origin(),1);for(l=0;l<e;++l)for(u=0;u<t;++u){var m=l*t+u;0!==u&&this.AddEdge(this.nodes[m-1],this.nodes[m]),0!==l&&this.AddEdge(this.nodes[m-t],this.nodes[m])}break;case p.curtain:for(l=0;l<e;++l)for(u=0;u<t;++u)this.AddNode(new a.h9(i+u*d,s+l*c,h),a.h9.Zero(),1);for(l=0;l<e;++l)for(u=0;u<t;++u)m=l*t+u,0!==u&&this.AddEdge(this.nodes[m-1],this.nodes[m]),0!==l&&this.AddEdge(this.nodes[m-t],this.nodes[m]),0!==u&&0!==l&&this.AddEdge(this.nodes[m-t-1],this.nodes[m]),0!==u&&l!==e-1&&this.AddEdge(this.nodes[m+t-1],this.nodes[m]);for(l=0;l<t;++l)this.nodes[l].Fixed=!0;break;case p.tensileStructure:for(l=0;l<e;++l)for(u=0;u<t;++u)this.AddNode(new a.h9(i+u*d,s+l*c,h),a.h9.Zero(),1);for(l=0;l<e;++l)for(u=0;u<t;++u)m=l*t+u,0!==u&&this.AddEdge(this.nodes[m-1],this.nodes[m]),0!==l&&this.AddEdge(this.nodes[m-t],this.nodes[m]),0!==u&&0!==l&&this.AddEdge(this.nodes[m-t-1],this.nodes[m]),0!==u&&l!==e-1&&this.AddEdge(this.nodes[m+t-1],this.nodes[m]);for(l=0;l<e;++l)this.nodes[l*t].Fixed=!0;this.nodes[t-1].Fixed=!0,this.nodes[t-1].p.z=0,this.nodes[e*t-1].Fixed=!0,this.nodes[t*e/2+t/2].Fixed=!0,this.nodes[t*e/2+t/2].p.z=0;for(var f=0,g=this.edges;f<g.length;f++)g[f].targetLength=.1;break;case p.network:for(u=0;u<200;++u)this.AddNode(new a.h9(10*Math.random()-15,13+5*Math.random(),13+5*Math.random()),a.h9.Zero(),1);for(u=0;u<this.nodes.length;++u)for(l=u+1;l<this.nodes.length;++l)Math.random()<.1&&(this.AddEdge(this.nodes[u],this.nodes[l]).targetLength=8*Math.random()+.3)}},t.prototype.InitGridXY=function(t,e,i,s,o,n,h){for(var r=(o-i)/(t-1),p=(n-s)/(e-1),d=this.nodes.length,c=0;c<e;++c)for(var u=0;u<t;++u)this.AddNode(new a.h9(i+u*r,s+c*p,h),a.h9.Zero(),1);for(c=0;c<e;++c)for(u=0;u<t;++u){var l=c*t+u;0!==u&&this.AddEdge(this.nodes[d+l-1],this.nodes[d+l]),0!==c&&this.AddEdge(this.nodes[d+l-t],this.nodes[d+l]),0!==u&&0!==c&&this.AddEdge(this.nodes[d+l-t-1],this.nodes[d+l]),0!==u&&c!==e-1&&this.AddEdge(this.nodes[d+l+t-1],this.nodes[d+l])}},t.prototype.InitTruss=function(t,e,i){for(var s=1/(t-1),o=this.nodes.length,n=0;n<t;++n){var h=e.Clone();h.x=e.x+(i.x-e.x)*n*s,this.AddNode(h,a.h9.Zero(),1),h.y=i.y,this.AddNode(h,a.h9.Zero(),1),h.z=i.z,this.AddNode(h,a.h9.Zero(),1),h.y=e.y,this.AddNode(h,a.h9.Zero(),1)}for(n=0;n<t;++n){var r=4*n;this.AddEdge(this.nodes[o+r],this.nodes[o+r+1]),this.AddEdge(this.nodes[o+r+1],this.nodes[o+r+2]),this.AddEdge(this.nodes[o+r+2],this.nodes[o+r+3]),this.AddEdge(this.nodes[o+r+3],this.nodes[o+r]),this.AddEdge(this.nodes[o+r],this.nodes[o+r+2]),this.AddEdge(this.nodes[o+r+1],this.nodes[o+r+3]),n!==t-1&&(this.AddEdge(this.nodes[o+r],this.nodes[o+r+4]),this.AddEdge(this.nodes[o+r+1],this.nodes[o+r+5]),this.AddEdge(this.nodes[o+r+2],this.nodes[o+r+6]),this.AddEdge(this.nodes[o+r+3],this.nodes[o+r+7]),this.AddEdge(this.nodes[o+r],this.nodes[o+r+5]),this.AddEdge(this.nodes[o+r+1],this.nodes[o+r+6]),this.AddEdge(this.nodes[o+r+2],this.nodes[o+r+7]),this.AddEdge(this.nodes[o+r+3],this.nodes[o+r+4]),this.AddEdge(this.nodes[o+r],this.nodes[o+r+6]),this.AddEdge(this.nodes[o+r+1],this.nodes[o+r+7]),this.AddEdge(this.nodes[o+r+2],this.nodes[o+r+4]),this.AddEdge(this.nodes[o+r+3],this.nodes[o+r+5]),this.AddEdge(this.nodes[o+r],this.nodes[o+r+7]),this.AddEdge(this.nodes[o+r+1],this.nodes[o+r+4]),this.AddEdge(this.nodes[o+r+2],this.nodes[o+r+5]),this.AddEdge(this.nodes[o+r+3],this.nodes[o+r+6]))}for(var p=0,d=this.edges;p<d.length;p++)d[p].springConstant=2;this.nodes[0].Fixed=!0,this.nodes[1].Fixed=!0,this.nodes[2].Fixed=!0,this.nodes[3].Fixed=!0},t.prototype.Clear=function(){this.nodes=[],this.edges=[]},t.prototype.AddNode=function(t,e,i){var s=new v(t,e,i);return this.nodes.push(s),s},t.prototype.AddEdge=function(t,e){var i=new y(t,e);return this.edges.push(i),i},t.prototype.Move=function(t,e,i,s,o,n){for(var h=0;h<n;++h){for(var r=0,p=this.nodes;r<p.length;r++){var d=p[r],c=a.h9.Sub(t,d.p),u=c.Length();c.Unitize(),d.f=a.h9.Add(a.h9.Scale(c,.1*Math.exp(-.1*u*u)),a.h9.Scale(a.h9.YAxis(),i))}for(var l=0,m=this.edges;l<m.length;l++)m[l].ApplySpringForce();for(var f=0,g=this.nodes;f<g.length;f++)(d=g[f]).Move(s,e,o)}},t.prototype.FindNode=function(t,e,i){for(var s=0;s<this.nodes.length;++s)if(this.nodes[s].p.Distance(new a.h9(t,e,i))<3)return this.nodes[s]},t}(),E=function(){function t(t,e,i,s){this.material=new h.UY4,this.num=100,this.scene=t,this.material=new h.UY4({color:16711680,size:1.15,opacity:.5}),this.geometry=new h.ZXM,this.pointCloud=new h.woe(this.geometry,this.material),this.scene.add(this.pointCloud),this.geometry.vertices.push(new h.Pa4(e,i,s))}return t.prototype.Click=function(){this.num+=100,console.log(this.num),this.geometry.vertices=[];for(var t=0;t<this.num;t++){var e=2*Math.random()-1,i=2*Math.random()-1,s=2*Math.random()-1;this.geometry.vertices.push(new h.Pa4(e,i,s))}this.geometry.verticesNeedUpdate=!0,this.geometry.elementsNeedUpdate=!0,this.geometry.computeVertexNormals()},t.prototype.Dispose=function(){this.scene.remove(this.pointCloud),this.geometry.dispose()},t}(),M=function(){function t(t){this.material=new h.nls,this.num=100,this.scene=t,this.material=new h.nls({color:16711680,opacity:1}),this.geometry=new h.ZXM,this.pointCloud=new h.ejS(this.geometry,this.material),this.scene.add(this.pointCloud)}return t.prototype.Add=function(t,e,i){this.geometry.vertices.push(new h.Pa4(t,e,i))},t.prototype.Dispose=function(){this.scene.remove(this.pointCloud),this.pointCloud.geometry.dispose()},t}(),P=function(){function t(t){this.point=[],this.damping=.96,this.gravity=-.032,this.timeStep=.316,this.groundZ=-9.26,this.m=new a.h9(0,0,0),this.scene=t,this.Init()}return t.prototype.Init=function(){console.log(p),this.Graph=new C,this.Graph.InitTruss(5,new a.h9(-20,20,-5),new a.h9(20,15,5));for(var t=0;t<this.Graph.nodes.length;++t){var e=this.Graph.nodes[t];this.point.push(new E(this.scene,e.p.x,e.p.y,e.p.z))}for(this.Lines=new M(this.scene),t=0;t<this.Graph.edges.length;++t)e=this.Graph.edges[t],this.Lines.Add(e.n0.p.x,e.n0.p.y,e.n0.p.z),this.Lines.Add(e.n1.p.x,e.n1.p.y,e.n1.p.z)},Object.defineProperty(t.prototype,"capture",{get:function(){return this._capture},set:function(t){t?t.isCapture=!0:this._capture&&(this._capture.isCapture=!1),this._capture=t},enumerable:!1,configurable:!0}),t.prototype.GetPointForRaycast=function(){for(var t=[],e=0;e<this.point.length;++e)t.push(this.point[e].pointCloud);return t},t.prototype.Update=function(){this.Graph.Move(new a.h9(100,10,10),this.damping,this.gravity,this.timeStep,this.groundZ,1);for(var t=0;t<this.Graph.nodes.length;++t){var e=this.Graph.nodes[t];this.point[t].geometry.vertices[0].x=e.p.x,this.point[t].geometry.vertices[0].y=e.p.y,this.point[t].geometry.vertices[0].z=e.p.z,this.Graph.nodes[t].isCapture?(this.point[t].material.color.r=1,this.point[t].material.color.g=1,this.point[t].material.color.b=1):(this.point[t].material.color.r=1,this.point[t].material.color.g=0,this.point[t].material.color.b=0),this.point[t].geometry.colorsNeedUpdate=!0,this.point[t].geometry.verticesNeedUpdate=!0,this.point[t].material.needsUpdate=!0}for(t=0;t<this.Graph.edges.length;++t)e=this.Graph.edges[t],this.Lines.geometry.vertices[2*t].x=e.n0.p.x,this.Lines.geometry.vertices[2*t].y=e.n0.p.y,this.Lines.geometry.vertices[2*t].z=e.n0.p.z,this.Lines.geometry.vertices[2*t+1].x=e.n1.p.x,this.Lines.geometry.vertices[2*t+1].y=e.n1.p.y,this.Lines.geometry.vertices[2*t+1].z=e.n1.p.z;this.Lines.geometry.verticesNeedUpdate=!0},t.prototype.MouseMove=function(t,e,i){this.capture&&console.log(this.capture)},t.prototype.MouseDrag=function(t,e){this.capture&&(console.log(t,e),console.log(this.capture),this.capture.p.x=t,this.capture.p.y=e)},t.prototype.MouseDown=function(t,e,i){var s=this.Graph.FindNode(t,e,i);this.capture=s||void 0},t.prototype.MouseUp=function(){this.capture=void 0},t.prototype.Dispose=function(){for(var t=0,e=this.point;t<e.length;t++){var i=e[t];this.scene.remove(i.pointCloud),i.Dispose()}this.Lines.Dispose()},t}(),w=function(){function t(t){var e=this;this.app=t,this.activeCommandController=new m(this),this.scene=this.app.graphicsCoreWrapper.canvasWrapper.canvasThree.scene,this.app.graphicsCoreWrapper.canvasWrapper.canvasThree.UpdateBinding=function(){e.Update()},this.lightingController=new g(this),this.geometryCommon=new f(this),this.Init()}return t.prototype.Init=function(){this.definition=new P(this.scene)},t.prototype.Update=function(){this.definition.Update()},t.prototype.MouseMove=function(t,e){var i=this.geometryCommon.RaycastPoint(t,e,this.definition.GetPointForRaycast());i&&this.definition.MouseMove(i[0],i[1],i[2])},t.prototype.MouseDown=function(t,e){var i=this.geometryCommon.RaycastPoint(t,e,this.definition.GetPointForRaycast());i&&(this.app.graphicsCoreWrapper.canvasWrapper.canvasThree.camera.ableToMove=!1,this.definition.MouseDown(i[0],i[1],i[2]))},t.prototype.MouseUp=function(t,e){this.definition.MouseUp(),this.app.graphicsCoreWrapper.canvasWrapper.canvasThree.camera.ableToMove=!0},t.prototype.MouseDrag=function(t,e){var i=this.geometryCommon.RaycastPoint(t,e,this.definition.GetPointForRaycast());i&&this.definition.MouseDrag(i[0],i[1])},t.prototype.Dispose=function(){this.definition.Dispose()},t}(),L=function(){function t(t){this.x=-1,this.y=-1,this.z=-1,this.preX=-1,this.preY=-1,this.preZ=-1,this.CLICK_TYPE=a.uh.MOVE,this.isDown=!1,this.isDoubleClick=!1,this.isMove=!1,this.pressedShift=!1,this.pressedAlt=!1,this.pressedCtrl=!1,this.lat=-1,this.long=-1,this.wheel=0,this.preWheel=0,this.isActive=!0,null!=t&&(this.app=t)}return t.prototype.DeepCopy=function(){var e=new t(this.app);return e.x=this.x,e.y=this.y,e.z=this.z,e.preX=this.preX,e.preY=this.preY,e.preZ=this.preZ,e.pressedAlt=this.pressedAlt,e.pressedShift=this.pressedShift,e.pressedCtrl=this.pressedCtrl,e.isDoubleClick=this.isDoubleClick,e.isDown=this.isDown,e.isMove=this.isMove,e.lat=this.lat,e.long=this.long,e.wheel=this.wheel,e.preWheel=this.preWheel,e.yGLPicking=this.yGLPicking,e.CLICK_TYPE=this.CLICK_TYPE,e.native=this.native,e},t}(),D=function(){function t(t){this.mouseEventDataPre=new L,this.isEnable=!0,this.clickCount=0,this.click=!1,this.prevent=!1,this.delay=250,this.down=!1,this._stopPropagation=!1,this.app=t}return t.prototype.InitNativeMouseEvent=function(t){var e=this;t.onclick=function(t){e.prevent=!1,e.timer=setTimeout((function(){e.prevent||(e.MouseClick(t),t.stopPropagation()),e.prevent=!1}),e.delay)},t.ondblclick=function(t){clearTimeout(e.timer),e.prevent=!0,e.MouseDoubleClick(t)},t.onmousedown=function(t){e.MouseDown(t),t.stopPropagation()},t.onmouseup=function(t){e.MouseUp(t),t.stopPropagation()},t.onmousemove=function(t){e.MouseMove(t),t.stopPropagation()},t.addEventListener("wheel",(function(t){e.MouseWheel(t,t.deltaY),t.stopPropagation()}))},t.prototype.MouseDown=function(t){this.click=!0,this.down=!0;var e=this.CommonEventBuilder(t);e.CLICK_TYPE=a.uh.DOWN,e.isDown=!0,this.MouseEvenEmitting(e)},t.prototype.MouseClick=function(t){if(this.click){var e=this.CommonEventBuilder(t);0===t.button?e.CLICK_TYPE=a.uh.LEFT:1===t.button?e.CLICK_TYPE=a.uh.MIDDLE:2===t.button&&(e.CLICK_TYPE=a.uh.RIGHT),this.MouseEvenEmitting(e)}},t.prototype.MouseDoubleClick=function(t){var e=this.CommonEventBuilder(t);e.CLICK_TYPE=a.uh.DOUBLE,this.MouseEvenEmitting(e)},t.prototype.MouseDrag=function(t){this.click=!1,this.prevent=!0;var e=this.CommonEventBuilder(t);e.CLICK_TYPE=a.uh.DRAG,e.isDown=!0,1===t.buttons?e.CLICK_TYPE=a.uh.DRAG:4===t.buttons?e.CLICK_TYPE=a.uh.DRAG_MIDDLE:2===t.buttons&&(e.CLICK_TYPE=a.uh.DRAG_RIGHT),this.MouseEvenEmitting(e)},t.prototype.MouseMove=function(t){if(this.down)this.MouseDrag(t);else{var e=this.CommonEventBuilder(t);e.CLICK_TYPE=a.uh.MOVE,e.isDown=!0,this.prevent=!0,this.MouseEvenEmitting(e)}},t.prototype.MouseUp=function(t){this.down=!1,this.click=!0;var e=this.CommonEventBuilder(t);e.CLICK_TYPE=a.uh.UP,e.isDown=!1,this.MouseEvenEmitting(e)},t.prototype.MouseWheel=function(t,e){var i=this.CommonEventBuilder(t);i.wheel=e,i.CLICK_TYPE=a.uh.WHEEL,this.MouseEvenEmitting(i)},t.prototype.CommonEventBuilder=function(t){var e=new L(this.app);return e.preX=this.mouseEventDataPre.x,e.preY=this.mouseEventDataPre.y,e.pressedShift=t.shiftKey,e.pressedAlt=t.altKey,e.pressedCtrl=t.ctrlKey,e.x=t.offsetX,e.y=t.offsetY,e.preWheel=this.mouseEventDataPre.wheel,e.wheel=0,e.native=t,this.mouseEventDataPre=e,this.e=e,e},Object.defineProperty(t.prototype,"stopPropagation",{get:function(){return this._stopPropagation},set:function(t){var e=this;t?this._stopPropagation=t:setTimeout((function(){e._stopPropagation=t}),500)},enumerable:!1,configurable:!0}),t.prototype.MouseEvenEmitting=function(t){this.app.MouseEventController(t)},t}(),A=function(t){this.app=t,this.mouseInteraction=new D(this.app),this.mouseInteraction.InitNativeMouseEvent(this.app.divHost)},R=function(){function t(t){var e=document.getElementById(t);e&&(this.divHost=e),this.asset=new o,this.viewWrapper=new n(this),this.graphicsCoreWrapper=new l(this),this.sceneWrapper=new w(this),this.io=new A(this)}return t.Init=function(e){new t(e)},t.prototype.MouseEventController=function(t){this.sceneWrapper.activeCommandController.MouseEventController(t)},t.prototype.Resize=function(t,e){this.graphicsCoreWrapper.Resize(t,e)},t.prototype.Dispose=function(){this.graphicsCoreWrapper.Dispose(),this.sceneWrapper.Dispose()},t.prototype.Dummy=function(){},t}()}}]);