"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[2104],{2104:(t,e,i)=>{i.r(e),i.d(e,{AppImageEditing:()=>V});var r,a=i(9923),s=function(){function t(t){this.app=t}return Object.defineProperty(t.prototype,"setTypeImageCompression",{set:function(t){this.app.core.canvas.typeImageCompression=t},enumerable:!1,configurable:!0}),t.prototype.shiftEnvironment=function(t){this.app.param.environment=t,this.app.core.scene.shiftEnvironment(t),this.app.core.canvas.renderForce()},t.prototype.onClickDestroy=function(){this.app.core.destroy();try{this.app.ui?this.app.ui.divExpressImageEditingWrapper.parentNode.removeChild(this.app.ui.divExpressImageEditingWrapper):this.app.core.div.parentNode.removeChild(this.app.core.div)}catch(t){console.debug(t)}this.app.emitAction("destroy")},t.prototype.activateEffectEnv=function(t){this.app.core.activeCommand.activateEffectEnv(t)},t.prototype.deactivateEffectEnv=function(){this.app.core.activeCommand.deactivateEffectEnv()},t.prototype.onClickPlace=function(){this.app.core.activeCommand.emitDataToSave(),this.onClickDestroy()},t.prototype.onClickCancel=function(){this.onClickDestroy()},t.prototype.onClickReset=function(){},t.prototype.onClickUndo=function(){this.app.core.scene.undo()},t.prototype.onClickRedo=function(){this.app.core.scene.redo()},t.prototype.onClickRevertToOriginal=function(){this.app.core.activeCommand.revertToOriginal()},t.prototype.onClickDownload=function(){},t.prototype.onClickCapture=function(){},t.prototype.initEffect=function(t){this.app.core.activeCommand.updateEffect(t,!1),this.app.core.filter.emitFilterData()},t.prototype.updateEffect=function(t,e){void 0===e&&(e=!0),this.app.core.activeCommand.updateEffect(t,e)},t.prototype.getGeometryLength=function(){return this.app.core.scene.dataGeometries.length},t.prototype.updateCropDOM=function(){this.app.core.frame.renderer.updateSVG()},t.prototype.getFrameSize=function(){return this.app.core.frame.frameSize},t.prototype.onClickShiftShape=function(t){this.app.core.frame.frameShapeType=t,this.app.core.renderer.captureCanvas(),this.app.core.common.captureState()},t.prototype.onClickShiftShapeRatio=function(t){this.app.core.frame.frameRatioType=t,this.app.core.renderer.initPostSaveImg=!0,this.app.core.renderer.captureCanvas(),this.app.core.common.captureState()},t.prototype.onRotateCropping=function(t){this.app.core.common.rotationByDegree(t)},t.prototype.onDragRotate=function(t){this.app.core.common.rotate(t)},t.prototype.onDragZoom=function(t){this.app.core.common.scale(t)},t.prototype.onZoomLevel=function(t){this.app.core.common.scaleByLevel(t)},t.prototype.inputImportByURL=function(t){this.app.core.common.reset(),this.app.core.importImage(t)},t.prototype.initFrame=function(t,e,i,r,a,s,o,n){this.updateFrame(t,e,i,r,a,s,o,n),this.app.core.filter.update(!1),this.app.core.scene.captureState()},t.prototype.updateFrame=function(t,e,i,r,a,s,o,n){this.app.core.frame.updateFrame(t,e,i,r,a,s,o,n),this.app.core.canvas.renderForce()},t.prototype.updateFrameParam=function(t,e,i,r,a,s,o,n){this.app.core.frame.updateFrameParam(t,e,i,r,a,s,o,n),this.app.core.renderer.captureCanvas()},t.prototype.updateGeometries=function(t){this.app.core.scene.dataGeometries=t},t.prototype.shiftFilterPreset=function(t){this.app.core.filter.shiftEffectByPreset(t)},t.prototype.setScaleGlobal=function(t){this.app.core.scene.scaleByRatio=t},t.prototype.getData=function(t){return void 0===t&&(t=!1),t&&this.app.core.activeCommand.forceRevertToOriginal(),{ctx:this.getCtx(),ctxFiltered:this.getCtxFiltered(),params:this.getParams(),drawing:this.getDrawing(),effecting:this.getEffecting()}},t.prototype.getEffecting=function(){return this.app.core.filter.getData()},t.prototype.getDrawing=function(){return this.app.core.scene.dataGeometries},t.prototype.getParams=function(){return this.app.core.activeCommand.getParamsCropping()},t.prototype.getImage=function(){return this.app.core.canvas.capture()},t.prototype.getCtx=function(){return this.app.core.canvas.captureCtx()},t.prototype.getCtxFiltered=function(){return this.app.core.canvas.captureCtxFiltered()},t.prototype.updateCoverColor=function(t){var e=[(0,a.rW)(t)],i=[e[0][0],e[0][1],e[0][2]],r=(0,a.XL)(i[0],i[1],i[2]),s=function(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;var r=Array(t),a=0;for(e=0;e<i;e++)for(var s=arguments[e],o=0,n=s.length;o<n;o++,a++)r[a]=s[o];return r}(r);r[0]+=0,r[1]+=-.05,r[1]<0&&(r[1]=0),r[2]+=0,s[0]+=0,s[1]+=0,s[1]<0&&(s[1]=0),s[2]+=-.02;var o=(0,a.wX)(s[0],s[1],s[2]);this.app.core.frame.updateColorBG(o[0],o[1],o[2])},t}(),o=function(t){var e=this;this.touchPre=[-100,-100],this.touchstart=function(t){e.controller.canvas.core.renderer.t=0;var i=e.controller.canvas.canvas.getBoundingClientRect(),r=t.targetTouches[0].pageX-i.left,a=t.targetTouches[0].pageY-i.top;e.touchPre[0]=r,e.touchPre[1]=a,e.controller.canvas.core.activeCommand.touchStartRotation=!0,e.controller.canvas.core.activeCommand.touchStartScale=!0,e.controller.canvas.core.activeCommand.pointDown(t.targetTouches[0].clientX,t.targetTouches[0].clientY)},this.touchmove=function(t){if(t.targetTouches.length>1)return e.controller.canvas.core.activeCommand.rotationByTouch(t),void e.controller.canvas.core.activeCommand.scaleByTouch(t);e.controller.canvas.core.activeCommand.pointDrag(t.targetTouches[0].clientX,t.targetTouches[0].clientY)},this.touchcancel=function(t){e.controller.canvas.core.activeCommand.touchStartRotation=!1,e.controller.canvas.core.activeCommand.touchStartScale=!1,t.preventDefault()},this.touchend=function(t){e.controller.canvas.core.activeCommand.pointUp(-1,-1)},this.controller=t},n=function(t){var e=this;this.mouseDown=function(t){e.controller.canvas.core.activeCommand.pointDown(t.clientX,t.clientY)},this.mouseUp=function(t){e.controller.canvas.core.activeCommand.pointUp(t.clientX,t.clientY)},this.mouseWheel=function(t,i){e.controller.canvas.core.activeCommand.zoom(t.deltaY)},this.mouseMove=function(t){e.controller.canvas.core.activeCommand.isDown?e.controller.canvas.core.activeCommand.pointDrag(t.clientX,t.clientY):e.controller.canvas.core.activeCommand.pointMove(t.clientX,t.clientY)},this.controller=t},h=function(t){var e=this;this.keyDown=function(t){e.controller.canvas.core.activeCommand.hasShift=t.shiftKey},this.keyUp=function(t){e.controller.canvas.core.activeCommand.hasShift=t.shiftKey},this.controller=t},c=function(){function t(t){var e=this;this.resizeWindow=function(){e.canvas.core.app.api.updateCropDOM(),e.canvas.renderForce()},this.canvas=t,this.touchInteraction=new o(this),this.mouseInteraction=new n(this),this.keyboardInteraction=new h(this)}return t.prototype.appendEvent=function(){var t=this;document.body.addEventListener("keydown",t.keyboardInteraction.keyDown,!1),document.body.addEventListener("keyup",t.keyboardInteraction.keyUp,!1),document.body.addEventListener("mousedown",t.mouseInteraction.mouseDown,!1),document.body.addEventListener("mouseup",t.mouseInteraction.mouseUp,!1),document.body.addEventListener("mousemove",t.mouseInteraction.mouseMove,!1),this.canvas.canvas.addEventListener("wheel",(function(e){return t.mouseInteraction.mouseWheel(e,e.deltaY)}),!1),document.body.addEventListener("touchstart",t.touchInteraction.touchstart,!1),document.body.addEventListener("touchmove",t.touchInteraction.touchmove,!1),document.body.addEventListener("touchcancel",t.touchInteraction.touchcancel,!1),document.body.addEventListener("touchend",t.touchInteraction.touchend,!1),window.addEventListener("resize",t.resizeWindow,!1)},t.prototype.removeEvent=function(){var t=this;document.body.removeEventListener("keydown",t.keyboardInteraction.keyDown,!1),document.body.removeEventListener("keyup",t.keyboardInteraction.keyUp,!1),document.body.removeEventListener("mousedown",t.mouseInteraction.mouseDown,!1),document.body.removeEventListener("mouseup",t.mouseInteraction.mouseUp,!1),document.body.removeEventListener("mousemove",t.mouseInteraction.mouseMove,!1),document.body.removeEventListener("touchstart",t.touchInteraction.touchstart,!1),document.body.removeEventListener("touchmove",t.touchInteraction.touchmove,!1),document.body.removeEventListener("touchcancel",t.touchInteraction.touchcancel,!1),document.body.removeEventListener("touchend",t.touchInteraction.touchend,!1),window.removeEventListener("resize",t.resizeWindow,!1)},t}(),p=function(){function t(t){this.isActive=!1,this.isViewChanging=!1,this.loopNum=0,this.needRenderloop=!0,this.ablePan=!0,this.loopNeeded=!1,this.typeImageCompression=a.__.Png,this.loopNumMax=90,this.needcheckerboardbackground=!1,this.core=t,this.loopNeeded=!1,this.eventController=new c(this),this.imgOut=new Image,this.imgOut.crossOrigin="anonymous",this.init(),this.loopInit()}return t.prototype.init=function(){var t=document.createElement("canvas"),e=document.createElement("canvas"),i=document.createElement("canvas");if(t&&e&&i){this.canvas=t,this.canvas.id="editing-view",this.canvas.width=this.core.div.clientWidth,this.canvas.height=this.core.div.clientHeight,this.canvas.style.width="100%",this.canvas.style.height="100%",this.needcheckerboardbackground&&(this.canvas.style.background="repeating-conic-gradient(#cccccc 0% 25%, #ffffff 0% 50%) 50% / 10px 10px"),this.core.div.append(this.canvas),this.canvasOutFiltered=e,this.canvasOutFiltered.style.border="5px",this.ctxOutFiltered=this.canvasOutFiltered.getContext("2d"),this.canvasOut=i,this.ctxOut=this.canvasOut.getContext("2d");var r=this.canvas.getContext("2d");r&&(this.ctx=r,this.isActive=!0,this.initEvent())}},t.prototype.initEvent=function(){this.eventController.appendEvent()},t.prototype.capture=function(){return this.imgOut.src=this.canvasOutFiltered.toDataURL("image/"+this.typeImageCompression,.8),this.imgOut},t.prototype.captureCtxFiltered=function(){return this.ctxOutFiltered},t.prototype.captureCtx=function(){return this.ctxOut},t.prototype.loopInit=function(){this.needRenderloop=!0,this.loop()},t.prototype.resize=function(){this.canvas.width=this.core.div.clientWidth,this.canvas.height=this.core.div.clientHeight},t.prototype.loop=function(){var t=this;if(this.needRenderloop&&(requestAnimationFrame((function(){t.loop()})),this.loopNum++<100&&this.loopNum++<this.loopNumMax)){var e=performance.now();this.renderPre(this.ctx);var i=performance.now();this.log="level: , total frames: "+this.loopNum+++" (FPS: ), a loop took: "+(i-e).toFixed(2)+" ms to execute."}},t.prototype.clear=function(t){t.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height)},t.prototype.drawBackgroundWhite=function(t){this.typeImageCompression,a.__.Jpeg},t.prototype.renderForce=function(){this.loopNum=0},t.prototype.renderPre=function(t){this.isActive&&(this.clear(t),this.drawBackgroundWhite(t),this.render(t))},t.prototype.render=function(t){},t.prototype.destroy=function(){this.needRenderloop=!1,this.loopNum=this.loopNumMax,this.eventController.removeEvent();try{this.core.div.removeChild(this.canvas)}catch(t){}},t}(),d=function(){function t(t){this.core=t}return t.prototype.undo=function(){console.log("undo")},t.prototype.redo=function(){console.log("undo")},t.prototype.import=function(t){this.reset()},t.prototype.reset=function(){this.core.reset()},t.prototype.updateCursor=function(){this.core.frame.isHover?-1===this.core.frame.idHover?this.core.activeCommand.activeCursor.dragging():0===this.core.frame.idHover||2===this.core.frame.idHover?this.core.activeCommand.activeCursor.set_nwse_resize():1===this.core.frame.idHover||3===this.core.frame.idHover?this.core.activeCommand.activeCursor.set_nesw_resize():5===this.core.frame.idHover||7===this.core.frame.idHover?this.core.activeCommand.activeCursor.set_ew_resize():4!==this.core.frame.idHover&&6!==this.core.frame.idHover||this.core.activeCommand.activeCursor.set_ns_resize():this.core.activeCommand.activeCursor.default()},t.prototype.updateWidthByInput=function(t){t<this.core.frame.widthMin?this.core.frame.width=this.core.frame.widthMin:t+this.core.frame.x>this.core.imageWrapper.img.width?this.core.frame.width=this.core.imageWrapper.img.width-this.core.frame.x:this.core.frame.width=t,this.updateSizeByInputPost()},t.prototype.updateHeightByInput=function(t){t<this.core.frame.heightMin?this.core.frame.height=this.core.frame.heightMin:t+this.core.frame.y>this.core.imageWrapper.img.height?this.core.frame.height=this.core.imageWrapper.img.height-this.core.frame.y:this.core.frame.height=t,this.updateSizeByInputPost()},t.prototype.updateSizeByInputPost=function(){this.core.frame.update(),this.core.canvas.renderForce(),this.core.canvas.canvasOutFiltered.width=this.core.frame.width,this.core.canvas.canvasOutFiltered.height=this.core.frame.height},t.prototype.offsetByInput=function(t){0!==this.core.frame.idSelected&&4!==this.core.frame.idSelected&&7!==this.core.frame.idSelected||(t*=-1),this.core.frame.offsetByIDFreeform(this.core.frame.idSelected,t,t)},t.prototype.rotate=function(t){this.core.activeCommand.rotationRadian=t,this.postUpdate()},t.prototype.rotationByDegree=function(t){this.core.activeCommand.rotationRadian+=(0,a.Yr)(t),this.postUpdate()},t.prototype.scale=function(t){this.core.activeCommand.zoomLevel=t,this.postUpdate()},t.prototype.scaleByLevel=function(t){t=(t=(t+=this.core.activeCommand.zoomLevel)<.75?.75:t)>1.25?1.25:t,this.core.activeCommand.zoomLevel=t,this.postUpdate()},t.prototype.downloadImage=function(t){var e=document.createElement("a");e.href=t?t.src:this.core.canvas.canvasOutFiltered.toDataURL(),e.download="image.png",document.body.appendChild(e),e.click(),document.body.removeChild(e)},t.prototype.postUpdate=function(){this.core.filter.numRendered=0,this.core.filter.update(!1,!1),this.core.canvas.renderForce()},t.prototype.captureState=function(){this.core.scene.captureState()},t}(),l=function(){function t(t){var e=this;this.isDown=!1,this.isDrag=!1,this.mousePre=[0,0],this.mouse=[0,0],this.mouseRemapValue=[1,1],this.zoomLevel=1,this.rotationRadian=0,this.scalePre=1,this.anglePre=0,this.touchStartRotation=!1,this.touchStartScale=!1,this.hasShift=!1,this.clickUI=!1,this.topToleranceForClickUI=-25,this.mouseDragRect=function(t,i){e.core.frame.translate(e.mouse[0],e.mouse[1]),e.mousePre[0]=e.mouse[0],e.mousePre[1]=e.mouse[1]},this.mouseDragPan=function(t,i){e.pan(e.mouse[0],e.mouse[1])},this.core=t,this.activeCursor=new a.$b}return t.prototype.toScreen=function(t,e){return[t/this.core.activeCommand.mouseRemapValue[0],e/this.core.activeCommand.mouseRemapValue[1]]},t.prototype.mousePostProcess=function(t,e){this.canvasBounding=this.core.canvas.canvas.getBoundingClientRect(),this.mouseRemapValue[0]=this.core.imageWrapper.img.width/this.canvasBounding.width,this.mouseRemapValue[1]=this.core.imageWrapper.img.height/this.canvasBounding.height,this.mouse[0]=(t-this.canvasBounding.left)*this.core.imageWrapper.img.width/this.canvasBounding.width,this.mouse[1]=(e-this.canvasBounding.top)*this.core.imageWrapper.img.height/this.canvasBounding.height,e-this.canvasBounding.top<this.topToleranceForClickUI?this.clickUI=!0:this.clickUI=!1},t.prototype.pointDown=function(t,e){this.mousePostProcess(t,e),this.isDown=!0,this.core.frame.isHoverCheck(this.mouse[0],this.mouse[1]),this.core.frame.updateVecPre(),this.mousePre[0]=this.mouse[0],this.mousePre[1]=this.mouse[1],this.core.common.postUpdate()},t.prototype.pointUp=function(t,e){this.mousePostProcess(t,e),this.isDrag=!1,this.isDown=!1,this.core.frame.mouseUp(),this.core.common.postUpdate(),this.core.frame.isMoved()&&(this.core.common.captureState(),this.core.renderer.captureCanvas())},t.prototype.pointMove=function(t,e){this.mousePostProcess(t,e),this.core.frame.isHoverCheck(this.mouse[0],this.mouse[1]),this.mousePre[0]=this.mouse[0],this.mousePre[1]=this.mouse[1],this.core.common.updateCursor(),this.core.common.postUpdate()},t.prototype.pointDrag=function(t,e){this.isDrag=!0,this.mousePostProcess(t,e),this.core.frame.isHover?this.mouseDragRect(this.mouse[0],this.mouse[1]):this.mouseDragPan(this.mouse[0],this.mouse[1]),this.core.common.postUpdate()},t.prototype.zoom=function(t){},t.prototype.pan=function(t,e){},t.prototype.revertToOriginal=function(){this.core.renderer.captureCanvas(),this.core.frame.revertToOriginal(),this.core.canvas.capture()},t.prototype.forceRevertToOriginal=function(){this.core.renderer.updateCtxForce()},t.prototype.rotationByTouch=function(t){var e,i;this.core.canvas.renderForce(),t.targetTouches[0].clientY<t.targetTouches[1].clientY?(e=t.targetTouches[0],i=t.targetTouches[1]):(e=t.targetTouches[1],i=t.targetTouches[0]);var r=Math.atan2(i.clientX-e.clientX,i.clientY-e.clientY),a=this.anglePre-r;if(this.touchStartRotation)return this.anglePre=this.rotationRadian,this.touchStartRotation=!1,void(this.anglePre=r);this.rotationRadian+=a,this.anglePre=r},t.prototype.scaleByTouch=function(t){var e,i;this.core.canvas.renderForce(),t.targetTouches[0].clientY<t.targetTouches[1].clientY?(e=t.targetTouches[0],i=t.targetTouches[1]):(e=t.targetTouches[1],i=t.targetTouches[0]);var r=Math.sqrt((i.clientX-e.clientX)*(i.clientX-e.clientX)+(i.clientY-e.clientY)*(i.clientY-e.clientY));if(this.scalePre>r?this.zoomLevel>.4&&(this.zoomLevel-=.015):this.zoomLevel<2&&(this.zoomLevel+=.015),this.touchStartScale)return this.scalePre=this.zoomLevel,this.touchStartScale=!1,void(this.scalePre=r);this.scalePre=r},t.prototype.getParamsCropping=function(){return{x:Math.round(this.core.frame.x),y:Math.round(this.core.frame.y),width:Math.round(this.core.frame.width),height:Math.round(this.core.frame.height),scale:this.core.activeCommand.zoomLevel,rotationRadian:this.core.activeCommand.rotationRadian,shape:this.core.frame.frameShapeType,aspectRatio:this.core.frame.frameRatioType}},t.prototype.getParamsFilter=function(){return this.core.filter.getData()},t.prototype.emitDataToSave=function(){var t={crop:this.getParamsCropping(),filter:this.getParamsFilter()};this.core.app.emitAction("update@"+JSON.stringify(t))},t.prototype.emitUndoRedoHistory=function(t){var e="history@"+JSON.stringify(t);this.core.app.emitAction(e)},t.prototype.updateEffect=function(t,e){void 0===e&&(e=!0),this.core.filter.updateEffect(t,e)},t.prototype.activateEffectEnv=function(t){"markup"!==t&&this.core.scene.resetState(),this.core.filter.activateEffectEnv(),this.core.frame.renderer.hide=!0,this.core.app.emitAction("ready@filter")},t.prototype.deactivateEffectEnv=function(){this.core.scene.resetState(),this.core.filter.deactivateEffectEnv(),this.core.frame.renderer.hide=!1,this.core.app.emitAction("ready@crop")},t}(),m=function(){function t(t){this.renderer=t,this.svgRectFrame=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svgRectFrame.setAttribute("width","102"),this.svgRectFrame.setAttribute("height","102"),this.svgRectFrame.setAttribute("fill-opacity","0"),this.svgRectFrame.style.position="absolute",this.renderer.frame.core.div.appendChild(this.svgRectFrame);var e=document.createElementNS("http://www.w3.org/2000/svg","rect");e.setAttribute("x","1"),e.setAttribute("y","1"),e.setAttribute("stroke-width","1"),e.setAttribute("stroke","#CBDAE2"),this.svgRec=e,this.svgRectFrame.appendChild(e),this.lineX0=document.createElementNS("http://www.w3.org/2000/svg","line"),this.lineX0.setAttribute("stroke-width","1"),this.lineX0.setAttribute("stroke","#CBDAE2"),this.svgRectFrame.appendChild(this.lineX0),this.lineX1=document.createElementNS("http://www.w3.org/2000/svg","line"),this.lineX1.setAttribute("stroke-width","1"),this.lineX1.setAttribute("stroke","#CBDAE2"),this.svgRectFrame.appendChild(this.lineX1),this.lineY0=document.createElementNS("http://www.w3.org/2000/svg","line"),this.lineY0.setAttribute("stroke-width","1"),this.lineY0.setAttribute("stroke","#CBDAE2"),this.svgRectFrame.appendChild(this.lineY0),this.lineY1=document.createElementNS("http://www.w3.org/2000/svg","line"),this.lineY1.setAttribute("stroke-width","1"),this.lineY1.setAttribute("stroke","#CBDAE2"),this.svgRectFrame.appendChild(this.lineY1),this.svgRectControl0=(0,a.R4)(),this.renderer.frame.core.div.appendChild(this.svgRectControl0),this.svgRectControl1=(0,a.R4)(),this.renderer.frame.core.div.appendChild(this.svgRectControl1),this.svgRectControl2=(0,a.R4)(),this.renderer.frame.core.div.appendChild(this.svgRectControl2),this.svgRectControl3=(0,a.R4)(),this.renderer.frame.core.div.appendChild(this.svgRectControl3),this.svgRectControl4=(0,a.R4)(8,24),this.renderer.frame.core.div.appendChild(this.svgRectControl4),this.svgRectControl5=(0,a.R4)(24),this.renderer.frame.core.div.appendChild(this.svgRectControl5),this.svgRectControl6=(0,a.R4)(8,24),this.renderer.frame.core.div.appendChild(this.svgRectControl6),this.svgRectControl7=(0,a.R4)(24),this.renderer.frame.core.div.appendChild(this.svgRectControl7)}return t.prototype.updatePos=function(){if(this.renderer.frame.core.canvas||this.renderer.frame.core.canvas.ctx){var t=this.renderer.frame.core.canvas.ctx;if(void 0!==t.canvas.parentElement&&void 0!==t.canvas.parentElement.parentElement){var e=t.canvas.getBoundingClientRect(),i=e.height,r=t.canvas.parentElement.parentElement.parentElement.parentElement.getBoundingClientRect().height-i,a=0;r>0&&(a=.5*r);var s=-29,o=-5+a;this.svgRectControl0.style.left=e.x+s+this.renderer.frame.x*e.width/t.canvas.width+1+"px",this.svgRectControl0.style.top=o+this.renderer.frame.y*e.height/t.canvas.height+"px",this.svgRectControl1.style.left=e.x+s+(this.renderer.frame.x+this.renderer.frame.width)*e.width/t.canvas.width+"px",this.svgRectControl1.style.top=o+this.renderer.frame.y*e.height/t.canvas.height+"px",this.svgRectControl2.style.left=e.x+s+(this.renderer.frame.x+this.renderer.frame.width)*e.width/t.canvas.width+"px",this.svgRectControl2.style.top=o+(this.renderer.frame.y+this.renderer.frame.height)*e.height/t.canvas.height+"px",this.svgRectControl3.style.left=e.x+s+this.renderer.frame.x*e.width/t.canvas.width+1+"px",this.svgRectControl3.style.top=o+(this.renderer.frame.y+this.renderer.frame.height)*e.height/t.canvas.height+"px",this.svgRectControl4.style.left=e.x+s+this.renderer.frame.x*e.width/t.canvas.width+1+"px",this.svgRectControl4.style.top=-8+parseInt(this.svgRectControl0.style.top)+.5*(parseInt(this.svgRectControl2.style.top)-parseInt(this.svgRectControl0.style.top))+"px",this.svgRectControl5.style.left=.5*(parseInt(this.svgRectControl0.style.left)+parseInt(this.svgRectControl2.style.left))-7+"px",this.svgRectControl5.style.top=o+this.renderer.frame.y*e.height/t.canvas.height+"px",this.svgRectControl6.style.left=e.x+s+(this.renderer.frame.x+this.renderer.frame.width)*e.width/t.canvas.width+"px",this.svgRectControl6.style.top=-8+parseInt(this.svgRectControl0.style.top)+.5*(parseInt(this.svgRectControl2.style.top)-parseInt(this.svgRectControl0.style.top))+"px",this.svgRectControl7.style.left=.5*(parseInt(this.svgRectControl0.style.left)+parseInt(this.svgRectControl2.style.left))-7+"px",this.svgRectControl7.style.top=o+(this.renderer.frame.y+this.renderer.frame.height)*e.height/t.canvas.height+"px",this.svgRectFrame.style.left=parseInt(this.svgRectControl0.style.left)+4+"px",this.svgRectFrame.style.top=parseInt(this.svgRectControl0.style.top)+4+1+"px",this.svgRectFrame.style.width=parseInt(this.svgRectControl1.style.left)-parseInt(this.svgRectFrame.style.left)+4+2+"px",this.svgRectFrame.style.height=parseInt(this.svgRectControl2.style.top)-parseInt(this.svgRectFrame.style.top)+4+2+"px",this.svgRec.style.width=parseInt(this.svgRectControl1.style.left)-parseInt(this.svgRectFrame.style.left)+4+"px",this.svgRec.style.height=parseInt(this.svgRectControl2.style.top)-parseInt(this.svgRectFrame.style.top)+4+"px",this.lineX0.setAttribute("x1","1"),this.lineX0.setAttribute("y1",""+.33*parseInt(this.svgRectFrame.style.height)),this.lineX0.setAttribute("x2",""+parseInt(this.svgRectFrame.style.width)),this.lineX0.setAttribute("y2",""+(.33*parseInt(this.svgRectFrame.style.height)+1)),this.lineX1.setAttribute("x1","1"),this.lineX1.setAttribute("y1",""+.66*parseInt(this.svgRectFrame.style.height)),this.lineX1.setAttribute("x2",""+parseInt(this.svgRectFrame.style.width)),this.lineX1.setAttribute("y2",""+(.66*parseInt(this.svgRectFrame.style.height)+1)),this.lineY0.setAttribute("x1",""+.33*parseInt(this.svgRectFrame.style.width)),this.lineY0.setAttribute("y1","1"),this.lineY0.setAttribute("x2",""+.33*parseInt(this.svgRectFrame.style.width)),this.lineY0.setAttribute("y2",""+(parseInt(this.svgRectFrame.style.height)-1)),this.lineY1.setAttribute("x1",""+.66*parseInt(this.svgRectFrame.style.width)),this.lineY1.setAttribute("y1","1"),this.lineY1.setAttribute("x2",""+.66*parseInt(this.svgRectFrame.style.width)),this.lineY1.setAttribute("y2",""+(parseInt(this.svgRectFrame.style.height)-1))}}},Object.defineProperty(t.prototype,"hide",{set:function(t){var e=!0===t?"none":"block";this.svgRectControl0.style.display=e,this.svgRectControl1.style.display=e,this.svgRectControl2.style.display=e,this.svgRectControl3.style.display=e,this.svgRectControl4.style.display=e,this.svgRectControl5.style.display=e,this.svgRectControl6.style.display=e,this.svgRectControl7.style.display=e,this.svgRec.style.display=e,this.lineX0.style.display=e,this.lineX1.style.display=e,this.lineY0.style.display=e,this.lineY1.style.display=e},enumerable:!1,configurable:!0}),t}(),u=function(){function t(t){this._opacity=0,this._time=0,this._tSVG=0,this._fillStyleRuntime="",this._fillStyle=[200,200,200,1],this._fillStyleHover=[200,200,200,.5],this._sizePoint=3,this._sizeMidPoint=3,this.isActive=!1,this.needtoHideSVG=!1,this.frame=t}return t.prototype.initPost=function(){this.isActive||(this.rendererSVG=new m(this),this.needtoHideSVG&&(this.rendererSVG.hide=!1)),this.isActive=!0},Object.defineProperty(t.prototype,"sizePoint",{get:function(){return this._sizePoint},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sizeMidPoint",{get:function(){return this._sizeMidPoint},enumerable:!1,configurable:!0}),t.prototype.updateColorBG=function(t,e,i){this._fillStyle[0]=t,this._fillStyle[1]=e,this._fillStyle[2]=i,this._fillStyleHover[0]=t,this._fillStyleHover[1]=e,this._fillStyleHover[2]=i},t.prototype.render=function(t){this.isActive&&(this.ColorInterpolation(),this.frame.isHover,t.fillStyle=this._fillStyleRuntime,this.trimContextByShape(t,!0),this.renderPost(t),this._time+=.15)},t.prototype.trimContextByShape=function(t,e){void 0===e&&(e=!0),(0,a.CU)(t,this.frame.frameShapeType,this.frame.x,this.frame.y,this.frame.width,this.frame.height,e)},t.prototype.updateSVG=function(){this.isActive&&(this._tSVG=0)},t.prototype.renderPost=function(t){if(this.frame.isHover)for(var e=0;e<this.frame.cpList.length;++e);this._tSVG++<50&&this.rendererSVG.updatePos()},t.prototype.ColorInterpolation=function(){this.frame.isHover?this._opacity+=.025:this._opacity-=.015,this._opacity>.7&&(this._opacity=.7),this._opacity<.35&&(this._opacity=.35);var t=(0,a.Hq)(this._fillStyle,this._fillStyleHover,this._opacity);this._fillStyleRuntime="rgba("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},t.prototype.updateGeometry=function(t){},Object.defineProperty(t.prototype,"hide",{set:function(t){this.isActive&&(this.rendererSVG.hide=t)},enumerable:!1,configurable:!0}),t}();!function(t){t.Endpoint="Endpoint",t.Midpoint="Midpoint"}(r||(r={}));var f,v,g=function(){function t(t,e,i){this.frame=t,this.id=e,this.type=i,this.update()}return t.prototype.isHoverCheck=function(t,e){var i=this.frame.core.activeCommand.toScreen(this.x,this.y),r=i[0],s=i[1],o=this.frame.core.activeCommand.toScreen(t,e),n=o[0],h=o[1];return(0,a.TE)(r,s,n,h)<this.frame.r?this.id:-1},t.prototype.update=function(){this.type===r.Endpoint?0===this.id?(this.x=this.frame.x,this.y=this.frame.y):1===this.id?(this.x=this.frame.x+this.frame.width,this.y=this.frame.y):2===this.id?(this.x=this.frame.x+this.frame.width,this.y=this.frame.y+this.frame.height):3===this.id&&(this.x=this.frame.x,this.y=this.frame.y+this.frame.height):this.type===r.Midpoint&&(4===this.id?(this.x=this.frame.x+.5*this.frame.width,this.y=this.frame.y):5===this.id?(this.x=this.frame.x+this.frame.width,this.y=this.frame.y+.5*this.frame.height):6===this.id?(this.x=this.frame.x+.5*this.frame.width,this.y=this.frame.y+this.frame.height):7===this.id&&(this.x=this.frame.x,this.y=this.frame.y+.5*this.frame.height))},t.prototype.render=function(t){this.type===r.Endpoint?0===this.id?(0,a.hL)(t,this.frame.x,this.frame.y,this.frame.renderer.sizePoint,this.frame.renderer.sizePoint):1===this.id?(0,a.hL)(t,this.frame.x+this.frame.width,this.frame.y,this.frame.renderer.sizePoint,this.frame.renderer.sizePoint):2===this.id?(0,a.hL)(t,this.frame.x+this.frame.width,this.frame.y+this.frame.height,this.frame.renderer.sizePoint,this.frame.renderer.sizePoint):3===this.id&&(0,a.hL)(t,this.frame.x,this.frame.y+this.frame.height,this.frame.renderer.sizePoint,this.frame.renderer.sizePoint):this.type===r.Midpoint&&(4===this.id?(0,a.hL)(t,this.frame.x+.5*this.frame.width,this.frame.y,4*this.frame.renderer.sizeMidPoint,this.frame.renderer.sizeMidPoint):5===this.id?(0,a.hL)(t,this.frame.x+this.frame.width,this.frame.y+.5*this.frame.height,this.frame.renderer.sizeMidPoint,4*this.frame.renderer.sizeMidPoint):6===this.id?(0,a.hL)(t,this.frame.x+.5*this.frame.width,this.frame.y+this.frame.height,4*this.frame.renderer.sizeMidPoint,this.frame.renderer.sizeMidPoint):7===this.id&&(0,a.hL)(t,this.frame.x,this.frame.y+.5*this.frame.height,this.frame.renderer.sizeMidPoint,4*this.frame.renderer.sizeMidPoint))},t}(),y=function(){function t(t){this.safeguardForDraggingOutOfExtent=!0,this.frame=t}return t.prototype.offsetByIDConstraint=function(t,e,i){var r,s;e=e<0?0:e,i=i<0?0:i;var o,n=[this.frame.width,this.frame.height];switch(t){case 0:if(r=this.frame.x-e,o=(0,a.kC)(n[0],n[1],n[0]+r),this.frame.y+n[1]-o[1]<-1){if(this.safeguardForDraggingOutOfExtent){if(this.frame.y<1)break;r=1,o=(0,a.kC)(n[0],n[1],n[0]+r),this.frame.x-=1,this.frame.width=o[0],this.frame.y+=n[1]-o[1],this.frame.height=o[1]}break}if(this.frame.widthMin>o[0]||this.frame.heightMin>o[1])break;this.frame.x=e,this.frame.width=o[0],this.frame.y+=n[1]-o[1],this.frame.height=o[1];break;case 1:if(r=e-this.frame.x-this.frame.width,o=(0,a.kC)(n[0],n[1],n[0]+r),this.frame.y+n[1]-o[1]<-1||this.frame.x+o[0]>this.frame.core.canvas.canvas.width){if(this.safeguardForDraggingOutOfExtent){if(this.frame.y<-1||this.frame.x+this.frame.width>this.frame.core.canvas.canvas.width)break;r=1,o=(0,a.kC)(n[0],n[1],n[0]+r),this.frame.y+=n[1]-o[1],this.frame.width=o[0],this.frame.height=o[1]}break}if(this.frame.widthMin>o[0]||this.frame.heightMin>o[1])break;this.frame.y+=n[1]-o[1],this.frame.width=o[0],this.frame.height=o[1];break;case 2:if(r=e-this.frame.x-this.frame.width,o=(0,a.kC)(n[0],n[1],n[0]+r),this.frame.x+o[0]>this.frame.core.canvas.canvas.width||this.frame.y+o[1]>this.frame.core.canvas.canvas.height){if(this.safeguardForDraggingOutOfExtent){if(this.frame.x+this.frame.width>this.frame.core.canvas.canvas.width||this.frame.y+this.frame.height>this.frame.core.canvas.canvas.height)break;r=1,o=(0,a.kC)(n[0],n[1],n[0]+r),this.frame.width=o[0],this.frame.height-=n[1]-o[1]}break}if(this.frame.widthMin>o[0]||this.frame.heightMin>o[1])break;this.frame.width=o[0],this.frame.height-=n[1]-o[1];break;case 3:if(r=this.frame.x-e,o=(0,a.kC)(n[0],n[1],n[0]+r),this.frame.x-r<0||this.frame.y+o[1]>this.frame.core.canvas.canvas.height){if(this.safeguardForDraggingOutOfExtent){if(this.frame.y+this.frame.height+1>this.frame.core.canvas.canvas.height)break;r=1,o=(0,a.kC)(n[0],n[1],n[0]+r),this.frame.x-=o[0]-n[0],this.frame.width=o[0],this.frame.height-=n[1]-o[1]}break}this.frame.widthMin<o[0]&&this.frame.heightMin<o[1]&&(this.frame.x=e,this.frame.width=o[0],this.frame.height-=n[1]-o[1]);break;case 4:if(s=this.frame.y-i,o=(0,a.Ux)(n[0],n[1],n[1]+s),this.frame.x+.5*(n[0]-o[0])<0||this.frame.x+o[0]>this.frame.core.canvas.canvas.width){if(this.safeguardForDraggingOutOfExtent){if(this.frame.x<0||this.frame.x+this.frame.width-1>this.frame.core.canvas.canvas.width)break;s=1,o=(0,a.Ux)(n[0],n[1],n[1]+s),this.frame.x+=.5*(n[0]-o[0]),this.frame.width=o[0],this.frame.y+=-1,this.frame.height+=s}break}this.frame.height+s>=this.frame.heightMin&&(this.frame.x+=.5*(n[0]-o[0]),this.frame.width=o[0],this.frame.y=i,this.frame.height+=s);break;case 5:if(r=e-this.frame.x-this.frame.width,o=(0,a.kC)(n[0],n[1],n[0]+r),this.frame.y+.5*(n[1]-o[1])<0||this.frame.y+o[1]>this.frame.core.canvas.canvas.height){if(this.safeguardForDraggingOutOfExtent){if(this.frame.y<0||this.frame.y+this.frame.height>this.frame.core.canvas.canvas.height||this.frame.x+this.frame.width>this.frame.core.canvas.canvas.width)break;r=1,o=(0,a.kC)(n[0],n[1],n[0]+r),this.frame.y+=.5*(n[1]-o[1]),this.frame.width=o[0],this.frame.height=o[1]}break}this.frame.widthMin<=o[0]&&this.frame.heightMin<=o[1]&&e<=this.frame.core.canvas.canvas.width&&(this.frame.y+=.5*(n[1]-o[1]),this.frame.width=o[0],this.frame.height=o[1]);break;case 6:if(s=i-this.frame.y-this.frame.height,o=(0,a.Ux)(n[0],n[1],n[1]+s),this.frame.x+.5*(n[0]-o[0])<0||this.frame.x+o[0]>this.frame.core.canvas.canvas.width){if(this.safeguardForDraggingOutOfExtent){if(this.frame.x<-1||this.frame.x+this.frame.width>this.frame.core.canvas.canvas.width||this.frame.y+this.frame.height>this.frame.core.canvas.canvas.height)break;s=1,o=(0,a.Ux)(n[0],n[1],n[1]+s),this.frame.x+=.5*(n[0]-o[0]),this.frame.width=o[0],this.frame.height+=s}break}this.frame.height+s>=this.frame.heightMin&&i<=this.frame.core.canvas.canvas.height&&(this.frame.x+=.5*(n[0]-o[0]),this.frame.width=o[0],this.frame.height+=s);break;case 7:if(r=this.frame.x-e,o=(0,a.kC)(n[0],n[1],n[0]+r),this.frame.y+.5*(n[1]-o[1])<0||this.frame.y+o[1]>this.frame.core.canvas.canvas.height){if(this.safeguardForDraggingOutOfExtent){if(this.frame.y<1||this.frame.y+this.frame.height>this.frame.core.canvas.canvas.height)break;r=1,o=(0,a.kC)(n[0],n[1],n[0]+r),this.frame.x-=o[0]-n[0],this.frame.width+=r,this.frame.y+=.5*(n[1]-o[1]),this.frame.height=o[1]}break}this.frame.width+r>=this.frame.widthMin&&this.frame.height>=this.frame.heightMin&&(this.frame.x=e,this.frame.width+=r,this.frame.y+=.5*(n[1]-o[1]),this.frame.height=o[1]);break;default:if(r=e-this.frame.core.activeCommand.mousePre[0],s=i-this.frame.core.activeCommand.mousePre[1],r=this.frame.x+r<0?0:r,s=this.frame.y+s<0?0:s,0===e){this.frame.x=0;break}if(0===i){this.frame.y=0;break}if(this.frame.x+this.frame.width+r>this.frame.core.canvas.canvas.width){this.frame.x+=this.frame.core.canvas.canvas.width-this.frame.x-this.frame.width;break}if(this.frame.y+this.frame.height+s>this.frame.core.canvas.canvas.height){this.frame.y+=this.frame.core.canvas.canvas.height-this.frame.y-this.frame.height;break}this.frame.x+=r,this.frame.y+=s}this.updatePost()},t.prototype.offsetByIDFreeform=function(t,e,i){if(this.frame.core.activeCommand.hasShift)this.offsetByIDConstraint(t,e,i);else{var r,a;switch(e=e<0?0:e,i=i<0?0:i,t){case 0:r=this.frame.x-e,this.frame.width+r>=this.frame.widthMin&&(this.frame.x=e,this.frame.width+=r),a=this.frame.y-i,this.frame.height+a>=this.frame.heightMin&&(this.frame.y=i,this.frame.height+=a);break;case 1:if(r=e-this.frame.x-this.frame.width,this.frame.width+r>=this.frame.widthMin)if(this.frame.x+this.frame.width+r>this.frame.core.canvas.canvas.width){var s=this.frame.core.canvas.canvas.width-this.frame.x-this.frame.width;this.frame.width+=s}else this.frame.width+=r;a=this.frame.y-i,this.frame.height+a>=this.frame.heightMin&&(this.frame.y=i,this.frame.height+=a);break;case 2:r=e-this.frame.x<this.frame.widthMin?this.frame.widthMin:e-this.frame.x,a=i-this.frame.y<this.frame.heightMin?this.frame.heightMin:i-this.frame.y,r=this.frame.x+r>this.frame.core.canvas.canvas.width?this.frame.core.canvas.canvas.width-this.frame.x:r,a=this.frame.y+a>this.frame.core.canvas.canvas.height?this.frame.core.canvas.canvas.height-this.frame.y:a,this.frame.width=r,this.frame.height=a;break;case 3:r=this.frame.x-e,this.frame.width+r>=this.frame.widthMin&&(this.frame.x=e,this.frame.width+=r),a=i-this.frame.y<this.frame.heightMin?this.frame.heightMin:i-this.frame.y,this.frame.height=this.frame.y+a>this.frame.core.canvas.canvas.height?this.frame.core.canvas.canvas.height-this.frame.y:a;break;case 4:a=this.frame.y-i,this.frame.height+a>=this.frame.heightMin&&(this.frame.y=i,this.frame.height+=a);break;case 5:r=e-this.frame.x-this.frame.width,this.frame.width+r>=this.frame.widthMin&&(this.frame.x+this.frame.width+r>this.frame.core.canvas.canvas.width?(s=this.frame.core.canvas.canvas.width-this.frame.x-this.frame.width,this.frame.width+=s):this.frame.width+=r);break;case 6:a=i-this.frame.y<this.frame.heightMin?this.frame.heightMin:i-this.frame.y,this.frame.height=this.frame.y+a>this.frame.core.canvas.canvas.height?this.frame.core.canvas.canvas.height-this.frame.y:a;break;case 7:r=this.frame.x-e,this.frame.width+r>=this.frame.widthMin&&(this.frame.x=e,this.frame.width+=r);break;default:if(r=e-this.frame.core.activeCommand.mousePre[0],a=i-this.frame.core.activeCommand.mousePre[1],r=this.frame.x+r<0?0:r,a=this.frame.y+a<0?0:a,0===e){this.frame.x=0;break}if(0===i){this.frame.y=0;break}if(this.frame.x+this.frame.width+r>this.frame.core.canvas.canvas.width){this.frame.x+=this.frame.core.canvas.canvas.width-this.frame.x-this.frame.width;break}if(this.frame.y+this.frame.height+a>this.frame.core.canvas.canvas.height){this.frame.y+=this.frame.core.canvas.canvas.height-this.frame.y-this.frame.height;break}this.frame.x+=r,this.frame.y+=a}this.updatePost()}},t.prototype.updatePost=function(){this.updateGuides(),this.frame.update(),this.frame.core.filter.update(!1),this.frame.core.canvas.renderForce()},t.prototype.updateGuides=function(){this.frame.xOffGuid=this.frame.width/3,this.frame.yOffGuid=this.frame.height/3,this.updateCenterCV()},t.prototype.updateCenterCV=function(){this.frame.cv[0]=this.frame.x+.5*this.frame.width,this.frame.cv[1]=this.frame.y+.5*this.frame.height},t}(),x=function(){function t(t){this.tolerance=2.5,this.frame=t}return t.prototype.mouseUp=function(){this.frame.isHover=!1,-1!==this.frame.idHover&&(this.frame.idSelected=this.frame.idHover),this.checkSizeToOriginal()},t.prototype.isHoverCheck=function(t,e){for(var i=0;i<this.frame.cpList.length;++i){var r=this.frame.cpList[i].isHoverCheck(t,e);if(-1!==r)return this.frame.isHover=!0,this.frame.idHover=r,!0}return this.frame.x<t&&this.frame.x+this.frame.width>t&&this.frame.y<e&&this.frame.y+this.frame.height>e?(this.frame.idHover=-1,this.frame.isHover=!0,!0):(this.frame.idHover=-1,this.frame.isHover=!1,!1)},t.prototype.checkSizeToOriginal=function(){return this.frame.width<this.frame.core.imageWrapper.img.width+this.tolerance&&this.frame.width>this.frame.core.imageWrapper.img.width-this.tolerance&&this.frame.height<this.frame.core.imageWrapper.img.height+this.tolerance&&this.frame.height>this.frame.core.imageWrapper.img.height-this.tolerance?(this.frame.x=0,this.frame.y=0,this.frame.width=this.frame.core.imageWrapper.img.width,void(this.frame.height=this.frame.core.imageWrapper.img.height)):this.frame.width<this.frame.core.imageWrapper.img.width+this.tolerance&&this.frame.width>this.frame.core.imageWrapper.img.width-this.tolerance?(this.frame.x=0,void(this.frame.width=this.frame.core.imageWrapper.img.width)):this.frame.height<this.frame.core.imageWrapper.img.height+this.tolerance&&this.frame.height>this.frame.core.imageWrapper.img.height-this.tolerance?(this.frame.y=0,void(this.frame.height=this.frame.core.imageWrapper.img.height)):void 0},t}(),w=function(){function t(t){this.idHover=-1,this.idSelected=-1,this.isHover=!1,this.x=100,this.y=100,this.width=300,this.height=300,this.scale=1,this.rotation=0,this.xOffGuid=0,this.yOffGuid=0,this.r=19,this.cv=[0,0],this.cvPre=[0,0],this.cpList=[],this._widthMin=40,this._heightMin=40,this._frameRatioType=a.Nl.Original,this._frameShapeType=a.oU.Rectangle,this.core=t,this.init()}return t.prototype.init=function(){this.xOffGuid=this.width/3,this.yOffGuid=this.height/3,this.cpList=[new g(this,0,r.Endpoint),new g(this,1,r.Endpoint),new g(this,2,r.Endpoint),new g(this,3,r.Endpoint),new g(this,4,r.Midpoint),new g(this,5,r.Midpoint),new g(this,6,r.Midpoint),new g(this,7,r.Midpoint)],this.interaction=new x(this),this.transform=new y(this),this.renderer=new u(this)},Object.defineProperty(t.prototype,"frameRatioType",{get:function(){return this._frameRatioType},set:function(t){this._frameRatioType=t,this.setRatio(t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"widthMin",{get:function(){return this._widthMin*this.core.imageWrapper.img.width/this.core.activeCommand.canvasBounding.width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"heightMin",{get:function(){return this._heightMin*this.core.imageWrapper.img.height/this.core.activeCommand.canvasBounding.height},enumerable:!1,configurable:!0}),t.prototype.setRatio=function(t){var e=this.core.canvas.canvas.width,i=this.core.canvas.canvas.height,r=0;switch(this._frameRatioType){case a.Nl.Square:var s=this.core.canvas.canvas.width>this.core.canvas.canvas.height;s?this.updateFrameByRatio(i,i,s):this.updateFrameByRatio(e,e,s);break;case a.Nl.Fixed_3_2:e/i<(r=1.5)?this.updateFrameByRatio(e,e/r,!1):this.updateFrameByRatio(i*r,i,!0);break;case a.Nl.Fixed_4_3:e/i<(r=4/3)?this.updateFrameByRatio(e,e/r,!1):this.updateFrameByRatio(i*r,i,!0);break;case a.Nl.Fixed_16_9:e/i<(r=16/9)?this.updateFrameByRatio(e,e/r,!1):this.updateFrameByRatio(i*r,i,!0);break;case a.Nl.Original:this.initFrame()}},Object.defineProperty(t.prototype,"frameShapeType",{get:function(){return this._frameShapeType},set:function(t){this._frameShapeType=t,this.core.canvas.renderForce()},enumerable:!1,configurable:!0}),t.prototype.updateFrameByRatio=function(t,e,i){i?this.updateFrame(.5*this.core.canvas.canvas.width-.5*t,0,t,e,1,0,this.frameShapeType,this.frameRatioType):this.updateFrame(0,.5*this.core.canvas.canvas.height-.5*e,t,e,1,0,this.frameShapeType,this.frameRatioType)},t.prototype.updateFrameParam=function(t,e,i,r,a,s,o,n){this.x=t,this.y=e,this.width=i,this.height=r,this.scale=a,this.rotation=s,this.frameShapeType=o,this._frameRatioType=n},t.prototype.updateFrame=function(t,e,i,r,a,s,o,n){this.updateFrameParam(t,e,i,r,a,s,o,n),this.update()},t.prototype.initFrame=function(){this._frameRatioType=a.Nl.Original,this._frameShapeType=a.oU.Rectangle,this.width=200,this.height=200,this.core.imageWrapper.img&&(this.width=this.core.imageWrapper.img.width,this.height=this.core.imageWrapper.img.height),this.xOffGuid=this.width/5,this.yOffGuid=this.height/5,this.x=0,this.y=0,this.cv[0]=this.x+.5*this.width,this.cv[1]=this.y+.5*this.height,this.cvPre[0]=this.cv[0],this.cvPre[1]=this.cv[1],this.core.canvas.canvasOutFiltered.width=this.core.frame.width,this.core.canvas.canvasOutFiltered.height=this.core.frame.height,this.update(),this.updateUIWidthHeight(),this.core.renderer.initPostSaveImg=!0,this.renderer.initPost()},t.prototype.revertToOriginal=function(){this.core.scene.dataGeometries=[],this.core.app.emitAction("update-geometry@[]"),this.core.filter.revertToOriginal(),this.initFrame(),this.update(),this.core.renderer.captureCanvas(),this.core.scene.captureState(),this.core.filter.activate&&this.core.app.emitAction("update-container-size@original")},t.prototype.updateColorBG=function(t,e,i){this.renderer.updateColorBG(t,e,i)},t.prototype.update=function(){for(var t=0;t<this.cpList.length;++t)this.cpList[t].update();this.transform.updateGuides(),this.renderer.updateSVG()},t.prototype.isHoverCheck=function(t,e){return this.interaction.isHoverCheck(t,e)},t.prototype.mouseUp=function(){return this.idSelected=-1,this.interaction.mouseUp()},t.prototype.isMoved=function(){return this.cv[0]!==this.cvPre[0]||this.cv[1]!==this.cvPre[1]},t.prototype.offsetByIDFreeform=function(t,e,i){return this.transform.offsetByIDFreeform(t,e,i)},t.prototype.render=function(t){this.renderer.render(t)},t.prototype.translate=function(t,e){this._frameRatioType===a.Nl.Freeform?this.offsetByIDFreeform(this.idHover,t,e):this.transform.offsetByIDConstraint(this.idHover,t,e),this.updateUIWidthHeight()},Object.defineProperty(t.prototype,"frameSize",{get:function(){return{width:Math.floor(this.width),height:Math.floor(this.height)}},enumerable:!1,configurable:!0}),t.prototype.updateUIWidthHeight=function(){this.update(),this.core.canvas.renderForce()},t.prototype.updateVecPre=function(){this.cvPre[0]=this.cv[0],this.cvPre[1]=this.cv[1]},t}(),C=function(){function t(t){this.t=0,this.tUpdateCP=0,this.initPostSaveImg=!0,this.captureNeeded=!1,this.init=!0,this.core=t;var e=document.createElement("canvas");this.ctxNoFilter=e.getContext("2d"),this.updateFrame()}return t.prototype.updateFrame=function(){this.tUpdateCP=0,this.core.frame.update()},t.prototype.render=function(t){if(this.tUpdateCP++<100&&this.core.frame.update(),this.core.filter.render(t),this.captureNeeded&&this.updateCanvasCapture(),"none"!==this.core.canvas.canvas.style.display){this.core.scene.renderBelowFrameGeometries(t),this.core.frame.render(t);var e=1-this.t;e<0&&(e=0),t.beginPath();var i=this.core.canvas.eventController.touchInteraction.touchPre[0],r=this.core.canvas.eventController.touchInteraction.touchPre[1];t.arc(i,r,10*e,0,6.28),t.closePath(),t.fillStyle="rgba(255, 255, 255, "+e+")",t.fill(),t.restore(),this.t+=.025}},t.prototype.captureCanvas=function(){this.captureNeeded=!0},t.prototype.updateCanvasCapture=function(){this.updateCtxFiltered(),this.updateCtxNoFilter(),this.captureNeeded=!1,this.init&&(this.core.app.emitAction("post-update@"),this.init=!1)},t.prototype.updateCtxForce=function(){this.core.frame.initFrame(),this.updateCtxFiltered(),this.updateCtxNoFilter()},t.prototype.updateCtxFiltered=function(){this.core.canvas.canvasOutFiltered.width=this.core.frame.width,this.core.canvas.canvasOutFiltered.height=this.core.frame.height,this.core.canvas.ctxOutFiltered.drawImage(this.core.canvas.canvas,-this.core.frame.x,-this.core.frame.y),this.trimCanvasByShape(this.core.canvas.ctxOutFiltered)},t.prototype.updateCtxNoFilter=function(){this.ctxNoFilter.canvas.width=this.core.imageWrapper.img.width,this.ctxNoFilter.canvas.height=this.core.imageWrapper.img.height,this.ctxNoFilter.drawImage(this.core.imageWrapper.img,0,0),this.core.canvas.canvasOut.width=this.core.frame.width,this.core.canvas.canvasOut.height=this.core.frame.height,this.core.canvas.ctxOut.drawImage(this.ctxNoFilter.canvas,-this.core.frame.x,-this.core.frame.y),this.trimCanvasByShape(this.core.canvas.ctxOut)},t.prototype.trimCanvasByShape=function(t){t.globalCompositeOperation="destination-out",t.fillStyle="rgba(255, 255, 255, 1)",(0,a.EW)(t,this.core.frame.frameShapeType,0,0,this.core.frame.width,this.core.frame.height,!1),t.globalCompositeOperation="source-over"},t}(),E=function(){function t(t,e){this.core=t,this._img=e}return Object.defineProperty(t.prototype,"img",{get:function(){return this._img},enumerable:!1,configurable:!0}),t.prototype.updateData=function(){},t}(),b=i(8148),R=function(){function t(t){this.dataGeometries=[],this.index=0,this.scaleByRatio=1,this.core=t,this.sceneManager=new a.i$,this.svgRPoint=(0,a.KF)(),this.svgNPoint=(0,a.nP)()}return t.prototype.resetState=function(){this.sceneManager.reset(),this.captureState()},t.prototype.shiftEnvironment=function(t){t===a.qA.AGSM?this.svgRPoint=(0,a.VT)():this.svgRPoint=(0,a.KF)()},t.prototype.captureState=function(){this.sceneManager.push(this.core.app.api.getData());var t=this.sceneManager.getCurrentState();this.core.activeCommand.emitUndoRedoHistory(t)},t.prototype.undo=function(){var t=this.sceneManager.undo();if(t&&t.params)return this.core.scene.dataGeometries=t.drawing,this.core.app.api.updateFrame(t.params.x,t.params.y,t.params.width,t.params.height,t.params.scale,t.params.rotation,t.params.shape,t.params.aspectRatio),this.core.app.api.updateEffect(t.effecting,!1),this.core.renderer.captureCanvas(),this.core.filter.activate&&this.core.app.emitAction("update-container-size@"),this.core.filter.emitFilterData(),this.core.activeCommand.emitUndoRedoHistory(this.sceneManager.getCurrentState()),void this.core.activeCommand.emitDataToSave();this.core.filter.emitFilterData()},t.prototype.redo=function(){var t=this.sceneManager.redo();if(t&&t.params)return this.core.scene.dataGeometries=t.drawing,this.core.app.api.updateFrame(t.params.x,t.params.y,t.params.width,t.params.height,t.params.scale,t.params.rotation,t.params.shape,t.params.aspectRatio),this.core.app.api.updateEffect(t.effecting,!1),this.core.renderer.captureCanvas(),this.core.filter.activate&&this.core.app.emitAction("update-container-size@"),this.core.filter.emitFilterData(),this.core.activeCommand.emitUndoRedoHistory(this.sceneManager.getCurrentState()),void this.core.activeCommand.emitDataToSave();this.core.filter.emitFilterData()},t.prototype.renderBelowFrameGeometries=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0);var r=[e,i];if(this.dataGeometries)for(this.index=this.dataGeometries.length;this.index--;){var s=this.dataGeometries[this.index],o=s.styles.width*this.scaleByRatio*s.styles.scale;switch(s.type){case a.zq.POINT_REGULAR:this.core.app.param.environment===a.qA.AGSM?(0,b._y)(t,s.nodes,this.svgRPoint.path2D,s.styles.colorRgba,r,this.scaleByRatio*s.styles.scale,-8,-30):(0,b._y)(t,s.nodes,this.svgRPoint.path2D,s.styles.colorRgba,r,this.scaleByRatio*s.styles.scale,-9,-28);break;case a.zq.POINT_NUMBERED:this.core.app.param.environment===a.qA.AGSM?(0,b.Bm)(t,s.nodes,s.styles.colorRgba,s.styles.number,r,this.scaleByRatio*s.styles.scale,0,0):(0,b.Kz)(t,s.nodes,this.svgNPoint.path2D,s.styles.colorRgba,s.styles.number,r,this.scaleByRatio*s.styles.scale,-13.14,-28);break;case a.zq.POLYLINE_BENDING:(0,b.JV)(t,s.nodes,s.styles.colorRgba,r,o);break;case a.zq.POLYGON_GRAPH:case a.zq.RECTANGLE:(0,b.xG)(t,s.nodes,s.styles.colorRgba,r,o);break;case a.zq.CIRCLE:(0,b.wq)(t,s.nodes,s.styles.colorRgba,r,o);break;case a.zq.ARROW_SINGLE:(0,b.nq)(t,s.nodes,s.styles.colorRgba,r,o);break;case a.zq.ARROW_DOUBLE:(0,b.aK)(t,s.nodes,s.styles.colorRgba,r,o)}}},t}(),F=function(){function t(t){this.uiFilter=t,this.divHost=document.createElement("div"),this.divHost.style.display="flex",this.uiFilter.host.appendChild(this.divHost)}return t.prototype.appendUI=function(){var t=this,e=document.createElement("div");e.style.background="#ff0000",e.style.width="10px",e.onclick=function(){console.log(t.uiFilter.controller.imageFilter.getData())},this.divHost.appendChild(e),this.divText=document.createElement("div"),this.divHost.appendChild(this.divText),this.divText.textContent="Filter: normal",this.divText.style.color="#fff",this.divText.style.width="150px",this.divText.style.fontSize="30",this.divText.style.padding="5px";var i,r=I("interpolation",0,1,1,.05);this.inputInter=r.input,this.divInter=document.createElement("div"),this.divInter.textContent="1",r.div.appendChild(this.divInter),this.inputInter.oninput=function(){t.divInter.textContent=t.inputInter.value,t.uiFilter.controller.updateInterpolation(+t.inputInter.value)},this.divHost.appendChild(r.div),i=I("blur",0,10,0,.1),this.divBlur=document.createElement("div"),this.divBlur.textContent="0",i.div.appendChild(this.divBlur),this.inputBlur=i.input,this.inputBlur.oninput=function(){t.divBlur.textContent=t.inputBlur.value,t.uiFilter.controller.updateFilterParam("blur",+t.inputBlur.value),t.uiFilter.controller.updateFilter()},this.divHost.appendChild(i.div),i=I("sepia",0,1,0,.05),this.divSepia=document.createElement("div"),this.divSepia.textContent="0",i.div.appendChild(this.divSepia),this.inputSepia=i.input,this.inputSepia.oninput=function(){t.divSepia.textContent=t.inputSepia.value,t.uiFilter.controller.updateFilterParam("sepia",+t.inputSepia.value),t.uiFilter.controller.updateFilter()},this.divHost.appendChild(i.div),i=I("contrast",0,2,1,.05),this.divContrast=document.createElement("div"),this.divContrast.textContent="0",i.div.appendChild(this.divContrast),this.inputContrast=i.input,this.inputContrast.oninput=function(){t.divContrast.textContent=t.inputContrast.value,t.uiFilter.controller.updateFilterParam("contrast",+t.inputContrast.value),t.uiFilter.controller.updateFilter()},this.divHost.appendChild(i.div),i=I("brightness",0,2,1,.05),this.divBrightness=document.createElement("div"),this.divBrightness.textContent="0",i.div.appendChild(this.divBrightness),this.inputBrightness=i.input,this.inputBrightness.oninput=function(){t.divBrightness.textContent=t.inputBrightness.value,t.uiFilter.controller.updateFilterParam("brightness",+t.inputBrightness.value),t.uiFilter.controller.updateFilter()},this.divHost.appendChild(i.div),i=I("saturate",0,2,1,.05),this.divSaturate=document.createElement("div"),this.divSaturate.textContent="0",i.div.appendChild(this.divSaturate),this.inputSaturate=i.input,this.inputSaturate.oninput=function(){t.divSaturate.textContent=t.inputSaturate.value,t.uiFilter.controller.updateFilterParam("saturate",+t.inputSaturate.value),t.uiFilter.controller.updateFilter()},this.divHost.appendChild(i.div),i=I("hueRotate",-180,180,0,1),this.divHueRotates=document.createElement("div"),this.divHueRotates.textContent="0",i.div.appendChild(this.divHueRotates),this.inputHueRotate=i.input,this.inputHueRotate.oninput=function(){t.divHueRotates.textContent=t.inputHueRotate.value,t.uiFilter.controller.updateFilterParam("hue-rotate",+t.inputHueRotate.value),t.uiFilter.controller.updateFilter()},this.divHost.appendChild(i.div)},t.prototype.updateUIValue=function(){this.inputBlur&&(this.inputBlur.value=""+this.uiFilter.controller.getFilterParam("blur"),this.divBlur.textContent=this.inputBlur.value),this.inputInter&&(this.inputInter.value=""+this.uiFilter.controller.getFilterParam("interpolation"),this.divInter.textContent=this.inputInter.value),this.inputSepia&&(this.inputSepia.value=""+this.uiFilter.controller.getFilterParam("sepia"),this.divSepia.textContent=this.inputSepia.value),this.inputContrast&&(this.inputContrast.value=""+this.uiFilter.controller.getFilterParam("contrast"),this.divContrast.textContent=this.inputContrast.value),this.inputBrightness&&(this.inputBrightness.value=""+this.uiFilter.controller.getFilterParam("brightness"),this.divBrightness.textContent=this.inputBrightness.value),this.inputSaturate&&(this.inputSaturate.value=""+this.uiFilter.controller.getFilterParam("saturate"),this.divSaturate.textContent=this.inputSaturate.value),this.inputHueRotate&&(this.inputHueRotate.value=""+this.uiFilter.controller.getFilterParam("hue-rotate"),this.divHueRotates.textContent=this.inputHueRotate.value)},t}(),I=function(t,e,i,r,a){var s=document.createElement("div");s.textContent=t,s.style.color="#ffffff",s.style.position="float";var o=document.createElement("input");return o.style.width="80px",o.style.height="3px",o.type="range",o.defaultValue=""+r,o.min=""+e,o.step=""+a,o.max=""+i,s.appendChild(o),{div:s,input:o}},P=function(){function t(){var t=this;this.numLayer=-1,this.nameLayer="Abstract Layer ",this.divHost=document.createElement("div"),this.divHost.style.backgroundColor="#ffffff",this.divHost.style.backgroundColor="rgba(255, 255, 255, 1)",this.divLayer=document.createElement("div"),this.divLayer.style.border="10px",this.divLayer.style.padding="10px",this.divLayer.style.margin="5px";var e=document.createElement("div");e.style.display="flex",this.divLayer.appendChild(e),this.title=document.createElement("div"),this.title.style.height="28px",this.title.style.width="132px",this.title.style.color="#000",this.title.textContent=this.nameLayer+" "+this.numLayer+" ",e.appendChild(this.title);var i=document.createElement("div");i.style.height="28px",i.style.color="#000",i.textContent="X",i.onclick=function(){t.destroy()},e.appendChild(i)}return t.prototype.getData=function(){},t.prototype.destroy=function(){},t.prototype.updateLayerNum=function(t){this.numLayer=t,this.title.textContent=this.nameLayer+" "+this.numLayer+" "},t}(),k=function(){function t(t){var e=this;this.color=1,this.updatePost=t.updatePost,this.color=t.default,this.element=t.colorElement,this.divContainer=document.createElement("div"),this.divContainer.style.display="flex",t.host.appendChild(this.divContainer),this.divText=document.createElement("div"),this.divText.style.width="45px",this.divText.textContent=t.colorElement+": "+t.default,this.divText.style.color=t.colorText,this.divContainer.appendChild(this.divText),this.divInput=document.createElement("input"),this.divInput.style.width="100%",this.divInput.style.fontSize="10px",this.divInput.style.height="5px",this.divInput.style.border="0px",this.divInput.style.appearance="none",this.divInput.type="range",this.divInput.value=""+t.default,this.divInput.max=""+t.max,this.divInput.oninput=function(){e.divText.textContent=t.colorElement+": "+e.divInput.value,e.color=+e.divInput.value,e.updatePost()},this.divContainer.appendChild(this.divInput)}return t.prototype.updateValue=function(t){this.color=t,this.divText.textContent=this.element+": "+t,this.divInput.value=""+t},t}(),S=function(t){var e=this;this.mode=a.ew.Overlay,this.updatePost=t.updatePost;var i=document.createElement("select");for(var r in t.host.appendChild(i),a.ew){var s=document.createElement("option");s.value=a.ew[r],s.textContent=a.ew[r],i.appendChild(s)}i.value=this.mode,i.style.border="0px",i.style.fontSize="10px",i.onchange=function(t){var i=t.target.value;e.mode=i,e.updatePost()}},H=function(){function t(t){this.divHost=document.createElement("div"),this.divHost.style.backgroundColor="rgba("+t.r+","+t.g+","+t.b+","+t.a+")",this.divHost.style.width="100%",this.divHost.style.height="20px",this.divHost.style.fontSize="10px",this.divHost.style.marginTop="5px",t.host.appendChild(this.divHost)}return t.prototype.updateColor=function(t){this.divHost.style.backgroundColor="rgba("+t.r+","+t.g+","+t.b+","+t.a+")"},t}(),L=function(t){var e=this;this.rgba=[],this.updatePost=t.updatePost,this.divHost=document.createElement("input"),this.divHost.style.width="95%",this.divHost.style.fontSize="10px",this.divHost.style.border="0px",this.divHost.style.color="#",this.divHost.type="input",this.divHost.oninput=function(){for(var t=(0,a.rW)(e.divHost.value),i=0;i<t.length;++i)if(isNaN(t[i]))return;e.rgba=t,e.updatePost()},t.host.appendChild(this.divHost)},B=(f=function(t,e){return f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},f(t,e)},function(t,e){function i(){this.constructor=t}f(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),M=function(t){function e(e,i,r){var a=t.call(this)||this;return a.nameLayer="Plain Layer ",a.numLayer=e,a.title.textContent=a.nameLayer+" "+a.numLayer+" ",a.fn=i,a.destroy=r,a.init(),a}return B(e,t),e.prototype.init=function(){var t=this,e=this.divLayer;this.hexElement=new L({host:e,updatePost:function(){t.rElement.updateValue(t.hexElement.rgba[0]),t.gElement.updateValue(t.hexElement.rgba[1]),t.bElement.updateValue(t.hexElement.rgba[2]),t.update()}}),this.rElement=new k({host:e,colorElement:"r",colorText:"#f00",default:Math.floor(255*Math.random()),max:255,updatePost:function(){t.update(),t.updateHex()}}),this.gElement=new k({host:e,colorElement:"g",colorText:"#494",default:Math.floor(255*Math.random()),max:255,updatePost:function(){t.update(),t.updateHex()}}),this.bElement=new k({host:e,colorElement:"b",colorText:"#44a",default:Math.floor(255*Math.random()),max:255,updatePost:function(){t.update(),t.updateHex()}}),this.aElement=new k({host:e,colorElement:"a",colorText:"#222",default:100,max:100,updatePost:function(){t.update(),t.updateHex()}}),this.modeElement=new S({host:e,updatePost:function(){t.update()}}),this.colorCanvas=new H({host:e,r:this.rElement.color,g:this.gElement.color,b:this.bElement.color,a:this.aElement.color}),this.divHost.appendChild(e),this.update(),this.updateHex()},e.prototype.update=function(){this.colorCanvas.updateColor({r:this.rElement.color,g:this.gElement.color,b:this.bElement.color,a:.01*this.aElement.color}),this.fn(this.getData())},e.prototype.updateHex=function(){this.hexElement.divHost.value=(0,a.iC)(this.rElement.color,this.gElement.color,this.bElement.color)},e.prototype.getData=function(){return{bg0:[this.rElement.color,this.gElement.color,this.bElement.color,.01*this.aElement.color],mode:this.modeElement.mode}},e}(P),T=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},t(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),O=function(t){function e(e,i,r){var a=t.call(this)||this;return a.numLayer=-1,a.nameLayer="Radial Gradient Layer ",a.numLayer=e,a.title.textContent=a.nameLayer+" "+a.numLayer+" ",a.fn=i,a.destroy=r,a.init(),a}return T(e,t),e.prototype.init=function(){var t=this,e=this.divLayer,i=document.createElement("div");i.style.color="#000",i.textContent="inner layer ------------------------",e.appendChild(i),this.hexElement0=new L({host:e,updatePost:function(){t.rElement0.updateValue(t.hexElement0.rgba[0]),t.gElement0.updateValue(t.hexElement0.rgba[1]),t.bElement0.updateValue(t.hexElement0.rgba[2]),t.update()}}),this.rElement0=new k({host:e,colorElement:"r",colorText:"#f00",default:Math.floor(255*Math.random()),max:255,updatePost:function(){t.update(),t.updateHex()}}),this.gElement0=new k({host:e,colorElement:"g",colorText:"#494",default:Math.floor(255*Math.random()),max:255,updatePost:function(){t.update(),t.updateHex()}}),this.bElement0=new k({host:e,colorElement:"b",colorText:"#44a",default:Math.floor(255*Math.random()),max:255,updatePost:function(){t.update(),t.updateHex()}}),this.aElement0=new k({host:e,colorElement:"a",colorText:"#222",default:100,max:100,updatePost:function(){t.update(),t.updateHex()}}),this.colorCanvas0=new H({host:e,r:this.rElement0.color,g:this.gElement0.color,b:this.bElement0.color,a:this.aElement0.color});var r=document.createElement("div");r.style.color="#000",r.textContent="outer layer ------------------------",e.appendChild(r),this.hexElement1=new L({host:e,updatePost:function(){t.rElement1.updateValue(t.hexElement1.rgba[0]),t.gElement1.updateValue(t.hexElement1.rgba[1]),t.bElement1.updateValue(t.hexElement1.rgba[2]),t.update()}}),this.rElement1=new k({host:e,colorElement:"r",colorText:"#f00",default:Math.floor(255*Math.random()),max:255,updatePost:function(){t.update(),t.updateHex()}}),this.gElement1=new k({host:e,colorElement:"g",colorText:"#494",default:Math.floor(255*Math.random()),max:255,updatePost:function(){t.update(),t.updateHex()}}),this.bElement1=new k({host:e,colorElement:"b",colorText:"#44a",default:Math.floor(255*Math.random()),max:255,updatePost:function(){t.update(),t.updateHex()}}),this.aElement1=new k({host:e,colorElement:"a",colorText:"#222",default:100,max:100,updatePost:function(){t.update(),t.updateHex()}}),this.modeElement=new S({host:e,updatePost:function(){t.update()}}),this.colorCanvas1=new H({host:e,r:this.rElement1.color,g:this.gElement1.color,b:this.bElement1.color,a:this.aElement1.color}),this.innerElement=new k({host:e,colorElement:"a",colorText:"#222",default:0,max:1,updatePost:function(){t.update(),t.updateHex()}}),this.innerElement.divInput.step="0.025",this.innerElement.divText.style.width="55px",this.outerElement=new k({host:e,colorElement:"a",colorText:"#222",default:1,max:1,updatePost:function(){t.update(),t.updateHex()}}),this.outerElement.divInput.step="0.025",this.outerElement.divText.style.width="55px",this.divHost.appendChild(e),this.update(),this.updateHex()},e.prototype.update=function(){this.colorCanvas0.updateColor({r:this.rElement0.color,g:this.gElement0.color,b:this.bElement0.color,a:.01*this.aElement0.color}),this.colorCanvas1.updateColor({r:this.rElement1.color,g:this.gElement1.color,b:this.bElement1.color,a:.01*this.aElement1.color}),this.fn(this.getData())},e.prototype.updateHex=function(){this.hexElement0.divHost.value=(0,a.iC)(this.rElement0.color,this.gElement0.color,this.bElement0.color),this.hexElement1.divHost.value=(0,a.iC)(this.rElement1.color,this.gElement1.color,this.bElement1.color)},e.prototype.getData=function(){return{in:this.innerElement.color,out:this.outerElement.color,bg0:[this.rElement0.color,this.gElement0.color,this.bElement0.color,.01*this.aElement0.color],bg1:[this.rElement1.color,this.gElement1.color,this.bElement1.color,.01*this.aElement1.color],mode:this.modeElement.mode}},e}(P);!function(t){t.RadialGradientLayer="radialGradientLayer",t.PlainLayer="plainLayer"}(v||(v={}));var D=function(){function t(t){this.layers=[],this.isCustom=!1,this.uiFilter=t}return t.prototype.appendUI=function(){this.appendHost(),this.appendButtonAdd()},t.prototype.appendHost=function(){this.divHost=document.createElement("div"),this.divHost.style.position="absolute",this.divHost.style.top="30px",this.divHost.style.width="160px",this.uiFilter.host.appendChild(this.divHost)},t.prototype.appendButtonAdd=function(){var t=this,e=document.createElement("div");e.style.display="flex",e.style.height="20px",this.divHost.appendChild(e);var i=document.createElement("div");i.style.width="60px",i.style.color="#fff",i.textContent="+ Plain Layer",i.onclick=function(){t.addLayer(v.PlainLayer)},e.appendChild(i);var r=document.createElement("div");r.style.color="#fff",r.textContent="+ Radial Gradient",r.onclick=function(){t.addLayer(v.RadialGradientLayer)},e.appendChild(r)},t.prototype.addLayer=function(t){var e,i=this;t===v.RadialGradientLayer?(e=new O(this.layers.length+1,(function(t){i.updateRendering()}),(function(){i.removeLayer(e)})),this.divHost.appendChild(e.divHost),this.layers.push(e)):(e=new M(this.layers.length+1,(function(t){i.updateRendering()}),(function(){i.removeLayer(e)})),this.divHost.appendChild(e.divHost),this.layers.push(e)),this.updateRendering()},t.prototype.updateRendering=function(){this.updateStatus(),this.uiFilter.controller.updateFilter()},t.prototype.getData=function(){for(var t=[],e=0;e<this.layers.length;++e)t.push(this.layers[e].getData());return t},t.prototype.removeLayer=function(t){this.layers.splice(this.layers.indexOf(t),1),this.divHost.removeChild(t.divHost),this.updateIndex(),this.updateRendering()},t.prototype.updateIndex=function(){for(var t=0;t<this.layers.length;++t)this.layers[t].updateLayerNum(t+1)},t.prototype.updateStatus=function(){0===this.layers.length?this.isCustom=!1:this.isCustom=!0},t.prototype.destroy=function(){if(this.divHost&&this.divHost.parentNode)try{var t=this.divHost.parentNode;t&&t.removeChild(this.divHost)}catch(t){console.debug(t)}},t}(),A=function(){function t(t){var e=this;this.num=0,this.debugMode=!1,this.keyEvent=function(t){e.debugMode&&("["===t.key?(e.num-=1/9,e.num<0&&(e.num=0),e.num>1&&(e.num=.99),e.controller.shiftEffect(e.num)):"]"===t.key&&(e.num+=1/9,e.num<0&&(e.num=0),e.num>1&&(e.num=.99),e.controller.shiftEffect(e.num))),"P"===t.key&&t.shiftKey&&e.displayUI()},this.controller=t,this.appendUI()}return t.prototype.appendUI=function(){this.host=document.createElement("div"),this.host.style.zIndex="1",this.host.style.position="absolute",this.host.style.top="0px",this.host.style.left="0px",this.uiEffect=new F(this),this.uiTint=new D(this),document.body.addEventListener("keydown",this.keyEvent),this.appendUIFilter(),this.appendUITint()},t.prototype.displayUI=function(){this.controller.imageFilter.core.div.appendChild(this.host)},t.prototype.appendUIFilter=function(){this.controller.activate&&this.uiEffect.appendUI()},t.prototype.appendUITint=function(){this.controller.activate&&this.uiTint.appendUI()},t.prototype.updateUIValue=function(){this.uiEffect.updateUIValue()},t.prototype.destroy=function(){document.body.removeEventListener("keydown",this.keyEvent),this.uiTint.destroy();var t=this.host.parentNode;t&&t.removeChild(this.host)},t}(),U=function(){function t(t){var e=this;this._activate=!1,this.checkChanges=(0,a.Ds)((function(){e.imageFilter.update()})),this.imageFilter=t,this.UIFilter=new A(this)}return Object.defineProperty(t.prototype,"activate",{get:function(){return this._activate},set:function(t){this._activate=t,t?(this.imageFilter.canvasView.style.display="block",this.imageFilter.core.canvas.canvas.style.display="none",this.UIFilter.appendUI()):(this.imageFilter.canvasView.style.display="none",this.imageFilter.core.canvas.canvas.style.display="block",this.destroy())},enumerable:!1,configurable:!0}),t.prototype.updateDivText=function(t){this.UIFilter&&this.UIFilter.uiEffect.divText&&(this.UIFilter.uiEffect.divText.textContent="Filter: "+t)},t.prototype.destroy=function(){this.UIFilter&&this.UIFilter.destroy()},t.prototype.updateCustomFilter=function(t){this.imageFilter.filters=t},t.prototype.shiftEffect=function(t,e){void 0===e&&(e=!0),this.imageFilter.typePreset=(0,a.g9)(t),this.imageFilter.shiftEffectByPreset(this.imageFilter.typePreset)},t.prototype.getFilterParam=function(t){void 0===this.imageFilter.filters&&this.imageFilter.reset(!1,!1);for(var e=0;e<this.imageFilter.filters.length;++e)if(t===this.imageFilter.filters[e][0])return this.imageFilter.filters[e][1];if("interpolation"===t)return this.imageFilter.interpolation},t.prototype.updateFilterParam=function(t,e){for(var i=0;i<this.imageFilter.filters.length;++i)if(t===this.imageFilter.filters[i][0])return void(this.imageFilter.filters[i][1]=e)},t.prototype.updateInterpolation=function(t){this.imageFilter.interpolation=t,this.updateFilter()},t.prototype.updateFilter=function(){this.imageFilter.update(!1),this.checkChanges()},t}(),_=function(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;var r=Array(t),a=0;for(e=0;e<i;e++)for(var s=arguments[e],o=0,n=s.length;o<n;o++,a++)r[a]=s[o];return r},z=function(){function t(t){this.typePreset="normal",this.numRendered=0,this.interpolation=1,this.filters=[],this.tints=[],this.activate=!1,this.modeDebug=!0,this.core=t,this.reset(!1,!1,!0),this.canvas=document.createElement("canvas"),this.canvas.style.width="100%",this.canvas.style.height="100%",this.ctx=this.canvas.getContext("2d"),this.canvasView=document.createElement("canvas"),this.canvasView.style.width="100%",this.canvasView.style.height="100%",this.canvasView.style.display="none",this.ctxView=this.canvasView.getContext("2d"),this.core.div.appendChild(this.canvasView),this.controller=new U(this)}return t.prototype.updateParamsInterpolation=function(t,e){void 0===e&&(e=!0),this.interpolation=t,this.update(e)},t.prototype.getData=function(){void 0===this.filters&&(this.reset(!1,!1,!0),this.numRendered=0,this.update(!1));var t=this.filters.filter((function(t,e){var i=t[1];return a.UU.normal.filters[e][1]!==i}));return{typePreset:this.typePreset,filters:t,tints:_(this.tints),interpolation:this.interpolation}},t.prototype.updateEffect=function(t,e){void 0===e&&(e=!0),this.typePreset=t.typePreset,this.filters=t.filters,this.tints=t.tints,this.controller.UIFilter&&this.controller.UIFilter.uiEffect.divText&&(this.controller.UIFilter.updateUIValue(),this.controller.updateDivText(this.typePreset)),this.update(e)},t.prototype.revertToOriginal=function(t,e){void 0===t&&(t=!0),void 0===e&&(e=!0),this.numRendered=0,this.reset(t,e)},t.prototype.reset=function(t,e,i){void 0===t&&(t=!0),void 0===e&&(e=!1),void 0===i&&(i=!1),this.typePreset="normal",this.interpolation=1,this.filters={filters:[["blur",0],["sepia",0],["contrast",1],["brightness",1],["saturate",1],["hue-rotate",0]],tints:[]},this.tints=[],i||(this.controller.updateDivText(this.typePreset),this.update(t,e))},t.prototype.shiftEffectByPreset=function(t,e){void 0===e&&(e=!0),this.typePreset=t;var i=(0,a.Ry)(t);this.filters=i.filters,this.tints=i.tints,this.controller.updateDivText(this.typePreset),this.update(e)},t.prototype.update=function(t,e){if(void 0===t&&(t=!0),void 0===e&&(e=!1),this.numRendered<3||this.activate){this.canvas.width=this.core.imageWrapper.img.width,this.canvas.height=this.core.imageWrapper.img.height;var i=this.core.frame.cv[0]/this.canvas.width,r=this.core.frame.cv[1]/this.canvas.height,s=.5*(this.core.frame.width/this.canvas.width+this.core.frame.height/this.canvas.height);(0,a.lJ)(this.ctx,this.core.imageWrapper.img,this.filters,this.interpolation),this.controller.UIFilter.uiTint.isCustom&&(this.tints=this.controller.UIFilter.uiTint.getData()),(0,a.Wf)(this.ctx,this.tints,i,r,s,this.interpolation),this.core.canvas.renderForce(),this.core.canvas.ctxOutFiltered.drawImage(this.ctx.canvas,-this.core.frame.x,-this.core.frame.y),t&&(this.emitFilterData(),e||this.core.scene.captureState()),this.controller.UIFilter&&this.controller.UIFilter.updateUIValue(),this.core.renderer.captureCanvas(),this.numRendered++}this.core.filter.activate&&(this.core.frame.renderer.hide=!0)},t.prototype.render=function(t){t.drawImage(this.canvas,0,0),this.renderView()},t.prototype.renderView=function(){if(this.controller.activate){var t=this.core.app.api.getCtx().canvas;this.canvasView.style.width="100%",this.canvasView.style.height="100%",this.canvasView.width=t.width,this.canvasView.height=t.height,this.ctxView.drawImage(this.canvas,-this.core.frame.x,-this.core.frame.y),this.core.scene.renderBelowFrameGeometries(this.ctxView,this.core.frame.x,this.core.frame.y),this.trimCanvas(this.ctxView)}},t.prototype.trimCanvas=function(t){t.globalCompositeOperation="destination-out",t.fillStyle="rgba(255, 255, 255, 1)",(0,a.EW)(t,this.core.frame.frameShapeType,0,0,t.canvas.width,t.canvas.height,!1),t.globalCompositeOperation="source-over"},t.prototype.destroy=function(){this.controller.destroy()},t.prototype.emitFilterData=function(){this.core.app.emitAction("filter@"+JSON.stringify(this.getData()))},t.prototype.activateEffectEnv=function(){this.activate=!0,this.controller.activate=!0},t.prototype.deactivateEffectEnv=function(){this.activate=!1,this.controller.activate=!1},t}(),W=function(){function t(t){var e=this;this.resizeWindow=function(){e.canvas.renderForce()},this.app=t;var i=document.createElement("div");this.div=i,this.div.id="express-image-cropping",this.div.style.width="100%",this.div.style.height="100%",t.ui?this.app.ui.divContentWrapper.append(this.div):this.app.divHost.append(this.div),this.common=new d(this),this.filter=new z(this),this.initCanvas(),this.initApp()}return t.prototype.reset=function(){},t.prototype.initApp=function(){this.scene=new R(this),this.frame=new w(this),this.renderer=new C(this),this.activeCommand=new l(this)},t.prototype.initCanvas=function(){var t=this;this.canvas=new p(this),this.canvas.render=function(e){t.renderer.render(e)}},t.prototype.importImage=function(t){var e=this,i=new Image;i.crossOrigin="anonymous",i.src=t,i.onload=function(){e.importImageByImage(i)}},t.prototype.importImageByImage=function(t){this.imageWrapper=new E(this,t),this.canvas.canvasOutFiltered.width=t.width,this.canvas.canvasOutFiltered.height=t.height,this.canvas.canvas.width=t.width,this.canvas.canvas.height=t.height,this.frame.initFrame(),this.filter.update(!1),this.canvas.renderForce(),this.renderer.captureCanvas(),this.filter.activate||this.app.emitAction("ready@crop")},t.prototype.destroy=function(){this.canvas.destroy(),this.filter.destroy()},t}(),G=function(){function t(t,e){this.app=t,this.theme=e;var i=document.createElement("div");i.id="express-image-editing-wrapper",i.style.position="relative",i.style.width="100%",i.style.height="100%",i.style.display="flux",i.style.justifyContent="center",this.divExpressImageEditingWrapper=i,this.app.divHost.append(i);var r=document.createElement("div");r.id="express-image-editing-ui-wrapper",r.style.width="100%",r.style.height=e.top.height,r.style.padding=e.top.padding,r.style.background=e.top.background,r.style.marginBottom=e.top.marginBottom,this.divUIWrapper=r,this.divExpressImageEditingWrapper.append(this.divUIWrapper);var a=document.createElement("p");a.textContent="Image Cropping App V1",a.style.fontSize="12px;",a.style.color="rgba(210, 210, 210)",a.style.top="0px",a.style.left="20px",this.divUIWrapper.append(a);var s=document.createElement("div");s.id="express-image-editing-content-wrapper",this.divContentWrapper=s,this.divExpressImageEditingWrapper.append(this.divContentWrapper),this.Layer0(),this.Layer1()}return t.prototype.updateStyle=function(t,e,i){},t.prototype.initPost=function(){var t=this,e=document.createElement("div");e.style.textAlign="center",e.style.padding="10px",e.textContent="Size";var i=document.createElement("input");i.style.width="50px",i.setAttribute("type","text"),i.setAttribute("min","100"),e.append(i),i.oninput=function(){Number.parseFloat(i.value)},(i=document.createElement("input")).style.width="50px",i.setAttribute("type","text"),i.setAttribute("min","100"),e.append(i),i.oninput=function(){Number.parseFloat(i.value)},this.divUIWrapper.append(e);var r=document.createElement("input");r.type="range",r.min="-3.13",r.max="3.13",r.step="0.01",r.value="0",r.oninput=function(){t.app.api.onDragRotate(+r.value)},this.divUIWrapper.append(r);var a=document.createElement("input");a.type="range",a.min="0.2",a.max="2",a.step="0.01",a.value="1",a.oninput=function(){t.app.api.onDragZoom(+a.value)},this.divUIWrapper.append(a);var s=document.createElement("input");s.setAttribute("type","text"),s.setAttribute("value","https://raw.githubusercontent.com/NamjuLee/data/master/img/building%20footprint.png"),this.divUIWrapper.append(s),s.oninput=function(){t.app.api.inputImportByURL(s.textContent)},s.addEventListener("keyup",(function(t){t.keyCode}));var o=document.createElement("div");o.textContent="Offset: ",o.style.padding="10px";var n=document.createElement("input");n.style.width="30px",n.setAttribute("type","text"),n.setAttribute("min","-50"),n.setAttribute("max","50"),n.setAttribute("value","10"),o.append(n),this.divUIWrapper.append(o),n.addEventListener("keyup",(function(t){13===t.keyCode&&console.log("divInput.value",n.value)}));var h=document.createElement("button");h.textContent="dd",this.divUIWrapper.append(h),h.onclick=function(){}},t.prototype.Layer0=function(){var t=this,e=this.theme.top.iconFill,i=document.createElement("div");i.style.margin="5px",i.style.marginBottom="20px",this.divUIWrapper.append(i);var r=(0,a.sR)((function(){t.app.api.onClickPlace()}),'\n            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="'+e+'" viewBox="0 0 20 20">\n            <path d="M8 2a5.53 5.53 0 0 0-3.594 1.342c-.766.66-1.321 1.52-1.464 2.383C1.266 6.095 0 7.555 0 9.318 0 11.366 1.708 13 3.781 13h8.906C14.502 13 16 11.57 16 9.773c0-1.636-1.242-2.969-2.834-3.194C12.923 3.999 10.69 2 8 2zm2.354 5.146a.5.5 0 0 1-.708.708L8.5 6.707V10.5a.5.5 0 0 1-1 0V6.707L6.354 7.854a.5.5 0 1 1-.708-.708l2-2a.5.5 0 0 1 .708 0l2 2z"/>\n            </svg>\n            ');r.style.transform="scale(1.7)",r.style.paddingRight="10px",i.append(r),i.append((0,a.sR)((function(){t.app.api.onClickCancel()}),'\n                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="'+e+'" viewBox="0 0 20 20">\n                <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM5.354 4.646a.5.5 0 1 0-.708.708L7.293 8l-2.647 2.646a.5.5 0 0 0 .708.708L8 8.707l2.646 2.647a.5.5 0 0 0 .708-.708L8.707 8l2.647-2.646a.5.5 0 0 0-.708-.708L8 7.293 5.354 4.646z"/>\n                </svg>\n                ',1.4)),i.append((0,a.sR)((function(){t.app.api.onClickReset()}),'\n                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="'+e+'" viewBox="0 0 20 20">\n                <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM4.5 7.5a.5.5 0 0 0 0 1h7a.5.5 0 0 0 0-1h-7z"/>\n                </svg>\n                ',1.4)),i.append((0,a.sR)((function(){t.app.api.onClickDownload()}),'\n                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="'+e+'" viewBox="0 0 20 20">\n                <path d="M12 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zM8 5a.5.5 0 0 1 .5.5v3.793l1.146-1.147a.5.5 0 0 1 .708.708l-2 2a.5.5 0 0 1-.708 0l-2-2a.5.5 0 1 1 .708-.708L7.5 9.293V5.5A.5.5 0 0 1 8 5z"/>\n                </svg>\n                ',1.4))},t.prototype.Layer1=function(){var t=this,e=document.createElement("div");this.divUIWrapper.append(e);var i=this.theme.top.iconFill;e.append((0,a.sR)((function(){}),'\n                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="'+i+'" viewBox="0 0 16 16">\n                <path d="M14.082 2.182a.5.5 0 0 1 .103.557L8.528 15.467a.5.5 0 0 1-.917-.007L5.57 10.694.803 8.652a.5.5 0 0 1-.006-.916l12.728-5.657a.5.5 0 0 1 .556.103z"/>\n                </svg>\n                ')),e.append((0,a.sR)((function(){t.app.api.onClickUndo()}),'\n                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="'+i+'" viewBox="0 0 16 16">\n                <path d="M8 0a8 8 0 1 0 0 16A8 8 0 0 0 8 0zm3.5 7.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H11.5z"/>\n                </svg>\n                ')),e.append((0,a.sR)((function(){t.app.api.onClickRedo()}),'\n                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="'+i+'" viewBox="0 0 16 16">\n                <path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0zM4.5 7.5a.5.5 0 0 0 0 1h5.793l-2.147 2.146a.5.5 0 0 0 .708.708l3-3a.5.5 0 0 0 0-.708l-3-3a.5.5 0 1 0-.708.708L10.293 7.5H4.5z"/>\n                </svg>\n                '))},t}(),V=function(){function t(t){this.param=t,this.divHost=document.getElementById(t.id),this.param.theme&&(this.ui=new G(this,this.param.theme)),this.core=new W(this),this.api=new s(this)}return t.prototype.initByImageDrawingApp=function(t){this.core.div.style.width=t.implementations.imageAnnoApp.graphicsCoreWrapper.canvasWrapper.aCanvas.canvas.width+"px",this.core.div.style.height=t.implementations.imageAnnoApp.graphicsCoreWrapper.canvasWrapper.aCanvas.canvas.height+"px",this.core.canvas.resize()},t.prototype.initImageByURL=function(t){this.core.importImage(t)},t.prototype.initImageByImg=function(t){this.core.importImageByImage(t)},t.prototype.pushCanvasDrawing=function(t){t&&this.core.div.prepend(t)},t.prototype.pushDrawingData=function(t){this.api.updateGeometries(t)},t.prototype.setScaleGlobal=function(t){this.api.setScaleGlobal(t)},t.prototype.getData=function(t){return void 0===t&&(t=!1),this.api.getData(t)},t.prototype.getImage=function(){return this.api.getImage()},t.prototype.getCanvas=function(){return this.api.getCtx().canvas},t.prototype.destroy=function(){this.api.onClickDestroy()},Object.defineProperty(t.prototype,"coverColor",{set:function(t){this.api.updateCoverColor(t)},enumerable:!1,configurable:!0}),t}()},8148:(t,e,i)=>{i.d(e,{An:()=>s.An,Bm:()=>r.Bm,JV:()=>r.JV,Kz:()=>r.Kz,_y:()=>r._y,aK:()=>r.aK,ld:()=>r.ld,nq:()=>r.nq,wq:()=>r.wq,xG:()=>r.xG,zq:()=>a.zq});var r=i(3185),a=(i(3160),i(5190)),s=(i(4199),i(4722));i(4904),i(9923)}}]);